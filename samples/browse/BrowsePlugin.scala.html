<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>BrowsePlugin.scala</title>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* browse -- Scala Source Browser
 * Copyright 2009 Mark Harrah
 */</span>

<span class="keyword">package</span> browse

<span class="keyword">import</span> scala.tools.nsc.{plugins, Global, Phase}
<span class="keyword">import</span> plugins.PluginComponent
<span class="keyword">import</span> scala.collection.jcl.{TreeMap, TreeSet}
<span class="keyword">import</span> java.io.File

<span class="keyword">object</span> <a title="object browse.BrowsePlugin" id="6207">BrowsePlugin</a>
{
	<span class="keyword">val</span> <span id="21416"><a title="java.lang.String" id="21415">PluginName</a></span> = <span title="java.lang.String(&quot;browse&quot;)" class="string">&quot;browse&quot;</span>
	<span class="comment">/** This is the name of the option that specifies the base directory against which sources
	* should be relativized.*/</span>
	<span class="keyword">val</span> <span id="21418"><a title="java.lang.String" id="21417">BaseDirectoryOptionName</a></span> = <span title="java.lang.String(&quot;base-directory:&quot;)" class="string">&quot;base-directory:&quot;</span>
}
<span class="comment">/* The standard plugin setup.  The main implementation is in Browse.  The entry point is Browse.generateOutput */</span>
<span class="keyword">class</span> <a title="class BrowsePlugin extends browse.Browse with ScalaObject" id="6209">BrowsePlugin</a>(<span class="keyword">val</span> <span id="21422"><span id="21421"><a title="scala.tools.nsc.Global" id="21858">global</a></span></span>: <a title="scala.tools.nsc.Global" id="6639">Global</a>) <span class="keyword">extends</span> <a href="Browse.scala.html#6168" title="browse.Browse">Browse</a>
{
	<span class="keyword">import</span> global._
	<span class="keyword">import</span> BrowsePlugin._
	
	<span class="keyword">val</span> <span id="21427"><a title="java.lang.String" id="21426">name</a></span> = <a href="#21415" title="=&gt; java.lang.String">PluginName</a>
	<span class="keyword">val</span> <span id="21429"><a title="java.lang.String" id="21428">description</a></span> = <span title="java.lang.String(&quot;A plugin to produce a browsable representation of the input sources.&quot;)" class="string">&quot;A plugin to produce a browsable representation of the input sources.&quot;</span>
	<span class="keyword">val</span> <span id="21431"><a title="List[scala.tools.nsc.plugins.PluginComponent]" id="21430">components</a></span> = <span id="11146"><a title="(scala.tools.nsc.plugins.PluginComponent*)List[scala.tools.nsc.plugins.PluginComponent]" id="488">List</a></span>[<a title="scala.tools.nsc.plugins.PluginComponent" id="8442">PluginComponent</a>](<a href="#21443" title="object BrowsePlugin.this.Component">Component</a>)
	
	<span class="comment">/** The directory to which the annotated sources will be written. */</span>
	<span class="keyword">val</span> <span id="21433"><a title="java.io.File" id="21432">outputDirectory</a></span> = (<a title="(java.lang.String,java.lang.String)java.io.File" id="11662" class="keyword">new</a> <a title="java.io.File" id="3612">File</a>(<a href="#21421" title="=&gt; scala.tools.nsc.Settings" id="10783">settings</a>.<a title="=&gt; scala.tools.nsc.Settings#StringSetting" id="21624">outdir</a>.<a title="=&gt; String" id="21605">value</a>, <span title="java.lang.String(&quot;../browse&quot;)" class="string">&quot;../browse&quot;</span>)).<a title="()java.io.File" id="11671">getAbsoluteFile</a>
	<a href="#21432" title="=&gt; java.io.File">outputDirectory</a>.<a title="()Boolean" id="11693">mkdirs</a>()

	<span class="comment">/** The directory against which the input source paths will be relativized.*/</span>
	<span class="keyword">var</span> <span id="21436"><span id="21434"><span id="21435"><a title="Option[java.io.File]" id="21857">baseDirectory</a></span></span></span>: <a title="Option[java.io.File]" id="889">Option</a>[File] = <a title="object None" id="497">None</a>

	<span class="keyword">override</span> <span class="keyword">def</span> <a title="(List[String],(String) =&gt; Unit)Unit" id="21437">processOptions</a>(<a title="List[String]" id="21859">options</a>: <a title="List[String]" id="487">List</a>[String], <a title="(String) =&gt; Unit" id="21860">error</a>: String =&gt; Unit)
	{
		<span class="keyword">for</span>(<span id="11184"><a title="((String) =&gt; Unit)Unit" id="21862">option</a></span> &lt;- <a href="#21859" title="List[String]">options</a>)
		{
			<span title="Unit" class="keyword">if</span>(<a href="#21862" title="String">option</a>.<a title="(java.lang.String)Boolean" id="5775">startsWith</a>(<a href="#21417" title="=&gt; java.lang.String">BaseDirectoryOptionName</a>))
				<a href="#21435" title="(Option[java.io.File])Unit">baseDirectory</a> = <span id="19672"><a title="(java.io.File)Some[java.io.File]" id="278">Some</a></span>(<span title="java.io.File" class="keyword">new</span> <a title="java.io.File" id="3612">File</a>(<a href="#21862" title="String">option</a>.<a title="(Int)java.lang.String" id="5788">substring</a>(<a href="#21417" title="=&gt; java.lang.String">BaseDirectoryOptionName</a>.<a title="()Int" id="5755">length</a>)))
			<span class="keyword">else</span>
				<a href="#21860" title="(String)Unit" id="11566">error</a>(<span title="java.lang.String(&quot;Option for source browser plugin not understood: &quot;)" class="string">&quot;Option for source browser plugin not understood: &quot;</span> <a title="(Any)java.lang.String" id="5736">+</a> <a href="#21862" title="String">option</a>)
		}
	}
	<span class="keyword">override</span> <span class="keyword">val</span> <span id="21439"><a title="Option[String]" id="21438">optionsHelp</a></span>: <a title="Option[String]" id="889">Option</a>[String] =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="21868">prefix</a> = <span title="java.lang.String(&quot;  -P:&quot;)" class="string">&quot;  -P:&quot;</span> <a title="(Any)java.lang.String" id="5736">+</a> <a href="#21426" title="=&gt; java.lang.String">name</a> <a title="(Any)java.lang.String" id="5736">+</a> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span>
		<span id="19672"><a title="(java.lang.String)Some[java.lang.String]" id="278">Some</a></span>(<a href="#21868" title="java.lang.String">prefix</a> <a title="(Any)java.lang.String" id="5736">+</a> <a href="#21417" title="=&gt; java.lang.String">BaseDirectoryOptionName</a> <a title="(Any)java.lang.String" id="5736">+</a> <span title="java.lang.String(&quot;&lt;name&gt;            Set the base source directory .\012&quot;)" class="string">&quot;&lt;name&gt;            Set the base source directory .\n&quot;</span>)
	}

	<span class="comment">/* For source compatibility between 2.7.x and 2.8.x */</span>
	<span class="keyword">private</span> <span class="keyword">object</span> <a title="object BrowsePlugin.this.runsBefore" id="21440">runsBefore</a> { <span class="keyword">def</span> <a title="(String)String" id="21871">::</a> (<a title="String" id="21873">s</a>: <a title="String" id="1801">String</a>) = <a href="#21873" title="String">s</a> }
	<span class="keyword">private</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CompatiblePluginComponent extends scala.tools.nsc.plugins.PluginComponent with ScalaObject" id="21442">CompatiblePluginComponent</a>(<span id="21451"><a title="String" id="21878">afterPhase</a></span>: <a title="String" id="1801">String</a>) <span class="keyword">extends</span> <a title="scala.tools.nsc.plugins.PluginComponent" id="8442">PluginComponent</a>
	{
		<span class="keyword">val</span> <span id="21454"><a title="String" id="21453">runsAfter</a></span> = <a href="#21451" title="String">afterPhase</a> <a href="#21871" title="(String)String">::</a> <a href="#21440" title="object BrowsePlugin.this.runsBefore">runsBefore</a>
	}
	<span class="keyword">private</span> <span class="keyword">object</span> <a title="object BrowsePlugin.this.Component" id="21443">Component</a> <span class="keyword">extends</span> <a href="#21442" title="BrowsePlugin.this.CompatiblePluginComponent">CompatiblePluginComponent</a>(<span title="java.lang.String(&quot;typer&quot;)" class="string">&quot;typer&quot;</span>)
	{
		<span class="keyword">val</span> <span id="21457"><a title="scala.tools.nsc.Global" id="21456">global</a></span> = <a href="#6209" title="BrowsePlugin.this.type">BrowsePlugin</a>.<span class="keyword">this</span>.<a href="#21421" title="=&gt; scala.tools.nsc.Global">global</a>
		<span class="keyword">val</span> <span id="21459"><a title="java.lang.String" id="21458">phaseName</a></span> = <a href="#6209" title="BrowsePlugin.this.type">BrowsePlugin</a>.<span class="keyword">this</span>.<a href="#21426" title="=&gt; java.lang.String">name</a>
		<span class="keyword">def</span> <a title="(scala.tools.nsc.Phase)BrowsePlugin.this.BrowsePhase" id="21460">newPhase</a>(<a title="scala.tools.nsc.Phase" id="21880">prev</a>: <a title="scala.tools.nsc.Phase" id="6273">Phase</a>) = <span title="BrowsePlugin.this.BrowsePhase" class="keyword">new</span> <a href="#21445" title="BrowsePlugin.this.BrowsePhase">BrowsePhase</a>(<a href="#21880" title="scala.tools.nsc.Phase">prev</a>)
	}

	<span class="keyword">private</span> <span class="keyword">class</span> <a title="class BrowsePhase extends scala.tools.nsc.Phase with ScalaObject" id="21445">BrowsePhase</a>(<span id="21907"><a title="scala.tools.nsc.Phase" id="21911">prev</a></span>: <a title="scala.tools.nsc.Phase" id="6273">Phase</a>) <span class="keyword">extends</span> <a title="scala.tools.nsc.Phase" id="6273">Phase</a>(<a href="#21911" title="scala.tools.nsc.Phase">prev</a>)
	{
		<span class="keyword">def</span> <a title="=&gt; java.lang.String" id="21909">name</a> = <a href="#6209" title="BrowsePlugin.this.type">BrowsePlugin</a>.<span class="keyword">this</span>.<a href="#21426" title="=&gt; java.lang.String">name</a>
		<span class="keyword">def</span> <a title="=&gt; Unit" id="21910">run</a> = <a href="Browse.scala.html#10768" title="()Unit">generateOutput</a>()
	}
}
        </pre>
    </body>
</html>