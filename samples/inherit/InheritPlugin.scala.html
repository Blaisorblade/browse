<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>InheritPlugin.scala</title>
        <script type="text/javascript" src="jquery-1.3.2.min.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style">
    </head>
    <body>
        <pre>
<span class="comment">/* inherit -- Inheritance Graph Generator
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> inherit

<span class="keyword">import</span> scala.tools.nsc.{plugins, Global, Phase}
<span class="keyword">import</span> plugins.{Plugin, PluginComponent}

<span class="keyword">import</span> scala.collection.jcl.{TreeMap, TreeSet}
<span class="keyword">import</span> scala.collection.mutable.HashMap
<span class="keyword">import</span> java.io.{BufferedWriter, File, FileWriter, PrintWriter, Writer}

<span class="comment">/** Contains the main code for traversing the AST and producing the inheritance graph. The main method
* is 'graph'.*/</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Inherit extends scala.tools.nsc.plugins.Plugin with ScalaObject</span><a id="6166">Inherit</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.plugins.Plugin</span><a id="7173">Plugin</a></span>
{
	<span class="comment">// global is the compiler instance provided to the plugin</span>
	<span class="keyword">import</span> global._
	<span class="comment">/** The file to write the graph to.*/</span>
	<span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; java.io.File</span><a id="8288">output</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3612">File</a></span>
	<span class="comment">/** Construct the inheritance graph and write it to 'output'.*/</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="8289">graph</a></span>()
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">java.io.PrintWriter</span><a id="15970">out</a></span> = <span class="typed"><span class="type">java.io.PrintWriter</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.PrintWriter</span><a id="3702">PrintWriter</a></span>(<span class="typed"><span class="type">java.io.BufferedWriter</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.BufferedWriter</span><a id="3750">BufferedWriter</a></span>(<span class="typed"><span class="type">(java.io.File)java.io.FileWriter</span><a id="16069" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileWriter</span><a id="3567">FileWriter</a></span>(<span class="typed"><span class="type">=&gt; java.io.File</span><a href="#8288">output</a></span>)))
		<span class="keyword">try</span>
		{
			<span class="typed"><span class="type">java.io.PrintWriter</span><a href="#15970">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="16006">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;digraph Inheritance {&quot;)</span><span class="string">&quot;digraph Inheritance {&quot;</span></span>)
			<span class="typed"><span class="type">(java.io.PrintWriter)Unit</span><a href="#8290">graph</a></span>(<span class="typed"><span class="type">java.io.PrintWriter</span><a href="#15970">out</a></span>)
			<span class="typed"><span class="type">java.io.PrintWriter</span><a href="#15970">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="16006">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;}&quot;)</span><span class="string">&quot;}&quot;</span></span>)
		}
		<span class="keyword">finally</span> { <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#15970">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="15981">close</a></span>() }
	}
	<span class="comment">/** Construct the inheritance graph and write it to 'out'.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.PrintWriter)Unit</span><a id="8290">graph</a></span>(<span class="typed"><span class="type">java.io.PrintWriter</span><a id="16401">out</a></span>: <span class="typed"><span class="type">java.io.PrintWriter</span><a id="3702">PrintWriter</a></span>)
	{
		<span class="comment">// map from a class/module to its immediate parents</span>
		<span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><a id="16404">subToSuper</a></span> = <span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><a id="8016">HashMap</a></span>[Symbol, Set[Symbol]]
		<span class="comment">// include all classes/modules directly in the source</span>
		<span class="keyword">for</span>(<span class="typed"><span class="type">((Inherit.this.global.CompilationUnit) =&gt; Unit)Unit</span><a id="17267">unit</a></span> &lt;- <span class="typed"><span class="type">=&gt; Inherit.this.global.Run</span><a href="#6166" id="8272">currentRun</a></span>.<span class="typed"><span class="type">=&gt; Iterator[Inherit.this.global.CompilationUnit]</span><a id="10662">units</a></span>; <span class="typed"><span class="type">((Inherit.this.global.Tree) =&gt; Unit)Unit</span><a id="17269">node</a></span> &lt;- <span class="typed"><span class="type">Inherit.this.global.CompilationUnit</span><a href="#17267">unit</a></span>.<span class="typed"><span class="type">=&gt; Inherit.this.global.Tree</span><a id="15879">body</a></span>)
		{
			<span class="typed"><span class="type">Inherit.this.global.Tree</span><a href="#17269">node</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span>
			{
				<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Inherit.this.global.ClassDef</span><a id="17270">cd</a></span>: <span class="typed"><span class="type">Inherit.this.global.ClassDef</span><a id="14792">ClassDef</a></span> =&gt; <span class="typed"><span class="type">(Inherit.this.global.Symbol)Unit</span><a href="#16405">processDirect</a></span>(<span class="typed"><span class="type">Inherit.this.global.ClassDef</span><a href="#17270">cd</a></span>.<span class="typed"><span class="type">=&gt; Inherit.this.global.Symbol</span><a id="14799">symbol</a></span>)
				<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Inherit.this.global.ModuleDef</span><a id="17276">md</a></span>: <span class="typed"><span class="type">Inherit.this.global.ModuleDef</span><a id="14931">ModuleDef</a></span> =&gt; <span class="typed"><span class="type">(Inherit.this.global.Symbol)Unit</span><a href="#16405">processDirect</a></span>(<span class="typed"><span class="type">Inherit.this.global.ModuleDef</span><a href="#17276">md</a></span>.<span class="typed"><span class="type">=&gt; Inherit.this.global.Symbol</span><a id="14799">symbol</a></span>)
				<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _ =&gt; <span class="typed"><span class="type">Unit</span><span >(</span></span>)
			}
		}

		<span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)Unit</span><a id="16405">processDirect</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17275">sym</a></span>: <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>): <span class="typed"><span class="type">Unit</span><a id="2109">Unit</a></span>  =  <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">(Inherit.this.global.Symbol)Boolean</span><a href="#8291">visible</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17275">sym</a></span>)) <span class="typed"><span class="type">(Inherit.this.global.Symbol)Set[Inherit.this.global.Symbol]</span><a href="#16406">getParents</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17275">sym</a></span>)
		<span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)Set[Inherit.this.global.Symbol]</span><a id="16406">getParents</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17279">sym</a></span>: <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>) = <span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><a href="#16404">subToSuper</a></span>.<span class="typed"><span class="type">(Inherit.this.global.Symbol,=&gt; Set[Inherit.this.global.Symbol])Set[Inherit.this.global.Symbol]</span><a id="17046">getOrElseUpdate</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17279">sym</a></span>, <span class="typed"><span class="type">(Inherit.this.global.Symbol)scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a href="#16408">parents</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17279">sym</a></span>))
		<span class="comment">// alias for an immutable empty set of Symbols</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="16407">empty</a></span> = <span class="typed"><span class="type">=&gt; collection.immutable.Set.type</span><a id="779">Set</a></span>.<span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="16994">empty</a></span>[<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>]
		<span class="comment">// get the parents of the given symbol if it is a class or module</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="16408">parents</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17280">definition</a></span>: <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>) =
		{
			<span class="keyword">val</span> <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17281">sym</a></span> =
				<span class="typed"><span class="type">Inherit.this.global.Symbol</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17280">definition</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="11805">isModule</a></span>) <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17280">definition</a></span>.<span class="typed"><span class="type">=&gt; Inherit.this.global.Symbol</span><a id="11952">moduleClass</a></span> <span class="comment">// the module class has the parent information</span>
				<span class="keyword">else</span> <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17280">definition</a></span>
			
			<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17281">sym</a></span> <span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">match</span></span>
			{
				<span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Inherit.this.global.ClassSymbol</span><a id="17282">cs</a></span>: <span class="typed"><span class="type">Inherit.this.global.ClassSymbol</span><a id="11681">ClassSymbol</a></span> =&gt; <span class="typed"><span class="type">(Inherit.this.global.ClassSymbol)scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a href="#16409">classParents</a></span>(<span class="typed"><span class="type">Inherit.this.global.ClassSymbol</span><a href="#17282">cs</a></span>)
				<span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">case</span></span> _ =&gt; <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a href="#16407">empty</a></span>
			}
		}
		<span class="comment">// get the parents of the given class/module</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.ClassSymbol)scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="16409">classParents</a></span>(<span class="typed"><span class="type">Inherit.this.global.ClassSymbol</span><a id="17283">cs</a></span>: <span class="typed"><span class="type">Inherit.this.global.ClassSymbol</span><a id="11681">ClassSymbol</a></span>) =
		{
			<span class="typed"><span class="type">Inherit.this.global.ClassSymbol</span><a href="#17283">cs</a></span>.<span class="typed"><span class="type">=&gt; Inherit.this.global.Type</span><a id="11900">info</a></span> <span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">match</span></span>
			{
				<span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Inherit.this.global.ClassInfoType</span><a id="17284">cit</a></span>: <span class="typed"><span class="type">Inherit.this.global.ClassInfoType</span><a id="12603">ClassInfoType</a></span> =&gt; <span class="typed"><span class="type">(Inherit.this.global.ClassInfoType)scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a href="#16410">parentsFromClassInfo</a></span>(<span class="typed"><span class="type">Inherit.this.global.ClassInfoType</span><a href="#17284">cit</a></span>)
				<span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">case</span></span> <a id="1">PolyType</a>(_, <span class="typed"><span class="type">Inherit.this.global.Type</span><a id="17308">result</a></span>) =&gt;
					<span class="typed"><span class="type">Inherit.this.global.Type</span><a href="#17308">result</a></span> <span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">match</span></span>
					{
						<span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Inherit.this.global.ClassInfoType</span><a id="17309">cit</a></span>: <span class="typed"><span class="type">Inherit.this.global.ClassInfoType</span><a id="12603">ClassInfoType</a></span> =&gt; <span class="typed"><span class="type">(Inherit.this.global.ClassInfoType)scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a href="#16410">parentsFromClassInfo</a></span>(<span class="typed"><span class="type">Inherit.this.global.ClassInfoType</span><a href="#17309">cit</a></span>)
						<span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">case</span></span> _ =&gt; <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a href="#16407">empty</a></span>
					}
				<span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><span class="keyword">case</span></span> _ =&gt; <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a href="#16407">empty</a></span>
			}
		}
		<span class="comment">// get the parents from the class info</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.ClassInfoType)scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="16410">parentsFromClassInfo</a></span>(<span class="typed"><span class="type">Inherit.this.global.ClassInfoType</span><a id="17285">cit</a></span>: <span class="typed"><span class="type">Inherit.this.global.ClassInfoType</span><a id="12603">ClassInfoType</a></span>) = <span class="typed"><span class="type">(Inherit.this.global.Symbol*)scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="779">Set</a></span>(<span class="typed"><span class="type">Inherit.this.global.ClassInfoType</span><a href="#17285">cit</a></span>.<span class="typed"><span class="type">=&gt; List[Inherit.this.global.Type]</span><a id="12604">parents</a></span>.<span class="typed"><span class="type">((Inherit.this.global.Type) =&gt; Inherit.this.global.Symbol)List[Inherit.this.global.Symbol]</span><a id="8333">map</a></span>(<span class="typed"><span class="type">Inherit.this.global.Type</span><a href="#17289">_</a></span>.<span class="typed"><span class="type">=&gt; Inherit.this.global.Symbol</span><a id="12124">typeSymbol</a></span>).<span class="typed"><span class="type">((Inherit.this.global.Symbol) =&gt; Boolean)List[Inherit.this.global.Symbol]</span><a id="8338">filter</a></span>(<span class="typed"><span class="type">(Inherit.this.global.Symbol)Boolean</span><a href="#8294">filterClass</a></span>) : _*)

		<span class="comment">// all ancestors of a class or module</span>
		<span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><a id="16411">ancestors</a></span> = <span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><a id="8016">HashMap</a></span>[Symbol, Set[Symbol]]
		<span class="comment">// get the ancestors for the given symbol (recomputed each call)</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)Set[Inherit.this.global.Symbol]</span><a id="16412">ancestorsImpl</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17324">sym</a></span>: <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>): <span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a id="16783">Set</a></span>[Symbol] =
		{
			<span class="keyword">val</span> <span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a id="17325">parents</a></span> = <span class="typed"><span class="type">(Inherit.this.global.Symbol)Set[Inherit.this.global.Symbol]</span><a href="#16406">getParents</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17324">sym</a></span>)
			<span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a href="#17325">parents</a></span>.<span class="typed"><span class="type">((Inherit.this.global.Symbol) =&gt; Iterable[Inherit.this.global.Symbol])scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="17015">flatMap</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17328">parent</a></span> =&gt; <span class="typed"><span class="type">(Inherit.this.global.Symbol)Set[Inherit.this.global.Symbol]</span><a href="#16413">getAncestors</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17328">parent</a></span>)) <span class="typed"><span class="type">(Iterable[Inherit.this.global.Symbol])scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="17001">++</a></span> <span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a href="#17325">parents</a></span>
		}
		<span class="comment">// get the ancestors for the given symbol (memoized)</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)Set[Inherit.this.global.Symbol]</span><a id="16413">getAncestors</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17329">sym</a></span>: <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>) = <span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><a href="#16411">ancestors</a></span>.<span class="typed"><span class="type">(Inherit.this.global.Symbol,=&gt; Set[Inherit.this.global.Symbol])Set[Inherit.this.global.Symbol]</span><a id="17046">getOrElseUpdate</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17329">sym</a></span>, <span class="typed"><span class="type">(Inherit.this.global.Symbol)Set[Inherit.this.global.Symbol]</span><a href="#16412">ancestorsImpl</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17329">sym</a></span>))
		<span class="comment">// fill in the ancestors for all classes we are looking at</span>
		<span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><a href="#16404">subToSuper</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.Set[Inherit.this.global.Symbol]</span><a id="17081">keySet</a></span>.<span class="typed"><span class="type">((Inherit.this.global.Symbol) =&gt; Unit)Unit</span><a id="8754">foreach</a></span>(<span class="typed"><span class="type">(Inherit.this.global.Symbol)Set[Inherit.this.global.Symbol]</span><a href="#16413">getAncestors</a></span>)

		<span class="comment">// write out the definitions/attributes for each main class/module</span>
		<span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><a href="#16411">ancestors</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.Set[Inherit.this.global.Symbol]</span><a id="17081">keySet</a></span>.<span class="typed"><span class="type">((Inherit.this.global.Symbol) =&gt; Unit)Unit</span><a id="8754">foreach</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="18310">sym</a></span> =&gt; <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">(Inherit.this.global.Symbol)Boolean</span><a href="#8291">visible</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#18310">sym</a></span>)) <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#16401">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="16006">println</a></span>(<span class="typed"><span class="type">(Inherit.this.global.Symbol)java.lang.String</span><a href="#8293">makeLabel</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#18310">sym</a></span>)))

		<span class="comment">// write out the directed edges to parents</span>
		<span class="keyword">for</span>( <span class="typed"><span class="type">(((Inherit.this.global.Symbol, Set[Inherit.this.global.Symbol])) =&gt; Unit)Unit</span><a href="#18319" id="8748">(</a></span><span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="18329">symbol</a></span>, <span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a id="18330">parents</a></span>) &lt;- <span class="typed"><span class="type">scala.collection.mutable.HashMap[Inherit.this.global.Symbol,Set[Inherit.this.global.Symbol]]</span><a href="#16404">subToSuper</a></span> <span class="keyword">if</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)Boolean</span><a href="#8291">visible</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#18329">symbol</a></span>))
		{
			<span class="keyword">val</span> <span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a id="18331">indirectAncestors</a></span>: <span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a id="16783">Set</a></span>[Symbol] = <span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a href="#18330">parents</a></span>.<span class="typed"><span class="type">((Inherit.this.global.Symbol) =&gt; Iterable[Inherit.this.global.Symbol])scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="17015">flatMap</a></span>(<span class="typed"><span class="type">(Inherit.this.global.Symbol)Set[Inherit.this.global.Symbol]</span><a href="#16413">getAncestors</a></span>)
			<span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="18332">uniqueParents</a></span> = <span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a href="#18330">parents</a></span>.<span class="typed"><span class="type">((Inherit.this.global.Symbol) =&gt; Boolean)scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a id="17017">filter</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="18337">parent</a></span> =&gt; <span class="typed"><span class="type">=&gt; Boolean</span><a id="2690">!</a></span><span class="typed"><span class="type">Set[Inherit.this.global.Symbol]</span><a href="#18331">indirectAncestors</a></span>.<span class="typed"><span class="type">(Inherit.this.global.Symbol)Boolean</span><a id="17313">contains</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#18337">parent</a></span>))
			<span class="keyword">for</span>(<span class="typed"><span class="type">((Inherit.this.global.Symbol) =&gt; Unit)Unit</span><a id="18339">parent</a></span> &lt;- <span class="typed"><span class="type">scala.collection.immutable.Set[Inherit.this.global.Symbol]</span><a href="#18332">uniqueParents</a></span>)
				<span class="typed"><span class="type">java.io.PrintWriter</span><a href="#16401">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="16006">println</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#18329">symbol</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="11640">id</a></span> <span class="typed"><span class="type">(java.lang.String)java.lang.String</span><a id="3032">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; -&gt; &quot;)</span><span class="string">&quot; -&gt; &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5736">+</a></span> <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#18339">parent</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="11640">id</a></span>)
		}
	}
	<span class="comment">// true if the given symbol is not anonymous</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)Boolean</span><a id="8291">visible</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17277">sym</a></span>: <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>) = <span class="typed"><span class="type">=&gt; Boolean</span><a id="2690">!</a></span><span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17277">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="11820">isAnonymousFunction</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2694">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2690">!</a></span><span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17277">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="11819">isAnonymousClass</a></span>
	<span class="comment">// converts the symbol into a readable representation, TODO: decode symbols in names</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)String</span><a id="8292">toString</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17295">sym</a></span>: <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>) = <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17295">sym</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="11981">fullNameString</a></span>
	<span class="comment">// produce a definition string for the graph file</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)java.lang.String</span><a id="8293">makeLabel</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="18313">sym</a></span>: <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>) =
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="18315">label</a></span> = (<span class="typed"><span class="type">java.lang.String</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#18313">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="11805">isModule</a></span>) <span class="typed"><span class="type">java.lang.String(&quot;object &quot;)</span><span class="string">&quot;object &quot;</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">java.lang.String(&quot;class &quot;)</span><span class="string">&quot;class &quot;</span></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5736">+</a></span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)String</span><a href="#8292">toString</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#18313">sym</a></span>)
		<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#18313">sym</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="11640">id</a></span> <span class="typed"><span class="type">(java.lang.String)java.lang.String</span><a id="3032">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;[shape=box label=&quot;&quot;)</span><span class="string">&quot;[shape=box label=\&quot;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5736">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#18315">label</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5736">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;]&quot;)</span><span class="string">&quot;\&quot;]&quot;</span></span>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Inherit.this.global.Symbol)Boolean</span><a id="8294">filterClass</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="17291">sym</a></span>: <span class="typed"><span class="type">Inherit.this.global.Symbol</span><a id="11623">Symbol</a></span>) = <span class="typed"><span class="type">(String)Boolean</span><a href="#8295">filterClassName</a></span>(<span class="typed"><span class="type">(Inherit.this.global.Symbol)String</span><a href="#8292">toString</a></span>(<span class="typed"><span class="type">Inherit.this.global.Symbol</span><a href="#17291">sym</a></span>))
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Boolean</span><a id="8295">filterClassName</a></span>(<span class="typed"><span class="type">String</span><a id="17293">name</a></span>: <span class="typed"><span class="type">String</span><a id="1801">String</a></span>) = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span><span class="comment">//name != &quot;scala.Product&quot; &amp;&amp; name != &quot;scala.ScalaObject&quot;</span>
}

<span class="comment">/****** Standard compiler plugin configuration. **********/</span>

<span class="keyword">object</span> <span class="typed"><span class="type">object inherit.InheritPlugin</span><a id="6167">InheritPlugin</a></span>
{
	<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="18344">PluginName</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;inherit&quot;)</span><span class="string">&quot;inherit&quot;</span></span>
}
<span class="keyword">class</span> <span class="typed"><span class="type">class InheritPlugin extends inherit.Inherit with ScalaObject</span><a id="6169">InheritPlugin</a></span>(<span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><a id="18873">global</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Global</span><a id="6584">Global</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">inherit.Inherit</span><a href="#6166">Inherit</a></span>
{
	<span class="keyword">import</span> global._
	<span class="keyword">import</span> InheritPlugin._
	
	<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="18353">name</a></span> = <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#18344">PluginName</a></span>
	<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="18355">description</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;A plugin to produce an inheritance graph of the input sources.&quot;)</span><span class="string">&quot;A plugin to produce an inheritance graph of the input sources.&quot;</span></span>
	<span class="keyword">val</span> <span class="typed"><span class="type">List[scala.tools.nsc.plugins.PluginComponent]</span><a id="18357">components</a></span> = <span class="typed"><span class="type">(scala.tools.nsc.plugins.PluginComponent*)List[scala.tools.nsc.plugins.PluginComponent]</span><a id="488">List</a></span>[<span class="typed"><span class="type">scala.tools.nsc.plugins.PluginComponent</span><a id="7215">PluginComponent</a></span>](<span class="typed"><span class="type">object InheritPlugin.this.Component</span><a href="#18364">Component</a></span>)
	
	<span class="comment">/** The output file, currently hard-coded. */</span>
	<span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="18359">output</a></span> = (<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.io.File</span><a id="15925" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.File</span><a id="3612">File</a></span>(<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="#18873" id="10333">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings#StringSetting</span><a id="18640">outdir</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="18621">value</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;../inherit/inherit.dot&quot;)</span><span class="string">&quot;../inherit/inherit.dot&quot;</span></span>)).<span class="typed"><span class="type">()java.io.File</span><a id="15934">getAbsoluteFile</a></span>
	<span class="typed"><span class="type">=&gt; java.io.File</span><a href="#18359">output</a></span>.<span class="typed"><span class="type">()java.io.File</span><a id="15930">getParentFile</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="15956">mkdirs</a></span>()

	<span class="comment">/* For source compatibility between 2.7.x and 2.8.x */</span>
	<span class="keyword">private</span> <span class="keyword">object</span> <span class="typed"><span class="type">object InheritPlugin.this.runsBefore</span><a id="18361">runsBefore</a></span> { <span class="keyword">def</span> <span class="typed"><span class="type">(String)String</span><a id="18875">::</a></span> (<span class="typed"><span class="type">String</span><a id="18877">s</a></span>: <span class="typed"><span class="type">String</span><a id="1801">String</a></span>) = <span class="typed"><span class="type">String</span><a href="#18877">s</a></span> }
	<span class="keyword">private</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class CompatiblePluginComponent extends scala.tools.nsc.plugins.PluginComponent with ScalaObject</span><a id="18363">CompatiblePluginComponent</a></span>(<span class="typed"><span class="type">String</span><a id="18882">afterPhase</a></span>: <span class="typed"><span class="type">String</span><a id="1801">String</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.plugins.PluginComponent</span><a id="7215">PluginComponent</a></span>
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">String</span><a id="18393">runsAfter</a></span> = <span class="typed"><span class="type">String</span><a href="#18882">afterPhase</a></span> <span class="typed"><span class="type">(String)String</span><a href="#18875">::</a></span> <span class="typed"><span class="type">object InheritPlugin.this.runsBefore</span><a href="#18361">runsBefore</a></span>
	}
	<span class="keyword">private</span> <span class="keyword">object</span> <span class="typed"><span class="type">object InheritPlugin.this.Component</span><a id="18364">Component</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">InheritPlugin.this.CompatiblePluginComponent</span><a href="#18363">CompatiblePluginComponent</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;typer&quot;)</span><span class="string">&quot;typer&quot;</span></span>)
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><a id="18396">global</a></span> = <span class="typed"><span class="type">InheritPlugin.this.type</span><a href="#6169">InheritPlugin</a></span>.<span class="keyword">this</span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#18873">global</a></span>
		<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="18398">phaseName</a></span> = <span class="typed"><span class="type">InheritPlugin.this.type</span><a href="#6169">InheritPlugin</a></span>.<span class="keyword">this</span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#18353">name</a></span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.Phase)InheritPlugin.this.InheritPhase</span><a id="18400">newPhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="18884">prev</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="6218">Phase</a></span>) = <span class="typed"><span class="type">InheritPlugin.this.InheritPhase</span><span class="keyword">new</span></span> <span class="typed"><span class="type">InheritPlugin.this.InheritPhase</span><a href="#18366">InheritPhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a href="#18884">prev</a></span>)
	}

	<span class="keyword">private</span> <span class="keyword">class</span> <span class="typed"><span class="type">class InheritPhase extends scala.tools.nsc.Phase with ScalaObject</span><a id="18366">InheritPhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="18915">prev</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="6218">Phase</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="6218">Phase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a href="#18915">prev</a></span>)
	{
		<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; java.lang.String</span><a id="18913">name</a></span> = <span class="typed"><span class="type">InheritPlugin.this.type</span><a href="#6169">InheritPlugin</a></span>.<span class="keyword">this</span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#18353">name</a></span>
		<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Unit</span><a id="18914">run</a></span> = <span class="typed"><span class="type">()Unit</span><a href="#8289">graph</a></span>()
	}
}

        </pre>
    </body>
</html>