<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/transform/Flatten.scala</title>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author Martin Odersky
 */</span>
<span class="comment">// $Id: Flatten.scala 17188 2009-02-24 11:54:40Z michelou $</span>

<span class="keyword">package</span> scala.tools.nsc.transform

<span class="keyword">import</span> symtab._
<span class="keyword">import</span> Flags._
<span class="keyword">import</span> scala.collection.mutable.{HashMap, ListBuffer}

<span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Flatten extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.InfoTransform with ScalaObject</span><a id="13345">Flatten</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.transform.InfoTransform</span><a href="InfoTransform.scala.html#12961">InfoTransform</a></span> {
  <span class="keyword">import</span> global._
  <span class="keyword">import</span> definitions._
  <span class="keyword">import</span> posAssigner.atPos

  <span class="comment">/** the following two members override abstract members in Transform */</span>
  <span class="keyword">val</span> <span class="typed"><span class="type">String</span><span id="82835"><a id="82834">phaseName</a></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;flatten&quot;)</span><span class="string">&quot;flatten&quot;</span></span>

  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Flatten.this.global.Symbol)Unit</span><a id="82836">liftClass</a></span>(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a id="99639">sym</a></span>: <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span>(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99639">sym</a></span> <span class="typed"><span class="type">(Long)Boolean</span><a href="../symtab/Symbols.scala.html#25223">hasFlag</a></span> <span class="typed"><span class="type">Long(17179869184L)</span><span >LIFTED</span></span>)) {
      <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99639">sym</a></span> <span class="typed"><span class="type">(Long)sym.type</span><a href="../symtab/Symbols.scala.html#25220">setFlag</a></span> <span class="typed"><span class="type">Long(17179869184L)</span><span >LIFTED</span></span>
      <span class="typed"><span class="type">(scala.tools.nsc.Phase)(=&gt; Flatten.this.global.Symbol)Flatten.this.global.Symbol</span><a href="../symtab/SymbolTable.scala.html#21147">atPhase</a></span>(<span class="typed"><span class="type">=&gt; scala.tools.nsc.Phase</span><a href="../symtab/SymbolTable.scala.html#21138">phase</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Phase</span><a href="../Phase.scala.html#27787">next</a></span>) {
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="../Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="../Settings.scala.html#30066">debug</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting#T</span><a href="../Settings.scala.html#30301">value</a></span>) <span class="typed"><span class="type">(AnyRef)Unit</span><a href="../Global.scala.html#21205">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;re-enter &quot;)</span><span class="string">&quot;re-enter &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99639">sym</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; in &quot;)</span><span class="string">&quot; in &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99639">sym</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>)
        <span class="typed"><span class="type">(Boolean,=&gt; Any)Unit</span><span id="6004"><a id="821">assert</a></span></span>(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99639">sym</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25167">isPackageClass</a></span>, <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99639">sym</a></span>) <span class="comment">//debug</span>
        <span class="keyword">val</span> <span class="typed"><span class="type">Flatten.this.global.Scope</span><a id="99666">scope</a></span> = <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99639">sym</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Type</span><a href="../symtab/Symbols.scala.html#25231">info</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Scope</span><a href="../symtab/Types.scala.html#25677">decls</a></span>
        <span class="keyword">val</span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a id="99667">old</a></span> = <span class="typed"><span class="type">Flatten.this.global.Scope</span><a href="#99666">scope</a></span> <span class="typed"><span class="type">(Flatten.this.global.Name)Flatten.this.global.Symbol</span><a href="../symtab/Scopes.scala.html#34624">lookup</a></span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99639">sym</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Name</span><a href="../symtab/Symbols.scala.html#25215">name</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99667">old</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">object Flatten.this.global.NoSymbol</span><a href="../symtab/Symbols.scala.html#21873">NoSymbol</a></span>) <span class="typed"><span class="type">Flatten.this.global.Scope</span><a href="#99666">scope</a></span> <span class="typed"><span class="type">(Flatten.this.global.Symbol)Unit</span><a href="../symtab/Scopes.scala.html#34623">unlink</a></span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99667">old</a></span>
        <span class="typed"><span class="type">Flatten.this.global.Scope</span><a href="#99666">scope</a></span> <span class="typed"><span class="type">(Flatten.this.global.Symbol)Flatten.this.global.Symbol</span><a href="../symtab/Scopes.scala.html#34617">enter</a></span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99639">sym</a></span>
      }
    }
  }

  <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">Flatten.this.global.TypeMap</span><span id="82838"><a id="82837">flattened</a></span></span> = <span class="typed"><span class="type">template $anon extends Flatten.this.global.TypeMap</span><a id="99610" class="keyword">new</a></span> <span class="typed"><span class="type">Flatten.this.global.TypeMap</span><a href="../symtab/Types.scala.html#22053">TypeMap</a></span> {
    <span class="keyword">def</span> <span class="typed"><span class="type">(Flatten.this.global.Type)Flatten.this.global.Type</span><a id="99612">apply</a></span>(<span class="typed"><span class="type">Flatten.this.global.Type</span><a id="99614">tp</a></span>: <span class="typed"><span class="type">Flatten.this.global.Type</span><a href="../symtab/Types.scala.html#21944">Type</a></span>): <span class="typed"><span class="type">Flatten.this.global.Type</span><a href="../symtab/Types.scala.html#21944">Type</a></span> = <span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99614">tp</a></span> <span class="typed"><span class="type">Flatten.this.global.Type</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">Flatten.this.global.Type</span><span class="keyword">case</span></span> <a id="1">TypeRef</a>(<span class="typed"><span class="type">Flatten.this.global.Type</span><a id="99615">pre</a></span>, <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a id="99616">sym</a></span>, <span class="typed"><span class="type">List[Flatten.this.global.Type]</span><a id="99617">args</a></span>) <span class="keyword">if</span> (<span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99615">pre</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Types.scala.html#25650">typeSymbol</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25129">isClass</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99615">pre</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Types.scala.html#25650">typeSymbol</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25167">isPackageClass</a></span>) =&gt;
        <span class="typed"><span class="type">(Boolean)Unit</span><span id="6003"><a id="821">assert</a></span></span>(<span class="typed"><span class="type">List[Flatten.this.global.Type]</span><a href="#99617">args</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="21645">isEmpty</a></span>)
        <span class="typed"><span class="type">(Flatten.this.global.Type,Flatten.this.global.Symbol,List[Flatten.this.global.Type])Flatten.this.global.Type</span><a href="../symtab/Types.scala.html#22031">typeRef</a></span>(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99616">sym</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25275">toplevelClass</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Type</span><a href="../symtab/Symbols.scala.html#25263">thisType</a></span>, <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99616">sym</a></span>, <span class="typed"><span class="type">List[Flatten.this.global.Type]</span><a href="#99617">args</a></span>)
      <span class="typed"><span class="type">Flatten.this.global.ClassInfoType</span><span class="keyword">case</span></span> <a id="1">ClassInfoType</a>(<span class="typed"><span class="type">List[Flatten.this.global.Type]</span><a id="99619">parents</a></span>, <span class="typed"><span class="type">Flatten.this.global.Scope</span><a id="99620">decls</a></span>, <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a id="99621">clazz</a></span>) =&gt;
        <span class="keyword">var</span> <span class="typed"><span class="type">List[Flatten.this.global.Type]</span><a id="99622">parents1</a></span> = <span class="typed"><span class="type">List[Flatten.this.global.Type]</span><a href="#99619">parents</a></span>
        <span class="keyword">val</span> <span class="typed"><span class="type">Flatten.this.global.Scope</span><a id="99623">decls1</a></span> = <span class="typed"><span class="type">=&gt; Flatten.this.global.Scope</span><a href="../symtab/Scopes.scala.html#22207">newScope</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99621">clazz</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25167">isPackageClass</a></span>) {
          <span class="typed"><span class="type">(scala.tools.nsc.Phase)(=&gt; Unit)Unit</span><a href="../symtab/SymbolTable.scala.html#21147">atPhase</a></span>(<span class="typed"><span class="type">=&gt; scala.tools.nsc.Phase</span><a href="../symtab/SymbolTable.scala.html#21138">phase</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Phase</span><a href="../Phase.scala.html#27787">next</a></span>)(<span class="typed"><span class="type">Flatten.this.global.Scope</span><a href="#99620">decls</a></span>.<span class="typed"><span class="type">=&gt; List[Flatten.this.global.Symbol]</span><a href="../symtab/Scopes.scala.html#34629">toList</a></span> <span class="typed"><span class="type">((Flatten.this.global.Symbol) =&gt; Unit)Unit</span><a id="21366">foreach</a></span> (<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a id="99628">sym</a></span> =&gt; <span class="typed"><span class="type">Flatten.this.global.Scope</span><a href="#99623">decls1</a></span> <span class="typed"><span class="type">(Flatten.this.global.Symbol)Flatten.this.global.Symbol</span><a href="../symtab/Scopes.scala.html#34617">enter</a></span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99628">sym</a></span>))
        } <span class="keyword">else</span> {
          <span class="keyword">val</span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a id="99630">oldowner</a></span> = <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99621">clazz</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>
          <span class="typed"><span class="type">(scala.tools.nsc.Phase)(=&gt; Flatten.this.global.Type)Flatten.this.global.Type</span><a href="../symtab/SymbolTable.scala.html#21147">atPhase</a></span>(<span class="typed"><span class="type">=&gt; scala.tools.nsc.Phase</span><a href="../symtab/SymbolTable.scala.html#21138">phase</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Phase</span><a href="../Phase.scala.html#27787">next</a></span>)(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99630">oldowner</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Type</span><a href="../symtab/Symbols.scala.html#25231">info</a></span>)
          <span class="typed"><span class="type">List[Flatten.this.global.Type]</span><a href="#99622">parents1</a></span> = <span class="typed"><span class="type">object List</span><a id="527">List</a></span>.<span class="typed"><span class="type">(List[Flatten.this.global.Type])((Flatten.this.global.Type) =&gt; Flatten.this.global.Type)List[Flatten.this.global.Type]</span><a id="21447">mapConserve</a></span>(<span class="typed"><span class="type">List[Flatten.this.global.Type]</span><a href="#99619">parents</a></span>)(<span class="typed"><span class="type">Flatten.this.global.TypeMap{ ... }</span><a href="#99610" class="keyword">this</a></span>)
          <span class="keyword">for</span> (<span class="typed"><span class="type">((Flatten.this.global.Symbol) =&gt; Unit)Unit</span><span id="21366"><a id="99635">sym</a></span></span> &lt;- <span class="typed"><span class="type">Flatten.this.global.Scope</span><a href="#99620">decls</a></span>.<span class="typed"><span class="type">=&gt; List[Flatten.this.global.Symbol]</span><a href="../symtab/Scopes.scala.html#34629">toList</a></span>) {
            <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99635">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25127">isTerm</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99635">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25150">isStaticModule</a></span>) {
              <span class="typed"><span class="type">Flatten.this.global.Scope</span><a href="#99623">decls1</a></span> <span class="typed"><span class="type">(Flatten.this.global.Symbol)Flatten.this.global.Symbol</span><a href="../symtab/Scopes.scala.html#34617">enter</a></span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99635">sym</a></span>
              <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99635">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25149">isModule</a></span>) <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99635">sym</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25283">moduleClass</a></span> <span class="typed"><span class="type">(Long)Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25220">setFlag</a></span> <span class="typed"><span class="type">Long(17179869184L)</span><span >LIFTED</span></span>
            } <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99635">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25129">isClass</a></span>) {
              <span class="typed"><span class="type">(Flatten.this.global.Symbol)Unit</span><a href="#82836">liftClass</a></span>(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99635">sym</a></span>)
              <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99635">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25191">needsImplClass</a></span>) <span class="typed"><span class="type">(Flatten.this.global.Symbol)Unit</span><a href="#82836">liftClass</a></span>(<span class="typed"><span class="type">object Flatten.this.global.erasure</span><a href="../Global.scala.html#21255">erasure</a></span>.<span class="typed"><span class="type">(Flatten.this.global.erasure.global.Symbol)Flatten.this.global.erasure.global.Symbol</span><a href="AddInterfaces.scala.html#43070">implClass</a></span>(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99635">sym</a></span>))
            }
          }
        }
        <span class="typed"><span class="type">(List[Flatten.this.global.Type],Flatten.this.global.Scope,Flatten.this.global.Symbol)Flatten.this.global.ClassInfoType</span><a href="../symtab/Types.scala.html#43446">ClassInfoType</a></span>(<span class="typed"><span class="type">List[Flatten.this.global.Type]</span><a href="#99622">parents1</a></span>, <span class="typed"><span class="type">Flatten.this.global.Scope</span><a href="#99623">decls1</a></span>, <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99621">clazz</a></span>)
      <span class="typed"><span class="type">Flatten.this.global.Type</span><span class="keyword">case</span></span> <a id="1">PolyType</a>(<span class="typed"><span class="type">List[Flatten.this.global.Symbol]</span><a id="99640">tparams</a></span>, <span class="typed"><span class="type">Flatten.this.global.Type</span><a id="99641">restp</a></span>) =&gt;
        <span class="keyword">val</span> <span class="typed"><span class="type">Flatten.this.global.Type</span><a id="99642">restp1</a></span> = <span class="typed"><span class="type">(Flatten.this.global.Type)Flatten.this.global.Type</span><a href="#99612">apply</a></span>(<span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99641">restp</a></span>);
        <span class="typed"><span class="type">Flatten.this.global.Type</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99642">restp1</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5794">eq</a></span> <span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99641">restp</a></span>) <span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99614">tp</a></span> <span class="keyword">else</span> <span class="typed"><span class="type">(List[Flatten.this.global.Symbol],Flatten.this.global.Type)Flatten.this.global.PolyType</span><a href="../symtab/Types.scala.html#43484">PolyType</a></span>(<span class="typed"><span class="type">List[Flatten.this.global.Symbol]</span><a href="#99640">tparams</a></span>, <span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99642">restp1</a></span>)
      <span class="typed"><span class="type">Flatten.this.global.Type</span><span class="keyword">case</span></span> _ =&gt;
        <span class="typed"><span class="type">(Flatten.this.global.Type)Flatten.this.global.Type</span><a href="../symtab/Types.scala.html#27743">mapOver</a></span>(<span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99614">tp</a></span>)
    }
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(Flatten.this.global.Symbol,Flatten.this.global.Type)Flatten.this.global.Type</span><a id="82839">transformInfo</a></span>(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a id="99681">sym</a></span>: <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span>, <span class="typed"><span class="type">Flatten.this.global.Type</span><a id="99682">tp</a></span>: <span class="typed"><span class="type">Flatten.this.global.Type</span><a href="../symtab/Types.scala.html#21944">Type</a></span>): <span class="typed"><span class="type">Flatten.this.global.Type</span><a href="../symtab/Types.scala.html#21944">Type</a></span> = <span class="typed"><span class="type">(Flatten.this.global.Type)Flatten.this.global.Type</span><a href="#82837" id="21757">flattened</a></span>(<span class="typed"><span class="type">Flatten.this.global.Type</span><a href="#99682">tp</a></span>)

  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Flatten.this.global.CompilationUnit)Flatten.this.global.Transformer</span><a id="82840">newTransformer</a></span>(<span class="typed"><span class="type">Flatten.this.global.CompilationUnit</span><a id="99683">unit</a></span>: <span class="typed"><span class="type">Flatten.this.global.CompilationUnit</span><a href="../CompilationUnits.scala.html#22571">CompilationUnit</a></span>): <span class="typed"><span class="type">Flatten.this.global.Transformer</span><a href="../ast/Trees.scala.html#22548">Transformer</a></span> = <span class="typed"><span class="type">Flatten.this.Flattener</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Flatten.this.Flattener</span><a href="#82841">Flattener</a></span>

  <span class="keyword">class</span> <span class="typed"><span class="type">class Flattener extends Flatten.this.global.Transformer with ScalaObject</span><a id="82841">Flattener</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">Flatten.this.global.Transformer</span><a href="../ast/Trees.scala.html#22548">Transformer</a></span> {

    <span class="comment">/** Buffers for lifted out classes */</span> 
    <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[Flatten.this.global.Symbol,scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]]</span><span id="99686"><a id="99685">liftedDefs</a></span></span> = <span class="typed"><span class="type">scala.collection.mutable.HashMap[Flatten.this.global.Symbol,scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[Flatten.this.global.Symbol,scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]]</span><a id="20081">HashMap</a></span>[Symbol, ListBuffer[Tree]]

    <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Flatten.this.global.Tree)Flatten.this.global.Tree</span><a id="99687">transform</a></span>(<span class="typed"><span class="type">Flatten.this.global.Tree</span><a id="99691">tree</a></span>: <span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> = {
      <span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99691">tree</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">PackageDef</a>(_, _) =&gt;
          <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[Flatten.this.global.Symbol,scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]]</span><a href="#99685">liftedDefs</a></span>(<span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99691">tree</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../ast/Trees.scala.html#25358">symbol</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25283">moduleClass</a></span>) = <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]</span><a id="19925">ListBuffer</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Template</a>(_, _, _) <span class="keyword">if</span> (<span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99691">tree</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../ast/Trees.scala.html#25358">symbol</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>.<span class="typed"><span class="type">(Long)Boolean</span><a href="../symtab/Symbols.scala.html#25223">hasFlag</a></span>(<span class="typed"><span class="type">Long(16384L)</span><span >PACKAGE</span></span>)) =&gt;
          <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[Flatten.this.global.Symbol,scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]]</span><a href="#99685">liftedDefs</a></span>(<span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99691">tree</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../ast/Trees.scala.html#25358">symbol</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>) = <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]</span><a id="19925">ListBuffer</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _ =&gt;
      }
      <span class="typed"><span class="type">(Flatten.this.global.Tree)Flatten.this.global.Tree</span><a href="#99688">postTransform</a></span>(<span class="keyword">super</span>.<span class="typed"><span class="type">(Flatten.this.global.Tree)Flatten.this.global.Tree</span><a href="../ast/Trees.scala.html#43096">transform</a></span>(<span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99691">tree</a></span>))
    }

    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Flatten.this.global.Tree)Flatten.this.global.Tree</span><a id="99688">postTransform</a></span>(<span class="typed"><span class="type">Flatten.this.global.Tree</span><a id="99696">tree</a></span>: <span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a id="99698">sym</a></span> = <span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99696">tree</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../ast/Trees.scala.html#25358">symbol</a></span>
      <span class="keyword">val</span> <span class="typed"><span class="type">Flatten.this.global.gen.global.Tree</span><a id="99699">tree1</a></span> = <span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99696">tree</a></span> <span class="typed"><span class="type">Flatten.this.global.gen.global.Tree</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">Flatten.this.global.EmptyTree.type</span><span class="keyword">case</span></span> <a id="1">ClassDef</a>(_, _, _, _) <span class="keyword">if</span> <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99698">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25201">isNestedClass</a></span> =&gt;
          <span class="typed"><span class="type">(Flatten.this.global.Symbol)scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]</span><a href="#99685" id="24239">liftedDefs</a></span>(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99698">sym</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25275">toplevelClass</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>) <span class="typed"><span class="type">(Flatten.this.global.Tree)Unit</span><a id="33306">+=</a></span> <span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99696">tree</a></span>
          <span class="typed"><span class="type">object Flatten.this.global.EmptyTree</span><a href="../ast/Trees.scala.html#22380">EmptyTree</a></span>
        <span class="typed"><span class="type">Flatten.this.global.gen.global.Tree</span><span class="keyword">case</span></span> <a id="1">Select</a>(<span class="typed"><span class="type">Flatten.this.global.Tree</span><a id="99706">qual</a></span>, <span class="typed"><span class="type">Flatten.this.global.Name</span><a id="99707">name</a></span>) <span class="keyword">if</span> (<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99698">sym</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25150">isStaticModule</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99698">sym</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25167">isPackageClass</a></span>) =&gt;
          <span class="typed"><span class="type">(scala.tools.nsc.Phase)(=&gt; Flatten.this.global.gen.global.Tree)Flatten.this.global.gen.global.Tree</span><a href="../symtab/SymbolTable.scala.html#21147">atPhase</a></span>(<span class="typed"><span class="type">=&gt; scala.tools.nsc.Phase</span><a href="../symtab/SymbolTable.scala.html#21138">phase</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Phase</span><a href="../Phase.scala.html#27787">next</a></span>) {
            <span class="typed"><span class="type">(scala.tools.nsc.util.Position)(Flatten.this.global.gen.global.Tree)Flatten.this.global.gen.global.Tree</span><a href="../ast/Trees.scala.html#28572">atPos</a></span>(<span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99696">tree</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.Position</span><a href="../ast/Trees.scala.html#25352">pos</a></span>) {
              <span class="typed"><span class="type">object Flatten.this.global.gen</span><a href="../Global.scala.html#21170">gen</a></span>.<span class="typed"><span class="type">(Flatten.this.global.gen.global.Symbol)Flatten.this.global.gen.global.Tree</span><a href="../ast/TreeGen.scala.html#27604">mkAttributedRef</a></span>(<span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99698">sym</a></span>)
            }
          }
        <span class="typed"><span class="type">Flatten.this.global.Tree</span><span class="keyword">case</span></span> _ =&gt;
          <span class="typed"><span class="type">Flatten.this.global.Tree</span><a href="#99696">tree</a></span>
      }
      <span class="typed"><span class="type">Flatten.this.global.gen.global.Tree</span><a href="#99699">tree1</a></span> <span class="typed"><span class="type">(Flatten.this.global.gen.global.Type)tree1.type</span><a href="../ast/Trees.scala.html#25357">setType</a></span> <span class="typed"><span class="type">(Flatten.this.global.Type)Flatten.this.global.Type</span><a href="#82837" id="21757">flattened</a></span>(<span class="typed"><span class="type">Flatten.this.global.gen.global.Tree</span><a href="#99699">tree1</a></span>.<span class="typed"><span class="type">=&gt; Flatten.this.global.gen.global.Type</span><a href="../ast/Trees.scala.html#25354">tpe</a></span>)
    }

    <span class="comment">/** Transform statements and add lifted definitions to them. */</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(List[Flatten.this.global.Tree],Flatten.this.global.Symbol)List[Flatten.this.global.Tree]</span><a id="99689">transformStats</a></span>(<span class="typed"><span class="type">List[Flatten.this.global.Tree]</span><a id="99713">stats</a></span>: <span class="typed"><span class="type">List[Flatten.this.global.Tree]</span><a id="526">List</a></span>[Tree], <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a id="99714">exprOwner</a></span>: <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span>): <span class="typed"><span class="type">List[Flatten.this.global.Tree]</span><a id="526">List</a></span>[Tree] = {
      <span class="keyword">val</span> <span class="typed"><span class="type">List[Flatten.this.global.Tree]</span><a id="99715">stats1</a></span> = <span class="keyword">super</span>.<span class="typed"><span class="type">(List[Flatten.this.global.Tree],Flatten.this.global.Symbol)List[Flatten.this.global.Tree]</span><a href="../ast/Trees.scala.html#43105">transformStats</a></span>(<span class="typed"><span class="type">List[Flatten.this.global.Tree]</span><a href="#99713">stats</a></span>, <span class="typed"><span class="type">Flatten.this.global.Symbol</span><a href="#99714">exprOwner</a></span>)
      <span class="typed"><span class="type">List[Flatten.this.global.Tree]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../ast/Trees.scala.html#43090">currentOwner</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25167">isPackageClass</a></span>) <span class="typed"><span class="type">List[Flatten.this.global.Tree]</span><a href="#99715">stats1</a></span> <span class="typed"><span class="type">(List[Flatten.this.global.Tree])List[Flatten.this.global.Tree]</span><a href="#99717" id="21339">:::</a></span> <span class="typed"><span class="type">(Flatten.this.global.Symbol)scala.collection.mutable.ListBuffer[Flatten.this.global.Tree]</span><a href="#99685" id="24239">liftedDefs</a></span>(<span class="typed"><span class="type">=&gt; Flatten.this.global.Symbol</span><a href="../ast/Trees.scala.html#43090">currentOwner</a></span>).<span class="typed"><span class="type">=&gt; List[Flatten.this.global.Tree]</span><a id="33309">toList</a></span>
      <span class="keyword">else</span> <span class="typed"><span class="type">List[Flatten.this.global.Tree]</span><a href="#99715">stats1</a></span>
    }
  }
}

        </pre>
    </body>
</html>