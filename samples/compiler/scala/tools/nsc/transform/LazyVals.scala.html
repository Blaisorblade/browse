<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/transform/LazyVals.scala</title>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="keyword">package</span> scala.tools.nsc.transform;

<span class="keyword">import</span> scala.tools.nsc._
<span class="keyword">import</span> scala.collection.mutable.HashMap

<span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class LazyVals extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.Transform with ScalaObject</span><a id="12847">LazyVals</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.transform.Transform</span><a href="Transform.scala.html#13183">Transform</a></span> {
  <span class="comment">// inherits abstract value `global' and class `Phase' from Transform</span>

  <span class="keyword">import</span> global._                  <span class="comment">// the global environment</span>
  <span class="keyword">import</span> definitions._             <span class="comment">// standard classes and methods</span>
  <span class="keyword">import</span> typer.{typed, atOwner}    <span class="comment">// methods to type trees</span>
  <span class="keyword">import</span> posAssigner.atPos         <span class="comment">// for filling in tree positions </span>

  <span class="keyword">val</span> <span class="typed"><span class="type">String</span><span id="82737"><a id="82736">phaseName</a></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;lazyvals&quot;)</span><span class="string">&quot;lazyvals&quot;</span></span>

  <span class="keyword">def</span> <span class="typed"><span class="type">(LazyVals.this.global.CompilationUnit)LazyVals.this.global.Transformer</span><a id="82738">newTransformer</a></span>(<span class="typed"><span class="type">LazyVals.this.global.CompilationUnit</span><a id="128770">unit</a></span>: <span class="typed"><span class="type">LazyVals.this.global.CompilationUnit</span><a href="../CompilationUnits.scala.html#22571">CompilationUnit</a></span>): <span class="typed"><span class="type">LazyVals.this.global.Transformer</span><a href="../ast/Trees.scala.html#22548">Transformer</a></span> =
    <span class="typed"><span class="type">LazyVals.this.LazyValues</span><span class="keyword">new</span></span> <span class="typed"><span class="type">LazyVals.this.LazyValues</span><a href="#82741">LazyValues</a></span>(<span class="typed"><span class="type">LazyVals.this.global.CompilationUnit</span><a href="#128770">unit</a></span>)

  <span class="comment">/** Create a new phase which applies transformer */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.Phase)LazyVals.this.StdPhase</span><a id="82739">newPhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="128789">prev</a></span>: scala.tools.nsc.<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a href="../Phase.scala.html#6873">Phase</a></span>): <span class="typed"><span class="type">LazyVals.this.StdPhase</span><a href="../SubComponent.scala.html#29468">StdPhase</a></span> = <span class="typed"><span class="type">LazyVals.this.Phase</span><span class="keyword">new</span></span> <span class="typed"><span class="type">LazyVals.this.Phase</span><a href="#82740">Phase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a href="#128789">prev</a></span>)

  <span class="comment">/** The phase defined by this transform */</span>
  <span class="keyword">class</span> <span class="typed"><span class="type">class Phase extends LazyVals.this.StdPhase with ScalaObject</span><a id="82740">Phase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><span id="128791"><a id="128794">prev</a></span></span>: scala.tools.nsc.<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a href="../Phase.scala.html#6873">Phase</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">LazyVals.this.StdPhase</span><a href="../SubComponent.scala.html#29468">StdPhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a href="#128794">prev</a></span>) {
    <span class="keyword">def</span> <span class="typed"><span class="type">(LazyVals.this.global.CompilationUnit)Unit</span><a id="128793">apply</a></span>(<span class="typed"><span class="type">LazyVals.this.global.CompilationUnit</span><a id="128797">unit</a></span>: global.<span class="typed"><span class="type">LazyVals.this.global.CompilationUnit</span><a href="../CompilationUnits.scala.html#22571">CompilationUnit</a></span>): <span class="typed"><span class="type">Unit</span><a id="2169">Unit</a></span> =
        <span class="typed"><span class="type">(LazyVals.this.global.CompilationUnit)LazyVals.this.global.Transformer</span><a href="#82738">newTransformer</a></span>(<span class="typed"><span class="type">LazyVals.this.global.CompilationUnit</span><a href="#128797">unit</a></span>).<span class="typed"><span class="type">(LazyVals.this.global.CompilationUnit)Unit</span><a href="../ast/Trees.scala.html#43106">transformUnit</a></span>(<span class="typed"><span class="type">LazyVals.this.global.CompilationUnit</span><a href="#128797">unit</a></span>);
  }

  <span class="comment">/**
   * Transform local lazy accessors to check for the initialized bit.
   */</span>
  <span class="keyword">class</span> <span class="typed"><span class="type">class LazyValues extends LazyVals.this.global.Transformer with ScalaObject</span><a id="82741">LazyValues</a></span>(<span class="typed"><span class="type">LazyVals.this.global.CompilationUnit</span><span id="128772"><a id="128788">unit</a></span></span>: <span class="typed"><span class="type">LazyVals.this.global.CompilationUnit</span><a href="../CompilationUnits.scala.html#22571">CompilationUnit</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">LazyVals.this.global.Transformer</span><a href="../ast/Trees.scala.html#22548">Transformer</a></span> {
    
    <span class="keyword">import</span> definitions.{Int_And, Int_Or, Int_==}    
    <span class="comment">/** map from method symbols to the number of lazy values it defines. */</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]</span><span id="128776"><a id="128775">lazyVals</a></span></span> = <span class="typed"><span class="type">template $anon extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]</span><a id="128800" class="keyword">new</a></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]</span><a id="20081">HashMap</a></span>[Symbol, Int] {
      <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(LazyVals.this.global.Symbol)Int</span><a id="128802">default</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128804">meth</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span>) = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
    }
    
    <span class="keyword">import</span> symtab.Flags._
    <span class="keyword">import</span> lazyVals._

    <span class="comment">/** Perform the following transformations:
     *  - for a lazy accessor inside a method, make it check the initialization bitmap
     *  - for all methods, add enough int vars to allow one flag per lazy local value
     *  - blocks in template bodies behave almost like methods. A single bitmaps section is
     *      added in the first block, for all lazy values defined in such blocks.
     *  - remove ACCESSOR flags: accessors in traits are not statically implemented,  
     *    but moved to the host class. local lazy values should be statically implemented.
     */</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a id="128779">transform</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128820">tree</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128821">sym</a></span> = <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128820">tree</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../ast/Trees.scala.html#25358">symbol</a></span>
      <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128820">tree</a></span> <span class="typed"><span class="type">LazyVals.this.global.Tree</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">LazyVals.this.global.DefDef</span><span class="keyword">case</span></span> <a id="1">DefDef</a>(<span class="typed"><span class="type">LazyVals.this.global.Modifiers</span><a id="128823">mods</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Name</span><a id="128824">name</a></span>, <span class="typed"><span class="type">List[LazyVals.this.global.TypeDef]</span><a id="128825">tparams</a></span>, <span class="typed"><span class="type">List[List[LazyVals.this.global.ValDef]]</span><a id="128826">vparams</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128827">tpt</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128828">rhs</a></span>) =&gt;
          <span class="keyword">val</span> <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128829">res</a></span> = <span class="typed"><span class="type">LazyVals.this.global.Tree</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128821">sym</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/Symbols.scala.html#25129">isClass</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128821">sym</a></span>.<span class="typed"><span class="type">(Long)Boolean</span><a href="../symtab/Symbols.scala.html#25223">hasFlag</a></span>(<span class="typed"><span class="type">Long(2147483648L)</span><span >LAZY</span></span>)) {
            <span class="keyword">val</span> <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128830">enclosingDummyOrMethod</a></span> = 
              <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128821">sym</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25258">enclMethod</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">object LazyVals.this.global.NoSymbol</span><a href="../symtab/Symbols.scala.html#21873">NoSymbol</a></span>) <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128821">sym</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span> <span class="keyword">else</span> <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128821">sym</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25258">enclMethod</a></span>
            <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="128831">idx</a></span> = <span class="typed"><span class="type">(LazyVals.this.global.Symbol)Int</span><a href="#128775" id="24239">lazyVals</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128830">enclosingDummyOrMethod</a></span>)
            <span class="keyword">val</span> <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128832">rhs1</a></span> = <span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree,Int)LazyVals.this.global.Tree</span><a href="#128781">mkLazyDef</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128830">enclosingDummyOrMethod</a></span>, <span class="keyword">super</span>.<span class="typed"><span class="type">(LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#43096">transform</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128828">rhs</a></span>), <span class="typed"><span class="type">Int</span><a href="#128831">idx</a></span>)
            <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]</span><a href="#128775">lazyVals</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128821">sym</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#25211">owner</a></span>) = <span class="typed"><span class="type">Int</span><a href="#128831">idx</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
            <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128821">sym</a></span>.<span class="typed"><span class="type">(Long)sym.type</span><a href="../symtab/Symbols.scala.html#25221">resetFlag</a></span>(LAZY <span class="typed"><span class="type">Long(2281701376L)</span><span >|</span></span> ACCESSOR) 
            <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128832">rhs1</a></span>
          } <span class="keyword">else</span>
            <span class="keyword">super</span>.<span class="typed"><span class="type">(LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#43096">transform</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128828">rhs</a></span>)
          <span class="typed"><span class="type">=&gt; LazyVals.this.global.TreeCopier</span><a href="../ast/Trees.scala.html#43088">copy</a></span>.<span class="typed"><span class="type">(LazyVals.this.global.Tree,LazyVals.this.global.Modifiers,LazyVals.this.global.Name,List[LazyVals.this.global.TypeDef],List[List[LazyVals.this.global.ValDef]],LazyVals.this.global.Tree,LazyVals.this.global.Tree)LazyVals.this.global.DefDef</span><a href="../ast/Trees.scala.html#43160">DefDef</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128820">tree</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Modifiers</span><a href="#128823">mods</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Name</span><a href="#128824">name</a></span>, <span class="typed"><span class="type">List[LazyVals.this.global.TypeDef]</span><a href="#128825">tparams</a></span>, <span class="typed"><span class="type">List[List[LazyVals.this.global.ValDef]]</span><a href="#128826">vparams</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128827">tpt</a></span>, 
                      <span class="typed"><span class="type">(LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree</span><a href="../typechecker/Typers.scala.html#31830">typed</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a href="#128780">addBitmapDefs</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128821">sym</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128829">res</a></span>)))

        <span class="typed"><span class="type">LazyVals.this.global.Template</span><span class="keyword">case</span></span> <a id="1">Template</a>(<span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a id="128869">parents</a></span>, <span class="typed"><span class="type">LazyVals.this.global.ValDef</span><a id="128870">self</a></span>, <span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a id="128871">body</a></span>) =&gt;
          <span class="keyword">val</span> <span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a id="128872">body1</a></span> = <span class="keyword">super</span>.<span class="typed"><span class="type">(List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]</span><a href="../ast/Trees.scala.html#43097">transformTrees</a></span>(<span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a href="#128871">body</a></span>)
          <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><a id="128873">added</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
          <span class="keyword">val</span> <span class="typed"><span class="type">List[LazyVals.this.global.analyzer.global.Tree]</span><a id="128874">stats</a></span> = 
            <span class="keyword">for</span> (<span class="typed"><span class="type">((LazyVals.this.global.Tree) =&gt; LazyVals.this.global.analyzer.global.Tree)List[LazyVals.this.global.analyzer.global.Tree]</span><span id="21362"><a id="128878">stat</a></span></span> &lt;- <span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a href="#128872">body1</a></span>) <span class="keyword">yield</span> <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128878">stat</a></span> <span class="typed"><span class="type">LazyVals.this.global.analyzer.global.Tree</span><span class="keyword">match</span></span> {
              <span class="typed"><span class="type">LazyVals.this.global.analyzer.global.Tree</span><span class="keyword">case</span></span> <a id="1">Block</a>(_, _) <span class="keyword">if</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">Boolean</span><a href="#128873">added</a></span> =&gt; 
                <span class="typed"><span class="type">Boolean</span><a href="#128873">added</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
                <span class="typed"><span class="type">(LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree</span><a href="../typechecker/Typers.scala.html#31830">typed</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a href="#128780">addBitmapDefs</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128821">sym</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128878">stat</a></span>))
              <span class="typed"><span class="type">LazyVals.this.global.analyzer.global.Tree</span><span class="keyword">case</span></span> <a id="1">ValDef</a>(<span class="typed"><span class="type">LazyVals.this.global.Modifiers</span><a id="128881">mods</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Name</span><a id="128882">name</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128883">tpt</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128884">rhs</a></span>) =&gt;
                <span class="typed"><span class="type">(LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree</span><a href="../typechecker/Typers.scala.html#31830">typed</a></span>(<span class="typed"><span class="type">=&gt; LazyVals.this.global.TreeCopier</span><a href="../ast/Trees.scala.html#43088">copy</a></span>.<span class="typed"><span class="type">(LazyVals.this.global.Tree,LazyVals.this.global.Modifiers,LazyVals.this.global.Name,LazyVals.this.global.Tree,LazyVals.this.global.Tree)LazyVals.this.global.ValDef</span><a href="../ast/Trees.scala.html#43159">ValDef</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128878">stat</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Modifiers</span><a href="#128881">mods</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Name</span><a href="#128882">name</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128883">tpt</a></span>, <span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a href="#128780">addBitmapDefs</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128878">stat</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../ast/Trees.scala.html#25358">symbol</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128884">rhs</a></span>)))
              <span class="typed"><span class="type">LazyVals.this.global.Tree</span><span class="keyword">case</span></span> _ =&gt; 
                <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128878">stat</a></span>
            }
          <span class="typed"><span class="type">=&gt; LazyVals.this.global.TreeCopier</span><a href="../ast/Trees.scala.html#43088">copy</a></span>.<span class="typed"><span class="type">(LazyVals.this.global.Tree,List[LazyVals.this.global.Tree],LazyVals.this.global.ValDef,List[LazyVals.this.global.Tree])LazyVals.this.global.Template</span><a href="../ast/Trees.scala.html#43166">Template</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128820">tree</a></span>, <span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a href="#128869">parents</a></span>, <span class="typed"><span class="type">LazyVals.this.global.ValDef</span><a href="#128870">self</a></span>, <span class="typed"><span class="type">List[LazyVals.this.global.analyzer.global.Tree]</span><a href="#128874">stats</a></span>)
          
        <span class="typed"><span class="type">LazyVals.this.global.Tree</span><span class="keyword">case</span></span> _ =&gt; <span class="keyword">super</span>.<span class="typed"><span class="type">(LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#43096">transform</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128820">tree</a></span>)
      }
    }

    <span class="comment">/** Add the bitmap definitions to the rhs of a method definition.
     *  If the rhs has been tail-call transformed, insert the bitmap
     *  definitions inside the top-level label definition, so that each
     *  iteration has the lazy values un-initialized. Otherwise add them
     *  at the very beginning of the method.
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a id="128780">addBitmapDefs</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128866">methSym</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128867">rhs</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> = {
      <span class="keyword">def</span> <span class="typed"><span class="type">(List[LazyVals.this.global.Tree],LazyVals.this.global.Tree)LazyVals.this.global.Block</span><a id="128887">prependStats</a></span>(<span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a id="128889">stats</a></span>: <span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a id="526">List</a></span>[Tree], <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128890">tree</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">LazyVals.this.global.Block</span><a href="../ast/Trees.scala.html#22434">Block</a></span> = <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128890">tree</a></span> <span class="typed"><span class="type">LazyVals.this.global.Block</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">LazyVals.this.global.Block</span><span class="keyword">case</span></span> <a id="1">Block</a>(<span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a id="128891">stats1</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128892">res</a></span>) =&gt; <span class="typed"><span class="type">(List[LazyVals.this.global.Tree],LazyVals.this.global.Tree)LazyVals.this.global.Block</span><a href="../ast/Trees.scala.html#42662">Block</a></span>(<span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a href="#128889">stats</a></span> <span class="typed"><span class="type">(List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]</span><a href="#128893" id="21339">:::</a></span> <span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a href="#128891">stats1</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128892">res</a></span>)
        <span class="typed"><span class="type">LazyVals.this.global.Block</span><span class="keyword">case</span></span> _ =&gt; <span class="typed"><span class="type">(List[LazyVals.this.global.Tree],LazyVals.this.global.Tree)LazyVals.this.global.Block</span><a href="../ast/Trees.scala.html#42662">Block</a></span>(<span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a href="#128889">stats</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128890">tree</a></span>)
      }

      <span class="keyword">val</span> <span class="typed"><span class="type">List[LazyVals.this.global.ValDef]</span><a id="128888">bmps</a></span> = <span class="typed"><span class="type">(LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]</span><a href="#128785" id="24239">bitmaps</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128866">methSym</a></span>) <span class="typed"><span class="type">((LazyVals.this.global.Symbol) =&gt; LazyVals.this.global.ValDef)List[LazyVals.this.global.ValDef]</span><a id="21362">map</a></span> { <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128899">b</a></span> =&gt; <span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree)LazyVals.this.global.ValDef</span><a href="../ast/Trees.scala.html#22401">ValDef</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128899">b</a></span>, <span class="typed"><span class="type">(LazyVals.this.global.Constant)LazyVals.this.global.Literal</span><a href="../ast/Trees.scala.html#43688">Literal</a></span>(<span class="typed"><span class="type">(Any)LazyVals.this.global.Constant</span><a href="../symtab/Constants.scala.html#50347">Constant</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>))) }
      <span class="typed"><span class="type">LazyVals.this.global.Tree</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[LazyVals.this.global.ValDef]</span><a href="#128888">bmps</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="21645">isEmpty</a></span>) <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128867">rhs</a></span> <span class="keyword">else</span> <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128867">rhs</a></span> <span class="typed"><span class="type">LazyVals.this.global.Tree</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">LazyVals.this.global.Block</span><span class="keyword">case</span></span> <a id="1">Block</a>(<span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a id="128906">assign</a></span>, <span class="typed"><span class="type">LazyVals.this.global.LabelDef</span><a id="128907">l</a></span> @ <a id="1">LabelDef</a>(<span class="typed"><span class="type">LazyVals.this.global.Name</span><a id="128909">name</a></span>, <span class="typed"><span class="type">List[LazyVals.this.global.Ident]</span><a id="128910">params</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128911">rhs1</a></span>))
          <span class="keyword">if</span> (<span class="typed"><span class="type">LazyVals.this.global.Name</span><a href="#128909">name</a></span>.<span class="typed"><span class="type">()String</span><a href="../symtab/Names.scala.html#23898">toString</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="5832">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;_&quot;)</span><span class="string">&quot;_&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128866">methSym</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Name</span><a href="../symtab/Symbols.scala.html#25215">name</a></span>)
              <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">object List</span><a id="527">List</a></span>.<span class="typed"><span class="type">(List[LazyVals.this.global.Ident],List[LazyVals.this.global.Type])((LazyVals.this.global.Ident, LazyVals.this.global.Type) =&gt; Boolean)Boolean</span><a id="21458">forall2</a></span>(<span class="typed"><span class="type">List[LazyVals.this.global.Ident]</span><a href="#128910">params</a></span>.<span class="typed"><span class="type">=&gt; List[LazyVals.this.global.Ident]</span><a id="21334">tail</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128866">methSym</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Type</span><a href="../symtab/Symbols.scala.html#25230">tpe</a></span>.<span class="typed"><span class="type">=&gt; List[LazyVals.this.global.Type]</span><a href="../symtab/Types.scala.html#25668">paramTypes</a></span>) { (<span class="typed"><span class="type">LazyVals.this.global.Ident</span><a id="128916">ident</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Type</span><a id="128917">tpe</a></span>) =&gt; <span class="typed"><span class="type">LazyVals.this.global.Ident</span><a href="#128916">ident</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Type</span><a href="../ast/Trees.scala.html#25354">tpe</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">LazyVals.this.global.Type</span><a href="#128917">tpe</a></span> }) =&gt;
            <span class="keyword">val</span> <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128920">sym</a></span> = <span class="typed"><span class="type">LazyVals.this.global.LabelDef</span><a href="#128907">l</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../ast/Trees.scala.html#26908">symbol</a></span>
            <span class="typed"><span class="type">(List[LazyVals.this.global.Tree],LazyVals.this.global.Tree)LazyVals.this.global.Block</span><a href="../ast/Trees.scala.html#42662">Block</a></span>(<span class="typed"><span class="type">List[LazyVals.this.global.Tree]</span><a href="#128906">assign</a></span>, <span class="typed"><span class="type">=&gt; LazyVals.this.global.TreeCopier</span><a href="../ast/Trees.scala.html#43088">copy</a></span>.<span class="typed"><span class="type">(LazyVals.this.global.Tree,LazyVals.this.global.Name,List[LazyVals.this.global.Ident],LazyVals.this.global.Tree)LazyVals.this.global.LabelDef</span><a href="../ast/Trees.scala.html#43162">LabelDef</a></span>(<span class="typed"><span class="type">LazyVals.this.global.LabelDef</span><a href="#128907">l</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Name</span><a href="#128909">name</a></span>, <span class="typed"><span class="type">List[LazyVals.this.global.Ident]</span><a href="#128910">params</a></span>, <span class="typed"><span class="type">(LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree</span><a href="../typechecker/Typers.scala.html#31830">typed</a></span>(<span class="typed"><span class="type">(List[LazyVals.this.global.Tree],LazyVals.this.global.Tree)LazyVals.this.global.Block</span><a href="#128887">prependStats</a></span>(<span class="typed"><span class="type">List[LazyVals.this.global.ValDef]</span><a href="#128888">bmps</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128911">rhs1</a></span>))))

        <span class="typed"><span class="type">LazyVals.this.global.Block</span><span class="keyword">case</span></span> _ =&gt; <span class="typed"><span class="type">(List[LazyVals.this.global.Tree],LazyVals.this.global.Tree)LazyVals.this.global.Block</span><a href="#128887">prependStats</a></span>(<span class="typed"><span class="type">List[LazyVals.this.global.ValDef]</span><a href="#128888">bmps</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128867">rhs</a></span>)
      }
    }
    
    <span class="comment">/** return a 'lazified' version of rhs. Rhs should conform to the
     *  following schema:
     *  {
     *    l$ = &lt;rhs&gt; 
     *    l$
     *  } or
     *  &lt;rhs&gt; when the lazy value has type Unit (for which there is no field
     *  to cache it's value.
     * 
     *  The result will be a tree of the form
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       l$ = &lt;rhs&gt;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    l$
     *  }
     *  where bitmap$n is an int value acting as a bitmap of initialized values. It is
     *  the 'n' is (offset / 32), the MASK is (1 &lt;&lt; (offset % 32)). If the value has type
     *  unit, no field is used to chache the value, so the resulting code is:
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       &lt;rhs&gt;;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    ()
     *  }
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree,Int)LazyVals.this.global.Tree</span><a id="128781">mkLazyDef</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128838">meth</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128839">tree</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>, <span class="typed"><span class="type">Int</span><a id="128840">offset</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>): <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128922">bitmapSym</a></span> = <span class="typed"><span class="type">(LazyVals.this.global.Symbol,Int)LazyVals.this.global.Symbol</span><a href="#128787">getBitmapFor</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128838">meth</a></span>, <span class="typed"><span class="type">Int</span><a href="#128840">offset</a></span>)
      <span class="keyword">val</span> <span class="typed"><span class="type">LazyVals.this.global.Literal</span><a id="128923">mask</a></span> = <span class="typed"><span class="type">(LazyVals.this.global.Constant)LazyVals.this.global.Literal</span><a href="../ast/Trees.scala.html#43688">Literal</a></span>(<span class="typed"><span class="type">(Any)LazyVals.this.global.Constant</span><a href="../symtab/Constants.scala.html#50347">Constant</a></span>(<span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span> <span class="typed"><span class="type">(Int)Int</span><a id="3090">&lt;&lt;</a></span> (<span class="typed"><span class="type">Int</span><a href="#128840">offset</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3151">%</a></span> <span class="typed"><span class="type">Int(32)</span><span >FLAGS_PER_WORD</span></span>)))
      
      <span class="keyword">val</span> <span class="typed"><span class="type">(LazyVals.this.global.Block, LazyVals.this.global.Tree)</span><span id="23625"><a href="#128953" id="1379">(</a></span></span><span class="typed"><span class="type">LazyVals.this.global.Block</span><span id="128953"><span id="128925"><a href="#128924" id="23614">block</a></span></span></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><span id="128954"><span id="128926"><a href="#128924" id="23616">res</a></span></span></span>) = <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128839">tree</a></span> <span class="typed"><span class="type">(LazyVals.this.global.Block, LazyVals.this.global.Tree)</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">(LazyVals.this.global.Block, LazyVals.this.global.Tree)</span><span class="keyword">case</span></span> <a id="1">Block</a>(<span class="typed"><span class="type">(List[LazyVals.this.global.Tree])Some[List[LazyVals.this.global.Tree]]</span><span id="21410"><a href="#128933" id="527">List</a></span></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128936">assignment</a></span>), <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128937">res</a></span>) =&gt;
          <span class="typed"><span class="type">(LazyVals.this.global.Block,LazyVals.this.global.Tree)(LazyVals.this.global.Block, LazyVals.this.global.Tree)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">(List[LazyVals.this.global.Tree],LazyVals.this.global.Tree)LazyVals.this.global.Block</span><a href="../ast/Trees.scala.html#42662">Block</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Tree*)List[LazyVals.this.global.Tree]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128936">assignment</a></span>, <span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a href="#128782">mkSetFlag</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128922">bitmapSym</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Literal</span><a href="#128923">mask</a></span>)), <span class="typed"><span class="type">(LazyVals.this.global.Constant)LazyVals.this.global.Literal</span><a href="../ast/Trees.scala.html#43688">Literal</a></span>(<span class="typed"><span class="type">(Any)LazyVals.this.global.Constant</span><a href="../symtab/Constants.scala.html#50347">Constant</a></span>(<span class="typed"><span class="type">Unit</span><span >(</span></span>)))), <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128937">res</a></span>)
        <span class="typed"><span class="type">(LazyVals.this.global.Block, LazyVals.this.global.Literal)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128944">rhs</a></span> =&gt;
          <span class="typed"><span class="type">(Boolean)Unit</span><span id="6003"><a id="821">assert</a></span></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128838">meth</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Type</span><a href="../symtab/Symbols.scala.html#25230">tpe</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Type</span><a href="../symtab/Types.scala.html#25666">finalResultType</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Types.scala.html#25650">typeSymbol</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">object LazyVals.this.global.definitions</span><a href="../symtab/Definitions.scala.html#22259">definitions</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Definitions.scala.html#25821">UnitClass</a></span>)
          <span class="typed"><span class="type">(LazyVals.this.global.Block,LazyVals.this.global.Literal)(LazyVals.this.global.Block, LazyVals.this.global.Literal)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">(List[LazyVals.this.global.Tree],LazyVals.this.global.Tree)LazyVals.this.global.Block</span><a href="../ast/Trees.scala.html#42662">Block</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Tree*)List[LazyVals.this.global.Tree]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128944">rhs</a></span>, <span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a href="#128782">mkSetFlag</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128922">bitmapSym</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Literal</span><a href="#128923">mask</a></span>)), <span class="typed"><span class="type">(LazyVals.this.global.Constant)LazyVals.this.global.Literal</span><a href="../ast/Trees.scala.html#43688">Literal</a></span>(<span class="typed"><span class="type">(Any)LazyVals.this.global.Constant</span><a href="../symtab/Constants.scala.html#50347">Constant</a></span>(<span class="typed"><span class="type">Unit</span><span >(</span></span>)))), <span class="typed"><span class="type">(Any)LazyVals.this.global.Literal</span><a href="../ast/Trees.scala.html#22518">Literal</a></span>(<span class="typed"><span class="type">Unit</span><span >(</span></span>)))
      }
      
      <span class="keyword">val</span> <span class="typed"><span class="type">LazyVals.this.global.If</span><a id="128927">result</a></span> = <span class="typed"><span class="type">(scala.tools.nsc.util.Position)(LazyVals.this.global.If)LazyVals.this.global.If</span><a href="../ast/Trees.scala.html#28572">atPos</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128839">tree</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.Position</span><a href="../ast/Trees.scala.html#25352">pos</a></span>) {
        <span class="typed"><span class="type">(LazyVals.this.global.Tree,LazyVals.this.global.Tree,LazyVals.this.global.Tree)LazyVals.this.global.If</span><a href="../ast/Trees.scala.html#42677">If</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Tree,List[LazyVals.this.global.Tree])LazyVals.this.global.Apply</span><a href="../ast/Trees.scala.html#31199">Apply</a></span>(
            <span class="typed"><span class="type">(LazyVals.this.global.Tree,LazyVals.this.global.Symbol)LazyVals.this.global.Select</span><a href="../ast/Trees.scala.html#22509">Select</a></span>(
              <span class="typed"><span class="type">(LazyVals.this.global.Tree,List[LazyVals.this.global.Tree])LazyVals.this.global.Apply</span><a href="../ast/Trees.scala.html#31199">Apply</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Tree,LazyVals.this.global.Symbol)LazyVals.this.global.Select</span><a href="../ast/Trees.scala.html#22509">Select</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Symbol)LazyVals.this.global.Ident</span><a href="../ast/Trees.scala.html#22514">Ident</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128922">bitmapSym</a></span>), <span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Definitions.scala.html#25843">Int_And</a></span>), 
                    <span class="typed"><span class="type">(LazyVals.this.global.Literal*)List[LazyVals.this.global.Literal]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">LazyVals.this.global.Literal</span><a href="#128923">mask</a></span>)),
              <span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Definitions.scala.html#25844">Int_==</a></span>),
            <span class="typed"><span class="type">(LazyVals.this.global.Literal*)List[LazyVals.this.global.Literal]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">(LazyVals.this.global.Constant)LazyVals.this.global.Literal</span><a href="../ast/Trees.scala.html#43688">Literal</a></span>(<span class="typed"><span class="type">(Any)LazyVals.this.global.Constant</span><a href="../symtab/Constants.scala.html#50347">Constant</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)))), <span class="typed"><span class="type">LazyVals.this.global.Block</span><a href="#128925">block</a></span>, <span class="typed"><span class="type">object LazyVals.this.global.EmptyTree</span><a href="../ast/Trees.scala.html#22380">EmptyTree</a></span>)
      }
      <span class="typed"><span class="type">(LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree</span><a href="../typechecker/Typers.scala.html#31830">typed</a></span>(<span class="typed"><span class="type">(List[LazyVals.this.global.Tree],LazyVals.this.global.Tree)LazyVals.this.global.Block</span><a href="../ast/Trees.scala.html#42662">Block</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.If*)List[LazyVals.this.global.If]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">LazyVals.this.global.If</span><a href="#128927">result</a></span>), <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128926">res</a></span>))
    }
     
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(LazyVals.this.global.Symbol,LazyVals.this.global.Tree)LazyVals.this.global.Tree</span><a id="128782">mkSetFlag</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128941">bmp</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span>, <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a id="128942">mask</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> = 
      <span class="typed"><span class="type">(LazyVals.this.global.Tree,LazyVals.this.global.Tree)LazyVals.this.global.Assign</span><a href="../ast/Trees.scala.html#42698">Assign</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Symbol)LazyVals.this.global.Ident</span><a href="../ast/Trees.scala.html#22514">Ident</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128941">bmp</a></span>),
        <span class="typed"><span class="type">(LazyVals.this.global.Tree,List[LazyVals.this.global.Tree])LazyVals.this.global.Apply</span><a href="../ast/Trees.scala.html#31199">Apply</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Tree,LazyVals.this.global.Symbol)LazyVals.this.global.Select</span><a href="../ast/Trees.scala.html#22509">Select</a></span>(<span class="typed"><span class="type">(LazyVals.this.global.Symbol)LazyVals.this.global.Ident</span><a href="../ast/Trees.scala.html#22514">Ident</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128941">bmp</a></span>), <span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Definitions.scala.html#25842">Int_Or</a></span>), <span class="typed"><span class="type">(LazyVals.this.global.Tree*)List[LazyVals.this.global.Tree]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">LazyVals.this.global.Tree</span><a href="#128942">mask</a></span>)))
    
    
    <span class="keyword">final</span> <span class="keyword">val</span> <span class="typed"><span class="type">Int(32)</span><span id="128784"><a id="128783">FLAGS_PER_WORD</a></span></span> = <span class="typed"><span class="type">Int(32)</span><span class="int">32</span></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">&lt;refinement&gt; extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]</span><span id="128786"><a id="128785">bitmaps</a></span></span> = <span class="typed"><span class="type">template $anon extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]</span><a id="128810" class="keyword">new</a></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]</span><a id="20081">HashMap</a></span>[Symbol, List[Symbol]] {
      <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(LazyVals.this.global.Symbol)object Nil</span><a id="128812">default</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128814">meth</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span>) = <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>
    }
    
    <span class="comment">/** Return the symbol corresponding of the right bitmap int inside meth,
     *  given offset.
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(LazyVals.this.global.Symbol,Int)LazyVals.this.global.Symbol</span><a id="128787">getBitmapFor</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a id="128928">meth</a></span>: <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span>, <span class="typed"><span class="type">Int</span><a id="128929">offset</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>): <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="../symtab/Symbols.scala.html#21866">Symbol</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="128971">n</a></span> = <span class="typed"><span class="type">Int</span><a href="#128929">offset</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3150">/</a></span> <span class="typed"><span class="type">Int(32)</span><span >FLAGS_PER_WORD</span></span>
      <span class="keyword">val</span> <span class="typed"><span class="type">List[LazyVals.this.global.Symbol]</span><a id="128972">bmps</a></span> = <span class="typed"><span class="type">(LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]</span><a href="#128785" id="24239">bitmaps</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128928">meth</a></span>)
      <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[LazyVals.this.global.Symbol]</span><a href="#128972">bmps</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21345">length</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int</span><a href="#128971">n</a></span>) 
        <span class="typed"><span class="type">(Int)LazyVals.this.global.Symbol</span><a href="#128972" id="21361">bmps</a></span>(<span class="typed"><span class="type">Int</span><a href="#128971">n</a></span>)
      <span class="keyword">else</span> {
        <span class="keyword">val</span> <span class="typed"><span class="type">LazyVals.this.global.TermSymbol</span><a id="128978">sym</a></span> = <span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128928">meth</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.util.Position,LazyVals.this.global.Name)LazyVals.this.global.TermSymbol</span><a href="../symtab/Symbols.scala.html#25099">newVariable</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128928">meth</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.Position</span><a href="../symtab/Symbols.scala.html#25087">pos</a></span>, <span class="typed"><span class="type">object LazyVals.this.global.nme</span><a href="../symtab/StdNames.scala.html#22317">nme</a></span>.<span class="typed"><span class="type">(Int)LazyVals.this.global.Name</span><a href="../symtab/StdNames.scala.html#30582">bitmapName</a></span>(<span class="typed"><span class="type">Int</span><a href="#128971">n</a></span>)).<span class="typed"><span class="type">(LazyVals.this.global.Type)LazyVals.this.global.TermSymbol</span><a href="../symtab/Symbols.scala.html#25232">setInfo</a></span>(<span class="typed"><span class="type">=&gt; LazyVals.this.global.Symbol</span><a href="../symtab/Definitions.scala.html#25839">IntClass</a></span>.<span class="typed"><span class="type">=&gt; LazyVals.this.global.Type</span><a href="../symtab/Symbols.scala.html#25230">tpe</a></span>)
        <span class="typed"><span class="type">=&gt; &lt;refinement&gt; extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]</span><a href="#128785">bitmaps</a></span>(<span class="typed"><span class="type">LazyVals.this.global.Symbol</span><a href="#128928">meth</a></span>) = (<span class="typed"><span class="type">LazyVals.this.global.TermSymbol</span><a href="#128978">sym</a></span> <span class="typed"><span class="type">(LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]</span><a href="#128981" id="21335">::</a></span> <span class="typed"><span class="type">List[LazyVals.this.global.Symbol]</span><a href="#128972">bmps</a></span>).<span class="typed"><span class="type">=&gt; List[LazyVals.this.global.Symbol]</span><a id="21385">reverse</a></span>
        <span class="typed"><span class="type">LazyVals.this.global.TermSymbol</span><a href="#128978">sym</a></span>
      }
    }
  }
}

        </pre>
    </body>
</html>