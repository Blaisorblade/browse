<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/backend/icode/Repository.scala</title>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */</span>

<span class="comment">// $Id: Repository.scala 16884 2009-01-09 16:52:09Z cunei $</span>

<span class="keyword">package</span> scala.tools.nsc.backend.icode

<span class="keyword">import</span> scala.collection._

<span class="comment">/**
 *  @author Iulian Dragos
 */</span>
<span class="keyword">trait</span> <span class="typed"><span class="type">trait Repository extends java.lang.Object with ScalaObject</span><a id="11175">Repository</a></span> {
  <span class="keyword">val</span> <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a id="32495">global</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Global</span><a href="../../Global.scala.html#6489">Global</a></span>
  <span class="keyword">import</span> global._
  <span class="keyword">import</span> icodes._

  <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[Repository.this.global.Symbol,Repository.this.global.icodes.IClass]</span><span id="32499"><a id="32498">loaded</a></span></span>: mutable.<span class="typed"><span class="type">scala.collection.mutable.Map[Repository.this.global.Symbol,Repository.this.global.icodes.IClass]</span><a id="19880">Map</a></span>[Symbol, IClass] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[Repository.this.global.Symbol,Repository.this.global.icodes.IClass]</span><span class="keyword">new</span></span> mutable.<span class="typed"><span class="type">scala.collection.mutable.HashMap[Repository.this.global.Symbol,Repository.this.global.icodes.IClass]</span><a id="20081">HashMap</a></span>

  <span class="comment">/** Is the given class available as icode? */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Repository.this.global.Symbol)Boolean</span><a id="32500">available</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a id="122565">sym</a></span>: <span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="../../symtab/Symbols.scala.html#21866">Symbol</a></span>) = <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[Repository.this.global.icodes.global.Symbol,Repository.this.global.icodes.IClass]</span><a href="ICodes.scala.html#32305">classes</a></span>.<span class="typed"><span class="type">(Repository.this.global.icodes.global.Symbol)Boolean</span><a id="24240">contains</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122565">sym</a></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2750">||</a></span> <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[Repository.this.global.Symbol,Repository.this.global.icodes.IClass]</span><a href="#32498">loaded</a></span>.<span class="typed"><span class="type">(Repository.this.global.Symbol)Boolean</span><a id="24240">contains</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122565">sym</a></span>)

  <span class="comment">/** The icode of the given class, if available */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Repository.this.global.Symbol)Option[Repository.this.global.icodes.IClass]</span><a id="32501">icode</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a id="122567">sym</a></span>: <span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="../../symtab/Symbols.scala.html#21866">Symbol</a></span>): <span class="typed"><span class="type">Option[Repository.this.global.icodes.IClass]</span><a id="934">Option</a></span>[IClass] = 
    <span class="typed"><span class="type">Option[Repository.this.global.icodes.IClass]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[Repository.this.global.icodes.global.Symbol,Repository.this.global.icodes.IClass]</span><a href="ICodes.scala.html#32305">classes</a></span>.<span class="typed"><span class="type">(Repository.this.global.icodes.global.Symbol)Boolean</span><a id="24240">contains</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122567">sym</a></span>)) <span class="typed"><span class="type">(Repository.this.global.icodes.IClass)Some[Repository.this.global.icodes.IClass]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">(Repository.this.global.icodes.global.Symbol)Repository.this.global.icodes.IClass</span><a href="ICodes.scala.html#32305" id="24239">classes</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122567">sym</a></span>))
    <span class="keyword">else</span> <span class="typed"><span class="type">Option[Repository.this.global.icodes.IClass]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[Repository.this.global.Symbol,Repository.this.global.icodes.IClass]</span><a href="#32498">loaded</a></span>.<span class="typed"><span class="type">(Repository.this.global.Symbol)Boolean</span><a id="24240">contains</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122567">sym</a></span>)) <span class="typed"><span class="type">(Repository.this.global.icodes.IClass)Some[Repository.this.global.icodes.IClass]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">(Repository.this.global.Symbol)Repository.this.global.icodes.IClass</span><a href="#32498" id="24239">loaded</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122567">sym</a></span>))
    <span class="keyword">else</span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span>

  <span class="comment">/** The icode of the given class. If not available, it loads
   *  its bytecode.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Repository.this.global.Symbol,Boolean)Repository.this.global.icodes.IClass</span><a id="32502">icode</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a id="122577">sym</a></span>: <span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="../../symtab/Symbols.scala.html#21866">Symbol</a></span>, <span class="typed"><span class="type">Boolean</span><a id="122578">force</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span>): <span class="typed"><span class="type">Repository.this.global.icodes.IClass</span><a href="Members.scala.html#32330">IClass</a></span> = 
    <span class="typed"><span class="type">Repository.this.global.icodes.IClass</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Repository.this.global.Symbol)Boolean</span><a href="#32500">available</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122577">sym</a></span>)) <span class="typed"><span class="type">(Repository.this.global.Symbol)Option[Repository.this.global.icodes.IClass]</span><a href="#32501">icode</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122577">sym</a></span>).<span class="typed"><span class="type">=&gt; Repository.this.global.icodes.IClass</span><a id="25408">get</a></span>
    <span class="keyword">else</span> {
      <span class="typed"><span class="type">(Repository.this.global.Symbol)Unit</span><a href="#32503">load</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122577">sym</a></span>)
      <span class="typed"><span class="type">(Boolean)Unit</span><span id="6003"><a id="821">assert</a></span></span>(<span class="typed"><span class="type">(Repository.this.global.Symbol)Boolean</span><a href="#32500">available</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122577">sym</a></span>))
      <span class="typed"><span class="type">(Repository.this.global.Symbol)Repository.this.global.icodes.IClass</span><a href="#32498" id="24239">loaded</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122577">sym</a></span>)
    }

  <span class="comment">/** Load bytecode for given symbol. */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Repository.this.global.Symbol)Unit</span><a id="32503">load</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a id="122582">sym</a></span>: <span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="../../symtab/Symbols.scala.html#21866">Symbol</a></span>) {
    <span class="keyword">val</span> <span class="typed"><span class="type">(Repository.this.global.icodes.icodeReader.global.icodes.IClass, Repository.this.global.icodes.icodeReader.global.icodes.IClass)</span><span id="23625"><a href="#122591" id="1379">(</a></span></span><span class="typed"><span class="type">Repository.this.global.icodes.icodeReader.global.icodes.IClass</span><span id="122591"><span id="122588"><a href="#122587" id="23614">c1</a></span></span></span>, <span class="typed"><span class="type">Repository.this.global.icodes.icodeReader.global.icodes.IClass</span><span id="122592"><span id="122589"><a href="#122587" id="23616">c2</a></span></span></span>) = <span class="typed"><span class="type">object Repository.this.global.icodes.icodeReader</span><a href="ICodes.scala.html#32318">icodeReader</a></span>.<span class="typed"><span class="type">(Repository.this.global.icodes.icodeReader.global.Symbol)(Repository.this.global.icodes.icodeReader.global.icodes.IClass, Repository.this.global.icodes.icodeReader.global.icodes.IClass)</span><a href="../../symtab/classfile/ICodeReader.scala.html#108244">readClass</a></span>(<span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122582">sym</a></span>)
    
    <span class="typed"><span class="type">(Boolean)Unit</span><span id="6003"><a id="821">assert</a></span></span>(<span class="typed"><span class="type">Repository.this.global.icodes.icodeReader.global.icodes.IClass</span><a href="#122588">c1</a></span>.<span class="typed"><span class="type">=&gt; Repository.this.global.icodes.icodeReader.global.icodes.global.Symbol</span><a href="Members.scala.html#32681">symbol</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122582">sym</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2750">||</a></span> <span class="typed"><span class="type">Repository.this.global.icodes.icodeReader.global.icodes.IClass</span><a href="#122589">c2</a></span>.<span class="typed"><span class="type">=&gt; Repository.this.global.icodes.icodeReader.global.icodes.global.Symbol</span><a href="Members.scala.html#32681">symbol</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">Repository.this.global.Symbol</span><a href="#122582">sym</a></span>)
    <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[Repository.this.global.Symbol,Repository.this.global.icodes.IClass]</span><a href="#32498">loaded</a></span> <span class="typed"><span class="type">((Repository.this.global.Symbol, Repository.this.global.icodes.IClass))Unit</span><a id="24189">+=</a></span> (<span class="typed"><span class="type">Repository.this.global.icodes.icodeReader.global.icodes.IClass</span><a href="#122588">c1</a></span>.<span class="typed"><span class="type">(Repository.this.global.icodes.icodeReader.global.icodes.global.Symbol)ArrowAssoc[Repository.this.global.icodes.icodeReader.global.icodes.global.Symbol]</span><span id="6054"><a href="Members.scala.html#32681" id="821">symbol</a></span></span> <span class="typed"><span class="type">(Repository.this.global.icodes.icodeReader.global.icodes.IClass)(Repository.this.global.icodes.icodeReader.global.icodes.global.Symbol, Repository.this.global.icodes.icodeReader.global.icodes.IClass)</span><a id="6050">-&gt;</a></span> <span class="typed"><span class="type">Repository.this.global.icodes.icodeReader.global.icodes.IClass</span><a href="#122588">c1</a></span>)
    <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[Repository.this.global.Symbol,Repository.this.global.icodes.IClass]</span><a href="#32498">loaded</a></span> <span class="typed"><span class="type">((Repository.this.global.Symbol, Repository.this.global.icodes.IClass))Unit</span><a id="24189">+=</a></span> (<span class="typed"><span class="type">Repository.this.global.icodes.icodeReader.global.icodes.IClass</span><a href="#122589">c2</a></span>.<span class="typed"><span class="type">(Repository.this.global.icodes.icodeReader.global.icodes.global.Symbol)ArrowAssoc[Repository.this.global.icodes.icodeReader.global.icodes.global.Symbol]</span><span id="6054"><a href="Members.scala.html#32681" id="821">symbol</a></span></span> <span class="typed"><span class="type">(Repository.this.global.icodes.icodeReader.global.icodes.IClass)(Repository.this.global.icodes.icodeReader.global.icodes.global.Symbol, Repository.this.global.icodes.icodeReader.global.icodes.IClass)</span><a id="6050">-&gt;</a></span> <span class="typed"><span class="type">Repository.this.global.icodes.icodeReader.global.icodes.IClass</span><a href="#122589">c2</a></span>)
  }
}

        </pre>
    </body>
</html>