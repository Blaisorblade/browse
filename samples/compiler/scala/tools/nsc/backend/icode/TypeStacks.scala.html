<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/backend/icode/TypeStacks.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */

// $Id: TypeStacks.scala 18387 2009-07-24 15:28:37Z odersky $

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend
<span class="keyword">package</span> icode

/** This trait ...
 *
 *  @author  Iulian Dragos
 *  @version 1.0
 */
<span class="keyword">trait</span> <a title="trait TypeStacks extends java.lang.Object with ScalaObject" id="15780">TypeStacks</a> <span title="ScalaObject">{</span> self: ICodes =&gt;
  <span class="keyword">import</span> opcodes._
  <span class="keyword">import</span> global.{Symbol, Type, definitions}

  /* This class simulates the type of the opperand
   * stack of the ICode.
   */
  <span class="keyword">type</span> <a title="List[TypeStacks.this.TypeKind]" id="46189">Rep</a> = <span title="List[TypeStacks.this.TypeKind]">List</span>[TypeKind]

  <span class="keyword">class</span> <a title="class TypeStack extends java.lang.Object with ScalaObject" id="46190">TypeStack</a> <span title="ScalaObject">{</span>
    <span class="keyword">var</span> <a title="TypeStacks.this.Rep" id="60533">types</a>: <span title="TypeStacks.this.Rep">Rep</span> = <a title="object Nil" id="7634">Nil</a>

    <span class="keyword">def</span> <a title="(stack: TypeStacks.this.Rep)TypeStacks.this.TypeStack" id="60535" class="keyword">this</a>(<a title="TypeStacks.this.Rep" id="60560">stack</a>: <span title="TypeStacks.this.Rep">Rep</span>) = <span title="Unit">{</span>
      <a href="#46190" title="TypeStack.this.type" class="keyword">this</a>()
      <a href="#46190" title="TypeStack.this.type" class="keyword">this</a>.<a href="#60533" title="(x$1: TypeStacks.this.Rep)Unit">types</a> = <a href="#60560" title="TypeStacks.this.Rep">stack</a>
    }

    <span class="keyword">def</span> <a title="(that: TypeStacks.this.TypeStack)TypeStacks.this.TypeStack" id="60536" class="keyword">this</a>(<a title="TypeStacks.this.TypeStack" id="60551">that</a>: <a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a>) = <a href="#60535" title="(stack: TypeStacks.this.Rep)TypeStacks.this.TypeStack" class="keyword">this</a>(<a href="#60551" title="TypeStacks.this.TypeStack">that</a>.<a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>)

    <span class="keyword">def</span> <a title="=&gt; Int" id="60537">length</a>: <span title="Int">Int</span> = <a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>.<span title="=&gt; Int">length</span>

    /** Push a type on the type stack. UNITs are ignored. */
    <span class="keyword">def</span> <a title="(t: TypeStacks.this.TypeKind)Unit" id="60538">push</a>(<a title="TypeStacks.this.TypeKind" id="62414">t</a>: <a href="TypeKinds.scala.html#46199" title="TypeStacks.this.TypeKind">TypeKind</a>) =
      <span title="Unit" class="keyword">if</span> (<a href="#62414" title="(x$1: AnyRef)Boolean" id="6540">t</a> != <a href="TypeKinds.scala.html#46201" title="object TypeStacks.this.UNIT">UNIT</a>)
        <a href="#60533" title="(x$1: TypeStacks.this.Rep)Unit">types</a> = <a href="#62414" title="TypeStacks.this.TypeKind">t</a> <a href="#62426" title="TypeStacks.this.TypeKind">::</a> <a href="#60533" title="(x: TypeStacks.this.TypeKind)List[TypeStacks.this.TypeKind]" id="24258">types</a>

    <span class="keyword">def</span> <a title="=&gt; TypeStacks.this.TypeKind" id="60539">head</a>: <a href="TypeKinds.scala.html#46199" title="TypeStacks.this.TypeKind">TypeKind</a> = <a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>.<span title="=&gt; TypeStacks.this.TypeKind">head</span>

    /** Removes the value on top of the stack, and returns it. It assumes
     *  the stack contains at least one element.
     */
    <span class="keyword">def</span> <a title="=&gt; TypeStacks.this.TypeKind" id="60540">pop</a>: <a href="TypeKinds.scala.html#46199" title="TypeStacks.this.TypeKind">TypeKind</a> = {
      <span class="keyword">val</span> <a title="TypeStacks.this.TypeKind" id="702149">t</a> = <a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>.<span title="=&gt; TypeStacks.this.TypeKind">head</span>
      <a href="#60533" title="(x$1: TypeStacks.this.Rep)Unit">types</a> = <a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="=&gt; List[TypeStacks.this.TypeKind]" id="25318">tail</a>
      <a href="#702149" title="TypeStacks.this.TypeKind">t</a>
    }

    /** Return the topmost two values on the stack. It assumes the stack
     *  is large enough. Topmost element first.
     */
    <span class="keyword">def</span> <a title="=&gt; (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="60541">pop2</a>: <a title="(TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="1154">(</a>TypeKind, TypeKind) = <a title="(_1: TypeStacks.this.TypeKind,_2: TypeStacks.this.TypeKind)(TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="1155">(</a><a href="#60540" title="=&gt; TypeStacks.this.TypeKind">pop</a>, <a href="#60540" title="=&gt; TypeStacks.this.TypeKind">pop</a>)

    /** Return the topmost three values on the stack. It assumes the stack
     *  is large enough. Topmost element first.
     */
    <span class="keyword">def</span> <a title="=&gt; (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="60542">pop3</a>: <a title="(TypeStacks.this.TypeKind, TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="395">(</a>TypeKind, TypeKind, TypeKind) = <a title="(_1: TypeStacks.this.TypeKind,_2: TypeStacks.this.TypeKind,_3: TypeStacks.this.TypeKind)(TypeStacks.this.TypeKind, TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="396">(</a><a href="#60540" title="=&gt; TypeStacks.this.TypeKind">pop</a>, <a href="#60540" title="=&gt; TypeStacks.this.TypeKind">pop</a>, <a href="#60540" title="=&gt; TypeStacks.this.TypeKind">pop</a>)

    /** Drop the first n elements of the stack. */
    <span class="keyword">def</span> <a title="(n: Int)List[TypeStacks.this.TypeKind]" id="60543">pop</a>(<a title="Int" id="62681">n</a>: <span title="Int">Int</span>): <span title="List[TypeStacks.this.TypeKind]">List</span>[TypeKind] = {
      <span class="keyword">val</span> <a title="List[TypeStacks.this.TypeKind]" id="702188">prefix</a> = <a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="(n: Int)List[TypeStacks.this.TypeKind]" id="24284">take</a>(<a href="#62681" title="Int">n</a>)
      <a href="#60533" title="(x$1: TypeStacks.this.Rep)Unit">types</a> = <a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="(n: Int)List[TypeStacks.this.TypeKind]" id="24286">drop</a>(<a href="#62681" title="Int">n</a>)
      <a href="#702188" title="List[TypeStacks.this.TypeKind]">prefix</a>
    }
    
    <span class="keyword">def</span> <a title="(n: Int)TypeStacks.this.TypeKind" id="60544">apply</a>(<a title="Int" id="64411">n</a>: <span title="Int">Int</span>): <a href="TypeKinds.scala.html#46199" title="TypeStacks.this.TypeKind">TypeKind</a> = <a href="#60533" title="(n: Int)TypeStacks.this.TypeKind" id="28929">types</a>(<a href="#64411" title="Int">n</a>)

    /**
     * A TypeStack aggress with another one if they have the same
     * length and each type kind agrees position-wise. Two 
     * types agree if one is a subtype of the other.
     */
    <span class="keyword">def</span> <a title="(other: TypeStacks.this.TypeStack)Boolean" id="60545">agreesWith</a>(<a title="TypeStacks.this.TypeStack" id="702207">other</a>: <a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a>): <span title="Boolean">Boolean</span> =
      <span title="(x$1: Boolean)Boolean">(</span><a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="(x$1: Int)Boolean" id="2952">length</a> == <a href="#702207" title="TypeStacks.this.TypeStack">other</a>.<a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>.<span title="=&gt; Int">length</span>) &amp;&amp;
      <span title="object List">List</span>.<span title="(xs: List[TypeStacks.this.TypeKind],ys: List[TypeStacks.this.TypeKind])(f: (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind) =&gt; Boolean)Boolean">forall2</span>(<a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>, <a href="#702207" title="TypeStacks.this.TypeStack">other</a>.<a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>) ((<a title="TypeStacks.this.TypeKind" id="702231">t1</a>, <a title="TypeStacks.this.TypeKind" id="702232">t2</a>) =&gt; <a href="TypeKinds.scala.html#60444" title="(other: TypeStacks.this.TypeKind)Boolean">t1</a> <a title="(x$1: Boolean)Boolean" id="2210">&lt;:&lt;</a> <a href="#702232" title="TypeStacks.this.TypeKind">t2</a> || <a href="TypeKinds.scala.html#60444" title="(other: TypeStacks.this.TypeKind)Boolean">t2</a> &lt;:&lt; <a href="#702231" title="TypeStacks.this.TypeKind">t1</a>)

    <span class="keyword">def</span> <a title="(that: TypeStacks.this.TypeStack)TypeStacks.this.TypeStack" id="60546">mergeWith</a>(<a title="TypeStacks.this.TypeStack" id="702245">that</a>: <a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a>): <a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a> = {
      <span class="keyword">def</span> <a title="(a: TypeStacks.this.TypeStack,b: TypeStacks.this.TypeStack)TypeStacks.this.TypeStack" id="702247">merge</a>(<a title="TypeStacks.this.TypeStack" id="702248">a</a>: <a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a>, <a title="TypeStacks.this.TypeStack" id="702249">b</a>: <a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a>): <a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a> = {
        <span class="keyword">val</span> <a title="List[TypeStacks.this.TypeKind]" id="702250">lst</a> = <span title="object List">List</span>.<a title="(xs: List[TypeStacks.this.TypeKind],ys: List[TypeStacks.this.TypeKind])(f: (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind) =&gt; TypeStacks.this.TypeKind)List[TypeStacks.this.TypeKind]" id="24375">map2</a>(<a href="#702248" title="TypeStacks.this.TypeStack">a</a>.<a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>, <a href="#702249" title="TypeStacks.this.TypeStack">b</a>.<a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>) ((<a title="TypeStacks.this.TypeKind" id="702265">k1</a>, <a title="TypeStacks.this.TypeKind" id="702266">k2</a>) =&gt; <a href="#702265" title="TypeStacks.this.TypeKind">k1</a> <span title="TypeStacks.this.TypeKind" class="keyword">match</span> {
          <span title="TypeStacks.this.TypeKind" class="keyword">case</span> REFERENCE(<a title="TypeStacks.this.global.Symbol" id="702268">cls1</a>) =&gt;
            <span class="keyword">val</span> REFERENCE<a href="#702275" title="TypeStacks.this.global.Symbol" id="702271">(</a><a title="TypeStacks.this.global.Symbol" id="702275">cls2</a>) = <a href="#702266" title="TypeStacks.this.TypeKind">k2</a>
            <a href="TypeKinds.scala.html#46200" title="(a: TypeStacks.this.TypeKind,b: TypeStacks.this.TypeKind)TypeStacks.this.TypeKind">lub</a>(<a href="#702265" title="TypeStacks.this.TypeKind">k1</a>,<a href="#702266" title="TypeStacks.this.TypeKind">k2</a>)
          <span title="TypeStacks.this.TypeKind" class="keyword">case</span> _ =&gt; <a href="#702265" title="TypeStacks.this.TypeKind">k1</a>
        })
        <a href="#60535" title="(stack: TypeStacks.this.Rep)TypeStacks.this.TypeStack" class="keyword">new</a> <a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a>(<a href="#702250" title="List[TypeStacks.this.TypeKind]">lst</a>)
      }

      <a title="(assertion: Boolean,message: =&gt; Any)Unit" id="693">assert</a>(<a href="#60545" title="(other: TypeStacks.this.TypeStack)Boolean" class="keyword">this</a> agreesWith <a href="#702245" title="TypeStacks.this.TypeStack">that</a>,
             <span title="(x$1: Any)java.lang.String" class="string">&quot;Incompatible type stacks: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#46190" title="TypeStacks.this.TypeStack" class="keyword">this</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span> + <a href="#702245" title="TypeStacks.this.TypeStack">that</a>)
      <a href="#702247" title="(a: TypeStacks.this.TypeStack,b: TypeStacks.this.TypeStack)TypeStacks.this.TypeStack">merge</a>(<a href="#46190" title="TypeStacks.this.TypeStack" class="keyword">this</a>, <a href="#702245" title="TypeStacks.this.TypeStack">that</a>)
    }

    /* This method returns a String representation of the stack */
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="60547">toString</a>() = <a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="(start: String,sep: String,end: String)String" id="25360">mkString</a>(<span title="java.lang.String(&quot;&lt;&quot;)" class="string">&quot;&lt;&quot;</span>, <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span>, <span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>)

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: Any)Boolean" id="60548">equals</a>(<a title="Any" id="702323">other</a>: <a title="Any" id="49">Any</a>): <span title="Boolean">Boolean</span> =
      <a href="#702323" title="Any">other</a>.<a title="[T0]Boolean" id="3620">isInstanceOf</a><span title="(x$1: Boolean)Boolean">[</span><a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a>] &amp;&amp;
      <span title="object List">List</span>.<span title="(xs: List[TypeStacks.this.TypeKind],ys: List[TypeStacks.this.TypeKind])(f: (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind) =&gt; Boolean)Boolean">forall2</span>(<a href="#702323" title="Any">other</a>.<a title="[T0]T0" id="3623">asInstanceOf</a><span title="TypeStacks.this.TypeStack">[</span><a href="#46190" title="TypeStacks.this.TypeStack">TypeStack</a>].<a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>, <a href="#60533" title="=&gt; TypeStacks.this.Rep">types</a>)((<a title="TypeStacks.this.TypeKind" id="702338">a</a>, <a title="TypeStacks.this.TypeKind" id="702339">b</a>) =&gt; <a href="#702338" title="(x$1: AnyRef)Boolean" id="3626">a</a> == <a href="#702339" title="TypeStacks.this.TypeKind">b</a>)
  }

}

        </pre>
    </body>
</html>