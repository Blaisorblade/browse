<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/backend/icode/TypeStacks.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */

// $Id: TypeStacks.scala 18387 2009-07-24 15:28:37Z odersky $

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend
<span class="keyword">package</span> icode

/** This trait ...
 *
 *  @author  Iulian Dragos
 *  @version 1.0
 */
<span class="keyword">trait</span> <a title="trait TypeStacks extends java.lang.Object with ScalaObject" id="15855">TypeStacks</a> <span title="ScalaObject">{</span> self: ICodes =&gt;
  <span class="keyword">import</span> opcodes._
  <span class="keyword">import</span> global.{Symbol, Type, definitions}

  /* This class simulates the type of the opperand
   * stack of the ICode.
   */
  <span class="keyword">type</span> <a title="List[TypeStacks.this.TypeKind]" id="46421">Rep</a> = <span title="List[TypeStacks.this.TypeKind]">List</span>[TypeKind]

  <span class="keyword">class</span> <a title="class TypeStack extends java.lang.Object with ScalaObject" id="46422">TypeStack</a> <span title="ScalaObject">{</span>
    <span class="keyword">var</span> <a title="TypeStacks.this.Rep" id="60802">types</a>: <span title="TypeStacks.this.Rep">Rep</span> = <a title="object Nil" id="7700">Nil</a>

    <span class="keyword">def</span> <a title="(stack: TypeStacks.this.Rep)TypeStacks.this.TypeStack" id="60804" class="keyword">this</a>(<a title="TypeStacks.this.Rep" id="60829">stack</a>: <span title="TypeStacks.this.Rep">Rep</span>) = <span title="Unit">{</span>
      <a href="#46422" title="TypeStack.this.type" class="keyword">this</a>()
      <a href="#46422" title="TypeStack.this.type" class="keyword">this</a>.<a href="#60802" title="(x$1: TypeStacks.this.Rep)Unit">types</a> = <a href="#60829" title="TypeStacks.this.Rep">stack</a>
    }

    <span class="keyword">def</span> <a title="(that: TypeStacks.this.TypeStack)TypeStacks.this.TypeStack" id="60805" class="keyword">this</a>(<a title="TypeStacks.this.TypeStack" id="60820">that</a>: <a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a>) = <a href="#60804" title="(stack: TypeStacks.this.Rep)TypeStacks.this.TypeStack" class="keyword">this</a>(<a href="#60820" title="TypeStacks.this.TypeStack">that</a>.<a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>)

    <span class="keyword">def</span> <a title="=&gt; Int" id="60806">length</a>: <span title="Int">Int</span> = <a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>.<span title="=&gt; Int">length</span>

    /** Push a type on the type stack. UNITs are ignored. */
    <span class="keyword">def</span> <a title="(t: TypeStacks.this.TypeKind)Unit" id="60807">push</a>(<a title="TypeStacks.this.TypeKind" id="62686">t</a>: <a href="TypeKinds.scala.html#46431" title="TypeStacks.this.TypeKind">TypeKind</a>) =
      <span title="Unit" class="keyword">if</span> (<a href="#62686" title="(x$1: AnyRef)Boolean" id="6609">t</a> != <a href="TypeKinds.scala.html#46433" title="object TypeStacks.this.UNIT">UNIT</a>)
        <a href="#60802" title="(x$1: TypeStacks.this.Rep)Unit">types</a> = <a href="#62686" title="TypeStacks.this.TypeKind">t</a> <a href="#62698" title="TypeStacks.this.TypeKind">::</a> <a href="#60802" title="(x: TypeStacks.this.TypeKind)List[TypeStacks.this.TypeKind]" id="24417">types</a>

    <span class="keyword">def</span> <a title="=&gt; TypeStacks.this.TypeKind" id="60808">head</a>: <a href="TypeKinds.scala.html#46431" title="TypeStacks.this.TypeKind">TypeKind</a> = <a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>.<span title="=&gt; TypeStacks.this.TypeKind">head</span>

    /** Removes the value on top of the stack, and returns it. It assumes
     *  the stack contains at least one element.
     */
    <span class="keyword">def</span> <a title="=&gt; TypeStacks.this.TypeKind" id="60809">pop</a>: <a href="TypeKinds.scala.html#46431" title="TypeStacks.this.TypeKind">TypeKind</a> = {
      <span class="keyword">val</span> <a title="TypeStacks.this.TypeKind" id="703910">t</a> = <a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>.<span title="=&gt; TypeStacks.this.TypeKind">head</span>
      <a href="#60802" title="(x$1: TypeStacks.this.Rep)Unit">types</a> = <a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="=&gt; List[TypeStacks.this.TypeKind]" id="25477">tail</a>
      <a href="#703910" title="TypeStacks.this.TypeKind">t</a>
    }

    /** Return the topmost two values on the stack. It assumes the stack
     *  is large enough. Topmost element first.
     */
    <span class="keyword">def</span> <a title="=&gt; (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="60810">pop2</a>: <a title="(TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="1175">(</a>TypeKind, TypeKind) = <a title="(_1: TypeStacks.this.TypeKind,_2: TypeStacks.this.TypeKind)(TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="1176">(</a><a href="#60809" title="=&gt; TypeStacks.this.TypeKind">pop</a>, <a href="#60809" title="=&gt; TypeStacks.this.TypeKind">pop</a>)

    /** Return the topmost three values on the stack. It assumes the stack
     *  is large enough. Topmost element first.
     */
    <span class="keyword">def</span> <a title="=&gt; (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="60811">pop3</a>: <a title="(TypeStacks.this.TypeKind, TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="410">(</a>TypeKind, TypeKind, TypeKind) = <a title="(_1: TypeStacks.this.TypeKind,_2: TypeStacks.this.TypeKind,_3: TypeStacks.this.TypeKind)(TypeStacks.this.TypeKind, TypeStacks.this.TypeKind, TypeStacks.this.TypeKind)" id="411">(</a><a href="#60809" title="=&gt; TypeStacks.this.TypeKind">pop</a>, <a href="#60809" title="=&gt; TypeStacks.this.TypeKind">pop</a>, <a href="#60809" title="=&gt; TypeStacks.this.TypeKind">pop</a>)

    /** Drop the first n elements of the stack. */
    <span class="keyword">def</span> <a title="(n: Int)List[TypeStacks.this.TypeKind]" id="60812">pop</a>(<a title="Int" id="62953">n</a>: <span title="Int">Int</span>): <span title="List[TypeStacks.this.TypeKind]">List</span>[TypeKind] = {
      <span class="keyword">val</span> <a title="List[TypeStacks.this.TypeKind]" id="703949">prefix</a> = <a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="(n: Int)List[TypeStacks.this.TypeKind]" id="24443">take</a>(<a href="#62953" title="Int">n</a>)
      <a href="#60802" title="(x$1: TypeStacks.this.Rep)Unit">types</a> = <a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="(n: Int)List[TypeStacks.this.TypeKind]" id="24445">drop</a>(<a href="#62953" title="Int">n</a>)
      <a href="#703949" title="List[TypeStacks.this.TypeKind]">prefix</a>
    }
    
    <span class="keyword">def</span> <a title="(n: Int)TypeStacks.this.TypeKind" id="60813">apply</a>(<a title="Int" id="64683">n</a>: <span title="Int">Int</span>): <a href="TypeKinds.scala.html#46431" title="TypeStacks.this.TypeKind">TypeKind</a> = <a href="#60802" title="(n: Int)TypeStacks.this.TypeKind" id="29115">types</a>(<a href="#64683" title="Int">n</a>)

    /**
     * A TypeStack aggress with another one if they have the same
     * length and each type kind agrees position-wise. Two 
     * types agree if one is a subtype of the other.
     */
    <span class="keyword">def</span> <a title="(other: TypeStacks.this.TypeStack)Boolean" id="60814">agreesWith</a>(<a title="TypeStacks.this.TypeStack" id="703968">other</a>: <a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a>): <span title="Boolean">Boolean</span> =
      <span title="(x$1: Boolean)Boolean">(</span><a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="(x$1: Int)Boolean" id="2973">length</a> == <a href="#703968" title="TypeStacks.this.TypeStack">other</a>.<a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>.<span title="=&gt; Int">length</span>) &amp;&amp;
      <span title="object List">List</span>.<span title="(xs: List[TypeStacks.this.TypeKind],ys: List[TypeStacks.this.TypeKind])(f: (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind) =&gt; Boolean)Boolean">forall2</span>(<a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>, <a href="#703968" title="TypeStacks.this.TypeStack">other</a>.<a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>) ((<a title="TypeStacks.this.TypeKind" id="703992">t1</a>, <a title="TypeStacks.this.TypeKind" id="703993">t2</a>) =&gt; <a href="TypeKinds.scala.html#60713" title="(other: TypeStacks.this.TypeKind)Boolean">t1</a> <a title="(x$1: Boolean)Boolean" id="2231">&lt;:&lt;</a> <a href="#703993" title="TypeStacks.this.TypeKind">t2</a> || <a href="TypeKinds.scala.html#60713" title="(other: TypeStacks.this.TypeKind)Boolean">t2</a> &lt;:&lt; <a href="#703992" title="TypeStacks.this.TypeKind">t1</a>)

    <span class="keyword">def</span> <a title="(that: TypeStacks.this.TypeStack)TypeStacks.this.TypeStack" id="60815">mergeWith</a>(<a title="TypeStacks.this.TypeStack" id="704006">that</a>: <a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a>): <a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a> = {
      <span class="keyword">def</span> <a title="(a: TypeStacks.this.TypeStack,b: TypeStacks.this.TypeStack)TypeStacks.this.TypeStack" id="704008">merge</a>(<a title="TypeStacks.this.TypeStack" id="704009">a</a>: <a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a>, <a title="TypeStacks.this.TypeStack" id="704010">b</a>: <a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a>): <a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a> = {
        <span class="keyword">val</span> <a title="List[TypeStacks.this.TypeKind]" id="704011">lst</a> = <span title="object List">List</span>.<a title="(xs: List[TypeStacks.this.TypeKind],ys: List[TypeStacks.this.TypeKind])(f: (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind) =&gt; TypeStacks.this.TypeKind)List[TypeStacks.this.TypeKind]" id="24534">map2</a>(<a href="#704009" title="TypeStacks.this.TypeStack">a</a>.<a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>, <a href="#704010" title="TypeStacks.this.TypeStack">b</a>.<a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>) ((<a title="TypeStacks.this.TypeKind" id="704026">k1</a>, <a title="TypeStacks.this.TypeKind" id="704027">k2</a>) =&gt; <a href="#704026" title="TypeStacks.this.TypeKind">k1</a> <span title="TypeStacks.this.TypeKind" class="keyword">match</span> {
          <span title="TypeStacks.this.TypeKind" class="keyword">case</span> REFERENCE(<a title="TypeStacks.this.global.Symbol" id="704029">cls1</a>) =&gt;
            <span class="keyword">val</span> REFERENCE<a href="#704036" title="TypeStacks.this.global.Symbol" id="704032">(</a><a title="TypeStacks.this.global.Symbol" id="704036">cls2</a>) = <a href="#704027" title="TypeStacks.this.TypeKind">k2</a>
            <a href="TypeKinds.scala.html#46432" title="(a: TypeStacks.this.TypeKind,b: TypeStacks.this.TypeKind)TypeStacks.this.TypeKind">lub</a>(<a href="#704026" title="TypeStacks.this.TypeKind">k1</a>,<a href="#704027" title="TypeStacks.this.TypeKind">k2</a>)
          <span title="TypeStacks.this.TypeKind" class="keyword">case</span> _ =&gt; <a href="#704026" title="TypeStacks.this.TypeKind">k1</a>
        })
        <a href="#60804" title="(stack: TypeStacks.this.Rep)TypeStacks.this.TypeStack" class="keyword">new</a> <a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a>(<a href="#704011" title="List[TypeStacks.this.TypeKind]">lst</a>)
      }

      <a title="(assertion: Boolean,message: =&gt; Any)Unit" id="708">assert</a>(<a href="#60814" title="(other: TypeStacks.this.TypeStack)Boolean" class="keyword">this</a> agreesWith <a href="#704006" title="TypeStacks.this.TypeStack">that</a>,
             <span title="(x$1: Any)java.lang.String" class="string">&quot;Incompatible type stacks: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#46422" title="TypeStacks.this.TypeStack" class="keyword">this</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span> + <a href="#704006" title="TypeStacks.this.TypeStack">that</a>)
      <a href="#704008" title="(a: TypeStacks.this.TypeStack,b: TypeStacks.this.TypeStack)TypeStacks.this.TypeStack">merge</a>(<a href="#46422" title="TypeStacks.this.TypeStack" class="keyword">this</a>, <a href="#704006" title="TypeStacks.this.TypeStack">that</a>)
    }

    /* This method returns a String representation of the stack */
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="60816">toString</a>() = <a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>.<a title="(start: String,sep: String,end: String)String" id="25519">mkString</a>(<span title="java.lang.String(&quot;&lt;&quot;)" class="string">&quot;&lt;&quot;</span>, <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span>, <span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>)

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: Any)Boolean" id="60817">equals</a>(<a title="Any" id="704084">other</a>: <a title="Any" id="49">Any</a>): <span title="Boolean">Boolean</span> =
      <a href="#704084" title="Any">other</a>.<a title="[T0]Boolean" id="3641">isInstanceOf</a><span title="(x$1: Boolean)Boolean">[</span><a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a>] &amp;&amp;
      <span title="object List">List</span>.<span title="(xs: List[TypeStacks.this.TypeKind],ys: List[TypeStacks.this.TypeKind])(f: (TypeStacks.this.TypeKind, TypeStacks.this.TypeKind) =&gt; Boolean)Boolean">forall2</span>(<a href="#704084" title="Any">other</a>.<a title="[T0]T0" id="3644">asInstanceOf</a><span title="TypeStacks.this.TypeStack">[</span><a href="#46422" title="TypeStacks.this.TypeStack">TypeStack</a>].<a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>, <a href="#60802" title="=&gt; TypeStacks.this.Rep">types</a>)((<a title="TypeStacks.this.TypeKind" id="704099">a</a>, <a title="TypeStacks.this.TypeKind" id="704100">b</a>) =&gt; <a href="#704099" title="(x$1: AnyRef)Boolean" id="3647">a</a> == <a href="#704100" title="TypeStacks.this.TypeKind">b</a>)
  }

}

        </pre>
    </body>
</html>