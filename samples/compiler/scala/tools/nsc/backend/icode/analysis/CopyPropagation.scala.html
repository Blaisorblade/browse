<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/backend/icode/analysis/CopyPropagation.scala</title>
        <script type="text/javascript" src="../../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */

// $Id: CopyPropagation.scala 18586 2009-08-27 10:59:03Z dragos $

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend.icode.analysis

<span class="keyword">import</span> scala.collection.mutable.{Map, HashMap}
<span class="keyword">import</span> scala.tools.nsc.symtab.Flags.DEFERRED

/** A modified copy-propagation like analysis. It 
 *  is augmented with a record-like value which is used
 *  to represent closures.
 *
 *  @author Iulian Dragos
 */
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CopyPropagation extends java.lang.Object with ScalaObject" id="16115">CopyPropagation</a> <span title="ScalaObject">{</span>
  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.Global" id="155555">global</a>: <a href="../../../Global.scala.html#8529" title="scala.tools.nsc.Global">Global</a>
  <span class="keyword">import</span> global._
  <span class="keyword">import</span> icodes._

  /** Locations can be local variables, this, and fields. */
  <span class="keyword">abstract</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <a title="class Location extends java.lang.Object with ScalaObject" id="155558">Location</a>
  case <span class="keyword">class</span> <a title="class LocalVar extends CopyPropagation.this.Location with ScalaObject with Product" id="155814">LocalVar</a><span title="ScalaObject">(</span><a title="CopyPropagation.this.global.icodes.Local" id="155822">l</a>: <a href="../Members.scala.html#46406" title="CopyPropagation.this.global.icodes.Local">Local</a>) <span class="keyword">extends</span> <a href="#155558" title="CopyPropagation.this.Location">Location</a>
  case <span class="keyword">class</span> <a title="class Field extends CopyPropagation.this.Location with ScalaObject with Product" id="156205">Field</a><span title="ScalaObject">(</span><a title="CopyPropagation.this.Record" id="342427">r</a>: <a href="#156035" title="CopyPropagation.this.Record">Record</a>, <a title="CopyPropagation.this.global.Symbol" id="342428">sym</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>) <span class="keyword">extends</span> <a href="#155558" title="CopyPropagation.this.Location">Location</a>
  case <span class="keyword">object</span> <a href="#341088" title="object CopyPropagation.this.This" id="341099">This</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#155558" title="CopyPropagation.this.Location">Location</a>

  /** Values that can be on the stack. */
  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class Value extends java.lang.Object with ScalaObject" id="155567">Value</a> <span title="ScalaObject">{</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="155853">isRecord</a> = <span title="Boolean(false)" class="keyword">false</span>
  }
  case <span class="keyword">class</span> <a title="class Record extends CopyPropagation.this.Value with ScalaObject with Product" id="156035">Record</a><span title="ScalaObject">(</span><a title="CopyPropagation.this.global.Symbol" id="343081">cls</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>, <a title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="343082">bindings</a>: <span title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">Map</span>[Symbol, Value]) <span class="keyword">extends</span> <a href="#155567" title="CopyPropagation.this.Value">Value</a> {
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="156027">isRecord</a> = <span title="Boolean(true)" class="keyword">true</span>
  }
  /** The value of some location in memory. */
  case <span class="keyword">class</span> <a title="class Deref extends CopyPropagation.this.Value with ScalaObject with Product" id="155855">Deref</a><span title="ScalaObject">(</span><a title="CopyPropagation.this.Location" id="341469">l</a>: <a href="#155558" title="CopyPropagation.this.Location">Location</a>) <span class="keyword">extends</span> <a href="#155567" title="CopyPropagation.this.Value">Value</a>
  
  /** The boxed value of some location. */
  case <span class="keyword">class</span> <a title="class Boxed extends CopyPropagation.this.Value with ScalaObject with Product" id="156307">Boxed</a><span title="ScalaObject">(</span><a title="CopyPropagation.this.Location" id="342997">l</a>: <a href="#155558" title="CopyPropagation.this.Location">Location</a>) <span class="keyword">extends</span> <a href="#155567" title="CopyPropagation.this.Value">Value</a>
  
  /** The constant value c. */
  case <span class="keyword">class</span> <a title="class Const extends CopyPropagation.this.Value with ScalaObject with Product" id="156531">Const</a><span title="ScalaObject">(</span><a title="CopyPropagation.this.global.Constant" id="342334">c</a>: <a href="../../../symtab/Constants.scala.html#26672" title="CopyPropagation.this.global.Constant">Constant</a>) <span class="keyword">extends</span> <a href="#155567" title="CopyPropagation.this.Value">Value</a>
  
  /** Unknown. */
  case <span class="keyword">object</span> <a href="#341328" title="object CopyPropagation.this.Unknown" id="341339">Unknown</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#155567" title="CopyPropagation.this.Value">Value</a>
  
  /** The bottom record. */
  <span class="keyword">object</span> <a title="object CopyPropagation.this.AllRecords" id="155582">AllRecords</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#156035" title="CopyPropagation.this.Record">Record</a>(<a href="../../../symtab/Symbols.scala.html#26293" title="object CopyPropagation.this.global.NoSymbol">NoSymbol</a>, <span title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">HashMap</span>[Symbol, Value])

  /** The lattice for this analysis.   */
  <span class="keyword">object</span> <a title="object CopyPropagation.this.copyLattice" id="155584">copyLattice</a> <span title="ScalaObject" class="keyword">extends</span> <a href="CompleteLattice.scala.html#16106" title="scala.tools.nsc.backend.icode.analysis.CompleteLattice">CompleteLattice</a> {
    <span class="keyword">type</span> <a title="scala.collection.mutable.Map[CopyPropagation.this.Location,CopyPropagation.this.Value]" id="155593">Bindings</a> = <span title="scala.collection.mutable.Map[CopyPropagation.this.Location,CopyPropagation.this.Value]">Map</span>[Location, Value]

    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]" id="155594">emptyBinding</a> = <span title="scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]">HashMap</span>[Location, Value]()

    <span class="keyword">class</span> <a title="class State extends java.lang.Object with ScalaObject" id="155595">State</a><span title="ScalaObject">(</span><span class="keyword">val</span> <a title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings" id="341347">bindings</a>: <span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings">Bindings</span>, <span class="keyword">var</span> <a title="List[CopyPropagation.this.Value]" id="341348">stack</a>: <a title="List[CopyPropagation.this.Value]" id="7414">List</a>[Value]) {
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(that: Any)Boolean" id="155757">equals</a>(<a title="Any" id="341374">that</a>: <a title="Any" id="49">Any</a>): <span title="Boolean">Boolean</span> = 
        <span title="(x$1: Boolean)Boolean">(</span><a href="#155595" title="(x$1: AnyRef)Boolean" class="keyword">this</a> eq <a href="#341374" title="Any">that</a>.<span title="[T0]T0">asInstanceOf</span><span title="AnyRef">[</span><a title="AnyRef" id="1779">AnyRef</a>]) ||
        <a href="#341374" title="Any">that</a>.<a title="[T0]Boolean" id="3641">isInstanceOf</a><span title="(x$1: Boolean)Boolean">[</span><a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">State</a>] &amp;&amp; {
          <span class="keyword">val</span> <a title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State" id="341378">other</a> = <a href="#341374" title="Any">that</a>.<span title="[T0]T0">asInstanceOf</span><span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">[</span><a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">State</a>]

          /* comparison with bottom is reference equality! */
          <span title="Boolean" class="keyword">if</span> (<span title="(x$1: Boolean)Boolean">(</span><a href="#341378" title="(x$1: AnyRef)Boolean">other</a> eq <a href="#155599" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">bottom</a>) || (<a href="#155595" title="(x$1: AnyRef)Boolean" class="keyword">this</a> eq <a href="#155599" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">bottom</a>))
            (<a href="#155595" title="(x$1: AnyRef)Boolean" class="keyword">this</a> eq <a href="#341378" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">other</a>)
          <span class="keyword">else</span> {
            <a href="#155595" title="State.this.type" class="keyword">this</a>.<a href="#341347" title="(x$1: AnyRef)Boolean">bindings</a> <span title="(x$1: Boolean)Boolean">==</span> <a href="#341378" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">other</a>.<a href="#341347" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings">bindings</a> &amp;&amp;
            <span title="object List">List</span>.<a title="(xs: List[CopyPropagation.this.Value],ys: List[CopyPropagation.this.Value])(f: (CopyPropagation.this.Value, CopyPropagation.this.Value) =&gt; Boolean)Boolean" id="24550">forall2</a>(<a href="#155595" title="State.this.type" class="keyword">this</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>, <a href="#341378" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">other</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>) { (<a title="CopyPropagation.this.Value" id="341406">a</a>, <a title="CopyPropagation.this.Value" id="341407">b</a>) =&gt; <a href="#341406" title="(x$1: AnyRef)Boolean">a</a> == <a href="#341407" title="CopyPropagation.this.Value">b</a> }
          }
        }

      /* Return an alias for the given local. It returns the last
       * local in the chain of aliased locals. Cycles are not allowed
       * to exist (by construction).
       */
      <span class="keyword">def</span> <a title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.global.icodes.Local" id="155758">getAlias</a>(<a title="CopyPropagation.this.global.icodes.Local" id="155985">l</a>: <a href="../Members.scala.html#46406" title="CopyPropagation.this.global.icodes.Local">Local</a>): <a href="../Members.scala.html#46406" title="CopyPropagation.this.global.icodes.Local">Local</a> = {
        <span class="keyword">var</span> <a title="CopyPropagation.this.global.icodes.Local" id="341422">target</a> = <a href="#155985" title="CopyPropagation.this.global.icodes.Local">l</a>
        <span class="keyword">var</span> <a title="Boolean" id="341423">stop</a> = <span title="Boolean(false)" class="keyword">false</span>
        
        <span title="Unit" class="keyword">while</span> (<a href="#341347" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings">bindings</a>.<span title="(key: CopyPropagation.this.Location)Boolean">isDefinedAt</span><span title="(x$1: Boolean)Boolean">(</span><a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a>(<a href="#341422" title="CopyPropagation.this.global.icodes.Local">target</a>)) &amp;&amp; <span title="=&gt; Boolean">!</span><a href="#341423" title="Boolean">stop</a>) {
          <a href="#341347" title="(key: CopyPropagation.this.Location)CopyPropagation.this.Value">bindings</a>(<a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a>(<a href="#341422" title="CopyPropagation.this.global.icodes.Local">target</a>)) <a href="#341424" title="Unit" class="keyword">match</a> {
            <span title="Unit" class="keyword">case</span> Deref(LocalVar(<a title="CopyPropagation.this.global.icodes.Local" id="341458">t</a>)) =&gt; <a href="#341422" title="CopyPropagation.this.global.icodes.Local">target</a> = <a href="#341458" title="CopyPropagation.this.global.icodes.Local">t</a>
            <span title="Unit" class="keyword">case</span> _ =&gt; <a href="#341423" title="Boolean">stop</a> = <span title="Boolean(true)" class="keyword">true</span>
          }
        }
        <a href="#341422" title="CopyPropagation.this.global.icodes.Local">target</a>
      }

      /* Return the value bound to the given local. */
      <span class="keyword">def</span> <a title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.Value" id="155759">getBinding</a>(<a title="CopyPropagation.this.global.icodes.Local" id="155846">l</a>: <a href="../Members.scala.html#46406" title="CopyPropagation.this.global.icodes.Local">Local</a>): <a href="#155567" title="CopyPropagation.this.Value">Value</a> = {
        <span class="keyword">var</span> <a title="CopyPropagation.this.global.icodes.Local" id="341465">target</a> = <a href="#155846" title="CopyPropagation.this.global.icodes.Local">l</a>
        <span class="keyword">var</span> <a title="Boolean" id="341466">stop</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">var</span> <a title="CopyPropagation.this.Value" id="341467">value</a>: <a href="#155567" title="CopyPropagation.this.Value">Value</a> = <a href="#155855" title="(l: CopyPropagation.this.Location)CopyPropagation.this.Deref">Deref</a>(<a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a>(<a href="#341465" title="CopyPropagation.this.global.icodes.Local">target</a>))
        
        <span title="Unit" class="keyword">while</span> (<a href="#341347" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings">bindings</a>.<span title="(key: CopyPropagation.this.Location)Boolean">isDefinedAt</span><span title="(x$1: Boolean)Boolean">(</span><a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a>(<a href="#341465" title="CopyPropagation.this.global.icodes.Local">target</a>)) &amp;&amp; <span title="=&gt; Boolean">!</span><a href="#341466" title="Boolean">stop</a>) <a href="#341468" title="()Unit">{</a>
//          Console.println(&quot;finding binding for &quot; + target)
          <a href="#341467" title="CopyPropagation.this.Value">value</a> = <a href="#341347" title="(key: CopyPropagation.this.Location)CopyPropagation.this.Value">bindings</a>(<a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a>(<a href="#341465" title="CopyPropagation.this.global.icodes.Local">target</a>))
          <a href="#341467" title="CopyPropagation.this.Value">value</a> <span title="Unit" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> Deref(LocalVar(<a title="CopyPropagation.this.global.icodes.Local" id="341517">t</a>)) =&gt; <a href="#341465" title="CopyPropagation.this.global.icodes.Local">target</a> = <a href="#341517" title="CopyPropagation.this.global.icodes.Local">t</a>
            <span title="Unit" class="keyword">case</span> _ =&gt; <a href="#341466" title="Boolean">stop</a> = <span title="Boolean(true)" class="keyword">true</span>
          }
        }
        <a href="#341467" title="CopyPropagation.this.Value">value</a>
      }

      /* Return the binding for the given field of the given record */
      <span class="keyword">def</span> <a title="(r: CopyPropagation.this.Record,f: CopyPropagation.this.global.Symbol)CopyPropagation.this.Value" id="155760">getBinding</a>(<a title="CopyPropagation.this.Record" id="155841">r</a>: <a href="#156035" title="CopyPropagation.this.Record">Record</a>, <a title="CopyPropagation.this.global.Symbol" id="155842">f</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>): <a href="#155567" title="CopyPropagation.this.Value">Value</a> = {
        <span title="(assertion: Boolean,message: =&gt; Any)Unit">assert</span>(<a href="#155841" title="CopyPropagation.this.Record">r</a>.<a href="#343082" title="=&gt; scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">bindings</a>.<span title="(key: CopyPropagation.this.global.Symbol)Boolean">isDefinedAt</span>(<a href="#155842" title="CopyPropagation.this.global.Symbol">f</a>),
               <span title="(x$1: Any)java.lang.String" class="string">&quot;Record &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155841" title="CopyPropagation.this.Record">r</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; does not contain a field &quot;)" class="string">&quot; does not contain a field &quot;</span> + <a href="#155842" title="CopyPropagation.this.global.Symbol">f</a>);

        <span class="keyword">var</span> <a title="CopyPropagation.this.Value" id="341524">target</a>: <a href="#155567" title="CopyPropagation.this.Value">Value</a> = <a href="#155841" title="CopyPropagation.this.Record">r</a>.<a href="#343082" title="(key: CopyPropagation.this.global.Symbol)CopyPropagation.this.Value">bindings</a>(<a href="#155842" title="CopyPropagation.this.global.Symbol">f</a>);
        <a href="#341524" title="CopyPropagation.this.Value">target</a> <span title="CopyPropagation.this.Value" class="keyword">match</span> {
          <span title="CopyPropagation.this.Value" class="keyword">case</span> Deref(LocalVar(<a title="CopyPropagation.this.global.icodes.Local" id="341561">l</a>)) =&gt; <a href="#155759" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.Value">getBinding</a>(<a href="#341561" title="CopyPropagation.this.global.icodes.Local">l</a>)
          <span title="CopyPropagation.this.Value" class="keyword">case</span> _ =&gt; <a href="#341524" title="CopyPropagation.this.Value">target</a>
        }
      }
      
      /** Return a local which contains the same value as this field, if any.
       * If the field holds a reference to a local, the returned value is the
       * binding of that local.
       */
      <span class="keyword">def</span> <a title="(r: CopyPropagation.this.Record,f: CopyPropagation.this.global.Symbol)Option[CopyPropagation.this.Value]" id="155761">getFieldValue</a>(<a title="CopyPropagation.this.Record" id="156241">r</a>: <a href="#156035" title="CopyPropagation.this.Record">Record</a>, <a title="CopyPropagation.this.global.Symbol" id="156242">f</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>): <span title="Option[CopyPropagation.this.Value]">Option</span>[Value] = {
        <span title="Option[CopyPropagation.this.Value]" class="keyword">if</span>(<span title="=&gt; Boolean">!</span><a href="#156241" title="CopyPropagation.this.Record">r</a>.<a href="#343082" title="=&gt; scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">bindings</a>.<span title="(key: CopyPropagation.this.global.Symbol)Boolean">isDefinedAt</span>(<a href="#156242" title="CopyPropagation.this.global.Symbol">f</a>)) <span title="object None">None</span> <span class="keyword">else</span> {
        	<span class="keyword">var</span> <a title="CopyPropagation.this.Value" id="341576">target</a>: <a href="#155567" title="CopyPropagation.this.Value">Value</a> = <a href="#156241" title="CopyPropagation.this.Record">r</a>.<a href="#343082" title="(key: CopyPropagation.this.global.Symbol)CopyPropagation.this.Value">bindings</a>(<a href="#156242" title="CopyPropagation.this.global.Symbol">f</a>)
        	<a href="#341576" title="CopyPropagation.this.Value">target</a> <span title="Option[CopyPropagation.this.Value]" class="keyword">match</span> {
          	<span title="Some[CopyPropagation.this.Value]" class="keyword">case</span> Deref(LocalVar(<a title="CopyPropagation.this.global.icodes.Local" id="341591">l</a>)) =&gt; <span title="(x: CopyPropagation.this.Value)Some[CopyPropagation.this.Value]">Some</span>(<a href="#155759" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.Value">getBinding</a>(<a href="#341591" title="CopyPropagation.this.global.icodes.Local">l</a>))
          	<span title="Option[CopyPropagation.this.Value]" class="keyword">case</span> Deref(Field(<a title="CopyPropagation.this.Record" id="341606">r1</a>, <a title="CopyPropagation.this.global.Symbol" id="341607">f1</a>)) =&gt; <a href="#155761" title="(r: CopyPropagation.this.Record,f: CopyPropagation.this.global.Symbol)Option[CopyPropagation.this.Value]">getFieldValue</a><span title="(alternative: =&gt; Option[CopyPropagation.this.Value])Option[CopyPropagation.this.Value]">(</span><a href="#341606" title="CopyPropagation.this.Record">r1</a>, <a href="#341607" title="CopyPropagation.this.global.Symbol">f1</a>) orElse <span title="(x: CopyPropagation.this.Value)Some[CopyPropagation.this.Value]">Some</span>(<a href="#341576" title="CopyPropagation.this.Value">target</a>)
//          case Deref(This)    =&gt; Some(target)
//          case Const(k) =&gt; Some(target)
	          <span title="Some[CopyPropagation.this.Value]" class="keyword">case</span> _  =&gt; <span title="(x: CopyPropagation.this.Value)Some[CopyPropagation.this.Value]">Some</span>(<a href="#341576" title="CopyPropagation.this.Value">target</a>)
          }
        }
      }
      
      /** The same as getFieldValue, but never returns Record/Field values. Use
       *  this when you want to find a replacement for a field value (either a local,
       *  or a constant/this value). 
       */
      <span class="keyword">def</span> <a title="(r: CopyPropagation.this.Record,f: CopyPropagation.this.global.Symbol)Option[CopyPropagation.this.Value]" id="155762">getFieldNonRecordValue</a>(<a title="CopyPropagation.this.Record" id="156069">r</a>: <a href="#156035" title="CopyPropagation.this.Record">Record</a>, <a title="CopyPropagation.this.global.Symbol" id="156070">f</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>): <span title="Option[CopyPropagation.this.Value]">Option</span>[Value] = {
        <span title="(assertion: Boolean,message: =&gt; Any)Unit">assert</span>(<a href="#156069" title="CopyPropagation.this.Record">r</a>.<a href="#343082" title="=&gt; scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">bindings</a>.<span title="(key: CopyPropagation.this.global.Symbol)Boolean">isDefinedAt</span>(<a href="#156070" title="CopyPropagation.this.global.Symbol">f</a>),
            <span title="(x$1: Any)java.lang.String" class="string">&quot;Record &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#156069" title="CopyPropagation.this.Record">r</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; does not contain a field &quot;)" class="string">&quot; does not contain a field &quot;</span> + <a href="#156070" title="CopyPropagation.this.global.Symbol">f</a>);

        <span class="keyword">var</span> <a title="CopyPropagation.this.Value" id="341631">target</a>: <a href="#155567" title="CopyPropagation.this.Value">Value</a> = <a href="#156069" title="CopyPropagation.this.Record">r</a>.<a href="#343082" title="(key: CopyPropagation.this.global.Symbol)CopyPropagation.this.Value">bindings</a>(<a href="#156070" title="CopyPropagation.this.global.Symbol">f</a>)
        <a href="#341631" title="CopyPropagation.this.Value">target</a> <span title="Option[CopyPropagation.this.Value]" class="keyword">match</span> {
          <span title="Option[CopyPropagation.this.Value]" class="keyword">case</span> Deref(LocalVar(<a title="CopyPropagation.this.global.icodes.Local" id="341665">l</a>)) =&gt; 
            <span class="keyword">val</span> <a title="CopyPropagation.this.global.icodes.Local" id="341670">alias</a> = <a href="#155758" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.global.icodes.Local">getAlias</a>(<a href="#341665" title="CopyPropagation.this.global.icodes.Local">l</a>)
            <a href="#155759" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.Value">getBinding</a>(<a href="#341670" title="CopyPropagation.this.global.icodes.Local">alias</a>) <span title="Option[CopyPropagation.this.Value]" class="keyword">match</span> {
              <span title="Some[CopyPropagation.this.Deref]" class="keyword">case</span> Record(_, _) =&gt; <span title="(x: CopyPropagation.this.Deref)Some[CopyPropagation.this.Deref]">Some</span>(<a href="#155855" title="(l: CopyPropagation.this.Location)CopyPropagation.this.Deref">Deref</a>(<a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a>(<a href="#341670" title="CopyPropagation.this.global.icodes.Local">alias</a>)))
              <span title="Option[CopyPropagation.this.Value]" class="keyword">case</span> Deref(Field(<a title="CopyPropagation.this.Record" id="341697">r1</a>, <a title="CopyPropagation.this.global.Symbol" id="341698">f1</a>)) =&gt; 
                <a href="#155762" title="(r: CopyPropagation.this.Record,f: CopyPropagation.this.global.Symbol)Option[CopyPropagation.this.Value]">getFieldNonRecordValue</a><span title="(alternative: =&gt; Option[CopyPropagation.this.Value])Option[CopyPropagation.this.Value]">(</span><a href="#341697" title="CopyPropagation.this.Record">r1</a>, <a href="#341698" title="CopyPropagation.this.global.Symbol">f1</a>) orElse <span title="(x: CopyPropagation.this.Deref)Some[CopyPropagation.this.Deref]">Some</span>(<a href="#155855" title="(l: CopyPropagation.this.Location)CopyPropagation.this.Deref">Deref</a>(<a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a>(<a href="#341670" title="CopyPropagation.this.global.icodes.Local">alias</a>))) 
              <span title="Some[CopyPropagation.this.Value]" class="keyword">case</span> <a title="CopyPropagation.this.Value" id="341729">v</a> =&gt; <span title="(x: CopyPropagation.this.Value)Some[CopyPropagation.this.Value]">Some</span>(<a href="#341729" title="CopyPropagation.this.Value">v</a>) 
            }
          <span title="Option[CopyPropagation.this.Value]" class="keyword">case</span> Deref(Field(<a title="CopyPropagation.this.Record" id="341735">r1</a>, <a title="CopyPropagation.this.global.Symbol" id="341736">f1</a>)) =&gt; 
            <a href="#155762" title="(r: CopyPropagation.this.Record,f: CopyPropagation.this.global.Symbol)Option[CopyPropagation.this.Value]">getFieldNonRecordValue</a><span title="(alternative: =&gt; Option[CopyPropagation.this.Value])Option[CopyPropagation.this.Value]">(</span><a href="#341735" title="CopyPropagation.this.Record">r1</a>, <a href="#341736" title="CopyPropagation.this.global.Symbol">f1</a>) orElse <span title="object None">None</span>
          <span title="Some[CopyPropagation.this.Value]" class="keyword">case</span> Deref(<a href="#341099" title="object CopyPropagation.this.This">This</a>) =&gt; <span title="(x: CopyPropagation.this.Value)Some[CopyPropagation.this.Value]">Some</span>(<a href="#341631" title="CopyPropagation.this.Value">target</a>)
          <span title="Some[CopyPropagation.this.Value]" class="keyword">case</span> Const(<a title="CopyPropagation.this.global.Constant" id="341757">k</a>)    =&gt; <span title="(x: CopyPropagation.this.Value)Some[CopyPropagation.this.Value]">Some</span>(<a href="#341631" title="CopyPropagation.this.Value">target</a>)
          <span title="None.type" class="keyword">case</span> _           =&gt; <span title="object None">None</span>
        }
      }

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="155763">toString</a>(): <span title="String">String</span> =
        <span title="(x$1: Any)java.lang.String" class="string">&quot;\nBindings: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#341347" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings">bindings</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012Stack: &quot;)" class="string">&quot;\nStack: &quot;</span> + <a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>;

      <span class="keyword">def</span> <a title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State" id="155764">dup</a>: <a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">State</a> = {
        <span class="keyword">val</span> <a title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings" id="341774">b</a>: <span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings">Bindings</span> = <span title="scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]">HashMap</span>()
        <a href="#341774" title="(iter: Traversable[(CopyPropagation.this.Location, CopyPropagation.this.Value)])b.type">b</a> ++= <a href="#341347" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings">bindings</a>
        <span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State" class="keyword">new</span> <a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">State</a>(<a href="#341774" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings">b</a>, <a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>)
      }
    }

    <span class="keyword">type</span> <a title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State" id="155596">Elem</a> = <a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">State</a>

    <span class="keyword">val</span> <a title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State" id="155597">top</a>    = <span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State" class="keyword">new</span> <a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">State</a>(<a href="#155594" title="=&gt; scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]">emptyBinding</a>, <span title="object Nil">Nil</span>)
    <span class="keyword">val</span> <a title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State" id="155599">bottom</a> = <span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State" class="keyword">new</span> <a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">State</a>(<a href="#155594" title="=&gt; scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]">emptyBinding</a>, <span title="object Nil">Nil</span>)

    <span class="keyword">val</span> <a title="List[object CopyPropagation.this.Unknown]" id="155601">exceptionHandlerStack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#341358" title="CopyPropagation.this.Unknown.type">::</a> <span title="(x: object CopyPropagation.this.Unknown)List[object CopyPropagation.this.Unknown]">Nil</span>

    <span class="keyword">def</span> <a title="(a: scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem,b: scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem)scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem" id="155603">lub2</a>(<a title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem" id="341792">a</a>: <a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">Elem</a>, <a title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem" id="341793">b</a>: <a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">Elem</a>): <a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">Elem</a> = {
      <span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem" class="keyword">if</span> (<a href="#341792" title="(x$1: AnyRef)Boolean">a</a> eq <a href="#155599" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">bottom</a>)      <a href="#341793" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">b</a>
      <span class="keyword">else</span> <span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem" class="keyword">if</span> (<a href="#341793" title="(x$1: AnyRef)Boolean">b</a> eq <a href="#155599" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">bottom</a>) <a href="#341792" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">a</a>
      <span class="keyword">else</span> <span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem" class="keyword">if</span> (<a href="#341792" title="(x$1: AnyRef)Boolean">a</a> == <a href="#341793" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">b</a>) <a href="#341792" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">a</a>
      <span class="keyword">else</span> {
        <span class="keyword">val</span> <a title="List[CopyPropagation.this.Value]" id="341807">resStack</a> = 
          <span title="List[CopyPropagation.this.Value]" class="keyword">if</span> (<a href="#341792" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">a</a>.<a href="#341348" title="(x$1: AnyRef)Boolean">stack</a> eq <a href="#155601" title="=&gt; List[object CopyPropagation.this.Unknown]">exceptionHandlerStack</a>) <a href="#341792" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">a</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>
          <span class="keyword">else</span> <span title="List[CopyPropagation.this.Value]" class="keyword">if</span> (<a href="#341793" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">b</a>.<a href="#341348" title="(x$1: AnyRef)Boolean">stack</a> eq <a href="#155601" title="=&gt; List[object CopyPropagation.this.Unknown]">exceptionHandlerStack</a>) <a href="#341793" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">b</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>
          <span class="keyword">else</span> {
//            if (a.stack.length != b.stack.length)
//              throw new LubError(a, b, &quot;Invalid stacks in states: &quot;);
            <span title="object List">List</span>.<a title="(xs: List[CopyPropagation.this.Value],ys: List[CopyPropagation.this.Value])(f: (CopyPropagation.this.Value, CopyPropagation.this.Value) =&gt; CopyPropagation.this.Value)List[CopyPropagation.this.Value]" id="24534">map2</a>(<a href="#341792" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">a</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>, <a href="#341793" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">b</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>) { (<a title="CopyPropagation.this.Value" id="341827">v1</a>, <a title="CopyPropagation.this.Value" id="341828">v2</a>) =&gt; 
              <span title="CopyPropagation.this.Value" class="keyword">if</span> (<a href="#341827" title="(x$1: AnyRef)Boolean">v1</a> == <a href="#341828" title="CopyPropagation.this.Value">v2</a>) <a href="#341827" title="CopyPropagation.this.Value">v1</a> <span class="keyword">else</span> <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> 
            }
          }
      
/*        if (a.stack.length != b.stack.length)
          throw new LubError(a, b, &quot;Invalid stacks in states: &quot;);
        val resStack = List.map2(a.stack, b.stack) { (v1, v2) =&gt; 
          if (v1 == v2) v1 else Unknown 
        }
        */
        <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]" id="341808">resBindings</a> = <span title="scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]">HashMap</span>[Location, Value]
        
        <span class="keyword">for</span> ((<a title="CopyPropagation.this.Location" id="341910">k</a>, <a title="CopyPropagation.this.Value" id="341911">v</a>) &lt;- <a href="#341792" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">a</a>.<a href="#341347" title="(f: ((CopyPropagation.this.Location, CopyPropagation.this.Value)) =&gt; scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value])Unit" id="25590">bindings</a> <span class="keyword">if</span> <a href="#341793" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">b</a>.<a href="#341347" title="=&gt; scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Bindings">bindings</a>.<span title="(key: CopyPropagation.this.Location)Boolean">isDefinedAt</span><span title="(x$1: Boolean)Boolean">(</span><a href="#341910" title="CopyPropagation.this.Location">k</a>) &amp;&amp; <a href="#341911" title="(x$1: AnyRef)Boolean">v</a> == <a href="#341793" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.Elem">b</a>.<a href="#341347" title="(key: CopyPropagation.this.Location)CopyPropagation.this.Value">bindings</a>(<a href="#341910" title="CopyPropagation.this.Location">k</a>))
          <a href="#341808" title="(kv: (CopyPropagation.this.Location, CopyPropagation.this.Value))resBindings.type">resBindings</a> += (<a href="#341910" title="(y: CopyPropagation.this.Value)(CopyPropagation.this.Location, CopyPropagation.this.Value)">k</a> -&gt; <a href="#341911" title="CopyPropagation.this.Value">v</a>);
        <span title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State" class="keyword">new</span> <a href="#155595" title="scala.tools.nsc.backend.icode.analysis.CopyPropagation.copyLattice.State">State</a>(<a href="#341808" title="scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]">resBindings</a>, <a href="#341807" title="List[CopyPropagation.this.Value]">resStack</a>)
      }
    }
  }

  <span class="keyword">final</span> <span class="keyword">class</span> <a title="class CopyAnalysis extends java.lang.Object with scala.tools.nsc.backend.icode.analysis.DataFlowAnalysis[CopyPropagation.this.copyLattice.type] with ScalaObject" id="155586">CopyAnalysis</a> <span title="ScalaObject" class="keyword">extends</span> <a href="DataFlowAnalysis.scala.html#15995" title="scala.tools.nsc.backend.icode.analysis.DataFlowAnalysis[CopyPropagation.this.copyLattice.type]">DataFlowAnalysis</a>[copyLattice.<span class="keyword">type</span>] {
    <span class="keyword">type</span> <a title="CopyPropagation.this.global.icodes.BasicBlock" id="155605">P</a> = <a href="../BasicBlocks.scala.html#46410" title="CopyPropagation.this.global.icodes.BasicBlock">BasicBlock</a>
    <span class="keyword">val</span> <a title="CopyPropagation.this.copyLattice.type" id="155606">lattice</a> = <a href="#155584" title="object CopyPropagation.this.copyLattice">copyLattice</a>

    <span class="keyword">var</span> <a title="CopyPropagation.this.global.icodes.IMethod" id="155609">method</a>: <a href="../Members.scala.html#46405" title="CopyPropagation.this.global.icodes.IMethod">IMethod</a> = _

    <span class="keyword">def</span> <a title="(m: CopyPropagation.this.global.icodes.IMethod)Unit" id="155611">init</a>(<a title="CopyPropagation.this.global.icodes.IMethod" id="155713">m</a>: <a href="../Members.scala.html#46405" title="CopyPropagation.this.global.icodes.IMethod">IMethod</a>) {
      <a href="#155586" title="CopyAnalysis.this.type" class="keyword">this</a>.<a href="#155609" title="(x$1: CopyPropagation.this.global.icodes.IMethod)Unit">method</a> = <a href="#155713" title="CopyPropagation.this.global.icodes.IMethod">m</a>

      <a href="DataFlowAnalysis.scala.html#61432" title="(f: =&gt; Unit)Unit">init</a> {
        <a href="DataFlowAnalysis.scala.html#61418" title="(elem: CopyAnalysis.this.P)CopyAnalysis.this.worklist.type" id="39695">worklist</a> += <a href="#155713" title="CopyPropagation.this.global.icodes.IMethod">m</a>.<a href="../Members.scala.html#61497" title="=&gt; CopyPropagation.this.global.icodes.Code">code</a>.<a href="../Members.scala.html#61661" title="=&gt; CopyPropagation.this.global.icodes.BasicBlock">startBlock</a>
        <a href="DataFlowAnalysis.scala.html#61418" title="(iter: Traversable[CopyAnalysis.this.P])CopyAnalysis.this.worklist.type">worklist</a> ++= (<a href="#155713" title="CopyPropagation.this.global.icodes.IMethod">m</a>.<a href="../Members.scala.html#61503" title="(f: (CopyPropagation.this.global.icodes.ExceptionHandler) =&gt; CopyPropagation.this.global.icodes.BasicBlock)(implicit bf: scala.collection.generic.BuilderFactory[CopyPropagation.this.global.icodes.BasicBlock,List[CopyPropagation.this.global.icodes.BasicBlock],List[CopyPropagation.this.global.icodes.ExceptionHandler]])List[CopyPropagation.this.global.icodes.BasicBlock]">exh</a> <span title="scala.collection.generic.BuilderFactory[CopyPropagation.this.global.icodes.BasicBlock,List[CopyPropagation.this.global.icodes.BasicBlock],List#Coll]">map</span> (<a href="#342018" title="CopyPropagation.this.global.icodes.ExceptionHandler">_</a>.<a href="../ExceptionHandlers.scala.html#61714" title="=&gt; CopyPropagation.this.global.icodes.BasicBlock">startBlock</a>))
        <a href="#155713" title="CopyPropagation.this.global.icodes.IMethod">m</a>.<a href="../Members.scala.html#61497" title="=&gt; CopyPropagation.this.global.icodes.Code">code</a>.<a href="../Members.scala.html#61659" title="=&gt; scala.collection.mutable.ListBuffer[CopyPropagation.this.global.icodes.BasicBlock]">blocks</a>.<a title="(f: (CopyPropagation.this.global.icodes.BasicBlock) =&gt; Unit)Unit" id="62018">foreach</a> { <a title="CopyPropagation.this.global.icodes.BasicBlock" id="342127">b</a> =&gt;
          <a href="DataFlowAnalysis.scala.html#61420" title="(key: CopyAnalysis.this.P,value: CopyAnalysis.this.lattice.Elem)Unit">in</a>(<a href="#342127" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>)  = <a href="#155606" title="=&gt; CopyPropagation.this.copyLattice.type">lattice</a>.<a href="#155599" title="=&gt; CopyAnalysis.this.lattice.State">bottom</a>
          <a href="DataFlowAnalysis.scala.html#61422" title="(key: CopyAnalysis.this.P,value: CopyAnalysis.this.lattice.Elem)Unit">out</a>(<a href="#342127" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>) = <a href="#155606" title="=&gt; CopyPropagation.this.copyLattice.type">lattice</a>.<a href="#155599" title="=&gt; CopyAnalysis.this.lattice.State">bottom</a>
          <a title="(assertion: Boolean)Unit" id="7943">assert</a>(<a href="DataFlowAnalysis.scala.html#61422" title="=&gt; scala.collection.mutable.Map[CopyAnalysis.this.P,CopyAnalysis.this.lattice.Elem]">out</a>.<a title="(key: CopyAnalysis.this.P)Boolean" id="44678">contains</a>(<a href="#342127" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>))
          <a href="../../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Added point: &quot;</span> + <a href="#342127" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>)
        } 
        <a href="#155713" title="CopyPropagation.this.global.icodes.IMethod">m</a>.<a href="../Members.scala.html#61503" title="(f: (CopyPropagation.this.global.icodes.ExceptionHandler) =&gt; Unit)Unit">exh</a> foreach { <a title="CopyPropagation.this.global.icodes.ExceptionHandler" id="342167">e</a> =&gt;
          <a href="DataFlowAnalysis.scala.html#61420" title="(key: CopyAnalysis.this.P,value: CopyAnalysis.this.lattice.Elem)Unit">in</a>(<a href="#342167" title="CopyPropagation.this.global.icodes.ExceptionHandler">e</a>.<a href="../ExceptionHandlers.scala.html#61714" title="=&gt; CopyPropagation.this.global.icodes.BasicBlock">startBlock</a>) = <span title="CopyPropagation.this.copyLattice.State" class="keyword">new</span> <a href="#155584" title="object CopyPropagation.this.copyLattice">copyLattice</a>.<a href="#155595" title="CopyPropagation.this.copyLattice.State">State</a>(<a href="#155584" title="object CopyPropagation.this.copyLattice">copyLattice</a>.<a href="#155594" title="=&gt; scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]">emptyBinding</a>, <a href="#155584" title="object CopyPropagation.this.copyLattice">copyLattice</a>.<a href="#155601" title="=&gt; List[object CopyPropagation.this.Unknown]">exceptionHandlerStack</a>);
        }

        // first block is special: it's not bottom, but a precisely defined state with no bindings
        <a href="DataFlowAnalysis.scala.html#61420" title="(key: CopyAnalysis.this.P,value: CopyAnalysis.this.lattice.Elem)Unit">in</a>(<a href="#155713" title="CopyPropagation.this.global.icodes.IMethod">m</a>.<a href="../Members.scala.html#61497" title="=&gt; CopyPropagation.this.global.icodes.Code">code</a>.<a href="../Members.scala.html#61661" title="=&gt; CopyPropagation.this.global.icodes.BasicBlock">startBlock</a>) = <span title="CopyAnalysis.this.lattice.State" class="keyword">new</span> <a href="#155606" title="=&gt; CopyPropagation.this.copyLattice.type">lattice</a>.<a href="#155595" title="CopyAnalysis.this.lattice.State">State</a>(<a href="#155606" title="=&gt; CopyPropagation.this.copyLattice.type">lattice</a>.<a href="#155594" title="=&gt; scala.collection.mutable.HashMap[CopyPropagation.this.Location,CopyPropagation.this.Value]">emptyBinding</a>, <span title="object Nil">Nil</span>);
      }
    }

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="155612">run</a> {
      <a href="DataFlowAnalysis.scala.html#61435" title="(f: (CopyAnalysis.this.P, CopyAnalysis.this.lattice.Elem) =&gt; CopyAnalysis.this.lattice.Elem)Unit">forwardAnalysis</a>(<a href="#155613" title="(b: CopyPropagation.this.global.icodes.BasicBlock,in: CopyAnalysis.this.lattice.Elem)CopyAnalysis.this.lattice.Elem">blockTransfer</a>)
      <span title="Unit" class="keyword">if</span> (<a href="../../../Global.scala.html#39250" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../../Settings.scala.html#37345" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">debug</a>.<a href="../../../Settings.scala.html#37988" title="=&gt; Boolean">value</a>) {
        <a href="../ICodes.scala.html#46381" title="=&gt; CopyPropagation.this.global.icodes.Linearizer">linearizer</a>.<a href="../Linearizers.scala.html#62481" title="(c: CopyPropagation.this.global.icodes.IMethod)List[CopyPropagation.this.global.icodes.BasicBlock]">linearize</a>(<a href="#155609" title="=&gt; CopyPropagation.this.global.icodes.IMethod">method</a>).<span title="(f: (CopyPropagation.this.global.icodes.BasicBlock) =&gt; Unit)Unit">foreach</span>(<a title="CopyPropagation.this.global.icodes.BasicBlock" id="342222">b</a> =&gt; <span title="Unit" class="keyword">if</span> (<a href="#342222" title="(x$1: AnyRef)Boolean">b</a> != <a href="#155609" title="=&gt; CopyPropagation.this.global.icodes.IMethod">method</a>.<a href="../Members.scala.html#61497" title="=&gt; CopyPropagation.this.global.icodes.Code">code</a>.<a href="../Members.scala.html#61661" title="=&gt; CopyPropagation.this.global.icodes.BasicBlock">startBlock</a>)
          <span title="(assertion: Boolean,message: =&gt; Any)Unit">assert</span>(<a href="DataFlowAnalysis.scala.html#61420" title="(key: CopyAnalysis.this.P)CopyAnalysis.this.lattice.Elem">in</a><span title="(x$1: AnyRef)Boolean">(</span><a href="#342222" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>) != <a href="#155606" title="=&gt; CopyPropagation.this.copyLattice.type">lattice</a>.<a href="#155599" title="=&gt; CopyAnalysis.this.lattice.State">bottom</a>, 
            <span title="(x$1: Any)java.lang.String" class="string">&quot;Block &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#342222" title="CopyPropagation.this.global.icodes.BasicBlock">b</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; in &quot;)" class="string">&quot; in &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155586" title="CopyAnalysis.this.type" class="keyword">this</a>.<a href="#155609" title="=&gt; CopyPropagation.this.global.icodes.IMethod">method</a> + <span title="java.lang.String(&quot; has input equal to bottom -- not visited?&quot;)" class="string">&quot; has input equal to bottom -- not visited?&quot;</span>));
      }
    }

    <span class="keyword">def</span> <a title="(b: CopyPropagation.this.global.icodes.BasicBlock,in: CopyAnalysis.this.lattice.Elem)CopyAnalysis.this.lattice.Elem" id="155613">blockTransfer</a>(<a title="CopyPropagation.this.global.icodes.BasicBlock" id="342190">b</a>: <a href="../BasicBlocks.scala.html#46410" title="CopyPropagation.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="CopyAnalysis.this.lattice.Elem" id="342191">in</a>: lattice.<a href="#155595" title="CopyAnalysis.this.lattice.Elem">Elem</a>): lattice.<a href="#155595" title="CopyAnalysis.this.lattice.Elem">Elem</a> =
      <a href="#342190" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>.<a href="../BasicBlocks.scala.html#61582" title="=&gt; List[CopyPropagation.this.global.icodes.Instruction]">toList</a>.<a title="(z: CopyAnalysis.this.lattice.Elem)(f: (CopyAnalysis.this.lattice.Elem, CopyPropagation.this.global.icodes.Instruction) =&gt; CopyAnalysis.this.lattice.Elem)CopyAnalysis.this.lattice.Elem" id="29129">foldLeft</a>(<a href="#342191" title="CopyAnalysis.this.lattice.Elem">in</a>)(<a href="#155615" title="(in: CopyPropagation.this.copyLattice.Elem,i: CopyPropagation.this.global.icodes.Instruction)CopyPropagation.this.copyLattice.Elem">interpret</a>)
    
    <span class="keyword">import</span> opcodes._

    /** Abstract interpretation for one instruction. */
    <span class="keyword">def</span> <a title="(in: CopyPropagation.this.copyLattice.Elem,i: CopyPropagation.this.global.icodes.Instruction)CopyPropagation.this.copyLattice.Elem" id="155615">interpret</a>(<a title="CopyPropagation.this.copyLattice.Elem" id="156482">in</a>: copyLattice.<a href="#155595" title="CopyPropagation.this.copyLattice.Elem">Elem</a>, <a title="CopyPropagation.this.global.icodes.Instruction" id="156483">i</a>: <a href="../Opcodes.scala.html#46414" title="CopyPropagation.this.global.icodes.Instruction">Instruction</a>): copyLattice.<a href="#155595" title="CopyPropagation.this.copyLattice.Elem">Elem</a> = {
      <span class="keyword">var</span> <a title="CopyPropagation.this.copyLattice.State" id="342291">out</a> = <a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>.<a href="#155764" title="=&gt; CopyPropagation.this.copyLattice.State">dup</a>

      <span title="Unit" class="keyword">if</span> (<a href="../../../Global.scala.html#39250" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../../Settings.scala.html#37345" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">debug</a>.<a href="../../../Settings.scala.html#37988" title="=&gt; Boolean">value</a>) {
        <a href="../../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;- &quot;</span> + <a href="#156483" title="CopyPropagation.this.global.icodes.Instruction">i</a>)
        <a href="../../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;in: &quot;</span> + <a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>)
        <a href="../../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>)
      }

      <a href="#156483" title="CopyPropagation.this.global.icodes.Instruction">i</a> <span title="Any" class="keyword">match</span> {
        <span title="Unit" class="keyword">case</span> THIS(_) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#155855" title="(l: CopyPropagation.this.Location)CopyPropagation.this.Deref">Deref</a>(<a href="#341099" title="object CopyPropagation.this.This">This</a>) <a href="#342307" title="CopyPropagation.this.Deref">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">stack</a>

        <span title="Unit" class="keyword">case</span> CONSTANT(<a title="CopyPropagation.this.global.icodes.global.Constant" id="342324">k</a>) =&gt;
          <span title="Unit" class="keyword">if</span> (<a href="#342324" title="CopyPropagation.this.global.icodes.global.Constant">k</a>.<a href="../../../symtab/Constants.scala.html#43041" title="(x$1: Int)Boolean" id="2975">tag</a> != <span title="Int(1)">UnitTag</span>)
            <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#156531" title="(c: CopyPropagation.this.global.Constant)CopyPropagation.this.Const">Const</a>(<a href="#342324" title="CopyPropagation.this.global.icodes.global.Constant">k</a>) <a href="#342333" title="CopyPropagation.this.Const">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">stack</a>;
          
        <span title="Unit" class="keyword">case</span> LOAD_ARRAY_ITEM(_) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = (<a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#342355" title="CopyPropagation.this.Unknown.type">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span><span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">(</span><span title="Int(2)" class="int">2</span>))

        <span title="Unit" class="keyword">case</span> LOAD_LOCAL(<a title="CopyPropagation.this.global.icodes.Local" id="342369">local</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#155855" title="(l: CopyPropagation.this.Location)CopyPropagation.this.Deref">Deref</a>(<a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a>(<a href="#342369" title="CopyPropagation.this.global.icodes.Local">local</a>)) <a href="#342372" title="CopyPropagation.this.Deref">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">stack</a>

        <span title="Unit" class="keyword">case</span> LOAD_FIELD(<a title="CopyPropagation.this.global.icodes.global.Symbol" id="342396">field</a>, <a title="Boolean" id="342397">isStatic</a>) =&gt;
          <span title="Unit" class="keyword">if</span> (<a href="#342397" title="Boolean">isStatic</a>)
            <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#342400" title="CopyPropagation.this.Unknown.type">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">stack</a>; /* ignore static fields */
          <span class="keyword">else</span> {
            <span class="keyword">val</span> <a title="CopyPropagation.this.Value" id="342410">v1</a> = <a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a> <span title="CopyPropagation.this.Value" class="keyword">match</span> {
              <span title="CopyPropagation.this.Deref" class="keyword">case</span> (<a title="CopyPropagation.this.Record" id="342415">r</a> @ Record(<a title="CopyPropagation.this.global.Symbol" id="342416">cls</a>, <a title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="342417">bindings</a>)) :: <a title="List[CopyPropagation.this.Value]" id="342420">xs</a> =&gt;
                <a href="#155855" title="(l: CopyPropagation.this.Location)CopyPropagation.this.Deref">Deref</a>(<a href="#156205" title="(r: CopyPropagation.this.Record,sym: CopyPropagation.this.global.Symbol)CopyPropagation.this.Field">Field</a>(<a href="#342415" title="CopyPropagation.this.Record">r</a>, <a href="#342396" title="CopyPropagation.this.global.icodes.global.Symbol">field</a>))
              
              <span title="&lt;refinement&gt; extends Product with CopyPropagation.this.Value" class="keyword">case</span> Deref(LocalVar(<a title="CopyPropagation.this.global.icodes.Local" id="342448">l</a>)) :: _ =&gt;
                <a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>.<a href="#155759" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.Value">getBinding</a>(<a href="#342448" title="CopyPropagation.this.global.icodes.Local">l</a>) <span title="&lt;refinement&gt; extends Product with CopyPropagation.this.Value" class="keyword">match</span> {
                  <span title="CopyPropagation.this.Deref" class="keyword">case</span> <a title="CopyPropagation.this.Record" id="342459">r</a> @ Record(<a title="CopyPropagation.this.global.Symbol" id="342460">cls</a>, <a title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="342461">bindings</a>) =&gt; <a href="#155855" title="(l: CopyPropagation.this.Location)CopyPropagation.this.Deref">Deref</a>(<a href="#156205" title="(r: CopyPropagation.this.Record,sym: CopyPropagation.this.global.Symbol)CopyPropagation.this.Field">Field</a>(<a href="#342459" title="CopyPropagation.this.Record">r</a>, <a href="#342396" title="CopyPropagation.this.global.icodes.global.Symbol">field</a>))
                  <span title="CopyPropagation.this.Unknown.type" class="keyword">case</span> _ =&gt; <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a>
                }
                
              <span title="CopyPropagation.this.Value" class="keyword">case</span> Deref(Field(<a title="CopyPropagation.this.Record" id="342495">r</a>, <a title="CopyPropagation.this.global.Symbol" id="342496">f</a>)) :: _ =&gt;
                <span class="keyword">val</span> <a title="Option[CopyPropagation.this.Value]" id="342503">fld</a> = <a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>.<a href="#155761" title="(r: CopyPropagation.this.Record,f: CopyPropagation.this.global.Symbol)Option[CopyPropagation.this.Value]">getFieldValue</a>(<a href="#342495" title="CopyPropagation.this.Record">r</a>, <a href="#342496" title="CopyPropagation.this.global.Symbol">f</a>)
                <a href="#342503" title="Option[CopyPropagation.this.Value]">fld</a> <span title="CopyPropagation.this.Value" class="keyword">match</span> {
                  <span title="CopyPropagation.this.Value" class="keyword">case</span> Some(<a title="CopyPropagation.this.Record" id="342507">r</a> @ Record(<a title="CopyPropagation.this.global.Symbol" id="342508">cls</a>, <a title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="342509">bindings</a>)) <span class="keyword">if</span> <a href="#342509" title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">bindings</a>.<span title="(key: CopyPropagation.this.global.Symbol)Boolean">isDefinedAt</span>(<a href="#342496" title="CopyPropagation.this.global.Symbol">f</a>) =&gt;
                  	<a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>.<a href="#155761" title="(r: CopyPropagation.this.Record,f: CopyPropagation.this.global.Symbol)Option[CopyPropagation.this.Value]">getFieldValue</a>(<a href="#342507" title="CopyPropagation.this.Record">r</a>, <a href="#342496" title="CopyPropagation.this.global.Symbol">f</a>).<a title="(default: =&gt; CopyPropagation.this.Value)CopyPropagation.this.Value" id="35236">getOrElse</a>(<a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a>)
                  <span title="CopyPropagation.this.Unknown.type" class="keyword">case</span> _ =&gt; <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a>
                }
                
              <span title="CopyPropagation.this.Unknown.type" class="keyword">case</span> _ =&gt; <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a>
            }
            <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342410" title="CopyPropagation.this.Value">v1</a> <a href="#342528" title="CopyPropagation.this.Value">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span><span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">(</span><span title="Int(1)" class="int">1</span>)
          }
            
        <span title="Unit" class="keyword">case</span> LOAD_MODULE(<a title="CopyPropagation.this.global.icodes.global.Symbol" id="342542">module</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#342545" title="CopyPropagation.this.Unknown.type">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">stack</a>
          
        <span title="Unit" class="keyword">case</span> STORE_ARRAY_ITEM(<a title="CopyPropagation.this.global.icodes.TypeKind" id="342556">kind</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(3)" class="int">3</span>)

        <span title="Unit" class="keyword">case</span> STORE_LOCAL(<a title="CopyPropagation.this.global.icodes.Local" id="342565">local</a>) =&gt;
          <a href="#155616" title="(s: CopyPropagation.this.copyLattice.State,target: CopyPropagation.this.Location)Unit">cleanReferencesTo</a>(<a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>, <a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a>(<a href="#342565" title="CopyPropagation.this.global.icodes.Local">local</a>))
          <a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a> <span title="Any" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> :: <a title="List[CopyPropagation.this.Value]" id="342583">xs</a> =&gt; <span title="Unit">(</span>)
            <span title="Any" class="keyword">case</span> <a title="CopyPropagation.this.Value" id="342590">v</a> :: <a title="List[CopyPropagation.this.Value]" id="342591">vs</a> =&gt; 
              <a href="#342590" title="CopyPropagation.this.Value">v</a> <span title="Any" class="keyword">match</span> {
                <span title="Any" class="keyword">case</span> Deref(LocalVar(<a title="CopyPropagation.this.global.icodes.Local" id="342594">other</a>)) =&gt;
                  <span title="Any" class="keyword">if</span> (<a href="#342594" title="(x$1: AnyRef)Boolean">other</a> != <a href="#342565" title="CopyPropagation.this.global.icodes.Local">local</a>) 
                    <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341347" title="(kv: (CopyPropagation.this.Location, CopyPropagation.this.Value))scala.collection.mutable.Map[CopyPropagation.this.Location,CopyPropagation.this.Value]">bindings</a> += (<a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a><span title="(y: CopyPropagation.this.Value)(CopyPropagation.this.LocalVar, CopyPropagation.this.Value)">(</span><a href="#342565" title="CopyPropagation.this.global.icodes.Local">local</a>) -&gt; <a href="#342590" title="CopyPropagation.this.Value">v</a>);
                <span title="scala.collection.mutable.Map[CopyPropagation.this.Location,CopyPropagation.this.Value]" class="keyword">case</span> _ =&gt;
                  <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341347" title="(kv: (CopyPropagation.this.Location, CopyPropagation.this.Value))scala.collection.mutable.Map[CopyPropagation.this.Location,CopyPropagation.this.Value]">bindings</a> += (<a href="#155814" title="(l: CopyPropagation.this.global.icodes.Local)CopyPropagation.this.LocalVar">LocalVar</a><span title="(y: CopyPropagation.this.Value)(CopyPropagation.this.LocalVar, CopyPropagation.this.Value)">(</span><a href="#342565" title="CopyPropagation.this.global.icodes.Local">local</a>) -&gt; <a href="#342590" title="CopyPropagation.this.Value">v</a>)
              }
            <span title="Nothing" class="keyword">case</span> <span title="object Nil">Nil</span> =&gt;
              <span title="object Predef">Predef</span>.<a title="(message: String)Nothing" id="7938">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Incorrect icode in &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155609" title="=&gt; CopyPropagation.this.global.icodes.IMethod">method</a> + <span title="java.lang.String(&quot;. Expecting something on the stack.&quot;)" class="string">&quot;. Expecting something on the stack.&quot;</span>)
          }
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(n: Int)List[CopyPropagation.this.Value]">stack</a> drop <span title="Int(1)" class="int">1</span>;
          
        <span title="Unit" class="keyword">case</span> STORE_THIS(_) =&gt;
          <a href="#155616" title="(s: CopyPropagation.this.copyLattice.State,target: CopyPropagation.this.Location)Unit">cleanReferencesTo</a>(<a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>, <a href="#341099" title="object CopyPropagation.this.This">This</a>)
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(n: Int)List[CopyPropagation.this.Value]">stack</a> drop <span title="Int(1)" class="int">1</span>
          
        <span title="Any" class="keyword">case</span> STORE_FIELD(<a title="CopyPropagation.this.global.icodes.global.Symbol" id="342747">field</a>, <a title="Boolean" id="342748">isStatic</a>) =&gt;
          <span title="Any" class="keyword">if</span> (<a href="#342748" title="Boolean">isStatic</a>) 
            <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(1)" class="int">1</span>);
          <span class="keyword">else</span> {
            <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(2)" class="int">2</span>);
            <a href="#155616" title="(s: CopyPropagation.this.copyLattice.State,target: CopyPropagation.this.Location)Unit">cleanReferencesTo</a>(<a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>, <a href="#156205" title="(r: CopyPropagation.this.Record,sym: CopyPropagation.this.global.Symbol)CopyPropagation.this.Field">Field</a>(<a href="#155582" title="object CopyPropagation.this.AllRecords">AllRecords</a>, <a href="#342747" title="CopyPropagation.this.global.icodes.global.Symbol">field</a>));
            <a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a> <span title="Any" class="keyword">match</span> {
              <span title="bindings.type" class="keyword">case</span> <a title="CopyPropagation.this.Value" id="342777">v</a> :: Record(_, <a title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="342782">bindings</a>) :: <a title="List[CopyPropagation.this.Value]" id="342785">vs</a> =&gt;
                <a href="#342782" title="(kv: (CopyPropagation.this.global.Symbol, CopyPropagation.this.Value))bindings.type">bindings</a> += (<a href="#342747" title="(y: CopyPropagation.this.Value)(CopyPropagation.this.global.icodes.global.Symbol, CopyPropagation.this.Value)">field</a> -&gt; <a href="#342777" title="CopyPropagation.this.Value">v</a>)
              <span title="Unit" class="keyword">case</span> _ =&gt; <span title="Unit">(</span>);
            }
          }
          
        <span title="Unit" class="keyword">case</span> CALL_PRIMITIVE(<a title="CopyPropagation.this.global.icodes.Primitive" id="342840">primitive</a>) =&gt;
          // TODO: model primitives
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#342843" title="CopyPropagation.this.Unknown.type">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span><span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">(</span><a href="#156483" title="CopyPropagation.this.global.icodes.Instruction">i</a>.<a href="../Opcodes.scala.html#61737" title="=&gt; Int">consumed</a>)

        <span title="Unit" class="keyword">case</span> CALL_METHOD(<a title="CopyPropagation.this.global.icodes.global.Symbol" id="342858">method</a>, <a title="CopyPropagation.this.global.icodes.opcodes.InvokeStyle" id="342859">style</a>) =&gt; <a href="#342859" title="CopyPropagation.this.global.icodes.opcodes.InvokeStyle">style</a> <span title="Unit" class="keyword">match</span> {
          <span title="Unit" class="keyword">case</span> <a href="../Opcodes.scala.html#46673" title="object CopyPropagation.this.global.icodes.opcodes.Dynamic">Dynamic</a> | <a href="../Opcodes.scala.html#46675" title="object CopyPropagation.this.global.icodes.opcodes.InvokeDynamic">InvokeDynamic</a> =&gt;
            <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a> = <a href="#155617" title="(state: CopyPropagation.this.copyLattice.State,method: CopyPropagation.this.global.Symbol,static: Boolean)CopyPropagation.this.copyLattice.State">simulateCall</a>(<a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>, <a href="#342858" title="CopyPropagation.this.global.icodes.global.Symbol">method</a>, <span title="Boolean(false)" class="keyword">false</span>)

          <span title="Unit" class="keyword">case</span> Static(<a title="Boolean" id="342868">onInstance</a>) =&gt;
            <span title="Unit" class="keyword">if</span> (<a href="#342868" title="Boolean">onInstance</a>) {
              <span class="keyword">val</span> <a title="CopyPropagation.this.Value" id="342871">obj</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<a href="#342858" title="CopyPropagation.this.global.icodes.global.Symbol">method</a>.<a href="../../../symtab/Symbols.scala.html#27163" title="=&gt; CopyPropagation.this.global.icodes.global.Type">info</a>.<a href="../../../symtab/Types.scala.html#30386" title="=&gt; List[CopyPropagation.this.global.icodes.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span>).<span title="=&gt; CopyPropagation.this.Value">head</span>
//              if (method.isPrimaryConstructor) {
              <span title="Unit" class="keyword">if</span> (<a href="#342858" title="CopyPropagation.this.global.icodes.global.Symbol">method</a>.<a href="../../../symtab/Symbols.scala.html#27118" title="=&gt; Boolean">isPrimaryConstructor</a>/* &amp;&amp; isClosureClass(method.owner)*/) {
                <a href="#342871" title="CopyPropagation.this.Value">obj</a> <span title="Unit" class="keyword">match</span> {
                  <span title="Unit" class="keyword">case</span> Record(_, <a title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="342877">bindings</a>) =&gt;
                    <span class="keyword">for</span> (<a title="CopyPropagation.this.Value" id="342930">v</a> &lt;- <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">take</span><span title="(f: (CopyPropagation.this.Value) =&gt; scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value])Unit">(</span><a href="#342858" title="CopyPropagation.this.global.icodes.global.Symbol">method</a>.<a href="../../../symtab/Symbols.scala.html#27163" title="=&gt; CopyPropagation.this.global.icodes.global.Type">info</a>.<a href="../../../symtab/Types.scala.html#30386" title="=&gt; List[CopyPropagation.this.global.icodes.global.Type]">paramTypes</a>.<span title="(x$1: Int)Int">length</span> + <span title="Int(1)" class="int">1</span>)
                         <span class="keyword">if</span> <a href="#342930" title="(x$1: AnyRef)Boolean" id="6613">v</a> ne <a href="#342871" title="CopyPropagation.this.Value">obj</a>) {
                       <a href="#342877" title="(iter: Traversable[(CopyPropagation.this.global.Symbol, CopyPropagation.this.Value)])bindings.type">bindings</a> ++= <a href="#155619" title="(in: CopyPropagation.this.copyLattice.State,ctor: CopyPropagation.this.global.Symbol)scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">getBindingsForPrimaryCtor</a>(<a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>, <a href="#342858" title="CopyPropagation.this.global.icodes.global.Symbol">method</a>);
                    }
                  <span title="Unit" class="keyword">case</span> _ =&gt; <span title="Unit">(</span>)
                }
                // put the Record back on the stack and remove the 'returned' value
                <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="(x$1: Int)Int" class="int">1</span> + <a href="#342858" title="CopyPropagation.this.global.icodes.global.Symbol">method</a>.<a href="../../../symtab/Symbols.scala.html#27163" title="=&gt; CopyPropagation.this.global.icodes.global.Type">info</a>.<a href="../../../symtab/Types.scala.html#30386" title="=&gt; List[CopyPropagation.this.global.icodes.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span>)
              } <span class="keyword">else</span>
                <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a> = <a href="#155617" title="(state: CopyPropagation.this.copyLattice.State,method: CopyPropagation.this.global.Symbol,static: Boolean)CopyPropagation.this.copyLattice.State">simulateCall</a>(<a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>, <a href="#342858" title="CopyPropagation.this.global.icodes.global.Symbol">method</a>, <span title="Boolean(false)" class="keyword">false</span>)
            } <span class="keyword">else</span> 
              <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a> = <a href="#155617" title="(state: CopyPropagation.this.copyLattice.State,method: CopyPropagation.this.global.Symbol,static: Boolean)CopyPropagation.this.copyLattice.State">simulateCall</a>(<a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>, <a href="#342858" title="CopyPropagation.this.global.icodes.global.Symbol">method</a>, <span title="Boolean(true)" class="keyword">true</span>)

          <span title="Unit" class="keyword">case</span> SuperCall(_) =&gt;
            <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a> = <a href="#155617" title="(state: CopyPropagation.this.copyLattice.State,method: CopyPropagation.this.global.Symbol,static: Boolean)CopyPropagation.this.copyLattice.State">simulateCall</a>(<a href="#156482" title="CopyPropagation.this.copyLattice.Elem">in</a>, <a href="#342858" title="CopyPropagation.this.global.icodes.global.Symbol">method</a>, <span title="Boolean(false)" class="keyword">false</span>)
        }
        
        <span title="Unit" class="keyword">case</span> BOX(<a title="CopyPropagation.this.global.icodes.TypeKind" id="342988">tpe</a>) =&gt;
          <span class="keyword">val</span> <a title="CopyPropagation.this.Value" id="342991">top</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="=&gt; CopyPropagation.this.Value">head</span>
          <a href="#342991" title="CopyPropagation.this.Value">top</a> <span title="Unit" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> Deref(<a title="CopyPropagation.this.Location" id="342993">loc</a>) =&gt; 
              <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#156307" title="(l: CopyPropagation.this.Location)CopyPropagation.this.Boxed">Boxed</a>(<a href="#342993" title="CopyPropagation.this.Location">loc</a>) <a href="#342996" title="CopyPropagation.this.Boxed">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">tail</span>
            <span title="Unit" class="keyword">case</span> _ =&gt;
              <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#343016" title="CopyPropagation.this.Unknown.type">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span><span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">(</span><span title="Int(1)" class="int">1</span>)
          }

        <span title="Any" class="keyword">case</span> UNBOX(<a title="CopyPropagation.this.global.icodes.TypeKind" id="343030">tpe</a>) =&gt;
          <span class="keyword">val</span> <a title="CopyPropagation.this.Value" id="343033">top</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="=&gt; CopyPropagation.this.Value">head</span>
          <a href="#343033" title="CopyPropagation.this.Value">top</a> <span title="Any" class="keyword">match</span> {
            <span title="List[CopyPropagation.this.Value]" class="keyword">case</span> Boxed(<a title="CopyPropagation.this.Location" id="343035">loc</a>) =&gt; <a href="#155855" title="(l: CopyPropagation.this.Location)CopyPropagation.this.Deref">Deref</a>(<a href="#343035" title="CopyPropagation.this.Location">loc</a>) <a href="#343038" title="CopyPropagation.this.Deref">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">tail</span>
            <span title="Unit" class="keyword">case</span> _          =&gt; <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#343053" title="CopyPropagation.this.Unknown.type">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span><span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">(</span><span title="Int(1)" class="int">1</span>)
          }
          
        <span title="Unit" class="keyword">case</span> NEW(<a title="CopyPropagation.this.global.icodes.REFERENCE" id="343073">kind</a>) =&gt;
          <span class="keyword">val</span> <a title="&lt;refinement&gt; extends Product with CopyPropagation.this.Value" id="343076">v1</a> = 
            <a href="#343073" title="CopyPropagation.this.global.icodes.REFERENCE">kind</a> <span title="&lt;refinement&gt; extends Product with CopyPropagation.this.Value" class="keyword">match</span> {
              <span title="CopyPropagation.this.Record" class="keyword">case</span> REFERENCE(<a title="CopyPropagation.this.global.icodes.global.Symbol" id="343078">cls</a>) =&gt;
                <a href="#156035" title="(cls: CopyPropagation.this.global.Symbol,bindings: scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value])CopyPropagation.this.Record">Record</a>(<a href="#343078" title="CopyPropagation.this.global.icodes.global.Symbol">cls</a>, <span title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">HashMap</span>[Symbol, Value])
              // bq: changed from _ to null, otherwise would be unreachable
              <span title="CopyPropagation.this.Unknown.type" class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> =&gt;
                <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a>
            }
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#343076" title="&lt;refinement&gt; extends Product with CopyPropagation.this.Value">v1</a> <a href="#343109" title="&lt;refinement&gt; extends Product with CopyPropagation.this.Value">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">stack</a>

        <span title="Unit" class="keyword">case</span> CREATE_ARRAY(<a title="CopyPropagation.this.global.icodes.TypeKind" id="343121">elem</a>, <a title="Int" id="343122">dims</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#343125" title="CopyPropagation.this.Unknown.type">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span><span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">(</span><a href="#343122" title="Int">dims</a>)
          
        <span title="Unit" class="keyword">case</span> IS_INSTANCE(<a title="CopyPropagation.this.global.icodes.TypeKind" id="343139">tpe</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#343142" title="CopyPropagation.this.Unknown.type">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span><span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">(</span><span title="Int(1)" class="int">1</span>)
          
        <span title="Unit" class="keyword">case</span> CHECK_CAST(<a title="CopyPropagation.this.global.icodes.TypeKind" id="343156">tpe</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#343159" title="CopyPropagation.this.Unknown.type">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span><span title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">(</span><span title="Int(1)" class="int">1</span>)
          
        <span title="Unit" class="keyword">case</span> SWITCH(<a title="List[List[Int]]" id="343174">tags</a>, <a title="List[CopyPropagation.this.global.icodes.BasicBlock]" id="343175">labels</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(1)" class="int">1</span>)
          
        <span title="Unit" class="keyword">case</span> JUMP(<a title="CopyPropagation.this.global.icodes.BasicBlock" id="343184">whereto</a>) =&gt;
          <span title="Unit">(</span>)
          
        <span title="Unit" class="keyword">case</span> CJUMP(<a title="CopyPropagation.this.global.icodes.BasicBlock" id="343191">success</a>, <a title="CopyPropagation.this.global.icodes.BasicBlock" id="343192">failure</a>, <a title="CopyPropagation.this.global.icodes.TestOp" id="343193">cond</a>, <a title="CopyPropagation.this.global.icodes.TypeKind" id="343194">kind</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(2)" class="int">2</span>)
          
        <span title="Unit" class="keyword">case</span> CZJUMP(<a title="CopyPropagation.this.global.icodes.BasicBlock" id="343206">success</a>, <a title="CopyPropagation.this.global.icodes.BasicBlock" id="343207">failure</a>, <a title="CopyPropagation.this.global.icodes.TestOp" id="343208">cond</a>, <a title="CopyPropagation.this.global.icodes.TypeKind" id="343209">kind</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(1)" class="int">1</span>)
          
        <span title="Unit" class="keyword">case</span> RETURN(<a title="CopyPropagation.this.global.icodes.TypeKind" id="343218">kind</a>) =&gt;
          <span title="Unit" class="keyword">if</span> (<a href="#343218" title="(x$1: AnyRef)Boolean">kind</a> != <a href="../TypeKinds.scala.html#46433" title="object CopyPropagation.this.global.icodes.UNIT">UNIT</a>)
            <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(1)" class="int">1</span>)
          
        <span title="Unit" class="keyword">case</span> THROW() =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(1)" class="int">1</span>)
          
        <span title="Unit" class="keyword">case</span> DROP(<a title="CopyPropagation.this.global.icodes.TypeKind" id="343240">kind</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(1)" class="int">1</span>)
          
        <span title="Unit" class="keyword">case</span> DUP(<a title="CopyPropagation.this.global.icodes.TypeKind" id="343249">kind</a>) =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="=&gt; CopyPropagation.this.Value">head</span> <a href="#343252" title="CopyPropagation.this.Value">::</a> <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">stack</a>
          
        <span title="Unit" class="keyword">case</span> MONITOR_ENTER() =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(1)" class="int">1</span>);         

        <span title="Unit" class="keyword">case</span> MONITOR_EXIT() =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(1)" class="int">1</span>)

        <span title="Unit" class="keyword">case</span> SCOPE_ENTER(_) | SCOPE_EXIT(_) =&gt;
          <span title="Unit">(</span>)
        
        <span title="Unit" class="keyword">case</span> LOAD_EXCEPTION() =&gt;
          <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#343285" title="CopyPropagation.this.Unknown.type">::</a> <span title="(x: object CopyPropagation.this.Unknown)List[object CopyPropagation.this.Unknown]">Nil</span>

        <span title="Nothing" class="keyword">case</span> _ =&gt;
          <a href="../ICodes.scala.html#46383" title="=&gt; Unit">dump</a>
          <a href="../../../Global.scala.html#39309" title="(msg: String)Nothing">abort</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Unknown instruction: &quot;</span> + <a href="#156483" title="CopyPropagation.this.global.icodes.Instruction">i</a>)
      }
      <a href="#342291" title="CopyPropagation.this.copyLattice.State">out</a>
    } /* def interpret */

    /** Remove all references to this local variable from both stack
     *  and bindings. It is called when a new assignment destroys 
     *  previous copy-relations.
     */
    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(s: CopyPropagation.this.copyLattice.State,target: CopyPropagation.this.Location)Unit" id="155616">cleanReferencesTo</a>(<a title="CopyPropagation.this.copyLattice.State" id="342568">s</a>: copyLattice.<a href="#155595" title="CopyPropagation.this.copyLattice.State">State</a>, <a title="CopyPropagation.this.Location" id="342569">target</a>: <a href="#155558" title="CopyPropagation.this.Location">Location</a>) {
      <span class="keyword">def</span> <a title="(r: CopyPropagation.this.Record)CopyPropagation.this.Record" id="343299">cleanRecord</a>(<a title="CopyPropagation.this.Record" id="343300">r</a>: <a href="#156035" title="CopyPropagation.this.Record">Record</a>): <a href="#156035" title="CopyPropagation.this.Record">Record</a> = {
        <a href="#343300" title="CopyPropagation.this.Record">r</a>.<a href="#343082" title="(p: (CopyPropagation.this.global.Symbol, CopyPropagation.this.Value) =&gt; Boolean)r.bindings.type">bindings</a> retain { (<a title="CopyPropagation.this.global.Symbol" id="343303">loc</a>, <a title="CopyPropagation.this.Value" id="343304">value</a>) =&gt;
          <span title="(x$1: Boolean)Boolean">(</span><a href="#343304" title="CopyPropagation.this.Value">value</a> <span title="Boolean" class="keyword">match</span> {
            <span title="Boolean(false)" class="keyword">case</span> Deref(<a title="CopyPropagation.this.Location" id="343305">loc1</a>) <span class="keyword">if</span> (<a href="#343305" title="(x$1: AnyRef)Boolean">loc1</a> == <a href="#342569" title="CopyPropagation.this.Location">target</a>) =&gt; <span title="Boolean(false)" class="keyword">false</span>
            <span title="Boolean(false)" class="keyword">case</span> Boxed(<a title="CopyPropagation.this.Location" id="343314">loc1</a>) <span class="keyword">if</span> (<a href="#343314" title="(x$1: AnyRef)Boolean">loc1</a> == <a href="#342569" title="CopyPropagation.this.Location">target</a>)  =&gt; <span title="Boolean(false)" class="keyword">false</span>
            <span title="Boolean(true)" class="keyword">case</span> _ =&gt; <span title="Boolean(true)" class="keyword">true</span>
          }) &amp;&amp; (<a href="#342569" title="CopyPropagation.this.Location">target</a> <span title="Boolean" class="keyword">match</span> {
            <span title="Boolean" class="keyword">case</span> Field(<a href="#155582" title="object CopyPropagation.this.AllRecords">AllRecords</a>, <a title="CopyPropagation.this.global.Symbol" id="343323">sym1</a>) =&gt; <span title="=&gt; Boolean">!</span>(<a href="#343303" title="(x$1: AnyRef)Boolean">loc</a> == <a href="#343323" title="CopyPropagation.this.global.Symbol">sym1</a>)
            <span title="Boolean(true)" class="keyword">case</span> _ =&gt; <span title="Boolean(true)" class="keyword">true</span>
          })
        }
        <a href="#343300" title="CopyPropagation.this.Record">r</a>
      }

      <a href="#342568" title="CopyPropagation.this.copyLattice.State">s</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#342568" title="CopyPropagation.this.copyLattice.State">s</a>.<a href="#341348" title="(f: (CopyPropagation.this.Value) =&gt; CopyPropagation.this.Value)(implicit bf: scala.collection.generic.BuilderFactory[CopyPropagation.this.Value,List[CopyPropagation.this.Value],List[CopyPropagation.this.Value]])List[CopyPropagation.this.Value]">stack</a> <span title="scala.collection.generic.BuilderFactory[CopyPropagation.this.Value,List[CopyPropagation.this.Value],List#Coll]">map</span> { <a title="CopyPropagation.this.Value" id="343344">v</a> =&gt; <a href="#343344" title="CopyPropagation.this.Value">v</a> <span title="CopyPropagation.this.Value" class="keyword">match</span> {
        <span title="CopyPropagation.this.Record" class="keyword">case</span> Record(_, <a title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="343345">bindings</a>) =&gt;
          <a href="#343299" title="(r: CopyPropagation.this.Record)CopyPropagation.this.Record">cleanRecord</a>(<a href="#343344" title="CopyPropagation.this.Value">v</a>.<span title="[T0]T0">asInstanceOf</span><span title="CopyPropagation.this.Record">[</span><a href="#156035" title="CopyPropagation.this.Record">Record</a>])
        <span title="CopyPropagation.this.Unknown.type" class="keyword">case</span> Boxed(<a title="CopyPropagation.this.Location" id="343350">loc1</a>) <span class="keyword">if</span> (<a href="#343350" title="(x$1: AnyRef)Boolean">loc1</a> == <a href="#342569" title="CopyPropagation.this.Location">target</a>) =&gt; <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a>
        <span title="CopyPropagation.this.Value" class="keyword">case</span> _ =&gt; <a href="#343344" title="CopyPropagation.this.Value">v</a>
      }}

      <a href="#342568" title="CopyPropagation.this.copyLattice.State">s</a>.<a href="#341347" title="(p: (CopyPropagation.this.Location, CopyPropagation.this.Value) =&gt; Boolean)s.bindings.type">bindings</a> <span title="Unit">retain</span> { (<a title="CopyPropagation.this.Location" id="343387">loc</a>, <a title="CopyPropagation.this.Value" id="343388">value</a>) =&gt;
        <span title="(x$1: Boolean)Boolean">(</span><a href="#343388" title="CopyPropagation.this.Value">value</a> <span title="Boolean" class="keyword">match</span> {
          <span title="Boolean(false)" class="keyword">case</span> Deref(<a title="CopyPropagation.this.Location" id="343389">loc1</a>) <span class="keyword">if</span> (<a href="#343389" title="(x$1: AnyRef)Boolean">loc1</a> == <a href="#342569" title="CopyPropagation.this.Location">target</a>) =&gt; <span title="Boolean(false)" class="keyword">false</span>
          <span title="Boolean(false)" class="keyword">case</span> Boxed(<a title="CopyPropagation.this.Location" id="343398">loc1</a>) <span class="keyword">if</span> (<a href="#343398" title="(x$1: AnyRef)Boolean">loc1</a> == <a href="#342569" title="CopyPropagation.this.Location">target</a>) =&gt; <span title="Boolean(false)" class="keyword">false</span>
          <span title="Boolean" class="keyword">case</span> <a title="CopyPropagation.this.Record" id="343407">rec</a> @ Record(_, _) =&gt;
            <a href="#343299" title="(r: CopyPropagation.this.Record)CopyPropagation.this.Record">cleanRecord</a>(<a href="#343407" title="CopyPropagation.this.Record">rec</a>);
            <span title="Boolean(true)" class="keyword">true</span>
          <span title="Boolean(true)" class="keyword">case</span> _ =&gt; <span title="Boolean(true)" class="keyword">true</span>
        }) &amp;&amp; 
        (<a href="#343387" title="CopyPropagation.this.Location">loc</a> <span title="Boolean" class="keyword">match</span> {
          <span title="Boolean(false)" class="keyword">case</span> <a title="CopyPropagation.this.Location" id="343412">l</a>: <a href="#155558" title="CopyPropagation.this.Location">Location</a> <span class="keyword">if</span> (<a href="#343412" title="(x$1: AnyRef)Boolean">l</a> == <a href="#342569" title="CopyPropagation.this.Location">target</a>) =&gt; <span title="Boolean(false)" class="keyword">false</span>
          <span title="Boolean(true)" class="keyword">case</span> _ =&gt; <span title="Boolean(true)" class="keyword">true</span>
        })
      }
    }

    /** Update the state &lt;code&gt;s&lt;/code&gt; after the call to &lt;code&gt;method&lt;/code&gt;.
     *  The stack elements are dropped and replaced by the result of the call.
     *  If the method is impure, all bindings to record fields are cleared.
     *
     *  @param state  ...
     *  @param method ...
     *  @param static ...
     *  @return       ...
     */
    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(state: CopyPropagation.this.copyLattice.State,method: CopyPropagation.this.global.Symbol,static: Boolean)CopyPropagation.this.copyLattice.State" id="155617">simulateCall</a>(<a title="CopyPropagation.this.copyLattice.State" id="342862">state</a>: copyLattice.<a href="#155595" title="CopyPropagation.this.copyLattice.State">State</a>, <a title="CopyPropagation.this.global.Symbol" id="342863">method</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>, <a title="Boolean" id="342864">static</a>: <span title="Boolean">Boolean</span>): copyLattice.<a href="#155595" title="CopyPropagation.this.copyLattice.State">State</a> = {
      <span class="keyword">val</span> <a title="CopyPropagation.this.copyLattice.State" id="343423">out</a> = <span title="CopyPropagation.this.copyLattice.State" class="keyword">new</span> <a href="#155584" title="object CopyPropagation.this.copyLattice">copyLattice</a>.<a href="#155595" title="CopyPropagation.this.copyLattice.State">State</a>(<a href="#342862" title="CopyPropagation.this.copyLattice.State">state</a>.<a href="#341347" title="=&gt; CopyPropagation.this.copyLattice.Bindings">bindings</a>, <a href="#342862" title="CopyPropagation.this.copyLattice.State">state</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>);
      <a href="#343423" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#343423" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<a href="#342863" title="CopyPropagation.this.global.Symbol">method</a>.<a href="../../../symtab/Symbols.scala.html#27163" title="=&gt; CopyPropagation.this.global.Type">info</a>.<a href="../../../symtab/Types.scala.html#30386" title="=&gt; List[CopyPropagation.this.global.Type]">paramTypes</a>.<span title="(x$1: Int)Int">length</span> + (<span title="Int" class="keyword">if</span> (<a href="#342864" title="Boolean">static</a>) <span title="Int(0)" class="int">0</span> <span class="keyword">else</span> <span title="Int(1)" class="int">1</span>));
      <span title="Unit" class="keyword">if</span> (<a href="#342863" title="CopyPropagation.this.global.Symbol">method</a>.<a href="../../../symtab/Symbols.scala.html#27163" title="=&gt; CopyPropagation.this.global.Type">info</a>.<a href="../../../symtab/Types.scala.html#30379" title="(x$1: AnyRef)Boolean">resultType</a> <span title="(x$1: Boolean)Boolean">!=</span> <a href="../../../symtab/Definitions.scala.html#26638" title="object CopyPropagation.this.global.definitions">definitions</a>.<a href="../../../symtab/Definitions.scala.html#28463" title="=&gt; CopyPropagation.this.global.Symbol">UnitClass</a>.<a href="../../../symtab/Symbols.scala.html#27162" title="=&gt; CopyPropagation.this.global.Type">tpe</a> &amp;&amp; <span title="=&gt; Boolean">!</span><a href="#342863" title="CopyPropagation.this.global.Symbol">method</a>.<a href="../../../symtab/Symbols.scala.html#27075" title="=&gt; Boolean">isConstructor</a>)
        <a href="#343423" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#341339" title="object CopyPropagation.this.Unknown">Unknown</a> <a href="#343470" title="CopyPropagation.this.Unknown.type">::</a> <a href="#343423" title="CopyPropagation.this.copyLattice.State">out</a>.<a href="#341348" title="(x: CopyPropagation.this.Value)List[CopyPropagation.this.Value]">stack</a>;
      <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#155621" title="(m: CopyPropagation.this.global.Symbol)Boolean">isPureMethod</a>(<a href="#342863" title="CopyPropagation.this.global.Symbol">method</a>))
        <a href="#155618" title="(state: CopyPropagation.this.copyLattice.State)Unit">invalidateRecords</a>(<a href="#343423" title="CopyPropagation.this.copyLattice.State">out</a>);
      <a href="#343423" title="CopyPropagation.this.copyLattice.State">out</a>
    }

    /** Drop everything known about mutable record fields.
     *  
     *  A simple escape analysis would help here. Some of the records we 
     *  track never leak to other methods, therefore they can not be changed.
     *  We should not drop their bindings in this case. A closure object 
     *  would be such an example. Some complications: 
     * 
     *   - outer pointers. An closure escapes as an outer pointer to another
     *     nested closure.
     */
    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(state: CopyPropagation.this.copyLattice.State)Unit" id="155618">invalidateRecords</a>(<a title="CopyPropagation.this.copyLattice.State" id="343484">state</a>: copyLattice.<a href="#155595" title="CopyPropagation.this.copyLattice.State">State</a>) {
      <span class="keyword">def</span> <a title="(sym: CopyPropagation.this.global.Symbol)Boolean" id="343488">shouldRetain</a>(<a title="CopyPropagation.this.global.Symbol" id="343489">sym</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>): <span title="Boolean">Boolean</span> = {
        <span title="Unit" class="keyword">if</span> (<a href="#343489" title="CopyPropagation.this.global.Symbol">sym</a>.<a href="../../../symtab/Symbols.scala.html#27155" title="(mask: Long)Boolean">hasFlag</a>(symtab.Flags.<span title="Long(4096L)">MUTABLE</span>))
          <a href="../../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;dropping binding for &quot;</span> + <a href="#343489" title="CopyPropagation.this.global.Symbol">sym</a>.<a href="../../../symtab/Symbols.scala.html#27248" title="=&gt; String">fullNameString</a>)
        <span title="=&gt; Boolean">!</span><a href="#343489" title="CopyPropagation.this.global.Symbol">sym</a>.<a href="../../../symtab/Symbols.scala.html#27155" title="(mask: Long)Boolean">hasFlag</a>(symtab.Flags.<span title="Long(4096L)">MUTABLE</span>)
      }
      <a href="#343484" title="CopyPropagation.this.copyLattice.State">state</a>.<a href="#341348" title="(x$1: List[CopyPropagation.this.Value])Unit">stack</a> = <a href="#343484" title="CopyPropagation.this.copyLattice.State">state</a>.<a href="#341348" title="(f: (CopyPropagation.this.Value) =&gt; CopyPropagation.this.Value)(implicit bf: scala.collection.generic.BuilderFactory[CopyPropagation.this.Value,List[CopyPropagation.this.Value],List[CopyPropagation.this.Value]])List[CopyPropagation.this.Value]">stack</a> <span title="scala.collection.generic.BuilderFactory[CopyPropagation.this.Value,List[CopyPropagation.this.Value],List#Coll]">map</span> { <a title="CopyPropagation.this.Value" id="343508">v</a> =&gt; <a href="#343508" title="CopyPropagation.this.Value">v</a> <span title="CopyPropagation.this.Value" class="keyword">match</span> {
        <span title="CopyPropagation.this.Record" class="keyword">case</span> Record(<a title="CopyPropagation.this.global.Symbol" id="343509">cls</a>, <a title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="343510">bindings</a>) =&gt;
          <a href="#343510" title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">bindings</a>.<span title="(p: (CopyPropagation.this.global.Symbol, CopyPropagation.this.Value) =&gt; Boolean)bindings.type">retain</span> { (sym: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>, v: <a href="#155567" title="CopyPropagation.this.Value">Value</a>) =&gt; <a href="#343488" title="(sym: CopyPropagation.this.global.Symbol)Boolean">shouldRetain</a>(<a href="#343515" title="CopyPropagation.this.global.Symbol">sym</a>) }
          <a href="#156035" title="(cls: CopyPropagation.this.global.Symbol,bindings: scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value])CopyPropagation.this.Record">Record</a>(<a href="#343509" title="CopyPropagation.this.global.Symbol">cls</a>, <a href="#343510" title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">bindings</a>)
        <span title="CopyPropagation.this.Value" class="keyword">case</span> _ =&gt; <a href="#343508" title="CopyPropagation.this.Value">v</a>
      }}

      <a href="#343484" title="CopyPropagation.this.copyLattice.State">state</a>.<a href="#341347" title="(p: (CopyPropagation.this.Location, CopyPropagation.this.Value) =&gt; Boolean)state.bindings.type">bindings</a> <span title="Unit">retain</span> {(<a title="CopyPropagation.this.Location" id="343545">loc</a>, <a title="CopyPropagation.this.Value" id="343546">value</a>) =&gt;
        <a href="#343546" title="CopyPropagation.this.Value">value</a> <span title="Boolean" class="keyword">match</span> {
          <span title="Boolean" class="keyword">case</span> Deref(Field(<a title="CopyPropagation.this.Record" id="343547">rec</a>, <a title="CopyPropagation.this.global.Symbol" id="343548">sym</a>)) =&gt; <a href="#343488" title="(sym: CopyPropagation.this.global.Symbol)Boolean">shouldRetain</a>(<a href="#343548" title="CopyPropagation.this.global.Symbol">sym</a>)
          <span title="Boolean" class="keyword">case</span> Boxed(Field(<a title="CopyPropagation.this.Record" id="343555">rec</a>, <a title="CopyPropagation.this.global.Symbol" id="343556">sym</a>)) =&gt; <a href="#343488" title="(sym: CopyPropagation.this.global.Symbol)Boolean">shouldRetain</a>(<a href="#343556" title="CopyPropagation.this.global.Symbol">sym</a>)
          <span title="Boolean(true)" class="keyword">case</span> _ =&gt; <span title="Boolean(true)" class="keyword">true</span>
        }
      }
    }

    /** Return bindings from an object fields to the values on the stack. This
     *  method has to find the correct mapping from fields to the order in which
     *  they are passed on the stack. It works for primary constructors.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: CopyPropagation.this.copyLattice.State,ctor: CopyPropagation.this.global.Symbol)scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="155619">getBindingsForPrimaryCtor</a>(<a title="CopyPropagation.this.copyLattice.State" id="342937">in</a>: copyLattice.<a href="#155595" title="CopyPropagation.this.copyLattice.State">State</a>, <a title="CopyPropagation.this.global.Symbol" id="342938">ctor</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>): <span title="scala.collection.mutable.Map[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">Map</span>[Symbol, Value] = {
      <span class="keyword">val</span> <a title="List[CopyPropagation.this.global.Symbol]" id="343565">paramAccessors</a> = <a href="#342938" title="CopyPropagation.this.global.Symbol">ctor</a>.<a href="../../../symtab/Symbols.scala.html#27142" title="=&gt; CopyPropagation.this.global.Symbol">owner</a>.<a href="../../../symtab/Symbols.scala.html#27198" title="=&gt; List[CopyPropagation.this.global.Symbol]">constrParamAccessors</a>;
      <span class="keyword">var</span> <a title="List[CopyPropagation.this.Value]" id="343566">values</a> = <a href="#342937" title="CopyPropagation.this.copyLattice.State">in</a>.<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">take</span>(<span title="(x$1: Int)Int" class="int">1</span> + <a href="#342938" title="CopyPropagation.this.global.Symbol">ctor</a>.<a href="../../../symtab/Symbols.scala.html#27163" title="=&gt; CopyPropagation.this.global.Type">info</a>.<a href="../../../symtab/Types.scala.html#30386" title="=&gt; List[CopyPropagation.this.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span>).<a title="=&gt; List[CopyPropagation.this.Value]" id="24460">reverse</a>.<span title="(n: Int)List[CopyPropagation.this.Value]">drop</span>(<span title="Int(1)" class="int">1</span>);
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" id="343567">bindings</a> = <span title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">HashMap</span>[Symbol, Value];

      <span title="Unit" class="keyword">if</span> (<a href="../../../Global.scala.html#39250" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../../Settings.scala.html#37345" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">debug</a>.<a href="../../../Settings.scala.html#37988" title="=&gt; Boolean">value</a>) <a href="../../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;getBindings for: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#342938" title="CopyPropagation.this.global.Symbol">ctor</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; acc: &quot;)" class="string">&quot; acc: &quot;</span> + <a href="#343565" title="List[CopyPropagation.this.global.Symbol]">paramAccessors</a>)
      
      <span class="keyword">var</span> <a title="List[CopyPropagation.this.global.Type]" id="343568">paramTypes</a> = <a href="#342938" title="CopyPropagation.this.global.Symbol">ctor</a>.<a href="../../../symtab/Symbols.scala.html#27162" title="=&gt; CopyPropagation.this.global.Type">tpe</a>.<a href="../../../symtab/Types.scala.html#30386" title="=&gt; List[CopyPropagation.this.global.Type]">paramTypes</a> 
      <span class="keyword">val</span> <a title="Int" id="343569">diff</a> = <a href="#343568" title="List[CopyPropagation.this.global.Type]">paramTypes</a>.<a title="(x$1: Int)Int" id="2987">length</a> - <a href="#343565" title="List[CopyPropagation.this.global.Symbol]">paramAccessors</a>.<span title="=&gt; Int">length</span>
      <a href="#343569" title="Int">diff</a> <span title="Unit" class="keyword">match</span> {
        <span title="Unit" class="keyword">case</span> <span title="Int(0)" class="int">0</span> =&gt; <span title="Unit">(</span>)
        <span title="Unit" class="keyword">case</span> <span title="Int(1)" class="int">1</span> <span class="keyword">if</span> <a href="#342938" title="CopyPropagation.this.global.Symbol">ctor</a>.<a href="../../../symtab/Symbols.scala.html#27162" title="=&gt; CopyPropagation.this.global.Type">tpe</a>.<a href="../../../symtab/Types.scala.html#30386" title="=&gt; List[CopyPropagation.this.global.Type]">paramTypes</a>.<span title="(x$1: AnyRef)Boolean">head</span> == <a href="#342938" title="CopyPropagation.this.global.Symbol">ctor</a>.<a href="../../../symtab/Symbols.scala.html#27142" title="=&gt; CopyPropagation.this.global.Symbol">owner</a>.<a href="../../../symtab/Symbols.scala.html#26989" title="=&gt; CopyPropagation.this.global.Symbol">rawowner</a>.<a href="../../../symtab/Symbols.scala.html#27162" title="=&gt; CopyPropagation.this.global.Type">tpe</a> =&gt;
          // it's an unused outer
          <a href="../../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;considering unused outer at position 0 in &quot;</span> + <a href="#342938" title="CopyPropagation.this.global.Symbol">ctor</a>.<a href="../../../symtab/Symbols.scala.html#27162" title="=&gt; CopyPropagation.this.global.Type">tpe</a>.<a href="../../../symtab/Types.scala.html#30386" title="=&gt; List[CopyPropagation.this.global.Type]">paramTypes</a>)
          <a href="#343568" title="List[CopyPropagation.this.global.Type]">paramTypes</a> = <a href="#343568" title="List[CopyPropagation.this.global.Type]">paramTypes</a>.<span title="=&gt; List[CopyPropagation.this.global.Type]">tail</span>
          <a href="#343566" title="List[CopyPropagation.this.Value]">values</a> = <a href="#343566" title="List[CopyPropagation.this.Value]">values</a>.<span title="=&gt; List[CopyPropagation.this.Value]">tail</span>
        <span title="Nothing" class="keyword">case</span> _ =&gt;
          <a href="../../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;giving up on &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#342938" title="CopyPropagation.this.global.Symbol">ctor</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;(diff: &quot;)" class="string">&quot;(diff: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#343569" title="Int">diff</a> + <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span>)
          <span title="Nothing" class="keyword">return</span> <a href="#343567" title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">bindings</a>
      }
      
      // this relies on having the same order in paramAccessors and
      // the arguments on the stack. It should be the same!
      <span class="keyword">for</span> ((<a title="CopyPropagation.this.global.Symbol" id="343762">p</a>, <a title="Int" id="343763">i</a>) &lt;- <a href="#343565" title="List[CopyPropagation.this.global.Symbol]">paramAccessors</a>.<a href="#343729" title="(f: ((CopyPropagation.this.global.Symbol, Int)) =&gt; Unit)Unit" id="25621">zipWithIndex</a>) {
//        assert(p.tpe == paramTypes(i), &quot;In: &quot; + ctor.fullNameString
//               + &quot; having acc: &quot; + (paramAccessors map (_.tpe))+ &quot; vs. params&quot; + paramTypes
//               + &quot;\n\t failed at pos &quot; + i + &quot; with &quot; + p.tpe + &quot; == &quot; + paramTypes(i))
        <span title="Any" class="keyword">if</span> (<a href="#343762" title="CopyPropagation.this.global.Symbol">p</a>.<a href="../../../symtab/Symbols.scala.html#27162" title="(x$1: AnyRef)Boolean">tpe</a> == <a href="#343568" title="(n: Int)CopyPropagation.this.global.Type" id="29115">paramTypes</a>(<a href="#343763" title="Int">i</a>))
          <a href="#343567" title="(kv: (CopyPropagation.this.global.Symbol, CopyPropagation.this.Value))bindings.type">bindings</a> += (<a href="#343762" title="(y: CopyPropagation.this.Value)(CopyPropagation.this.global.Symbol, CopyPropagation.this.Value)">p</a> -&gt; <a href="#343566" title="List[CopyPropagation.this.Value]">values</a>.<span title="=&gt; CopyPropagation.this.Value">head</span>);
        <a href="#343566" title="List[CopyPropagation.this.Value]">values</a> = <a href="#343566" title="List[CopyPropagation.this.Value]">values</a>.<span title="=&gt; List[CopyPropagation.this.Value]">tail</span>;
      }

      <span title="Unit" class="keyword">if</span> (<a href="../../../Global.scala.html#39250" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../../Settings.scala.html#37345" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">debug</a>.<a href="../../../Settings.scala.html#37988" title="=&gt; Boolean">value</a>) <a href="../../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;\t&quot;</span> + <a href="#343567" title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">bindings</a>)
      <a href="#343567" title="scala.collection.mutable.HashMap[CopyPropagation.this.global.Symbol,CopyPropagation.this.Value]">bindings</a>
    }

    /** Is &lt;code&gt;cls&lt;/code&gt; a closure class?
     *
     *  @param cls ...
     *  @return    ...
     */
    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(cls: CopyPropagation.this.global.Symbol)Boolean" id="155620">isClosureClass</a>(<a title="CopyPropagation.this.global.Symbol" id="343853">cls</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>): <span title="Boolean">Boolean</span> = 
        <a href="#343853" title="CopyPropagation.this.global.Symbol">cls</a>.<a href="../../../symtab/Symbols.scala.html#27128" title="(x$1: Boolean)Boolean">isFinal</a> &amp;&amp;
        <a href="#343853" title="CopyPropagation.this.global.Symbol">cls</a>.<a href="../../../symtab/Symbols.scala.html#27162" title="=&gt; CopyPropagation.this.global.Type">tpe</a>.<a href="../../../symtab/Types.scala.html#30375" title="=&gt; List[CopyPropagation.this.global.Type]">parents</a>.<a title="(p: (CopyPropagation.this.global.Type) =&gt; Boolean)Boolean" id="29123">exists</a> { <a title="CopyPropagation.this.global.Type" id="343860">t</a> =&gt; 
          <span class="keyword">val</span> TypeRef<a href="#343867" title="CopyPropagation.this.global.Symbol" id="343861">(</a>_, <a title="CopyPropagation.this.global.Symbol" id="343867">sym</a>, _) = <a href="#343860" title="CopyPropagation.this.global.Type">t</a>;
          <a href="../../../symtab/Definitions.scala.html#26638" title="object CopyPropagation.this.global.definitions">definitions</a>.<a href="../../../symtab/Definitions.scala.html#28641" title="(p: (CopyPropagation.this.global.Symbol) =&gt; Boolean)Boolean" id="25897">FunctionClass</a> exists <a href="#343861" title="CopyPropagation.this.global.Symbol">sym</a>.<a href="#343876" title="(x$1: AnyRef)Boolean">==</a>
        }

    /** Is symbol &lt;code&gt;m&lt;/code&gt; a pure method?
     *
     *  @param m ...
     *  @return  ...
     */
    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(m: CopyPropagation.this.global.Symbol)Boolean" id="155621">isPureMethod</a>(<a title="CopyPropagation.this.global.Symbol" id="343480">m</a>: <a href="../../../symtab/Symbols.scala.html#26286" title="CopyPropagation.this.global.Symbol">Symbol</a>): <span title="Boolean">Boolean</span> = 
      <a href="#343480" title="CopyPropagation.this.global.Symbol">m</a>.<a href="../../../symtab/Symbols.scala.html#27064" title="=&gt; Boolean">isGetter</a> // abstract getters are still pure, as we 'know'

    <span class="keyword">final</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="155622">toString</a>(): <span title="String">String</span> = {
      <span class="keyword">var</span> <a title="java.lang.String" id="343890">res</a> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <span class="keyword">for</span> (<a title="CopyPropagation.this.global.icodes.BasicBlock" id="343909">b</a> &lt;- <a href="#155586" title="CopyAnalysis.this.type" class="keyword">this</a>.<a href="#155609" title="=&gt; CopyPropagation.this.global.icodes.IMethod">method</a>.<a href="../Members.scala.html#61497" title="=&gt; CopyPropagation.this.global.icodes.Code">code</a>.<a href="../Members.scala.html#61659" title="=&gt; scala.collection.mutable.ListBuffer[CopyPropagation.this.global.icodes.BasicBlock]">blocks</a>.<a title="(f: (CopyPropagation.this.global.icodes.BasicBlock) =&gt; Unit)Unit" id="61864">toList</a>)
        <a href="#343890" title="java.lang.String">res</a> = <span title="(x$1: Any)java.lang.String">(</span><a href="#343890" title="(x$1: Any)java.lang.String">res</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012IN(&quot;)" class="string">&quot;\nIN(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#343909" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>.<a href="../BasicBlocks.scala.html#61544" title="=&gt; Int">label</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;):\011 Bindings: &quot;)" class="string">&quot;):\t Bindings: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="DataFlowAnalysis.scala.html#61420" title="(key: CopyAnalysis.this.P)CopyAnalysis.this.lattice.Elem">in</a>(<a href="#343909" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>).<a href="#341347" title="=&gt; CopyAnalysis.this.lattice.Bindings">bindings</a> <span title="(x$1: Any)java.lang.String">+</span>
               <span title="java.lang.String(&quot;\012IN(&quot;)" class="string">&quot;\nIN(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#343909" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>.<a href="../BasicBlocks.scala.html#61544" title="=&gt; Int">label</a> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;):\011 Stack: &quot;)" class="string">&quot;):\t Stack: &quot;</span> + <a href="DataFlowAnalysis.scala.html#61420" title="(key: CopyAnalysis.this.P)CopyAnalysis.this.lattice.Elem">in</a>(<a href="#343909" title="CopyPropagation.this.global.icodes.BasicBlock">b</a>).<a href="#341348" title="=&gt; List[CopyPropagation.this.Value]">stack</a>) + <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>;
      <a href="#343890" title="java.lang.String">res</a>
    }

  } /* class CopyAnalysis */
}

        </pre>
    </body>
</html>