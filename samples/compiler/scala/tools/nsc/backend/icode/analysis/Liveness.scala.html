<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/backend/icode/analysis/Liveness.scala</title>
        <script type="text/javascript" src="../../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */</span>

<span class="comment">// $Id: Liveness.scala 16884 2009-01-09 16:52:09Z cunei $</span>

<span class="keyword">package</span> scala.tools.nsc.backend.icode.analysis

<span class="keyword">import</span> scala.collection.mutable.{HashMap, Map}
<span class="keyword">import</span> scala.collection.immutable.{Set, ListSet}

<span class="comment">/**
 * Compute liveness information for local variables.
 *
 * @author Iulian Dragos
 */</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Liveness extends java.lang.Object with ScalaObject</span><a id="16579">Liveness</a></span> {
  <span class="keyword">val</span> <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a id="108194">global</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Global</span><a href="../../../Global.scala.html#6489">Global</a></span>
  <span class="keyword">import</span> global._
  <span class="keyword">import</span> icodes._

  <span class="comment">/** The lattice for this analysis.   */</span>
  <span class="keyword">object</span> <span class="typed"><span class="type">object Liveness.this.livenessLattice</span><a id="108197">livenessLattice</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.CompleteLattice</span><a href="CompleteLattice.scala.html#16768">CompleteLattice</a></span> {
    <span class="keyword">type</span> <span class="typed"><span class="type">scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a id="146381">Elem</a></span> = <span class="typed"><span class="type">scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a id="26500">Set</a></span>[Local]

    <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><span id="146383"><a id="146382">top</a></span></span>: <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a id="26500">Elem</a></span> = <span class="typed"><span class="type">template $anon extends scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="146388" class="keyword">new</a></span> <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="26287">ListSet</a></span>[Local]() {
      <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Any)Boolean</span><a id="146390">equals</a></span>(<span class="typed"><span class="type">Any</span><a id="146392">that</a></span>: <span class="typed"><span class="type">Any</span><a id="51">Any</a></span>): <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = <span class="typed"><span class="type">this.type</span><a href="#146388" class="keyword">this</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5794">eq</a></span> <span class="typed"><span class="type">Any</span><a href="#146392">that</a></span>.<span class="typed"><span class="type">AnyRef</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">AnyRef</span><a id="2017">AnyRef</a></span>]
    }

    <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><span id="146385"><a id="146384">bottom</a></span></span>: <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a id="26500">Elem</a></span> = <span class="typed"><span class="type">template $anon extends scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="146393" class="keyword">new</a></span> <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="26287">ListSet</a></span>[Local]() {
      <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Any)Boolean</span><a id="146395">equals</a></span>(<span class="typed"><span class="type">Any</span><a id="146397">that</a></span>: <span class="typed"><span class="type">Any</span><a id="51">Any</a></span>): <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = <span class="typed"><span class="type">this.type</span><a href="#146393" class="keyword">this</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5794">eq</a></span> <span class="typed"><span class="type">Any</span><a href="#146397">that</a></span>.<span class="typed"><span class="type">AnyRef</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">AnyRef</span><a id="2017">AnyRef</a></span>]
    }

    <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem,scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem)scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a id="146386">lub2</a></span>(<span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a id="146398">a</a></span>: <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a id="26500">Elem</a></span>, <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a id="146399">b</a></span>: <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a id="26500">Elem</a></span>): <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a id="26500">Elem</a></span> = <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a href="#146398">a</a></span> <span class="typed"><span class="type">(Iterable[Liveness.this.global.icodes.Local])scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a id="31140">++</a></span> <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.Liveness.livenessLattice.Elem</span><a href="#146399">b</a></span>
  }

  <span class="keyword">final</span> <span class="keyword">class</span> <span class="typed"><span class="type">class LivenessAnalysis extends java.lang.Object with scala.tools.nsc.backend.icode.analysis.DataFlowAnalysis[Liveness.this.livenessLattice.type] with ScalaObject</span><a id="108199">LivenessAnalysis</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.backend.icode.analysis.DataFlowAnalysis[Liveness.this.livenessLattice.type]</span><a href="DataFlowAnalysis.scala.html#16657">DataFlowAnalysis</a></span>[livenessLattice.<span class="keyword">type</span>] {
    <span class="keyword">type</span> <span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a id="146412">P</a></span> = <span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="../BasicBlocks.scala.html#32337">BasicBlock</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">Liveness.this.livenessLattice.type</span><span id="146414"><a id="146413">lattice</a></span></span> = <span class="typed"><span class="type">object Liveness.this.livenessLattice</span><a href="#108197">livenessLattice</a></span>

    <span class="keyword">var</span> <span class="typed"><span class="type">Liveness.this.global.icodes.IMethod</span><span id="146417"><span id="146415"><span id="146416"><a id="146430">method</a></span></span></span></span>: <span class="typed"><span class="type">Liveness.this.global.icodes.IMethod</span><a href="../Members.scala.html#32332">IMethod</a></span> = _

    <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><span id="146419"><a id="146418">gen</a></span></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><a id="19880">Map</a></span>[BasicBlock, Set[Local]] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><a id="20081">HashMap</a></span>()
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><span id="146421"><a id="146420">kill</a></span></span>:<span class="typed"><span class="type">scala.collection.mutable.Map[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><a id="19880">Map</a></span>[BasicBlock, Set[Local]] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><a id="20081">HashMap</a></span>()

    <span class="keyword">def</span> <span class="typed"><span class="type">(Liveness.this.global.icodes.IMethod)Unit</span><a id="146422">init</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.IMethod</span><a id="146435">m</a></span>: <span class="typed"><span class="type">Liveness.this.global.icodes.IMethod</span><a href="../Members.scala.html#32332">IMethod</a></span>) {
      <span class="typed"><span class="type">LivenessAnalysis.this.type</span><a href="#108199" class="keyword">this</a></span>.<span class="typed"><span class="type">(Liveness.this.global.icodes.IMethod)Unit</span><a href="#146416">method</a></span> = <span class="typed"><span class="type">Liveness.this.global.icodes.IMethod</span><a href="#146435">m</a></span>
      <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><a href="#146418">gen</a></span>.<span class="typed"><span class="type">()Unit</span><a id="24207">clear</a></span>
      <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><a href="#146420">kill</a></span>.<span class="typed"><span class="type">()Unit</span><a id="24207">clear</a></span>

      <span class="keyword">for</span> (<span class="typed"><span class="type">(((Liveness.this.global.icodes.BasicBlock, (scala.collection.immutable.Set[Liveness.this.global.icodes.Local], scala.collection.immutable.Set[Liveness.this.global.icodes.Local]))) =&gt; Unit)Unit</span><span id="21366"><span id="146446"><span id="146442"><span id="23590"><span id="146457"><span id="21362"><span id="23625"><span id="146440"><span id="1379"><span id="23578"><a id="449">b</a></span></span></span></span></span></span></span></span></span></span></span> &lt;- <span class="typed"><span class="type">Liveness.this.global.icodes.IMethod</span><a href="#146435">m</a></span>.<span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.Code</span><a href="../Members.scala.html#32867">code</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[Liveness.this.global.icodes.BasicBlock]</span><a href="../Members.scala.html#33274">blocks</a></span>.<span class="typed"><span class="type">=&gt; List[Liveness.this.global.icodes.BasicBlock]</span><a id="33309">toList</a></span>;
           <a id="1">(</a><span class="typed"><span class="type">scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><span id="146447"><span id="146443"><span id="23580"><a href="#146441" id="146458">g</a></span></span></span></span>, <span class="typed"><span class="type">scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><span id="146448"><span id="146444"><span id="23582"><a href="#146441" id="146459">k</a></span></span></span></span>) = <span class="typed"><span class="type">(Liveness.this.global.icodes.BasicBlock)(scala.collection.immutable.Set[Liveness.this.global.icodes.Local], scala.collection.immutable.Set[Liveness.this.global.icodes.Local])</span><a href="#146424">genAndKill</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146440">b</a></span>)) {
        <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><a href="#146418">gen</a></span>  <span class="typed"><span class="type">((Liveness.this.global.icodes.BasicBlock, scala.collection.immutable.Set[Liveness.this.global.icodes.Local]))Unit</span><a id="24189">+=</a></span> (<span class="typed"><span class="type">(Liveness.this.global.icodes.BasicBlock)ArrowAssoc[Liveness.this.global.icodes.BasicBlock]</span><span id="6054"><a href="#146457" id="821">b</a></span></span> <span class="typed"><span class="type">(scala.collection.immutable.Set[Liveness.this.global.icodes.Local])(Liveness.this.global.icodes.BasicBlock, scala.collection.immutable.Set[Liveness.this.global.icodes.Local])</span><a id="6050">-&gt;</a></span> <span class="typed"><span class="type">scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a href="#146458">g</a></span>)
        <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[Liveness.this.global.icodes.BasicBlock,scala.collection.immutable.Set[Liveness.this.global.icodes.Local]]</span><a href="#146420">kill</a></span> <span class="typed"><span class="type">((Liveness.this.global.icodes.BasicBlock, scala.collection.immutable.Set[Liveness.this.global.icodes.Local]))Unit</span><a id="24189">+=</a></span> (<span class="typed"><span class="type">(Liveness.this.global.icodes.BasicBlock)ArrowAssoc[Liveness.this.global.icodes.BasicBlock]</span><span id="6054"><a href="#146457" id="821">b</a></span></span> <span class="typed"><span class="type">(scala.collection.immutable.Set[Liveness.this.global.icodes.Local])(Liveness.this.global.icodes.BasicBlock, scala.collection.immutable.Set[Liveness.this.global.icodes.Local])</span><a id="6050">-&gt;</a></span> <span class="typed"><span class="type">scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a href="#146459">k</a></span>)
      }

      <span class="typed"><span class="type">(=&gt; Unit)Unit</span><a href="DataFlowAnalysis.scala.html#32756">init</a></span> {
        <span class="typed"><span class="type">=&gt; scala.collection.jcl.Set[LivenessAnalysis.this.P]</span><a href="DataFlowAnalysis.scala.html#32742">worklist</a></span> <span class="typed"><span class="type">(Iterable[LivenessAnalysis.this.P])Unit</span><a id="25513">++=</a></span> <span class="typed"><span class="type">Liveness.this.global.icodes.IMethod</span><a href="#146435">m</a></span>.<span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.Code</span><a href="../Members.scala.html#32867">code</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[Liveness.this.global.icodes.BasicBlock]</span><a href="../Members.scala.html#33274">blocks</a></span>.<span class="typed"><span class="type">=&gt; List[Liveness.this.global.icodes.BasicBlock]</span><a id="33309">toList</a></span>
        <span class="typed"><span class="type">Liveness.this.global.icodes.IMethod</span><a href="#146435">m</a></span>.<span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.Code</span><a href="../Members.scala.html#32867">code</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[Liveness.this.global.icodes.BasicBlock]</span><a href="../Members.scala.html#33274">blocks</a></span>.<span class="typed"><span class="type">((Liveness.this.global.icodes.BasicBlock) =&gt; Unit)Unit</span><a id="21792">foreach</a></span> { <span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a id="146484">b</a></span> =&gt;
          <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[LivenessAnalysis.this.P,LivenessAnalysis.this.lattice.Elem]</span><a href="DataFlowAnalysis.scala.html#32744">in</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146484">b</a></span>)  = <span class="typed"><span class="type">=&gt; Liveness.this.livenessLattice.type</span><a href="#146413">lattice</a></span>.<span class="typed"><span class="type">=&gt; LivenessAnalysis.this.lattice.Elem</span><a href="#146384">bottom</a></span>
          <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[LivenessAnalysis.this.P,LivenessAnalysis.this.lattice.Elem]</span><a href="DataFlowAnalysis.scala.html#32746">out</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146484">b</a></span>) = <span class="typed"><span class="type">=&gt; Liveness.this.livenessLattice.type</span><a href="#146413">lattice</a></span>.<span class="typed"><span class="type">=&gt; LivenessAnalysis.this.lattice.Elem</span><a href="#146384">bottom</a></span>
        }
      }
    }

    <span class="keyword">import</span> opcodes._

    <span class="comment">/** Return the gen and kill sets for this block. */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(Liveness.this.global.icodes.BasicBlock)(scala.collection.immutable.Set[Liveness.this.global.icodes.Local], scala.collection.immutable.Set[Liveness.this.global.icodes.Local])</span><a id="146424">genAndKill</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a id="146445">b</a></span>: <span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="../BasicBlocks.scala.html#32337">BasicBlock</a></span>): <span class="typed"><span class="type">(scala.collection.immutable.Set[Liveness.this.global.icodes.Local], scala.collection.immutable.Set[Liveness.this.global.icodes.Local])</span><a id="1378">(</a></span>Set[Local], Set[Local]) = {
      <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="146485">genSet</a></span> = <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="26287">ListSet</a></span>[Local]
      <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="146486">killSet</a></span> = <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="26287">ListSet</a></span>[Local]
      <span class="keyword">for</span> (<span class="typed"><span class="type">((Liveness.this.global.icodes.Instruction) =&gt; Unit)Unit</span><span id="21366"><a id="146489">i</a></span></span> &lt;- <span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146445">b</a></span>.<span class="typed"><span class="type">=&gt; List[Liveness.this.global.icodes.Instruction]</span><a href="../BasicBlocks.scala.html#33188">toList</a></span>) <span class="typed"><span class="type">Liveness.this.global.icodes.Instruction</span><a href="#146489">i</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">LOAD_LOCAL</a>(<span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a id="146490">local</a></span>)  <span class="keyword">if</span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">(Liveness.this.global.icodes.Local)Boolean</span><a href="#146486" id="25543">killSet</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a href="#146490">local</a></span>)) =&gt; <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a href="#146485">genSet</a></span> = <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a href="#146485">genSet</a></span> <span class="typed"><span class="type">(Liveness.this.global.icodes.Local)scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="68823">+</a></span> <span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a href="#146490">local</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">STORE_LOCAL</a>(<span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a id="146497">local</a></span>) <span class="keyword">if</span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">(Liveness.this.global.icodes.Local)Boolean</span><a href="#146485" id="25543">genSet</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a href="#146497">local</a></span>))  =&gt; <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a href="#146486">killSet</a></span> = <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a href="#146486">killSet</a></span> <span class="typed"><span class="type">(Liveness.this.global.icodes.Local)scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a id="68823">+</a></span> <span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a href="#146497">local</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _ =&gt; <span class="typed"><span class="type">Unit</span><span >(</span></span>)
      }
      <span class="typed"><span class="type">(scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local],scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local])(scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local], scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local])</span><span id="6015"><span id="6013"><a id="821">Pair</a></span></span></span>(<span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a href="#146485">genSet</a></span>, <span class="typed"><span class="type">scala.collection.immutable.ListSet[Liveness.this.global.icodes.Local]</span><a href="#146486">killSet</a></span>)
    }

    <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Unit</span><a id="146425">run</a></span> {
      <span class="typed"><span class="type">((LivenessAnalysis.this.P, LivenessAnalysis.this.lattice.Elem) =&gt; LivenessAnalysis.this.lattice.Elem)Unit</span><a href="DataFlowAnalysis.scala.html#32760">backwardAnalysis</a></span>(<span class="typed"><span class="type">(Liveness.this.global.icodes.BasicBlock,LivenessAnalysis.this.lattice.Elem)LivenessAnalysis.this.lattice.Elem</span><a href="#146426">blockTransfer</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="../../../Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="../../../Settings.scala.html#30066">debug</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting#T</span><a href="../../../Settings.scala.html#30301">value</a></span>) {
        <span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.Linearizer</span><a href="../ICodes.scala.html#32308">linearizer</a></span>.<span class="typed"><span class="type">(Liveness.this.global.icodes.IMethod)List[Liveness.this.global.icodes.BasicBlock]</span><a href="../Linearizers.scala.html#33332">linearize</a></span>(<span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.IMethod</span><a href="#146415">method</a></span>).<span class="typed"><span class="type">((Liveness.this.global.icodes.BasicBlock) =&gt; Unit)Unit</span><a id="21366">foreach</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a id="146516">b</a></span> =&gt; <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146516">b</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.IMethod</span><a href="#146415">method</a></span>.<span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.Code</span><a href="../Members.scala.html#32867">code</a></span>.<span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.BasicBlock</span><a href="../Members.scala.html#33276">startBlock</a></span>)
          <span class="typed"><span class="type">(Boolean,=&gt; Any)Unit</span><span id="6004"><a id="821">assert</a></span></span>(<span class="typed"><span class="type">=&gt; Liveness.this.livenessLattice.type</span><a href="#146413">lattice</a></span>.<span class="typed"><span class="type">=&gt; LivenessAnalysis.this.lattice.Elem</span><a href="#146384">bottom</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">(LivenessAnalysis.this.P)LivenessAnalysis.this.lattice.Elem</span><a href="DataFlowAnalysis.scala.html#32744" id="24239">in</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146516">b</a></span>),
            <span class="typed"><span class="type">java.lang.String(&quot;Block &quot;)</span><span class="string">&quot;Block &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146516">b</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; in &quot;)</span><span class="string">&quot; in &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">LivenessAnalysis.this.type</span><a href="#108199" class="keyword">this</a></span>.<span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.IMethod</span><a href="#146415">method</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; has input equal to bottom -- not visited?&quot;)</span><span class="string">&quot; has input equal to bottom -- not visited?&quot;</span></span>));
      }
    }

    <span class="keyword">def</span> <span class="typed"><span class="type">(Liveness.this.global.icodes.BasicBlock,LivenessAnalysis.this.lattice.Elem)LivenessAnalysis.this.lattice.Elem</span><a id="146426">blockTransfer</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a id="146507">b</a></span>: <span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="../BasicBlocks.scala.html#32337">BasicBlock</a></span>, <span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a id="146508">out</a></span>: lattice.<span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a id="26500">Elem</a></span>): lattice.<span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a id="26500">Elem</a></span> =
      <span class="typed"><span class="type">(Liveness.this.global.icodes.BasicBlock)scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a href="#146418" id="24239">gen</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146507">b</a></span>) <span class="typed"><span class="type">(Iterable[Liveness.this.global.icodes.Local])scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a id="31140">++</a></span> (<span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a href="#146508">out</a></span> <span class="typed"><span class="type">(Iterable[Liveness.this.global.icodes.Local])scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a id="31146">--</a></span> <span class="typed"><span class="type">(Liveness.this.global.icodes.BasicBlock)scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a href="#146420" id="24239">kill</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146507">b</a></span>))

    <span class="comment">/** Abstract interpretation for one instruction. Very important:
     *  liveness is a backward DFA, so this method should be used to compute
     *  liveness *before* the given instruction `i'.
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(LivenessAnalysis.this.lattice.Elem,Liveness.this.global.icodes.Instruction)LivenessAnalysis.this.lattice.Elem</span><a id="146427">interpret</a></span>(<span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a id="146547">out</a></span>: lattice.<span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a id="26500">Elem</a></span>, <span class="typed"><span class="type">Liveness.this.global.icodes.Instruction</span><a id="146548">i</a></span>: <span class="typed"><span class="type">Liveness.this.global.icodes.Instruction</span><a href="../Opcodes.scala.html#32341">Instruction</a></span>): lattice.<span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a id="26500">Elem</a></span> = {
      <span class="keyword">var</span> <span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a id="146549">in</a></span> = <span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a href="#146547">out</a></span>

      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="../../../Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="../../../Settings.scala.html#30066">debug</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting#T</span><a href="../../../Settings.scala.html#30301">value</a></span>) {
        <span class="typed"><span class="type">(AnyRef)Unit</span><a href="../../../Global.scala.html#21205">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;- &quot;)</span><span class="string">&quot;- &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">Liveness.this.global.icodes.Instruction</span><a href="#146548">i</a></span>)
        <span class="typed"><span class="type">(AnyRef)Unit</span><a href="../../../Global.scala.html#21205">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;out: &quot;)</span><span class="string">&quot;out: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a href="#146547">out</a></span>)
        <span class="typed"><span class="type">(AnyRef)Unit</span><a href="../../../Global.scala.html#21205">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;\012&quot;)</span><span class="string">&quot;\n&quot;</span></span>)
      }

      <span class="typed"><span class="type">Liveness.this.global.icodes.Instruction</span><a href="#146548">i</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">LOAD_LOCAL</a>(<span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a id="146552">l</a></span>) =&gt; <span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a href="#146549">in</a></span> <span class="typed"><span class="type">(Liveness.this.global.icodes.Local)scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a id="31138">+=</a></span> <span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a href="#146552">l</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">STORE_LOCAL</a>(<span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a id="146556">l</a></span>) =&gt; <span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a href="#146549">in</a></span> <span class="typed"><span class="type">(Liveness.this.global.icodes.Local)scala.collection.immutable.Set[Liveness.this.global.icodes.Local]</span><a id="31144">-=</a></span> <span class="typed"><span class="type">Liveness.this.global.icodes.Local</span><a href="#146556">l</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _ =&gt;
          <span class="typed"><span class="type">Unit</span><span >(</span></span>)
      }
      <span class="typed"><span class="type">LivenessAnalysis.this.lattice.Elem</span><a href="#146549">in</a></span>
    } <span class="comment">/* def interpret */</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()String</span><a id="146428">toString</a></span>(): <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">StringBuilder</span><a id="146560">buf</a></span> = <span class="typed"><span class="type">()StringBuilder</span><a id="23671" class="keyword">new</a></span> <span class="typed"><span class="type">StringBuilder</span><a id="1435">StringBuilder</a></span>()
      <span class="keyword">for</span> (<span class="typed"><span class="type">((Liveness.this.global.icodes.BasicBlock) =&gt; Unit)Unit</span><span id="21366"><a id="146567">b</a></span></span> &lt;- <span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.IMethod</span><a href="#146415">method</a></span>.<span class="typed"><span class="type">=&gt; Liveness.this.global.icodes.Code</span><a href="../Members.scala.html#32867">code</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[Liveness.this.global.icodes.BasicBlock]</span><a href="../Members.scala.html#33274">blocks</a></span>.<span class="typed"><span class="type">=&gt; List[Liveness.this.global.icodes.BasicBlock]</span><a id="33309">toList</a></span>) {
        <span class="typed"><span class="type">StringBuilder</span><a href="#146560">buf</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;\012live-in(&quot;)</span><span class="string">&quot;\nlive-in(&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146567">b</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;)=&quot;)</span><span class="string">&quot;)=&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">(LivenessAnalysis.this.P)LivenessAnalysis.this.lattice.Elem</span><a href="DataFlowAnalysis.scala.html#32744" id="24239">in</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146567">b</a></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;\012live-out(&quot;)</span><span class="string">&quot;\nlive-out(&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146567">b</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;)=&quot;)</span><span class="string">&quot;)=&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">(LivenessAnalysis.this.P)LivenessAnalysis.this.lattice.Elem</span><a href="DataFlowAnalysis.scala.html#32746" id="24239">out</a></span>(<span class="typed"><span class="type">Liveness.this.global.icodes.BasicBlock</span><a href="#146567">b</a></span>));
      }
      <span class="typed"><span class="type">StringBuilder</span><a href="#146560">buf</a></span>.<span class="typed"><span class="type">()String</span><a id="23723">toString</a></span>()
    }
  } <span class="comment">/* Liveness analysis */</span>
}

        </pre>
    </body>
</html>