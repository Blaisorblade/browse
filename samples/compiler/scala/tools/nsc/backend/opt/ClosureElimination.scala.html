<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/backend/opt/ClosureElimination.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
 /* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Iulian Dragos
 */

// $Id: ClosureElimination.scala 18630 2009-09-01 18:07:50Z dragos $

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend.opt;

<span class="keyword">import</span> scala.collection.mutable.{Map, HashMap};
<span class="keyword">import</span> scala.tools.nsc.backend.icode.analysis.LubError;
<span class="keyword">import</span> scala.tools.nsc.symtab._;

/**
 *  @author Iulian Dragos
 */
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class ClosureElimination extends scala.tools.nsc.SubComponent with ScalaObject" id="21015">ClosureElimination</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../../SubComponent.scala.html#8328" title="scala.tools.nsc.SubComponent">SubComponent</a> {
  <span class="keyword">import</span> global._
  <span class="keyword">import</span> icodes._
  <span class="keyword">import</span> icodes.opcodes._

  <span class="keyword">val</span> <a title="java.lang.String" id="155312">phaseName</a> = <span title="java.lang.String(&quot;closelim&quot;)" class="string">&quot;closelim&quot;</span>

  /** Create a new phase */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(p: scala.tools.nsc.Phase)ClosureElimination.this.ClosureEliminationPhase" id="155314">newPhase</a>(<a title="scala.tools.nsc.Phase" id="155321">p</a>: <a href="../../Phase.scala.html#8931" title="scala.tools.nsc.Phase">Phase</a>) = <span title="ClosureElimination.this.ClosureEliminationPhase" class="keyword">new</span> <a href="#155315" title="ClosureElimination.this.ClosureEliminationPhase">ClosureEliminationPhase</a>(<a href="#155321" title="scala.tools.nsc.Phase">p</a>)

  /** The Inlining phase.
   */
  <span class="keyword">class</span> <a title="class ClosureEliminationPhase extends ClosureElimination.this.global.icodes.ICodePhase with ScalaObject" id="155315">ClosureEliminationPhase</a><span title="ScalaObject">(</span><a title="scala.tools.nsc.Phase" id="155331">prev</a>: <a href="../../Phase.scala.html#8931" title="scala.tools.nsc.Phase">Phase</a>) <span class="keyword">extends</span> <a href="../icode/ICodes.scala.html#46393" title="ClosureElimination.this.global.icodes.ICodePhase">ICodePhase</a>(<a href="#155331" title="scala.tools.nsc.Phase">prev</a>) {

    <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="155327">name</a> = <a href="#155312" title="=&gt; java.lang.String">phaseName</a>
    <span class="keyword">val</span> <a title="ClosureElimination.this.ClosureElim" id="155328">closser</a> = <span title="ClosureElimination.this.ClosureElim" class="keyword">new</span> <a href="#155316" title="ClosureElimination.this.ClosureElim">ClosureElim</a>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(c: ClosureElimination.this.global.icodes.IClass)Unit" id="155330">apply</a>(<a title="ClosureElimination.this.global.icodes.IClass" id="155358">c</a>: <a href="../icode/Members.scala.html#46403" title="ClosureElimination.this.global.icodes.IClass">IClass</a>): <span title="Unit">Unit</span> =
      <a href="#155328" title="=&gt; ClosureElimination.this.ClosureElim">closser</a>.<a href="#155343" title="(cls: ClosureElimination.this.global.icodes.IClass)Unit">analyzeClass</a>(<a href="#155358" title="ClosureElimination.this.global.icodes.IClass">c</a>)
  }

  /** 
   * Remove references to the environemnt through fields of a closure object. 
   * This has to be run after an 'apply' method has been inlined, but it still 
   * references the closure object.
   *
   */
  <span class="keyword">class</span> <a title="class ClosureElim extends java.lang.Object with ScalaObject" id="155316">ClosureElim</a> <span title="ScalaObject">{</span>

    /* fresh name counter */
    <span class="keyword">var</span> <a title="Int" id="155338">count</a> = <span title="Int(0)" class="int">0</span>
    
    <span class="keyword">def</span> <a title="(s: String)java.lang.String" id="155340">freshName</a>(<a title="String" id="155627">s</a>: <a title="String" id="1626">String</a>) = {
      <span class="keyword">val</span> <a title="java.lang.String" id="155630">ret</a> = <a href="#155627" title="(x$1: Any)java.lang.String">s</a> + <a href="#155316" title="ClosureElim.this.type" class="keyword">this</a>.<a href="#155338" title="=&gt; Int">count</a>
      <a href="#155316" title="ClosureElim.this.type" class="keyword">this</a>.<a href="#155338" title="(x$1: Int)Unit" id="2985">count</a> += <span title="Int(1)" class="int">1</span>
      <a href="#155630" title="java.lang.String">ret</a>
    }

    /** A simple peephole optimizer. */
    <span class="keyword">val</span> <a title="ClosureElimination.this.PeepholeOpt" id="155341">peephole</a> = <span title="ClosureElimination.this.PeepholeOpt" class="keyword">new</span> <a href="#155317" title="ClosureElimination.this.PeepholeOpt">PeepholeOpt</a>( (<a title="ClosureElimination.this.global.icodes.Instruction" id="155383">i1</a>, <a title="ClosureElimination.this.global.icodes.Instruction" id="155384">i2</a>) =&gt;
    	<span title="(_1: ClosureElimination.this.global.icodes.Instruction,_2: ClosureElimination.this.global.icodes.Instruction)(ClosureElimination.this.global.icodes.Instruction, ClosureElimination.this.global.icodes.Instruction)">(</span><a href="#155383" title="ClosureElimination.this.global.icodes.Instruction">i1</a>, <a href="#155384" title="ClosureElimination.this.global.icodes.Instruction">i2</a>) <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">match</span> {
        <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">case</span> (CONSTANT(<a title="ClosureElimination.this.global.icodes.global.Constant" id="155396">c</a>), DROP(_)) =&gt; 
          <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> (<a href="#155396" title="ClosureElimination.this.global.icodes.global.Constant">c</a>.<a href="../../symtab/Constants.scala.html#43041" title="(x$1: Int)Boolean" id="2973">tag</a> == <span title="Int(1)">UnitTag</span>)
            <span title="(x: List[ClosureElimination.this.global.icodes.Instruction])Some[List[ClosureElimination.this.global.icodes.Instruction]]">Some</span>(<a title="(xs: ClosureElimination.this.global.icodes.Instruction*)List[ClosureElimination.this.global.icodes.Instruction]" id="7415">List</a>(<a href="#155384" title="ClosureElimination.this.global.icodes.Instruction">i2</a>))
          <span class="keyword">else</span>
            <span title="(x: object Nil)Some[object Nil]">Some</span>(<span title="object Nil">Nil</span>);
          
        <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">case</span> (LOAD_LOCAL(<a title="ClosureElimination.this.global.icodes.Local" id="155432">x</a>), STORE_LOCAL(<a title="ClosureElimination.this.global.icodes.Local" id="155436">y</a>)) =&gt;
        	<span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> (<a href="#155432" title="(x$1: AnyRef)Boolean" id="6611">x</a> eq <a href="#155436" title="ClosureElimination.this.global.icodes.Local">y</a>) <span title="(x: object Nil)Some[object Nil]">Some</span>(<span title="object Nil">Nil</span>) <span class="keyword">else</span> <span title="object None">None</span>

//        case (STORE_LOCAL(x), LOAD_LOCAL(y)) if (x == y) =&gt;
//          Some(List(DUP(x.kind), STORE_LOCAL(x)))
          
        <span title="Some[object Nil]" class="keyword">case</span> (LOAD_LOCAL(_), DROP(_)) | (DUP(_), DROP(_)) =&gt;
          <span title="(x: object Nil)Some[object Nil]">Some</span>(<span title="object Nil">Nil</span>)

        <span title="Some[object Nil]" class="keyword">case</span> (BOX(<a title="ClosureElimination.this.global.icodes.TypeKind" id="155476">t1</a>), UNBOX(<a title="ClosureElimination.this.global.icodes.TypeKind" id="155480">t2</a>)) <span class="keyword">if</span> (<a href="#155476" title="(x$1: AnyRef)Boolean">t1</a> == <a href="#155480" title="ClosureElimination.this.global.icodes.TypeKind">t2</a>) =&gt;
          <span title="(x: object Nil)Some[object Nil]">Some</span>(<span title="object Nil">Nil</span>)
          
        <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">case</span> (LOAD_FIELD(<a title="ClosureElimination.this.global.icodes.global.Symbol" id="155500">sym</a>, <a title="Boolean" id="155501">isStatic</a>), DROP(_)) =&gt;
        	<span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> (<a href="#155501" title="Boolean">isStatic</a>)
            <span title="(x: object Nil)Some[object Nil]">Some</span>(<span title="object Nil">Nil</span>)
          <span class="keyword">else</span>
            <span title="(x: List[ClosureElimination.this.global.icodes.opcodes.DROP])Some[List[ClosureElimination.this.global.icodes.opcodes.DROP]]">Some</span>(<a href="../icode/Opcodes.scala.html#64268" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a>(<a href="../icode/TypeKinds.scala.html#60703" title="(cls: ClosureElimination.this.global.icodes.global.Symbol)ClosureElimination.this.global.icodes.REFERENCE">REFERENCE</a>(<a href="../../symtab/Definitions.scala.html#26638" title="object ClosureElimination.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#28453" title="=&gt; ClosureElimination.this.global.Symbol">ObjectClass</a>)) <a href="#155516" title="ClosureElimination.this.global.icodes.opcodes.DROP">::</a> <span title="(x: ClosureElimination.this.global.icodes.opcodes.DROP)List[ClosureElimination.this.global.icodes.opcodes.DROP]">Nil</span>);
          
        <span title="None.type" class="keyword">case</span> _ =&gt; <span title="object None">None</span>
      });
    
    <span class="keyword">def</span> <a title="(cls: ClosureElimination.this.global.icodes.IClass)Unit" id="155343">analyzeClass</a>(<a title="ClosureElimination.this.global.icodes.IClass" id="155367">cls</a>: <a href="../icode/Members.scala.html#46403" title="ClosureElimination.this.global.icodes.IClass">IClass</a>): <span title="Unit">Unit</span> = <span title="Unit" class="keyword">if</span> (<a href="../../Global.scala.html#39250" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../Settings.scala.html#37337" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">Xcloselim</a>.<a href="../../Settings.scala.html#37988" title="=&gt; Boolean">value</a>) {
      <a href="#155367" title="ClosureElimination.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#66947" title="=&gt; List[ClosureElimination.this.global.icodes.IMethod]">methods</a>.<span title="(f: (ClosureElimination.this.global.icodes.IMethod) =&gt; Unit)Unit">foreach</span> { <a title="ClosureElimination.this.global.icodes.IMethod" id="155695">m</a> =&gt; 
        <a href="#155347" title="(m: ClosureElimination.this.global.icodes.IMethod)Unit">analyzeMethod</a>(<a href="#155695" title="ClosureElimination.this.global.icodes.IMethod">m</a>)
        <a href="#155341" title="=&gt; ClosureElimination.this.PeepholeOpt">peephole</a>.<a href="#155379" title="(m: ClosureElimination.this.global.icodes.IMethod)Unit">transformMethod</a>(<a href="#155695" title="ClosureElimination.this.global.icodes.IMethod">m</a>);
     }}


    <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.CopyAnalysis" id="155344">cpp</a> = <span title="ClosureElimination.this.global.copyPropagation.CopyAnalysis" class="keyword">new</span> <a href="../../Global.scala.html#39273" title="object ClosureElimination.this.global.copyPropagation">copyPropagation</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155586" title="ClosureElimination.this.global.copyPropagation.CopyAnalysis">CopyAnalysis</a>


    <span class="keyword">import</span> copyPropagation._

    /* Some embryonic copy propagation. */
    <span class="keyword">def</span> <a title="(m: ClosureElimination.this.global.icodes.IMethod)Unit" id="155347">analyzeMethod</a>(<a title="ClosureElimination.this.global.icodes.IMethod" id="155696">m</a>: <a href="../icode/Members.scala.html#46405" title="ClosureElimination.this.global.icodes.IMethod">IMethod</a>): <span title="Unit">Unit</span> = <span class="keyword">try</span> {<span title="Unit" class="keyword">if</span> (<a href="#155696" title="ClosureElimination.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#61497" title="(x$1: AnyRef)Boolean">code</a> ne <span title="Null(null)" class="keyword">null</span>) {
      <a href="../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Analyzing &quot;</span> + <a href="#155696" title="ClosureElimination.this.global.icodes.IMethod">m</a>)
      <a href="#155344" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155611" title="(m: ClosureElimination.this.global.copyPropagation.global.icodes.IMethod)Unit">init</a>(<a href="#155696" title="ClosureElimination.this.global.icodes.IMethod">m</a>)
      <a href="#155344" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155612" title="=&gt; Unit">run</a>

      <span class="keyword">for</span> (<a title="ClosureElimination.this.global.icodes.BasicBlock" id="155747">bb</a> &lt;- <a href="../icode/ICodes.scala.html#46381" title="=&gt; ClosureElimination.this.global.icodes.Linearizer">linearizer</a>.<a href="../icode/Linearizers.scala.html#62481" title="(c: ClosureElimination.this.global.icodes.IMethod)List[ClosureElimination.this.global.icodes.BasicBlock]">linearize</a><span title="(f: (ClosureElimination.this.global.icodes.BasicBlock) =&gt; Unit)Unit">(</span><a href="#155696" title="ClosureElimination.this.global.icodes.IMethod">m</a>)) {
        <span class="keyword">var</span> <a title="ClosureElim.this.cpp.lattice.Elem" id="155748">info</a> = <a href="#155344" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/DataFlowAnalysis.scala.html#61420" title="(key: ClosureElim.this.cpp.P)ClosureElim.this.cpp.lattice.Elem" id="44676">in</a>(<a href="#155747" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>)
        <a href="../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Cpp info at entry to block &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155747" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> + <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>)

        <span class="keyword">for</span> (<a title="ClosureElimination.this.global.icodes.Instruction" id="155804">i</a> &lt;- <a href="#155747" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#61582" title="(f: (ClosureElimination.this.global.icodes.Instruction) =&gt; Unit)Unit">toList</a>) {
          <a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="Unit" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> LOAD_LOCAL(<a title="ClosureElimination.this.global.icodes.Local" id="155806">l</a>) <span class="keyword">if</span> (<a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155751" title="=&gt; ClosureElim.this.cpp.lattice.Bindings">bindings</a>.<span title="(key: ClosureElimination.this.global.copyPropagation.Location)Boolean">isDefinedAt</span>(<a href="../icode/analysis/CopyPropagation.scala.html#155814" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a>(<a href="#155806" title="ClosureElimination.this.global.icodes.Local">l</a>))) =&gt;
              <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.Value" id="155838">t</a> = <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155759" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a>(<a href="#155806" title="ClosureElimination.this.global.icodes.Local">l</a>)
              <a href="#155838" title="ClosureElimination.this.global.copyPropagation.Value">t</a> <span title="Unit" class="keyword">match</span> {
                <span title="Unit" class="keyword">case</span> Deref(LocalVar(<a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="155882">v</a>)) =&gt; 
                  <a href="#155747" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#61594" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction,newInstr: ClosureElimination.this.global.icodes.Instruction)Boolean">replaceInstruction</a>(<a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="#155348" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a>(<a href="#155838" title="ClosureElimination.this.global.copyPropagation.Value">t</a>));
                  <a href="../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> + <a href="#155838" title="ClosureElimination.this.global.copyPropagation.Value">t</a>)

                <span title="Unit" class="keyword">case</span> Deref(<a href="../icode/analysis/CopyPropagation.scala.html#155565" title="object ClosureElimination.this.global.copyPropagation.This">This</a>) =&gt;
                  <a href="#155747" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#61594" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction,newInstr: ClosureElimination.this.global.icodes.Instruction)Boolean">replaceInstruction</a>(<a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="#155348" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a>(<a href="#155838" title="ClosureElimination.this.global.copyPropagation.Value">t</a>));
                  <a href="../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> + <a href="#155838" title="ClosureElimination.this.global.copyPropagation.Value">t</a>)

                <span title="Unit" class="keyword">case</span> _ =&gt; 
                  <a href="#155747" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#61594" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction,newInstr: ClosureElimination.this.global.icodes.Instruction)Boolean">replaceInstruction</a>(<a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#62863" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a>(<a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155758" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.global.icodes.Local">getAlias</a>(<a href="#155806" title="ClosureElimination.this.global.icodes.Local">l</a>)));
                  <a href="../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> + <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155758" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.global.icodes.Local">getAlias</a>(<a href="#155806" title="ClosureElimination.this.global.icodes.Local">l</a>))

              }

            <span title="Unit" class="keyword">case</span> LOAD_FIELD(<a title="ClosureElimination.this.global.icodes.global.Symbol" id="156015">f</a>, <span title="Boolean(false)" class="keyword">false</span>) /* if accessible(f, m.symbol) */ =&gt;
              <span class="keyword">def</span> <a title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit" id="156018">replaceFieldAccess</a>(<a title="ClosureElimination.this.global.copyPropagation.Record" id="156019">r</a>: <a href="../icode/analysis/CopyPropagation.scala.html#155568" title="ClosureElimination.this.global.copyPropagation.Record">Record</a>) {
                <span class="keyword">val</span> Record<a href="#36621" title="(ClosureElimination.this.global.copyPropagation.global.Symbol, scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value])">(</a><a href="#156029" title="ClosureElimination.this.global.copyPropagation.global.Symbol" id="36621">cls</a>, <a href="#156029" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="36623">bindings</a>) = <a href="#156019" title="ClosureElimination.this.global.copyPropagation.Record">r</a>
                <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155762" title="(r: ClosureElimination.this.global.copyPropagation.Record,f: ClosureElimination.this.global.copyPropagation.global.Symbol)Option[ClosureElimination.this.global.copyPropagation.Value]">getFieldNonRecordValue</a>(<a href="#156019" title="ClosureElimination.this.global.copyPropagation.Record">r</a>, <a href="#156015" title="ClosureElimination.this.global.icodes.global.Symbol">f</a>) <span title="Unit" class="keyword">match</span> {
                	<span title="Unit" class="keyword">case</span> Some(<a title="ClosureElimination.this.global.copyPropagation.Value" id="156077">v</a>) =&gt;
                		<a href="#155747" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#61595" title="(iold: ClosureElimination.this.global.icodes.Instruction,is: List[ClosureElimination.this.global.icodes.Instruction])Boolean">replaceInstruction</a>(<a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a>, 
                				<a href="../icode/Opcodes.scala.html#64268" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a>(<a href="../icode/TypeKinds.scala.html#60703" title="(cls: ClosureElimination.this.global.icodes.global.Symbol)ClosureElimination.this.global.icodes.REFERENCE">REFERENCE</a>(<a href="#36621" title="ClosureElimination.this.global.copyPropagation.global.Symbol">cls</a>)) <a href="#156090" title="ClosureElimination.this.global.icodes.opcodes.DROP">::</a> <a href="#155348" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a>(<a href="#156077" title="ClosureElimination.this.global.copyPropagation.Value">v</a>) <a href="#156113" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <span title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">Nil</span>);
                		<a href="../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> + <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155762" title="(r: ClosureElimination.this.global.copyPropagation.Record,f: ClosureElimination.this.global.copyPropagation.global.Symbol)Option[ClosureElimination.this.global.copyPropagation.Value]">getFieldNonRecordValue</a>(<a href="#156019" title="ClosureElimination.this.global.copyPropagation.Record">r</a>, <a href="#156015" title="ClosureElimination.this.global.icodes.global.Symbol">f</a>));
                	<span title="Unit" class="keyword">case</span> <span title="object None">None</span> =&gt; <span title="Unit">(</span>);
                }
              }
              
              <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155753" title="(n: Int)ClosureElimination.this.global.copyPropagation.Value" id="29115">stack</a>(<span title="Int(0)" class="int">0</span>) <span title="Unit" class="keyword">match</span> {
                <span title="Unit" class="keyword">case</span> <a title="ClosureElimination.this.global.copyPropagation.Record" id="156162">r</a> @ Record(_, <a title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="156165">bindings</a>) <span class="keyword">if</span> <a href="#156165" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]">bindings</a>.<span title="(key: ClosureElimination.this.global.copyPropagation.global.Symbol)Boolean">isDefinedAt</span>(<a href="#156015" title="ClosureElimination.this.global.icodes.global.Symbol">f</a>) =&gt;
                  <a href="#156018" title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit">replaceFieldAccess</a>(<a href="#156162" title="ClosureElimination.this.global.copyPropagation.Record">r</a>)

                <span title="Unit" class="keyword">case</span> Deref(LocalVar(<a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="156177">l</a>)) =&gt;
                  <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155759" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a>(<a href="#156177" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">l</a>) <span title="Unit" class="keyword">match</span> {
                    <span title="Unit" class="keyword">case</span> <a title="ClosureElimination.this.global.copyPropagation.Record" id="156190">r</a> @ Record(_, <a title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="156193">bindings</a>) <span class="keyword">if</span> <a href="#156193" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]">bindings</a>.<span title="(key: ClosureElimination.this.global.copyPropagation.global.Symbol)Boolean">isDefinedAt</span>(<a href="#156015" title="ClosureElimination.this.global.icodes.global.Symbol">f</a>) =&gt;
                      <a href="#156018" title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit">replaceFieldAccess</a>(<a href="#156190" title="ClosureElimination.this.global.copyPropagation.Record">r</a>)
                    <span title="Unit" class="keyword">case</span> _ =&gt; 
                  }
                <span title="Unit" class="keyword">case</span> Deref(Field(<a title="ClosureElimination.this.global.copyPropagation.Record" id="156235">r1</a>, <a title="ClosureElimination.this.global.copyPropagation.global.Symbol" id="156236">f1</a>)) =&gt;
                  <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155761" title="(r: ClosureElimination.this.global.copyPropagation.Record,f: ClosureElimination.this.global.copyPropagation.global.Symbol)Option[ClosureElimination.this.global.copyPropagation.Value]">getFieldValue</a>(<a href="#156235" title="ClosureElimination.this.global.copyPropagation.Record">r1</a>, <a href="#156236" title="ClosureElimination.this.global.copyPropagation.global.Symbol">f1</a>) <span title="Unit" class="keyword">match</span> {
                    <span title="Unit" class="keyword">case</span> Some(<a title="ClosureElimination.this.global.copyPropagation.Record" id="156249">r</a> @ Record(_, <a title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="156252">bindings</a>)) <span class="keyword">if</span> <a href="#156252" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]">bindings</a>.<span title="(key: ClosureElimination.this.global.copyPropagation.global.Symbol)Boolean">isDefinedAt</span>(<a href="#156015" title="ClosureElimination.this.global.icodes.global.Symbol">f</a>) =&gt;
                      <a href="#156018" title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit">replaceFieldAccess</a>(<a href="#156249" title="ClosureElimination.this.global.copyPropagation.Record">r</a>)
                    <span title="Unit" class="keyword">case</span> _ =&gt; 
                  }

                <span title="Unit" class="keyword">case</span> _ =&gt; 
              }
              
            <span title="Unit" class="keyword">case</span> UNBOX(_) =&gt;
              <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155753" title="=&gt; List[ClosureElimination.this.global.copyPropagation.Value]">stack</a> <span title="Unit" class="keyword">match</span> {
                <span title="Unit" class="keyword">case</span> Deref(LocalVar(<a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="156273">loc1</a>)) :: _ <span class="keyword">if</span> (<a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155751" title="=&gt; ClosureElim.this.cpp.lattice.Bindings">bindings</a>.<span title="(key: ClosureElimination.this.global.copyPropagation.Location)Boolean">isDefinedAt</span>(<a href="../icode/analysis/CopyPropagation.scala.html#155814" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a>(<a href="#156273" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc1</a>))) =&gt;
                  <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.Value" id="156297">value</a> = <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155759" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a>(<a href="#156273" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc1</a>)
                  <a href="#156297" title="ClosureElimination.this.global.copyPropagation.Value">value</a> <span title="Unit" class="keyword">match</span> {
                    <span title="Unit" class="keyword">case</span> Boxed(LocalVar(<a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="156325">loc2</a>)) =&gt;
                      <a href="#155747" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#61595" title="(iold: ClosureElimination.this.global.icodes.Instruction,is: List[ClosureElimination.this.global.icodes.Instruction])Boolean">replaceInstruction</a>(<a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#64268" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a>(<a href="../../Global.scala.html#39269" title="object ClosureElimination.this.global.icodes">icodes</a>.<a href="../icode/ICodes.scala.html#46388" title="=&gt; ClosureElimination.this.global.icodes.TypeKind">AnyRefReference</a>) <a href="#156340" title="ClosureElimination.this.global.icodes.opcodes.DROP">::</a> <a href="#155348" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a>(<a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155759" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a>(<a href="#156325" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a>)) <a href="#156352" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <span title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">Nil</span>)
                      <a href="../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> + <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155759" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a>(<a href="#156325" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a>))
                    <span title="Unit" class="keyword">case</span> _ =&gt;
                      <span title="Unit">(</span>)
                  }
                <span title="Unit" class="keyword">case</span> Boxed(LocalVar(<a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="156409">loc1</a>)) :: _ =&gt;
                  <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.Value" id="156416">value</a> = <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155759" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a>(<a href="#156409" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc1</a>)
                  <a href="#155747" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#61595" title="(iold: ClosureElimination.this.global.icodes.Instruction,is: List[ClosureElimination.this.global.icodes.Instruction])Boolean">replaceInstruction</a>(<a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#64268" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a>(<a href="../../Global.scala.html#39269" title="object ClosureElimination.this.global.icodes">icodes</a>.<a href="../icode/ICodes.scala.html#46388" title="=&gt; ClosureElimination.this.global.icodes.TypeKind">AnyRefReference</a>) <a href="#156435" title="ClosureElimination.this.global.icodes.opcodes.DROP">::</a> <a href="#155348" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a>(<a href="#156416" title="ClosureElimination.this.global.copyPropagation.Value">value</a>) <a href="#156447" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <span title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">Nil</span>)
                  <a href="../../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> + <a href="#156416" title="ClosureElimination.this.global.copyPropagation.Value">value</a>)
                <span title="Unit" class="keyword">case</span> _ =&gt;
                  <span title="Unit">(</span>)
              }

            <span title="Unit" class="keyword">case</span> _ =&gt; <span title="Unit">(</span>);
          }
          <a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a> = <a href="#155344" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/CopyPropagation.scala.html#155615" title="(in: ClosureElimination.this.global.copyPropagation.copyLattice.Elem,i: ClosureElimination.this.global.copyPropagation.global.icodes.Instruction)ClosureElimination.this.global.copyPropagation.copyLattice.Elem">interpret</a>(<a href="#155748" title="ClosureElim.this.cpp.lattice.Elem">info</a>, <a href="#155804" title="ClosureElimination.this.global.icodes.Instruction">i</a>)
        }
      }
    }} <span class="keyword">catch</span> {
      <span title="Unit" class="keyword">case</span> <a title="scala.tools.nsc.backend.icode.analysis.LubError" id="156495">e</a>: <a href="../icode/analysis/LubError.scala.html#16310" title="scala.tools.nsc.backend.icode.analysis.LubError">LubError</a> =&gt; 
        <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;In method: &quot;</span> + <a href="#155696" title="ClosureElimination.this.global.icodes.IMethod">m</a>)
        <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span>(<a href="#156495" title="scala.tools.nsc.backend.icode.analysis.LubError">e</a>)
        <a href="#156495" title="scala.tools.nsc.backend.icode.analysis.LubError">e</a>.<a title="()Unit" id="26091">printStackTrace</a>
    }

    /* Partial mapping from values to instructions that load them. */
    <span class="keyword">def</span> <a title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction" id="155348">valueToInstruction</a>(<a title="ClosureElimination.this.global.copyPropagation.Value" id="155906">v</a>: <a href="../icode/analysis/CopyPropagation.scala.html#155567" title="ClosureElimination.this.global.copyPropagation.Value">Value</a>): <a href="../icode/Opcodes.scala.html#46414" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a> = (<a href="#155906" title="ClosureElimination.this.global.copyPropagation.Value">v</a>: @<a href="../icode/analysis/CopyPropagation.scala.html#155567" title="ClosureElimination.this.global.copyPropagation.Value @unchecked">unchecked</a>) <span title="ClosureElimination.this.global.icodes.Instruction" class="keyword">match</span> {
      <span title="ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL" class="keyword">case</span> Deref(LocalVar(<a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="156514">v</a>)) =&gt; 
        <a href="../icode/Opcodes.scala.html#62863" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a>(<a href="#156514" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">v</a>)
      <span title="ClosureElimination.this.global.icodes.opcodes.CONSTANT" class="keyword">case</span> Const(<a title="ClosureElimination.this.global.copyPropagation.global.Constant" id="156548">k</a>) =&gt;
        <a href="../icode/Opcodes.scala.html#62717" title="(constant: ClosureElimination.this.global.icodes.global.Constant)ClosureElimination.this.global.icodes.opcodes.CONSTANT">CONSTANT</a>(<a href="#156548" title="ClosureElimination.this.global.copyPropagation.global.Constant">k</a>)
      <span title="ClosureElimination.this.global.icodes.opcodes.THIS" class="keyword">case</span> Deref(<a href="../icode/analysis/CopyPropagation.scala.html#155565" title="object ClosureElimination.this.global.copyPropagation.This">This</a>) =&gt;
        <a href="../icode/Opcodes.scala.html#62662" title="(clasz: ClosureElimination.this.global.icodes.global.Symbol)ClosureElimination.this.global.icodes.opcodes.THIS">THIS</a>(<a href="../../symtab/Definitions.scala.html#26638" title="object ClosureElimination.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#28453" title="=&gt; ClosureElimination.this.global.Symbol">ObjectClass</a>)
      <span title="ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL" class="keyword">case</span> Boxed(LocalVar(<a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="156585">v</a>)) =&gt;
        <a href="../icode/Opcodes.scala.html#62863" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a>(<a href="#156585" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">v</a>)
    }
    
    /** is field 'f' accessible from method 'm'? */
    <span class="keyword">def</span> <a title="(f: ClosureElimination.this.global.Symbol,m: ClosureElimination.this.global.Symbol)Boolean" id="155349">accessible</a>(<a title="ClosureElimination.this.global.Symbol" id="156601">f</a>: <a href="../../symtab/Symbols.scala.html#26286" title="ClosureElimination.this.global.Symbol">Symbol</a>, <a title="ClosureElimination.this.global.Symbol" id="156602">m</a>: <a href="../../symtab/Symbols.scala.html#26286" title="ClosureElimination.this.global.Symbol">Symbol</a>): <a title="Boolean" id="1972">Boolean</a> = 
      <a href="#156601" title="ClosureElimination.this.global.Symbol">f</a>.<a href="../../symtab/Symbols.scala.html#27115" title="(x$1: Boolean)Boolean">isPublic</a> || (<a href="#156601" title="ClosureElimination.this.global.Symbol">f</a>.<a href="../../symtab/Symbols.scala.html#27155" title="(mask: Long)Boolean">hasFlag</a><a title="(x$1: Boolean)Boolean" id="2233">(</a>Flags.<span title="Long(1L)">PROTECTED</span>) &amp;&amp; (<a href="#155350" title="(sym: ClosureElimination.this.global.Symbol)ClosureElimination.this.global.Symbol">enclPackage</a><span title="(x$1: AnyRef)Boolean">(</span><a href="#156601" title="ClosureElimination.this.global.Symbol">f</a>) == <a href="#155350" title="(sym: ClosureElimination.this.global.Symbol)ClosureElimination.this.global.Symbol">enclPackage</a>(<a href="#156602" title="ClosureElimination.this.global.Symbol">m</a>)))

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: ClosureElimination.this.global.Symbol)ClosureElimination.this.global.Symbol" id="155350">enclPackage</a>(<a title="ClosureElimination.this.global.Symbol" id="156606">sym</a>: <a href="../../symtab/Symbols.scala.html#26286" title="ClosureElimination.this.global.Symbol">Symbol</a>): <a href="../../symtab/Symbols.scala.html#26286" title="ClosureElimination.this.global.Symbol">Symbol</a> = 
      <span title="ClosureElimination.this.global.Symbol" class="keyword">if</span> (<span title="(x$1: Boolean)Boolean">(</span><a href="#156606" title="(x$1: AnyRef)Boolean">sym</a> == <a href="../../symtab/Symbols.scala.html#26293" title="object ClosureElimination.this.global.NoSymbol">NoSymbol</a>) || <a href="#156606" title="ClosureElimination.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#27094" title="=&gt; Boolean">isPackageClass</a>) <a href="#156606" title="ClosureElimination.this.global.Symbol">sym</a> <span class="keyword">else</span> <a href="#155350" title="(sym: ClosureElimination.this.global.Symbol)ClosureElimination.this.global.Symbol">enclPackage</a>(<a href="#156606" title="ClosureElimination.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#27142" title="=&gt; ClosureElimination.this.global.Symbol">owner</a>)

  } /* class ClosureElim */


  /** Peephole optimization. */
  <span class="keyword">class</span> <a title="class PeepholeOpt extends java.lang.Object with ScalaObject" id="155317">PeepholeOpt</a><span title="ScalaObject">(</span><a title="(ClosureElimination.this.global.icodes.Instruction, ClosureElimination.this.global.icodes.Instruction) =&gt; Option[List[ClosureElimination.this.global.icodes.Instruction]]" id="155381">peep</a>: (Instruction, Instruction) =&gt; Option[List[Instruction]]) {

    <span class="keyword">private</span> <span class="keyword">var</span> <a title="ClosureElimination.this.global.icodes.IMethod" id="155377">method</a>: <a href="../icode/Members.scala.html#46405" title="ClosureElimination.this.global.icodes.IMethod">IMethod</a> = <span title="Null(null)" class="keyword">null</span>

    <span class="keyword">def</span> <a title="(m: ClosureElimination.this.global.icodes.IMethod)Unit" id="155379">transformMethod</a>(<a title="ClosureElimination.this.global.icodes.IMethod" id="155700">m</a>: <a href="../icode/Members.scala.html#46405" title="ClosureElimination.this.global.icodes.IMethod">IMethod</a>): <span title="Unit">Unit</span> = <span title="Unit" class="keyword">if</span> (<a href="#155700" title="ClosureElimination.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#61497" title="(x$1: AnyRef)Boolean">code</a> ne <span title="Null(null)" class="keyword">null</span>) {
      <a href="#155377" title="(x$1: ClosureElimination.this.global.icodes.IMethod)Unit">method</a> = <a href="#155700" title="ClosureElimination.this.global.icodes.IMethod">m</a>
      <span class="keyword">for</span> (<a title="ClosureElimination.this.global.icodes.BasicBlock" id="156665">b</a> &lt;- <a href="#155700" title="ClosureElimination.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#61497" title="=&gt; ClosureElimination.this.global.icodes.Code">code</a>.<a href="../icode/Members.scala.html#61659" title="(f: (ClosureElimination.this.global.icodes.BasicBlock) =&gt; Unit)Unit" id="62018">blocks</a>) 
        <a href="#155380" title="(b: ClosureElimination.this.global.icodes.BasicBlock)Unit">transformBlock</a>(<a href="#156665" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>)
    }

    <span class="keyword">def</span> <a title="(b: ClosureElimination.this.global.icodes.BasicBlock)Unit" id="155380">transformBlock</a>(<a title="ClosureElimination.this.global.icodes.BasicBlock" id="156666">b</a>: <a href="../icode/BasicBlocks.scala.html#46410" title="ClosureElimination.this.global.icodes.BasicBlock">BasicBlock</a>): <span title="Unit">Unit</span> = <span title="Unit" class="keyword">if</span> (<a href="#156666" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>.<a title="(x$1: Int)Boolean" id="25707">size</a> &gt;= <span title="Int(2)" class="int">2</span>) {
      <span class="keyword">var</span> <a title="List[ClosureElimination.this.global.icodes.Instruction]" id="156679">newInstructions</a>: <span title="List[ClosureElimination.this.global.icodes.Instruction]">List</span>[Instruction] = <span title="object Nil">Nil</span>;

      <a href="#156679" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a> = <a href="#156666" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#61582" title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">toList</a>
      
      <span class="keyword">var</span> <a title="Boolean" id="156680">redo</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#156681" title="Unit" class="keyword">do</a> {
        <span class="keyword">var</span> <a title="ClosureElimination.this.global.icodes.Instruction" id="156682">h</a> = <a href="#156679" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a>.<span title="=&gt; ClosureElimination.this.global.icodes.Instruction">head</span>;
        <span class="keyword">var</span> <a title="List[ClosureElimination.this.global.icodes.Instruction]" id="156683">t</a> = <a href="#156679" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a>.<span title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">tail</span>;
        <span class="keyword">var</span> <a title="List[ClosureElimination.this.global.icodes.Instruction]" id="156684">seen</a>: <span title="List[ClosureElimination.this.global.icodes.Instruction]">List</span>[Instruction] = <span title="object Nil">Nil</span>;
        <a href="#156680" title="Boolean">redo</a> = <span title="Boolean(false)" class="keyword">false</span>;

        <span title="Unit" class="keyword">while</span> (<a href="#156683" title="(x$1: AnyRef)Boolean" id="6609">t</a> != <span title="object Nil">Nil</span>) <a href="#156687" title="()Unit">{</a>
          <a href="#155381" title="(v1: ClosureElimination.this.global.icodes.Instruction,v2: ClosureElimination.this.global.icodes.Instruction)Option[List[ClosureElimination.this.global.icodes.Instruction]]" id="37866">peep</a>(<a href="#156682" title="ClosureElimination.this.global.icodes.Instruction">h</a>, <a href="#156683" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<span title="=&gt; ClosureElimination.this.global.icodes.Instruction">head</span>) <span title="Unit" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> Some(<a title="List[ClosureElimination.this.global.icodes.Instruction]" id="156701">newInstrs</a>) =&gt;
              <a href="#156679" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a> = <a href="#156684" title="List[ClosureElimination.this.global.icodes.Instruction]">seen</a>.<a title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]" id="24460">reverse</a> <a href="#156704" title="List[ClosureElimination.this.global.icodes.Instruction]">:::</a> <a href="#156701" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstrs</a> <a href="#156706" title="(prefix: List[ClosureElimination.this.global.icodes.Instruction])List[ClosureElimination.this.global.icodes.Instruction]">:::</a> <a href="#156683" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<span title="(prefix: List[ClosureElimination.this.global.icodes.Instruction])List[ClosureElimination.this.global.icodes.Instruction]">tail</span>;
              <a href="#156680" title="Boolean">redo</a> = <span title="Boolean(true)" class="keyword">true</span>;
            <span title="Unit" class="keyword">case</span> <span title="object None">None</span> =&gt;
            	<span title="Unit">(</span>)
          }
          <a href="#156684" title="List[ClosureElimination.this.global.icodes.Instruction]">seen</a> = <a href="#156682" title="ClosureElimination.this.global.icodes.Instruction">h</a> <a href="#156722" title="ClosureElimination.this.global.icodes.Instruction">::</a> <a href="#156684" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">seen</a>;
          <a href="#156682" title="ClosureElimination.this.global.icodes.Instruction">h</a> = <a href="#156683" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<span title="=&gt; ClosureElimination.this.global.icodes.Instruction">head</span>;
          <a href="#156683" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a> = <a href="#156683" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<span title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">tail</span>
        }
      } <span class="keyword">while</span> (<a href="#156680" title="Boolean">redo</a>);
      <a href="#156666" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#61585" title="(is: List[ClosureElimination.this.global.icodes.Instruction])Unit">fromList</a>(<a href="#156679" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a>)
    }
  }

} /* class ClosureElimination */

        </pre>
    </body>
</html>