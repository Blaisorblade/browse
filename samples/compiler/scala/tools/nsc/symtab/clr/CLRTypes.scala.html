<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/symtab/clr/CLRTypes.scala</title>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new scala compiler
 * Copyright 2004-2009 LAMP/EPFL
 */</span>

<span class="comment">// $Id: CLRTypes.scala 16893 2009-01-13 13:09:22Z cunei $</span>

<span class="keyword">package</span> scala.tools.nsc.symtab.clr

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> java.util.{Comparator, StringTokenizer}
<span class="keyword">import</span> scala.util.Sorting

<span class="keyword">import</span> ch.epfl.lamp.compiler.msil._

<span class="keyword">import</span> scala.collection.mutable.{ListBuffer, Map, HashMap, Set, HashSet}
<span class="keyword">import</span> scala.tools.nsc.util.{Position, NoPosition}
 
<span class="comment">/**
 * Collects all types from all reference assemblies.
 */</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class CLRTypes extends java.lang.Object with ScalaObject</span><a id="17568">CLRTypes</a></span> {

  <span class="keyword">val</span> <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a id="35312">global</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Global</span><a href="../../Global.scala.html#6489">Global</a></span>
  <span class="keyword">import</span> global.Symbol
  <span class="keyword">import</span> global.definitions

  <span class="comment">//##########################################################################</span>

  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35317"><span id="35315"><span id="35316"><a id="74681">BYTE</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35320"><span id="35318"><span id="35319"><a id="74682">UBYTE</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35323"><span id="35321"><span id="35322"><a id="74683">SHORT</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35326"><span id="35324"><span id="35325"><a id="74684">USHORT</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35329"><span id="35327"><span id="35328"><a id="74685">CHAR</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35332"><span id="35330"><span id="35331"><a id="74686">INT</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35335"><span id="35333"><span id="35334"><a id="74687">UINT</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35338"><span id="35336"><span id="35337"><a id="74688">LONG</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35341"><span id="35339"><span id="35340"><a id="74689">ULONG</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35344"><span id="35342"><span id="35343"><a id="74690">FLOAT</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35347"><span id="35345"><span id="35346"><a id="74691">DOUBLE</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35350"><span id="35348"><span id="35349"><a id="74692">BOOLEAN</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35353"><span id="35351"><span id="35352"><a id="74693">VOID</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35356"><span id="35354"><span id="35355"><a id="74694">ENUM</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35359"><span id="35357"><span id="35358"><a id="74695">DELEGATE</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _

  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35362"><span id="35360"><span id="35361"><a id="74696">OBJECT</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35365"><span id="35363"><span id="35364"><a id="74697">STRING</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35368"><span id="35366"><span id="35367"><a id="74698">STRING_ARRAY</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _

  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35371"><span id="35369"><span id="35370"><a id="74699">VALUE_TYPE</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _

  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><span id="35374"><span id="35372"><span id="35373"><a id="74700">SCALA_SYMTAB_ATTR</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.ConstructorInfo</span><span id="35377"><span id="35375"><span id="35376"><a id="74701">SYMTAB_CONSTR</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.ConstructorInfo</span><a id="34250">ConstructorInfo</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.ConstructorInfo</span><span id="35380"><span id="35378"><span id="35379"><a id="74702">SYMTAB_DEFAULT_CONSTR</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.ConstructorInfo</span><a id="34250">ConstructorInfo</a></span> = _

  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.MethodInfo</span><span id="35383"><span id="35381"><span id="35382"><a id="74703">DELEGATE_COMBINE</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.MethodInfo</span><a id="34319">MethodInfo</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.MethodInfo</span><span id="35386"><span id="35384"><span id="35385"><a id="74704">DELEGATE_REMOVE</a></span></span></span></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.MethodInfo</span><a id="34319">MethodInfo</a></span> = _

  <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.Type]</span><span id="35388"><a id="35387">types</a></span></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.Type]</span><a id="19880">Map</a></span>[Symbol,Type] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.Type]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.Type]</span><a id="20081">HashMap</a></span>
  <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.ConstructorInfo]</span><span id="35390"><a id="35389">constructors</a></span></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.ConstructorInfo]</span><a id="19880">Map</a></span>[Symbol,ConstructorInfo] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.ConstructorInfo]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.ConstructorInfo]</span><a id="20081">HashMap</a></span>
  <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.MethodInfo]</span><span id="35392"><a id="35391">methods</a></span></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.MethodInfo]</span><a id="19880">Map</a></span>[Symbol,MethodInfo] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.MethodInfo]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.MethodInfo]</span><a id="20081">HashMap</a></span>
  <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]</span><span id="35394"><a id="35393">fields</a></span></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]</span><a id="19880">Map</a></span>[Symbol, FieldInfo] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[CLRTypes.this.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]</span><a id="20081">HashMap</a></span>
  <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[ch.epfl.lamp.compiler.msil.Type,CLRTypes.this.global.Symbol]</span><span id="35396"><a id="35395">sym2type</a></span></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[ch.epfl.lamp.compiler.msil.Type,CLRTypes.this.global.Symbol]</span><a id="19880">Map</a></span>[Type,Symbol] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[ch.epfl.lamp.compiler.msil.Type,CLRTypes.this.global.Symbol]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[ch.epfl.lamp.compiler.msil.Type,CLRTypes.this.global.Symbol]</span><a id="20081">HashMap</a></span>

  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><span id="35399"><span id="35397"><span id="35398"><a id="74727">alltypes</a></span></span></span></span>: <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="1072">Array</a></span>[Type] = _

  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="35400">init</a></span>() = <span class="keyword">try</span> { <span class="comment">// initialize</span>
<span class="comment">/*
    val assems = new StringTokenizer(global.settings.assemrefs.value, File.pathSeparator)
    while (assems.hasMoreTokens()) {
      assemrefs += new File(assems.nextToken())
    }
    */</span>

    <span class="keyword">val</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a id="36606">mscorlib</a></span> = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Assembly</span><a href="#35408">findAssembly</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;mscorlib.dll&quot;)</span><span class="string">&quot;mscorlib.dll&quot;</span></span>)
    <span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Type</span><a id="34227">Type</a></span>.<span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Assembly)Unit</span><a id="35293">initMSCORLIB</a></span>(<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#36606">mscorlib</a></span>)
    <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Assembly</span><a href="#35408">findAssembly</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;scalaruntime.dll&quot;)</span><span class="string">&quot;scalaruntime.dll&quot;</span></span>)
    <span class="typed"><span class="type">()Unit</span><a href="#35409">findAllAssemblies</a></span>()

    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35316">BYTE</a></span>     = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.SByte&quot;)</span><span class="string">&quot;System.SByte&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35319">UBYTE</a></span>    = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Byte&quot;)</span><span class="string">&quot;System.Byte&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35328">CHAR</a></span>     = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Char&quot;)</span><span class="string">&quot;System.Char&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35322">SHORT</a></span>    = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Int16&quot;)</span><span class="string">&quot;System.Int16&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35325">USHORT</a></span>   = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.UInt16&quot;)</span><span class="string">&quot;System.UInt16&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35331">INT</a></span>      = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Int32&quot;)</span><span class="string">&quot;System.Int32&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35334">UINT</a></span>     = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.UInt32&quot;)</span><span class="string">&quot;System.UInt32&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35337">LONG</a></span>     = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Int64&quot;)</span><span class="string">&quot;System.Int64&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35340">ULONG</a></span>    = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.UInt64&quot;)</span><span class="string">&quot;System.UInt64&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35343">FLOAT</a></span>    = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Single&quot;)</span><span class="string">&quot;System.Single&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35346">DOUBLE</a></span>   = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Double&quot;)</span><span class="string">&quot;System.Double&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35349">BOOLEAN</a></span>  = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Boolean&quot;)</span><span class="string">&quot;System.Boolean&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35352">VOID</a></span>     = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Void&quot;)</span><span class="string">&quot;System.Void&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35355">ENUM</a></span>     = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Enum&quot;)</span><span class="string">&quot;System.Enum&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35358">DELEGATE</a></span> = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.MulticastDelegate&quot;)</span><span class="string">&quot;System.MulticastDelegate&quot;</span></span>)

    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35361">OBJECT</a></span> = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Object&quot;)</span><span class="string">&quot;System.Object&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35364">STRING</a></span> = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.String&quot;)</span><span class="string">&quot;System.String&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35367">STRING_ARRAY</a></span> = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.String[]&quot;)</span><span class="string">&quot;System.String[]&quot;</span></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35370">VALUE_TYPE</a></span> = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.ValueType&quot;)</span><span class="string">&quot;System.ValueType&quot;</span></span>)

    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Unit</span><a href="#35373">SCALA_SYMTAB_ATTR</a></span> = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;scala.runtime.SymtabAttribute&quot;)</span><span class="string">&quot;scala.runtime.SymtabAttribute&quot;</span></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="36607">bytearray</a></span>: <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="1072">Array</a></span>[Type] = <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type*)Array[ch.epfl.lamp.compiler.msil.Type]</span><span id="21530"><a id="1073">Array</a></span></span>(<span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Type</span><a id="34227">Type</a></span>.<span class="typed"><span class="type">(java.lang.String)ch.epfl.lamp.compiler.msil.Type</span><a id="35234">GetType</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Byte[]&quot;)</span><span class="string">&quot;System.Byte[]&quot;</span></span>))
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit</span><a href="#35376">SYMTAB_CONSTR</a></span> = <span class="typed"><span class="type">=&gt; ch.epfl.lamp.compiler.msil.Type</span><a href="#35372">SCALA_SYMTAB_ATTR</a></span>.<span class="typed"><span class="type">(Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo</span><a id="35242">GetConstructor</a></span>(<span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#36607">bytearray</a></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit</span><a href="#35379">SYMTAB_DEFAULT_CONSTR</a></span> = <span class="typed"><span class="type">=&gt; ch.epfl.lamp.compiler.msil.Type</span><a href="#35372">SCALA_SYMTAB_ATTR</a></span>.<span class="typed"><span class="type">(Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo</span><a id="35242">GetConstructor</a></span>(<span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Type</span><a id="34227">Type</a></span>.<span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="35178">EmptyTypes</a></span>)

    <span class="comment">//assert(SCALA_SYMTAB_ATTR != null)</span>

    <span class="keyword">val</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="36608">delegate</a></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35402">getTypeSafe</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;System.Delegate&quot;)</span><span class="string">&quot;System.Delegate&quot;</span></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="36609">dargs</a></span>: <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="1072">Array</a></span>[Type] = <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type*)Array[ch.epfl.lamp.compiler.msil.Type]</span><span id="21530"><a id="1073">Array</a></span></span>(<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#36608">delegate</a></span>, <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#36608">delegate</a></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.MethodInfo)Unit</span><a href="#35382">DELEGATE_COMBINE</a></span> = <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#36608">delegate</a></span>.<span class="typed"><span class="type">(java.lang.String,Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo</span><a id="35245">GetMethod</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Combine&quot;)</span><span class="string">&quot;Combine&quot;</span></span>, <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#36609">dargs</a></span>)
    <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.MethodInfo)Unit</span><a href="#35385">DELEGATE_REMOVE</a></span> = <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#36608">delegate</a></span>.<span class="typed"><span class="type">(java.lang.String,Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo</span><a id="35245">GetMethod</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Remove&quot;)</span><span class="string">&quot;Remove&quot;</span></span>, <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#36609">dargs</a></span>)
    <span class="comment">//assert(DELEGATE_COMBINE != null)</span>
    <span class="comment">//assert(DELEGATE_REMOVE != null)</span>


    <span class="keyword">var</span> <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="36610">alltypes</a></span>: <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="1072">Array</a></span>[Type] = <span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Type</span><a id="34227">Type</a></span>.<span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="35178">EmptyTypes</a></span>
    <span class="keyword">for</span> (<span class="typed"><span class="type">((ch.epfl.lamp.compiler.msil.Assembly) =&gt; Unit)Unit</span><span id="21792"><a id="37064">assem</a></span></span> &lt;- <span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[ch.epfl.lamp.compiler.msil.Assembly]</span><a href="#35405">assemblies</a></span>) {
      <span class="keyword">val</span> <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="37065">atypes</a></span> = <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#37064">assem</a></span>.<span class="typed"><span class="type">()Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="35812">GetTypes</a></span>().<span class="typed"><span class="type">((ch.epfl.lamp.compiler.msil.Type) =&gt; Boolean)Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="21513">filter</a></span>((<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="37068">typ</a></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span>) =&gt; <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#37068">typ</a></span>.<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="35506">DeclaringType</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>)
      <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#36610">alltypes</a></span> = <span class="typed"><span class="type">object Array</span><a id="1073">Array</a></span>.<span class="typed"><span class="type">(Seq[ch.epfl.lamp.compiler.msil.Type]*)Array[ch.epfl.lamp.compiler.msil.Type]</span><a id="21468">concat</a></span>(<span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#36610">alltypes</a></span>, <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#37065">atypes</a></span>)
    }

    <span class="typed"><span class="type">object scala.util.Sorting</span><a id="35453">Sorting</a></span>.<span class="typed"><span class="type">(Array[ch.epfl.lamp.compiler.msil.Type],(ch.epfl.lamp.compiler.msil.Type, ch.epfl.lamp.compiler.msil.Type) =&gt; Boolean)Unit</span><a id="37081">stableSort</a></span>(<span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#36610">alltypes</a></span>, (<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="37128">t1</a></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span>, <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="37129">t2</a></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span>) =&gt; (<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#37128">t1</a></span>.<span class="typed"><span class="type">java.lang.String</span><a id="35180">FullName</a></span> <span class="typed"><span class="type">(java.lang.String)Int</span><a id="5836">compareTo</a></span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#37129">t2</a></span>.<span class="typed"><span class="type">java.lang.String</span><a id="35180">FullName</a></span>) <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
    <span class="typed"><span class="type">CLRTypes.this.type</span><a href="#17568" class="keyword">this</a></span>.<span class="typed"><span class="type">(Array[ch.epfl.lamp.compiler.msil.Type])Unit</span><a href="#35398">alltypes</a></span> = <span class="typed"><span class="type">Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#36610">alltypes</a></span>
  }
  <span class="keyword">catch</span> {
    <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">RuntimeException</span><a id="37138">e</a></span>: <span class="typed"><span class="type">RuntimeException</span><a id="2002">RuntimeException</a></span> =&gt;
      <span class="typed"><span class="type">object Console</span><a id="440">Console</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a id="27062">println</a></span>(<span class="typed"><span class="type">RuntimeException</span><a href="#37138">e</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="23646">getMessage</a></span>)
      <span class="comment">// no bloody exits! exit(1)</span>
  }

  <span class="comment">//##########################################################################</span>
  <span class="comment">// type mapping and lookup</span>

<span class="comment">//   private class MyHashMap[A, B &lt;: AnyRef] extends HashMap[A, B] {</span>
<span class="comment">//     override def default(key: A): B = null;</span>
<span class="comment">//   }</span>

  <span class="keyword">def</span> <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a id="35401">getType</a></span>(<span class="typed"><span class="type">String</span><a id="74739">name</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = <span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Type</span><a id="34227">Type</a></span>.<span class="typed"><span class="type">(java.lang.String)ch.epfl.lamp.compiler.msil.Type</span><a id="35234">GetType</a></span>(<span class="typed"><span class="type">String</span><a href="#74739">name</a></span>)

  <span class="keyword">def</span> <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a id="35402">getTypeSafe</a></span>(<span class="typed"><span class="type">String</span><a id="36612">name</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="74740">t</a></span> = <span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Type</span><a id="34227">Type</a></span>.<span class="typed"><span class="type">(java.lang.String)ch.epfl.lamp.compiler.msil.Type</span><a id="35234">GetType</a></span>(<span class="typed"><span class="type">String</span><a href="#36612">name</a></span>)
    <span class="typed"><span class="type">(Boolean,=&gt; Any)Unit</span><span id="6004"><a id="821">assert</a></span></span>(<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#74740">t</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>, <span class="typed"><span class="type">String</span><a href="#36612">name</a></span>)
    <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#74740">t</a></span>
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.Type</span><a id="35403">mkArrayType</a></span>(<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="74750">elemType</a></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span>): <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span> = <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Type</span><a href="#35401">getType</a></span>(<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#74750">elemType</a></span>.<span class="typed"><span class="type">java.lang.String</span><a id="35180">FullName</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;[]&quot;)</span><span class="string">&quot;[]&quot;</span></span>)

  <span class="keyword">def</span> <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Type)Boolean</span><a id="35404">isDelegateType</a></span>(<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="74751">t</a></span>: <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="34226">Type</a></span>): <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = { <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#74751">t</a></span>.<span class="typed"><span class="type">()ch.epfl.lamp.compiler.msil.Type</span><a id="35197">BaseType</a></span>() <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">=&gt; ch.epfl.lamp.compiler.msil.Type</span><a href="#35357">DELEGATE</a></span> }

  <span class="comment">//##########################################################################</span>
  <span class="comment">// assembly loading methods</span>

  <span class="comment">// a list of all loaded assemblies</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[ch.epfl.lamp.compiler.msil.Assembly]</span><span id="35407"><span id="35405"><span id="35406"><a id="74728">assemblies</a></span></span></span></span>: <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[ch.epfl.lamp.compiler.msil.Assembly]</span><a id="19925">ListBuffer</a></span>[Assembly] = <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[ch.epfl.lamp.compiler.msil.Assembly]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[ch.epfl.lamp.compiler.msil.Assembly]</span><a id="19925">ListBuffer</a></span>()

  <span class="comment">// a set of all directories and assembly files</span>
  <span class="comment">//private var assemrefs: Set[File] = new HashSet()</span>
  
  <span class="comment">//def assembly(file : File) = assemrefs += file</span>

  <span class="comment">/** Load the assembly with the given name
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)ch.epfl.lamp.compiler.msil.Assembly</span><a id="35408">findAssembly</a></span>(<span class="typed"><span class="type">String</span><a id="36611">name</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a id="34253">Assembly</a></span> = {
    <span class="comment">// see if the assembly is referenced directly</span>
    <span class="keyword">for</span> (<span class="typed"><span class="type">((java.io.File) =&gt; Unit)Unit</span><span id="32202"><span id="32193"><span id="74787"><a id="74791">file</a></span></span></span></span> &lt;- <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#35312">global</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[java.io.File]</span><a href="../../Global.scala.html#21221">assemrefs</a></span>.<span class="typed"><span class="type">=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[java.io.File]</span><a id="25574">elements</a></span> <span class="keyword">if</span> <span class="typed"><span class="type">java.io.File</span><a href="#74787">file</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40684">getName</a></span>() <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">String</span><a href="#36611">name</a></span>) {
      <span class="keyword">val</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a id="74792">assem</a></span> = <span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Assembly</span><a id="34254">Assembly</a></span>.<span class="typed"><span class="type">(java.lang.String)ch.epfl.lamp.compiler.msil.Assembly</span><a id="35802">LoadFrom</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#74791">file</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40687">getPath</a></span>())
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74792">assem</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
	<span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#35312">global</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[java.io.File]</span><a href="../../Global.scala.html#21221">assemrefs</a></span> <span class="typed"><span class="type">(java.io.File)Unit</span><a id="25500">-=</a></span> <span class="typed"><span class="type">java.io.File</span><a href="#74791">file</a></span>
	<span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[ch.epfl.lamp.compiler.msil.Assembly]</span><a href="#35405">assemblies</a></span> <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Assembly)Unit</span><a id="33306">+=</a></span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74792">assem</a></span>
	<span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74792">assem</a></span>
      }
    }
    <span class="comment">// look in directories specified with the '-r' option</span>
    <span class="keyword">for</span> (<span class="typed"><span class="type">((java.io.File) =&gt; Unit)Unit</span><span id="32202"><span id="32193"><span id="74800"><a id="74802">dir</a></span></span></span></span> &lt;- <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#35312">global</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[java.io.File]</span><a href="../../Global.scala.html#21221">assemrefs</a></span>.<span class="typed"><span class="type">=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[java.io.File]</span><a id="25574">elements</a></span> <span class="keyword">if</span> <span class="typed"><span class="type">java.io.File</span><a href="#74800">dir</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40698">isDirectory</a></span>()) {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="74803">file</a></span> = <span class="typed"><span class="type">(java.io.File,java.lang.String)java.io.File</span><a id="40682" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#74802">dir</a></span>, <span class="typed"><span class="type">String</span><a href="#36611">name</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.io.File</span><a href="#74803">file</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40697">exists</a></span>()) {
	<span class="keyword">val</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a id="74818">assem</a></span> = <span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Assembly</span><a id="34254">Assembly</a></span>.<span class="typed"><span class="type">(java.lang.String)ch.epfl.lamp.compiler.msil.Assembly</span><a id="35802">LoadFrom</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#74803">file</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40687">getPath</a></span>())
	<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74818">assem</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
	  <span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[ch.epfl.lamp.compiler.msil.Assembly]</span><a href="#35405">assemblies</a></span> <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Assembly)Unit</span><a id="33306">+=</a></span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74818">assem</a></span>
	  <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74818">assem</a></span>
	}
      }
    }
    <span class="comment">// try in the current directory</span>
    <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="74755">file</a></span> = <span class="typed"><span class="type">(java.lang.String,java.lang.String)java.io.File</span><a id="40681" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;.&quot;)</span><span class="string">&quot;.&quot;</span></span>, <span class="typed"><span class="type">String</span><a href="#36611">name</a></span>)
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.io.File</span><a href="#74755">file</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40697">exists</a></span>()) {
      <span class="keyword">val</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a id="74836">assem</a></span> = <span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Assembly</span><a id="34254">Assembly</a></span>.<span class="typed"><span class="type">(java.lang.String)ch.epfl.lamp.compiler.msil.Assembly</span><a id="35802">LoadFrom</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#74755">file</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40687">getPath</a></span>())
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74836">assem</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
	<span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[ch.epfl.lamp.compiler.msil.Assembly]</span><a href="#35405">assemblies</a></span> <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Assembly)Unit</span><a id="33306">+=</a></span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74836">assem</a></span>
	<span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74836">assem</a></span>
      }
    }
    <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)java.lang.RuntimeException</span><a id="29859" class="keyword">new</a></span> <span class="typed"><span class="type">java.lang.RuntimeException</span><span id="5976"><a id="821">RuntimeException</a></span></span>(
      <span class="typed"><span class="type">java.lang.String(&quot;cannot find assembly &quot;)</span><span class="string">&quot;cannot find assembly &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#36611">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;; use the -Xassem-path option to specify its location&quot;)</span><span class="string">&quot;; use the -Xassem-path option to specify its location&quot;</span></span>)
  }

  <span class="comment">/** Load the rest of the assemblies specified with the '-r' option
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="35409">findAllAssemblies</a></span>() {
    <span class="keyword">for</span> (<span class="typed"><span class="type">((java.io.File) =&gt; Unit)Unit</span><span id="32202"><a id="74845">file</a></span></span> &lt;- <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#35312">global</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[java.io.File]</span><a href="../../Global.scala.html#21221">assemrefs</a></span>.<span class="typed"><span class="type">=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[java.io.File]</span><a id="25574">elements</a></span>) {
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.io.File</span><a href="#74845">file</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40699">isFile</a></span>()) {
        <span class="comment">//System.out.println(&quot;Loading assembly &quot; + file)</span>
	<span class="keyword">val</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a id="74846">assem</a></span> = <span class="typed"><span class="type">object ch.epfl.lamp.compiler.msil.Assembly</span><a id="34254">Assembly</a></span>.<span class="typed"><span class="type">(java.lang.String)ch.epfl.lamp.compiler.msil.Assembly</span><a id="35802">LoadFrom</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#74845">file</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40687">getPath</a></span>())
	<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74846">assem</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
	  <span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[ch.epfl.lamp.compiler.msil.Assembly]</span><a href="#35405">assemblies</a></span> <span class="typed"><span class="type">(ch.epfl.lamp.compiler.msil.Assembly)Unit</span><a id="33306">+=</a></span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Assembly</span><a href="#74846">assem</a></span>
	}
      }
    }
    <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#35312">global</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[java.io.File]</span><a href="../../Global.scala.html#21221">assemrefs</a></span>.<span class="typed"><span class="type">()Unit</span><a id="25501">clear</a></span>
  }

  <span class="comment">//##########################################################################</span>
  <span class="comment">// collect the members contained in a given namespace</span>

  <span class="comment">/** Find the position of the first type whose name starts with
   *  the given prefix; return the length of the types array if no match
   *  is found so the result canbe used to terminate loop conditions
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Int</span><a id="35410">findFirst</a></span>(<span class="typed"><span class="type">String</span><a id="35497">prefix</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span> = {
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="74850">m</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="74851">n</a></span> = <span class="typed"><span class="type">=&gt; Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#35397">alltypes</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
    <span class="typed"><span class="type">Unit</span><a href="#74852" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#74850">m</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int</span><a href="#74851">n</a></span>) {
      <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="74856">l</a></span> = (<span class="typed"><span class="type">Int</span><a href="#74850">m</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">Int</span><a href="#74851">n</a></span>) <span class="typed"><span class="type">(Int)Int</span><a id="3150">/</a></span> <span class="typed"><span class="type">Int(2)</span><span class="int">2</span></span>
      <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="74857">res</a></span> = <span class="typed"><span class="type">(Int)ch.epfl.lamp.compiler.msil.Type</span><a href="#35397" id="21509">alltypes</a></span>(<span class="typed"><span class="type">Int</span><a href="#74856">l</a></span>).<span class="typed"><span class="type">java.lang.String</span><a id="35180">FullName</a></span>.<span class="typed"><span class="type">(java.lang.String)Int</span><a id="5836">compareTo</a></span>(<span class="typed"><span class="type">String</span><a href="#35497">prefix</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#74857">res</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">Int</span><a href="#74850">m</a></span> = <span class="typed"><span class="type">Int</span><a href="#74856">l</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
      <span class="keyword">else</span> <span class="typed"><span class="type">Int</span><a href="#74851">n</a></span> = <span class="typed"><span class="type">Int</span><a href="#74856">l</a></span>
    }
    <span class="typed"><span class="type">Int</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Int)ch.epfl.lamp.compiler.msil.Type</span><a href="#35397" id="21509">alltypes</a></span>(<span class="typed"><span class="type">Int</span><a href="#74850">m</a></span>).<span class="typed"><span class="type">java.lang.String</span><a id="35180">FullName</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span>(<span class="typed"><span class="type">String</span><a href="#35497">prefix</a></span>)) <span class="typed"><span class="type">Int</span><a href="#74850">m</a></span> <span class="keyword">else</span> <span class="typed"><span class="type">=&gt; Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#35397">alltypes</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span>
  }

  <span class="comment">/** Collects the members contained in the given Scala package (namespace)
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(CLRTypes.this.global.Symbol,scala.collection.mutable.Map[String,ch.epfl.lamp.compiler.msil.Type],scala.collection.mutable.Set[String])Unit</span><a id="35411">collectMembers</a></span>(<span class="typed"><span class="type">CLRTypes.this.global.Symbol</span><a id="35415">pakage</a></span>: <span class="typed"><span class="type">CLRTypes.this.global.Symbol</span><a href="../Symbols.scala.html#21866">Symbol</a></span>, <span class="typed"><span class="type">scala.collection.mutable.Map[String,ch.epfl.lamp.compiler.msil.Type]</span><a id="35416">typesMap</a></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[String,ch.epfl.lamp.compiler.msil.Type]</span><a id="19880">Map</a></span>[String,Type], <span class="typed"><span class="type">scala.collection.mutable.Set[String]</span><a id="35417">namespacesSet</a></span>: <span class="typed"><span class="type">scala.collection.mutable.Set[String]</span><a id="20147">Set</a></span>[String]) = {
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="35419">namespace</a></span> = <span class="typed"><span class="type">java.lang.String</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">CLRTypes.this.global.Symbol</span><a href="#35415">pakage</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../Symbols.scala.html#25168">isRoot</a></span>) <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">CLRTypes.this.global.Symbol</span><a href="#35415">pakage</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="../Symbols.scala.html#25313">fullNameString</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;.&quot;)</span><span class="string">&quot;.&quot;</span></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="35420">nl</a></span> = <span class="typed"><span class="type">java.lang.String</span><a href="#35419">namespace</a></span>.<span class="typed"><span class="type">()Int</span><a id="5821">length</a></span>()
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="35421">i</a></span> = <span class="typed"><span class="type">(String)Int</span><a href="#35410">findFirst</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#35419">namespace</a></span>)
    <span class="typed"><span class="type">Unit</span><a href="#35498" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#35421">i</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">=&gt; Array[ch.epfl.lamp.compiler.msil.Type]</span><a href="#35397">alltypes</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">(Int)ch.epfl.lamp.compiler.msil.Type</span><a href="#35397" id="21509">alltypes</a></span>(<span class="typed"><span class="type">Int</span><a href="#35421">i</a></span>).<span class="typed"><span class="type">java.lang.String</span><a id="35180">FullName</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#35419">namespace</a></span>)) {
      <span class="keyword">val</span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a id="35528">typ</a></span> = <span class="typed"><span class="type">(Int)ch.epfl.lamp.compiler.msil.Type</span><a href="#35397" id="21509">alltypes</a></span>(<span class="typed"><span class="type">Int</span><a href="#35421">i</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#35528">typ</a></span>.<span class="typed"><span class="type">java.lang.String</span><a id="35180">FullName</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;java.lang.Object&quot;)</span><span class="string">&quot;java.lang.Object&quot;</span></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#35528">typ</a></span>.<span class="typed"><span class="type">java.lang.String</span><a id="35180">FullName</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;java.lang.String&quot;)</span><span class="string">&quot;java.lang.String&quot;</span></span>) {
	<span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="35535">k</a></span> = <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#35528">typ</a></span>.<span class="typed"><span class="type">java.lang.String</span><a id="35180">FullName</a></span>.<span class="typed"><span class="type">(java.lang.String,Int)Int</span><a id="5849">indexOf</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;.&quot;)</span><span class="string">&quot;.&quot;</span></span>, <span class="typed"><span class="type">Int</span><a href="#35420">nl</a></span>)
	<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#35535">k</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) {
	  <span class="typed"><span class="type">scala.collection.mutable.Map[String,ch.epfl.lamp.compiler.msil.Type]</span><a href="#35416">typesMap</a></span>.<span class="typed"><span class="type">(String,ch.epfl.lamp.compiler.msil.Type)Unit</span><a id="24188">update</a></span>(<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#35528">typ</a></span>.<span class="typed"><span class="type">java.lang.String</span><a id="35505">Name</a></span>, <span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#35528">typ</a></span>)
	} <span class="keyword">else</span> {
	  <span class="typed"><span class="type">scala.collection.mutable.Set[String]</span><a href="#35417">namespacesSet</a></span> <span class="typed"><span class="type">(String)Unit</span><a id="25511">+=</a></span> (<span class="typed"><span class="type">ch.epfl.lamp.compiler.msil.Type</span><a href="#35528">typ</a></span>.<span class="typed"><span class="type">java.lang.String</span><a id="35181">Namespace</a></span>.<span class="typed"><span class="type">(Int,Int)java.lang.String</span><a id="5855">substring</a></span>(<span class="typed"><span class="type">Int</span><a href="#35420">nl</a></span>, <span class="typed"><span class="type">Int</span><a href="#35535">k</a></span>))
	}
      }
      <span class="typed"><span class="type">Int</span><a href="#35421">i</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
    }
  }

    <span class="comment">//##########################################################################</span>
}  <span class="comment">// CLRTypes</span>

        </pre>
    </body>
</html>