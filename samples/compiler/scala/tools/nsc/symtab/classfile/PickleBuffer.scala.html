<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/symtab/classfile/PickleBuffer.scala</title>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */</span>
<span class="comment">// $Id: PickleBuffer.scala 16893 2009-01-13 13:09:22Z cunei $</span>

<span class="keyword">package</span> scala.tools.nsc.symtab.classfile

<span class="comment">/** Variable length byte arrays, with methods for basic pickling and unpickling.
 *
 *  @param data The initial buffer
 *  @param from The first index where defined data are found
 *  @param to   The first index where new data can be written
 */</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class PickleBuffer extends java.lang.Object with ScalaObject</span><a id="16515">PickleBuffer</a></span>(<span class="typed"><span class="type">Array[Byte]</span><span id="68890"><a id="76357">data</a></span></span>: <span class="typed"><span class="type">Array[Byte]</span><a id="1072">Array</a></span>[Byte], <span class="typed"><span class="type">Int</span><span id="68891"><a id="76358">from</a></span></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>, <span class="typed"><span class="type">Int</span><span id="68892"><a id="76359">to</a></span></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) {

  <span class="keyword">var</span> <span class="typed"><span class="type">Array[Byte]</span><span id="68896"><span id="68894"><span id="68895"><a id="145278">bytes</a></span></span></span></span> = <span class="typed"><span class="type">Array[Byte]</span><a href="#68890">data</a></span>
  <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><span id="68899"><span id="68897"><span id="68898"><a id="145279">readIndex</a></span></span></span></span> = <span class="typed"><span class="type">Int</span><a href="#68891">from</a></span>
  <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><span id="68902"><span id="68900"><span id="68901"><a id="145280">writeIndex</a></span></span></span></span> = <span class="typed"><span class="type">Int</span><a href="#68892">to</a></span>

  <span class="comment">/** Double bytes array */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="68903">dble</a></span>() {
    <span class="keyword">val</span> <span class="typed"><span class="type">Array[Byte]</span><a id="145281">bytes1</a></span> = <span class="typed"><span class="type">Array[Byte]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Byte]</span><a id="1072">Array</a></span>[Byte](<span class="typed"><span class="type">=&gt; Array[Byte]</span><a href="#68894">bytes</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3149">*</a></span> <span class="typed"><span class="type">Int(2)</span><span class="int">2</span></span>)
    <span class="typed"><span class="type">object Array</span><a id="1073">Array</a></span>.<span class="typed"><span class="type">(AnyRef,Int,AnyRef,Int,Int)Unit</span><a id="21467">copy</a></span>(<span class="typed"><span class="type">=&gt; Array[Byte]</span><a href="#68894">bytes</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Array[Byte]</span><a href="#145281">bytes1</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">=&gt; Int</span><a href="#68900">writeIndex</a></span>)
    <span class="typed"><span class="type">(Array[Byte])Unit</span><a href="#68895">bytes</a></span> = <span class="typed"><span class="type">Array[Byte]</span><a href="#145281">bytes1</a></span>
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Unit</span><a id="68904">ensureCapacity</a></span>(<span class="typed"><span class="type">Int</span><a id="76744">capacity</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) =
    <span class="typed"><span class="type">Unit</span><a href="#76746" class="keyword">while</a></span> (<span class="typed"><span class="type">=&gt; Array[Byte]</span><a href="#68894">bytes</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">=&gt; Int</span><a href="#68900">writeIndex</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">Int</span><a href="#76744">capacity</a></span>) <span class="typed"><span class="type">()Unit</span><a href="#68903">dble</a></span>()

  <span class="comment">// -- Basic output routines --------------------------------------------</span>

  <span class="comment">/** Write a byte of data */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Unit</span><a id="68905">writeByte</a></span>(<span class="typed"><span class="type">Int</span><a id="77106">b</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#68900">writeIndex</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">=&gt; Array[Byte]</span><a href="#68894">bytes</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span>) <span class="typed"><span class="type">()Unit</span><a href="#68903">dble</a></span>()
    <span class="typed"><span class="type">=&gt; Array[Byte]</span><a href="#68894">bytes</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="#68900">writeIndex</a></span>) = <span class="typed"><span class="type">Int</span><a href="#77106">b</a></span>.<span class="typed"><span class="type">Byte</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">Byte</span><a id="2379">Byte</a></span>]
    <span class="typed"><span class="type">(Int)Unit</span><a href="#68901">writeIndex</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
  }

  <span class="comment">/** Write a natural number in big endian format, base 128.
   *  All but the last digits have bit 0x80 set.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Unit</span><a id="68906">writeNat</a></span>(<span class="typed"><span class="type">Int</span><a id="76608">x</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) {
    <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Unit</span><a id="145325">writeNatPrefix</a></span>(<span class="typed"><span class="type">Int</span><a id="145327">x</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) {
      <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="145328">y</a></span> = <span class="typed"><span class="type">Int</span><a href="#145327">x</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3092">&gt;&gt;&gt;</a></span> <span class="typed"><span class="type">Int(7)</span><span class="int">7</span></span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#145328">y</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3142">!=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">(Int)Unit</span><a href="#145325">writeNatPrefix</a></span>(<span class="typed"><span class="type">Int</span><a href="#145328">y</a></span>)
      <span class="typed"><span class="type">(Int)Unit</span><a href="#68905">writeByte</a></span>((<span class="typed"><span class="type">Int</span><a href="#145327">x</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3153">&amp;</a></span> <span class="typed"><span class="type">Int(127)</span><span class="int">0x7f</span></span>) <span class="typed"><span class="type">(Int)Int</span><a id="3152">|</a></span> <span class="typed"><span class="type">Int(128)</span><span class="int">0x80</span></span>)
    }
    <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="145326">y</a></span> = <span class="typed"><span class="type">Int</span><a href="#76608">x</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3092">&gt;&gt;&gt;</a></span> <span class="typed"><span class="type">Int(7)</span><span class="int">7</span></span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#145326">y</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3142">!=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">(Int)Unit</span><a href="#145325">writeNatPrefix</a></span>(<span class="typed"><span class="type">Int</span><a href="#145326">y</a></span>)
    <span class="typed"><span class="type">(Int)Unit</span><a href="#68905">writeByte</a></span>(<span class="typed"><span class="type">Int</span><a href="#76608">x</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3153">&amp;</a></span> <span class="typed"><span class="type">Int(127)</span><span class="int">0x7f</span></span>)
  }

  <span class="comment">/** Write a natural number &lt;code&gt;x&lt;/code&gt; at position &lt;code&gt;pos&lt;/code&gt;.
   *  If number is more than one byte, shift rest of array to make space.
   *
   *  @param pos ...
   *  @param x   ...
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Int,Int)Unit</span><a id="68907">patchNat</a></span>(<span class="typed"><span class="type">Int</span><a id="77107">pos</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>, <span class="typed"><span class="type">Int</span><a id="77108">x</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) {
    <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Unit</span><a id="145346">patchNatPrefix</a></span>(<span class="typed"><span class="type">Int</span><a id="145348">x</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) {
      <span class="typed"><span class="type">(Int)Unit</span><a href="#68905">writeByte</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
      <span class="typed"><span class="type">object Array</span><a id="1073">Array</a></span>.<span class="typed"><span class="type">(AnyRef,Int,AnyRef,Int,Int)Unit</span><a id="21467">copy</a></span>(<span class="typed"><span class="type">=&gt; Array[Byte]</span><a href="#68894">bytes</a></span>, <span class="typed"><span class="type">Int</span><a href="#77107">pos</a></span>, <span class="typed"><span class="type">=&gt; Array[Byte]</span><a href="#68894">bytes</a></span>, <span class="typed"><span class="type">Int</span><a href="#77107">pos</a></span><span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span><span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>, <span class="typed"><span class="type">=&gt; Int</span><a href="#68900">writeIndex</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span> (<span class="typed"><span class="type">Int</span><a href="#77107">pos</a></span><span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span><span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>))
      <span class="typed"><span class="type">=&gt; Array[Byte]</span><a href="#68894">bytes</a></span>(<span class="typed"><span class="type">Int</span><a href="#77107">pos</a></span>) = ((<span class="typed"><span class="type">Int</span><a href="#145348">x</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3153">&amp;</a></span> <span class="typed"><span class="type">Int(127)</span><span class="int">0x7f</span></span>) <span class="typed"><span class="type">(Int)Int</span><a id="3152">|</a></span> <span class="typed"><span class="type">Int(128)</span><span class="int">0x80</span></span>).<span class="typed"><span class="type">Byte</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">Byte</span><a id="2379">Byte</a></span>]
      <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="145349">y</a></span> = <span class="typed"><span class="type">Int</span><a href="#145348">x</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3092">&gt;&gt;&gt;</a></span> <span class="typed"><span class="type">Int(7)</span><span class="int">7</span></span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#145349">y</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3142">!=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">(Int)Unit</span><a href="#145346">patchNatPrefix</a></span>(<span class="typed"><span class="type">Int</span><a href="#145349">y</a></span>)
    }
    <span class="typed"><span class="type">=&gt; Array[Byte]</span><a href="#68894">bytes</a></span>(<span class="typed"><span class="type">Int</span><a href="#77107">pos</a></span>) = (<span class="typed"><span class="type">Int</span><a href="#77108">x</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3153">&amp;</a></span> <span class="typed"><span class="type">Int(127)</span><span class="int">0x7f</span></span>).<span class="typed"><span class="type">Byte</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">Byte</span><a id="2379">Byte</a></span>]
    <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="145347">y</a></span> = <span class="typed"><span class="type">Int</span><a href="#77108">x</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3092">&gt;&gt;&gt;</a></span> <span class="typed"><span class="type">Int(7)</span><span class="int">7</span></span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#145347">y</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3142">!=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">(Int)Unit</span><a href="#145346">patchNatPrefix</a></span>(<span class="typed"><span class="type">Int</span><a href="#145347">y</a></span>)
  }

  <span class="comment">/** Write a long number &lt;code&gt;x&lt;/code&gt; in signed big endian format, base 256.
   *
   *  @param x The long number to be written.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Long)Unit</span><a id="68908">writeLong</a></span>(<span class="typed"><span class="type">Long</span><a id="76867">x</a></span>: <span class="typed"><span class="type">Long</span><a id="2399">Long</a></span>) {
    <span class="keyword">val</span> <span class="typed"><span class="type">Long</span><a id="145392">y</a></span> = <span class="typed"><span class="type">Long</span><a href="#76867">x</a></span> <span class="typed"><span class="type">(Int)Long</span><a id="3203">&gt;&gt;</a></span> <span class="typed"><span class="type">Int(8)</span><span class="int">8</span></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">Long</span><a id="145393">z</a></span> = <span class="typed"><span class="type">Long</span><a href="#76867">x</a></span> <span class="typed"><span class="type">(Int)Long</span><a id="3262">&amp;</a></span> <span class="typed"><span class="type">Int(255)</span><span class="int">0xff</span></span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (-<span class="typed"><span class="type">=&gt; Long</span><a href="#145392" id="3206">y</a></span> <span class="typed"><span class="type">(Long)Boolean</span><a id="3265">!=</a></span> (<span class="typed"><span class="type">Long</span><a href="#145393">z</a></span> <span class="typed"><span class="type">(Int)Long</span><a id="3203">&gt;&gt;</a></span> <span class="typed"><span class="type">Int(7)</span><span class="int">7</span></span>)) <span class="typed"><span class="type">(Long)Unit</span><a href="#68908">writeLong</a></span>(<span class="typed"><span class="type">Long</span><a href="#145392">y</a></span>)
    <span class="typed"><span class="type">(Int)Unit</span><a href="#68905">writeByte</a></span>(<span class="typed"><span class="type">Long</span><a href="#145393">z</a></span>.<span class="typed"><span class="type">Int</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>])
  }

  <span class="comment">// -- Basic input routines --------------------------------------------</span>

  <span class="comment">/** Peek at the current byte without moving the read index */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Int</span><a id="68909">peekByte</a></span>(): <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span> = <span class="typed"><span class="type">implicit scala.Predef.byte2int : (Byte)Int</span><span id="6200"><span id="821"><a href="#68894" id="21509">bytes</a></span></span></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="#68897">readIndex</a></span>)

  <span class="comment">/** Read a byte */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Int</span><a id="68910">readByte</a></span>(): <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">Byte</span><a id="145403">x</a></span> = <span class="typed"><span class="type">(Int)Byte</span><a href="#68894" id="21509">bytes</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="#68897">readIndex</a></span>); <span class="typed"><span class="type">(Int)Unit</span><a href="#68898">readIndex</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>; <span class="typed"><span class="type">implicit scala.Predef.byte2int : (Byte)Int</span><span id="6200"><a href="#145403" id="821">x</a></span></span>
  }

  <span class="comment">/** Read a natural number in big endian format, base 128.
   *  All but the last digits have bit 0x80 set.*/</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Int</span><a id="68911">readNat</a></span>(): <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span> = {
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="145430">b</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="145431">x</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
    <span class="typed"><span class="type">Unit</span><a href="#145432" class="keyword">do</a></span> {
      <span class="typed"><span class="type">Int</span><a href="#145430">b</a></span> = <span class="typed"><span class="type">()Int</span><a href="#68910">readByte</a></span>()
      <span class="typed"><span class="type">Int</span><a href="#145431">x</a></span> = (<span class="typed"><span class="type">Int</span><a href="#145431">x</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3090">&lt;&lt;</a></span> <span class="typed"><span class="type">Int(7)</span><span class="int">7</span></span>) <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> (<span class="typed"><span class="type">Int</span><a href="#145430">b</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3153">&amp;</a></span> <span class="typed"><span class="type">Int(127)</span><span class="int">0x7f</span></span>)
    } <span class="keyword">while</span> ((<span class="typed"><span class="type">Int</span><a href="#145430">b</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3153">&amp;</a></span> <span class="typed"><span class="type">Int(128)</span><span class="int">0x80</span></span>) <span class="typed"><span class="type">(Int)Boolean</span><a id="3142">!=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>);
    <span class="typed"><span class="type">Int</span><a href="#145431">x</a></span>
  }

  <span class="comment">/** Read a long number in signed big endian format, base 256. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Long</span><a id="68912">readLong</a></span>(<span class="typed"><span class="type">Int</span><a id="122086">len</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>): <span class="typed"><span class="type">Long</span><a id="2399">Long</a></span> = {
    <span class="keyword">var</span> <span class="typed"><span class="type">Long</span><a id="145456">x</a></span> = <span class="typed"><span class="type">Long(0L)</span><span class="long">0L</span></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="145457">i</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
    <span class="typed"><span class="type">Unit</span><a href="#145459" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#145457">i</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int</span><a href="#122086">len</a></span>) {
      <span class="typed"><span class="type">Long</span><a href="#145456">x</a></span> = (<span class="typed"><span class="type">Long</span><a href="#145456">x</a></span> <span class="typed"><span class="type">(Int)Long</span><a id="3199">&lt;&lt;</a></span> <span class="typed"><span class="type">Int(8)</span><span class="int">8</span></span>) <span class="typed"><span class="type">(Int)Long</span><a id="3256">+</a></span> (<span class="typed"><span class="type">()Int</span><a href="#68910">readByte</a></span>() <span class="typed"><span class="type">(Int)Int</span><a id="3153">&amp;</a></span> <span class="typed"><span class="type">Int(255)</span><span class="int">0xff</span></span>)
      <span class="typed"><span class="type">Int</span><a href="#145457">i</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
    }
    <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="145458">leading</a></span> = <span class="typed"><span class="type">Int(64)</span><span class="int">64</span></span> <span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span> (<span class="typed"><span class="type">Int</span><a href="#122086">len</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3090">&lt;&lt;</a></span> <span class="typed"><span class="type">Int(3)</span><span class="int">3</span></span>)
    <span class="typed"><span class="type">Long</span><a href="#145456">x</a></span> <span class="typed"><span class="type">(Int)Long</span><a id="3199">&lt;&lt;</a></span> <span class="typed"><span class="type">Int</span><a href="#145458">leading</a></span> <span class="typed"><span class="type">(Int)Long</span><a id="3203">&gt;&gt;</a></span> <span class="typed"><span class="type">Int</span><a href="#145458">leading</a></span>
  }

  <span class="comment">/** Perform operation &lt;code&gt;op&lt;/code&gt; until the condition
   *  &lt;code&gt;readIndex == end&lt;/code&gt; is satisfied.
   *  Concatenate results into a list.
   *
   *  @param end ...
   *  @param op  ...
   *  @return    ...
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">[T](Int,() =&gt; T)List[T]</span><a id="68913">until</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="68915">T</a></span>](<span class="typed"><span class="type">Int</span><a id="122038">end</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>, <span class="typed"><span class="type">() =&gt; T</span><a id="122039">op</a></span>: () =&gt; T): <span class="typed"><span class="type">List[T]</span><a id="526">List</a></span>[T] =
    <span class="typed"><span class="type">List[T]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#68897">readIndex</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int</span><a href="#122038">end</a></span>) <span class="typed"><span class="type">object Nil</span><a id="335">List</a></span>() <span class="keyword">else</span> <span class="typed"><span class="type">()T</span><a href="#122039" id="31093">op</a></span>() <span class="typed"><span class="type">(T)List[T]</span><a href="#145506" id="21335">::</a></span> <span class="typed"><span class="type">(Int,() =&gt; T)List[T]</span><a href="#68913">until</a></span>(<span class="typed"><span class="type">Int</span><a href="#122038">end</a></span>, <span class="typed"><span class="type">() =&gt; T</span><a href="#122039">op</a></span>);

  <span class="comment">/** Perform operation &lt;code&gt;op&lt;/code&gt; the number of
   *  times specified.  Concatenate the results into a list.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">[T](Int,() =&gt; T)List[T]</span><a id="68916">times</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="68918">T</a></span>](<span class="typed"><span class="type">Int</span><a id="122143">n</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>, <span class="typed"><span class="type">() =&gt; T</span><a id="122144">op</a></span>: ()=&gt;T): <span class="typed"><span class="type">List[T]</span><a id="526">List</a></span>[T] =
    <span class="typed"><span class="type">List[T]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#122143">n</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">object Nil</span><a id="335">List</a></span>() <span class="keyword">else</span> <span class="typed"><span class="type">()T</span><a href="#122144" id="31093">op</a></span>() <span class="typed"><span class="type">(T)List[T]</span><a href="#145512" id="21335">::</a></span> <span class="typed"><span class="type">(Int,() =&gt; T)List[T]</span><a href="#68916">times</a></span>(<span class="typed"><span class="type">Int</span><a href="#122143">n</a></span><span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span><span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>, <span class="typed"><span class="type">() =&gt; T</span><a href="#122144">op</a></span>)

  <span class="comment">/** Create an index.
   *
   *  @return ...
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Array[Int]</span><a id="68919">createIndex</a></span>: <span class="typed"><span class="type">Array[Int]</span><a id="1072">Array</a></span>[Int] = {
    <span class="keyword">val</span> <span class="typed"><span class="type">Array[Int]</span><a id="145530">index</a></span> = <span class="typed"><span class="type">Array[Int]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Int]</span><a id="1072">Array</a></span>[Int](<span class="typed"><span class="type">()Int</span><a href="#68911">readNat</a></span>())
    <span class="keyword">for</span> (<span class="typed"><span class="type">((Int) =&gt; Unit)Unit</span><span id="40475"><a id="145541">i</a></span></span> &lt;- <span class="typed"><span class="type">implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt</span><span id="6133"><a id="821" class="int">0</a></span></span> <span class="typed"><span class="type">(Int)Range</span><a id="26778">until</a></span> <span class="typed"><span class="type">Array[Int]</span><a href="#145530">index</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span>) {
      <span class="typed"><span class="type">Array[Int]</span><a href="#145530">index</a></span>(<span class="typed"><span class="type">Int</span><a href="#145541">i</a></span>) = <span class="typed"><span class="type">=&gt; Int</span><a href="#68897">readIndex</a></span>
      <span class="typed"><span class="type">()Int</span><a href="#68910">readByte</a></span>()
      <span class="typed"><span class="type">(Int)Unit</span><a href="#68898">readIndex</a></span> = <span class="typed"><span class="type">()Int</span><a href="#68911">readNat</a></span>() <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">=&gt; Int</span><a href="#68897">readIndex</a></span>
    }
    <span class="typed"><span class="type">Array[Int]</span><a href="#145530">index</a></span>
  }
}

        </pre>
    </body>
</html>