<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/interpreter/Completion.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author Paul Phillips
 */
// $Id$

//
// TODO, if practical:
//
// 1) Types: val s: String = x.&lt;tab&gt; should only show members which result in a String.
//      Possible approach: evaluate buffer as if current identifier is 
// 2) Implicits: x.&lt;tab&gt; should show not only x's members but those of anything for which
//      there is an implicit conversion from x.
// 3) Chaining: x.foo(bar).&lt;tab&gt; should complete on foo's result type.
// 4) Imports: after import scala.collection.mutable._, HashMap should be among
//      my top level identifiers.
// 5) Caching: it's silly to parse all the jars on every startup, we should have
//      a peristent store somewhere we can write and only check last-mod dates.
// 6) Security: Are we using the filesystem unnecessarily?
//

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interpreter

<span class="keyword">import</span> jline._
<span class="keyword">import</span> java.net.URL
<span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap
<span class="keyword">import</span> scala.concurrent.DelayedLazyVal

// REPL completor - queries supplied interpreter for valid completions
// based on current contents of buffer.
<span class="keyword">class</span> <a title="class Completion extends java.lang.Object with jline.Completor with ScalaObject" id="22210">Completion</a><span title="ScalaObject">(</span><span class="keyword">val</span> <a title="scala.tools.nsc.Interpreter" id="591701">interpreter</a>: <a href="../Interpreter.scala.html#8370" title="scala.tools.nsc.Interpreter">Interpreter</a>) <span class="keyword">extends</span> <a title="jline.Completor" id="125999">Completor</a> {
  <span class="keyword">import</span> Completion._
  <span class="keyword">import</span> java.util.{ List =&gt; JList }
  <span class="keyword">import</span> interpreter.compilerClasspath
  
  // it takes a little while to look through the jars so we use a future and a concurrent map
  <span class="keyword">class</span> <a title="class CompletionAgent extends java.lang.Object with ScalaObject" id="591694">CompletionAgent</a> <span title="ScalaObject">{</span>
    <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[String,List[String]]" id="755984">dottedPaths</a> = <a title="()java.util.concurrent.ConcurrentHashMap[String,List[String]]" id="756052" class="keyword">new</a> <span title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">ConcurrentHashMap</span>[String, List[String]]
    <span class="keyword">val</span> <a title="scala.concurrent.DelayedLazyVal[List[String]]" id="755986">topLevelPackages</a> = <span title="scala.concurrent.DelayedLazyVal[List[String]]" class="keyword">new</span> <a title="scala.concurrent.DelayedLazyVal[List[String]]" id="126651">DelayedLazyVal</a>(
      () =&gt; <a href="#125762" title="(e: java.util.Enumeration[String])List[String]">enumToList</a><a title="(p: (String) =&gt; Boolean)List[String]" id="25271">(</a><a href="#755984" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,List[String]]">dottedPaths</a>.<a title="()java.util.Enumeration[String]" id="756113">keys</a>) filterNot (<a href="#756233" title="(elem: Any)Boolean">_</a> contains <span title="Char('.')" class="char">'.'</span>),
      <a href="#125775" title="(map: java.util.concurrent.ConcurrentHashMap[String,List[String]],interpreter: scala.tools.nsc.Interpreter)Unit">getDottedPaths</a>(<a href="#755984" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,List[String]]">dottedPaths</a>, <a href="#591701" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>)
    )
  }
  <span class="keyword">val</span> <a title="Completion.this.CompletionAgent" id="591695">agent</a> = <span title="Completion.this.CompletionAgent" class="keyword">new</span> <a href="#591694" title="Completion.this.CompletionAgent">CompletionAgent</a>
  <span class="keyword">import</span> agent._  

  // One instance of a command line
  <span class="keyword">class</span> <a title="class Buffer extends java.lang.Object with ScalaObject" id="591698">Buffer</a><span title="ScalaObject">(</span><a title="String" id="756392">s</a>: <span title="String">String</span>) {
    <span class="keyword">val</span> <a title="java.lang.String" id="756274">buffer</a> = <span title="java.lang.String" class="keyword">if</span> (<a href="#756392" title="(x$1: AnyRef)Boolean">s</a> == <span title="Null(null)" class="keyword">null</span>) <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <a href="#756392" title="String">s</a>
    <span class="keyword">val</span> <a title="List[java.lang.String]" id="756276">segments</a> = <a href="#756274" title="=&gt; java.lang.String">buffer</a>.<a title="(x$1: java.lang.String,x$2: Int)Array[java.lang.String]" id="7040">split</a>(<span title="java.lang.String(&quot;\.&quot;)" class="string">&quot;\\.&quot;</span>, <span title="Int(-1)">-</span><span class="int">1</span>).<span title="=&gt; List[java.lang.String]">toList</span>
    <span class="keyword">val</span> <a title="Int" id="756278">lastDot</a> = <a href="#756274" title="=&gt; java.lang.String">buffer</a>.<a title="(x$1: Int)Int" id="6983">lastIndexOf</a>(<span title="Int(46)" class="char">'.'</span>)
    <span class="keyword">val</span> <a title="Boolean" id="756280">hasDot</a> = <a href="#756276" title="=&gt; List[java.lang.String]">segments</a>.<span title="(x$1: Int)Boolean">size</span> <span title="(x$1: Boolean)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> &amp;&amp; <a href="#756276" title="=&gt; List[java.lang.String]">segments</a>.<span title="(x$1: AnyRef)Boolean">last</span> == <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
    
    // given foo.bar.baz, path = foo.bar and stub = baz
    <span class="keyword">val</span> <a href="#756283" title="(java.lang.String, java.lang.String)">(</a><a href="#756282" title="java.lang.String" id="756283">path</a>, <a href="#756282" title="java.lang.String" id="756285">stub</a>) = <a href="#756276" title="=&gt; List[java.lang.String]">segments</a>.<span title="=&gt; Int">size</span> <span title="(java.lang.String, java.lang.String)" class="keyword">match</span> {
      <span title="(java.lang.String, java.lang.String)" class="keyword">case</span> <span title="Int(0)" class="int">0</span>    =&gt; <span title="(_1: java.lang.String,_2: java.lang.String)(java.lang.String, java.lang.String)">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <span title="(java.lang.String, java.lang.String)" class="keyword">case</span> <span title="Int(1)" class="int">1</span>    =&gt; <span title="(_1: java.lang.String,_2: java.lang.String)(java.lang.String, java.lang.String)">(</span><a href="#756276" title="=&gt; List[java.lang.String]">segments</a>.<span title="=&gt; java.lang.String">head</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <span title="(String, java.lang.String)" class="keyword">case</span> _    =&gt; <span title="(_1: String,_2: java.lang.String)(String, java.lang.String)">(</span><a href="#756276" title="=&gt; List[java.lang.String]">segments</a>.<a title="=&gt; List[java.lang.String]" id="25321">init</a>.<span title="(sep: String)String">mkString</span>(<span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>), <a href="#756276" title="=&gt; List[java.lang.String]">segments</a>.<span title="=&gt; java.lang.String">last</span>)
    }

    <span class="keyword">def</span> <a title="(xs: List[String])List[String]" id="756287">filt</a>(<a title="List[String]" id="756395">xs</a>: <span title="List[String]">List</span>[String]) = <a href="#756395" title="(p: (String) =&gt; Boolean)List[String]">xs</a> filter (<a href="#756400" title="(x$1: java.lang.String)Boolean">_</a> startsWith <a href="#756285" title="=&gt; java.lang.String">stub</a>)

    case <span class="keyword">class</span> <a title="class Result extends java.lang.Object with ScalaObject with Product" id="756589">Result</a><span title="ScalaObject">(</span><a title="List[String]" id="756847">candidates</a>: <span title="List[String]">List</span>[String], <a title="Int" id="756848">position</a>: <span title="Int">Int</span>) {
      <span class="keyword">def</span> <a title="()List[java.lang.String]" id="756414">getCandidates</a>() = <a title="(lt: (java.lang.String, java.lang.String) =&gt; Boolean)List[java.lang.String]" id="24310">(</a><a href="#756847" title="(f: (String) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[String]])List[java.lang.String]">candidates</a> <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">map</span> (<a href="#756433" title="String">_</a>.<a title="()java.lang.String" id="7051">trim</a>) <span title="=&gt; List[java.lang.String]">removeDuplicates</span>) sort (<a href="#756516" title="(that: String)Boolean" id="30823">_</a> &lt; <a href="#756517" title="java.lang.String">_</a>)
    }
    
    // work out completion candidates and position
    <span class="keyword">def</span> <a title="(clist: java.util.List[String])Buffer.this.Result" id="756291">analyzeBuffer</a>(<a title="java.util.List[String]" id="756643">clist</a>: <span title="java.util.List[String]">JList</span>[String]): <a href="#756589" title="Buffer.this.Result">Result</a> = {
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="756646">ids</a> = <a href="#756301" title="(s: String)List[String]">idsStartingWith</a>(<a href="#756283" title="=&gt; java.lang.String">path</a>)
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="756648">pkgs</a> = <a href="#756300" title="(s: String)List[String]">pkgsStartingWith</a>(<a href="#756283" title="=&gt; java.lang.String">path</a>)
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Int" id="756650">count</a> = (<a href="#756645" title="=&gt; List[String]">ids</a> <a href="#756838" title="List[String]">:::</a> <a href="#756647" title="(prefix: List[String])List[String]">pkgs</a>).<span title="=&gt; Int">size</span>        
      
      <span class="keyword">def</span> <a title="()Buffer.this.Result" id="756651">doSimple</a>(): <a href="#756589" title="Buffer.this.Result">Result</a> = <a href="#756649" title="=&gt; Int">count</a> <span title="Buffer.this.Result" class="keyword">match</span> {
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(0)" class="int">0</span>                                    =&gt; <a href="#756589" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<span title="object Nil">Nil</span>, <span title="Int(0)" class="int">0</span>)
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(1)" class="int">1</span> <span class="keyword">if</span> <a href="#756647" title="=&gt; List[String]">pkgs</a>.<span title="(x$1: Int)Boolean">size</span> &gt; <span title="Int(0)" class="int">0</span>                   =&gt; <a href="#756589" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#756647" title="=&gt; List[String]">pkgs</a>, <span title="Int(0)" class="int">0</span>)
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(1)" class="int">1</span> <span class="keyword">if</span> <a href="#756274" title="=&gt; java.lang.String">buffer</a>.<a title="(x$1: Int)Boolean" id="2956">length</a> &lt; <a href="#756645" title="=&gt; List[String]">ids</a>.<span title="=&gt; String">head</span>.<span title="()Int">length</span> =&gt; <a href="#756589" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#756645" title="=&gt; List[String]">ids</a>, <span title="Int(0)" class="int">0</span>)
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(1)" class="int">1</span>                                    =&gt; <a href="#756589" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#756645" title="=&gt; List[String]">ids</a>, <span title="Int(0)" class="int">0</span>)
          // XXX for now commented out &quot;dot inference&quot; because it's overcomplicated
          // val members = membersOfId(ids.head) filter (_ startsWith stub)
          // if (members.isEmpty) Result(Nil, 0)
          // else Result(members, path.length + 1)
        <span title="Buffer.this.Result" class="keyword">case</span> _                                    =&gt; <a href="#756589" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#756645" title="=&gt; List[String]">ids</a> <a href="#756917" title="List[String]">:::</a> <a href="#756647" title="(prefix: List[String])List[String]">pkgs</a>, <span title="Int(0)" class="int">0</span>)
      }
      
      // a few keywords which don't appear as methods via reflection
      <span class="keyword">val</span> <a title="List[java.lang.String]" id="756652">memberKeywords</a> = <span title="(xs: java.lang.String*)List[java.lang.String]">List</span>(<span title="java.lang.String(&quot;isInstanceOf&quot;)" class="string">&quot;isInstanceOf&quot;</span>, <span title="java.lang.String(&quot;asInstanceOf&quot;)" class="string">&quot;asInstanceOf&quot;</span>)      
      <span class="keyword">def</span> <a title="()Buffer.this.Result" id="756653">doDotted</a>(): <a href="#756589" title="Buffer.this.Result">Result</a> = {
        <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="756937">pkgs</a> = <a href="#756287" title="(xs: List[String])List[String]">filt</a>(<a href="#756295" title="(s: String)List[String]">membersOfPath</a>(<a href="#756283" title="=&gt; java.lang.String">path</a>))
        <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="756939">ids</a> = <a href="#756287" title="(xs: List[String])List[String]">filt</a>(<a href="#756293" title="(s: String)List[String]">membersOfId</a>(<a href="#756283" title="=&gt; java.lang.String">path</a>))
        <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="756941">idExtras</a> = <a href="#756287" title="(xs: List[String])List[String]">filt</a>(<a href="#756652" title="List[java.lang.String]">memberKeywords</a>)  // isInstanceOf and asInstanceOf
        <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="756943">statics</a> = <a href="#756287" title="(xs: List[String])List[String]">filt</a>(<a href="#591700" title="(path: String)List[String]">completeStaticMembers</a>(<a href="#756283" title="=&gt; java.lang.String">path</a>))
        
        <span title="Buffer.this.Result" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#756936" title="=&gt; List[String]">pkgs</a>.<span title="=&gt; Boolean">isEmpty</span>) <a href="#756589" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#756936" title="=&gt; List[String]">pkgs</a>, <a href="#756283" title="=&gt; java.lang.String">path</a>.<span title="(x$1: Int)Int">length</span> + <span title="Int(1)" class="int">1</span>)
        <span class="keyword">else</span> <span title="Buffer.this.Result" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#756938" title="=&gt; List[String]">ids</a>.<span title="=&gt; Boolean">isEmpty</span>) <a href="#756589" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#756938" title="=&gt; List[String]">ids</a> <a href="#757005" title="List[String]">:::</a> <a href="#756940" title="(prefix: List[String])List[String]">idExtras</a>, <a href="#756283" title="=&gt; java.lang.String">path</a>.<span title="(x$1: Int)Int">length</span> + <span title="Int(1)" class="int">1</span>)
        <span class="keyword">else</span> <a href="#756589" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#756942" title="=&gt; List[String]">statics</a> <a href="#757047" title="List[String]">:::</a> <a href="#756940" title="(prefix: List[String])List[String]">idExtras</a>, <a href="#756283" title="=&gt; java.lang.String">path</a>.<span title="(x$1: Int)Int">length</span> + <span title="Int(1)" class="int">1</span>)
      }
      
      <a href="#756276" title="=&gt; List[java.lang.String]">segments</a>.<span title="=&gt; Int">size</span> <span title="Buffer.this.Result" class="keyword">match</span> {
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(0)" class="int">0</span>            =&gt; <a href="#756589" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<span title="object Nil">Nil</span>, <span title="Int(0)" class="int">0</span>)
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(1)" class="int">1</span>            =&gt; <a href="#756651" title="()Buffer.this.Result">doSimple</a>()
        <span title="Buffer.this.Result" class="keyword">case</span> _            =&gt; <a href="#756653" title="()Buffer.this.Result">doDotted</a>()
      }
    }
    
    <span class="keyword">def</span> <a title="(s: String)Boolean" id="756292">isValidId</a>(<a title="String" id="757095">s</a>: <span title="String">String</span>) = <a href="#591701" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="../Interpreter.scala.html#117276" title="(elem: Any)Boolean">unqualifiedIds</a> contains <a href="#757095" title="String">s</a>
    <span class="keyword">def</span> <a title="(s: String)List[String]" id="756293">membersOfId</a>(<a title="String" id="756693">s</a>: <span title="String">String</span>) = <a href="../Interpreter.scala.html#117275" title="(line: String)List[String]">interpreter</a> membersOfIdentifier <a href="#756693" title="String">s</a>
    
    <span class="keyword">def</span> <a title="(s: String)Boolean" id="756294">isValidPath</a>(<a title="String" id="756671">s</a>: <span title="String">String</span>) = <a href="#755984" title="(x$1: Any)Boolean">dottedPaths</a> containsKey <a href="#756671" title="String">s</a>
    <span class="keyword">def</span> <a title="(s: String)List[String]" id="756295">membersOfPath</a>(<a title="String" id="756668">s</a>: <span title="String">String</span>) = <span title="List[String]" class="keyword">if</span> (<a href="#756294" title="(s: String)Boolean">isValidPath</a>(<a href="#756668" title="String">s</a>)) <a href="#755984" title="(x$1: Any)List[String]">dottedPaths</a> get <a href="#756668" title="String">s</a> <span class="keyword">else</span> <span title="object Nil">Nil</span>
    
    // XXX generalize this to look through imports
    <span class="keyword">def</span> <a title="()List[String]" id="756296">membersOfScala</a>() = <a href="#756295" title="(s: String)List[String]">membersOfPath</a>(<span title="java.lang.String(&quot;scala&quot;)" class="string">&quot;scala&quot;</span>)
    <span class="keyword">def</span> <a title="()List[String]" id="756297">membersOfJavaLang</a>() = <a href="#756295" title="(s: String)List[String]">membersOfPath</a>(<span title="java.lang.String(&quot;java.lang&quot;)" class="string">&quot;java.lang&quot;</span>)
    <span class="keyword">def</span> <a title="()List[String]" id="756298">membersOfPredef</a>() = <a href="#756293" title="(s: String)List[String]">membersOfId</a>(<span title="java.lang.String(&quot;scala.Predef&quot;)" class="string">&quot;scala.Predef&quot;</span>)
    <span class="keyword">def</span> <a title="=&gt; List[String]" id="756299">defaultMembers</a> = {
      <span class="keyword">val</span> <a title="List[String]" id="756663">xs</a> = <a href="#756296" title="()List[String]">membersOfScala</a> <a href="#756665" title="List[String]">:::</a> <a href="#756297" title="()List[String]">membersOfJavaLang</a> <a href="#756684" title="(prefix: List[String])List[String]">:::</a> <a href="#756298" title="(prefix: List[String])List[String]">membersOfPredef</a>
      <span class="keyword">val</span> <a title="List[scala.util.matching.Regex]" id="756664">excludes</a> = <span title="(xs: scala.util.matching.Regex*)List[scala.util.matching.Regex]">List</span>(<span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;Tuple\d+&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>, <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;Product\d+&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>, <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;Function\d+&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>,
        <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;.*Exception$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>, <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;.*Error$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>)
      <a href="#756663" title="(p: (String) =&gt; Boolean)List[String]">xs</a> filter (<a title="String" id="756792">x</a> =&gt; <a href="#756664" title="(p: (scala.util.matching.Regex) =&gt; Boolean)Boolean" id="28935">excludes</a> forall (<a title="scala.util.matching.Regex" id="756797">r</a> =&gt; <a href="#756797" title="scala.util.matching.Regex">r</a>.<a title="(source: java.lang.CharSequence)Option[scala.util.matching.Regex.Match]" id="127218">findFirstMatchIn</a>(<a href="#756792" title="String">x</a>).<a title="=&gt; Boolean" id="35041">isEmpty</a>))
    }
    
    <span class="keyword">def</span> <a title="(s: String)List[String]" id="756300">pkgsStartingWith</a>(<a title="String" id="756822">s</a>: <span title="String">String</span>) = <a href="#755986" title="()List[String]" id="756204">topLevelPackages</a><span title="(p: (String) =&gt; Boolean)List[String]">(</span>) filter (<a href="#756829" title="(x$1: java.lang.String)Boolean">_</a> startsWith <a href="#756822" title="String">s</a>)
    <span class="keyword">def</span> <a title="(s: String)List[String]" id="756301">idsStartingWith</a>(<a title="String" id="756654">s</a>: <span title="String">String</span>) = <span title="(p: (String) =&gt; Boolean)List[String]">(</span><a href="#591701" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="../Interpreter.scala.html#117276" title="()List[String]">unqualifiedIds</a> <a href="#756657" title="List[String]">:::</a> <a href="#756299" title="(prefix: List[String])List[String]">defaultMembers</a>) filter (<a href="#756813" title="(x$1: java.lang.String)Boolean">_</a> startsWith <a href="#756654" title="String">s</a>)

    <span class="keyword">def</span> <a title="(clist: java.util.List[String])Int" id="756302">complete</a>(<a title="java.util.List[String]" id="757102">clist</a>: <span title="java.util.List[String]">JList</span>[String]): <span title="Int">Int</span> = {
      <span class="keyword">val</span> <a title="Buffer.this.Result" id="757104">res</a> = <a href="#756291" title="(clist: java.util.List[String])Buffer.this.Result">analyzeBuffer</a>(<a href="#757102" title="java.util.List[String]">clist</a>)
      <a href="#757104" title="Buffer.this.Result">res</a>.<a href="#756414" title="(f: (java.lang.String) =&gt; Boolean)Unit">getCandidates</a> foreach (<a href="#757102" title="(x$1: String)Boolean" id="245743">clist</a> add <a href="#757126" title="java.lang.String">_</a>)
      <a href="#757104" title="Buffer.this.Result">res</a>.<a href="#756848" title="=&gt; Int">position</a>
    }
  }
  
  // jline's completion comes through here - we ask a Buffer for the candidates.
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(_buffer: String,cursor: Int,candidates: java.util.List[String])Int" id="591699">complete</a>(<a title="String" id="757145">_buffer</a>: <span title="String">String</span>, <a title="Int" id="757146">cursor</a>: <span title="Int">Int</span>, <a title="java.util.List[String]" id="757147">candidates</a>: <span title="java.util.List[String]">JList</span>[String]): <span title="Int">Int</span> =
    <span title="Completion.this.Buffer" class="keyword">new</span> <a href="#591698" title="Completion.this.Buffer">Buffer</a>(<a href="#757145" title="String">_buffer</a>).<a href="#756302" title="(clist: java.util.List[String])Int">complete</a>(<a href="#757147" title="java.util.List[String]">candidates</a>)
  
  <span class="keyword">def</span> <a title="(path: String)List[String]" id="591700">completeStaticMembers</a>(<a title="String" id="756954">path</a>: <span title="String">String</span>): <span title="List[String]">List</span>[String] = {
    <span class="keyword">import</span> java.lang.reflect.Modifier.{ isPrivate, isProtected, isStatic }
    <span class="keyword">def</span> <a title="(x: Int)Boolean" id="757154">isVisible</a>(<a title="Int" id="757160">x</a>: <span title="Int">Int</span>) = <span title="(x$1: Boolean)Boolean">!</span><a title="(x$1: Int)Boolean" id="125711">isPrivate</a>(<a href="#757160" title="Int">x</a>) &amp;&amp; <span title="=&gt; Boolean">!</span><a title="(x$1: Int)Boolean" id="125713">isProtected</a>(<a href="#757160" title="Int">x</a>)
    <span class="keyword">def</span> <a title="(x: Int,isJava: Boolean)Boolean" id="757155">isSingleton</a>(<a title="Int" id="757167">x</a>: <span title="Int">Int</span>, <a title="Boolean" id="757168">isJava</a>: <span title="Boolean">Boolean</span>) = <span title="(x$1: Boolean)Boolean">!</span><a href="#757168" title="Boolean">isJava</a> || <a title="(x$1: Int)Boolean" id="125715">isStatic</a>(<a href="#757167" title="Int">x</a>)
    
    <span class="keyword">def</span> <a title="(c: Class[_],isJava: Boolean)List[String]" id="757156">getMembers</a>(<a title="Class[_]" id="757173">c</a>: <a title="Class[_]" id="1416">Class</a>[_], <a title="Boolean" id="757174">isJava</a>: <span title="Boolean">Boolean</span>): <span title="List[String]">List</span>[String] =
      <a href="#757173" title="Class[_]">c</a>.<a title="()Array[java.lang.reflect.Method]" id="4839">getMethods</a>.<span title="=&gt; List[java.lang.reflect.Method]">toList</span> .
        <span title="(p: (java.lang.reflect.Method) =&gt; Boolean)List[java.lang.reflect.Method]">filter</span> (<a title="java.lang.reflect.Method" id="757182">x</a> =&gt; <a href="#757154" title="(x: Int)Boolean">isVisible</a>(<a href="#757182" title="java.lang.reflect.Method">x</a>.<span title="()Int">getModifiers</span>)) .
        <span title="(p: (java.lang.reflect.Method) =&gt; Boolean)List[java.lang.reflect.Method]">filter</span> (<a title="java.lang.reflect.Method" id="757191">x</a> =&gt; <a href="#757155" title="(x: Int,isJava: Boolean)Boolean">isSingleton</a>(<a href="#757191" title="java.lang.reflect.Method">x</a>.<span title="()Int">getModifiers</span>, <a href="#757174" title="Boolean">isJava</a>)) .
        <span title="(f: (java.lang.reflect.Method) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[java.lang.reflect.Method]])List[java.lang.String]">map</span> <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><a href="#757206" title="java.lang.reflect.Method">_</a>.<a title="()java.lang.String" id="118894">getName</a>) .
        <span title="(p: (java.lang.String) =&gt; Boolean)List[java.lang.String]">filter</span> (<a href="#125771" title="(x: String)Boolean">isValidCompletion</a>)
    
    <span class="keyword">def</span> <a title="(path: String)Option[Class[_]]" id="757157">getClassObject</a>(<a title="String" id="757296">path</a>: <span title="String">String</span>): <a title="Option[Class[_]]" id="782">Option</a>[Class[_]] =
      <span title="(alternative: =&gt; Option[java.lang.Class[_]])Option[java.lang.Class[_]]">(</span><a href="../Interpreter.scala.html#117277" title="(path: String)Option[java.lang.Class[_]]">interpreter</a> getClassObject <a href="#757296" title="String">path</a>) <span title="(alternative: =&gt; Option[java.lang.Class[_]])Option[java.lang.Class[_]]">orElse</span>
      (<a href="../Interpreter.scala.html#117277" title="(path: String)Option[java.lang.Class[_]]">interpreter</a> getClassObject (<span title="(x$1: Any)java.lang.String" class="string">&quot;scala.&quot;</span> + <a href="#757296" title="String">path</a>)) orElse
      (<a href="../Interpreter.scala.html#117277" title="(path: String)Option[java.lang.Class[_]]">interpreter</a> getClassObject (<span title="(x$1: Any)java.lang.String" class="string">&quot;java.lang.&quot;</span> + <a href="#757296" title="String">path</a>))
        
    // java style, static methods    
    <span class="keyword">val</span> <a title="List[String]" id="757158">js</a> = <a href="#757157" title="(path: String)Option[Class[_]]">getClassObject</a><span title="(f: (Class[_]) =&gt; List[String])Option[List[String]]">(</span><a href="#756954" title="String">path</a>) <span title="(default: =&gt; List[String])List[String]">map</span> (<a href="#757156" title="(c: Class[_],isJava: Boolean)List[String]">getMembers</a>(<a href="#757338" title="Class[_]">_</a>, <span title="Boolean(true)" class="keyword">true</span>)) getOrElse <span title="object Nil">Nil</span>
    // scala style, methods on companion object
    <span class="keyword">val</span> <a title="List[String]" id="757159">ss</a> = <a href="#757157" title="(path: String)Option[Class[_]]">getClassObject</a><span title="(f: (Class[_]) =&gt; List[String])Option[List[String]]">(</span><a href="#756954" title="(x$1: Any)java.lang.String">path</a> + <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span>) <span title="(default: =&gt; List[String])List[String]">map</span> (<a href="#757156" title="(c: Class[_],isJava: Boolean)List[String]">getMembers</a>(<a href="#757360" title="Class[_]">_</a>, <span title="Boolean(false)" class="keyword">false</span>)) getOrElse <span title="object Nil">Nil</span>
    
    <a href="#757158" title="List[String]">js</a> <a href="#757374" title="List[String]">:::</a> <a href="#757159" title="(prefix: List[String])List[String]">ss</a>
  }
}

<span class="keyword">object</span> <a title="object scala.tools.nsc.interpreter.Completion" id="22211">Completion</a>
<span title="ScalaObject">{</span>
  <span class="keyword">import</span> java.io.File
  <span class="keyword">import</span> java.util.jar.{ JarEntry, JarFile }
  
  <span class="keyword">def</span> <a title="[T](e: java.util.Enumeration[T])List[T]" id="125762">enumToList</a>[<a title="&gt;: Nothing &lt;: Any" id="125764">T</a>](<a title="java.util.Enumeration[T]" id="756219">e</a>: java.util.<span title="java.util.Enumeration[T]">Enumeration</span>[T]): <span title="List[T]">List</span>[T] = <a href="#125765" title="(e: java.util.Enumeration[T],xs: List[T])List[T]">enumToList</a>(<a href="#756219" title="java.util.Enumeration[T]">e</a>, <span title="object Nil">Nil</span>)
  <span class="keyword">def</span> <a title="[T](e: java.util.Enumeration[T],xs: List[T])List[T]" id="125765">enumToList</a>[<a title="&gt;: Nothing &lt;: Any" id="125767">T</a>](<a title="java.util.Enumeration[T]" id="756211">e</a>: java.util.<span title="java.util.Enumeration[T]">Enumeration</span>[T], <a title="List[T]" id="756212">xs</a>: <span title="List[T]">List</span>[T]): <span title="List[T]">List</span>[T] =
    <span title="List[T]" class="keyword">if</span> (<a href="#756211" title="(x$1: AnyRef)Boolean">e</a> <span title="(x$1: Boolean)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> || <span title="=&gt; Boolean">!</span><a href="#756211" title="java.util.Enumeration[T]">e</a>.<a title="()Boolean" id="112518">hasMoreElements</a>) <a href="#756212" title="List[T]">xs</a> <span class="keyword">else</span> <a href="#125765" title="(e: java.util.Enumeration[T],xs: List[T])List[T]">enumToList</a>(<a href="#756211" title="java.util.Enumeration[T]">e</a>, <a href="#756211" title="java.util.Enumeration[T]">e</a>.<a title="()T" id="112519">nextElement</a> <a href="#757437" title="T">::</a> <a href="#756212" title="(x: T)List[T]">xs</a>)
  
  // methods to leave out of completion
  <span class="keyword">val</span> <a title="List[java.lang.String]" id="125768">excludeMethods</a> = <span title="(xs: java.lang.String*)List[java.lang.String]">List</span>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;hashCode&quot;)" class="string">&quot;hashCode&quot;</span>, <span title="java.lang.String(&quot;equals&quot;)" class="string">&quot;equals&quot;</span>, <span title="java.lang.String(&quot;wait&quot;)" class="string">&quot;wait&quot;</span>, <span title="java.lang.String(&quot;notify&quot;)" class="string">&quot;notify&quot;</span>, <span title="java.lang.String(&quot;notifyAll&quot;)" class="string">&quot;notifyAll&quot;</span>)  

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(path: String)Boolean" id="125770">exists</a>(<a title="String" id="757451">path</a>: <span title="String">String</span>) = <span title="java.io.File" class="keyword">new</span> <a title="java.io.File" id="3807">File</a>(<a href="#757451" title="String">path</a>) <a title="()Boolean" id="35192">exists</a>
  
  <span class="keyword">def</span> <a title="(x: String)Boolean" id="125771">isValidCompletion</a>(<a title="String" id="125969">x</a>: <span title="String">String</span>) = <span title="(x$1: Boolean)Boolean">!</span>(<a href="#125969" title="(x$1: java.lang.CharSequence)Boolean" id="7029">x</a> contains <span title="java.lang.String(&quot;$$&quot;)" class="string">&quot;$$&quot;</span>) &amp;&amp; <span title="=&gt; Boolean">!</span>(<a href="#125768" title="(elem: Any)Boolean">excludeMethods</a> contains <a href="#125969" title="String">x</a>)
  <span class="keyword">def</span> <a title="(x: String)Boolean" id="125772">isClass</a>(<a title="String" id="757462">x</a>: <span title="String">String</span>)    = <a href="#757462" title="(x$1: java.lang.String)Boolean">x</a> endsWith <span title="java.lang.String(&quot;.class&quot;)" class="string">&quot;.class&quot;</span>
  <span class="keyword">def</span> <a title="(x: String)java.lang.String" id="125773">dropClass</a>(<a title="String" id="757467">x</a>: <span title="String">String</span>)  = <a href="#757467" title="String">x</a>.<a title="(x$1: Int,x$2: Int)java.lang.String" id="7016">substring</a>(<span title="Int(0)" class="int">0</span>, <a href="#757467" title="String">x</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(6)" class="int">6</span>)  // drop .class
  
  <span class="keyword">def</span> <a title="(path: String)List[String]" id="125774">getClassFiles</a>(<a title="String" id="757498">path</a>: <span title="String">String</span>): <span title="List[String]">List</span>[String] = {
    <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#125770" title="(path: String)Boolean">exists</a>(<a href="#757498" title="String">path</a>)) <span title="Nothing" class="keyword">return</span> <span title="object Nil">Nil</span>

    <a href="#125762" title="(e: java.util.Enumeration[java.util.jar.JarEntry])List[java.util.jar.JarEntry]">enumToList</a>(<span title="java.util.jar.JarFile" class="keyword">new</span> <a title="java.util.jar.JarFile" id="118783">JarFile</a>(<a href="#757498" title="String">path</a>).<a title="()java.util.Enumeration[java.util.jar.JarEntry]" id="557925">entries</a>) .
      <span title="(f: (java.util.jar.JarEntry) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[java.util.jar.JarEntry]])List[java.lang.String]">map</span> <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><a href="#757532" title="java.util.jar.JarEntry">_</a>.<a title="()java.lang.String" id="112619">getName</a>) .
      <span title="(p: (java.lang.String) =&gt; Boolean)List[java.lang.String]">filter</span> (<a href="#125772" title="(x: String)Boolean">isClass</a>) .
      <span title="(f: (java.lang.String) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[java.lang.String]])List[java.lang.String]">map</span> <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><a href="#125773" title="(x: String)java.lang.String">dropClass</a>) .
      <span title="(p: (java.lang.String) =&gt; Boolean)List[java.lang.String]">filter</span> (<a href="#125771" title="(x: String)Boolean">isValidCompletion</a>)
  }
  
  // all the dotted path to classfiles we can find by poking through the jars
  <span class="keyword">def</span> <a title="(map: java.util.concurrent.ConcurrentHashMap[String,List[String]],interpreter: scala.tools.nsc.Interpreter)Unit" id="125775">getDottedPaths</a>(
    <a title="java.util.concurrent.ConcurrentHashMap[String,List[String]]" id="756260">map</a>: <span title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">ConcurrentHashMap</span>[String, List[String]],
    <a title="scala.tools.nsc.Interpreter" id="756261">interpreter</a>: <a href="../Interpreter.scala.html#8370" title="scala.tools.nsc.Interpreter">Interpreter</a>): <span title="Unit">Unit</span> =
  {
    <span class="keyword">val</span> <a title="List[String]" id="757718">cp</a> =
      <a href="#756261" title="scala.tools.nsc.Interpreter">interpreter</a>.<a href="../Interpreter.scala.html#117209" title="=&gt; List[java.net.URL]">compilerClasspath</a>.<span title="(f: (java.net.URL) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[java.net.URL]])List[java.lang.String]">map</span><span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><a href="#757731" title="java.net.URL">_</a>.<a title="()java.lang.String" id="117388">getPath</a>) <a href="#757722" title="List[java.lang.String]">:::</a>            // compiler jars, scala-library.jar etc.
      <a href="#756261" title="scala.tools.nsc.Interpreter">interpreter</a>.<a href="../Interpreter.scala.html#117185" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../Settings.scala.html#37034" title="=&gt; scala.tools.nsc.Settings.StringSetting">bootclasspath</a>.<a href="../Settings.scala.html#37759" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">value</a>.<span title="(separator: Char)Array[String]">split</span>(<span title="Char(':')" class="char">':'</span>).<span title="(prefix: List[String])List[String]">toList</span>  // boot classpath, java.lang.* etc.
    
    <span class="keyword">val</span> <a title="List[String]" id="757719">jars</a> = <a href="#757718" title="List[String]">cp</a>.<span title="(p: (String) =&gt; Boolean)List[String]">removeDuplicates</span> filter (<a href="#757858" title="(x$1: java.lang.String)Boolean">_</a> endsWith <span title="java.lang.String(&quot;.jar&quot;)" class="string">&quot;.jar&quot;</span>)
    
    // for e.g. foo.bar.baz.C, returns (foo -&gt; bar), (foo.bar -&gt; baz), (foo.bar.baz -&gt; C)
    // and scala.Range$BigInt needs to go scala -&gt; Range -&gt; BigInt
    <span class="keyword">def</span> <a title="(s: String)List[(String, String)]" id="757720">subpaths</a>(<a title="String" id="757863">s</a>: <span title="String">String</span>): <span title="List[(String, String)]">List</span>[(String, String)] = {
      <span class="keyword">val</span> <a title="Array[String]" id="757864">segs</a> = <a href="#757863" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">s</a>.<span title="(separator: Char)Array[String]">split</span>(<span title="Char('.')" class="char">'.'</span>)
      <span class="keyword">for</span> (<a title="Int" id="757931">i</a> &lt;- <span title="object List">List</span>.<a title="(start: Int,end: Int)List[Int]" id="24484">range</a><span title="(f: (Int) =&gt; (String, String))(implicit bf: scala.collection.generic.BuilderFactory[(String, String),List[(String, String)],List[Int]])List[(String, String)]">(</span><span title="Int(0)" class="int">0</span>, <a href="#757864" title="Array[String]">segs</a>.<a title="(x$1: Int)Int" id="24569">length</a> - <span title="Int(1)" class="int">1</span>)) <span class="keyword">yield</span> {
        <span class="keyword">val</span> <a title="String" id="757932">k</a> = <a href="#757864" title="Array[String]">segs</a>.<a title="(n: Int)Array[String]" id="25784">take</a>(<a href="#757931" title="(x$1: Int)Int">i</a>+<span title="Int(1)" class="int">1</span>).<span title="(sep: String)String">mkString</span>(<span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>)
        <span class="keyword">val</span> <a title="String" id="757933">v</a> = <a href="#757864" title="(i: Int)String" id="24570">segs</a>(<a href="#757931" title="(x$1: Int)Int">i</a>+<span title="Int(1)" class="int">1</span>)
        (<a href="#757932" title="(y: String)(String, String)" id="7952">k</a> -&gt; <a href="#757933" title="String">v</a>)
      }
    }
    
    <span class="keyword">def</span> <a title="(jar: String)Unit" id="757721">oneJar</a>(<a title="String" id="758042">jar</a>: <span title="String">String</span>): <span title="Unit">Unit</span> = {
      <span class="keyword">def</span> <a title="(s: String)String" id="758043">cleanup</a>(<a title="String" id="758045">s</a>: <span title="String">String</span>): <span title="String">String</span> = <a href="#758045" title="(f: (Char) =&gt; Char)(implicit bf: scala.collection.generic.BuilderFactory[Char,scala.runtime.RichString,scala.runtime.RichString])scala.runtime.RichString">s</a> <a title="=&gt; scala.collection.generic.BuilderFactory[Char,scala.runtime.RichString,scala.runtime.RichString]" id="2058">map</a> { <a title="Char" id="758071">c</a> =&gt; <span title="Char" class="keyword">if</span> (<a href="#758071" title="(x$1: Char)Boolean">c</a> <span title="(x$1: Boolean)Boolean">==</span> <span title="Char('/')" class="char">'/'</span> || <a href="#758071" title="(x$1: Char)Boolean">c</a> == <span title="Char('$')" class="char">'$'</span>) <span title="Char('.')" class="char">'.'</span> <span class="keyword">else</span> <a href="#758071" title="Char">c</a> } <a title="()String" id="30450">toString</a>
      <span class="keyword">val</span> <a title="List[String]" id="758044">classfiles</a> = <a href="#125774" title="(path: String)List[String]">Completion</a> <span title="(f: (String) =&gt; String)(implicit bf: scala.collection.generic.BuilderFactory[String,List[String],List[String]])List[String]">getClassFiles</span> <a href="#758042" title="String">jar</a> <span title="scala.collection.generic.BuilderFactory[String,List[String],List#Coll]">map</span> <a href="#758043" title="(s: String)String">cleanup</a>
        
      <span class="keyword">for</span> (<a title="String" id="758262">cl</a> &lt;- <a href="#758044" title="(f: (String) =&gt; Unit)Unit">classfiles</a>; (<a title="String" id="758300">k</a>, <a title="String" id="758301">v</a>) &lt;- <a href="#757720" title="(s: String)List[(String, String)]">subpaths</a><a href="#758267" title="(f: ((String, String)) =&gt; List[String])Unit">(</a><a href="#758262" title="String">cl</a>)) {
        <span title="List[String]" class="keyword">if</span> (<a href="#756260" title="(x$1: Any)Boolean">map</a> containsKey <a href="#758300" title="String">k</a>) <a href="#756260" title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">map</a>.<span title="(x$1: String,x$2: List[String])List[String]">put</span>(<a href="#758300" title="String">k</a>, <a href="#758301" title="String">v</a> <a href="#758320" title="String">::</a> <a href="#756260" title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">map</a>.<span title="(x$1: Any)List[String]">get</span><span title="(x: String)List[String]">(</span><a href="#758300" title="String">k</a>))
        <span class="keyword">else</span> <a href="#756260" title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">map</a>.<span title="(x$1: String,x$2: List[String])List[String]">put</span>(<a href="#758300" title="String">k</a>, <span title="(xs: String*)List[String]">List</span>(<a href="#758301" title="String">v</a>))
      }
    }
    
    <a href="#757719" title="(f: (String) =&gt; Unit)Unit">jars</a> foreach <a href="#757721" title="(jar: String)Unit">oneJar</a>
  }
}

        </pre>
    </body>
</html>