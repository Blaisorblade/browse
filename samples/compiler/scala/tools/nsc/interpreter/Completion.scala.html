<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/interpreter/Completion.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author Paul Phillips
 */
// $Id$

//
// TODO, if practical:
//
// 1) Types: val s: String = x.&lt;tab&gt; should only show members which result in a String.
//      Possible approach: evaluate buffer as if current identifier is 
// 2) Implicits: x.&lt;tab&gt; should show not only x's members but those of anything for which
//      there is an implicit conversion from x.
// 3) Chaining: x.foo(bar).&lt;tab&gt; should complete on foo's result type.
// 4) Imports: after import scala.collection.mutable._, HashMap should be among
//      my top level identifiers.
// 5) Caching: it's silly to parse all the jars on every startup, we should have
//      a peristent store somewhere we can write and only check last-mod dates.
// 6) Security: Are we using the filesystem unnecessarily?
//

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interpreter

<span class="keyword">import</span> jline._
<span class="keyword">import</span> java.net.URL
<span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap
<span class="keyword">import</span> scala.concurrent.DelayedLazyVal

// REPL completor - queries supplied interpreter for valid completions
// based on current contents of buffer.
<span class="keyword">class</span> <a title="class Completion extends java.lang.Object with jline.Completor with ScalaObject" id="22352">Completion</a><span title="ScalaObject">(</span><span class="keyword">val</span> <a title="scala.tools.nsc.Interpreter" id="593302">interpreter</a>: <a href="../Interpreter.scala.html#8439" title="scala.tools.nsc.Interpreter">Interpreter</a>) <span class="keyword">extends</span> <a title="jline.Completor" id="126534">Completor</a> {
  <span class="keyword">import</span> Completion._
  <span class="keyword">import</span> java.util.{ List =&gt; JList }
  <span class="keyword">import</span> interpreter.compilerClasspath
  
  // it takes a little while to look through the jars so we use a future and a concurrent map
  <span class="keyword">class</span> <a title="class CompletionAgent extends java.lang.Object with ScalaObject" id="593295">CompletionAgent</a> <span title="ScalaObject">{</span>
    <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[String,List[String]]" id="757823">dottedPaths</a> = <a title="()java.util.concurrent.ConcurrentHashMap[String,List[String]]" id="757891" class="keyword">new</a> <span title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">ConcurrentHashMap</span>[String, List[String]]
    <span class="keyword">val</span> <a title="scala.concurrent.DelayedLazyVal[List[String]]" id="757825">topLevelPackages</a> = <span title="scala.concurrent.DelayedLazyVal[List[String]]" class="keyword">new</span> <a title="scala.concurrent.DelayedLazyVal[List[String]]" id="127195">DelayedLazyVal</a>(
      () =&gt; <a href="#126294" title="(e: java.util.Enumeration[String])List[String]">enumToList</a><a title="(p: (String) =&gt; Boolean)List[String]" id="25430">(</a><a href="#757823" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,List[String]]">dottedPaths</a>.<a title="()java.util.Enumeration[String]" id="757952">keys</a>) filterNot (<a href="#758072" title="(elem: Any)Boolean">_</a> contains <span title="Char('.')" class="char">'.'</span>),
      <a href="#126307" title="(map: java.util.concurrent.ConcurrentHashMap[String,List[String]],interpreter: scala.tools.nsc.Interpreter)Unit">getDottedPaths</a>(<a href="#757823" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,List[String]]">dottedPaths</a>, <a href="#593302" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>)
    )
  }
  <span class="keyword">val</span> <a title="Completion.this.CompletionAgent" id="593296">agent</a> = <span title="Completion.this.CompletionAgent" class="keyword">new</span> <a href="#593295" title="Completion.this.CompletionAgent">CompletionAgent</a>
  <span class="keyword">import</span> agent._  

  // One instance of a command line
  <span class="keyword">class</span> <a title="class Buffer extends java.lang.Object with ScalaObject" id="593299">Buffer</a><span title="ScalaObject">(</span><a title="String" id="758231">s</a>: <span title="String">String</span>) {
    <span class="keyword">val</span> <a title="java.lang.String" id="758113">buffer</a> = <span title="java.lang.String" class="keyword">if</span> (<a href="#758231" title="(x$1: AnyRef)Boolean">s</a> == <span title="Null(null)" class="keyword">null</span>) <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <a href="#758231" title="String">s</a>
    <span class="keyword">val</span> <a title="List[java.lang.String]" id="758115">segments</a> = <a href="#758113" title="=&gt; java.lang.String">buffer</a>.<a title="(x$1: java.lang.String,x$2: Int)Array[java.lang.String]" id="7109">split</a>(<span title="java.lang.String(&quot;\.&quot;)" class="string">&quot;\\.&quot;</span>, <span title="Int(-1)">-</span><span class="int">1</span>).<span title="=&gt; List[java.lang.String]">toList</span>
    <span class="keyword">val</span> <a title="Int" id="758117">lastDot</a> = <a href="#758113" title="=&gt; java.lang.String">buffer</a>.<a title="(x$1: Int)Int" id="7052">lastIndexOf</a>(<span title="Int(46)" class="char">'.'</span>)
    <span class="keyword">val</span> <a title="Boolean" id="758119">hasDot</a> = <a href="#758115" title="=&gt; List[java.lang.String]">segments</a>.<span title="(x$1: Int)Boolean">size</span> <span title="(x$1: Boolean)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> &amp;&amp; <a href="#758115" title="=&gt; List[java.lang.String]">segments</a>.<span title="(x$1: AnyRef)Boolean">last</span> == <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
    
    // given foo.bar.baz, path = foo.bar and stub = baz
    <span class="keyword">val</span> <a href="#758122" title="(java.lang.String, java.lang.String)">(</a><a href="#758121" title="java.lang.String" id="758122">path</a>, <a href="#758121" title="java.lang.String" id="758124">stub</a>) = <a href="#758115" title="=&gt; List[java.lang.String]">segments</a>.<span title="=&gt; Int">size</span> <span title="(java.lang.String, java.lang.String)" class="keyword">match</span> {
      <span title="(java.lang.String, java.lang.String)" class="keyword">case</span> <span title="Int(0)" class="int">0</span>    =&gt; <span title="(_1: java.lang.String,_2: java.lang.String)(java.lang.String, java.lang.String)">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <span title="(java.lang.String, java.lang.String)" class="keyword">case</span> <span title="Int(1)" class="int">1</span>    =&gt; <span title="(_1: java.lang.String,_2: java.lang.String)(java.lang.String, java.lang.String)">(</span><a href="#758115" title="=&gt; List[java.lang.String]">segments</a>.<span title="=&gt; java.lang.String">head</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <span title="(String, java.lang.String)" class="keyword">case</span> _    =&gt; <span title="(_1: String,_2: java.lang.String)(String, java.lang.String)">(</span><a href="#758115" title="=&gt; List[java.lang.String]">segments</a>.<a title="=&gt; List[java.lang.String]" id="25480">init</a>.<span title="(sep: String)String">mkString</span>(<span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>), <a href="#758115" title="=&gt; List[java.lang.String]">segments</a>.<span title="=&gt; java.lang.String">last</span>)
    }

    <span class="keyword">def</span> <a title="(xs: List[String])List[String]" id="758126">filt</a>(<a title="List[String]" id="758234">xs</a>: <span title="List[String]">List</span>[String]) = <a href="#758234" title="(p: (String) =&gt; Boolean)List[String]">xs</a> filter (<a href="#758239" title="(x$1: java.lang.String)Boolean">_</a> startsWith <a href="#758124" title="=&gt; java.lang.String">stub</a>)

    case <span class="keyword">class</span> <a title="class Result extends java.lang.Object with ScalaObject with Product" id="758431">Result</a><span title="ScalaObject">(</span><a title="List[String]" id="758689">candidates</a>: <span title="List[String]">List</span>[String], <a title="Int" id="758690">position</a>: <span title="Int">Int</span>) {
      <span class="keyword">def</span> <a title="()List[java.lang.String]" id="758253">getCandidates</a>() = <a title="(lt: (java.lang.String, java.lang.String) =&gt; Boolean)List[java.lang.String]" id="24469">(</a><a href="#758689" title="(f: (String) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[String]])List[java.lang.String]">candidates</a> <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">map</span> (<a href="#758272" title="String">_</a>.<a title="()java.lang.String" id="7120">trim</a>) <span title="=&gt; List[java.lang.String]">removeDuplicates</span>) sort (<a href="#758358" title="(that: String)Boolean" id="31009">_</a> &lt; <a href="#758359" title="java.lang.String">_</a>)
    }
    
    // work out completion candidates and position
    <span class="keyword">def</span> <a title="(clist: java.util.List[String])Buffer.this.Result" id="758130">analyzeBuffer</a>(<a title="java.util.List[String]" id="758485">clist</a>: <span title="java.util.List[String]">JList</span>[String]): <a href="#758431" title="Buffer.this.Result">Result</a> = {
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="758488">ids</a> = <a href="#758140" title="(s: String)List[String]">idsStartingWith</a>(<a href="#758122" title="=&gt; java.lang.String">path</a>)
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="758490">pkgs</a> = <a href="#758139" title="(s: String)List[String]">pkgsStartingWith</a>(<a href="#758122" title="=&gt; java.lang.String">path</a>)
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Int" id="758492">count</a> = (<a href="#758487" title="=&gt; List[String]">ids</a> <a href="#758680" title="List[String]">:::</a> <a href="#758489" title="(prefix: List[String])List[String]">pkgs</a>).<span title="=&gt; Int">size</span>        
      
      <span class="keyword">def</span> <a title="()Buffer.this.Result" id="758493">doSimple</a>(): <a href="#758431" title="Buffer.this.Result">Result</a> = <a href="#758491" title="=&gt; Int">count</a> <span title="Buffer.this.Result" class="keyword">match</span> {
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(0)" class="int">0</span>                                    =&gt; <a href="#758431" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<span title="object Nil">Nil</span>, <span title="Int(0)" class="int">0</span>)
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(1)" class="int">1</span> <span class="keyword">if</span> <a href="#758489" title="=&gt; List[String]">pkgs</a>.<span title="(x$1: Int)Boolean">size</span> &gt; <span title="Int(0)" class="int">0</span>                   =&gt; <a href="#758431" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#758489" title="=&gt; List[String]">pkgs</a>, <span title="Int(0)" class="int">0</span>)
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(1)" class="int">1</span> <span class="keyword">if</span> <a href="#758113" title="=&gt; java.lang.String">buffer</a>.<a title="(x$1: Int)Boolean" id="2977">length</a> &lt; <a href="#758487" title="=&gt; List[String]">ids</a>.<span title="=&gt; String">head</span>.<span title="()Int">length</span> =&gt; <a href="#758431" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#758487" title="=&gt; List[String]">ids</a>, <span title="Int(0)" class="int">0</span>)
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(1)" class="int">1</span>                                    =&gt; <a href="#758431" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#758487" title="=&gt; List[String]">ids</a>, <span title="Int(0)" class="int">0</span>)
          // XXX for now commented out &quot;dot inference&quot; because it's overcomplicated
          // val members = membersOfId(ids.head) filter (_ startsWith stub)
          // if (members.isEmpty) Result(Nil, 0)
          // else Result(members, path.length + 1)
        <span title="Buffer.this.Result" class="keyword">case</span> _                                    =&gt; <a href="#758431" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#758487" title="=&gt; List[String]">ids</a> <a href="#758759" title="List[String]">:::</a> <a href="#758489" title="(prefix: List[String])List[String]">pkgs</a>, <span title="Int(0)" class="int">0</span>)
      }
      
      // a few keywords which don't appear as methods via reflection
      <span class="keyword">val</span> <a title="List[java.lang.String]" id="758494">memberKeywords</a> = <span title="(xs: java.lang.String*)List[java.lang.String]">List</span>(<span title="java.lang.String(&quot;isInstanceOf&quot;)" class="string">&quot;isInstanceOf&quot;</span>, <span title="java.lang.String(&quot;asInstanceOf&quot;)" class="string">&quot;asInstanceOf&quot;</span>)      
      <span class="keyword">def</span> <a title="()Buffer.this.Result" id="758495">doDotted</a>(): <a href="#758431" title="Buffer.this.Result">Result</a> = {
        <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="758779">pkgs</a> = <a href="#758126" title="(xs: List[String])List[String]">filt</a>(<a href="#758134" title="(s: String)List[String]">membersOfPath</a>(<a href="#758122" title="=&gt; java.lang.String">path</a>))
        <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="758781">ids</a> = <a href="#758126" title="(xs: List[String])List[String]">filt</a>(<a href="#758132" title="(s: String)List[String]">membersOfId</a>(<a href="#758122" title="=&gt; java.lang.String">path</a>))
        <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="758783">idExtras</a> = <a href="#758126" title="(xs: List[String])List[String]">filt</a>(<a href="#758494" title="List[java.lang.String]">memberKeywords</a>)  // isInstanceOf and asInstanceOf
        <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[String]" id="758785">statics</a> = <a href="#758126" title="(xs: List[String])List[String]">filt</a>(<a href="#593301" title="(path: String)List[String]">completeStaticMembers</a>(<a href="#758122" title="=&gt; java.lang.String">path</a>))
        
        <span title="Buffer.this.Result" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#758778" title="=&gt; List[String]">pkgs</a>.<span title="=&gt; Boolean">isEmpty</span>) <a href="#758431" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#758778" title="=&gt; List[String]">pkgs</a>, <a href="#758122" title="=&gt; java.lang.String">path</a>.<span title="(x$1: Int)Int">length</span> + <span title="Int(1)" class="int">1</span>)
        <span class="keyword">else</span> <span title="Buffer.this.Result" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#758780" title="=&gt; List[String]">ids</a>.<span title="=&gt; Boolean">isEmpty</span>) <a href="#758431" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#758780" title="=&gt; List[String]">ids</a> <a href="#758847" title="List[String]">:::</a> <a href="#758782" title="(prefix: List[String])List[String]">idExtras</a>, <a href="#758122" title="=&gt; java.lang.String">path</a>.<span title="(x$1: Int)Int">length</span> + <span title="Int(1)" class="int">1</span>)
        <span class="keyword">else</span> <a href="#758431" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<a href="#758784" title="=&gt; List[String]">statics</a> <a href="#758889" title="List[String]">:::</a> <a href="#758782" title="(prefix: List[String])List[String]">idExtras</a>, <a href="#758122" title="=&gt; java.lang.String">path</a>.<span title="(x$1: Int)Int">length</span> + <span title="Int(1)" class="int">1</span>)
      }
      
      <a href="#758115" title="=&gt; List[java.lang.String]">segments</a>.<span title="=&gt; Int">size</span> <span title="Buffer.this.Result" class="keyword">match</span> {
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(0)" class="int">0</span>            =&gt; <a href="#758431" title="(candidates: List[String],position: Int)Buffer.this.Result">Result</a>(<span title="object Nil">Nil</span>, <span title="Int(0)" class="int">0</span>)
        <span title="Buffer.this.Result" class="keyword">case</span> <span title="Int(1)" class="int">1</span>            =&gt; <a href="#758493" title="()Buffer.this.Result">doSimple</a>()
        <span title="Buffer.this.Result" class="keyword">case</span> _            =&gt; <a href="#758495" title="()Buffer.this.Result">doDotted</a>()
      }
    }
    
    <span class="keyword">def</span> <a title="(s: String)Boolean" id="758131">isValidId</a>(<a title="String" id="758937">s</a>: <span title="String">String</span>) = <a href="#593302" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="../Interpreter.scala.html#117764" title="(elem: Any)Boolean">unqualifiedIds</a> contains <a href="#758937" title="String">s</a>
    <span class="keyword">def</span> <a title="(s: String)List[String]" id="758132">membersOfId</a>(<a title="String" id="758535">s</a>: <span title="String">String</span>) = <a href="../Interpreter.scala.html#117763" title="(line: String)List[String]">interpreter</a> membersOfIdentifier <a href="#758535" title="String">s</a>
    
    <span class="keyword">def</span> <a title="(s: String)Boolean" id="758133">isValidPath</a>(<a title="String" id="758513">s</a>: <span title="String">String</span>) = <a href="#757823" title="(x$1: Any)Boolean">dottedPaths</a> containsKey <a href="#758513" title="String">s</a>
    <span class="keyword">def</span> <a title="(s: String)List[String]" id="758134">membersOfPath</a>(<a title="String" id="758510">s</a>: <span title="String">String</span>) = <span title="List[String]" class="keyword">if</span> (<a href="#758133" title="(s: String)Boolean">isValidPath</a>(<a href="#758510" title="String">s</a>)) <a href="#757823" title="(x$1: Any)List[String]">dottedPaths</a> get <a href="#758510" title="String">s</a> <span class="keyword">else</span> <span title="object Nil">Nil</span>
    
    // XXX generalize this to look through imports
    <span class="keyword">def</span> <a title="()List[String]" id="758135">membersOfScala</a>() = <a href="#758134" title="(s: String)List[String]">membersOfPath</a>(<span title="java.lang.String(&quot;scala&quot;)" class="string">&quot;scala&quot;</span>)
    <span class="keyword">def</span> <a title="()List[String]" id="758136">membersOfJavaLang</a>() = <a href="#758134" title="(s: String)List[String]">membersOfPath</a>(<span title="java.lang.String(&quot;java.lang&quot;)" class="string">&quot;java.lang&quot;</span>)
    <span class="keyword">def</span> <a title="()List[String]" id="758137">membersOfPredef</a>() = <a href="#758132" title="(s: String)List[String]">membersOfId</a>(<span title="java.lang.String(&quot;scala.Predef&quot;)" class="string">&quot;scala.Predef&quot;</span>)
    <span class="keyword">def</span> <a title="=&gt; List[String]" id="758138">defaultMembers</a> = {
      <span class="keyword">val</span> <a title="List[String]" id="758505">xs</a> = <a href="#758135" title="()List[String]">membersOfScala</a> <a href="#758507" title="List[String]">:::</a> <a href="#758136" title="()List[String]">membersOfJavaLang</a> <a href="#758526" title="(prefix: List[String])List[String]">:::</a> <a href="#758137" title="(prefix: List[String])List[String]">membersOfPredef</a>
      <span class="keyword">val</span> <a title="List[scala.util.matching.Regex]" id="758506">excludes</a> = <span title="(xs: scala.util.matching.Regex*)List[scala.util.matching.Regex]">List</span>(<span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;Tuple\d+&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>, <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;Product\d+&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>, <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;Function\d+&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>,
        <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;.*Exception$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>, <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;.*Error$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>)
      <a href="#758505" title="(p: (String) =&gt; Boolean)List[String]">xs</a> filter (<a title="String" id="758634">x</a> =&gt; <a href="#758506" title="(p: (scala.util.matching.Regex) =&gt; Boolean)Boolean" id="29121">excludes</a> forall (<a title="scala.util.matching.Regex" id="758639">r</a> =&gt; <a href="#758639" title="scala.util.matching.Regex">r</a>.<a title="(source: java.lang.CharSequence)Option[scala.util.matching.Regex.Match]" id="127762">findFirstMatchIn</a>(<a href="#758634" title="String">x</a>).<a title="=&gt; Boolean" id="35230">isEmpty</a>))
    }
    
    <span class="keyword">def</span> <a title="(s: String)List[String]" id="758139">pkgsStartingWith</a>(<a title="String" id="758664">s</a>: <span title="String">String</span>) = <a href="#757825" title="()List[String]" id="758043">topLevelPackages</a><span title="(p: (String) =&gt; Boolean)List[String]">(</span>) filter (<a href="#758671" title="(x$1: java.lang.String)Boolean">_</a> startsWith <a href="#758664" title="String">s</a>)
    <span class="keyword">def</span> <a title="(s: String)List[String]" id="758140">idsStartingWith</a>(<a title="String" id="758496">s</a>: <span title="String">String</span>) = <span title="(p: (String) =&gt; Boolean)List[String]">(</span><a href="#593302" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="../Interpreter.scala.html#117764" title="()List[String]">unqualifiedIds</a> <a href="#758499" title="List[String]">:::</a> <a href="#758138" title="(prefix: List[String])List[String]">defaultMembers</a>) filter (<a href="#758655" title="(x$1: java.lang.String)Boolean">_</a> startsWith <a href="#758496" title="String">s</a>)

    <span class="keyword">def</span> <a title="(clist: java.util.List[String])Int" id="758141">complete</a>(<a title="java.util.List[String]" id="758944">clist</a>: <span title="java.util.List[String]">JList</span>[String]): <span title="Int">Int</span> = {
      <span class="keyword">val</span> <a title="Buffer.this.Result" id="758946">res</a> = <a href="#758130" title="(clist: java.util.List[String])Buffer.this.Result">analyzeBuffer</a>(<a href="#758944" title="java.util.List[String]">clist</a>)
      <a href="#758946" title="Buffer.this.Result">res</a>.<a href="#758253" title="(f: (java.lang.String) =&gt; Boolean)Unit">getCandidates</a> foreach (<a href="#758944" title="(x$1: String)Boolean" id="246527">clist</a> add <a href="#758968" title="java.lang.String">_</a>)
      <a href="#758946" title="Buffer.this.Result">res</a>.<a href="#758690" title="=&gt; Int">position</a>
    }
  }
  
  // jline's completion comes through here - we ask a Buffer for the candidates.
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(_buffer: String,cursor: Int,candidates: java.util.List[String])Int" id="593300">complete</a>(<a title="String" id="758987">_buffer</a>: <span title="String">String</span>, <a title="Int" id="758988">cursor</a>: <span title="Int">Int</span>, <a title="java.util.List[String]" id="758989">candidates</a>: <span title="java.util.List[String]">JList</span>[String]): <span title="Int">Int</span> =
    <span title="Completion.this.Buffer" class="keyword">new</span> <a href="#593299" title="Completion.this.Buffer">Buffer</a>(<a href="#758987" title="String">_buffer</a>).<a href="#758141" title="(clist: java.util.List[String])Int">complete</a>(<a href="#758989" title="java.util.List[String]">candidates</a>)
  
  <span class="keyword">def</span> <a title="(path: String)List[String]" id="593301">completeStaticMembers</a>(<a title="String" id="758796">path</a>: <span title="String">String</span>): <span title="List[String]">List</span>[String] = {
    <span class="keyword">import</span> java.lang.reflect.Modifier.{ isPrivate, isProtected, isStatic }
    <span class="keyword">def</span> <a title="(x: Int)Boolean" id="758996">isVisible</a>(<a title="Int" id="759002">x</a>: <span title="Int">Int</span>) = <span title="(x$1: Boolean)Boolean">!</span><a title="(x$1: Int)Boolean" id="126243">isPrivate</a>(<a href="#759002" title="Int">x</a>) &amp;&amp; <span title="=&gt; Boolean">!</span><a title="(x$1: Int)Boolean" id="126245">isProtected</a>(<a href="#759002" title="Int">x</a>)
    <span class="keyword">def</span> <a title="(x: Int,isJava: Boolean)Boolean" id="758997">isSingleton</a>(<a title="Int" id="759009">x</a>: <span title="Int">Int</span>, <a title="Boolean" id="759010">isJava</a>: <span title="Boolean">Boolean</span>) = <span title="(x$1: Boolean)Boolean">!</span><a href="#759010" title="Boolean">isJava</a> || <a title="(x$1: Int)Boolean" id="126247">isStatic</a>(<a href="#759009" title="Int">x</a>)
    
    <span class="keyword">def</span> <a title="(c: Class[_],isJava: Boolean)List[String]" id="758998">getMembers</a>(<a title="Class[_]" id="759015">c</a>: <a title="Class[_]" id="1437">Class</a>[_], <a title="Boolean" id="759016">isJava</a>: <span title="Boolean">Boolean</span>): <span title="List[String]">List</span>[String] =
      <a href="#759015" title="Class[_]">c</a>.<a title="()Array[java.lang.reflect.Method]" id="4908">getMethods</a>.<span title="=&gt; List[java.lang.reflect.Method]">toList</span> .
        <span title="(p: (java.lang.reflect.Method) =&gt; Boolean)List[java.lang.reflect.Method]">filter</span> (<a title="java.lang.reflect.Method" id="759024">x</a> =&gt; <a href="#758996" title="(x: Int)Boolean">isVisible</a>(<a href="#759024" title="java.lang.reflect.Method">x</a>.<span title="()Int">getModifiers</span>)) .
        <span title="(p: (java.lang.reflect.Method) =&gt; Boolean)List[java.lang.reflect.Method]">filter</span> (<a title="java.lang.reflect.Method" id="759033">x</a> =&gt; <a href="#758997" title="(x: Int,isJava: Boolean)Boolean">isSingleton</a>(<a href="#759033" title="java.lang.reflect.Method">x</a>.<span title="()Int">getModifiers</span>, <a href="#759016" title="Boolean">isJava</a>)) .
        <span title="(f: (java.lang.reflect.Method) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[java.lang.reflect.Method]])List[java.lang.String]">map</span> <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><a href="#759048" title="java.lang.reflect.Method">_</a>.<a title="()java.lang.String" id="119387">getName</a>) .
        <span title="(p: (java.lang.String) =&gt; Boolean)List[java.lang.String]">filter</span> (<a href="#126303" title="(x: String)Boolean">isValidCompletion</a>)
    
    <span class="keyword">def</span> <a title="(path: String)Option[Class[_]]" id="758999">getClassObject</a>(<a title="String" id="759141">path</a>: <span title="String">String</span>): <a title="Option[Class[_]]" id="794">Option</a>[Class[_]] =
      <span title="(alternative: =&gt; Option[java.lang.Class[_]])Option[java.lang.Class[_]]">(</span><a href="../Interpreter.scala.html#117765" title="(path: String)Option[java.lang.Class[_]]">interpreter</a> getClassObject <a href="#759141" title="String">path</a>) <span title="(alternative: =&gt; Option[java.lang.Class[_]])Option[java.lang.Class[_]]">orElse</span>
      (<a href="../Interpreter.scala.html#117765" title="(path: String)Option[java.lang.Class[_]]">interpreter</a> getClassObject (<span title="(x$1: Any)java.lang.String" class="string">&quot;scala.&quot;</span> + <a href="#759141" title="String">path</a>)) orElse
      (<a href="../Interpreter.scala.html#117765" title="(path: String)Option[java.lang.Class[_]]">interpreter</a> getClassObject (<span title="(x$1: Any)java.lang.String" class="string">&quot;java.lang.&quot;</span> + <a href="#759141" title="String">path</a>))
        
    // java style, static methods    
    <span class="keyword">val</span> <a title="List[String]" id="759000">js</a> = <a href="#758999" title="(path: String)Option[Class[_]]">getClassObject</a><span title="(f: (Class[_]) =&gt; List[String])Option[List[String]]">(</span><a href="#758796" title="String">path</a>) <span title="(default: =&gt; List[String])List[String]">map</span> (<a href="#758998" title="(c: Class[_],isJava: Boolean)List[String]">getMembers</a>(<a href="#759183" title="Class[_]">_</a>, <span title="Boolean(true)" class="keyword">true</span>)) getOrElse <span title="object Nil">Nil</span>
    // scala style, methods on companion object
    <span class="keyword">val</span> <a title="List[String]" id="759001">ss</a> = <a href="#758999" title="(path: String)Option[Class[_]]">getClassObject</a><span title="(f: (Class[_]) =&gt; List[String])Option[List[String]]">(</span><a href="#758796" title="(x$1: Any)java.lang.String">path</a> + <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span>) <span title="(default: =&gt; List[String])List[String]">map</span> (<a href="#758998" title="(c: Class[_],isJava: Boolean)List[String]">getMembers</a>(<a href="#759205" title="Class[_]">_</a>, <span title="Boolean(false)" class="keyword">false</span>)) getOrElse <span title="object Nil">Nil</span>
    
    <a href="#759000" title="List[String]">js</a> <a href="#759219" title="List[String]">:::</a> <a href="#759001" title="(prefix: List[String])List[String]">ss</a>
  }
}

<span class="keyword">object</span> <a title="object scala.tools.nsc.interpreter.Completion" id="22353">Completion</a>
<span title="ScalaObject">{</span>
  <span class="keyword">import</span> java.io.File
  <span class="keyword">import</span> java.util.jar.{ JarEntry, JarFile }
  
  <span class="keyword">def</span> <a title="[T](e: java.util.Enumeration[T])List[T]" id="126294">enumToList</a>[<a title="&gt;: Nothing &lt;: Any" id="126296">T</a>](<a title="java.util.Enumeration[T]" id="758058">e</a>: java.util.<span title="java.util.Enumeration[T]">Enumeration</span>[T]): <span title="List[T]">List</span>[T] = <a href="#126297" title="(e: java.util.Enumeration[T],xs: List[T])List[T]">enumToList</a>(<a href="#758058" title="java.util.Enumeration[T]">e</a>, <span title="object Nil">Nil</span>)
  <span class="keyword">def</span> <a title="[T](e: java.util.Enumeration[T],xs: List[T])List[T]" id="126297">enumToList</a>[<a title="&gt;: Nothing &lt;: Any" id="126299">T</a>](<a title="java.util.Enumeration[T]" id="758050">e</a>: java.util.<span title="java.util.Enumeration[T]">Enumeration</span>[T], <a title="List[T]" id="758051">xs</a>: <span title="List[T]">List</span>[T]): <span title="List[T]">List</span>[T] =
    <span title="List[T]" class="keyword">if</span> (<a href="#758050" title="(x$1: AnyRef)Boolean">e</a> <span title="(x$1: Boolean)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> || <span title="=&gt; Boolean">!</span><a href="#758050" title="java.util.Enumeration[T]">e</a>.<a title="()Boolean" id="112988">hasMoreElements</a>) <a href="#758051" title="List[T]">xs</a> <span class="keyword">else</span> <a href="#126297" title="(e: java.util.Enumeration[T],xs: List[T])List[T]">enumToList</a>(<a href="#758050" title="java.util.Enumeration[T]">e</a>, <a href="#758050" title="java.util.Enumeration[T]">e</a>.<a title="()T" id="112989">nextElement</a> <a href="#759282" title="T">::</a> <a href="#758051" title="(x: T)List[T]">xs</a>)
  
  // methods to leave out of completion
  <span class="keyword">val</span> <a title="List[java.lang.String]" id="126300">excludeMethods</a> = <span title="(xs: java.lang.String*)List[java.lang.String]">List</span>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;hashCode&quot;)" class="string">&quot;hashCode&quot;</span>, <span title="java.lang.String(&quot;equals&quot;)" class="string">&quot;equals&quot;</span>, <span title="java.lang.String(&quot;wait&quot;)" class="string">&quot;wait&quot;</span>, <span title="java.lang.String(&quot;notify&quot;)" class="string">&quot;notify&quot;</span>, <span title="java.lang.String(&quot;notifyAll&quot;)" class="string">&quot;notifyAll&quot;</span>)  

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(path: String)Boolean" id="126302">exists</a>(<a title="String" id="759296">path</a>: <span title="String">String</span>) = <span title="java.io.File" class="keyword">new</span> <a title="java.io.File" id="3828">File</a>(<a href="#759296" title="String">path</a>) <a title="()Boolean" id="35381">exists</a>
  
  <span class="keyword">def</span> <a title="(x: String)Boolean" id="126303">isValidCompletion</a>(<a title="String" id="126504">x</a>: <span title="String">String</span>) = <span title="(x$1: Boolean)Boolean">!</span>(<a href="#126504" title="(x$1: java.lang.CharSequence)Boolean" id="7098">x</a> contains <span title="java.lang.String(&quot;$$&quot;)" class="string">&quot;$$&quot;</span>) &amp;&amp; <span title="=&gt; Boolean">!</span>(<a href="#126300" title="(elem: Any)Boolean">excludeMethods</a> contains <a href="#126504" title="String">x</a>)
  <span class="keyword">def</span> <a title="(x: String)Boolean" id="126304">isClass</a>(<a title="String" id="759307">x</a>: <span title="String">String</span>)    = <a href="#759307" title="(x$1: java.lang.String)Boolean">x</a> endsWith <span title="java.lang.String(&quot;.class&quot;)" class="string">&quot;.class&quot;</span>
  <span class="keyword">def</span> <a title="(x: String)java.lang.String" id="126305">dropClass</a>(<a title="String" id="759312">x</a>: <span title="String">String</span>)  = <a href="#759312" title="String">x</a>.<a title="(x$1: Int,x$2: Int)java.lang.String" id="7085">substring</a>(<span title="Int(0)" class="int">0</span>, <a href="#759312" title="String">x</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(6)" class="int">6</span>)  // drop .class
  
  <span class="keyword">def</span> <a title="(path: String)List[String]" id="126306">getClassFiles</a>(<a title="String" id="759343">path</a>: <span title="String">String</span>): <span title="List[String]">List</span>[String] = {
    <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#126302" title="(path: String)Boolean">exists</a>(<a href="#759343" title="String">path</a>)) <span title="Nothing" class="keyword">return</span> <span title="object Nil">Nil</span>

    <a href="#126294" title="(e: java.util.Enumeration[java.util.jar.JarEntry])List[java.util.jar.JarEntry]">enumToList</a>(<span title="java.util.jar.JarFile" class="keyword">new</span> <a title="java.util.jar.JarFile" id="119276">JarFile</a>(<a href="#759343" title="String">path</a>).<a title="()java.util.Enumeration[java.util.jar.JarEntry]" id="559307">entries</a>) .
      <span title="(f: (java.util.jar.JarEntry) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[java.util.jar.JarEntry]])List[java.lang.String]">map</span> <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><a href="#759377" title="java.util.jar.JarEntry">_</a>.<a title="()java.lang.String" id="113089">getName</a>) .
      <span title="(p: (java.lang.String) =&gt; Boolean)List[java.lang.String]">filter</span> (<a href="#126304" title="(x: String)Boolean">isClass</a>) .
      <span title="(f: (java.lang.String) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[java.lang.String]])List[java.lang.String]">map</span> <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><a href="#126305" title="(x: String)java.lang.String">dropClass</a>) .
      <span title="(p: (java.lang.String) =&gt; Boolean)List[java.lang.String]">filter</span> (<a href="#126303" title="(x: String)Boolean">isValidCompletion</a>)
  }
  
  // all the dotted path to classfiles we can find by poking through the jars
  <span class="keyword">def</span> <a title="(map: java.util.concurrent.ConcurrentHashMap[String,List[String]],interpreter: scala.tools.nsc.Interpreter)Unit" id="126307">getDottedPaths</a>(
    <a title="java.util.concurrent.ConcurrentHashMap[String,List[String]]" id="758099">map</a>: <span title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">ConcurrentHashMap</span>[String, List[String]],
    <a title="scala.tools.nsc.Interpreter" id="758100">interpreter</a>: <a href="../Interpreter.scala.html#8439" title="scala.tools.nsc.Interpreter">Interpreter</a>): <span title="Unit">Unit</span> =
  {
    <span class="keyword">val</span> <a title="List[String]" id="759569">cp</a> =
      <a href="#758100" title="scala.tools.nsc.Interpreter">interpreter</a>.<a href="../Interpreter.scala.html#117697" title="=&gt; List[java.net.URL]">compilerClasspath</a>.<span title="(f: (java.net.URL) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[java.net.URL]])List[java.lang.String]">map</span><span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><a href="#759582" title="java.net.URL">_</a>.<a title="()java.lang.String" id="117875">getPath</a>) <a href="#759573" title="List[java.lang.String]">:::</a>            // compiler jars, scala-library.jar etc.
      <a href="#758100" title="scala.tools.nsc.Interpreter">interpreter</a>.<a href="../Interpreter.scala.html#117673" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../Settings.scala.html#37229" title="=&gt; scala.tools.nsc.Settings.StringSetting">bootclasspath</a>.<a href="../Settings.scala.html#37988" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">value</a>.<span title="(separator: Char)Array[String]">split</span>(<span title="Char(':')" class="char">':'</span>).<span title="(prefix: List[String])List[String]">toList</span>  // boot classpath, java.lang.* etc.
    
    <span class="keyword">val</span> <a title="List[String]" id="759570">jars</a> = <a href="#759569" title="List[String]">cp</a>.<span title="(p: (String) =&gt; Boolean)List[String]">removeDuplicates</span> filter (<a href="#759712" title="(x$1: java.lang.String)Boolean">_</a> endsWith <span title="java.lang.String(&quot;.jar&quot;)" class="string">&quot;.jar&quot;</span>)
    
    // for e.g. foo.bar.baz.C, returns (foo -&gt; bar), (foo.bar -&gt; baz), (foo.bar.baz -&gt; C)
    // and scala.Range$BigInt needs to go scala -&gt; Range -&gt; BigInt
    <span class="keyword">def</span> <a title="(s: String)List[(String, String)]" id="759571">subpaths</a>(<a title="String" id="759717">s</a>: <span title="String">String</span>): <span title="List[(String, String)]">List</span>[(String, String)] = {
      <span class="keyword">val</span> <a title="Array[String]" id="759718">segs</a> = <a href="#759717" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">s</a>.<span title="(separator: Char)Array[String]">split</span>(<span title="Char('.')" class="char">'.'</span>)
      <span class="keyword">for</span> (<a title="Int" id="759785">i</a> &lt;- <span title="object List">List</span>.<a title="(start: Int,end: Int)List[Int]" id="24643">range</a><span title="(f: (Int) =&gt; (String, String))(implicit bf: scala.collection.generic.BuilderFactory[(String, String),List[(String, String)],List[Int]])List[(String, String)]">(</span><span title="Int(0)" class="int">0</span>, <a href="#759718" title="Array[String]">segs</a>.<a title="(x$1: Int)Int" id="24728">length</a> - <span title="Int(1)" class="int">1</span>)) <span class="keyword">yield</span> {
        <span class="keyword">val</span> <a title="String" id="759786">k</a> = <a href="#759718" title="Array[String]">segs</a>.<a title="(n: Int)Array[String]" id="25943">take</a>(<a href="#759785" title="(x$1: Int)Int">i</a>+<span title="Int(1)" class="int">1</span>).<span title="(sep: String)String">mkString</span>(<span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>)
        <span class="keyword">val</span> <a title="String" id="759787">v</a> = <a href="#759718" title="(i: Int)String" id="24729">segs</a>(<a href="#759785" title="(x$1: Int)Int">i</a>+<span title="Int(1)" class="int">1</span>)
        (<a href="#759786" title="(y: String)(String, String)" id="8021">k</a> -&gt; <a href="#759787" title="String">v</a>)
      }
    }
    
    <span class="keyword">def</span> <a title="(jar: String)Unit" id="759572">oneJar</a>(<a title="String" id="759896">jar</a>: <span title="String">String</span>): <span title="Unit">Unit</span> = {
      <span class="keyword">def</span> <a title="(s: String)String" id="759897">cleanup</a>(<a title="String" id="759899">s</a>: <span title="String">String</span>): <span title="String">String</span> = <a href="#759899" title="(f: (Char) =&gt; Char)(implicit bf: scala.collection.generic.BuilderFactory[Char,scala.runtime.RichString,scala.runtime.RichString])scala.runtime.RichString">s</a> <a title="=&gt; scala.collection.generic.BuilderFactory[Char,scala.runtime.RichString,scala.runtime.RichString]" id="2076">map</a> { <a title="Char" id="759925">c</a> =&gt; <span title="Char" class="keyword">if</span> (<a href="#759925" title="(x$1: Char)Boolean">c</a> <span title="(x$1: Boolean)Boolean">==</span> <span title="Char('/')" class="char">'/'</span> || <a href="#759925" title="(x$1: Char)Boolean">c</a> == <span title="Char('$')" class="char">'$'</span>) <span title="Char('.')" class="char">'.'</span> <span class="keyword">else</span> <a href="#759925" title="Char">c</a> } <a title="()String" id="30636">toString</a>
      <span class="keyword">val</span> <a title="List[String]" id="759898">classfiles</a> = <a href="#126306" title="(path: String)List[String]">Completion</a> <span title="(f: (String) =&gt; String)(implicit bf: scala.collection.generic.BuilderFactory[String,List[String],List[String]])List[String]">getClassFiles</span> <a href="#759896" title="String">jar</a> <span title="scala.collection.generic.BuilderFactory[String,List[String],List#Coll]">map</span> <a href="#759897" title="(s: String)String">cleanup</a>
        
      <span class="keyword">for</span> (<a title="String" id="760116">cl</a> &lt;- <a href="#759898" title="(f: (String) =&gt; Unit)Unit">classfiles</a>; (<a title="String" id="760154">k</a>, <a title="String" id="760155">v</a>) &lt;- <a href="#759571" title="(s: String)List[(String, String)]">subpaths</a><a href="#760121" title="(f: ((String, String)) =&gt; List[String])Unit">(</a><a href="#760116" title="String">cl</a>)) {
        <span title="List[String]" class="keyword">if</span> (<a href="#758099" title="(x$1: Any)Boolean">map</a> containsKey <a href="#760154" title="String">k</a>) <a href="#758099" title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">map</a>.<span title="(x$1: String,x$2: List[String])List[String]">put</span>(<a href="#760154" title="String">k</a>, <a href="#760155" title="String">v</a> <a href="#760174" title="String">::</a> <a href="#758099" title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">map</a>.<span title="(x$1: Any)List[String]">get</span><span title="(x: String)List[String]">(</span><a href="#760154" title="String">k</a>))
        <span class="keyword">else</span> <a href="#758099" title="java.util.concurrent.ConcurrentHashMap[String,List[String]]">map</a>.<span title="(x$1: String,x$2: List[String])List[String]">put</span>(<a href="#760154" title="String">k</a>, <span title="(xs: String*)List[String]">List</span>(<a href="#760155" title="String">v</a>))
      }
    }
    
    <a href="#759570" title="(f: (String) =&gt; Unit)Unit">jars</a> foreach <a href="#759572" title="(jar: String)Unit">oneJar</a>
  }
}

        </pre>
    </body>
</html>