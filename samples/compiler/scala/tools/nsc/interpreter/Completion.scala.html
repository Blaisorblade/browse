<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/interpreter/Completion.scala</title>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author Paul Phillips
 */</span>
<span class="comment">// $Id$</span>

<span class="comment">//</span>
<span class="comment">// TODO, if practical:</span>
<span class="comment">//</span>
<span class="comment">// 1) Types: val s: String = x.&lt;tab&gt; should only show members which result in a String.</span>
<span class="comment">//      Possible approach: evaluate buffer as if current identifier is </span>
<span class="comment">// 2) Implicits: x.&lt;tab&gt; should show not only x's members but those of anything for which</span>
<span class="comment">//      there is an implicit conversion from x.</span>
<span class="comment">// 3) Chaining: x.foo(bar).&lt;tab&gt; should complete on foo's result type.</span>
<span class="comment">// 4) Imports: after import scala.collection.mutable._, HashMap should be among</span>
<span class="comment">//      my top level identifiers.</span>
<span class="comment">// 5) Caching: it's silly to parse all the jars on every startup, we should have</span>
<span class="comment">//      a peristent store somewhere we can write and only check last-mod dates.</span>
<span class="comment">// 6) Security: Are we using the filesystem unnecessarily?</span>
<span class="comment">//</span>

<span class="keyword">package</span> scala.tools.nsc.interpreter

<span class="keyword">import</span> jline._
<span class="keyword">import</span> java.net.URL
<span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap

<span class="comment">// REPL completor - queries supplied interpreter for valid completions</span>
<span class="comment">// based on current contents of buffer.</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class Completion extends java.lang.Object with jline.Completor with ScalaObject</span><a id="17675">Completion</a></span>(<span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.Interpreter</span><span id="75883"><span id="75882"><a id="75900">interpreter</a></span></span></span>: <span class="typed"><span class="type">scala.tools.nsc.Interpreter</span><a href="../Interpreter.scala.html#6405">Interpreter</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">jline.Completor</span><a id="75056">Completor</a></span> {
  <span class="keyword">import</span> Completion._
  <span class="keyword">import</span> java.util.{ List =&gt; JList }
  <span class="keyword">import</span> interpreter.compilerClasspath
  
  <span class="comment">// it takes a little while to look through the jars so we use a future and a concurrent map</span>
  <span class="keyword">val</span> <span class="typed"><span class="type">java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><span id="75889"><a id="75888">dottedPaths</a></span></span> = <span class="typed"><span class="type">()java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a id="153288" class="keyword">new</a></span> <span class="typed"><span class="type">java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a id="75676">ConcurrentHashMap</a></span>[String, List[String]]
  
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="75892"><span id="75890"><span id="75891"><a id="153335">doneExaminingJars</a></span></span></span></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
  scala.concurrent.<span class="typed"><span class="type">object scala.concurrent.ops</span><a id="86326">ops</a></span>.<span class="typed"><span class="type">(=&gt; Unit)() =&gt; Unit</span><a id="125646">future</a></span> {
    <span class="typed"><span class="type">(java.util.concurrent.ConcurrentHashMap[String,List[String]],scala.tools.nsc.Interpreter)Unit</span><a href="#148115">getDottedPaths</a></span>(<span class="typed"><span class="type">=&gt; java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a href="#75888">dottedPaths</a></span>, <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#75882">interpreter</a></span>)
    <span class="typed"><span class="type">(Boolean)Unit</span><a href="#75891">doneExaminingJars</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
  }
  
  <span class="comment">// Would like to find a nicer way to do this, but this works for now</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="75894">topLevelPackagesVal</a></span>  = <span class="typed"><span class="type">()List[String]</span><a href="#75895">topLevelPackagesDef</a></span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()List[String]</span><a id="75895">topLevelPackagesDef</a></span>()     = <span class="typed"><span class="type">(java.util.Enumeration[String])List[String]</span><a href="#148102">enumToList</a></span>(<span class="typed"><span class="type">=&gt; java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a href="#75888">dottedPaths</a></span>.<span class="typed"><span class="type">()java.util.Enumeration[String]</span><a id="153319">keys</a></span>) <span class="typed"><span class="type">((String) =&gt; Boolean)List[String]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">String</span><a id="153349">x</a></span> =&gt; <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString</span><span id="6140"><a href="#153349" id="821">x</a></span></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="21673">contains</a></span>(<span class="typed"><span class="type">Char('.')</span><span class="char">'.'</span></span>))
  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; List[String]</span><a id="75896">topLevelPackages</a></span>          = <span class="typed"><span class="type">List[String]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a href="#75890">doneExaminingJars</a></span>) <span class="typed"><span class="type">=&gt; List[String]</span><a href="#75893">topLevelPackagesVal</a></span> <span class="keyword">else</span> <span class="typed"><span class="type">()List[String]</span><a href="#75895">topLevelPackagesDef</a></span>

  <span class="comment">// One instance of a command line</span>
  <span class="keyword">class</span> <span class="typed"><span class="type">class Buffer extends java.lang.Object with ScalaObject</span><a id="75897">Buffer</a></span>(<span class="typed"><span class="type">String</span><span id="153359"><a id="153416">s</a></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) {
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><span id="153362"><a id="153361">buffer</a></span></span> = <span class="typed"><span class="type">java.lang.String</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#153359">s</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">String</span><a href="#153359">s</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">List[java.lang.String]</span><span id="153364"><a id="153363">segments</a></span></span> = <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153361">buffer</a></span>.<span class="typed"><span class="type">(java.lang.String,Int)Array[java.lang.String]</span><a id="5864">split</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;\.&quot;)</span><span class="string">&quot;\\.&quot;</span></span>, -<span class="typed"><span class="type">Int(-1)</span><span class="int">1</span></span>).<span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a id="21815">toList</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><span id="153366"><a id="153365">lastDot</a></span></span> = <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153361">buffer</a></span>.<span class="typed"><span class="type">(Int)Int</span><a id="5846">lastIndexOf</a></span>(<span class="typed"><span class="type">Int(46)</span><span class="char">'.'</span></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">Boolean</span><span id="153368"><a id="153367">hasDot</a></span></span> = <span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a href="#153363">segments</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a href="#153363">segments</a></span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a id="21350">last</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>
    
    <span class="comment">// given foo.bar.baz, path = foo.bar and stub = baz</span>
    <span class="keyword">val</span> <span class="typed"><span class="type">(java.lang.String, java.lang.String)</span><span id="23625"><a href="#153412" id="1379">(</a></span></span><span class="typed"><span class="type">java.lang.String</span><span id="153412"><span id="153371"><span id="23614"><a href="#153369" id="153370">path</a></span></span></span></span>, <span class="typed"><span class="type">java.lang.String</span><span id="153413"><span id="153373"><span id="23616"><a href="#153369" id="153372">stub</a></span></span></span></span>) = <span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a href="#153363">segments</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(java.lang.String, java.lang.String)</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">(java.lang.String, java.lang.String)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>    =&gt; <span class="typed"><span class="type">(java.lang.String,java.lang.String)(java.lang.String, java.lang.String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
      <span class="typed"><span class="type">(java.lang.String, java.lang.String)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>    =&gt; <span class="typed"><span class="type">(java.lang.String,java.lang.String)(java.lang.String, java.lang.String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a href="#153363">segments</a></span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a id="21332">head</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
      <span class="typed"><span class="type">(String, java.lang.String)</span><span class="keyword">case</span></span> _    =&gt; <span class="typed"><span class="type">(String,java.lang.String)(String, java.lang.String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a href="#153363">segments</a></span>.<span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a id="21349">init</a></span>.<span class="typed"><span class="type">(String)String</span><a id="21819">mkString</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;.&quot;)</span><span class="string">&quot;.&quot;</span></span>), <span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a href="#153363">segments</a></span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a id="21350">last</a></span>)
    }

    <span class="keyword">def</span> <span class="typed"><span class="type">(List[String])List[String]</span><a id="153374">filt</a></span>(<span class="typed"><span class="type">List[String]</span><a id="153417">xs</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) = <span class="typed"><span class="type">List[String]</span><a href="#153417">xs</a></span> <span class="typed"><span class="type">((String) =&gt; Boolean)List[String]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">String</span><a href="#153420">_</a></span> <span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span> <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153372">stub</a></span>)

    <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Result extends java.lang.Object with ScalaObject with Product</span><span id="2751"><span id="153448"><span id="3141"><span id="153452"><span id="153446"><span id="153375"><span id="153458"><span id="153463"><span id="153376"><span id="153453"><span id="153465"><span id="3509"><span id="153449"><span id="29737"><span id="153459"><span id="29814"><span id="3500"><span id="29815"><span id="153451"><span id="23625"><span id="2750"><span id="29856"><span id="1379"><span id="308"><span id="3501"><span id="153464"><span id="5794"><span id="153462"><a id="153447">Result</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">List[String]</span><span id="153425"><span id="153424"><span id="153433"><a id="153492">candidates</a></span></span></span></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String], <span class="typed"><span class="type">Int</span><span id="153427"><span id="153426"><span id="153434"><a id="153493">position</a></span></span></span></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) {
      <span class="keyword">def</span> <span class="typed"><span class="type">()List[java.lang.String]</span><a id="153429">getCandidates</a></span>() = <span class="typed"><span class="type">=&gt; List[String]</span><a href="#153424">candidates</a></span>.<span class="typed"><span class="type">((String) =&gt; java.lang.String)List[java.lang.String]</span><a id="21362">map</a></span>(<span class="typed"><span class="type">String</span><a href="#153438">_</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="5870">trim</a></span>).<span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a id="21405">removeDuplicates</a></span>.<span class="typed"><span class="type">((java.lang.String, java.lang.String) =&gt; Boolean)List[java.lang.String]</span><a id="21370">sort</a></span>(<span class="typed"><span class="type">implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString</span><span id="6140"><a href="#153440" id="821">_</a></span></span> <span class="typed"><span class="type">(String)Boolean</span><a id="23138">&lt;</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#153441">_</a></span>)
    }
    
    <span class="comment">// work out completion candidates and position</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(java.util.List[String])Buffer.this.Result</span><a id="153378">analyzeBuffer</a></span>(<span class="typed"><span class="type">java.util.List[String]</span><a id="153467">clist</a></span>: <span class="typed"><span class="type">java.util.List[String]</span><a id="5410">JList</a></span>[String]): <span class="typed"><span class="type">Buffer.this.Result</span><a href="#153375">Result</a></span> = {
      <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="153469">ids</a></span> = <span class="typed"><span class="type">(String)List[String]</span><a href="#153384">idsStartingWith</a></span>(<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153370">path</a></span>)
      <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="153471">pkgs</a></span> = <span class="typed"><span class="type">(String)List[String]</span><a href="#153383">pkgsStartingWith</a></span>(<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153370">path</a></span>)
      <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="153473">count</a></span> = (<span class="typed"><span class="type">=&gt; List[String]</span><a href="#153468">ids</a></span> <span class="typed"><span class="type">(List[String])List[String]</span><a href="#153488" id="21339">:::</a></span> <span class="typed"><span class="type">=&gt; List[String]</span><a href="#153470">pkgs</a></span>).<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span>        
      
      <span class="keyword">def</span> <span class="typed"><span class="type">()Buffer.this.Result</span><a id="153474">doSimple</a></span>(): <span class="typed"><span class="type">Buffer.this.Result</span><a href="#153375">Result</a></span> = <span class="typed"><span class="type">=&gt; Int</span><a href="#153472">count</a></span> <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>                                    =&gt; <span class="typed"><span class="type">(List[String],Int)Buffer.this.Result</span><a href="#153451">Result</a></span>(<span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
        <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span> <span class="keyword">if</span> <span class="typed"><span class="type">=&gt; List[String]</span><a href="#153470">pkgs</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>                   =&gt; <span class="typed"><span class="type">(List[String],Int)Buffer.this.Result</span><a href="#153451">Result</a></span>(<span class="typed"><span class="type">=&gt; List[String]</span><a href="#153470">pkgs</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
        <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span> <span class="keyword">if</span> <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153361">buffer</a></span>.<span class="typed"><span class="type">()Int</span><a id="5821">length</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">=&gt; List[String]</span><a href="#153468">ids</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="21332">head</a></span>.<span class="typed"><span class="type">()Int</span><a id="5821">length</a></span> =&gt; <span class="typed"><span class="type">(List[String],Int)Buffer.this.Result</span><a href="#153451">Result</a></span>(<span class="typed"><span class="type">=&gt; List[String]</span><a href="#153468">ids</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
        <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>                                    =&gt; <span class="typed"><span class="type">(List[String],Int)Buffer.this.Result</span><a href="#153451">Result</a></span>(<span class="typed"><span class="type">=&gt; List[String]</span><a href="#153468">ids</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
          <span class="comment">// XXX for now commented out &quot;dot inference&quot; because it's overcomplicated</span>
          <span class="comment">// val members = membersOfId(ids.head) filter (_ startsWith stub)</span>
          <span class="comment">// if (members.isEmpty) Result(Nil, 0)</span>
          <span class="comment">// else Result(members, path.length + 1)</span>
        <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">case</span></span> _                                    =&gt; <span class="typed"><span class="type">(List[String],Int)Buffer.this.Result</span><a href="#153451">Result</a></span>(<span class="typed"><span class="type">=&gt; List[String]</span><a href="#153468">ids</a></span> <span class="typed"><span class="type">(List[String])List[String]</span><a href="#153497" id="21339">:::</a></span> <span class="typed"><span class="type">=&gt; List[String]</span><a href="#153470">pkgs</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
      }
      
      <span class="keyword">def</span> <span class="typed"><span class="type">()Buffer.this.Result</span><a id="153475">doDotted</a></span>(): <span class="typed"><span class="type">Buffer.this.Result</span><a href="#153375">Result</a></span> = {
        <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="153501">pkgs</a></span> = <span class="typed"><span class="type">(List[String])List[String]</span><a href="#153374">filt</a></span>(<span class="typed"><span class="type">(String)List[String]</span><a href="#153382">membersOfPath</a></span>(<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153370">path</a></span>))
        <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="153503">ids</a></span> = <span class="typed"><span class="type">(List[String])List[String]</span><a href="#153374">filt</a></span>(<span class="typed"><span class="type">(String)List[String]</span><a href="#153380">membersOfId</a></span>(<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153370">path</a></span>))
        <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="153505">statics</a></span> = <span class="typed"><span class="type">(List[String])List[String]</span><a href="#153374">filt</a></span>(<span class="typed"><span class="type">(String)List[String]</span><a href="#75899">completeStaticMembers</a></span>(<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153370">path</a></span>))
        
        <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; List[String]</span><a href="#153500">pkgs</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="21645">isEmpty</a></span>) <span class="typed"><span class="type">(List[String],Int)Buffer.this.Result</span><a href="#153451">Result</a></span>(<span class="typed"><span class="type">=&gt; List[String]</span><a href="#153500">pkgs</a></span>, <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153370">path</a></span>.<span class="typed"><span class="type">()Int</span><a id="5821">length</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)
        <span class="keyword">else</span> <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; List[String]</span><a href="#153502">ids</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="21645">isEmpty</a></span>) <span class="typed"><span class="type">(List[String],Int)Buffer.this.Result</span><a href="#153451">Result</a></span>(<span class="typed"><span class="type">=&gt; List[String]</span><a href="#153502">ids</a></span>, <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153370">path</a></span>.<span class="typed"><span class="type">()Int</span><a id="5821">length</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)
        <span class="keyword">else</span> <span class="typed"><span class="type">(List[String],Int)Buffer.this.Result</span><a href="#153451">Result</a></span>(<span class="typed"><span class="type">=&gt; List[String]</span><a href="#153504">statics</a></span>, <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#153370">path</a></span>.<span class="typed"><span class="type">()Int</span><a id="5821">length</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)
      }
      
      <span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a href="#153363">segments</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>            =&gt; <span class="typed"><span class="type">(List[String],Int)Buffer.this.Result</span><a href="#153451">Result</a></span>(<span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
        <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>            =&gt; <span class="typed"><span class="type">()Buffer.this.Result</span><a href="#153474">doSimple</a></span>()
        <span class="typed"><span class="type">Buffer.this.Result</span><span class="keyword">case</span></span> _            =&gt; <span class="typed"><span class="type">()Buffer.this.Result</span><a href="#153475">doDotted</a></span>()
      }
    }
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Boolean</span><a id="153379">isValidId</a></span>(<span class="typed"><span class="type">String</span><a id="153568">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#75882">interpreter</a></span>.<span class="typed"><span class="type">()List[String]</span><a href="../Interpreter.scala.html#75444">unqualifiedIds</a></span> <span class="typed"><span class="type">(Any)Boolean</span><a id="21673">contains</a></span> <span class="typed"><span class="type">String</span><a href="#153568">s</a></span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)List[String]</span><a id="153380">membersOfId</a></span>(<span class="typed"><span class="type">String</span><a id="153510">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#75882">interpreter</a></span> <span class="typed"><span class="type">(String)List[String]</span><a href="../Interpreter.scala.html#75443">membersOfIdentifier</a></span> <span class="typed"><span class="type">String</span><a href="#153510">s</a></span>
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Boolean</span><a id="153381">isValidPath</a></span>(<span class="typed"><span class="type">String</span><a id="153508">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">=&gt; java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a href="#75888">dottedPaths</a></span> <span class="typed"><span class="type">(Any)Boolean</span><a id="153297">containsKey</a></span> <span class="typed"><span class="type">String</span><a href="#153508">s</a></span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)List[String]</span><a id="153382">membersOfPath</a></span>(<span class="typed"><span class="type">String</span><a id="153506">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">List[String]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(String)Boolean</span><a href="#153381">isValidPath</a></span>(<span class="typed"><span class="type">String</span><a href="#153506">s</a></span>)) <span class="typed"><span class="type">=&gt; java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a href="#75888">dottedPaths</a></span> <span class="typed"><span class="type">(Any)List[String]</span><a id="153296">get</a></span> <span class="typed"><span class="type">String</span><a href="#153506">s</a></span> <span class="keyword">else</span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)List[String]</span><a id="153383">pkgsStartingWith</a></span>(<span class="typed"><span class="type">String</span><a id="153482">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">=&gt; List[String]</span><a href="#75896">topLevelPackages</a></span> <span class="typed"><span class="type">((String) =&gt; Boolean)List[String]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">String</span><a href="#153486">_</a></span> <span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span> <span class="typed"><span class="type">String</span><a href="#153482">s</a></span>)
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)List[String]</span><a id="153384">idsStartingWith</a></span>(<span class="typed"><span class="type">String</span><a id="153476">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#75882">interpreter</a></span>.<span class="typed"><span class="type">()List[String]</span><a href="../Interpreter.scala.html#75444">unqualifiedIds</a></span> <span class="typed"><span class="type">((String) =&gt; Boolean)List[String]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">String</span><a href="#153480">_</a></span> <span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span> <span class="typed"><span class="type">String</span><a href="#153476">s</a></span>)

    <span class="keyword">def</span> <span class="typed"><span class="type">(java.util.List[String])Int</span><a id="153385">complete</a></span>(<span class="typed"><span class="type">java.util.List[String]</span><a id="153570">clist</a></span>: <span class="typed"><span class="type">java.util.List[String]</span><a id="5410">JList</a></span>[String]): <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">Buffer.this.Result</span><a id="153571">res</a></span> = <span class="typed"><span class="type">(java.util.List[String])Buffer.this.Result</span><a href="#153378">analyzeBuffer</a></span>(<span class="typed"><span class="type">java.util.List[String]</span><a href="#153570">clist</a></span>)
      <span class="typed"><span class="type">Buffer.this.Result</span><a href="#153571">res</a></span>.<span class="typed"><span class="type">()List[java.lang.String]</span><a href="#153429">getCandidates</a></span> <span class="typed"><span class="type">((java.lang.String) =&gt; Unit)Unit</span><a id="21366">foreach</a></span> (<span class="typed"><span class="type">java.util.List[String]</span><a href="#153570">clist</a></span> <span class="typed"><span class="type">(String)Boolean</span><a id="75537">add</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#153574">_</a></span>)
      <span class="typed"><span class="type">Buffer.this.Result</span><a href="#153571">res</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#153426">position</a></span>
    }
  }
  
  <span class="comment">// jline's completion comes through here - we ask a Buffer for the candidates.</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String,Int,java.util.List[_])Int</span><a id="75898">complete</a></span>(<span class="typed"><span class="type">String</span><a id="153577">_buffer</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">Int</span><a id="153578">cursor</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>, <span class="typed"><span class="type">java.util.List[_]</span><a id="153579">candidates</a></span>: <span class="typed"><span class="type">java.util.List[_]</span><a id="5410">JList</a></span>[_]): <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span> =
    <span class="typed"><span class="type">Completion.this.Buffer</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Completion.this.Buffer</span><a href="#75897">Buffer</a></span>(<span class="typed"><span class="type">String</span><a href="#153577">_buffer</a></span>).<span class="typed"><span class="type">(java.util.List[String])Int</span><a href="#153385">complete</a></span>(<span class="typed"><span class="type">java.util.List[_]</span><a href="#153579">candidates</a></span>.<span class="typed"><span class="type">java.util.List[String]</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">java.util.List[String]</span><a id="5410">JList</a></span>[String]])
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)List[String]</span><a id="75899">completeStaticMembers</a></span>(<span class="typed"><span class="type">String</span><a id="153512">path</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String] = {
    <span class="keyword">import</span> java.lang.reflect.Modifier.{ isPrivate, isProtected, isStatic }
    <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Boolean</span><a id="153584">isVisible</a></span>(<span class="typed"><span class="type">Int</span><a id="153589">x</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) = <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">(Int)Boolean</span><span id="128525"><a id="3892">isPrivate</a></span></span>(<span class="typed"><span class="type">Int</span><a href="#153589">x</a></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">(Int)Boolean</span><span id="128526"><a id="3892">isProtected</a></span></span>(<span class="typed"><span class="type">Int</span><a href="#153589">x</a></span>)
    <span class="keyword">def</span> <span class="typed"><span class="type">(Int,Boolean)Boolean</span><a id="153585">isSingleton</a></span>(<span class="typed"><span class="type">Int</span><a id="153590">x</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>, <span class="typed"><span class="type">Boolean</span><a id="153591">isJava</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span>) = <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">Boolean</span><a href="#153591">isJava</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2750">||</a></span> <span class="typed"><span class="type">(Int)Boolean</span><span id="128527"><a id="3892">isStatic</a></span></span>(<span class="typed"><span class="type">Int</span><a href="#153590">x</a></span>)
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(Class[_],Boolean)List[String]</span><a id="153586">getMembers</a></span>(<span class="typed"><span class="type">Class[_]</span><a id="153592">c</a></span>: <span class="typed"><span class="type">Class[_]</span><a id="1672">Class</a></span>[_], <span class="typed"><span class="type">Boolean</span><a id="153593">isJava</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span>): <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String] =
      <span class="typed"><span class="type">Class[_]</span><a href="#153592">c</a></span>.<span class="typed"><span class="type">()Array[java.lang.reflect.Method]</span><a id="4337">getMethods</a></span>.<span class="typed"><span class="type">=&gt; List[java.lang.reflect.Method]</span><a id="21815">toList</a></span> .
        <span class="typed"><span class="type">((java.lang.reflect.Method) =&gt; Boolean)List[java.lang.reflect.Method]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">java.lang.reflect.Method</span><a id="153599">x</a></span> =&gt; <span class="typed"><span class="type">(Int)Boolean</span><a href="#153584">isVisible</a></span>(<span class="typed"><span class="type">java.lang.reflect.Method</span><a href="#153599">x</a></span>.<span class="typed"><span class="type">()Int</span><a id="128473">getModifiers</a></span>)) .
        <span class="typed"><span class="type">((java.lang.reflect.Method) =&gt; Boolean)List[java.lang.reflect.Method]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">java.lang.reflect.Method</span><a id="153602">x</a></span> =&gt; <span class="typed"><span class="type">(Int,Boolean)Boolean</span><a href="#153585">isSingleton</a></span>(<span class="typed"><span class="type">java.lang.reflect.Method</span><a href="#153602">x</a></span>.<span class="typed"><span class="type">()Int</span><a id="128473">getModifiers</a></span>, <span class="typed"><span class="type">Boolean</span><a href="#153593">isJava</a></span>)) .
        <span class="typed"><span class="type">((java.lang.reflect.Method) =&gt; java.lang.String)List[java.lang.String]</span><a id="21362">map</a></span> (<span class="typed"><span class="type">java.lang.reflect.Method</span><a href="#153606">_</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="128472">getName</a></span>) .
        <span class="typed"><span class="type">((java.lang.String) =&gt; Boolean)List[java.lang.String]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">(String)Boolean</span><a href="#148111">isValidCompletion</a></span>)
        
    <span class="comment">// java style, static methods</span>
    <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="153587">js</a></span> = <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#75882">interpreter</a></span>.<span class="typed"><span class="type">(String)Option[java.lang.Class[_]]</span><a href="../Interpreter.scala.html#75445">tryToLoadClass</a></span>(<span class="typed"><span class="type">String</span><a href="#153512">path</a></span>).<span class="typed"><span class="type">((java.lang.Class[_]) =&gt; List[String])Option[List[String]]</span><a id="25413">map</a></span>(<span class="typed"><span class="type">(Class[_],Boolean)List[String]</span><a href="#153586">getMembers</a></span>(<span class="typed"><span class="type">java.lang.Class[_]</span><a href="#153612">_</a></span>, <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>)) <span class="typed"><span class="type">(=&gt; List[String])List[String]</span><a id="25411">getOrElse</a></span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>
    <span class="comment">// scala style, methods on companion object</span>
    <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="153588">ss</a></span> = <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#75882">interpreter</a></span>.<span class="typed"><span class="type">(String)Option[java.lang.Class[_]]</span><a href="../Interpreter.scala.html#75445">tryToLoadClass</a></span>(<span class="typed"><span class="type">String</span><a href="#153512">path</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;$&quot;)</span><span class="string">&quot;$&quot;</span></span>).<span class="typed"><span class="type">((java.lang.Class[_]) =&gt; List[String])Option[List[String]]</span><a id="25413">map</a></span>(<span class="typed"><span class="type">(Class[_],Boolean)List[String]</span><a href="#153586">getMembers</a></span>(<span class="typed"><span class="type">java.lang.Class[_]</span><a href="#153618">_</a></span>, <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>)) <span class="typed"><span class="type">(=&gt; List[String])List[String]</span><a id="25411">getOrElse</a></span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>
    
    <span class="typed"><span class="type">List[String]</span><a href="#153587">js</a></span> <span class="typed"><span class="type">(List[String])List[String]</span><a href="#153622" id="21339">:::</a></span> <span class="typed"><span class="type">List[String]</span><a href="#153588">ss</a></span>
  }
}

<span class="keyword">object</span> <span class="typed"><span class="type">object scala.tools.nsc.interpreter.Completion</span><a id="17676">Completion</a></span>
{
  <span class="keyword">import</span> java.io.File
  <span class="keyword">import</span> java.util.jar.{ JarEntry, JarFile }
  
  <span class="keyword">def</span> <span class="typed"><span class="type">[T](java.util.Enumeration[T])List[T]</span><a id="148102">enumToList</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="148104">T</a></span>](<span class="typed"><span class="type">java.util.Enumeration[T]</span><a id="153344">e</a></span>: java.util.<span class="typed"><span class="type">java.util.Enumeration[T]</span><a id="5314">Enumeration</a></span>[T]): <span class="typed"><span class="type">List[T]</span><a id="526">List</a></span>[T] = <span class="typed"><span class="type">(java.util.Enumeration[T],List[T])List[T]</span><a href="#148105">enumToList</a></span>(<span class="typed"><span class="type">java.util.Enumeration[T]</span><a href="#153344">e</a></span>, <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>)
  <span class="keyword">def</span> <span class="typed"><span class="type">[T](java.util.Enumeration[T],List[T])List[T]</span><a id="148105">enumToList</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="148107">T</a></span>](<span class="typed"><span class="type">java.util.Enumeration[T]</span><a id="153341">e</a></span>: java.util.<span class="typed"><span class="type">java.util.Enumeration[T]</span><a id="5314">Enumeration</a></span>[T], <span class="typed"><span class="type">List[T]</span><a id="153342">xs</a></span>: <span class="typed"><span class="type">List[T]</span><a id="526">List</a></span>[T]): <span class="typed"><span class="type">List[T]</span><a id="526">List</a></span>[T] =
    <span class="typed"><span class="type">List[T]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.util.Enumeration[T]</span><a href="#153341">e</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2750">||</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">java.util.Enumeration[T]</span><a href="#153341">e</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40860">hasMoreElements</a></span>) <span class="typed"><span class="type">List[T]</span><a href="#153342">xs</a></span> <span class="keyword">else</span> <span class="typed"><span class="type">(java.util.Enumeration[T],List[T])List[T]</span><a href="#148105">enumToList</a></span>(<span class="typed"><span class="type">java.util.Enumeration[T]</span><a href="#153341">e</a></span>, <span class="typed"><span class="type">java.util.Enumeration[T]</span><a href="#153341">e</a></span>.<span class="typed"><span class="type">()T</span><a id="40861">nextElement</a></span> <span class="typed"><span class="type">(T)List[T]</span><a href="#153643" id="21335">::</a></span> <span class="typed"><span class="type">List[T]</span><a href="#153342">xs</a></span>)
  
  <span class="comment">// methods to leave out of completion</span>
  <span class="keyword">val</span> <span class="typed"><span class="type">List[java.lang.String]</span><span id="148109"><a id="148108">excludeMethods</a></span></span> = <span class="typed"><span class="type">(java.lang.String*)List[java.lang.String]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;hashCode&quot;)</span><span class="string">&quot;hashCode&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;equals&quot;)</span><span class="string">&quot;equals&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;wait&quot;)</span><span class="string">&quot;wait&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;notify&quot;)</span><span class="string">&quot;notify&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;notifyAll&quot;)</span><span class="string">&quot;notifyAll&quot;</span></span>)  

  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Boolean</span><a id="148110">exists</a></span>(<span class="typed"><span class="type">String</span><a id="153646">path</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">String</span><a href="#153646">path</a></span>) <span class="typed"><span class="type">()Boolean</span><a id="40697">exists</a></span>
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Boolean</span><a id="148111">isValidCompletion</a></span>(<span class="typed"><span class="type">String</span><a id="148171">x</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span>(<span class="typed"><span class="type">String</span><a href="#148171">x</a></span> <span class="typed"><span class="type">(java.lang.CharSequence)Boolean</span><a id="5860">contains</a></span> <span class="typed"><span class="type">java.lang.String(&quot;$&quot;)</span><span class="string">&quot;$&quot;</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span>(<span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a href="#148108">excludeMethods</a></span> <span class="typed"><span class="type">(Any)Boolean</span><a id="21673">contains</a></span> <span class="typed"><span class="type">String</span><a href="#148171">x</a></span>)
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Boolean</span><a id="148112">isClass</a></span>(<span class="typed"><span class="type">String</span><a id="153650">x</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>)    = <span class="typed"><span class="type">String</span><a href="#153650">x</a></span> <span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5842">endsWith</a></span> <span class="typed"><span class="type">java.lang.String(&quot;.class&quot;)</span><span class="string">&quot;.class&quot;</span></span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)java.lang.String</span><a id="148113">dropClass</a></span>(<span class="typed"><span class="type">String</span><a id="153652">x</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>)  = <span class="typed"><span class="type">String</span><a href="#153652">x</a></span>.<span class="typed"><span class="type">(Int,Int)java.lang.String</span><a id="5855">substring</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">String</span><a href="#153652">x</a></span>.<span class="typed"><span class="type">()Int</span><a id="5821">length</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span> <span class="typed"><span class="type">Int(6)</span><span class="int">6</span></span>)  <span class="comment">// drop .class</span>
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)List[String]</span><a id="148114">getClassFiles</a></span>(<span class="typed"><span class="type">String</span><a id="153675">path</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String] = {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">(String)Boolean</span><a href="#148110">exists</a></span>(<span class="typed"><span class="type">String</span><a href="#153675">path</a></span>)) <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>

    <span class="typed"><span class="type">(java.util.Enumeration[java.util.jar.JarEntry])List[java.util.jar.JarEntry]</span><a href="#148102">enumToList</a></span>(<span class="typed"><span class="type">java.util.jar.JarFile</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.jar.JarFile</span><a id="57352">JarFile</a></span>(<span class="typed"><span class="type">String</span><a href="#153675">path</a></span>).<span class="typed"><span class="type">()java.util.Enumeration[java.util.jar.JarEntry]</span><a id="95697">entries</a></span>) .
      <span class="typed"><span class="type">((java.util.jar.JarEntry) =&gt; java.lang.String)List[java.lang.String]</span><a id="21362">map</a></span> (<span class="typed"><span class="type">java.util.jar.JarEntry</span><a href="#153686">_</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="41095">getName</a></span>) .
      <span class="typed"><span class="type">((java.lang.String) =&gt; Boolean)List[java.lang.String]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">(String)Boolean</span><a href="#148112">isClass</a></span>) .
      <span class="typed"><span class="type">((java.lang.String) =&gt; java.lang.String)List[java.lang.String]</span><a id="21362">map</a></span> (<span class="typed"><span class="type">(String)java.lang.String</span><a href="#148113">dropClass</a></span>) .
      <span class="typed"><span class="type">((java.lang.String) =&gt; Boolean)List[java.lang.String]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">(String)Boolean</span><a href="#148111">isValidCompletion</a></span>)
  }
  
  <span class="comment">// all the dotted path to classfiles we can find by poking through the jars</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.util.concurrent.ConcurrentHashMap[String,List[String]],scala.tools.nsc.Interpreter)Unit</span><a id="148115">getDottedPaths</a></span>(
    <span class="typed"><span class="type">java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a id="153337">map</a></span>: <span class="typed"><span class="type">java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a id="75676">ConcurrentHashMap</a></span>[String, List[String]],
    <span class="typed"><span class="type">scala.tools.nsc.Interpreter</span><a id="153338">interpreter</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Interpreter</span><a href="../Interpreter.scala.html#6405">Interpreter</a></span>): <span class="typed"><span class="type">Unit</span><a id="2169">Unit</a></span> =
  {
    <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="153697">cp</a></span> =
      <span class="typed"><span class="type">scala.tools.nsc.Interpreter</span><a href="#153338">interpreter</a></span>.<span class="typed"><span class="type">=&gt; List[java.net.URL]</span><a href="../Interpreter.scala.html#75378">compilerClasspath</a></span>.<span class="typed"><span class="type">((java.net.URL) =&gt; java.lang.String)List[java.lang.String]</span><a id="21362">map</a></span>(<span class="typed"><span class="type">java.net.URL</span><a href="#153704">_</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40948">getPath</a></span>) <span class="typed"><span class="type">(List[String])List[String]</span><a href="#153701" id="21339">:::</a></span>            <span class="comment">// compiler jars, scala-library.jar etc.</span>
      <span class="typed"><span class="type">scala.tools.nsc.Interpreter</span><a href="#153338">interpreter</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="../Interpreter.scala.html#75351">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="../Settings.scala.html#29950">bootclasspath</a></span>.<span class="typed"><span class="type">implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString</span><span id="6140"><a href="../Settings.scala.html#30301" id="821">value</a></span></span>.<span class="typed"><span class="type">(Char)Array[String]</span><a id="22850">split</a></span>(<span class="typed"><span class="type">Char(':')</span><span class="char">':'</span></span>).<span class="typed"><span class="type">=&gt; List[String]</span><a id="21815">toList</a></span>  <span class="comment">// boot classpath, java.lang.* etc.</span>
    
    <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="153698">jars</a></span> = <span class="typed"><span class="type">List[String]</span><a href="#153697">cp</a></span>.<span class="typed"><span class="type">=&gt; List[String]</span><a id="21405">removeDuplicates</a></span> <span class="typed"><span class="type">((String) =&gt; Boolean)List[String]</span><a id="21367">filter</a></span> (<span class="typed"><span class="type">String</span><a href="#153723">_</a></span> <span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5842">endsWith</a></span> <span class="typed"><span class="type">java.lang.String(&quot;.jar&quot;)</span><span class="string">&quot;.jar&quot;</span></span>)
    
    <span class="comment">// for e.g. foo.bar.baz.C, returns (foo -&gt; bar), (foo.bar -&gt; baz), (foo.bar.baz -&gt; C)</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)List[(String, String)]</span><a id="153699">subpaths</a></span>(<span class="typed"><span class="type">String</span><a id="153724">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">List[(String, String)]</span><a id="526">List</a></span>[(String, String)] = {
      <span class="keyword">val</span> <span class="typed"><span class="type">Array[String]</span><a id="153725">segs</a></span> = <span class="typed"><span class="type">implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString</span><span id="6140"><a href="#153724" id="821">s</a></span></span>.<span class="typed"><span class="type">(Char)Array[String]</span><a id="22850">split</a></span>(<span class="typed"><span class="type">Char('.')</span><span class="char">'.'</span></span>)
      <span class="keyword">for</span> (<span class="typed"><span class="type">((Int) =&gt; (String, String))List[(String, String)]</span><span id="21362"><a id="153758">i</a></span></span> &lt;- <span class="typed"><span class="type">object List</span><a id="527">List</a></span>.<span class="typed"><span class="type">(Int,Int)List[Int]</span><a id="21412">range</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Array[String]</span><a href="#153725">segs</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)) <span class="keyword">yield</span> {
        <span class="keyword">val</span> <span class="typed"><span class="type">String</span><a id="153759">k</a></span> = <span class="typed"><span class="type">Array[String]</span><a href="#153725">segs</a></span>.<span class="typed"><span class="type">(Int)Array.Projection[String]</span><a id="21491">take</a></span>(<span class="typed"><span class="type">Int</span><a href="#153758">i</a></span><span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span><span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>).<span class="typed"><span class="type">(String)String</span><a id="21819">mkString</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;.&quot;)</span><span class="string">&quot;.&quot;</span></span>)
        <span class="keyword">val</span> <span class="typed"><span class="type">String</span><a id="153760">v</a></span> = <span class="typed"><span class="type">(Int)String</span><a href="#153725" id="21509">segs</a></span>(<span class="typed"><span class="type">Int</span><a href="#153758">i</a></span><span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span><span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)
        (<span class="typed"><span class="type">(String)ArrowAssoc[String]</span><span id="6054"><a href="#153759" id="821">k</a></span></span> <span class="typed"><span class="type">(String)(String, String)</span><a id="6050">-&gt;</a></span> <span class="typed"><span class="type">String</span><a href="#153760">v</a></span>)
      }
    }
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="153700">oneJar</a></span>(<span class="typed"><span class="type">String</span><a id="153809">jar</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Unit</span><a id="2169">Unit</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">List[java.lang.String]</span><a id="153810">classfiles</a></span> = <span class="typed"><span class="type">object scala.tools.nsc.interpreter.Completion</span><a href="#17676">Completion</a></span>.<span class="typed"><span class="type">(String)List[String]</span><a href="#148114">getClassFiles</a></span>(<span class="typed"><span class="type">String</span><a href="#153809">jar</a></span>).<span class="typed"><span class="type">((String) =&gt; java.lang.String)List[java.lang.String]</span><a id="21362">map</a></span>(<span class="typed"><span class="type">String</span><a href="#153814">_</a></span>.<span class="typed"><span class="type">(Char,Char)java.lang.String</span><a id="5858">replace</a></span>(<span class="typed"><span class="type">Char('/')</span><span class="char">'/'</span></span>, <span class="typed"><span class="type">Char('.')</span><span class="char">'.'</span></span>))
      <span class="keyword">for</span> (<span class="typed"><span class="type">((java.lang.String) =&gt; Unit)Unit</span><span id="21366"><a id="153817">cl</a></span></span> &lt;- <span class="typed"><span class="type">List[java.lang.String]</span><a href="#153810">classfiles</a></span>; <span class="typed"><span class="type">(((String, String)) =&gt; Unit)Unit</span><span id="21366"><a href="#153820" id="21367">(</a></span></span><span class="typed"><span class="type">String</span><span id="153821"><a id="153826">k</a></span></span>, <span class="typed"><span class="type">String</span><span id="153822"><a id="153827">v</a></span></span>) &lt;- <span class="typed"><span class="type">(String)List[(String, String)]</span><a href="#153699">subpaths</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#153817">cl</a></span>)) {
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a href="#153337">map</a></span> <span class="typed"><span class="type">(Any)Boolean</span><a id="153297">containsKey</a></span> <span class="typed"><span class="type">String</span><a href="#153826">k</a></span>) <span class="typed"><span class="type">java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a href="#153337">map</a></span>.<span class="typed"><span class="type">(String,List[String])List[String]</span><a id="153300">put</a></span>(<span class="typed"><span class="type">String</span><a href="#153826">k</a></span>, <span class="typed"><span class="type">String</span><a href="#153827">v</a></span> <span class="typed"><span class="type">(String)List[String]</span><a href="#153828" id="21335">::</a></span> <span class="typed"><span class="type">java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a href="#153337">map</a></span>.<span class="typed"><span class="type">(Any)List[String]</span><a id="153296">get</a></span>(<span class="typed"><span class="type">String</span><a href="#153826">k</a></span>))
        <span class="keyword">else</span> <span class="typed"><span class="type">java.util.concurrent.ConcurrentHashMap[String,List[String]]</span><a href="#153337">map</a></span>.<span class="typed"><span class="type">(String,List[String])List[String]</span><a id="153300">put</a></span>(<span class="typed"><span class="type">String</span><a href="#153826">k</a></span>, <span class="typed"><span class="type">(String*)List[String]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">String</span><a href="#153827">v</a></span>))
      }
    }
    
    <span class="typed"><span class="type">List[String]</span><a href="#153698">jars</a></span> <span class="typed"><span class="type">((String) =&gt; Unit)Unit</span><a id="21366">foreach</a></span> <span class="typed"><span class="type">(String)Unit</span><a href="#153700">oneJar</a></span>
  }
}
        </pre>
    </body>
</html>