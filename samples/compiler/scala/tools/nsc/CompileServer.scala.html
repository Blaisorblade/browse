<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/CompileServer.scala</title>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */</span>
<span class="comment">// $Id: CompileServer.scala 17274 2009-03-10 11:39:04Z michelou $</span>

<span class="keyword">package</span> scala.tools.nsc

<span class="keyword">import</span> java.io.{BufferedOutputStream, File, FileOutputStream, PrintStream}
<span class="keyword">import</span> java.lang.{Runtime, System, Thread}

<span class="keyword">import</span> scala.concurrent.ops.spawn
<span class="keyword">import</span> scala.tools.nsc.doc.{DocDriver =&gt; DocGenerator}
<span class="keyword">import</span> scala.tools.nsc.reporters.{Reporter, ConsoleReporter}
<span class="keyword">import</span> scala.tools.nsc.util.FakePos <span class="comment">//Position</span>
<span class="keyword">import</span> scala.tools.util.SocketServer

<span class="comment">/** 
 *  The server part of the fsc offline compiler.  It awaits compilation
 *  commands and executes them.  It caches a compiler instance so
 *  that it can respond more quickly.
 *
 *  @author Martin Odersky
 *  @version 1.0
 */</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class StandardCompileServer extends scala.tools.util.SocketServer with ScalaObject</span><a id="7314">StandardCompileServer</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.util.SocketServer</span><a href="../util/SocketServer.scala.html#13954">SocketServer</a></span> {
  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; scala.tools.nsc.CompileSocket</span><a id="134933">compileSocket</a></span>: <span class="typed"><span class="type">scala.tools.nsc.CompileSocket</span><a href="CompileSocket.scala.html#6852">CompileSocket</a></span> = <span class="typed"><span class="type">object scala.tools.nsc.CompileSocket</span><a href="CompileSocket.scala.html#6853">CompileSocket</a></span> <span class="comment">// todo: make this a lazy val</span>

  <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><span id="134935"><a id="134934">versionMsg</a></span></span> = <span class="typed"><span class="type">java.lang.String(&quot;Fast Scala compiler &quot;)</span><span class="string">&quot;Fast Scala compiler &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
    <span class="typed"><span class="type">object scala.tools.nsc.Properties</span><a href="Properties.scala.html#7366">Properties</a></span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a id="46629">versionString</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; -- &quot;)</span><span class="string">&quot; -- &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
    <span class="typed"><span class="type">object scala.tools.nsc.Properties</span><a href="Properties.scala.html#7366">Properties</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="46631">copyrightString</a></span>

  <span class="keyword">val</span> <span class="typed"><span class="type">Double</span><span id="134937"><a id="134936">MaxCharge</a></span></span> = <span class="typed"><span class="type">Double(0.8)</span><span class="double">0.8</span></span>

  <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="134940"><span id="134938"><span id="134939"><a id="134960">shutDown</a></span></span></span></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>

  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><span id="134943"><span id="134941"><span id="134942"><a id="134961">compiler</a></span></span></span></span>: <span class="typed"><span class="type">scala.tools.nsc.Global</span><a href="Global.scala.html#6489">Global</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>

  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.Settings,scala.tools.nsc.Settings)Boolean</span><a id="134944">settingsAreCompatible</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="134979">s1</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>, <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="134980">s2</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>) = <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#134979">s1</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#134980">s2</a></span>

  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Nothing</span><a id="134945">exit</a></span>(<span class="typed"><span class="type">Int</span><a id="134983">code</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>): <span class="typed"><span class="type">Nothing</span><a id="2167">Nothing</a></span> = {
    <span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="47437">err</a></span>.<span class="typed"><span class="type">()Unit</span><a id="27089">close</a></span>()
    <span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="47436">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="27089">close</a></span>()
    <span class="typed"><span class="type">object Predef</span><a id="821">Predef</a></span>.<span class="typed"><span class="type">(Int)Nothing</span><a id="6002">exit</a></span>(<span class="typed"><span class="type">Int</span><a href="#134983">code</a></span>)
  }

  <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.Runtime</span><span id="134947"><a id="134946">runtime</a></span></span> = <span class="typed"><span class="type">object java.lang.Runtime</span><a id="1751">Runtime</a></span>.<span class="typed"><span class="type">()java.lang.Runtime</span><a id="67890">getRuntime</a></span>()

  <span class="keyword">var</span> <span class="typed"><span class="type">scala.tools.nsc.reporters.ConsoleReporter</span><span id="134950"><span id="134948"><span id="134949"><a id="134962">reporter</a></span></span></span></span>: <span class="typed"><span class="type">scala.tools.nsc.reporters.ConsoleReporter</span><a href="reporters/ConsoleReporter.scala.html#15935">ConsoleReporter</a></span> = _

  <span class="comment">/** Create a new compiler instance */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.Settings,scala.tools.nsc.reporters.Reporter)scala.tools.nsc.Global</span><a id="134951">newGlobal</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="134985">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>, <span class="typed"><span class="type">scala.tools.nsc.reporters.Reporter</span><a id="134986">reporter</a></span>: <span class="typed"><span class="type">scala.tools.nsc.reporters.Reporter</span><a href="reporters/Reporter.scala.html#15905">Reporter</a></span>) =
    <span class="typed"><span class="type">template $anon extends scala.tools.nsc.Global</span><a id="134988" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><a href="Global.scala.html#6489">Global</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#134985">settings</a></span>, <span class="typed"><span class="type">scala.tools.nsc.reporters.Reporter</span><a href="#134986">reporter</a></span>) {
      <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="134990">inform</a></span>(<span class="typed"><span class="type">String</span><a id="135004">msg</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">=&gt; java.io.PrintWriter</span><a href="../util/SocketServer.scala.html#47113">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">String</span><a href="#135004">msg</a></span>)
    }

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="134952">timeout</a></span>() {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; scala.tools.nsc.CompileSocket</span><a href="#134933">compileSocket</a></span>.<span class="typed"><span class="type">(Int)java.io.File</span><a href="CompileSocket.scala.html#67467">portFile</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="../util/SocketServer.scala.html#47124">port</a></span>).<span class="typed"><span class="type">()Boolean</span><a id="40697">exists</a></span>())
      <span class="typed"><span class="type">(String)Nothing</span><a href="../util/SocketServer.scala.html#47119">fatal</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;port file no longer exists; skipping cleanup&quot;)</span><span class="string">&quot;port file no longer exists; skipping cleanup&quot;</span></span>)
  }

  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(List[String],scala.tools.nsc.Settings,(String) =&gt; Unit,Boolean)scala.tools.nsc.OfflineCompilerCommand</span><a id="134953">newOfflineCompilerCommand</a></span>(
    <span class="typed"><span class="type">List[String]</span><a id="135015">arguments</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String],
    <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="135016">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>,
    <span class="typed"><span class="type">(String) =&gt; Unit</span><a id="135017">error</a></span>: String =&gt; Unit, 
    <span class="typed"><span class="type">Boolean</span><a id="135018">interactive</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span>) 
  = <span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="OfflineCompilerCommand.scala.html#6633">OfflineCompilerCommand</a></span>(<span class="typed"><span class="type">List[String]</span><a href="#135015">arguments</a></span>, <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#135016">settings</a></span>, <span class="typed"><span class="type">(String) =&gt; Unit</span><a href="#135017">error</a></span>, <span class="typed"><span class="type">Boolean</span><a href="#135018">interactive</a></span>)

  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="134954">session</a></span>() {
    <span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="47436">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="27111">println</a></span>(<span class="string">&quot;New session&quot;</span> <span class="typed"><span class="type">java.lang.String(&quot;New session, total memory = &quot;)</span><span >+</span></span>
                       <span class="string">&quot;, total memory = &quot;</span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; java.lang.Runtime</span><a href="#134946">runtime</a></span>.<span class="typed"><span class="type">()Long</span><a id="67904">totalMemory</a></span>() <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
                       <span class="typed"><span class="type">java.lang.String(&quot;, max memory = &quot;)</span><span class="string">&quot;, max memory = &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; java.lang.Runtime</span><a href="#134946">runtime</a></span>.<span class="typed"><span class="type">()Long</span><a id="67905">maxMemory</a></span>() <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
                       <span class="typed"><span class="type">java.lang.String(&quot;, free memory = &quot;)</span><span class="string">&quot;, free memory = &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; java.lang.Runtime</span><a href="#134946">runtime</a></span>.<span class="typed"><span class="type">()Long</span><a id="67903">freeMemory</a></span>)
    <span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="47436">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="27088">flush</a></span>()
    <span class="keyword">val</span> <span class="typed"><span class="type">String</span><a id="135020">password</a></span> = <span class="typed"><span class="type">=&gt; scala.tools.nsc.CompileSocket</span><a href="#134933">compileSocket</a></span>.<span class="typed"><span class="type">(Int)String</span><a href="CompileSocket.scala.html#67476">getPassword</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="../util/SocketServer.scala.html#47124">port</a></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="135021">guessedPassword</a></span> = <span class="typed"><span class="type">=&gt; java.io.BufferedReader</span><a href="../util/SocketServer.scala.html#47116">in</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="46779">readLine</a></span>()
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="135022">input</a></span> = <span class="typed"><span class="type">=&gt; java.io.BufferedReader</span><a href="../util/SocketServer.scala.html#47116">in</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="46779">readLine</a></span>()
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> ((<span class="typed"><span class="type">java.lang.String</span><a href="#135022">input</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5795">ne</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">String</span><a href="#135020">password</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#135021">guessedPassword</a></span>) {
      <span class="keyword">val</span> <span class="typed"><span class="type">List[java.lang.String]</span><a id="135028">args</a></span> = <span class="typed"><span class="type">java.lang.String</span><a href="#135022">input</a></span>.<span class="typed"><span class="type">(java.lang.String,Int)Array[java.lang.String]</span><a id="5864">split</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;\00&quot;)</span><span class="string">&quot;\0&quot;</span></span>,-<span class="typed"><span class="type">Int(-1)</span><span class="int">1</span></span>).<span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a id="21815">toList</a></span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[java.lang.String]</span><a href="#135028">args</a></span> <span class="typed"><span class="type">(Any)Boolean</span><a id="21673">contains</a></span> <span class="typed"><span class="type">java.lang.String(&quot;-shutdown&quot;)</span><span class="string">&quot;-shutdown&quot;</span></span>) {
        <span class="typed"><span class="type">=&gt; java.io.PrintWriter</span><a href="../util/SocketServer.scala.html#47113">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;[Compile server exited]&quot;)</span><span class="string">&quot;[Compile server exited]&quot;</span></span>)
        <span class="typed"><span class="type">(Boolean)Unit</span><a href="#134939">shutDown</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
        <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span>
      }
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[java.lang.String]</span><a href="#135028">args</a></span> <span class="typed"><span class="type">(Any)Boolean</span><a id="21673">contains</a></span> <span class="typed"><span class="type">java.lang.String(&quot;-reset&quot;)</span><span class="string">&quot;-reset&quot;</span></span>) {
        <span class="typed"><span class="type">=&gt; java.io.PrintWriter</span><a href="../util/SocketServer.scala.html#47113">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;[Compile server was reset]&quot;)</span><span class="string">&quot;[Compile server was reset]&quot;</span></span>)
        <span class="typed"><span class="type">(scala.tools.nsc.Global)Unit</span><a href="#134942">compiler</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
        <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span>
      }
      <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="135029">error</a></span>(<span class="typed"><span class="type">String</span><a id="135043">msg</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) {
        <span class="typed"><span class="type">=&gt; java.io.PrintWriter</span><a href="../util/SocketServer.scala.html#47113">out</a></span>.<span class="typed"><span class="type">(Any)Unit</span><span id="28712"><span id="23625"><a id="1379">println</a></span></span></span>(<span class="comment">/*new Position*/</span> <span class="typed"><span class="type">(String)scala.tools.nsc.util.FakePos</span><a href="util/Position.scala.html#53133">FakePos</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;fsc&quot;)</span><span class="string">&quot;fsc&quot;</span></span>),
                    <span class="typed"><span class="type">String</span><a href="#135043">msg</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;\012  fsc -help  gives more information&quot;)</span><span class="string">&quot;\n  fsc -help  gives more information&quot;</span></span>)
      }
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a id="135030">command</a></span> = <span class="typed"><span class="type">(List[String],scala.tools.nsc.Settings,(String) =&gt; Unit,Boolean)scala.tools.nsc.OfflineCompilerCommand</span><a href="#134953">newOfflineCompilerCommand</a></span>(<span class="typed"><span class="type">List[java.lang.String]</span><a href="#135028">args</a></span>, <span class="typed"><span class="type">scala.tools.nsc.Settings</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>(<span class="typed"><span class="type">(String)Unit</span><a href="#135029">error</a></span>), <span class="typed"><span class="type">(String)Unit</span><a href="#135029">error</a></span>, <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>)
      
      <span class="typed"><span class="type">(scala.tools.nsc.reporters.ConsoleReporter)Unit</span><a href="#134949">reporter</a></span> = <span class="typed"><span class="type">template $anon extends scala.tools.nsc.reporters.ConsoleReporter</span><a id="135108" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.reporters.ConsoleReporter</span><a href="reporters/ConsoleReporter.scala.html#15935">ConsoleReporter</a></span>(<span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="CompilerCommand.scala.html#53159">settings</a></span>, <span class="typed"><span class="type">=&gt; java.io.BufferedReader</span><a href="../util/SocketServer.scala.html#47116">in</a></span>, <span class="typed"><span class="type">=&gt; java.io.PrintWriter</span><a href="../util/SocketServer.scala.html#47113">out</a></span>) {
        <span class="comment">// disable prompts, so that compile server cannot block</span>
        <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Unit</span><a id="135110">displayPrompt</a></span> = <span class="typed"><span class="type">Unit</span><span >(</span></span>)
      }
      
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="CompilerCommand.scala.html#53183">shouldStopWithInfo</a></span>) {
        <span class="typed"><span class="type">=&gt; scala.tools.nsc.reporters.ConsoleReporter</span><a href="#134948">reporter</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.util.Position,String,Boolean)Unit</span><a href="reporters/Reporter.scala.html#34468">info</a></span>(<span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>,
                        <span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.Global)String</span><a href="CompilerCommand.scala.html#53184">getInfoMessage</a></span>(<span class="typed"><span class="type">(scala.tools.nsc.Settings,scala.tools.nsc.reporters.Reporter)scala.tools.nsc.Global</span><a href="#134951">newGlobal</a></span>(<span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="CompilerCommand.scala.html#53159">settings</a></span>, <span class="typed"><span class="type">=&gt; scala.tools.nsc.reporters.ConsoleReporter</span><a href="#134948">reporter</a></span>)), <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>)
        } <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; List[String]</span><a href="CompilerCommand.scala.html#53171">files</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="21645">isEmpty</a></span>)
            <span class="typed"><span class="type">=&gt; scala.tools.nsc.reporters.ConsoleReporter</span><a href="#134948">reporter</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.util.Position,String,Boolean)Unit</span><a href="reporters/Reporter.scala.html#34468">info</a></span>(<span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>, <span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="CompilerCommand.scala.html#53178">usageMsg</a></span>, <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>)
          <span class="keyword">else</span> {
            <span class="keyword">try</span> {
              <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> ((<span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#134941">compiler</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5795">ne</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">(scala.tools.nsc.Settings,scala.tools.nsc.Settings)Boolean</span><a href="#134944">settingsAreCompatible</a></span>(<span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="CompilerCommand.scala.html#53159">settings</a></span>, <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#134941">compiler</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="Global.scala.html#21157">settings</a></span>)) {
                <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#134941">compiler</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.Settings)Unit</span><a href="Global.scala.html#21158">settings</a></span> = <span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="CompilerCommand.scala.html#53159">settings</a></span>
                <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#134941">compiler</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.reporters.Reporter)Unit</span><a href="Global.scala.html#21161">reporter</a></span> = <span class="typed"><span class="type">=&gt; scala.tools.nsc.reporters.ConsoleReporter</span><a href="#134948">reporter</a></span>
              } <span class="keyword">else</span> {
                <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[java.lang.String]</span><a href="#135028">args</a></span> <span class="typed"><span class="type">(Any)Boolean</span><a id="21673">contains</a></span> <span class="typed"><span class="type">java.lang.String(&quot;-verbose&quot;)</span><span class="string">&quot;-verbose&quot;</span></span>)
                  <span class="typed"><span class="type">=&gt; java.io.PrintWriter</span><a href="../util/SocketServer.scala.html#47113">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;[Starting new compile server instance]&quot;)</span><span class="string">&quot;[Starting new compile server instance]&quot;</span></span>)
                <span class="typed"><span class="type">(scala.tools.nsc.Global)Unit</span><a href="#134942">compiler</a></span> = <span class="typed"><span class="type">(scala.tools.nsc.Settings,scala.tools.nsc.reporters.Reporter)scala.tools.nsc.Global</span><a href="#134951">newGlobal</a></span>(<span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="CompilerCommand.scala.html#53159">settings</a></span>, <span class="typed"><span class="type">=&gt; scala.tools.nsc.reporters.ConsoleReporter</span><a href="#134948">reporter</a></span>)
              }
              <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><a id="135123">c</a></span> = <span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#134941">compiler</a></span>
              <span class="keyword">val</span> <span class="typed"><span class="type">c.Run</span><a id="135124">run</a></span> = <span class="typed"><span class="type">c.Run</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><a href="#135123">c</a></span>.<span class="typed"><span class="type">c.Run</span><a href="Global.scala.html#21313">Run</a></span>
              <span class="typed"><span class="type">c.Run</span><a href="#135124">run</a></span> <span class="typed"><span class="type">(List[String])Unit</span><a href="Global.scala.html#36590">compile</a></span> <span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; List[String]</span><a href="CompilerCommand.scala.html#53171">files</a></span>
            } <span class="keyword">catch</span> {
              <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><a id="135129">ex</a></span> @ <a id="1">FatalError</a>(<span class="typed"><span class="type">String</span><a id="135130">msg</a></span>) =&gt;
                <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.OfflineCompilerCommand</span><a href="#135030">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="CompilerCommand.scala.html#53159">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="Settings.scala.html#30066">debug</a></span>.<span class="typed"><span class="type">=&gt; command.settings.debug.T</span><a href="Settings.scala.html#30301">value</a></span>)
                  <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><a href="#135129">ex</a></span>.<span class="typed"><span class="type">(java.io.PrintWriter)Unit</span><a id="23653">printStackTrace</a></span>(<span class="typed"><span class="type">=&gt; java.io.PrintWriter</span><a href="../util/SocketServer.scala.html#47113">out</a></span>);
              <span class="typed"><span class="type">=&gt; scala.tools.nsc.reporters.ConsoleReporter</span><a href="#134948">reporter</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.util.Position,String)Unit</span><a href="reporters/Reporter.scala.html#34470">error</a></span>(<span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;fatal error: &quot;)</span><span class="string">&quot;fatal error: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#135130">msg</a></span>)
              <span class="typed"><span class="type">(scala.tools.nsc.Global)Unit</span><a href="#134942">compiler</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
              <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="135133">ex</a></span>: <span class="typed"><span class="type">Throwable</span><a id="2143">Throwable</a></span> =&gt;
                <span class="typed"><span class="type">java.lang.Throwable</span><a href="#135133">ex</a></span>.<span class="typed"><span class="type">(java.io.PrintWriter)Unit</span><a id="23653">printStackTrace</a></span>(<span class="typed"><span class="type">=&gt; java.io.PrintWriter</span><a href="../util/SocketServer.scala.html#47113">out</a></span>);
              <span class="typed"><span class="type">=&gt; scala.tools.nsc.reporters.ConsoleReporter</span><a href="#134948">reporter</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.util.Position,String)Unit</span><a href="reporters/Reporter.scala.html#34470">error</a></span>(<span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;fatal error (server aborted): &quot;)</span><span class="string">&quot;fatal error (server aborted): &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="#135133">ex</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="23646">getMessage</a></span>())
              <span class="typed"><span class="type">(Boolean)Unit</span><a href="#134939">shutDown</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
            }
            <span class="typed"><span class="type">=&gt; scala.tools.nsc.reporters.ConsoleReporter</span><a href="#134948">reporter</a></span>.<span class="typed"><span class="type">()Unit</span><a href="reporters/ConsoleReporter.scala.html#46765">printSummary</a></span>()
            <span class="typed"><span class="type">=&gt; java.lang.Runtime</span><a href="#134946">runtime</a></span>.<span class="typed"><span class="type">()Unit</span><a id="67906">gc</a></span>()
            <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> ((<span class="typed"><span class="type">=&gt; java.lang.Runtime</span><a href="#134946">runtime</a></span>.<span class="typed"><span class="type">()Long</span><a id="67904">totalMemory</a></span>() <span class="typed"><span class="type">(Long)Long</span><a id="3271">-</a></span> <span class="typed"><span class="type">=&gt; java.lang.Runtime</span><a href="#134946">runtime</a></span>.<span class="typed"><span class="type">()Long</span><a id="67903">freeMemory</a></span>()).<span class="typed"><span class="type">=&gt; Double</span><a id="3197">toDouble</a></span> <span class="typed"><span class="type">(Double)Double</span><a id="3472">/</a></span> 
                <span class="typed"><span class="type">=&gt; java.lang.Runtime</span><a href="#134946">runtime</a></span>.<span class="typed"><span class="type">()Long</span><a id="67905">maxMemory</a></span>().<span class="typed"><span class="type">=&gt; Double</span><a id="3197">toDouble</a></span> <span class="typed"><span class="type">(Double)Boolean</span><a id="3467">&gt;</a></span> <span class="typed"><span class="type">=&gt; Double</span><a href="#134936">MaxCharge</a></span>) <span class="typed"><span class="type">(scala.tools.nsc.Global)Unit</span><a href="#134942">compiler</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
          }
    }
  }
  
  <span class="comment">/** A directory holding redirected output */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><span id="134956"><a id="134955">redirectDir</a></span></span> = <span class="typed"><span class="type">(java.io.File,java.lang.String)java.io.File</span><a id="40682" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">=&gt; scala.tools.nsc.CompileSocket</span><a href="#134933">compileSocket</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a href="CompileSocket.scala.html#67457">tmpDir</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;output-redirects&quot;)</span><span class="string">&quot;output-redirects&quot;</span></span>)
  <span class="typed"><span class="type">=&gt; java.io.File</span><a href="#134955">redirectDir</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40712">mkdirs</a></span>

  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">((java.io.PrintStream) =&gt; Unit,String)Unit</span><a id="134957">redirect</a></span>(<span class="typed"><span class="type">(java.io.PrintStream) =&gt; Unit</span><a id="135139">setter</a></span>: PrintStream =&gt; Unit, <span class="typed"><span class="type">String</span><a id="135140">filename</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) {
    <span class="typed"><span class="type">(java.io.PrintStream)Unit</span><a href="#135139" id="21757">setter</a></span>(
      <span class="typed"><span class="type">java.io.PrintStream</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.PrintStream</span><a id="3852">PrintStream</a></span>(
        <span class="typed"><span class="type">java.io.BufferedOutputStream</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.BufferedOutputStream</span><a id="3729">BufferedOutputStream</a></span>(
          <span class="typed"><span class="type">(java.io.File)java.io.FileOutputStream</span><a id="48703" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileOutputStream</span><a id="3798">FileOutputStream</a></span>(
            <span class="typed"><span class="type">(java.io.File,java.lang.String)java.io.File</span><a id="40682" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">=&gt; java.io.File</span><a href="#134955">redirectDir</a></span>, <span class="typed"><span class="type">String</span><a href="#135140">filename</a></span>)))))
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(Array[String])Unit</span><a id="134958">main</a></span>(<span class="typed"><span class="type">Array[String]</span><a id="135160">args</a></span>: <span class="typed"><span class="type">Array[String]</span><a id="1072">Array</a></span>[String]) {
    <span class="typed"><span class="type">((java.io.PrintStream) =&gt; Unit,String)Unit</span><a href="#134957">redirect</a></span>(<span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">(java.io.PrintStream)Unit</span><a href="#135162" id="47439">setOut</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;scala-compile-server-out.log&quot;)</span><span class="string">&quot;scala-compile-server-out.log&quot;</span></span>)
    <span class="typed"><span class="type">((java.io.PrintStream) =&gt; Unit,String)Unit</span><a href="#134957">redirect</a></span>(<span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">(java.io.PrintStream)Unit</span><a href="#135164" id="47440">setErr</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;scala-compile-server-err.log&quot;)</span><span class="string">&quot;scala-compile-server-err.log&quot;</span></span>)
    <span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="47437">err</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="27111">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;...starting server on socket &quot;)</span><span class="string">&quot;...starting server on socket &quot;</span></span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span><span class="typed"><span class="type">=&gt; Int</span><a href="../util/SocketServer.scala.html#47124">port</a></span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span><span class="typed"><span class="type">java.lang.String(&quot;...&quot;)</span><span class="string">&quot;...&quot;</span></span>)
    <span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="47437">err</a></span>.<span class="typed"><span class="type">()Unit</span><a id="27088">flush</a></span>()
    <span class="typed"><span class="type">=&gt; scala.tools.nsc.CompileSocket</span><a href="#134933">compileSocket</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a href="CompileSocket.scala.html#67470">setPort</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="../util/SocketServer.scala.html#47124">port</a></span>)
    <span class="typed"><span class="type">()Unit</span><a href="../util/SocketServer.scala.html#47126">run</a></span>()
    <span class="typed"><span class="type">=&gt; scala.tools.nsc.CompileSocket</span><a href="#134933">compileSocket</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a href="CompileSocket.scala.html#67471">deletePort</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="../util/SocketServer.scala.html#47124">port</a></span>)
    <span class="typed"><span class="type">(Int)Nothing</span><a href="#134945">exit</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
  }
}


<span class="keyword">object</span> <span class="typed"><span class="type">object scala.tools.nsc.CompileServer</span><a id="6370">CompileServer</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.StandardCompileServer</span><a href="#7314">StandardCompileServer</a></span>

        </pre>
    </body>
</html>