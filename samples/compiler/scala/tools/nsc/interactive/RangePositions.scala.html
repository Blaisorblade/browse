<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/interactive/RangePositions.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interactive

<span class="keyword">import</span> ast.Trees
<span class="keyword">import</span> symtab.Positions
<span class="keyword">import</span> scala.tools.nsc.util.{SourceFile, Position, RangePosition, OffsetPosition, NoPosition, WorkScheduler}
<span class="keyword">import</span> scala.collection.mutable.ListBuffer

/** Handling range positions
 *  atPos, the main method in this trait, will add positions to a tree,
 *  and will ensure the following properties:
 *
 *    1. All nodes between the root of the tree and nodes that already have positions
 *       will be assigned positions.
 *    2. No node which already has a position will be assigned a different range; however
 *       a RangePosition might become a TransparentPosition.
 *    3. The position of each assigned node includes the positions of each of its children.
 *    4. The positions of all solid descendants of children of an assigned node
 *       are mutually non-overlapping.
 *
 * Here, the solid descendant of a node are:
 *
 *   If the node has a TransparentPosition, the solid descendants of all its children
 *   Otherwise, the singleton consisting of the node itself.
 */
<span class="keyword">trait</span> <a title="trait RangePositions extends java.lang.Object with scala.tools.nsc.ast.Trees with scala.tools.nsc.symtab.Positions with ScalaObject" id="18587">RangePositions</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../ast/Trees.scala.html#12141" title="scala.tools.nsc.ast.Trees">Trees</a> <span class="keyword">with</span> <a href="../symtab/Positions.scala.html#9902" title="scala.tools.nsc.symtab.Positions">Positions</a> { 
self: scala.tools.nsc.Global =&gt;

  case <span class="keyword">class</span> <a title="class Range extends java.lang.Object with ScalaObject with Product" id="68354">Range</a><span title="ScalaObject">(</span><a title="scala.tools.nsc.util.Position" id="69754">pos</a>: <a href="../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a>, <a title="RangePositions.this.Tree" id="69755">tree</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>) {
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="68312">isFree</a> = <a href="#69755" title="(x$1: AnyRef)Boolean">tree</a> == <a href="../ast/Trees.scala.html#26761" title="object RangePositions.this.EmptyTree">EmptyTree</a>
  }

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile,start: Int,point: Int,end: Int)scala.tools.nsc.util.RangePosition" id="68281">rangePos</a>(<a title="scala.tools.nsc.util.SourceFile" id="68408">source</a>: <a href="../util/SourceFile.scala.html#14788" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Int" id="68409">start</a>: <span title="Int">Int</span>, <a title="Int" id="68410">point</a>: <span title="Int">Int</span>, <a title="Int" id="68411">end</a>: <span title="Int">Int</span>) = 
    <span title="scala.tools.nsc.util.RangePosition" class="keyword">new</span> <a href="../util/Position.scala.html#14797" title="scala.tools.nsc.util.RangePosition">RangePosition</a>(<a href="#68408" title="scala.tools.nsc.util.SourceFile">source</a>, <a href="#68409" title="Int">start</a>, <a href="#68410" title="Int">point</a>, <a href="#68411" title="Int">end</a>)

  /** A position that wraps a set of trees.
   *  The point of the wrapping position is the point of the default position.
   *  If some of the trees are ranges, returns a range position enclosing all ranges
   *  Otherwise returns default position.
   */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(default: scala.tools.nsc.util.Position,trees: List[RangePositions.this.Tree])scala.tools.nsc.util.Position" id="68282">wrappingPos</a>(<a title="scala.tools.nsc.util.Position" id="68494">default</a>: <a href="../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a>, <a title="List[RangePositions.this.Tree]" id="68495">trees</a>: <span title="List[RangePositions.this.Tree]">List</span>[Tree]): <a href="../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a> = {
    <span class="keyword">val</span> <a title="List[RangePositions.this.Tree]" id="68506">ranged</a> = <a href="#68495" title="(p: (RangePositions.this.Tree) =&gt; Boolean)List[RangePositions.this.Tree]">trees</a> filter (<a href="#68509" title="RangePositions.this.Tree">_</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30467" title="=&gt; Boolean">isRange</a>)
    <span title="scala.tools.nsc.util.Position" class="keyword">if</span> (<a href="#68506" title="List[RangePositions.this.Tree]">ranged</a>.<span title="=&gt; Boolean">isEmpty</span>) <a href="#68494" title="scala.tools.nsc.util.Position">default</a>.<a href="../util/Position.scala.html#30482" title="=&gt; scala.tools.nsc.util.Position">focus</a>
    <span class="keyword">else</span> <span title="scala.tools.nsc.util.RangePosition" class="keyword">new</span> <a href="../util/Position.scala.html#14797" title="scala.tools.nsc.util.RangePosition">RangePosition</a>(<a href="#68494" title="scala.tools.nsc.util.Position">default</a>.<a href="../util/Position.scala.html#30464" title="=&gt; scala.tools.nsc.util.SourceFile">source</a>, (<a href="#68506" title="(f: (RangePositions.this.Tree) =&gt; Int)(implicit bf: scala.collection.generic.BuilderFactory[Int,List[Int],List[RangePositions.this.Tree]])List[Int]">ranged</a> <span title="scala.collection.generic.BuilderFactory[Int,List[Int],List#Coll]">map</span> (<a href="#68527" title="RangePositions.this.Tree">_</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30470" title="=&gt; Int">start</a>)).<a title="(implicit cmp: Ordering[Int])Int" id="25385">min</a>, <a href="#68494" title="scala.tools.nsc.util.Position">default</a>.<a href="../util/Position.scala.html#30472" title="=&gt; Int">point</a>, (<a href="#68506" title="(f: (RangePositions.this.Tree) =&gt; Int)(implicit bf: scala.collection.generic.BuilderFactory[Int,List[Int],List[RangePositions.this.Tree]])List[Int]">ranged</a> <span title="scala.collection.generic.BuilderFactory[Int,List[Int],List#Coll]">map</span> (<a href="#69558" title="RangePositions.this.Tree">_</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30474" title="=&gt; Int">end</a>)).<a title="(implicit cmp: Ordering[Int])Int" id="25388">max</a>)
  }

  /** A position that wraps a non-empty set of trees.
   *  The point of the wrapping position is the point of the first trees' position.
   *  If some of the trees are ranges, returns a range position enclosing all ranges
   *  Otherwise returns first tree's position.
   */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(trees: List[RangePositions.this.Tree])scala.tools.nsc.util.Position" id="68283">wrappingPos</a>(<a title="List[RangePositions.this.Tree]" id="69651">trees</a>: <span title="List[RangePositions.this.Tree]">List</span>[Tree]): <a href="../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a> = {
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.Position" id="69657">headpos</a> = <a href="#69651" title="List[RangePositions.this.Tree]">trees</a>.<span title="=&gt; RangePositions.this.Tree">head</span>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>
    <span title="scala.tools.nsc.util.Position" class="keyword">if</span> (<a href="#69657" title="scala.tools.nsc.util.Position">headpos</a>.<a href="../util/Position.scala.html#30465" title="=&gt; Boolean">isDefined</a>) <a href="#68282" title="(default: scala.tools.nsc.util.Position,trees: List[RangePositions.this.Tree])scala.tools.nsc.util.Position">wrappingPos</a>(<a href="#69657" title="scala.tools.nsc.util.Position">headpos</a>, <a href="#69651" title="List[RangePositions.this.Tree]">trees</a>) <span class="keyword">else</span> <a href="#69657" title="scala.tools.nsc.util.Position">headpos</a>
  }

/*
  override def integratePos(tree: Tree, pos: Position) = 
    if (pos.isSynthetic &amp;&amp; !tree.pos.isSynthetic) tree.syntheticDuplicate 
    else tree
*/

  // -------------- ensuring no overlaps -------------------------------

  <span class="keyword">def</span> <a title="(tree: RangePositions.this.Tree)List[RangePositions.this.Tree]" id="68284">solidDescendants</a>(<a title="RangePositions.this.Tree" id="69701">tree</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>): <span title="List[RangePositions.this.Tree]">List</span>[Tree] = 
    <span title="List[RangePositions.this.Tree]" class="keyword">if</span> (<a href="#69701" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30466" title="=&gt; Boolean">isTransparent</a>) <a href="#69701" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29566" title="(f: (RangePositions.this.Tree) =&gt; Traversable[RangePositions.this.Tree])(implicit bf: scala.collection.generic.BuilderFactory[RangePositions.this.Tree,List[RangePositions.this.Tree],List[RangePositions.this.Tree]])List[RangePositions.this.Tree]">children</a> <span title="scala.collection.generic.BuilderFactory[RangePositions.this.Tree,List[RangePositions.this.Tree],List#Coll]">flatMap</span> <a href="#68284" title="(tree: RangePositions.this.Tree)List[RangePositions.this.Tree]">solidDescendants</a> 
    <span class="keyword">else</span> <span title="(xs: RangePositions.this.Tree*)List[RangePositions.this.Tree]">List</span>(<a href="#69701" title="RangePositions.this.Tree">tree</a>)

  /** A free range from `lo` to `hi` */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(lo: Int,hi: Int)RangePositions.this.Range" id="68285">free</a>(<a title="Int" id="69751">lo</a>: <span title="Int">Int</span>, <a title="Int" id="69752">hi</a>: <span title="Int">Int</span>): <a href="#68354" title="RangePositions.this.Range">Range</a> = 
    <a href="#68354" title="(pos: scala.tools.nsc.util.Position,tree: RangePositions.this.Tree)RangePositions.this.Range">Range</a>(<span title="scala.tools.nsc.util.RangePosition" class="keyword">new</span> <a href="../util/Position.scala.html#14797" title="scala.tools.nsc.util.RangePosition">RangePosition</a>(<span title="Null(null)" class="keyword">null</span>, <a href="#69751" title="Int">lo</a>, <a href="#69751" title="Int">lo</a>, <a href="#69752" title="Int">hi</a>), <a href="../ast/Trees.scala.html#26761" title="object RangePositions.this.EmptyTree">EmptyTree</a>)

  /** The maximal free range */
  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="RangePositions.this.Range" id="68287">maxFree</a>: <a href="#68354" title="RangePositions.this.Range">Range</a> = <a href="#68285" title="(lo: Int,hi: Int)RangePositions.this.Range">free</a>(<span title="Int(0)" class="int">0</span>, <a title="object Math" id="537">Math</a>.<a title="=&gt; Int" id="69786">MAX_INT</a>)

  /** A singleton list of a non-empty range from `lo` to `hi`, or else the empty List */ 
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(lo: Int,hi: Int)List[RangePositions.this.Range]" id="68288">maybeFree</a>(<a title="Int" id="70032">lo</a>: <span title="Int">Int</span>, <a title="Int" id="70033">hi</a>: <span title="Int">Int</span>) = 
    <span title="List[RangePositions.this.Range]" class="keyword">if</span> (<a href="#70032" title="(x$1: Int)Boolean" id="2977">lo</a> &lt; <a href="#70033" title="Int">hi</a>) <span title="(xs: RangePositions.this.Range*)List[RangePositions.this.Range]">List</span>(<a href="#68285" title="(lo: Int,hi: Int)RangePositions.this.Range">free</a>(<a href="#70032" title="Int">lo</a>, <a href="#70033" title="Int">hi</a>)) 
    <span class="keyword">else</span> List<span title="object Nil">(</span>)

  /** Insert `pos` into ranges `rs` if possible;
   *  otherwise add conflicting trees to `conflicting`.
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(rs: List[RangePositions.this.Range],t: RangePositions.this.Tree,conflicting: scala.collection.mutable.ListBuffer[RangePositions.this.Tree])List[RangePositions.this.Range]" id="68289">insert</a>(<a title="List[RangePositions.this.Range]" id="70062">rs</a>: <span title="List[RangePositions.this.Range]">List</span>[Range], <a title="RangePositions.this.Tree" id="70063">t</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>, <a title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]" id="70064">conflicting</a>: <span title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">ListBuffer</span>[Tree]): <span title="List[RangePositions.this.Range]">List</span>[Range] = <a href="#70062" title="List[RangePositions.this.Range]">rs</a> <span title="List[RangePositions.this.Range]" class="keyword">match</span> {
    <span title="List[RangePositions.this.Range]" class="keyword">case</span> <a href="#70067" title="(x: List[RangePositions.this.Range])Some[List[RangePositions.this.Range]]">List</a>() =&gt;
      <span title="(assertion: Boolean)Unit">assert</span>(<a href="#70064" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a>.<span title="=&gt; Boolean">nonEmpty</span>)
      <a href="#70062" title="List[RangePositions.this.Range]">rs</a>
    <span title="List[RangePositions.this.Range]" class="keyword">case</span> <a title="RangePositions.this.Range" id="70085">r</a> :: <a title="List[RangePositions.this.Range]" id="70086">rs1</a> =&gt;
      <span title="(assertion: Boolean)Unit">assert</span>(<span title="=&gt; Boolean">!</span><a href="#70063" title="RangePositions.this.Tree">t</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30466" title="=&gt; Boolean">isTransparent</a>)
      <span title="List[RangePositions.this.Range]" class="keyword">if</span> (<a href="#70085" title="RangePositions.this.Range">r</a>.<a href="#68312" title="(x$1: Boolean)Boolean">isFree</a> &amp;&amp; (<a href="#70085" title="RangePositions.this.Range">r</a>.<a href="../util/Position.scala.html#30484" title="(pos: scala.tools.nsc.util.Position)Boolean">pos</a> includes <a href="#70063" title="RangePositions.this.Tree">t</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>)) {
//      println(&quot;subdividing &quot;+r+&quot;/&quot;+t.pos)
        <a href="#68288" title="(lo: Int,hi: Int)List[RangePositions.this.Range]">maybeFree</a>(<a href="#70063" title="RangePositions.this.Tree">t</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30474" title="=&gt; Int">end</a>, <a href="#70085" title="RangePositions.this.Range">r</a>.<a href="#69754" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30474" title="=&gt; Int">end</a>) <a href="#70100" title="List[RangePositions.this.Range]">:::</a> <span title="(xs: RangePositions.this.Range*)List[RangePositions.this.Range]">List</span>(<a href="#68354" title="(pos: scala.tools.nsc.util.Position,tree: RangePositions.this.Tree)RangePositions.this.Range">Range</a>(<a href="#70063" title="RangePositions.this.Tree">t</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>, <a href="#70063" title="RangePositions.this.Tree">t</a>)) <a href="#70103" title="(prefix: List[RangePositions.this.Range])List[RangePositions.this.Range]">:::</a> <a href="#68288" title="(lo: Int,hi: Int)List[RangePositions.this.Range]">maybeFree</a>(<a href="#70085" title="RangePositions.this.Range">r</a>.<a href="#69754" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30470" title="=&gt; Int">start</a>, <a href="#70063" title="RangePositions.this.Tree">t</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30470" title="=&gt; Int">start</a>) <a href="#70123" title="(prefix: List[RangePositions.this.Range])List[RangePositions.this.Range]">:::</a> <a href="#70086" title="(prefix: List[RangePositions.this.Range])List[RangePositions.this.Range]">rs1</a>
      } <span class="keyword">else</span> {
        <span title="Any" class="keyword">if</span> (<span title="(x$1: Boolean)Boolean">!</span><a href="#70085" title="RangePositions.this.Range">r</a>.<a href="#68312" title="=&gt; Boolean">isFree</a> &amp;&amp; (<a href="#70085" title="RangePositions.this.Range">r</a>.<a href="../util/Position.scala.html#30488" title="(pos: scala.tools.nsc.util.Position)Boolean">pos</a> overlaps <a href="#70063" title="RangePositions.this.Tree">t</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>)) <a href="#70064" title="(x: RangePositions.this.Tree)conflicting.type" id="61852">conflicting</a> += <a href="#70085" title="RangePositions.this.Range">r</a>.<a href="#69755" title="=&gt; RangePositions.this.Tree">tree</a> 
        <a href="#70085" title="RangePositions.this.Range">r</a> <a href="#70243" title="RangePositions.this.Range">::</a> <a href="#68289" title="(rs: List[RangePositions.this.Range],t: RangePositions.this.Tree,conflicting: scala.collection.mutable.ListBuffer[RangePositions.this.Tree])List[RangePositions.this.Range]">insert</a><span title="(x: RangePositions.this.Range)List[RangePositions.this.Range]">(</span><a href="#70086" title="List[RangePositions.this.Range]">rs1</a>, <a href="#70063" title="RangePositions.this.Tree">t</a>, <a href="#70064" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a>)
      }
  }

  /** Replace elem `t` of `ts` by `replacement` list. */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ts: List[RangePositions.this.Tree],t: RangePositions.this.Tree,replacement: List[RangePositions.this.Tree])List[RangePositions.this.Tree]" id="68290">replace</a>(<a title="List[RangePositions.this.Tree]" id="70253">ts</a>: <span title="List[RangePositions.this.Tree]">List</span>[Tree], <a title="RangePositions.this.Tree" id="70254">t</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>, <a title="List[RangePositions.this.Tree]" id="70255">replacement</a>: <span title="List[RangePositions.this.Tree]">List</span>[Tree]): <span title="List[RangePositions.this.Tree]">List</span>[Tree] = 
    <span title="List[RangePositions.this.Tree]" class="keyword">if</span> (<a href="#70253" title="List[RangePositions.this.Tree]">ts</a>.<span title="(x$1: AnyRef)Boolean">head</span> == <a href="#70254" title="RangePositions.this.Tree">t</a>) <a href="#70255" title="List[RangePositions.this.Tree]">replacement</a> <a href="#70264" title="List[RangePositions.this.Tree]">:::</a> <a href="#70253" title="List[RangePositions.this.Tree]">ts</a>.<span title="(prefix: List[RangePositions.this.Tree])List[RangePositions.this.Tree]">tail</span>
    <span class="keyword">else</span> <a href="#70253" title="List[RangePositions.this.Tree]">ts</a>.<span title="=&gt; RangePositions.this.Tree">head</span> <a href="#70272" title="RangePositions.this.Tree">::</a> <a href="#68290" title="(ts: List[RangePositions.this.Tree],t: RangePositions.this.Tree,replacement: List[RangePositions.this.Tree])List[RangePositions.this.Tree]">replace</a><span title="(x: RangePositions.this.Tree)List[RangePositions.this.Tree]">(</span><a href="#70253" title="List[RangePositions.this.Tree]">ts</a>.<span title="=&gt; List[RangePositions.this.Tree]">tail</span>, <a href="#70254" title="RangePositions.this.Tree">t</a>, <a href="#70255" title="List[RangePositions.this.Tree]">replacement</a>)

  /** Ensure that given tree has no positions that overlap with
   *  any of the positions of `others`. This is done by
   *  shortening the range or assinging TransparentPositions
   *  to some of the nodes in `tree`.
   */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: RangePositions.this.Tree,others: List[RangePositions.this.Tree])Unit" id="68291">ensureNonOverlapping</a>(<a title="RangePositions.this.Tree" id="70282">tree</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>, <a title="List[RangePositions.this.Tree]" id="70283">others</a>: <span title="List[RangePositions.this.Tree]">List</span>[Tree]) {
    <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position)Boolean" id="70290">isOverlapping</a>(<a title="scala.tools.nsc.util.Position" id="70291">pos</a>: <a href="../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a>) = 
      <a href="#70291" title="scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30467" title="(x$1: Boolean)Boolean">isRange</a> &amp;&amp; (<a href="#70283" title="(p: (RangePositions.this.Tree) =&gt; Boolean)Boolean" id="29123">others</a> exists (<a href="../util/Position.scala.html#30488" title="(pos: scala.tools.nsc.util.Position)Boolean">pos</a> overlaps <a href="#70296" title="RangePositions.this.Tree">_</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>))
    <span title="Unit" class="keyword">if</span> (<a href="#70290" title="(pos: scala.tools.nsc.util.Position)Boolean">isOverlapping</a>(<a href="#70282" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>)) {
      <span class="keyword">val</span> <a title="List[RangePositions.this.Tree]" id="70305">children</a> = <a href="#70282" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29566" title="=&gt; List[RangePositions.this.Tree]">children</a>
      <a href="#70305" title="(f: (RangePositions.this.Tree) =&gt; Unit)Unit">children</a> foreach (<a href="#68291" title="(tree: RangePositions.this.Tree,others: List[RangePositions.this.Tree])Unit">ensureNonOverlapping</a>(<a href="#70322" title="RangePositions.this.Tree">_</a>, <a href="#70283" title="List[RangePositions.this.Tree]">others</a>))
      <span title="Unit" class="keyword">if</span> (<a href="#70282" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30468" title="=&gt; Boolean">isOpaqueRange</a>) {
        <span class="keyword">val</span> <a title="scala.tools.nsc.util.Position" id="70332">wpos</a> = <a href="#68282" title="(default: scala.tools.nsc.util.Position,trees: List[RangePositions.this.Tree])scala.tools.nsc.util.Position">wrappingPos</a>(<a href="#70282" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30482" title="=&gt; scala.tools.nsc.util.Position">focus</a>, <a href="#70305" title="List[RangePositions.this.Tree]">children</a>)
        <a href="../ast/Trees.scala.html#29551" title="(pos: scala.tools.nsc.util.Position)tree.type">tree</a> <span title="Unit">setPos</span> (<span title="scala.tools.nsc.util.Position" class="keyword">if</span> (<a href="#70290" title="(pos: scala.tools.nsc.util.Position)Boolean">isOverlapping</a>(<a href="#70332" title="scala.tools.nsc.util.Position">wpos</a>)) <a href="#70282" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30469" title="=&gt; scala.tools.nsc.util.Position">makeTransparent</a> <span class="keyword">else</span> <a href="#70332" title="scala.tools.nsc.util.Position">wpos</a>)
      }
    }
  }

  /** Does given list of trees have mutually non-overlapping positions?
   *  pre: None of the trees is transparent
   */
  <span class="keyword">def</span> <a title="(cts: List[RangePositions.this.Tree])List[(RangePositions.this.Tree, RangePositions.this.Tree)]" id="68292">findOverlapping</a>(<a title="List[RangePositions.this.Tree]" id="70352">cts</a>: <span title="List[RangePositions.this.Tree]">List</span>[Tree]): <span title="List[(RangePositions.this.Tree, RangePositions.this.Tree)]">List</span>[(Tree, Tree)] = {
    <span class="keyword">var</span> <a title="List[RangePositions.this.Range]" id="70354">ranges</a> = <span title="(xs: RangePositions.this.Range*)List[RangePositions.this.Range]">List</span>(<a href="#68286" title="=&gt; RangePositions.this.Range">maxFree</a>)
    <span class="keyword">for</span> (<a title="RangePositions.this.Tree" id="70380">ct</a> &lt;- <a href="#70352" title="(f: (RangePositions.this.Tree) =&gt; Unit)Unit">cts</a>) {
      <span title="Unit" class="keyword">if</span> (<a href="#70380" title="RangePositions.this.Tree">ct</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30468" title="=&gt; Boolean">isOpaqueRange</a>) {
        <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]" id="70381">conflicting</a> = <span title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">ListBuffer</span>[Tree]
        <a href="#70354" title="List[RangePositions.this.Range]">ranges</a> = <a href="#68289" title="(rs: List[RangePositions.this.Range],t: RangePositions.this.Tree,conflicting: scala.collection.mutable.ListBuffer[RangePositions.this.Tree])List[RangePositions.this.Range]">insert</a>(<a href="#70354" title="List[RangePositions.this.Range]">ranges</a>, <a href="#70380" title="RangePositions.this.Tree">ct</a>, <a href="#70381" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a>)
        <span title="Unit" class="keyword">if</span> (<a href="#70381" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a>.<span title="=&gt; Boolean">nonEmpty</span>) <span title="Nothing" class="keyword">return</span> <a href="#70381" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a>.<a title="(f: (RangePositions.this.Tree) =&gt; (RangePositions.this.Tree, RangePositions.this.Tree))(implicit bf: scala.collection.generic.BuilderFactory[(RangePositions.this.Tree, RangePositions.this.Tree),List[(RangePositions.this.Tree, RangePositions.this.Tree)],List[RangePositions.this.Tree]])List[(RangePositions.this.Tree, RangePositions.this.Tree)]" id="61864">toList</a> <span title="scala.collection.generic.BuilderFactory[(RangePositions.this.Tree, RangePositions.this.Tree),List[(RangePositions.this.Tree, RangePositions.this.Tree)],List#Coll]">map</span> (<a title="RangePositions.this.Tree" id="70394">t</a> =&gt; <span title="(_1: RangePositions.this.Tree,_2: RangePositions.this.Tree)(RangePositions.this.Tree, RangePositions.this.Tree)">(</span><a href="#70394" title="RangePositions.this.Tree">t</a>, <a href="#70380" title="RangePositions.this.Tree">ct</a>))
      }
    }
    List<span title="object Nil">(</span>)
  }

  // -------------- setting positions -------------------------------

  /** Set position of all children of a node
   *  @param  pos   A target position.
   *                Uses the point of the position as the point of all positions it assigns.
   *                Uses the start of this position as an Offset position for unpositioed trees
   *                without children.
   *  @param  trees  The children to position. All children must be positionable. 
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position,trees: List[RangePositions.this.Tree])Unit" id="68293">setChildrenPos</a>(<a title="scala.tools.nsc.util.Position" id="70441">pos</a>: <a href="../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a>, <a title="List[RangePositions.this.Tree]" id="70442">trees</a>: <span title="List[RangePositions.this.Tree]">List</span>[Tree]): <span title="Unit">Unit</span> = <span class="keyword">try</span> {
    <span class="keyword">for</span> (<a title="RangePositions.this.Tree" id="70460">tree</a> &lt;- <a href="#70442" title="(f: (RangePositions.this.Tree) =&gt; Any)Unit">trees</a>) {
      <span title="Any" class="keyword">if</span> (<span title="(x$1: Boolean)Boolean">!</span><a href="#70460" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29560" title="=&gt; Boolean">isEmpty</a> &amp;&amp; <a href="#70460" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="(x$1: AnyRef)Boolean">pos</a> == <a href="../util/Position.scala.html#14615" title="object scala.tools.nsc.util.NoPosition">NoPosition</a>) {
        <span class="keyword">val</span> <a title="List[RangePositions.this.Tree]" id="70475">children</a> = <a href="#70460" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29566" title="=&gt; List[RangePositions.this.Tree]">children</a>
        <span title="tree.type" class="keyword">if</span> (<a href="#70475" title="List[RangePositions.this.Tree]">children</a>.<span title="=&gt; Boolean">isEmpty</span>) {
          <a href="../ast/Trees.scala.html#29551" title="(pos: scala.tools.nsc.util.Position)tree.type">tree</a> setPos <a href="#70441" title="scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30482" title="=&gt; scala.tools.nsc.util.Position">focus</a>
        } <span class="keyword">else</span> {
          <a href="#68293" title="(pos: scala.tools.nsc.util.Position,trees: List[RangePositions.this.Tree])Unit">setChildrenPos</a>(<a href="#70441" title="scala.tools.nsc.util.Position">pos</a>, <a href="#70475" title="List[RangePositions.this.Tree]">children</a>)
          <a href="../ast/Trees.scala.html#29551" title="(pos: scala.tools.nsc.util.Position)tree.type">tree</a> setPos <a href="#68282" title="(default: scala.tools.nsc.util.Position,trees: List[RangePositions.this.Tree])scala.tools.nsc.util.Position">wrappingPos</a>(<a href="#70441" title="scala.tools.nsc.util.Position">pos</a>, <a href="#70475" title="List[RangePositions.this.Tree]">children</a>)
        }
      }
    }
  } <span class="keyword">catch</span> {
    <span title="Nothing" class="keyword">case</span> <a title="Exception" id="70508">ex</a>: <a title="Exception" id="1896">Exception</a> =&gt;
      <a title="(x: Any)Unit" id="8126">println</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;error while set children pos &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70441" title="scala.tools.nsc.util.Position">pos</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; of &quot;)" class="string">&quot; of &quot;</span>+<a href="#70442" title="List[RangePositions.this.Tree]">trees</a>)
      <span title="Nothing" class="keyword">throw</span> <a href="#70508" title="Exception">ex</a>
  }

  /** Position a tree.
   *  This means: Set position of a node and position all its unpositioned children.
   */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="[T &lt;: RangePositions.this.Tree](pos: scala.tools.nsc.util.Position)(tree: T)T" id="68294">atPos</a>[<a title="&gt;: Nothing &lt;: RangePositions.this.Tree" id="68296">T</a> &lt;: Tree](<a title="scala.tools.nsc.util.Position" id="70519">pos</a>: <a href="../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a>)(<a title="T" id="70520">tree</a>: <a href="#68296" title="T">T</a>): <a href="#68296" title="T">T</a> =
    <span title="T" class="keyword">if</span> (<a href="#70519" title="scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30468" title="=&gt; Boolean">isOpaqueRange</a>) {
      <span title="Any" class="keyword">if</span> (<span title="(x$1: Boolean)Boolean">!</span><a href="#70520" title="T">tree</a>.<a href="../ast/Trees.scala.html#29560" title="=&gt; Boolean">isEmpty</a> &amp;&amp; <a href="#70520" title="T">tree</a>.<a href="../ast/Trees.scala.html#29547" title="(x$1: AnyRef)Boolean">pos</a> == <a href="../util/Position.scala.html#14615" title="object scala.tools.nsc.util.NoPosition">NoPosition</a>) {
        <a href="#70520" title="T">tree</a>.<a href="../ast/Trees.scala.html#29551" title="(pos: scala.tools.nsc.util.Position)tree.type">setPos</a>(<a href="#70519" title="scala.tools.nsc.util.Position">pos</a>)
        <span class="keyword">val</span> <a title="List[RangePositions.this.Tree]" id="70536">children</a> = <a href="#70520" title="T">tree</a>.<a href="../ast/Trees.scala.html#29566" title="=&gt; List[RangePositions.this.Tree]">children</a>
        <span title="Any" class="keyword">if</span> (<a href="#70536" title="List[RangePositions.this.Tree]">children</a>.<a title="=&gt; Boolean" id="25377">nonEmpty</a>) {
          <span title="Any" class="keyword">if</span> (<a href="#70536" title="List[RangePositions.this.Tree]">children</a>.<span title="=&gt; List[RangePositions.this.Tree]">tail</span>.<span title="=&gt; Boolean">isEmpty</span>) <a href="#68294" title="(pos: scala.tools.nsc.util.Position)(tree: RangePositions.this.Tree)RangePositions.this.Tree">atPos</a>(<a href="#70519" title="scala.tools.nsc.util.Position">pos</a>)(<a href="#70536" title="List[RangePositions.this.Tree]">children</a>.<span title="=&gt; RangePositions.this.Tree">head</span>)
          <span class="keyword">else</span> <a href="#68293" title="(pos: scala.tools.nsc.util.Position,trees: List[RangePositions.this.Tree])Unit">setChildrenPos</a>(<a href="#70519" title="scala.tools.nsc.util.Position">pos</a>, <a href="#70536" title="List[RangePositions.this.Tree]">children</a>)
        }
      }
      <a href="#70520" title="T">tree</a>
    } <span class="keyword">else</span> {
      <a href="#785485" title="[T &lt;: RangePositions.this.Tree](pos: scala.tools.nsc.util.Position)(tree: T)T" class="keyword">super</a>.<a title="[T &lt;: RangePositions.this.Tree](pos: scala.tools.nsc.util.Position)(tree: T)T" id="785485">atPos</a>(<a href="#70519" title="scala.tools.nsc.util.Position">pos</a>)(<a href="#70520" title="T">tree</a>)
    }

  // ---------------- Validating positions ----------------------------------

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: RangePositions.this.Tree)Unit" id="68297">validatePositions</a>(<a title="RangePositions.this.Tree" id="70574">tree</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>) {
    <span class="keyword">def</span> <a title="(prefix: String,tree: RangePositions.this.Tree)Unit" id="70579">reportTree</a>(<a title="String" id="70582">prefix</a> : <span title="String">String</span>, <a title="RangePositions.this.Tree" id="70583">tree</a> : <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>) {
      <span class="keyword">val</span> <a title="java.lang.Object" id="70584">source</a> = <span title="java.lang.Object" class="keyword">if</span> (<a href="#70583" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30465" title="=&gt; Boolean">isDefined</a>) <a href="#70583" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30464" title="=&gt; scala.tools.nsc.util.SourceFile">source</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;== &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70582" title="String">prefix</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; tree [&quot;)" class="string">&quot; tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70583" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29542" title="=&gt; Int">id</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;] of type &quot;)" class="string">&quot;] of type &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70583" title="RangePositions.this.Tree">tree</a>.<a title="=&gt; java.lang.String" id="29199">productPrefix</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; at &quot;)" class="string">&quot; at &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70583" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30495" title="=&gt; String">show</a>+<a href="#70584" title="java.lang.Object">source</a>)
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<a href="#70583" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29567" title="()String">toString</a>)
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
    }
    
    <span class="keyword">def</span> <a title="(msg: String)(body: =&gt; Unit)Unit" id="70580">error</a>(<a title="String" id="70664">msg</a>: <span title="String">String</span>)(<a title="=&gt; Unit" id="70665">body</a> : =&gt; Unit) {
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;======= Bad positions: &quot;</span>+<a href="#70664" title="String">msg</a>)
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <a href="#70665" title="=&gt; Unit">body</a>
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<span title="java.lang.String(&quot;=== While validating&quot;)" class="string">&quot;=== While validating&quot;</span>)
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<a href="#70574" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29567" title="()String">toString</a>)
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <a href="../Global.scala.html#39294" title="(msg: String)Unit">inform</a>(<span title="java.lang.String(&quot;=======&quot;)" class="string">&quot;=======&quot;</span>)
      <span title="Nothing" class="keyword">throw</span> <span title="RangePositions.this.ValidateError" class="keyword">new</span> <a href="#68298" title="RangePositions.this.ValidateError">ValidateError</a>(<a href="#70664" title="String">msg</a>)
    }
    
    <span class="keyword">def</span> <a title="(tree: RangePositions.this.Tree,encltree: RangePositions.this.Tree)Unit" id="70581">validate</a>(<a title="RangePositions.this.Tree" id="70732">tree</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>, <a title="RangePositions.this.Tree" id="70733">encltree</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>): <span title="Unit">Unit</span> = {
      <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#70732" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29560" title="=&gt; Boolean">isEmpty</a>) {
        <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#70732" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30465" title="=&gt; Boolean">isDefined</a>) 
          <a href="#70580" title="(msg: String)(body: =&gt; Unit)Unit">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Unpositioned tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70732" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29542" title="=&gt; Int">id</a>+<span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>) { <a href="#70579" title="(prefix: String,tree: RangePositions.this.Tree)Unit">reportTree</a>(<span title="java.lang.String(&quot;Unpositioned&quot;)" class="string">&quot;Unpositioned&quot;</span>, <a href="#70732" title="RangePositions.this.Tree">tree</a>) }
        <span title="Unit" class="keyword">if</span> (<a href="#70732" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30467" title="=&gt; Boolean">isRange</a>) {
          <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#70733" title="RangePositions.this.Tree">encltree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30467" title="=&gt; Boolean">isRange</a>)
            <a href="#70580" title="(msg: String)(body: =&gt; Unit)Unit">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Synthetic tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70733" title="RangePositions.this.Tree">encltree</a>.<a href="../ast/Trees.scala.html#29542" title="=&gt; Int">id</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;] contains nonsynthetic tree [&quot;)" class="string">&quot;] contains nonsynthetic tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70732" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29542" title="=&gt; Int">id</a>+<span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>) {
            <a href="#70579" title="(prefix: String,tree: RangePositions.this.Tree)Unit">reportTree</a>(<span title="java.lang.String(&quot;Enclosing&quot;)" class="string">&quot;Enclosing&quot;</span>, <a href="#70733" title="RangePositions.this.Tree">encltree</a>)
            <a href="#70579" title="(prefix: String,tree: RangePositions.this.Tree)Unit">reportTree</a>(<span title="java.lang.String(&quot;Enclosed&quot;)" class="string">&quot;Enclosed&quot;</span>, <a href="#70732" title="RangePositions.this.Tree">tree</a>)
            }
          <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span>(<a href="#70733" title="RangePositions.this.Tree">encltree</a>.<a href="../util/Position.scala.html#30484" title="(pos: scala.tools.nsc.util.Position)Boolean">pos</a> includes <a href="#70732" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>))
            <a href="#70580" title="(msg: String)(body: =&gt; Unit)Unit">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Enclosing tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70733" title="RangePositions.this.Tree">encltree</a>.<a href="../ast/Trees.scala.html#29542" title="=&gt; Int">id</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;] does not include tree [&quot;)" class="string">&quot;] does not include tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#70732" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29542" title="=&gt; Int">id</a>+<span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>) {
              <a href="#70579" title="(prefix: String,tree: RangePositions.this.Tree)Unit">reportTree</a>(<span title="java.lang.String(&quot;Enclosing&quot;)" class="string">&quot;Enclosing&quot;</span>, <a href="#70733" title="RangePositions.this.Tree">encltree</a>)
              <a href="#70579" title="(prefix: String,tree: RangePositions.this.Tree)Unit">reportTree</a>(<span title="java.lang.String(&quot;Enclosed&quot;)" class="string">&quot;Enclosed&quot;</span>, <a href="#70732" title="RangePositions.this.Tree">tree</a>)
            }
          
          <a href="#68292" title="(cts: List[RangePositions.this.Tree])List[(RangePositions.this.Tree, RangePositions.this.Tree)]">findOverlapping</a>(<a href="#70732" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29566" title="(f: (RangePositions.this.Tree) =&gt; Traversable[RangePositions.this.Tree])(implicit bf: scala.collection.generic.BuilderFactory[RangePositions.this.Tree,List[RangePositions.this.Tree],List[RangePositions.this.Tree]])List[RangePositions.this.Tree]">children</a> <span title="scala.collection.generic.BuilderFactory[RangePositions.this.Tree,List[RangePositions.this.Tree],List#Coll]">flatMap</span> <a href="#68284" title="(tree: RangePositions.this.Tree)List[RangePositions.this.Tree]">solidDescendants</a>) <span title="Unit" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> <a href="#70802" title="(x: List[(RangePositions.this.Tree, RangePositions.this.Tree)])Some[List[(RangePositions.this.Tree, RangePositions.this.Tree)]]">List</a>() =&gt; ;
            <span title="Unit" class="keyword">case</span> <a title="List[(RangePositions.this.Tree, RangePositions.this.Tree)]" id="70812">xs</a> =&gt; {
              <a href="#70580" title="(msg: String)(body: =&gt; Unit)Unit">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Overlapping trees &quot;</span>+<a href="#70812" title="List[(RangePositions.this.Tree, RangePositions.this.Tree)]">xs</a>.<span title="(f: ((RangePositions.this.Tree, RangePositions.this.Tree)) =&gt; (Int, Int))(implicit bf: scala.collection.generic.BuilderFactory[(Int, Int),List[(Int, Int)],List[(RangePositions.this.Tree, RangePositions.this.Tree)]])List[(Int, Int)]">map</span> <a href="#70821" title="(Int, Int)">{</a> <span title="(Int, Int)" class="keyword">case</span> (<a title="RangePositions.this.Tree" id="70824">x</a>, <a title="RangePositions.this.Tree" id="70825">y</a>) =&gt; <span title="(_1: Int,_2: Int)(Int, Int)">(</span><a href="#70824" title="RangePositions.this.Tree">x</a>.<a href="../ast/Trees.scala.html#29542" title="=&gt; Int">id</a>, <a href="#70825" title="RangePositions.this.Tree">y</a>.<a href="../ast/Trees.scala.html#29542" title="=&gt; Int">id</a>) }.<a title="(start: String,sep: String,end: String)String" id="25519">mkString</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)) {
                <a href="#70579" title="(prefix: String,tree: RangePositions.this.Tree)Unit">reportTree</a>(<span title="java.lang.String(&quot;Ancestor&quot;)" class="string">&quot;Ancestor&quot;</span>, <a href="#70732" title="RangePositions.this.Tree">tree</a>)
                <span class="keyword">for</span>((<a title="RangePositions.this.Tree" id="70967">x</a>, <a title="RangePositions.this.Tree" id="70968">y</a>) &lt;- <a href="#70812" title="(f: ((RangePositions.this.Tree, RangePositions.this.Tree)) =&gt; Unit)Unit">xs</a>) {
                  <a href="#70579" title="(prefix: String,tree: RangePositions.this.Tree)Unit">reportTree</a>(<span title="java.lang.String(&quot;First overlapping&quot;)" class="string">&quot;First overlapping&quot;</span>, <a href="#70967" title="RangePositions.this.Tree">x</a>)
                  <a href="#70579" title="(prefix: String,tree: RangePositions.this.Tree)Unit">reportTree</a>(<span title="java.lang.String(&quot;Second overlapping&quot;)" class="string">&quot;Second overlapping&quot;</span>, <a href="#70968" title="RangePositions.this.Tree">y</a>)
                }
              }
            }
          }
        }
        <span class="keyword">for</span> (<a title="RangePositions.this.Tree" id="71088">ct</a> &lt;- <a href="#70732" title="RangePositions.this.Tree">tree</a>.<a href="../ast/Trees.scala.html#29566" title="(f: (RangePositions.this.Tree) =&gt; Traversable[RangePositions.this.Tree])(implicit bf: scala.collection.generic.BuilderFactory[RangePositions.this.Tree,List[RangePositions.this.Tree],List[RangePositions.this.Tree]])List[RangePositions.this.Tree]">children</a> <span title="(f: (RangePositions.this.Tree) =&gt; Unit)Unit">flatMap</span> <a href="#68284" title="(tree: RangePositions.this.Tree)List[RangePositions.this.Tree]">solidDescendants</a>) <a href="#70581" title="(tree: RangePositions.this.Tree,encltree: RangePositions.this.Tree)Unit">validate</a>(<a href="#71088" title="RangePositions.this.Tree">ct</a>, <a href="#70732" title="RangePositions.this.Tree">tree</a>)
      }
    }

    <a href="#70581" title="(tree: RangePositions.this.Tree,encltree: RangePositions.this.Tree)Unit">validate</a>(<a href="#70574" title="RangePositions.this.Tree">tree</a>, <a href="#70574" title="RangePositions.this.Tree">tree</a>)
  }

  <span class="keyword">class</span> <a title="class ValidateError extends java.lang.Exception with ScalaObject" id="68298">ValidateError</a><a title="ScalaObject" id="29441">(</a><a title="String" id="70729">msg</a> : <span title="String">String</span>) <span class="keyword">extends</span> <a title="java.lang.Exception" id="7889">Exception</a>(<a href="#70729" title="String">msg</a>)

  // ---------------- Locating trees ----------------------------------

  /** A locator for trees with given positions.
   *  Given a position `pos`, locator.apply returns
   *  the smallest tree that encloses `pos`.
   */
  <span class="keyword">class</span> <a title="class Locator extends RangePositions.this.Traverser with ScalaObject" id="68299">Locator</a><span title="ScalaObject">(</span><a title="scala.tools.nsc.util.Position" id="71128">pos</a>: <a href="../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a>) <span class="keyword">extends</span> <a href="../ast/Trees.scala.html#26933" title="RangePositions.this.Traverser">Traverser</a> {
    <span class="keyword">var</span> <a title="RangePositions.this.Tree" id="71121">last</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a> = _
    <span class="keyword">def</span> <a title="(root: RangePositions.this.Tree)RangePositions.this.Tree" id="71123">locateIn</a>(<a title="RangePositions.this.Tree" id="71131">root</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>): <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a> = {
      <a href="#68299" title="Locator.this.type" class="keyword">this</a>.<a href="#71121" title="(x$1: RangePositions.this.Tree)Unit">last</a> = <a href="../ast/Trees.scala.html#26761" title="object RangePositions.this.EmptyTree">EmptyTree</a>
      <a href="#71124" title="(t: RangePositions.this.Tree)Unit">traverse</a>(<a href="#71131" title="RangePositions.this.Tree">root</a>)
      <a href="#68299" title="Locator.this.type" class="keyword">this</a>.<a href="#71121" title="=&gt; RangePositions.this.Tree">last</a>
    }
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: RangePositions.this.Tree)Unit" id="71124">traverse</a>(<a title="RangePositions.this.Tree" id="71135">t</a>: <a href="../ast/Trees.scala.html#26752" title="RangePositions.this.Tree">Tree</a>) {
      <span title="Unit" class="keyword">if</span> (<a href="#71135" title="RangePositions.this.Tree">t</a>.<a href="../util/Position.scala.html#30484" title="(pos: scala.tools.nsc.util.Position)Boolean">pos</a> includes <a href="#71128" title="scala.tools.nsc.util.Position">pos</a>) {
        <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#71135" title="RangePositions.this.Tree">t</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../util/Position.scala.html#30466" title="=&gt; Boolean">isTransparent</a>) <a href="#71121" title="(x$1: RangePositions.this.Tree)Unit">last</a> = <a href="#71135" title="RangePositions.this.Tree">t</a>
        <span class="keyword">super</span>.<a href="../ast/Trees.scala.html#71109" title="(tree: RangePositions.this.Tree)Unit">traverse</a>(<a href="#71135" title="RangePositions.this.Tree">t</a>)
      }
    }
  }
}

        </pre>
    </body>
</html>