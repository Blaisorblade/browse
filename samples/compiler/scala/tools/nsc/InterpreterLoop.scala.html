<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/InterpreterLoop.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author Alexander Spoon
 */
// $Id: InterpreterLoop.scala 18548 2009-08-22 21:27:49Z extempore $

<span class="keyword">package</span> scala.tools.nsc

<span class="keyword">import</span> java.io.{BufferedReader, File, FileReader, PrintWriter}
<span class="keyword">import</span> java.io.IOException

<span class="keyword">import</span> scala.tools.nsc.{InterpreterResults =&gt; IR}
<span class="keyword">import</span> scala.tools.nsc.interpreter._

// Classes to wrap up interpreter commands and their results
// You can add new commands by adding entries to val commands
// inside InterpreterLoop.
<span class="keyword">object</span> <a title="object scala.tools.nsc.InterpreterControl" id="8998">InterpreterControl</a> <span title="ScalaObject">{</span>
  // the default result means &quot;keep running, and don't record that line&quot;
  <span class="keyword">val</span> <a title="scala.tools.nsc.InterpreterControl.Result" id="127989">defaultResult</a> = <a href="#564393" title="(keepRunning: Boolean,lineToRecord: Option[String])scala.tools.nsc.InterpreterControl.Result">Result</a>(<span title="Boolean(true)" class="keyword">true</span>, <span title="object None">None</span>)
  
  // a single interpreter command
  <span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class Command extends java.lang.Object with (List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result with ScalaObject" id="127991">Command</a> <span title="ScalaObject" class="keyword">extends</span> <a title="(List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result" id="170">Function1</a>[List[String], Result] {
    <span class="keyword">val</span> <a title="=&gt; String" id="564421">name</a>: <span title="String">String</span>
    <span class="keyword">val</span> <a title="=&gt; String" id="564422">help</a>: <span title="String">String</span>
    <span class="keyword">def</span> <a title="(msg: String)scala.tools.nsc.InterpreterControl.Result" id="564423">error</a>(<a title="String" id="564428">msg</a>: <span title="String">String</span>) = {
      <span title="(x: Any)Unit">println</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#564421" title="=&gt; String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#564428" title="String">msg</a> + <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>)
      <a href="#564393" title="(keepRunning: Boolean,lineToRecord: Option[String])scala.tools.nsc.InterpreterControl.Result">Result</a>(<span title="Boolean(true)" class="keyword">true</span>, <span title="object None">None</span>)
    }
    <span class="keyword">def</span> <a title="()String" id="564424">getHelp</a>(): <span title="String">String</span> = <span title="(x$1: Any)java.lang.String" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#564421" title="=&gt; String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#564422" title="=&gt; String">help</a> + <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>
  }
  
  case <span class="keyword">class</span> <a title="class NoArgs extends scala.tools.nsc.InterpreterControl.Command with ScalaObject with Product" id="564519">NoArgs</a><span title="ScalaObject">(</span><a title="String" id="565095">name</a>: <span title="String">String</span>, <a title="String" id="565096">help</a>: <span title="String">String</span>, <a title="() =&gt; scala.tools.nsc.InterpreterControl.Result" id="565097">f</a>: () =&gt; Result) <span class="keyword">extends</span> <a href="#127991" title="scala.tools.nsc.InterpreterControl.Command">Command</a> {
    <span class="keyword">def</span> <a title="(args: List[String])scala.tools.nsc.InterpreterControl.Result" id="564472">apply</a>(<a title="List[String]" id="564483">args</a>: <span title="List[String]">List</span>[String]) = <span title="scala.tools.nsc.InterpreterControl.Result" class="keyword">if</span> (<a href="#564483" title="List[String]">args</a>.<span title="=&gt; Boolean">isEmpty</span>) <a href="#565097" title="()scala.tools.nsc.InterpreterControl.Result">f</a>() <span class="keyword">else</span> <a href="#564423" title="(msg: String)scala.tools.nsc.InterpreterControl.Result">error</a>(<span title="java.lang.String(&quot;accepts no arguments&quot;)" class="string">&quot;accepts no arguments&quot;</span>)
  }
  
  case <span class="keyword">class</span> <a title="class LineArg extends scala.tools.nsc.InterpreterControl.Command with ScalaObject with Product" id="564650">LineArg</a><span title="ScalaObject">(</span><a title="String" id="565083">name</a>: <span title="String">String</span>, <a title="String" id="565084">help</a>: <span title="String">String</span>, <a title="(String) =&gt; scala.tools.nsc.InterpreterControl.Result" id="565085">f</a>: (String) =&gt; Result) <span class="keyword">extends</span> <a href="#127991" title="scala.tools.nsc.InterpreterControl.Command">Command</a> {
    <span class="keyword">def</span> <a title="(args: List[String])scala.tools.nsc.InterpreterControl.Result" id="564595">apply</a>(<a title="List[String]" id="564606">args</a>: <span title="List[String]">List</span>[String]) =
      <span title="scala.tools.nsc.InterpreterControl.Result" class="keyword">if</span> (<a href="#564606" title="List[String]">args</a>.<span title="(x$1: Int)Boolean">size</span> == <span title="Int(1)" class="int">1</span>) <a href="#565085" title="(v1: String)scala.tools.nsc.InterpreterControl.Result">f</a>(<a href="#564606" title="List[String]">args</a>.<span title="=&gt; String">head</span>)
      <span class="keyword">else</span> <a href="#564423" title="(msg: String)scala.tools.nsc.InterpreterControl.Result">error</a>(<span title="java.lang.String(&quot;requires a line of input&quot;)" class="string">&quot;requires a line of input&quot;</span>)
  }

  case <span class="keyword">class</span> <a title="class OneArg extends scala.tools.nsc.InterpreterControl.Command with ScalaObject with Product" id="564781">OneArg</a><span title="ScalaObject">(</span><a title="String" id="565071">name</a>: <span title="String">String</span>, <a title="String" id="565072">help</a>: <span title="String">String</span>, <a title="(String) =&gt; scala.tools.nsc.InterpreterControl.Result" id="565073">f</a>: (String) =&gt; Result) <span class="keyword">extends</span> <a href="#127991" title="scala.tools.nsc.InterpreterControl.Command">Command</a> {
    <span class="keyword">def</span> <a title="(args: List[String])scala.tools.nsc.InterpreterControl.Result" id="564726">apply</a>(<a title="List[String]" id="564737">args</a>: <span title="List[String]">List</span>[String]) =
      <span title="scala.tools.nsc.InterpreterControl.Result" class="keyword">if</span> (<a href="#564737" title="List[String]">args</a>.<span title="(x$1: Int)Boolean">size</span> == <span title="Int(1)" class="int">1</span>) <a href="#565073" title="(v1: String)scala.tools.nsc.InterpreterControl.Result">f</a>(<a href="#564737" title="List[String]">args</a>.<span title="=&gt; String">head</span>)
      <span class="keyword">else</span> <a href="#564423" title="(msg: String)scala.tools.nsc.InterpreterControl.Result">error</a>(<span title="java.lang.String(&quot;requires exactly one argument&quot;)" class="string">&quot;requires exactly one argument&quot;</span>)
  }

  case <span class="keyword">class</span> <a title="class VarArgs extends scala.tools.nsc.InterpreterControl.Command with ScalaObject with Product" id="564903">VarArgs</a><span title="ScalaObject">(</span><a title="String" id="565059">name</a>: <span title="String">String</span>, <a title="String" id="565060">help</a>: <span title="String">String</span>, <a title="(List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result" id="565061">f</a>: (List[String]) =&gt; Result) <span class="keyword">extends</span> <a href="#127991" title="scala.tools.nsc.InterpreterControl.Command">Command</a> {
    <span class="keyword">def</span> <a title="(args: List[String])scala.tools.nsc.InterpreterControl.Result" id="564857">apply</a>(<a title="List[String]" id="564868">args</a>: <span title="List[String]">List</span>[String]) = <a href="#565061" title="(v1: List[String])scala.tools.nsc.InterpreterControl.Result">f</a>(<a href="#564868" title="List[String]">args</a>)
  }

  // the result of a single command
  case <span class="keyword">class</span> <a title="class Result extends java.lang.Object with ScalaObject with Product" id="564393">Result</a><span title="ScalaObject">(</span><a title="Boolean" id="564403">keepRunning</a>: <span title="Boolean">Boolean</span>, <a title="Option[String]" id="564404">lineToRecord</a>: <span title="Option[String]">Option</span>[String])
}
<span class="keyword">import</span> InterpreterControl._

// import scala.concurrent.ops.defaultRunner

/** The 
 *  &lt;a href=&quot;http://scala-lang.org/&quot; target=&quot;_top&quot;&gt;Scala&lt;/a&gt;
 *  interactive shell.  It provides a read-eval-print loop around
 *  the Interpreter class.
 *  After instantiation, clients should call the &lt;code&gt;main()&lt;/code&gt; method.
 *
 *  &lt;p&gt;If no in0 is specified, then input will come from the console, and
 *  the class will attempt to provide input editing feature such as
 *  input history.
 *
 *  @author Moez A. Abdel-Gawad
 *  @author  Lex Spoon
 *  @version 1.2
 */
<span class="keyword">class</span> <a title="class InterpreterLoop extends java.lang.Object with ScalaObject" id="9141">InterpreterLoop</a><span title="ScalaObject">(</span><a title="Option[java.io.BufferedReader]" id="128007">in0</a>: <span title="Option[java.io.BufferedReader]">Option</span>[BufferedReader], <a title="java.io.PrintWriter" id="128008">out</a>: <span title="java.io.PrintWriter">PrintWriter</span>) {
  <span class="keyword">def</span> <a title="(in0: java.io.BufferedReader,out: java.io.PrintWriter)scala.tools.nsc.InterpreterLoop" id="127930" class="keyword">this</a>(<a title="java.io.BufferedReader" id="127986">in0</a>: <span title="java.io.BufferedReader">BufferedReader</span>, <a title="java.io.PrintWriter" id="127987">out</a>: <span title="java.io.PrintWriter">PrintWriter</span>) = <a href="#9141" title="InterpreterLoop.this.type" class="keyword">this</a>(<span title="(x: java.io.BufferedReader)Some[java.io.BufferedReader]">Some</span>(<a href="#127986" title="java.io.BufferedReader">in0</a>), <a href="#127987" title="java.io.PrintWriter">out</a>)
  <span class="keyword">def</span> <a title="()scala.tools.nsc.InterpreterLoop" id="127931" class="keyword">this</a>() = <a href="#9141" title="InterpreterLoop.this.type" class="keyword">this</a>(<span title="object None">None</span>, <a title="(x$1: java.io.OutputStream)java.io.PrintWriter" id="39097" class="keyword">new</a> <span title="java.io.PrintWriter">PrintWriter</span>(<a title="object Console" id="402">Console</a>.<a title="=&gt; java.io.PrintStream" id="51533">out</a>))

  /** The input stream from which commands come, set by main() */
  <span class="keyword">var</span> <a title="scala.tools.nsc.interpreter.InteractiveReader" id="127933">in</a>: <a href="interpreter/InteractiveReader.scala.html#22274" title="scala.tools.nsc.interpreter.InteractiveReader">InteractiveReader</a> = _

  /** The context class loader at the time this object was created */
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="java.lang.ClassLoader" id="127935">originalClassLoader</a> = <span title="object java.lang.Thread">Thread</span>.<span title="()java.lang.Thread">currentThread</span>.<a title="()java.lang.ClassLoader" id="131135">getContextClassLoader</a>
  
  <span class="keyword">var</span> <a title="scala.tools.nsc.Settings" id="127938">settings</a>: <a href="Settings.scala.html#8775" title="scala.tools.nsc.Settings">Settings</a> = _          // set by main()
  <span class="keyword">var</span> <a title="scala.tools.nsc.Interpreter" id="127941">interpreter</a>: <a href="Interpreter.scala.html#8439" title="scala.tools.nsc.Interpreter">Interpreter</a> = _    // set by createInterpreter()
  <span class="keyword">def</span> <a title="=&gt; scala.tools.nsc.InterpreterSettings" id="127943">isettings</a> = <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117692" title="=&gt; scala.tools.nsc.InterpreterSettings">isettings</a>
    
  // XXX
  <span class="keyword">var</span> <a title="List[String]" id="127945">addedClasspath</a>: <span title="List[String]">List</span>[String] = <span title="object Nil">Nil</span>

  /** A reverse list of commands to replay if the user requests a :replay */
  <span class="keyword">var</span> <a title="List[String]" id="127948">replayCommandsRev</a>: <span title="List[String]">List</span>[String] = <span title="object Nil">Nil</span>

  /** A list of commands to replay if the user requests a :replay */
  <span class="keyword">def</span> <a title="=&gt; List[String]" id="127950">replayCommands</a> = <a href="#127948" title="=&gt; List[String]">replayCommandsRev</a>.<a title="=&gt; List[String]" id="24460">reverse</a>

  /** Record a command for replay should the user request a :replay */
  <span class="keyword">def</span> <a title="(cmd: String)Unit" id="127951">addReplay</a>(<a title="String" id="565155">cmd</a>: <span title="String">String</span>) = <a href="#127948" title="(x$1: List[String])Unit">replayCommandsRev</a> = <a href="#565155" title="String">cmd</a> <a href="#565158" title="String">::</a> <a href="#127948" title="(x: String)List[String]">replayCommandsRev</a>

  /** Close the interpreter and set the var to &lt;code&gt;null&lt;/code&gt;. */
  <span class="keyword">def</span> <a title="()Unit" id="127952">closeInterpreter</a>() {
    <span title="Unit" class="keyword">if</span> (<a href="#127941" title="(x$1: AnyRef)Boolean" id="6613">interpreter</a> ne <span title="Null(null)" class="keyword">null</span>) {
      <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117742" title="()Unit">close</a>
      <a href="#127941" title="(x$1: scala.tools.nsc.Interpreter)Unit">interpreter</a> = <span title="Null(null)" class="keyword">null</span>
      <span title="object java.lang.Thread">Thread</span>.<span title="()java.lang.Thread">currentThread</span>.<a title="(x$1: java.lang.ClassLoader)Unit" id="131136">setContextClassLoader</a>(<a href="#127935" title="=&gt; java.lang.ClassLoader">originalClassLoader</a>)
    }
  }

  /** Create a new interpreter. */
  <span class="keyword">def</span> <a title="()Unit" id="127953">createInterpreter</a>() {
    <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#127945" title="=&gt; List[String]">addedClasspath</a>.<span title="=&gt; Boolean">isEmpty</span>)
      <a href="#127938" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="Settings.scala.html#37231" title="=&gt; scala.tools.nsc.Settings.StringSetting">classpath</a>.<a href="Settings.scala.html#37989" title="(arg: java.lang.String)Unit">value</a> += <a href="#127945" title="=&gt; List[String]">addedClasspath</a>.<span title="(f: (String) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[String]])List[java.lang.String]">map</span><span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><a title="object java.io.File" id="3829">File</a>.<a title="(x$1: Any)java.lang.String" id="35355">pathSeparator</a> + <a href="#565215" title="String">_</a>).<a title="=&gt; String" id="25525">mkString</a>
      
    <a href="#127941" title="(x$1: scala.tools.nsc.Interpreter)Unit">interpreter</a> = <a href="#565305" title="scala.tools.nsc.Interpreter{ ... }" class="keyword">new</a> <a href="Interpreter.scala.html#8439" title="anonymous class $anon extends scala.tools.nsc.Interpreter" id="565305">Interpreter</a>(<a href="#127938" title="=&gt; scala.tools.nsc.Settings">settings</a>, <a href="#128008" title="java.io.PrintWriter">out</a>) {
      <span class="keyword">override</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; java.lang.ClassLoader" id="565307">parentClassLoader</a> = classOf<span title="java.lang.Class[scala.tools.nsc.InterpreterLoop]">[</span>InterpreterLoop].<a title="()java.lang.ClassLoader" id="4131">getClassLoader</a>
    }
    <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117706" title="()Unit">setContextClassLoader</a>()
  }

  /** Bind the settings so that evaluated code can modify them */
  <span class="keyword">def</span> <a title="()Unit" id="127954">bindSettings</a>() {
    <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117689" title="(operation: =&gt; scala.tools.nsc.InterpreterResults.Result)scala.tools.nsc.InterpreterResults.Result">beQuietDuring</a> <span title="Unit">{</span>
      <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117734" title="(code: String)Boolean">compileString</a>(<a href="InterpreterSettings.scala.html#8482" title="object scala.tools.nsc.InterpreterSettings">InterpreterSettings</a>.<a href="InterpreterSettings.scala.html#311825" title="=&gt; java.lang.String">sourceCodeForClass</a>)
      <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117740" title="(name: String,boundType: String,value: Any)scala.tools.nsc.InterpreterResults.Result">bind</a>(<span title="java.lang.String(&quot;settings&quot;)" class="string">&quot;settings&quot;</span>, <span title="java.lang.String(&quot;scala.tools.nsc.InterpreterSettings&quot;)" class="string">&quot;scala.tools.nsc.InterpreterSettings&quot;</span>, <a href="#127943" title="=&gt; scala.tools.nsc.InterpreterSettings">isettings</a>)
    }
  }

  /** print a friendly help message */
  <span class="keyword">def</span> <a title="()Unit" id="127955">printHelp</a>() = {
    <a href="#128008" title="(x$1: java.lang.String)Unit">out</a> println <span title="java.lang.String(&quot;All commands can be abbreviated - for example :h or :he instead of :help.\012&quot;)" class="string">&quot;All commands can be abbreviated - for example :h or :he instead of :help.\n&quot;</span>
    <a href="#127968" title="(f: (scala.tools.nsc.InterpreterControl.Command) =&gt; Unit)Unit">commands</a> foreach { <a title="scala.tools.nsc.InterpreterControl.Command" id="565363">c</a> =&gt; <a href="#128008" title="(x$1: java.lang.String)Unit">out</a> println <a href="#565363" title="scala.tools.nsc.InterpreterControl.Command">c</a>.<a href="#564424" title="()String">getHelp</a> }
  }      
  
  /** Print a welcome message */
  <span class="keyword">def</span> <a title="()Unit" id="127956">printWelcome</a>() {
    <span class="keyword">import</span> Properties._
    <span class="keyword">val</span> <a title="String" id="565377">welcomeMsg</a> = 
     <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;|Welcome to Scala %s (%s, Java %s).
        |Type in expressions to have them evaluated.
        |Type :help for more information.&quot;&quot;&quot;</span> .
    <a title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" id="30654">stripMargin</a>.<a title="(args: Any*)String" id="30950">format</a>(<a href="Properties.scala.html#9493" title="=&gt; java.lang.String" id="38461">versionString</a>, <a href="Properties.scala.html#9493" title="=&gt; String" id="38477">javaVmName</a>, <a href="Properties.scala.html#9493" title="=&gt; String" id="38483">javaVersion</a>)
        
    <a href="#128008" title="(x$1: java.lang.String)Unit">out</a> println <a href="#565377" title="String">welcomeMsg</a>
    <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="()Unit">flush</span>
  }
  
  /** Prompt to print when awaiting input */
  <span class="keyword">val</span> <a title="String" id="127957">prompt</a> = <a href="Properties.scala.html#9493" title="object scala.tools.nsc.Properties">Properties</a>.<a href="Properties.scala.html#38503" title="=&gt; String">shellPromptString</a>

  // most commands do not want to micromanage the Result, but they might want
  // to print something to the console, so we accomodate Unit and String returns.
  <span class="keyword">object</span> <a title="object InterpreterLoop.this.CommandImplicits" id="127959">CommandImplicits</a> <span title="ScalaObject">{</span>
    <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.u2ir : (x: Unit)scala.tools.nsc.InterpreterControl.Result" id="565425">u2ir</a>(<a title="Unit" id="565430">x</a>: <span title="Unit">Unit</span>): <a href="#564393" title="scala.tools.nsc.InterpreterControl.Result">Result</a> = <a href="#127989" title="=&gt; scala.tools.nsc.InterpreterControl.Result">defaultResult</a>
    <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.s2ir : (s: String)scala.tools.nsc.InterpreterControl.Result" id="565426">s2ir</a>(<a title="String" id="565432">s</a>: <span title="String">String</span>): <a href="#564393" title="scala.tools.nsc.InterpreterControl.Result">Result</a> = {
      <a href="#128008" title="(x$1: java.lang.String)Unit">out</a> println <a href="#565432" title="String">s</a>
      <a href="#127989" title="=&gt; scala.tools.nsc.InterpreterControl.Result">defaultResult</a>
    }
  }
  
  /** Standard commands **/
  <span class="keyword">val</span> <a title="List[scala.tools.nsc.InterpreterControl.Command]" id="127961">standardCommands</a>: <span title="List[scala.tools.nsc.InterpreterControl.Command]">List</span>[Command] = {
    <span class="keyword">import</span> CommandImplicits._
    <span title="(xs: scala.tools.nsc.InterpreterControl.Command with Product*)List[scala.tools.nsc.InterpreterControl.Command with Product]">List</span>(
       <a href="#564519" title="(name: String,help: String,f: () =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.NoArgs">NoArgs</a>(<span title="java.lang.String(&quot;help&quot;)" class="string">&quot;help&quot;</span>, <span title="java.lang.String(&quot;prints this help message&quot;)" class="string">&quot;prints this help message&quot;</span>, <a href="#565425" title="implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.u2ir : (x: Unit)scala.tools.nsc.InterpreterControl.Result">printHelp</a>),
       <a href="#564781" title="(name: String,help: String,f: (String) =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.OneArg">OneArg</a>(<span title="java.lang.String(&quot;jar&quot;)" class="string">&quot;jar&quot;</span>, <span title="java.lang.String(&quot;add a jar to the classpath&quot;)" class="string">&quot;add a jar to the classpath&quot;</span>, <a href="#565425" title="implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.u2ir : (x: Unit)scala.tools.nsc.InterpreterControl.Result">addJar</a>),
       <a href="#564781" title="(name: String,help: String,f: (String) =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.OneArg">OneArg</a>(<span title="java.lang.String(&quot;load&quot;)" class="string">&quot;load&quot;</span>, <span title="java.lang.String(&quot;followed by a filename loads a Scala file&quot;)" class="string">&quot;followed by a filename loads a Scala file&quot;</span>, <a href="#127973" title="(arg: String)scala.tools.nsc.InterpreterControl.Result">load</a>),
       <a href="#564519" title="(name: String,help: String,f: () =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.NoArgs">NoArgs</a>(<span title="java.lang.String(&quot;power&quot;)" class="string">&quot;power&quot;</span>, <span title="java.lang.String(&quot;enable power user mode&quot;)" class="string">&quot;enable power user mode&quot;</span>, <a href="#565426" title="implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.s2ir : (s: String)scala.tools.nsc.InterpreterControl.Result">power</a>),
       <a href="#564519" title="(name: String,help: String,f: () =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.NoArgs">NoArgs</a>(<span title="java.lang.String(&quot;quit&quot;)" class="string">&quot;quit&quot;</span>, <span title="java.lang.String(&quot;exits the interpreter&quot;)" class="string">&quot;exits the interpreter&quot;</span>, () =&gt; <a href="#564393" title="(keepRunning: Boolean,lineToRecord: Option[String])scala.tools.nsc.InterpreterControl.Result">Result</a>(<span title="Boolean(false)" class="keyword">false</span>, <span title="object None">None</span>)),
       <a href="#564519" title="(name: String,help: String,f: () =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.NoArgs">NoArgs</a>(<span title="java.lang.String(&quot;replay&quot;)" class="string">&quot;replay&quot;</span>, <span title="java.lang.String(&quot;resets execution and replays all previous commands&quot;)" class="string">&quot;resets execution and replays all previous commands&quot;</span>, <a href="#565425" title="implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.u2ir : (x: Unit)scala.tools.nsc.InterpreterControl.Result">replay</a>),
       <a href="#564519" title="(name: String,help: String,f: () =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.NoArgs">NoArgs</a>(<span title="java.lang.String(&quot;silent&quot;)" class="string">&quot;silent&quot;</span>, <span title="java.lang.String(&quot;disable/enable automatic printing of results&quot;)" class="string">&quot;disable/enable automatic printing of results&quot;</span>, <a href="#565425" title="implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.u2ir : (x: Unit)scala.tools.nsc.InterpreterControl.Result">verbosity</a>) 
    )
  }
  
  /** Power user commands */
  // XXX - why does a third argument like &quot;interpreter dumpState(_)&quot; throw an NPE
  // while the version below works?
  <span class="keyword">var</span> <a title="Boolean" id="127964">powerUserOn</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="keyword">val</span> <a title="List[scala.tools.nsc.InterpreterControl.Command]" id="127966">powerCommands</a>: <span title="List[scala.tools.nsc.InterpreterControl.Command]">List</span>[Command] = {
    <span class="keyword">import</span> CommandImplicits._
    <span title="(xs: scala.tools.nsc.InterpreterControl.VarArgs*)List[scala.tools.nsc.InterpreterControl.VarArgs]">List</span>(
      <a href="#564903" title="(name: String,help: String,f: (List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.VarArgs">VarArgs</a>(<span title="java.lang.String(&quot;dump&quot;)" class="string">&quot;dump&quot;</span>, <span title="java.lang.String(&quot;displays a view of the interpreter's internal state&quot;)" class="string">&quot;displays a view of the interpreter's internal state&quot;</span>, 
        (xs: <span title="List[String]">List</span>[String]) =&gt; <a href="Interpreter.scala.html#117754" title="(xs: List[String])String">interpreter</a> <a href="#565426" title="implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.s2ir : (s: String)scala.tools.nsc.InterpreterControl.Result">dumpState</a> <a href="#565822" title="List[String]">xs</a>),
      <a href="#564903" title="(name: String,help: String,f: (List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.VarArgs">VarArgs</a>(<span title="java.lang.String(&quot;tree&quot;)" class="string">&quot;tree&quot;</span>, <span title="java.lang.String(&quot;displays ASTs for specified identifiers&quot;)" class="string">&quot;displays ASTs for specified identifiers&quot;</span>,
        (xs: <span title="List[String]">List</span>[String]) =&gt; <a href="Interpreter.scala.html#117755" title="(xs: List[String])String">interpreter</a> <a href="#565426" title="implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.s2ir : (s: String)scala.tools.nsc.InterpreterControl.Result">dumpTrees</a> <a href="#565862" title="List[String]">xs</a>)
      // LineArg(&quot;meta&quot;, &quot;given code which produces scala code, executes the results&quot;,
      //   (xs: List[String]) =&gt; )
    )
  }
  
  /** Available commands */
  <span class="keyword">def</span> <a title="=&gt; List[scala.tools.nsc.InterpreterControl.Command]" id="127968">commands</a>: <span title="List[scala.tools.nsc.InterpreterControl.Command]">List</span>[Command] = <a href="#127961" title="=&gt; List[scala.tools.nsc.InterpreterControl.Command]">standardCommands</a> <a href="#565876" title="List[scala.tools.nsc.InterpreterControl.Command]">:::</a> <span title="(prefix: List[scala.tools.nsc.InterpreterControl.Command])List[scala.tools.nsc.InterpreterControl.Command]">(</span><span title="List[scala.tools.nsc.InterpreterControl.Command]" class="keyword">if</span> (<a href="#127964" title="=&gt; Boolean">powerUserOn</a>) <a href="#127966" title="=&gt; List[scala.tools.nsc.InterpreterControl.Command]">powerCommands</a> <span class="keyword">else</span> <span title="object Nil">Nil</span>)

  /** The main read-eval-print loop for the interpreter.  It calls
   *  &lt;code&gt;command()&lt;/code&gt; for each line of input, and stops when
   *  &lt;code&gt;command()&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;.
   */
  <span class="keyword">def</span> <a title="()Unit" id="127969">repl</a>() {
    <span class="keyword">def</span> <a title="()String" id="565884">readOneLine</a>() = {
      <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="()Unit">flush</span>
      <a href="interpreter/InteractiveReader.scala.html#564198" title="(prompt: String)String">in</a> readLine <a href="#127957" title="=&gt; String">prompt</a>
    }
    // return false if repl should exit
    <span class="keyword">def</span> <a title="(line: String)Boolean" id="565885">processLine</a>(<a title="String" id="565893">line</a>: <span title="String">String</span>): <span title="Boolean">Boolean</span> =       
      <span title="Boolean" class="keyword">if</span> (<a href="#565893" title="(x$1: AnyRef)Boolean">line</a> eq <span title="Null(null)" class="keyword">null</span>) <span title="Boolean(false)" class="keyword">false</span>               // assume null means EOF
      <span class="keyword">else</span> <a href="#127977" title="(line: String)scala.tools.nsc.InterpreterControl.Result">command</a>(<a href="#565893" title="String">line</a>) <span title="Boolean" class="keyword">match</span> {
        <span title="Boolean(false)" class="keyword">case</span> Result(<span title="Boolean(false)" class="keyword">false</span>, _)           =&gt; <span title="Boolean(false)" class="keyword">false</span>
        <span title="Boolean" class="keyword">case</span> Result(_, Some(<a title="String" id="565903">finalLine</a>)) =&gt; <a href="#127951" title="(cmd: String)Unit">addReplay</a>(<a href="#565903" title="String">finalLine</a>) ; <span title="Boolean(true)" class="keyword">true</span>
        <span title="Boolean(true)" class="keyword">case</span> _                          =&gt; <span title="Boolean(true)" class="keyword">true</span>
      }
    
    /* For some reason, the first interpreted command always takes
     * a second or two.  So, wait until the welcome message
     * has been printed before calling bindSettings.  That way,
     * the user can read the welcome message while this
     * command executes.
     */
    <span class="keyword">val</span> <a title="() =&gt; String" id="565886">futLine</a> = scala.concurrent.<span title="object scala.concurrent.ops">ops</span>.<a title="String" id="565928">future</a><a title="scala.concurrent.TaskRunner[Unit]" id="565930">(</a><a href="#565884" title="() =&gt; String" id="565970">readOneLine</a>)
    <a href="#127954" title="()Unit">bindSettings</a>()
    <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#565885" title="(line: String)Boolean">processLine</a>(<a href="#565886" title="()String">futLine</a>()))
      <span title="Nothing" class="keyword">return</span>

    // loops until false, then returns
    <span title="Unit" class="keyword">while</span> (<a href="#565885" title="(line: String)Boolean">processLine</a>(<a href="#565884" title="()String">readOneLine</a>)) <a href="#565990" title="Unit">{</a> }
  }

  /** interpret all lines from a specified file */
  <span class="keyword">def</span> <a title="(filename: String)Unit" id="127970">interpretAllFrom</a>(<a title="String" id="565565">filename</a>: <span title="String">String</span>) {
    <span class="keyword">val</span> <a title="java.io.FileReader" id="565997">fileIn</a> = 
      <span class="keyword">try</span>   { <span title="java.io.FileReader" class="keyword">new</span> <a title="java.io.FileReader" id="3999">FileReader</a>(<a href="#565565" title="String">filename</a>) }
      <span class="keyword">catch</span> { <span title="Nothing" class="keyword">case</span> _:<a title="java.io.IOException" id="3657">IOException</a> =&gt; <span title="Nothing" class="keyword">return</span> <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="(x$1: java.lang.String)Unit">println</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Error opening file: &quot;</span> + <a href="#565565" title="String">filename</a>) }
      
    <span class="keyword">val</span> <a title="scala.tools.nsc.interpreter.InteractiveReader" id="565998">oldIn</a> = <a href="#127933" title="=&gt; scala.tools.nsc.interpreter.InteractiveReader">in</a>
    <span class="keyword">val</span> <a title="List[String]" id="565999">oldReplay</a> = <a href="#127948" title="=&gt; List[String]">replayCommandsRev</a>
    <span class="keyword">try</span> {
      <span class="keyword">val</span> <a title="java.io.BufferedReader" id="566020">inFile</a> = <a title="(x$1: java.io.Reader)java.io.BufferedReader" id="39072" class="keyword">new</a> <span title="java.io.BufferedReader">BufferedReader</span>(<a href="#565997" title="java.io.FileReader">fileIn</a>)
      <a href="#127933" title="(x$1: scala.tools.nsc.interpreter.InteractiveReader)Unit">in</a> = <span title="scala.tools.nsc.interpreter.SimpleReader" class="keyword">new</span> <a href="interpreter/SimpleReader.scala.html#22334" title="scala.tools.nsc.interpreter.SimpleReader">SimpleReader</a>(<a href="#566020" title="java.io.BufferedReader">inFile</a>, <a href="#128008" title="java.io.PrintWriter">out</a>, <span title="Boolean(false)" class="keyword">false</span>)
      <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="(x$1: java.lang.String)Unit">println</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Loading &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#565565" title="String">filename</a> + <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>)
      <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="()Unit">flush</span>
      <a href="#127969" title="()Unit">repl</a>
    } <span class="keyword">finally</span> {
      <a href="#127933" title="(x$1: scala.tools.nsc.interpreter.InteractiveReader)Unit">in</a> = <a href="#565998" title="scala.tools.nsc.interpreter.InteractiveReader">oldIn</a>
      <a href="#127948" title="(x$1: List[String])Unit">replayCommandsRev</a> = <a href="#565999" title="List[String]">oldReplay</a>
      <a href="#565997" title="java.io.FileReader">fileIn</a>.<a title="()Unit" id="132715">close</a>
    }
  }

  /** create a new interpreter and replay all commands so far */
  <span class="keyword">def</span> <a title="()Unit" id="127971">replay</a>() {
    <a href="#127952" title="()Unit">closeInterpreter</a>()
    <a href="#127953" title="()Unit">createInterpreter</a>()
    <span class="keyword">for</span> (<a title="String" id="566072">cmd</a> &lt;- <a href="#127950" title="(f: (String) =&gt; Unit)Unit">replayCommands</a>) {
      <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="(x$1: java.lang.String)Unit">println</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Replaying: &quot;</span> + <a href="#566072" title="String">cmd</a>)
      <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="()Unit">flush</span>()  // because maybe cmd will have its own output
      <a href="#127977" title="(line: String)scala.tools.nsc.InterpreterControl.Result">command</a>(<a href="#566072" title="String">cmd</a>)
      <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="()Unit">println</span>
    }
  }
  
  <span class="keyword">def</span> <a title="(filename: String)(action: (String) =&gt; Unit)Unit" id="127972">withFile</a>(<a title="String" id="565558">filename</a>: <span title="String">String</span>)(<a title="(String) =&gt; Unit" id="565559">action</a>: String =&gt; Unit) {
    <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span> <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#565558" title="String">filename</a>).<span title="()Boolean">exists</span>) <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="(x$1: java.lang.String)Unit">println</span>(<span title="java.lang.String(&quot;That file does not exist&quot;)" class="string">&quot;That file does not exist&quot;</span>)
    <span class="keyword">else</span> <a href="#565559" title="(v1: String)Unit">action</a>(<a href="#565558" title="String">filename</a>)
  }
  
  <span class="keyword">def</span> <a title="(arg: String)scala.tools.nsc.InterpreterControl.Result" id="127973">load</a>(<a title="String" id="565554">arg</a>: <span title="String">String</span>) = {
    <span class="keyword">var</span> <a title="Option[String]" id="565557">shouldReplay</a>: <span title="Option[String]">Option</span>[String] = <span title="object None">None</span>
    <a href="#127972" title="(filename: String)(action: (String) =&gt; Unit)Unit">withFile</a>(<a href="#565554" title="String">arg</a>)(<a title="String" id="565564">f</a> =&gt; {
      <a href="#127970" title="(filename: String)Unit">interpretAllFrom</a>(<a href="#565564" title="String">f</a>)
      <a href="#565557" title="Option[String]">shouldReplay</a> = <span title="(x: java.lang.String)Some[java.lang.String]">Some</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;:load &quot;</span> + <a href="#565554" title="String">arg</a>)
    })
    <a href="#564393" title="(keepRunning: Boolean,lineToRecord: Option[String])scala.tools.nsc.InterpreterControl.Result">Result</a>(<span title="Boolean(true)" class="keyword">true</span>, <a href="#565557" title="Option[String]">shouldReplay</a>)
  }
  

  <span class="keyword">def</span> <a title="(arg: String)Unit" id="127974">addJar</a>(<a title="String" id="565513">arg</a>: <span title="String">String</span>): <span title="Unit">Unit</span> = {
    <span class="keyword">val</span> <a title="java.io.File" id="566109">f</a> = <span title="java.io.File" class="keyword">new</span> java.io.<span title="java.io.File">File</span>(<a href="#565513" title="String">arg</a>)
    <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#566109" title="java.io.File">f</a>.<span title="()Boolean">exists</span>) {
      <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="(x$1: java.lang.String)Unit">println</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;The file '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#566109" title="java.io.File">f</a> + <span title="java.lang.String(&quot;' doesn't seem to exist.&quot;)" class="string">&quot;' doesn't seem to exist.&quot;</span>)
      <span title="Nothing" class="keyword">return</span>
    }
    <a href="#127945" title="(x$1: List[String])Unit">addedClasspath</a> = <a href="#127945" title="=&gt; List[String]">addedClasspath</a> <a href="#566128" title="List[String]">:::</a> <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span title="(prefix: List[java.lang.String])List[java.lang.String]">(</span><a href="#566109" title="java.io.File">f</a>.<span title="()java.lang.String">getCanonicalPath</span>)
    <span title="(x: Any)Unit">println</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Added &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#566109" title="java.io.File">f</a>.<span title="()java.lang.String">getCanonicalPath</span> + <span title="java.lang.String(&quot; to your classpath.&quot;)" class="string">&quot; to your classpath.&quot;</span>)
    <a href="#127971" title="()Unit">replay</a>()
  }
  
  <span class="keyword">def</span> <a title="()String" id="127975">power</a>() = {
    <a href="#127964" title="(x$1: Boolean)Unit">powerUserOn</a> = <span title="Boolean(true)" class="keyword">true</span>
    <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117756" title="()String">powerUser</a>()
  }
  
  <span class="keyword">def</span> <a title="()Unit" id="127976">verbosity</a>() = {
    <span class="keyword">val</span> <a title="Boolean" id="565746">old</a> = <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117686" title="=&gt; Boolean">printResults</a>
    <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117687" title="(x$1: Boolean)Unit">printResults</a> = <span title="=&gt; Boolean">!</span><a href="#565746" title="Boolean">old</a>
    <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="(x$1: java.lang.String)Unit">println</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Switched &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> (<span title="Any" class="keyword">if</span> (<a href="#565746" title="Boolean">old</a>) <span title="java.lang.String(&quot;off&quot;)" class="string">&quot;off&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;on&quot;)" class="string">&quot;on&quot;</span>) + <span title="java.lang.String(&quot; result printing.&quot;)" class="string">&quot; result printing.&quot;</span>)
  }
  
  /** Run one command submitted by the user.  Two values are returned:
    * (1) whether to keep running, (2) the line to record for replay,
    * if any. */
  <span class="keyword">def</span> <a title="(line: String)scala.tools.nsc.InterpreterControl.Result" id="127977">command</a>(<a title="String" id="565896">line</a>: <span title="String">String</span>): <a href="#564393" title="scala.tools.nsc.InterpreterControl.Result">Result</a> = {
    <span class="keyword">def</span> <a title="(msg: String)scala.tools.nsc.InterpreterControl.Result" id="566161">withError</a>(<a title="String" id="566167">msg</a>: <span title="String">String</span>) = {
      <a href="#128008" title="(x$1: java.lang.String)Unit">out</a> println <a href="#566167" title="String">msg</a>
      <a href="#564393" title="(keepRunning: Boolean,lineToRecord: Option[String])scala.tools.nsc.InterpreterControl.Result">Result</a>(<span title="Boolean(true)" class="keyword">true</span>, <span title="object None">None</span>)
    }
    <span class="keyword">def</span> <a title="(cmds: List[scala.tools.nsc.InterpreterControl.Command])java.lang.String" id="566162">ambiguous</a>(<a title="List[scala.tools.nsc.InterpreterControl.Command]" id="566184">cmds</a>: <span title="List[scala.tools.nsc.InterpreterControl.Command]">List</span>[Command]) = <span title="(x$1: Any)java.lang.String" class="string">&quot;Ambiguous: did you mean &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#566184" title="List[scala.tools.nsc.InterpreterControl.Command]">cmds</a>.<span title="(f: (scala.tools.nsc.InterpreterControl.Command) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[scala.tools.nsc.InterpreterControl.Command]])List[java.lang.String]">map</span><span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">(</span><span title="(x$1: Any)java.lang.String" class="string">&quot;:&quot;</span> + <a href="#566193" title="scala.tools.nsc.InterpreterControl.Command">_</a>.<a href="#564421" title="=&gt; String">name</a>).<span title="(sep: String)String">mkString</span>(<span title="java.lang.String(&quot; or &quot;)" class="string">&quot; or &quot;</span>) + <span title="java.lang.String(&quot;?&quot;)" class="string">&quot;?&quot;</span>

    // not a command
    <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#565896" title="String">line</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span>(<span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span>))
      <span title="Nothing" class="keyword">return</span> <a href="#564393" title="(keepRunning: Boolean,lineToRecord: Option[String])scala.tools.nsc.InterpreterControl.Result">Result</a>(<span title="Boolean(true)" class="keyword">true</span>, <a href="#127978" title="(code: String)Option[String]">interpretStartingWith</a>(<a href="#565896" title="String">line</a>))

    <span class="keyword">val</span> <a title="List[java.lang.String]" id="566163">tokens</a> = <a href="#565896" title="String">line</a>.<a title="(x$1: Int)java.lang.String" id="7083">substring</a>(<span title="Int(1)" class="int">1</span>).<a title="(x$1: java.lang.String)Array[java.lang.String]" id="7112">split</a>(<span title="java.lang.String(&quot;\s+&quot;)" class="string">&quot;&quot;&quot;\s+&quot;&quot;&quot;</span>).<span title="=&gt; List[java.lang.String]">toList</span>
    <span title="Unit" class="keyword">if</span> (<a href="#566163" title="List[java.lang.String]">tokens</a>.<span title="=&gt; Boolean">isEmpty</span>)
      <span title="Nothing" class="keyword">return</span> <a href="#566161" title="(msg: String)scala.tools.nsc.InterpreterControl.Result">withError</a>(<a href="#566162" title="(cmds: List[scala.tools.nsc.InterpreterControl.Command])java.lang.String">ambiguous</a>(<a href="#127968" title="=&gt; List[scala.tools.nsc.InterpreterControl.Command]">commands</a>))
    
    <span class="keyword">val</span> (<a href="#566164" title="java.lang.String" id="566165">cmd</a> <a href="#566165" title="(java.lang.String, List[java.lang.String])">::</a> <a href="#566164" title="List[java.lang.String]" id="566166">args</a>) = <a href="#566163" title="List[java.lang.String]">tokens</a>
    
    // this lets us add commands willy-nilly and only requires enough command to disambiguate
    <a href="#127968" title="=&gt; List[scala.tools.nsc.InterpreterControl.Command]">commands</a>.<span title="(p: (scala.tools.nsc.InterpreterControl.Command) =&gt; Boolean)List[scala.tools.nsc.InterpreterControl.Command]">filter</span>(<a href="#566338" title="scala.tools.nsc.InterpreterControl.Command">_</a>.<a href="#564421" title="(x$1: java.lang.String)Boolean">name</a> startsWith <a href="#566165" title="java.lang.String">cmd</a>) <span title="scala.tools.nsc.InterpreterControl.Result" class="keyword">match</span> {
      <span title="scala.tools.nsc.InterpreterControl.Result" class="keyword">case</span> <a href="#566346" title="(x: List[scala.tools.nsc.InterpreterControl.Command])Some[List[scala.tools.nsc.InterpreterControl.Command]]" id="24568">List</a>(<a title="scala.tools.nsc.InterpreterControl.Command" id="566355">x</a>)  =&gt; <a href="#566355" title="(v1: List[String])scala.tools.nsc.InterpreterControl.Result">x</a>(<a href="#566166" title="List[java.lang.String]">args</a>)
      <span title="scala.tools.nsc.InterpreterControl.Result" class="keyword">case</span> <span title="object Nil">Nil</span>      =&gt; <a href="#566161" title="(msg: String)scala.tools.nsc.InterpreterControl.Result">withError</a>(<span title="java.lang.String(&quot;Unknown command.  Type :help for help.&quot;)" class="string">&quot;Unknown command.  Type :help for help.&quot;</span>)
      <span title="scala.tools.nsc.InterpreterControl.Result" class="keyword">case</span> <a title="List[scala.tools.nsc.InterpreterControl.Command]" id="566362">xs</a>       =&gt; <a href="#566161" title="(msg: String)scala.tools.nsc.InterpreterControl.Result">withError</a>(<a href="#566162" title="(cmds: List[scala.tools.nsc.InterpreterControl.Command])java.lang.String">ambiguous</a>(<a href="#566362" title="List[scala.tools.nsc.InterpreterControl.Command]">xs</a>))
    }
  }
  
  /** Interpret expressions starting with the first line.
    * Read lines until a complete compilation unit is available
    * or until a syntax error has been seen.  If a full unit is
    * read, go ahead and interpret it.  Return the full string
    * to be recorded for replay, if any.
    */
  <span class="keyword">def</span> <a title="(code: String)Option[String]" id="127978">interpretStartingWith</a>(<a title="String" id="566300">code</a>: <span title="String">String</span>): <span title="Option[String]">Option</span>[String] =
    <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117737" title="(line: String)scala.tools.nsc.InterpreterResults.Result">interpret</a>(<a href="#566300" title="String">code</a>) <span title="Option[String]" class="keyword">match</span> {
      <span title="None.type" class="keyword">case</span> <a href="InterpreterResults.scala.html#8446" title="object scala.tools.nsc.InterpreterResults">IR</a>.<a href="InterpreterResults.scala.html#123003" title="object scala.tools.nsc.InterpreterResults.Error">Error</a>       =&gt; <span title="object None">None</span>
      <span title="Some[String]" class="keyword">case</span> <a href="InterpreterResults.scala.html#8446" title="object scala.tools.nsc.InterpreterResults">IR</a>.<a href="InterpreterResults.scala.html#123001" title="object scala.tools.nsc.InterpreterResults.Success">Success</a>     =&gt; <span title="(x: String)Some[String]">Some</span>(<a href="#566300" title="String">code</a>)
      <span title="Option[String]" class="keyword">case</span> <a href="InterpreterResults.scala.html#8446" title="object scala.tools.nsc.InterpreterResults">IR</a>.<a href="InterpreterResults.scala.html#123005" title="object scala.tools.nsc.InterpreterResults.Incomplete">Incomplete</a>  =&gt;
        <span title="Option[String]" class="keyword">if</span> (<a href="#127933" title="=&gt; scala.tools.nsc.interpreter.InteractiveReader">in</a>.<a href="interpreter/InteractiveReader.scala.html#564197" title="(x$1: Boolean)Boolean">interactive</a> &amp;&amp; <a href="#566300" title="String">code</a>.<a title="(x$1: java.lang.String)Boolean" id="7044">endsWith</a>(<span title="java.lang.String(&quot;\012\012&quot;)" class="string">&quot;\n\n&quot;</span>)) {
          <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="(x$1: java.lang.String)Unit">println</span>(<span title="java.lang.String(&quot;You typed two blank lines.  Starting a new command.&quot;)" class="string">&quot;You typed two blank lines.  Starting a new command.&quot;</span>)
          <span title="object None">None</span>
        } 
        <span class="keyword">else</span> <a href="#127933" title="=&gt; scala.tools.nsc.interpreter.InteractiveReader">in</a>.<a href="interpreter/InteractiveReader.scala.html#564198" title="(prompt: String)String">readLine</a>(<span title="java.lang.String(&quot;     | &quot;)" class="string">&quot;     | &quot;</span>) <span title="Option[String]" class="keyword">match</span> {
          <span title="None.type" class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> =&gt; <span title="object None">None</span>         // end of file
          <span title="Option[String]" class="keyword">case</span> <a title="String" id="566386">line</a> =&gt; <a href="#127978" title="(code: String)Option[String]">interpretStartingWith</a>(<a href="#566300" title="(x$1: Any)java.lang.String">code</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> + <a href="#566386" title="String">line</a>)
        }
    }

  // runs :load &lt;file&gt; on any files passed via -i
  <span class="keyword">def</span> <a title="(settings: scala.tools.nsc.Settings)Unit" id="127979">loadFiles</a>(<a title="scala.tools.nsc.Settings" id="566393">settings</a>: <a href="Settings.scala.html#8775" title="scala.tools.nsc.Settings">Settings</a>) = <a href="#566393" title="scala.tools.nsc.Settings">settings</a> <span title="Unit" class="keyword">match</span> {
    <span title="Unit" class="keyword">case</span> <a title="scala.tools.nsc.GenericRunnerSettings" id="566396">settings</a>: <a href="GenericRunnerSettings.scala.html#9408" title="scala.tools.nsc.GenericRunnerSettings">GenericRunnerSettings</a> =&gt;
      <span class="keyword">for</span> (<a title="String" id="566414">filename</a> &lt;- <a href="#566396" title="scala.tools.nsc.GenericRunnerSettings">settings</a>.<a href="GenericRunnerSettings.scala.html#132166" title="=&gt; scala.tools.nsc.Settings.MultiStringSetting">loadfiles</a>.<a href="Settings.scala.html#37988" title="(f: (String) =&gt; Unit)Unit">value</a>) {
        <span class="keyword">val</span> <a title="java.lang.String" id="566415">cmd</a> = <span title="(x$1: Any)java.lang.String" class="string">&quot;:load &quot;</span> + <a href="#566414" title="String">filename</a>
        <a href="#127977" title="(line: String)scala.tools.nsc.InterpreterControl.Result">command</a>(<a href="#566415" title="java.lang.String">cmd</a>)
        <a href="#127948" title="(x$1: List[String])Unit">replayCommandsRev</a> = <a href="#566415" title="java.lang.String">cmd</a> <a href="#566420" title="java.lang.String">::</a> <a href="#127948" title="(x: String)List[String]">replayCommandsRev</a>
        <a href="#128008" title="java.io.PrintWriter">out</a>.<span title="()Unit">println</span>()
      }
    <span title="Unit" class="keyword">case</span> _ =&gt;
  }

  <span class="keyword">def</span> <a title="(settings: scala.tools.nsc.Settings)Unit" id="127980">main</a>(<a title="scala.tools.nsc.Settings" id="135376">settings</a>: <a href="Settings.scala.html#8775" title="scala.tools.nsc.Settings">Settings</a>) {
    <a href="#9141" title="InterpreterLoop.this.type" class="keyword">this</a>.<a href="#127938" title="(x$1: scala.tools.nsc.Settings)Unit">settings</a> = <a href="#135376" title="scala.tools.nsc.Settings">settings</a>
    <a href="#127953" title="()Unit">createInterpreter</a>()
    
    // sets in to some kind of reader depending on environmental cues
    <a href="#127933" title="(x$1: scala.tools.nsc.interpreter.InteractiveReader)Unit">in</a> = <a href="#128007" title="Option[java.io.BufferedReader]">in0</a> <span title="scala.tools.nsc.interpreter.InteractiveReader" class="keyword">match</span> {
      <span title="scala.tools.nsc.interpreter.SimpleReader" class="keyword">case</span> Some(<a title="java.io.BufferedReader" id="566478">in0</a>)  =&gt; <span title="scala.tools.nsc.interpreter.SimpleReader" class="keyword">new</span> <a href="interpreter/SimpleReader.scala.html#22334" title="scala.tools.nsc.interpreter.SimpleReader">SimpleReader</a>(<a href="#566478" title="java.io.BufferedReader">in0</a>, <a href="#128008" title="java.io.PrintWriter">out</a>, <span title="Boolean(true)" class="keyword">true</span>)
      <span title="scala.tools.nsc.interpreter.InteractiveReader" class="keyword">case</span> <span title="object None">None</span>       =&gt;
        <span class="keyword">val</span> <a title="Boolean" id="566485">emacsShell</a> = <a title="object java.lang.System" id="1651">System</a>.<a title="(x$1: java.lang.String,x$2: java.lang.String)java.lang.String" id="65329">getProperty</a><a title="(x$1: AnyRef)Boolean" id="6609">(</a><span title="java.lang.String(&quot;env.emacs&quot;)" class="string">&quot;env.emacs&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>) != <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
        
        // the interpeter is passed as an argument to expose tab completion info
        <span title="scala.tools.nsc.interpreter.InteractiveReader" class="keyword">if</span> (<a href="#135376" title="scala.tools.nsc.Settings">settings</a>.<a href="Settings.scala.html#37295" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">Xnojline</a>.<a href="Settings.scala.html#37988" title="(x$1: Boolean)Boolean">value</a> || <a href="#566485" title="Boolean">emacsShell</a>) <a href="interpreter/SimpleReader.scala.html#564208" title="()scala.tools.nsc.interpreter.SimpleReader" class="keyword">new</a> <a href="interpreter/SimpleReader.scala.html#22334" title="scala.tools.nsc.interpreter.SimpleReader">SimpleReader</a>
        <span class="keyword">else</span> <span title="scala.tools.nsc.interpreter.InteractiveReader" class="keyword">if</span> (<a href="#135376" title="scala.tools.nsc.Settings">settings</a>.<a href="Settings.scala.html#37341" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">noCompletion</a>.<a href="Settings.scala.html#37988" title="=&gt; settings.noCompletion.T">value</a>) <a href="interpreter/InteractiveReader.scala.html#22275" title="object scala.tools.nsc.interpreter.InteractiveReader">InteractiveReader</a>.<a href="interpreter/InteractiveReader.scala.html#128035" title="()scala.tools.nsc.interpreter.InteractiveReader">createDefault</a>()
        <span class="keyword">else</span> <a href="interpreter/InteractiveReader.scala.html#22275" title="object scala.tools.nsc.interpreter.InteractiveReader">InteractiveReader</a>.<a href="interpreter/InteractiveReader.scala.html#128036" title="(interpreter: scala.tools.nsc.Interpreter)scala.tools.nsc.interpreter.InteractiveReader">createDefault</a>(<a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>)
    }

    <a href="#127979" title="(settings: scala.tools.nsc.Settings)Unit">loadFiles</a>(<a href="#135376" title="scala.tools.nsc.Settings">settings</a>)
    <span class="keyword">try</span> {
      // it is broken on startup; go ahead and exit
      <span title="Unit" class="keyword">if</span> (<a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117694" title="object scala.tools.nsc.Interpreter#reporter">reporter</a>.<a href="reporters/Reporter.scala.html#39006" title="=&gt; Boolean">hasErrors</a>) <span title="Nothing" class="keyword">return</span>
      
      <a href="#127956" title="()Unit">printWelcome</a>()
      <a href="#127969" title="()Unit">repl</a>()
    } <span class="keyword">finally</span> {
      <a href="#127952" title="()Unit">closeInterpreter</a>()
    }
  }

  // injects one value into the repl; returns pair of name and class
  <span class="keyword">def</span> <a title="(name: String,obj: Any)(String, String)" id="127981">injectOne</a>(<a title="String" id="566533">name</a>: <span title="String">String</span>, <a title="Any" id="566534">obj</a>: <a title="Any" id="49">Any</a>): <span title="(String, String)">Tuple2</span>[String, String] = {
    <span class="keyword">val</span> <a title="java.lang.String" id="566536">className</a> = <a href="#566534" title="Any">obj</a>.<span title="[T0]T0">asInstanceOf</span><span title="AnyRef">[</span><a title="AnyRef" id="1779">AnyRef</a>].<a title="()java.lang.Class[_]" id="3649">getClass</a>.<a title="()java.lang.String" id="4130">getName</a>     
    <a href="#127941" title="=&gt; scala.tools.nsc.Interpreter">interpreter</a>.<a href="Interpreter.scala.html#117740" title="(name: String,boundType: String,value: Any)scala.tools.nsc.InterpreterResults.Result">bind</a>(<a href="#566533" title="String">name</a>, <a href="#566536" title="java.lang.String">className</a>, <a href="#566534" title="Any">obj</a>)
    <span title="(_1: String,_2: java.lang.String)(String, java.lang.String)">(</span><a href="#566533" title="String">name</a>, <a href="#566536" title="java.lang.String">className</a>)
  }
  
  // injects list of values into the repl; returns summary string
  <span class="keyword">def</span> <a title="(args: List[Any])String" id="127982">inject</a>(<a title="List[Any]" id="566552">args</a>: <span title="List[Any]">List</span>[Any]): <span title="String">String</span> = {
    <span class="keyword">val</span> <a title="List[java.lang.String]" id="566554">strs</a> = 
      <span class="keyword">for</span> ((<a title="Any" id="566665">arg</a>, <a title="Int" id="566666">i</a>) &lt;- <a href="#566552" title="List[Any]">args</a>.<a href="#566641" title="(f: ((Any, Int)) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[(Any, Int)]])List[java.lang.String]" id="25621">zipWithIndex</a>) <span class="keyword">yield</span> {
        <span class="keyword">val</span> <a title="java.lang.String" id="566669">varName</a> = <span title="(x$1: Any)java.lang.String" class="string">&quot;p&quot;</span> + (<a href="#566666" title="(x$1: Int)Int" id="2985">i</a> + <span title="Int(1)" class="int">1</span>)
        <span class="keyword">val</span> <a href="#566671" title="(String, String)">(</a><a href="#566670" title="String" id="566671">vname</a>, <a href="#566670" title="String" id="566672">vtype</a>) = <a href="#127981" title="(name: String,obj: Any)(String, String)">injectOne</a><span title="(String, String) @unchecked">(</span><a href="#566669" title="java.lang.String">varName</a>, <a href="#566665" title="Any">arg</a>)
        <a href="#566671" title="(x$1: Any)java.lang.String">vname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> + <a href="#566672" title="String">vtype</a>
      }
    
    <span title="String" class="keyword">if</span> (<a href="#566554" title="List[java.lang.String]">strs</a>.<span title="(x$1: Int)Boolean">size</span> == <span title="Int(0)" class="int">0</span>) <span title="java.lang.String(&quot;Set no variables.&quot;)" class="string">&quot;Set no variables.&quot;</span>
    <span class="keyword">else</span> <span title="(x$1: Any)java.lang.String" class="string">&quot;Variables set:\n&quot;</span> + <a href="#566554" title="List[java.lang.String]">strs</a>.<span title="(sep: String)String">mkString</span>(<span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>)
  }
  
  /** process command-line arguments and do as they request */
  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="127983">main</a>(<a title="Array[String]" id="135374">args</a>: <a title="Array[String]" id="905">Array</a>[String]) {
    <span class="keyword">def</span> <a title="(msg: String)Unit" id="566799">error1</a>(<a title="String" id="566802">msg</a>: <span title="String">String</span>) = <a href="#128008" title="(x$1: java.lang.String)Unit">out</a> println (<span title="(x$1: Any)java.lang.String" class="string">&quot;scala: &quot;</span> + <a href="#566802" title="String">msg</a>)
    <span class="keyword">val</span> <a title="scala.tools.nsc.InterpreterCommand" id="566800">command</a> = <span title="scala.tools.nsc.InterpreterCommand" class="keyword">new</span> <a href="InterpreterCommand.scala.html#9297" title="scala.tools.nsc.InterpreterCommand">InterpreterCommand</a>(<a href="#135374" title="Array[String]">args</a>.<span title="=&gt; List[String]">toList</span>, <a href="#566799" title="(msg: String)Unit">error1</a>)
    <span class="keyword">def</span> <a title="()String" id="566801">neededHelp</a>(): <span title="String">String</span> =
      <span title="(x$1: Any)java.lang.String">(</span><span title="java.lang.String" class="keyword">if</span> (<a href="#566800" title="scala.tools.nsc.InterpreterCommand">command</a>.<a href="CompilerCommand.scala.html#142569" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="Settings.scala.html#37247" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">help</a>.<a href="Settings.scala.html#37988" title="=&gt; command.settings.help.T">value</a>) <a href="#566800" title="scala.tools.nsc.InterpreterCommand">command</a>.<a href="CompilerCommand.scala.html#142588" title="(x$1: Any)java.lang.String">usageMsg</a> + <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>) +
      (<span title="Any" class="keyword">if</span> (<a href="#566800" title="scala.tools.nsc.InterpreterCommand">command</a>.<a href="CompilerCommand.scala.html#142569" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="Settings.scala.html#37269" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">Xhelp</a>.<a href="Settings.scala.html#37988" title="=&gt; command.settings.Xhelp.T">value</a>) <a href="#566800" title="scala.tools.nsc.InterpreterCommand">command</a>.<a href="CompilerCommand.scala.html#142589" title="(x$1: Any)java.lang.String">xusageMsg</a> + <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
    
    // if they asked for no help and command is valid, we call the real main
    <a href="#566801" title="()String">neededHelp</a>() <span title="Unit" class="keyword">match</span> {
      <span title="Unit" class="keyword">case</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>     =&gt; <span title="Unit" class="keyword">if</span> (<a href="#566800" title="scala.tools.nsc.InterpreterCommand">command</a>.<a href="CompilerCommand.scala.html#142595" title="=&gt; Boolean">ok</a>) <a href="#127980" title="(settings: scala.tools.nsc.Settings)Unit">main</a>(<a href="#566800" title="scala.tools.nsc.InterpreterCommand">command</a>.<a href="CompilerCommand.scala.html#142569" title="=&gt; scala.tools.nsc.Settings">settings</a>) // else nothing
      <span title="Unit" class="keyword">case</span> <a title="String" id="566843">help</a>   =&gt; <a href="#128008" title="(x$1: java.lang.String)Unit" id="39145">out</a> print <a href="#566843" title="String">help</a> ; <a href="#128008" title="java.io.PrintWriter">out</a> <span title="()Unit">flush</span>
    }
  }
}

        </pre>
    </body>
</html>