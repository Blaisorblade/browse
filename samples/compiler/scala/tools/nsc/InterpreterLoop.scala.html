<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/InterpreterLoop.scala</title>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author Alexander Spoon
 */</span>
<span class="comment">// $Id: InterpreterLoop.scala 17455 2009-04-07 17:20:15Z extempore $</span>

<span class="keyword">package</span> scala.tools.nsc

<span class="keyword">import</span> java.io.{BufferedReader, File, FileReader, PrintWriter}
<span class="keyword">import</span> java.io.IOException
<span class="keyword">import</span> java.lang.{ClassLoader, System}

<span class="keyword">import</span> scala.tools.nsc.{InterpreterResults =&gt; IR}
<span class="keyword">import</span> scala.tools.nsc.interpreter._

<span class="comment">// Classes to wrap up interpreter commands and their results</span>
<span class="comment">// You can add new commands by adding entries to val commands</span>
<span class="comment">// inside InterpreterLoop.</span>
<span class="keyword">object</span> <span class="typed"><span class="type">object scala.tools.nsc.InterpreterControl</span><a id="6940">InterpreterControl</a></span> {
  <span class="comment">// the default result means &quot;keep running, and don't record that line&quot;</span>
  <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><span id="58115"><a id="58114">defaultResult</a></span></span> = <span class="typed"><span class="type">(Boolean,Option[String])scala.tools.nsc.InterpreterControl.Result</span><a href="#125233">Result</a></span>(<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>, <span class="typed"><span class="type">object None</span><a id="536">None</a></span>)
  
  <span class="comment">// a single interpreter command</span>
  <span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Command extends java.lang.Object with (List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result with ScalaObject</span><a id="58116">Command</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">(List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result</span><a id="181">Function1</a></span>[List[String], Result] {
    <span class="keyword">val</span> <span class="typed"><span class="type">=&gt; String</span><a id="125245">name</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">=&gt; String</span><a id="125246">help</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a id="125247">error</a></span>(<span class="typed"><span class="type">String</span><a id="125250">msg</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = {
      <span class="typed"><span class="type">(Any)Unit</span><span id="6112"><a id="821">println</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;:&quot;)</span><span class="string">&quot;:&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; String</span><a href="#125245">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; &quot;)</span><span class="string">&quot; &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#125250">msg</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;.&quot;)</span><span class="string">&quot;.&quot;</span></span>)
      <span class="typed"><span class="type">(Boolean,Option[String])scala.tools.nsc.InterpreterControl.Result</span><a href="#125233">Result</a></span>(<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>, <span class="typed"><span class="type">object None</span><a id="536">None</a></span>)
    }
    <span class="keyword">def</span> <span class="typed"><span class="type">()String</span><a id="125248">getHelp</a></span>(): <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;:&quot;)</span><span class="string">&quot;:&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; String</span><a href="#125245">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; &quot;)</span><span class="string">&quot; &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; String</span><a href="#125246">help</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;.&quot;)</span><span class="string">&quot;.&quot;</span></span>
  }
  
  <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class NoArgs extends scala.tools.nsc.InterpreterControl.Command with ScalaObject with Product</span><span id="125291"><span id="2751"><span id="125274"><span id="23590"><span id="125292"><span id="29737"><span id="125273"><span id="3500"><span id="29815"><span id="125293"><span id="2750"><span id="29856"><span id="125279"><span id="125285"><span id="308"><span id="449"><span id="125278"><span id="125286"><span id="3501"><span id="125294"><span id="125277"><span id="125287"><span id="58117"><span id="5794"><span id="125275"><span id="58118"><a id="3509">NoArgs</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">String</span><span id="125257"><span id="125256"><span id="125268"><a id="125466">name</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">String</span><span id="125259"><span id="125258"><span id="125269"><a id="125467">help</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">() =&gt; scala.tools.nsc.InterpreterControl.Result</span><span id="125261"><span id="125260"><span id="125270"><a id="125468">f</a></span></span></span></span>: () =&gt; Result) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Command</span><a href="#58116">Command</a></span> {
    <span class="keyword">def</span> <span class="typed"><span class="type">(List[String])scala.tools.nsc.InterpreterControl.Result</span><a id="125263">apply</a></span>(<span class="typed"><span class="type">List[String]</span><a id="125271">args</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) = <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[String]</span><a href="#125271">args</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="21645">isEmpty</a></span>) <span class="typed"><span class="type">()scala.tools.nsc.InterpreterControl.Result</span><a href="#125260" id="31093">f</a></span>() <span class="keyword">else</span> <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125247">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;accepts no arguments&quot;)</span><span class="string">&quot;accepts no arguments&quot;</span></span>)
  }
  
  <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class LineArg extends scala.tools.nsc.InterpreterControl.Command with ScalaObject with Product</span><span id="2751"><span id="125339"><span id="125324"><span id="125319"><span id="23590"><span id="125332"><span id="29737"><span id="125338"><span id="3500"><span id="29815"><span id="125337"><span id="125330"><span id="2750"><span id="29856"><span id="58121"><span id="308"><span id="449"><span id="125331"><span id="125318"><span id="3501"><span id="58120"><span id="125323"><span id="125320"><span id="125322"><span id="125336"><span id="5794"><a id="3509">LineArg</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">String</span><span id="125300"><span id="125299"><span id="125311"><a id="125462">name</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">String</span><span id="125302"><span id="125301"><span id="125312"><a id="125463">help</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">(String) =&gt; scala.tools.nsc.InterpreterControl.Result</span><span id="125304"><span id="125303"><span id="125313"><a id="125464">f</a></span></span></span></span>: (String) =&gt; Result) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Command</span><a href="#58116">Command</a></span> {
    <span class="keyword">def</span> <span class="typed"><span class="type">(List[String])scala.tools.nsc.InterpreterControl.Result</span><a id="125306">apply</a></span>(<span class="typed"><span class="type">List[String]</span><a id="125314">args</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) =
      <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[String]</span><a href="#125314">args</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125303" id="21757">f</a></span>(<span class="typed"><span class="type">List[String]</span><a href="#125314">args</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="21332">head</a></span>)
      <span class="keyword">else</span> <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125247">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;requires a line of input&quot;)</span><span class="string">&quot;requires a line of input&quot;</span></span>)
  }

  <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class OneArg extends scala.tools.nsc.InterpreterControl.Command with ScalaObject with Product</span><span id="2751"><span id="58124"><span id="23590"><span id="125364"><span id="29737"><span id="125383"><span id="3500"><span id="125367"><span id="29815"><span id="125376"><span id="125369"><span id="125368"><span id="2750"><span id="29856"><span id="125375"><span id="125381"><span id="308"><span id="449"><span id="125363"><span id="125382"><span id="3501"><span id="58123"><span id="125384"><span id="125377"><span id="5794"><span id="125365"><a id="3509">OneArg</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">String</span><span id="125345"><span id="125344"><span id="125356"><a id="125458">name</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">String</span><span id="125347"><span id="125346"><span id="125357"><a id="125459">help</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">(String) =&gt; scala.tools.nsc.InterpreterControl.Result</span><span id="125349"><span id="125348"><span id="125358"><a id="125460">f</a></span></span></span></span>: (String) =&gt; Result) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Command</span><a href="#58116">Command</a></span> {
    <span class="keyword">def</span> <span class="typed"><span class="type">(List[String])scala.tools.nsc.InterpreterControl.Result</span><a id="125351">apply</a></span>(<span class="typed"><span class="type">List[String]</span><a id="125359">args</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) =
      <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[String]</span><a href="#125359">args</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125348" id="21757">f</a></span>(<span class="typed"><span class="type">List[String]</span><a href="#125359">args</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="21332">head</a></span>)
      <span class="keyword">else</span> <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125247">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;requires exactly one argument&quot;)</span><span class="string">&quot;requires exactly one argument&quot;</span></span>)
  }

  <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class VarArgs extends scala.tools.nsc.InterpreterControl.Command with ScalaObject with Product</span><span id="125420"><span id="2751"><span id="23590"><span id="125411"><span id="29737"><span id="125419"><span id="3500"><span id="58127"><span id="125412"><span id="29815"><span id="125418"><span id="125407"><span id="2750"><span id="29856"><span id="125424"><span id="125427"><span id="125410"><span id="308"><span id="449"><span id="3501"><span id="125406"><span id="125425"><span id="125408"><span id="125426"><span id="58126"><span id="5794"><a id="3509">VarArgs</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">String</span><span id="125390"><span id="125389"><span id="125401"><a id="125454">name</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">String</span><span id="125392"><span id="125391"><span id="125402"><a id="125455">help</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">(List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result</span><span id="125394"><span id="125393"><span id="125403"><a id="125456">f</a></span></span></span></span>: (List[String]) =&gt; Result) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Command</span><a href="#58116">Command</a></span> {
    <span class="keyword">def</span> <span class="typed"><span class="type">(List[String])scala.tools.nsc.InterpreterControl.Result</span><a id="125396">apply</a></span>(<span class="typed"><span class="type">List[String]</span><a id="125404">args</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) = <span class="typed"><span class="type">(List[String])scala.tools.nsc.InterpreterControl.Result</span><a href="#125393" id="21757">f</a></span>(<span class="typed"><span class="type">List[String]</span><a href="#125404">args</a></span>)
  }

  <span class="comment">// the result of a single command</span>
  <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Result extends java.lang.Object with ScalaObject with Product</span><span id="125437"><span id="2751"><span id="125447"><span id="125241"><span id="125443"><span id="58130"><span id="3509"><span id="125444"><span id="125450"><span id="125434"><span id="29737"><span id="29814"><span id="3500"><span id="29815"><span id="2748"><span id="23625"><span id="2750"><span id="29856"><span id="1379"><span id="308"><span id="58129"><span id="3501"><span id="125438"><span id="125435"><span id="125233"><span id="125436"><span id="5794"><span id="125448"><a id="125449">Result</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">Boolean</span><span id="125237"><span id="125236"><span id="125432"><a id="125242">keepRunning</a></span></span></span></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span>, <span class="typed"><span class="type">Option[String]</span><span id="125239"><span id="125238"><span id="125433"><a id="125243">lineToRecord</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String])
}
<span class="keyword">import</span> InterpreterControl._

<span class="comment">/** The 
 *  &lt;a href=&quot;http://scala-lang.org/&quot; target=&quot;_top&quot;&gt;Scala&lt;/a&gt;
 *  interactive shell.  It provides a read-eval-print loop around
 *  the Interpreter class.
 *  After instantiation, clients should call the &lt;code&gt;main()&lt;/code&gt; method.
 *
 *  &lt;p&gt;If no in0 is specified, then input will come from the console, and
 *  the class will attempt to provide input editing feature such as
 *  input history.
 *
 *  @author Moez A. Abdel-Gawad
 *  @author  Lex Spoon
 *  @version 1.2
 */</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class InterpreterLoop extends java.lang.Object with ScalaObject</span><a id="7056">InterpreterLoop</a></span>(<span class="typed"><span class="type">Option[java.io.BufferedReader]</span><span id="58058"><a id="58132">in0</a></span></span>: <span class="typed"><span class="type">Option[java.io.BufferedReader]</span><a id="934">Option</a></span>[BufferedReader], <span class="typed"><span class="type">java.io.PrintWriter</span><span id="58059"><a id="58133">out</a></span></span>: <span class="typed"><span class="type">java.io.PrintWriter</span><a id="3759">PrintWriter</a></span>) {
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.BufferedReader,java.io.PrintWriter)scala.tools.nsc.InterpreterLoop</span><a id="58061" class="keyword">this</a></span>(<span class="typed"><span class="type">java.io.BufferedReader</span><a id="58111">in0</a></span>: <span class="typed"><span class="type">java.io.BufferedReader</span><a id="3549">BufferedReader</a></span>, <span class="typed"><span class="type">java.io.PrintWriter</span><a id="58112">out</a></span>: <span class="typed"><span class="type">java.io.PrintWriter</span><a id="3759">PrintWriter</a></span>) = <span class="typed"><span class="type">InterpreterLoop.this.type</span><a href="#7056" class="keyword">this</a></span>(<span class="typed"><span class="type">(java.io.BufferedReader)Some[java.io.BufferedReader]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.BufferedReader</span><a href="#58111">in0</a></span>), <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58112">out</a></span>)
  <span class="keyword">def</span> <span class="typed"><span class="type">()scala.tools.nsc.InterpreterLoop</span><a id="58062" class="keyword">this</a></span>() = <span class="typed"><span class="type">InterpreterLoop.this.type</span><a href="#7056" class="keyword">this</a></span>(<span class="typed"><span class="type">object None</span><a id="536">None</a></span>, <span class="typed"><span class="type">(java.io.OutputStream)java.io.PrintWriter</span><a id="28679" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.PrintWriter</span><a id="3759">PrintWriter</a></span>(<span class="typed"><span class="type">object Console</span><a id="440">Console</a></span>.<span class="typed"><span class="type">=&gt; java.io.PrintStream</span><a id="27043">out</a></span>))

  <span class="comment">/** The input stream from which commands come, set by main() */</span>
  <span class="keyword">var</span> <span class="typed"><span class="type">scala.tools.nsc.interpreter.InteractiveReader</span><span id="58065"><span id="58063"><span id="58064"><a id="125472">in</a></span></span></span></span>: <span class="typed"><span class="type">scala.tools.nsc.interpreter.InteractiveReader</span><a href="interpreter/InteractiveReader.scala.html#17669">InteractiveReader</a></span> = _

  <span class="comment">/** The context class loader at the time this object was created */</span>
  <span class="keyword">protected</span> <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.ClassLoader</span><span id="58067"><a id="58066">originalClassLoader</a></span></span> = <span class="typed"><span class="type">object java.lang.Thread</span><a id="2084">Thread</a></span>.<span class="typed"><span class="type">()java.lang.Thread</span><a id="29015">currentThread</a></span>.<span class="typed"><span class="type">()java.lang.ClassLoader</span><a id="29054">getContextClassLoader</a></span>
  
  <span class="keyword">var</span> <span class="typed"><span class="type">scala.tools.nsc.Settings</span><span id="58070"><span id="58068"><span id="58069"><a id="125473">settings</a></span></span></span></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span> = _          <span class="comment">// set by main()</span>
  <span class="keyword">var</span> <span class="typed"><span class="type">scala.tools.nsc.Interpreter</span><span id="58073"><span id="58071"><span id="58072"><a id="125474">interpreter</a></span></span></span></span>: <span class="typed"><span class="type">scala.tools.nsc.Interpreter</span><a href="Interpreter.scala.html#6405">Interpreter</a></span> = _    <span class="comment">// set by createInterpreter()</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; scala.tools.nsc.InterpreterSettings</span><a id="58074">isettings</a></span> = <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.InterpreterSettings</span><a href="Interpreter.scala.html#75373">isettings</a></span>

  <span class="comment">/** A reverse list of commands to replay if the user requests a :replay */</span>
  <span class="keyword">var</span> <span class="typed"><span class="type">List[String]</span><span id="58077"><span id="58075"><span id="58076"><a id="125475">replayCommandsRev</a></span></span></span></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String] = <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>

  <span class="comment">/** A list of commands to replay if the user requests a :replay */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; List[String]</span><a id="58078">replayCommands</a></span> = <span class="typed"><span class="type">=&gt; List[String]</span><a href="#58075">replayCommandsRev</a></span>.<span class="typed"><span class="type">=&gt; List[String]</span><a id="21385">reverse</a></span>

  <span class="comment">/** Record a command for replay should the user request a :replay */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="58079">addReplay</a></span>(<span class="typed"><span class="type">String</span><a id="125519">cmd</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">(List[String])Unit</span><a href="#58076">replayCommandsRev</a></span> = <span class="typed"><span class="type">String</span><a href="#125519">cmd</a></span> <span class="typed"><span class="type">(String)List[String]</span><a href="#125521" id="21335">::</a></span> <span class="typed"><span class="type">=&gt; List[String]</span><a href="#58075">replayCommandsRev</a></span>

  <span class="comment">/** Close the interpreter and set the var to &lt;code&gt;null&lt;/code&gt;. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="58080">closeInterpreter</a></span>() {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5795">ne</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
      <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">()Unit</span><a href="Interpreter.scala.html#75422">close</a></span>
      <span class="typed"><span class="type">(scala.tools.nsc.Interpreter)Unit</span><a href="#58072">interpreter</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
      <span class="typed"><span class="type">object java.lang.Thread</span><a id="2084">Thread</a></span>.<span class="typed"><span class="type">()java.lang.Thread</span><a id="29015">currentThread</a></span>.<span class="typed"><span class="type">(java.lang.ClassLoader)Unit</span><a id="29055">setContextClassLoader</a></span>(<span class="typed"><span class="type">=&gt; java.lang.ClassLoader</span><a href="#58066">originalClassLoader</a></span>)
    }
  }

  <span class="comment">/** Create a new interpreter. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="58081">createInterpreter</a></span>() {
    <span class="typed"><span class="type">(scala.tools.nsc.Interpreter)Unit</span><a href="#58072">interpreter</a></span> = <span class="typed"><span class="type">template $anon extends scala.tools.nsc.Interpreter</span><a id="125524" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.Interpreter</span><a href="Interpreter.scala.html#6405">Interpreter</a></span>(<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="#58068">settings</a></span>, <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>) {
      <span class="keyword">override</span> <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; java.lang.ClassLoader</span><a id="125526">parentClassLoader</a></span> = <span class="typed"><span class="type">java.lang.Class[scala.tools.nsc.InterpreterLoop]</span><span >classOf</span></span>[InterpreterLoop].<span class="typed"><span class="type">()java.lang.ClassLoader</span><a id="3949">getClassLoader</a></span>
    }
    <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">()Unit</span><a href="Interpreter.scala.html#75386">setContextClassLoader</a></span>()
  }

  <span class="comment">/** Bind the settings so that evaluated code can modify them */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="58082">bindSettings</a></span>() {
    <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">(=&gt; scala.tools.nsc.InterpreterResults.Result)scala.tools.nsc.InterpreterResults.Result</span><a href="Interpreter.scala.html#75370">beQuietDuring</a></span> {
      <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">(String)Boolean</span><a href="Interpreter.scala.html#75414">compileString</a></span>(<span class="typed"><span class="type">object scala.tools.nsc.InterpreterSettings</span><a href="InterpreterSettings.scala.html#6442">InterpreterSettings</a></span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="InterpreterSettings.scala.html#125546">sourceCodeForClass</a></span>)
      <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">(String,String,Any)scala.tools.nsc.InterpreterResults.Result</span><a href="Interpreter.scala.html#75420">bind</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;settings&quot;)</span><span class="string">&quot;settings&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;scala.tools.nsc.InterpreterSettings&quot;)</span><span class="string">&quot;scala.tools.nsc.InterpreterSettings&quot;</span></span>, <span class="typed"><span class="type">=&gt; scala.tools.nsc.InterpreterSettings</span><a href="#58074">isettings</a></span>)
    }
  }

  <span class="comment">/** print a friendly help message */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="58083">printHelp</a></span>() = {
    <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span> <span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span> <span class="typed"><span class="type">java.lang.String(&quot;All commands can be abbreviated - for example :h or :he instead of :help.\012&quot;)</span><span class="string">&quot;All commands can be abbreviated - for example :h or :he instead of :help.\n&quot;</span></span>
    <span class="typed"><span class="type">=&gt; List[scala.tools.nsc.InterpreterControl.Command]</span><a href="#58096">commands</a></span> <span class="typed"><span class="type">((scala.tools.nsc.InterpreterControl.Command) =&gt; Unit)Unit</span><a id="21366">foreach</a></span> { <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Command</span><a id="125566">c</a></span> =&gt; <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span> <span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Command</span><a href="#125566">c</a></span>.<span class="typed"><span class="type">()String</span><a href="#125248">getHelp</a></span> }
  }      
  
  <span class="comment">/** Print a welcome message */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="58084">printWelcome</a></span>() {
    <span class="keyword">import</span> Properties._
    <span class="keyword">val</span> <span class="typed"><span class="type">String</span><a id="125570">welcomeMsg</a></span> = 
     <span class="typed"><span class="type">implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString</span><span id="6140"><a id="821" class="string">&quot;&quot;&quot;|Welcome to Scala %s (%s, Java %s).
        |Type in expressions to have them evaluated.
        |Type :help for more information.&quot;&quot;&quot;</a></span></span> .
    <span class="typed"><span class="type">implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString</span><span id="6140"><span id="821"><a id="22848">stripMargin</a></span></span></span>.<span class="typed"><span class="type">(Any*)String</span><a id="23119">format</a></span>(<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="Properties.scala.html#7366" id="46629">versionString</a></span>, <span class="typed"><span class="type">=&gt; String</span><a href="Properties.scala.html#7366" id="46643">javaVmName</a></span>, <span class="typed"><span class="type">=&gt; String</span><a href="Properties.scala.html#7366" id="46649">javaVersion</a></span>)
        
    <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span> <span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span> <span class="typed"><span class="type">String</span><a href="#125570">welcomeMsg</a></span>
    <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="28685">flush</a></span>
  }
  
  <span class="comment">/** Prompt to print when awaiting input */</span>
  <span class="keyword">val</span> <span class="typed"><span class="type">String</span><span id="58086"><a id="58085">prompt</a></span></span> = <span class="typed"><span class="type">object scala.tools.nsc.Properties</span><a href="Properties.scala.html#7366">Properties</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="Properties.scala.html#46664">shellPromptString</a></span>

  <span class="comment">// most commands do not want to micromanage the Result, but they might want</span>
  <span class="comment">// to print something to the console, so we accomodate Unit and String returns.</span>
  <span class="keyword">object</span> <span class="typed"><span class="type">object InterpreterLoop.this.CommandImplicits</span><a id="58087">CommandImplicits</a></span> {
    <span class="keyword">implicit</span> <span class="keyword">def</span> <span class="typed"><span class="type">implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.u2ir : (Unit)scala.tools.nsc.InterpreterControl.Result</span><a id="125585">u2ir</a></span>(<span class="typed"><span class="type">Unit</span><a id="125588">x</a></span>: <span class="typed"><span class="type">Unit</span><a id="2169">Unit</a></span>): <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><a href="#58129">Result</a></span> = <span class="typed"><span class="type">=&gt; scala.tools.nsc.InterpreterControl.Result</span><a href="#58114">defaultResult</a></span>
    <span class="keyword">implicit</span> <span class="keyword">def</span> <span class="typed"><span class="type">implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.s2ir : (String)scala.tools.nsc.InterpreterControl.Result</span><a id="125586">s2ir</a></span>(<span class="typed"><span class="type">String</span><a id="125589">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><a href="#58129">Result</a></span> = {
      <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span> <span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span> <span class="typed"><span class="type">String</span><a href="#125589">s</a></span>
      <span class="typed"><span class="type">=&gt; scala.tools.nsc.InterpreterControl.Result</span><a href="#58114">defaultResult</a></span>
    }
  }
  
  <span class="comment">/** Standard commands **/</span>
  <span class="keyword">val</span> <span class="typed"><span class="type">List[scala.tools.nsc.InterpreterControl.Command]</span><span id="58090"><a id="58089">standardCommands</a></span></span>: <span class="typed"><span class="type">List[scala.tools.nsc.InterpreterControl.Command]</span><a id="526">List</a></span>[Command] = {
    <span class="keyword">import</span> CommandImplicits._
    <span class="typed"><span class="type">(scala.tools.nsc.InterpreterControl.Command with Product*)List[scala.tools.nsc.InterpreterControl.Command with Product]</span><span id="21328"><a id="527">List</a></span></span>(
       <span class="typed"><span class="type">(String,String,() =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.NoArgs</span><a href="#125277">NoArgs</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;help&quot;)</span><span class="string">&quot;help&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;prints this help message&quot;)</span><span class="string">&quot;prints this help message&quot;</span></span>, <span class="typed"><span class="type">implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.u2ir : (Unit)scala.tools.nsc.InterpreterControl.Result</span><a href="#125585">printHelp</a></span>),
       <span class="typed"><span class="type">(String,String,(String) =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.OneArg</span><a href="#125367">OneArg</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;load&quot;)</span><span class="string">&quot;load&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;followed by a filename loads a Scala file&quot;)</span><span class="string">&quot;followed by a filename loads a Scala file&quot;</span></span>, <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#58101">load</a></span>),
       <span class="typed"><span class="type">(String,String,() =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.NoArgs</span><a href="#125277">NoArgs</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;replay&quot;)</span><span class="string">&quot;replay&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;resets execution and replays all previous commands&quot;)</span><span class="string">&quot;resets execution and replays all previous commands&quot;</span></span>, <span class="typed"><span class="type">implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.u2ir : (Unit)scala.tools.nsc.InterpreterControl.Result</span><a href="#125585">replay</a></span>),
       <span class="typed"><span class="type">(String,String,() =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.NoArgs</span><a href="#125277">NoArgs</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;quit&quot;)</span><span class="string">&quot;quit&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;exits the interpreter&quot;)</span><span class="string">&quot;exits the interpreter&quot;</span></span>, () =&gt; <span class="typed"><span class="type">(Boolean,Option[String])scala.tools.nsc.InterpreterControl.Result</span><a href="#125233">Result</a></span>(<span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>, <span class="typed"><span class="type">object None</span><a id="536">None</a></span>)),
       <span class="typed"><span class="type">(String,String,() =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.NoArgs</span><a href="#125277">NoArgs</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;power&quot;)</span><span class="string">&quot;power&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;enable power user mode&quot;)</span><span class="string">&quot;enable power user mode&quot;</span></span>, <span class="typed"><span class="type">implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.s2ir : (String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125586">power</a></span>)
    )
  }
  
  <span class="comment">/** Power user commands */</span>
  <span class="comment">// XXX - why does a third argument like &quot;interpreter dumpState(_)&quot; throw an NPE</span>
  <span class="comment">// while the version below works?</span>
  <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="58093"><span id="58091"><span id="58092"><a id="125476">powerUserOn</a></span></span></span></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
  <span class="keyword">val</span> <span class="typed"><span class="type">List[scala.tools.nsc.InterpreterControl.Command]</span><span id="58095"><a id="58094">powerCommands</a></span></span>: <span class="typed"><span class="type">List[scala.tools.nsc.InterpreterControl.Command]</span><a id="526">List</a></span>[Command] = {
    <span class="keyword">import</span> CommandImplicits._
    <span class="typed"><span class="type">(scala.tools.nsc.InterpreterControl.VarArgs*)List[scala.tools.nsc.InterpreterControl.VarArgs]</span><span id="21328"><a id="527">List</a></span></span>(
      <span class="typed"><span class="type">(String,String,(List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.VarArgs</span><a href="#125410">VarArgs</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;dump&quot;)</span><span class="string">&quot;dump&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;displays a view of the interpreter's internal state&quot;)</span><span class="string">&quot;displays a view of the interpreter's internal state&quot;</span></span>, 
        (<span class="typed"><span class="type">List[String]</span><a id="125626">xs</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) =&gt; <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span> <span class="typed"><span class="type">implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.s2ir : (String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125586">dumpState</a></span> <span class="typed"><span class="type">List[String]</span><a href="#125626">xs</a></span>),
      <span class="typed"><span class="type">(String,String,(List[String]) =&gt; scala.tools.nsc.InterpreterControl.Result)scala.tools.nsc.InterpreterControl.VarArgs</span><a href="#125410">VarArgs</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;tree&quot;)</span><span class="string">&quot;tree&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;displays ASTs for specified identifiers&quot;)</span><span class="string">&quot;displays ASTs for specified identifiers&quot;</span></span>,
        (<span class="typed"><span class="type">List[String]</span><a id="125630">xs</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) =&gt; <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span> <span class="typed"><span class="type">implicit scala.tools.nsc.InterpreterLoop.CommandImplicits.s2ir : (String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125586">dumpTrees</a></span> <span class="typed"><span class="type">List[String]</span><a href="#125630">xs</a></span>)
      <span class="comment">// LineArg(&quot;meta&quot;, &quot;given code which produces scala code, executes the results&quot;,</span>
      <span class="comment">//   (xs: List[String]) =&gt; )</span>
    )
  }
  
  <span class="comment">/** Available commands */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; List[scala.tools.nsc.InterpreterControl.Command]</span><a id="58096">commands</a></span>: <span class="typed"><span class="type">List[scala.tools.nsc.InterpreterControl.Command]</span><a id="526">List</a></span>[Command] = <span class="typed"><span class="type">=&gt; List[scala.tools.nsc.InterpreterControl.Command]</span><a href="#58089">standardCommands</a></span> <span class="typed"><span class="type">(List[scala.tools.nsc.InterpreterControl.Command])List[scala.tools.nsc.InterpreterControl.Command]</span><a href="#125632" id="21339">:::</a></span> (<span class="typed"><span class="type">List[scala.tools.nsc.InterpreterControl.Command]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a href="#58091">powerUserOn</a></span>) <span class="typed"><span class="type">=&gt; List[scala.tools.nsc.InterpreterControl.Command]</span><a href="#58094">powerCommands</a></span> <span class="keyword">else</span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>)

  <span class="comment">/** The main read-eval-print loop for the interpreter.  It calls
   *  &lt;code&gt;command()&lt;/code&gt; for each line of input, and stops when
   *  &lt;code&gt;command()&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="58097">repl</a></span>() {
    <span class="keyword">def</span> <span class="typed"><span class="type">()String</span><a id="125635">readOneLine</a></span>() = {
      <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="28685">flush</a></span>
      <span class="typed"><span class="type">=&gt; scala.tools.nsc.interpreter.InteractiveReader</span><a href="#58063">in</a></span> <span class="typed"><span class="type">(String)String</span><a href="interpreter/InteractiveReader.scala.html#75136">readLine</a></span> <span class="typed"><span class="type">=&gt; String</span><a href="#58085">prompt</a></span>
    }
    <span class="comment">// return false if repl should exit</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Boolean</span><a id="125636">processLine</a></span>(<span class="typed"><span class="type">String</span><a id="125639">line</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> =       
      <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#125639">line</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5794">eq</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>               <span class="comment">// assume null means EOF</span>
      <span class="keyword">else</span> <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#58103">command</a></span>(<span class="typed"><span class="type">String</span><a href="#125639">line</a></span>) <span class="typed"><span class="type">Boolean</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">case</span></span> <a id="1">Result</a>(<span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>, _)           =&gt; <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
        <span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> <a id="1">Result</a>(_, <a id="1">Some</a>(<span class="typed"><span class="type">String</span><a id="125641">finalLine</a></span>)) =&gt; <span class="typed"><span class="type">(String)Unit</span><a href="#58079">addReplay</a></span>(<span class="typed"><span class="type">String</span><a href="#125641">finalLine</a></span>) ; <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
        <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">case</span></span> _                          =&gt; <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
      }
    
    <span class="comment">/* For some reason, the first interpreted command always takes
     * a second or two.  So, wait until the welcome message
     * has been printed before calling bindSettings.  That way,
     * the user can read the welcome message while this
     * command executes.
     */</span>
    <span class="keyword">val</span> <span class="typed"><span class="type">() =&gt; String</span><a id="125637">futLine</a></span> = scala.concurrent.<span class="typed"><span class="type">object scala.concurrent.ops</span><a id="86326">ops</a></span>.<span class="typed"><span class="type">(=&gt; String)() =&gt; String</span><a id="125646">future</a></span>(<span class="typed"><span class="type">()String</span><a href="#125635">readOneLine</a></span>)
    <span class="typed"><span class="type">()Unit</span><a href="#58082">bindSettings</a></span>()
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">(String)Boolean</span><a href="#125636">processLine</a></span>(<span class="typed"><span class="type">()String</span><a href="#125637" id="31093">futLine</a></span>()))
      <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Leaving already? That hurts, it really does.&quot;)</span><span class="string">&quot;Leaving already? That hurts, it really does.&quot;</span></span>)

    <span class="comment">// loops until false, then returns</span>
    <span class="typed"><span class="type">Unit</span><a href="#125655" class="keyword">while</a></span> (<span class="typed"><span class="type">(String)Boolean</span><a href="#125636">processLine</a></span>(<span class="typed"><span class="type">()String</span><a href="#125635">readOneLine</a></span>)) <span class="typed"><span class="type">Unit</span><span >{</span></span> }
  }

  <span class="comment">/** interpret all lines from a specified file */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="58098">interpretAllFrom</a></span>(<span class="typed"><span class="type">String</span><a id="125603">filename</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) {
    <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileReader</span><a id="125656">fileIn</a></span> = 
      <span class="keyword">try</span>   { <span class="typed"><span class="type">java.io.FileReader</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.FileReader</span><a id="3828">FileReader</a></span>(<span class="typed"><span class="type">String</span><a href="#125603">filename</a></span>) }
      <span class="keyword">catch</span> { <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> _:<span class="typed"><span class="type">java.io.IOException</span><a id="3519">IOException</a></span> =&gt; <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Error opening file: &quot;)</span><span class="string">&quot;Error opening file: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#125603">filename</a></span>) }
      
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.interpreter.InteractiveReader</span><a id="125657">oldIn</a></span> = <span class="typed"><span class="type">=&gt; scala.tools.nsc.interpreter.InteractiveReader</span><a href="#58063">in</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="125658">oldReplay</a></span> = <span class="typed"><span class="type">=&gt; List[String]</span><a href="#58075">replayCommandsRev</a></span>
    <span class="keyword">try</span> {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.BufferedReader</span><a id="125662">inFile</a></span> = <span class="typed"><span class="type">(java.io.Reader)java.io.BufferedReader</span><a id="46775" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.BufferedReader</span><a id="3549">BufferedReader</a></span>(<span class="typed"><span class="type">java.io.FileReader</span><a href="#125656">fileIn</a></span>)
      <span class="typed"><span class="type">(scala.tools.nsc.interpreter.InteractiveReader)Unit</span><a href="#58064">in</a></span> = <span class="typed"><span class="type">scala.tools.nsc.interpreter.SimpleReader</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.interpreter.SimpleReader</span><a href="interpreter/SimpleReader.scala.html#17678">SimpleReader</a></span>(<span class="typed"><span class="type">java.io.BufferedReader</span><a href="#125662">inFile</a></span>, <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>, <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>)
      <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Loading &quot;)</span><span class="string">&quot;Loading &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#125603">filename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;...&quot;)</span><span class="string">&quot;...&quot;</span></span>)
      <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="28685">flush</a></span>
      <span class="typed"><span class="type">()Unit</span><a href="#58097">repl</a></span>
    } <span class="keyword">finally</span> {
      <span class="typed"><span class="type">(scala.tools.nsc.interpreter.InteractiveReader)Unit</span><a href="#58064">in</a></span> = <span class="typed"><span class="type">scala.tools.nsc.interpreter.InteractiveReader</span><a href="#125657">oldIn</a></span>
      <span class="typed"><span class="type">(List[String])Unit</span><a href="#58076">replayCommandsRev</a></span> = <span class="typed"><span class="type">List[String]</span><a href="#125658">oldReplay</a></span>
      <span class="typed"><span class="type">java.io.FileReader</span><a href="#125656">fileIn</a></span>.<span class="typed"><span class="type">()Unit</span><a id="47587">close</a></span>
    }
  }

  <span class="comment">/** create a new interpreter and replay all commands so far */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="58099">replay</a></span>() {
    <span class="typed"><span class="type">()Unit</span><a href="#58080">closeInterpreter</a></span>()
    <span class="typed"><span class="type">()Unit</span><a href="#58081">createInterpreter</a></span>()
    <span class="keyword">for</span> (<span class="typed"><span class="type">((String) =&gt; Unit)Unit</span><span id="21366"><a id="125682">cmd</a></span></span> &lt;- <span class="typed"><span class="type">=&gt; List[String]</span><a href="#58078">replayCommands</a></span>) {
      <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Replaying: &quot;)</span><span class="string">&quot;Replaying: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#125682">cmd</a></span>)
      <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="28685">flush</a></span>()  <span class="comment">// because maybe cmd will have its own output</span>
      <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#58103">command</a></span>(<span class="typed"><span class="type">String</span><a href="#125682">cmd</a></span>)
      <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="28703">println</a></span>
    }
  }
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)((String) =&gt; Unit)Unit</span><a id="58100">withFile</a></span>(<span class="typed"><span class="type">String</span><a id="125599">filename</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>)(<span class="typed"><span class="type">(String) =&gt; Unit</span><a id="125600">action</a></span>: String =&gt; Unit) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span> <span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">String</span><a href="#125599">filename</a></span>).<span class="typed"><span class="type">()Boolean</span><a id="40697">exists</a></span>) <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;That file does not exist&quot;)</span><span class="string">&quot;That file does not exist&quot;</span></span>)
    <span class="keyword">else</span> <span class="typed"><span class="type">(String)Unit</span><a href="#125600" id="21757">action</a></span>(<span class="typed"><span class="type">String</span><a href="#125599">filename</a></span>)
  }
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a id="58101">load</a></span>(<span class="typed"><span class="type">String</span><a id="125596">arg</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = {
    <span class="keyword">var</span> <span class="typed"><span class="type">Option[String]</span><a id="125598">shouldReplay</a></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
    <span class="typed"><span class="type">(String)((String) =&gt; Unit)Unit</span><a href="#58100">withFile</a></span>(<span class="typed"><span class="type">String</span><a href="#125596">arg</a></span>)(<span class="typed"><span class="type">String</span><a id="125602">f</a></span> =&gt; {
      <span class="typed"><span class="type">(String)Unit</span><a href="#58098">interpretAllFrom</a></span>(<span class="typed"><span class="type">String</span><a href="#125602">f</a></span>)
      <span class="typed"><span class="type">Option[String]</span><a href="#125598">shouldReplay</a></span> = <span class="typed"><span class="type">(java.lang.String)Some[java.lang.String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;:load &quot;)</span><span class="string">&quot;:load &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#125596">arg</a></span>)
    })
    <span class="typed"><span class="type">(Boolean,Option[String])scala.tools.nsc.InterpreterControl.Result</span><a href="#125233">Result</a></span>(<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>, <span class="typed"><span class="type">Option[String]</span><a href="#125598">shouldReplay</a></span>)
  }
  
  <span class="keyword">def</span> <span class="typed"><span class="type">()String</span><a id="58102">power</a></span>() = {
    <span class="typed"><span class="type">(Boolean)Unit</span><a href="#58092">powerUserOn</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
    <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">()String</span><a href="Interpreter.scala.html#75436">powerUser</a></span>()
  }
  
  <span class="comment">/** Run one command submitted by the user.  Two values are returned:
    * (1) whether to keep running, (2) the line to record for replay,
    * if any. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a id="58103">command</a></span>(<span class="typed"><span class="type">String</span><a id="125640">line</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><a href="#58129">Result</a></span> = {
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a id="125690">withError</a></span>(<span class="typed"><span class="type">String</span><a id="125694">msg</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = {
      <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span> <span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span> <span class="typed"><span class="type">String</span><a href="#125694">msg</a></span>
      <span class="typed"><span class="type">(Boolean,Option[String])scala.tools.nsc.InterpreterControl.Result</span><a href="#125233">Result</a></span>(<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>, <span class="typed"><span class="type">object None</span><a id="536">None</a></span>)
    }

    <span class="comment">// not a command</span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">String</span><a href="#125640">line</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;:&quot;)</span><span class="string">&quot;:&quot;</span></span>))
      <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">(Boolean,Option[String])scala.tools.nsc.InterpreterControl.Result</span><a href="#125233">Result</a></span>(<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>, <span class="typed"><span class="type">(String)Option[String]</span><a href="#58104">interpretStartingWith</a></span>(<span class="typed"><span class="type">String</span><a href="#125640">line</a></span>))
    
    <span class="comment">// this lets us add commands willy-nilly and only requires enough command to disambiguate</span>
    <span class="keyword">val</span> (<span class="typed"><span class="type">java.lang.String</span><span id="125701"><span id="125692"><a href="#125691" id="23614">x</a></span></span></span> <span class="typed"><span class="type">(java.lang.String, List[java.lang.String])</span><span id="23625"><a href="#125701" id="1379">::</a></span></span> <span class="typed"><span class="type">List[java.lang.String]</span><span id="125702"><span id="125693"><a href="#125691" id="23616">args</a></span></span></span>) = <span class="typed"><span class="type">String</span><a href="#125640">line</a></span>.<span class="typed"><span class="type">(Int)java.lang.String</span><a id="5854">substring</a></span>(<span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>).<span class="typed"><span class="type">(java.lang.String)Array[java.lang.String]</span><a id="5865">split</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;\s+&quot;)</span><span class="string">&quot;&quot;&quot;\s+&quot;&quot;&quot;</span></span>).<span class="typed"><span class="type">=&gt; List[java.lang.String]</span><a id="21815">toList</a></span>
    
    <span class="typed"><span class="type">=&gt; List[scala.tools.nsc.InterpreterControl.Command]</span><a href="#58096">commands</a></span>.<span class="typed"><span class="type">((scala.tools.nsc.InterpreterControl.Command) =&gt; Boolean)List[scala.tools.nsc.InterpreterControl.Command]</span><a id="21367">filter</a></span>(<span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Command</span><a href="#125707">_</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#125245">name</a></span> <span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#125692">x</a></span>) <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><span class="keyword">case</span></span> <span class="typed"><span class="type">(List[scala.tools.nsc.InterpreterControl.Command])Some[List[scala.tools.nsc.InterpreterControl.Command]]</span><span id="21410"><a href="#125709" id="527">List</a></span></span>(<span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Command</span><a id="125712">x</a></span>)  =&gt; <span class="typed"><span class="type">(List[String])scala.tools.nsc.InterpreterControl.Result</span><a href="#125712" id="21757">x</a></span>(<span class="typed"><span class="type">List[java.lang.String]</span><a href="#125693">args</a></span>)
      <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>      =&gt; <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125690">withError</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Unknown command.  Type :help for help.&quot;)</span><span class="string">&quot;Unknown command.  Type :help for help.&quot;</span></span>)
      <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Result</span><span class="keyword">case</span></span> <span class="typed"><span class="type">List[scala.tools.nsc.InterpreterControl.Command]</span><a id="125713">xs</a></span>       =&gt; <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#125690">withError</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Ambiguous: did you mean &quot;)</span><span class="string">&quot;Ambiguous: did you mean &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">List[scala.tools.nsc.InterpreterControl.Command]</span><a href="#125713">xs</a></span>.<span class="typed"><span class="type">((scala.tools.nsc.InterpreterControl.Command) =&gt; java.lang.String)List[java.lang.String]</span><a id="21362">map</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;:&quot;)</span><span class="string">&quot;:&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterControl.Command</span><a href="#125716">_</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#125245">name</a></span>).<span class="typed"><span class="type">(String)String</span><a id="21819">mkString</a></span>(<span class="typed"><span class="type">java.lang.String(&quot; or &quot;)</span><span class="string">&quot; or &quot;</span></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;?&quot;)</span><span class="string">&quot;?&quot;</span></span>)
    }
  }
  
  <span class="comment">/** Interpret expressions starting with the first line.
    * Read lines until a complete compilation unit is available
    * or until a syntax error has been seen.  If a full unit is
    * read, go ahead and interpret it.  Return the full string
    * to be recorded for replay, if any.
    */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Option[String]</span><a id="58104">interpretStartingWith</a></span>(<span class="typed"><span class="type">String</span><a id="125698">code</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] =
    <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterResults.Result</span><a href="Interpreter.scala.html#75417">interpret</a></span>(<span class="typed"><span class="type">String</span><a href="#125698">code</a></span>) <span class="typed"><span class="type">Option[String]</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">None.type</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object scala.tools.nsc.InterpreterResults</span><a href="InterpreterResults.scala.html#6412">IR</a></span>.<span class="typed"><span class="type">object scala.tools.nsc.InterpreterResults.Error</span><a href="InterpreterResults.scala.html#125555">Error</a></span>       =&gt; <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
      <span class="typed"><span class="type">Some[String]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object scala.tools.nsc.InterpreterResults</span><a href="InterpreterResults.scala.html#6412">IR</a></span>.<span class="typed"><span class="type">object scala.tools.nsc.InterpreterResults.Success</span><a href="InterpreterResults.scala.html#125553">Success</a></span>     =&gt; <span class="typed"><span class="type">(String)Some[String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#125698">code</a></span>)
      <span class="typed"><span class="type">Option[String]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object scala.tools.nsc.InterpreterResults</span><a href="InterpreterResults.scala.html#6412">IR</a></span>.<span class="typed"><span class="type">object scala.tools.nsc.InterpreterResults.Incomplete</span><a href="InterpreterResults.scala.html#125557">Incomplete</a></span>  =&gt;
        <span class="typed"><span class="type">Option[String]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.interpreter.InteractiveReader</span><a href="#58063">in</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="interpreter/InteractiveReader.scala.html#75135">interactive</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">String</span><a href="#125698">code</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5842">endsWith</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;\012\012&quot;)</span><span class="string">&quot;\n\n&quot;</span></span>)) {
          <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;You typed two blank lines.  Starting a new command.&quot;)</span><span class="string">&quot;You typed two blank lines.  Starting a new command.&quot;</span></span>)
          <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
        } 
        <span class="keyword">else</span> <span class="typed"><span class="type">=&gt; scala.tools.nsc.interpreter.InteractiveReader</span><a href="#58063">in</a></span>.<span class="typed"><span class="type">(String)String</span><a href="interpreter/InteractiveReader.scala.html#75136">readLine</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;     | &quot;)</span><span class="string">&quot;     | &quot;</span></span>) <span class="typed"><span class="type">Option[String]</span><span class="keyword">match</span></span> {
          <span class="typed"><span class="type">None.type</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> =&gt; <span class="typed"><span class="type">object None</span><a id="536">None</a></span>         <span class="comment">// end of file</span>
          <span class="typed"><span class="type">Option[String]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">String</span><a id="125725">line</a></span> =&gt; <span class="typed"><span class="type">(String)Option[String]</span><a href="#58104">interpretStartingWith</a></span>(<span class="typed"><span class="type">String</span><a href="#125698">code</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;\012&quot;)</span><span class="string">&quot;\n&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#125725">line</a></span>)
        }
    }

  <span class="comment">// runs :load &lt;file&gt; on any files passed via -i</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.Settings)Unit</span><a id="58105">loadFiles</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="125726">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>) = <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#125726">settings</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
    <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a id="125728">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="GenericRunnerSettings.scala.html#7302">GenericRunnerSettings</a></span> =&gt;
      <span class="keyword">for</span> (<span class="typed"><span class="type">((String) =&gt; Unit)Unit</span><span id="21366"><a id="125731">filename</a></span></span> &lt;- <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#125728">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.MultiStringSetting</span><a href="GenericRunnerSettings.scala.html#57747">loadfiles</a></span>.<span class="typed"><span class="type">=&gt; settings.loadfiles.T</span><a href="Settings.scala.html#30301">value</a></span>) {
        <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="125732">cmd</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;:load &quot;)</span><span class="string">&quot;:load &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#125731">filename</a></span>
        <span class="typed"><span class="type">(String)scala.tools.nsc.InterpreterControl.Result</span><a href="#58103">command</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#125732">cmd</a></span>)
        <span class="typed"><span class="type">(List[String])Unit</span><a href="#58076">replayCommandsRev</a></span> = <span class="typed"><span class="type">java.lang.String</span><a href="#125732">cmd</a></span> <span class="typed"><span class="type">(String)List[String]</span><a href="#125733" id="21335">::</a></span> <span class="typed"><span class="type">=&gt; List[String]</span><a href="#58075">replayCommandsRev</a></span>
        <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="28703">println</a></span>()
      }
    <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _ =&gt;
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.Settings)Unit</span><a id="58106">main</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="58136">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>) {
    <span class="typed"><span class="type">InterpreterLoop.this.type</span><a href="#7056" class="keyword">this</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.Settings)Unit</span><a href="#58069">settings</a></span> = <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#58136">settings</a></span>
    <span class="typed"><span class="type">()Unit</span><a href="#58081">createInterpreter</a></span>()
    
    <span class="comment">// sets in to some kind of reader depending on environmental cues</span>
    <span class="typed"><span class="type">(scala.tools.nsc.interpreter.InteractiveReader)Unit</span><a href="#58064">in</a></span> = <span class="typed"><span class="type">Option[java.io.BufferedReader]</span><a href="#58058">in0</a></span> <span class="typed"><span class="type">scala.tools.nsc.interpreter.InteractiveReader</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">scala.tools.nsc.interpreter.SimpleReader</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">java.io.BufferedReader</span><a id="125763">in0</a></span>)  =&gt; <span class="typed"><span class="type">scala.tools.nsc.interpreter.SimpleReader</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.interpreter.SimpleReader</span><a href="interpreter/SimpleReader.scala.html#17678">SimpleReader</a></span>(<span class="typed"><span class="type">java.io.BufferedReader</span><a href="#125763">in0</a></span>, <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span>, <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>)
      <span class="typed"><span class="type">scala.tools.nsc.interpreter.InteractiveReader</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span>       =&gt;
        <span class="keyword">val</span> <span class="typed"><span class="type">Boolean</span><a id="125765">emacsShell</a></span> = <span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.lang.String</span><a id="47451">getProperty</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;env.emacs&quot;)</span><span class="string">&quot;env.emacs&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>) <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>
        
        <span class="comment">// the interpeter is passed as an argument to expose tab completion info</span>
        <span class="typed"><span class="type">scala.tools.nsc.interpreter.InteractiveReader</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#58136">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="Settings.scala.html#30016">Xnojline</a></span>.<span class="typed"><span class="type">=&gt; settings.Xnojline.T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2750">||</a></span> <span class="typed"><span class="type">Boolean</span><a href="#125765">emacsShell</a></span>) <span class="typed"><span class="type">()scala.tools.nsc.interpreter.SimpleReader</span><a href="interpreter/SimpleReader.scala.html#125672" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.interpreter.SimpleReader</span><a href="interpreter/SimpleReader.scala.html#17678">SimpleReader</a></span>
        <span class="keyword">else</span> <span class="typed"><span class="type">scala.tools.nsc.interpreter.InteractiveReader</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#58136">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="Settings.scala.html#30062">noCompletion</a></span>.<span class="typed"><span class="type">=&gt; settings.noCompletion.T</span><a href="Settings.scala.html#30301">value</a></span>) <span class="typed"><span class="type">object scala.tools.nsc.interpreter.InteractiveReader</span><a href="interpreter/InteractiveReader.scala.html#17670">InteractiveReader</a></span>.<span class="typed"><span class="type">()scala.tools.nsc.interpreter.InteractiveReader</span><a href="interpreter/InteractiveReader.scala.html#75913">createDefault</a></span>()
        <span class="keyword">else</span> <span class="typed"><span class="type">object scala.tools.nsc.interpreter.InteractiveReader</span><a href="interpreter/InteractiveReader.scala.html#17670">InteractiveReader</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.Interpreter)scala.tools.nsc.interpreter.InteractiveReader</span><a href="interpreter/InteractiveReader.scala.html#75914">createDefault</a></span>(<span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>)
    }

    <span class="typed"><span class="type">(scala.tools.nsc.Settings)Unit</span><a href="#58105">loadFiles</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#58136">settings</a></span>)
    <span class="keyword">try</span> {
      <span class="comment">// it is broken on startup; go ahead and exit</span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">object scala.tools.nsc.Interpreter#reporter</span><a href="Interpreter.scala.html#75375">reporter</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="reporters/Reporter.scala.html#34460">hasErrors</a></span>) <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span>
      
      <span class="typed"><span class="type">()Unit</span><a href="#58084">printWelcome</a></span>()
      <span class="typed"><span class="type">()Unit</span><a href="#58097">repl</a></span>()
    } <span class="keyword">finally</span> {
      <span class="typed"><span class="type">()Unit</span><a href="#58080">closeInterpreter</a></span>()
    }
  }

  <span class="comment">// injects one value into the repl; returns pair of name and class</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String,Any)(String, String)</span><a id="58107">injectOne</a></span>(<span class="typed"><span class="type">String</span><a id="125785">name</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">Any</span><a id="125786">obj</a></span>: <span class="typed"><span class="type">Any</span><a id="51">Any</a></span>): <span class="typed"><span class="type">(String, String)</span><a id="1378">Tuple2</a></span>[String, String] = {
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="125787">className</a></span> = <span class="typed"><span class="type">Any</span><a href="#125786">obj</a></span>.<span class="typed"><span class="type">AnyRef</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">AnyRef</span><a id="2017">AnyRef</a></span>].<span class="typed"><span class="type">()java.lang.Class[_ &lt;: java.lang.Object]</span><a id="3511">getClass</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="3948">getName</a></span>     
    <span class="typed"><span class="type">=&gt; scala.tools.nsc.Interpreter</span><a href="#58071">interpreter</a></span>.<span class="typed"><span class="type">(String,String,Any)scala.tools.nsc.InterpreterResults.Result</span><a href="Interpreter.scala.html#75420">bind</a></span>(<span class="typed"><span class="type">String</span><a href="#125785">name</a></span>, <span class="typed"><span class="type">java.lang.String</span><a href="#125787">className</a></span>, <span class="typed"><span class="type">Any</span><a href="#125786">obj</a></span>)
    <span class="typed"><span class="type">(String,java.lang.String)(String, java.lang.String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">String</span><a href="#125785">name</a></span>, <span class="typed"><span class="type">java.lang.String</span><a href="#125787">className</a></span>)
  }
  
  <span class="comment">// injects list of values into the repl; returns summary string</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(List[Any])String</span><a id="58108">inject</a></span>(<span class="typed"><span class="type">List[Any]</span><a id="125791">args</a></span>: <span class="typed"><span class="type">List[Any]</span><a id="526">List</a></span>[Any]): <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">List[java.lang.String]</span><a id="125792">strs</a></span> = 
      <span class="keyword">for</span> (<span class="typed"><span class="type">(((Any, Int)) =&gt; java.lang.String)List[java.lang.String]</span><span id="21362"><a href="#125795" id="21367">(</a></span></span><span class="typed"><span class="type">Any</span><span id="125796"><a id="125802">arg</a></span></span>, <span class="typed"><span class="type">Int</span><span id="125797"><a id="125803">i</a></span></span>) &lt;- <span class="typed"><span class="type">List[Any]</span><a href="#125791">args</a></span>.<span class="typed"><span class="type">=&gt; List[(Any, Int)]</span><a id="21388">zipWithIndex</a></span>) <span class="keyword">yield</span> {
        <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="125804">varName</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;p&quot;)</span><span class="string">&quot;p&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> (<span class="typed"><span class="type">Int</span><a href="#125803">i</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)
        <span class="keyword">val</span> <span class="typed"><span class="type">(String, String)</span><span id="23625"><a href="#125809" id="1379">(</a></span></span><span class="typed"><span class="type">String</span><span id="125809"><span id="125806"><a href="#125805" id="23614">vname</a></span></span></span>, <span class="typed"><span class="type">String</span><span id="125810"><span id="125807"><a href="#125805" id="23616">vtype</a></span></span></span>) = <span class="typed"><span class="type">(String,Any)(String, String)</span><a href="#58107">injectOne</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#125804">varName</a></span>, <span class="typed"><span class="type">Any</span><a href="#125802">arg</a></span>)
        <span class="typed"><span class="type">String</span><a href="#125806">vname</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;: &quot;)</span><span class="string">&quot;: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#125807">vtype</a></span>
      }
    
    <span class="typed"><span class="type">String</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[java.lang.String]</span><a href="#125792">strs</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">java.lang.String(&quot;Set no variables.&quot;)</span><span class="string">&quot;Set no variables.&quot;</span></span>
    <span class="keyword">else</span> <span class="typed"><span class="type">java.lang.String(&quot;Variables set:\012&quot;)</span><span class="string">&quot;Variables set:\n&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">List[java.lang.String]</span><a href="#125792">strs</a></span>.<span class="typed"><span class="type">(String)String</span><a id="21819">mkString</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;\012&quot;)</span><span class="string">&quot;\n&quot;</span></span>)
  }
  
  <span class="comment">/** process command-line arguments and do as they request */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Array[String])Unit</span><a id="58109">main</a></span>(<span class="typed"><span class="type">Array[String]</span><a id="58135">args</a></span>: <span class="typed"><span class="type">Array[String]</span><a id="1072">Array</a></span>[String]) {
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="125816">error1</a></span>(<span class="typed"><span class="type">String</span><a id="125819">msg</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span> <span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span> (<span class="typed"><span class="type">java.lang.String(&quot;scala: &quot;)</span><span class="string">&quot;scala: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#125819">msg</a></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterCommand</span><a id="125817">command</a></span> = <span class="typed"><span class="type">scala.tools.nsc.InterpreterCommand</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterCommand</span><a href="InterpreterCommand.scala.html#7197">InterpreterCommand</a></span>(<span class="typed"><span class="type">object List</span><a id="527">List</a></span> <span class="typed"><span class="type">(Array[String])List[String]</span><a id="21440">fromArray</a></span> <span class="typed"><span class="type">Array[String]</span><a href="#58135">args</a></span>, <span class="typed"><span class="type">(String)Unit</span><a href="#125816">error1</a></span>)
    <span class="keyword">def</span> <span class="typed"><span class="type">()String</span><a id="125818">neededHelp</a></span>(): <span class="typed"><span class="type">String</span><a id="1861">String</a></span> =
      (<span class="typed"><span class="type">java.lang.String</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.InterpreterCommand</span><a href="#125817">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="CompilerCommand.scala.html#53159">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="Settings.scala.html#29968">help</a></span>.<span class="typed"><span class="type">=&gt; command.settings.help.T</span><a href="Settings.scala.html#30301">value</a></span>) <span class="typed"><span class="type">scala.tools.nsc.InterpreterCommand</span><a href="#125817">command</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="CompilerCommand.scala.html#53178">usageMsg</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;\012&quot;)</span><span class="string">&quot;\n&quot;</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
      (<span class="typed"><span class="type">Any</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.InterpreterCommand</span><a href="#125817">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="CompilerCommand.scala.html#53159">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="Settings.scala.html#29990">Xhelp</a></span>.<span class="typed"><span class="type">=&gt; command.settings.Xhelp.T</span><a href="Settings.scala.html#30301">value</a></span>) <span class="typed"><span class="type">scala.tools.nsc.InterpreterCommand</span><a href="#125817">command</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="CompilerCommand.scala.html#53179">xusageMsg</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;\012&quot;)</span><span class="string">&quot;\n&quot;</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
    
    <span class="comment">// if they asked for no help and command is valid, we call the real main</span>
    <span class="typed"><span class="type">()String</span><a href="#125818">neededHelp</a></span>() <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>     =&gt; <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.InterpreterCommand</span><a href="#125817">command</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="CompilerCommand.scala.html#53185">ok</a></span>) <span class="typed"><span class="type">(scala.tools.nsc.Settings)Unit</span><a href="#58106">main</a></span>(<span class="typed"><span class="type">scala.tools.nsc.InterpreterCommand</span><a href="#125817">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="CompilerCommand.scala.html#53159">settings</a></span>) <span class="comment">// else nothing</span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">String</span><a id="125845">help</a></span>   =&gt; <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span> <span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28701">print</a></span> <span class="typed"><span class="type">String</span><a href="#125845">help</a></span> ; <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#58059">out</a></span> <span class="typed"><span class="type">()Unit</span><a id="28685">flush</a></span>
    }
  }
}

        </pre>
    </body>
</html>