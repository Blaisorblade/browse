<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/ast/parser/MarkupParsers.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author Burak Emir
 */
// $Id: MarkupParsers.scala 17754 2009-05-18 10:54:00Z milessabin $

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> ast.parser

<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> scala.util.control.ControlException
<span class="keyword">import</span> scala.tools.nsc.util.{Position,NoPosition,SourceFile,CharArrayReader}
<span class="keyword">import</span> scala.xml.{Text, TextBuffer}
<span class="keyword">import</span> SourceFile.{SU,LF}
<span class="keyword">import</span> scala.annotation.switch

/** This trait ...
 *
 *  @author  Burak Emir
 *  @version 1.0
 */
<span class="keyword">trait</span> <a title="trait MarkupParsers extends java.lang.Object with ScalaObject" id="12263">MarkupParsers</a> <span title="ScalaObject">{</span>self: Parsers =&gt;
  case <span class="keyword">object</span> <a href="#713135" title="object MarkupParsers.this.MissingEndTagException" id="713146">MissingEndTagException</a> <span title="ScalaObject" class="keyword">extends</span> <span title="java.lang.RuntimeException">RuntimeException</span> <span class="keyword">with</span> <span title="scala.util.control.ControlException">ControlException</span> {
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="713111">getMessage</a> = <span title="java.lang.String(&quot;start tag was here: &quot;)" class="string">&quot;start tag was here: &quot;</span>
  }

  case <span class="keyword">object</span> <a href="#713169" title="object MarkupParsers.this.ConfusedAboutBracesException" id="713180">ConfusedAboutBracesException</a> <span title="ScalaObject" class="keyword">extends</span> <span title="java.lang.RuntimeException">RuntimeException</span> <span class="keyword">with</span> <span title="scala.util.control.ControlException">ControlException</span> {
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="713148">getMessage</a> = <span title="java.lang.String(&quot; I encountered a '}' where I didn't expect one, maybe this tag isn't closed &lt;&quot;)" class="string">&quot; I encountered a '}' where I didn't expect one, maybe this tag isn't closed &lt;&quot;</span>
  }

  case <span class="keyword">object</span> <a href="#713203" title="object MarkupParsers.this.TruncatedXML" id="713214">TruncatedXML</a> <span title="ScalaObject" class="keyword">extends</span> <span title="java.lang.RuntimeException">RuntimeException</span> <span class="keyword">with</span> <span title="scala.util.control.ControlException">ControlException</span> {
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="713182">getMessage</a> = <span title="java.lang.String(&quot;input ended while parsing XML&quot;)" class="string">&quot;input ended while parsing XML&quot;</span>
  }

  <span class="keyword">import</span> global._

  <span class="keyword">class</span> <a title="class MarkupParser extends java.lang.Object with ScalaObject" id="39744">MarkupParser</a><span title="ScalaObject">(</span><a title="MarkupParsers.this.UnitParser" id="608454">parser</a>: <a href="Parsers.scala.html#39709" title="MarkupParsers.this.UnitParser">UnitParser</a>, <a title="Boolean" id="608455">presWS</a>: <span title="Boolean">Boolean</span>) /*with scala.xml.parsing.MarkupParser[Tree,Tree] */{

    <span class="keyword">import</span> Tokens.{EMPTY, LBRACE, RBRACE}

    <span class="keyword">final</span> <span class="keyword">val</span> <a title="Boolean" id="608402">preserveWS</a> = <a href="#608455" title="Boolean">presWS</a>
    <span class="keyword">var</span> <a title="scala.tools.nsc.util.CharArrayReader" id="608405">input</a> : <a href="../../util/CharArrayReader.scala.html#14599" title="scala.tools.nsc.util.CharArrayReader">CharArrayReader</a> = _

    <span class="keyword">import</span> parser.{symbXMLBuilder =&gt; handle, o2p, r2p}

    <span class="keyword">def</span> <a title="=&gt; Int" id="608408">curOffset</a> : <span title="Int">Int</span> = <a href="#608405" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#121680" title="(x$1: Int)Int">charOffset</a> - <span title="Int(1)" class="int">1</span>
    <span class="keyword">var</span> <a title="scala.tools.nsc.util.Position" id="608410">tmppos</a> : <a href="../../util/Position.scala.html#14710" title="scala.tools.nsc.util.Position">Position</a> = <a href="../../util/Position.scala.html#14540" title="object scala.tools.nsc.util.NoPosition">NoPosition</a>
    <span class="keyword">def</span> <a title="=&gt; Char" id="608412">ch</a> = <a href="#608405" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#121677" title="=&gt; Char">ch</a>
    /** this method assign the next character to ch and advances in input */
    <span class="keyword">def</span> <a title="=&gt; Char" id="608413">nextch</a> = { <span class="keyword">val</span> <a title="Char" id="713254">result</a> = <a href="#608405" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#121677" title="=&gt; Char">ch</a>; <a href="#608405" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#121693" title="()Unit">nextChar</a>(); <a href="#713254" title="Char">result</a> } // { s.in.next; /*s.xNext;*/ ch = s.in.ch ; pos = s.in.cpos }

    <span class="keyword">var</span> <a title="Boolean" id="608415">xEmbeddedBlock</a> = <span title="Boolean(false)" class="keyword">false</span>

    /** munch expected XML token, report syntax error for unexpected.
     *
     *  @param that ...
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="(that: Char)Unit" id="608417">xToken</a>(<a title="Char" id="713257">that</a>: <span title="Char">Char</span>) {
      <span title="Unit" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <a href="#713257" title="Char">that</a>) <a href="#608413" title="=&gt; Char">nextch</a>
      <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>)
	<span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
      <span class="keyword">else</span> <a href="#608452" title="(str: String)Char">reportSyntaxError</a><span title="Unit">(</span><span title="(x$1: Any)java.lang.String" class="string">&quot;'&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#713257" title="Char">that</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' expected instead of '&quot;)" class="string">&quot;' expected instead of '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#608412" title="=&gt; Char">ch</a> + <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
    }

    <span class="keyword">var</span> <a title="scala.collection.mutable.Stack[(Int, String)]" id="608419">debugLastStartElement</a> = <a title="()scala.collection.mutable.Stack[(Int, String)]" id="79084" class="keyword">new</a> mutable.<a title="scala.collection.mutable.Stack[(Int, String)]" id="24939">Stack</a>[(Int, String)]

    /** checks whether next character starts a Scala block, if yes, skip it.
     * @return true if next character starts a scala block 
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; Boolean" id="608421">xCheckEmbeddedBlock</a>: <span title="Boolean">Boolean</span> = {
      // attentions, side-effect, used in xText
      <a href="#608415" title="(x$1: Boolean)Unit">xEmbeddedBlock</a> = <span title="(x$1: Boolean)Boolean">(</span><a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('{')" class="char">'{'</span>) &amp;&amp; { <a href="#608413" title="=&gt; Char">nextch</a>; (<a href="#608412" title="(x$1: Char)Boolean">ch</a> != <span title="Char('{')" class="char">'{'</span>) }
      //Console.println(&quot;pos = &quot;+pos+&quot; xEmbeddedBlock returns &quot;+xEmbeddedBlock)
      <a href="#608415" title="=&gt; Boolean">xEmbeddedBlock</a>
    }

    /** parse attribute and add it to listmap
     *  [41] Attributes   ::= { S Name Eq AttValue }
     *       AttValue     ::= `'` { _  } `'`
     *                      | `&quot;` { _ } `&quot;`
     *                      | `{` scalablock `}`
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" id="608422">xAttributes</a> = {
      <span class="keyword">var</span> <a title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" id="713317">aMap</a> = <span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">HashMap</span>[String, Tree]()
      <span title="Unit" class="keyword">while</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isNameStart</span>(<a href="#608412" title="=&gt; Char">ch</a>)) <a href="#713318" title="()Unit">{</a>
        <span class="keyword">val</span> <a title="Int" id="713323">start</a> = <a href="#608408" title="=&gt; Int">curOffset</a>
        <span class="keyword">val</span> <a title="String" id="713324">key</a> = <a href="#608436" title="=&gt; String">xName</a>
        <a href="#608437" title="=&gt; Unit">xEQ</a>
        <span class="keyword">val</span> <a title="Char" id="713325">delim</a> = <a href="#608412" title="=&gt; Char">ch</a>
        <span class="keyword">val</span> <a title="Int" id="713326">mid</a> = <a href="#608408" title="=&gt; Int">curOffset</a>
        <span class="keyword">val</span> <a title="MarkupParsers.this.global.Tree" id="713327">value</a>: /* AttribValue[*/<a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a>/*]*/ = <a href="#608412" title="=&gt; Char">ch</a> <span title="MarkupParsers.this.global.Tree" class="keyword">match</span> {
          <span title="MarkupParsers.this.global.Tree" class="keyword">case</span> <span title="Char('&quot;')" class="char">'&quot;'</span> | <span title="Char(''')" class="char">'\''</span> =&gt;
            <a href="#608413" title="=&gt; Char">nextch</a>
            <span class="keyword">val</span> <a title="String" id="713347">tmp</a> = <a href="#608423" title="(endCh: Char)String">xAttributeValue</a>(<a href="#713325" title="Char">delim</a>)
            <a href="#608413" title="=&gt; Char">nextch</a>
            <span class="keyword">try</span> {
              <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605512" title="(pos: scala.tools.nsc.util.Position,s: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">parseAttribute</a>(<a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#713323" title="Int">start</a>, <a href="#713326" title="Int">mid</a>, <a href="#608408" title="=&gt; Int">curOffset</a>), <a href="#713347" title="String">tmp</a>)
            } <span class="keyword">catch</span> {
              <span title="MarkupParsers.this.global.Literal" class="keyword">case</span> <a title="java.lang.Throwable" id="713356">e</a> =&gt; 
                <a href="#608452" title="(str: String)Char">reportSyntaxError</a>(<span title="java.lang.String(&quot;error parsing attribute value&quot;)" class="string">&quot;error parsing attribute value&quot;</span>)
                <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121169" title="=&gt; MarkupParsers.this.global.Literal">errorTermTree</a>
            }
          
          <span title="MarkupParsers.this.global.Tree" class="keyword">case</span> <span title="Char('{')" class="char">'{'</span>  =&gt;
            <a href="#608413" title="=&gt; Char">nextch</a>
            <a href="#608447" title="=&gt; MarkupParsers.this.global.Tree">xEmbeddedExpr</a>
          <span title="Nothing" class="keyword">case</span> <span title="Char('\032')">SU</span> =&gt;
            <span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
          <span title="MarkupParsers.this.global.Literal" class="keyword">case</span> _ =&gt;
            <a href="#608452" title="(str: String)Char">reportSyntaxError</a>(<span class="string">&quot;' or \&quot; delimited attribute value&quot;</span> <span title="java.lang.String(&quot;' or &quot; delimited attribute value or '{' scala-expr '}' expected&quot;)">+</span>
                              <span class="string">&quot; or '{' scala-expr '}' expected&quot;</span> )
            <a href="../Trees.scala.html#49342" title="(value: MarkupParsers.this.global.Constant)MarkupParsers.this.global.Literal">Literal</a>(<a href="../../symtab/Constants.scala.html#49552" title="(value: Any)MarkupParsers.this.global.Constant">Constant</a>(<span title="java.lang.String(&quot;&lt;syntax-error&gt;&quot;)" class="string">&quot;&lt;syntax-error&gt;&quot;</span>))
        }
        // well-formedness constraint: unique attribute names
        <span title="AnyVal with NotNull" class="keyword">if</span> (<a href="#713317" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a>.<a title="(key: String)Boolean" id="44446">contains</a>(<a href="#713324" title="String">key</a>)) {
          <a href="#608452" title="(str: String)Char">reportSyntaxError</a>( <span title="(x$1: Any)java.lang.String" class="string">&quot;attribute &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#713324" title="String">key</a>+<span title="java.lang.String(&quot; may only be defined once&quot;)" class="string">&quot; may only be defined once&quot;</span> )
        }
        <a href="#713317" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a>.<a title="(key: String,value: MarkupParsers.this.global.Tree)Unit" id="44386">update</a>(<a href="#713324" title="String">key</a>, <a href="#713327" title="MarkupParsers.this.global.Tree">value</a>)
        <span title="AnyVal" class="keyword">if</span> (<span title="(x$1: Boolean)Boolean">(</span><a href="#608412" title="(x$1: Char)Boolean">ch</a> != <span title="Char('/')" class="char">'/'</span>) &amp;&amp; (<a href="#608412" title="(x$1: Char)Boolean">ch</a> != <span title="Char('&gt;')" class="char">'&gt;'</span>)) {
          <a href="#608439" title="=&gt; AnyVal">xSpace</a>
        }
      }
      <a href="#713317" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a>
    }

    /** attribute value, terminated by either ' or &quot;. value may not contain &lt;.
     *  @param endch either ' or &quot;
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="(endCh: Char)String" id="608423">xAttributeValue</a>(<a title="Char" id="713348">endCh</a>: <span title="Char">Char</span>): <span title="String">String</span> = {
      <span class="keyword">val</span> <a title="StringBuilder" id="713466">buf</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>      
      <span title="Unit" class="keyword">while</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> != <a href="#713348" title="Char">endCh</a>) <a href="#713468" title="()Unit">{</a>
        <span title="Unit" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>)
          <span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
        <a href="#713466" title="(x: Char)StringBuilder">buf</a> append <a href="#608412" title="=&gt; Char">ch</a>
        <a href="#608413" title="=&gt; Char">nextch</a>
      }
      <span class="keyword">val</span> <a title="String" id="713467">str</a> = <a href="#713466" title="StringBuilder">buf</a>.<span title="()String">toString</span>()
      
      // @todo: normalize attribute value
      // well-formedness constraint
      <span title="String" class="keyword">if</span> (<a href="#713467" title="String">str</a>.<a title="(x$1: Int)Int" id="6978">indexOf</a><span title="(x$1: Int)Boolean">(</span><span title="Int(60)" class="char">'&lt;'</span>) != <span title="Int(-1)">-</span><span class="int">1</span>) {
        <a href="#608452" title="(str: String)Char">reportSyntaxError</a>( <span title="java.lang.String(&quot;'&lt;' not allowed in attrib value&quot;)" class="string">&quot;'&lt;' not allowed in attrib value&quot;</span> ); <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      } <span class="keyword">else</span> {
        <a href="#713467" title="String">str</a>
      }
    }

    /** parse a start or empty tag.
     *  [40] STag         ::= '&lt;' Name { S Attribute } [S] 
     *  [44] EmptyElemTag ::= '&lt;' Name { S Attribute } [S] 
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; (String, scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree])" id="608424">xTag</a>: <a title="(String, scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree])" id="1154">(</a>String, mutable.Map[String, Tree]) = {
      <span class="keyword">val</span> <a title="String" id="713530">elemName</a> = <a href="#608436" title="=&gt; String">xName</a>
      <a href="#608438" title="=&gt; Unit">xSpaceOpt</a>
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" id="713531">aMap</a> =
        <span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" class="keyword">if</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isNameStart</span>(<a href="#608412" title="=&gt; Char">ch</a>)) <a href="#608422" title="=&gt; scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">xAttributes</a>
        <span class="keyword">else</span> <span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">HashMap</span>[String, Tree]()
      <span title="(_1: String,_2: scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree])(String, scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree])">(</span><a href="#713530" title="String">elemName</a>, <a href="#713531" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a>)
    }

    /** [42]  '&lt;' xmlEndTag ::=  '&lt;' '/' Name S? '&gt;'
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="(startName: String)Unit" id="608425">xEndTag</a>(<a title="String" id="713544">startName</a>: <span title="String">String</span>) {
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('/')" class="char">'/'</span>)
      <span class="keyword">val</span> <a title="String" id="713546">endName</a> = <a href="#608436" title="=&gt; String">xName</a>
      <span title="Unit" class="keyword">if</span> (<a href="#713546" title="(x$1: AnyRef)Boolean" id="6540">endName</a> != <a href="#713544" title="String">startName</a>) {
        <a href="#608452" title="(str: String)Char">reportSyntaxError</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;expected closing tag of &quot;</span> + <a href="#713544" title="String">startName</a>)
        <span title="Nothing" class="keyword">throw</span> <a href="#713146" title="object MarkupParsers.this.MissingEndTagException">MissingEndTagException</a>
      }
      <a href="#608438" title="=&gt; Unit">xSpaceOpt</a>
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
    }

    /** '&lt;! CharData ::= [CDATA[ ( {char} - {char}&quot;]]&gt;&quot;{char} ) ']]&gt;'
     *
     * see [15]
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="608426">xCharData</a>: <a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="Int" id="713563">start</a> = <a href="#608408" title="=&gt; Int">curOffset</a>
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('[')" class="char">'['</span>)
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('C')" class="char">'C'</span>)
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('D')" class="char">'D'</span>)
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('A')" class="char">'A'</span>)
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('T')" class="char">'T'</span>)
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('A')" class="char">'A'</span>)
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('[')" class="char">'['</span>)
      <span class="keyword">val</span> <a title="Int" id="713564">mid</a> = <a href="#608408" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a title="StringBuilder" id="713565">sb</a>: <span title="StringBuilder">StringBuilder</span> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>()
      <span title="Unit" class="keyword">while</span> (<span title="Boolean(true)" class="keyword">true</span>) <a href="#713566" title="()Unit">{</a>
        <span title="StringBuilder" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a><span title="(x$1: Boolean)Boolean">==</span><span title="Char(']')" class="char">']'</span> <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713565" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char(']')" class="char">']'</span> } &amp;&amp;
           { <a href="#713565" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&gt;')" class="char">'&gt;'</span> }) {
          <a href="#713565" title="StringBuilder">sb</a>.<span title="(n: Int)Unit">length</span> = <a href="#713565" title="StringBuilder">sb</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(2)" class="int">2</span>
          <a href="#608413" title="=&gt; Char">nextch</a>
          <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605505" title="(pos: scala.tools.nsc.util.Position,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">charData</a>(<a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#713563" title="Int">start</a>, <a href="#713564" title="Int">mid</a>, <a href="#608408" title="=&gt; Int">curOffset</a>), <a href="#713565" title="StringBuilder">sb</a>.<span title="()String">toString</span>())
        } <span class="keyword">else</span> <span title="StringBuilder" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>)
          <span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
        <span class="keyword">else</span>
          <a href="#713565" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>)
        <a href="#608413" title="=&gt; Char">nextch</a>
      }
      <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;this cannot happen&quot;)" class="string">&quot;this cannot happen&quot;</span>)
    }

    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="608427">xUnparsed</a>: <a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="Int" id="713676">start</a> = <a href="#608408" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a title="StringBuilder" id="713677">sb</a>: <span title="StringBuilder">StringBuilder</span> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>()
      <span title="Unit" class="keyword">while</span> (<span title="Boolean(true)" class="keyword">true</span>) <a href="#713678" title="()Unit">{</a>
        <span title="StringBuilder" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a><span title="(x$1: Boolean)Boolean">==</span><span title="Char('&lt;')" class="char">'&lt;'</span> <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('/')" class="char">'/'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('x')" class="char">'x'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('m')" class="char">'m'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('l')" class="char">'l'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char(':')" class="char">':'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('u')" class="char">'u'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('n')" class="char">'n'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('p')" class="char">'p'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('a')" class="char">'a'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('r')" class="char">'r'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('s')" class="char">'s'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('e')" class="char">'e'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('d')" class="char">'d'</span> } &amp;&amp;
           { <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&gt;')" class="char">'&gt;'</span> }) {
          <a href="#713677" title="StringBuilder">sb</a>.<span title="(n: Int)Unit">length</span> = <a href="#713677" title="StringBuilder">sb</a>.<span title="(x$1: Int)Int">length</span> - <span title="java.lang.String(&quot;&lt;/xml:unparsed&quot;)" class="string">&quot;&lt;/xml:unparsed&quot;</span>.<a title="()Int" id="6915">length</a>
          <a href="#608413" title="=&gt; Char">nextch</a>
          <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605517" title="(pos: scala.tools.nsc.util.Position,str: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">unparsed</a>(<a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#713676" title="Int">start</a>, <a href="#713676" title="Int">start</a>, <a href="#608408" title="=&gt; Int">curOffset</a>), <a href="#713677" title="StringBuilder">sb</a>.<span title="()String">toString</span>())
        } <span class="keyword">else</span> <span title="StringBuilder" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>) {
          <span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
        } <span class="keyword">else</span> <a href="#713677" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>)
        <a href="#608413" title="=&gt; Char">nextch</a>
      }
      <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;this cannot happen&quot;)" class="string">&quot;this cannot happen&quot;</span>)
    }

    /** CharRef ::= &quot;&amp;#&quot; '0'..'9' {'0'..'9'} &quot;;&quot;
     *            | &quot;&amp;#x&quot; '0'..'9'|'A'..'F'|'a'..'f' { hexdigit } &quot;;&quot;
     *
     * see [66]
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; String" id="608428">xCharRef</a>: <span title="String">String</span> = {
      <span class="keyword">val</span> <a title="Boolean" id="713957">hex</a> = <span title="(x$1: Boolean)Boolean">(</span><a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('x')" class="char">'x'</span>) &amp;&amp; { <a href="#608413" title="=&gt; Char">nextch</a>; <span title="Boolean(true)" class="keyword">true</span> }
      <span class="keyword">val</span> <a title="Int" id="713958">base</a> = <span title="Int" class="keyword">if</span> (<a href="#713957" title="Boolean">hex</a>) <span title="Int(16)" class="int">16</span> <span class="keyword">else</span> <span title="Int(10)" class="int">10</span>
      <span class="keyword">var</span> <a title="Int" id="713959">i</a> = <span title="Int(0)" class="int">0</span>
      <span title="Unit" class="keyword">while</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> != <span title="Char(';')" class="char">';'</span>) <a href="#713960" title="()Unit">{</a> 
        (<a href="#608412" title="=&gt; Char">ch</a>: @<span title="Char @scala.annotation.switch">switch</span>) <span title="AnyVal" class="keyword">match</span> {
          <span title="Unit" class="keyword">case</span> <span title="Char('0')" class="char">'0'</span> | <span title="Char('1')" class="char">'1'</span> | <span title="Char('2')" class="char">'2'</span> | <span title="Char('3')" class="char">'3'</span> | <span title="Char('4')" class="char">'4'</span> | <span title="Char('5')" class="char">'5'</span> | <span title="Char('6')" class="char">'6'</span> | <span title="Char('7')" class="char">'7'</span> | <span title="Char('8')" class="char">'8'</span> | <span title="Char('9')" class="char">'9'</span> =&gt;
            <a href="#713959" title="Int">i</a> = <a href="#713959" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">*</span> <a href="#713958" title="Int">base</a> + <a href="#608412" title="implicit scala.Predef.charWrapper : (c: Char)scala.runtime.RichChar">ch</a>.<span title="=&gt; Int">asDigit</span>
          <span title="AnyVal with NotNull" class="keyword">case</span> <span title="Char('a')" class="char">'a'</span> | <span title="Char('b')" class="char">'b'</span> | <span title="Char('c')" class="char">'c'</span> | <span title="Char('d')" class="char">'d'</span> | <span title="Char('e')" class="char">'e'</span> | <span title="Char('f')" class="char">'f'</span>
             | <span title="Char('A')" class="char">'A'</span> | <span title="Char('B')" class="char">'B'</span> | <span title="Char('C')" class="char">'C'</span> | <span title="Char('D')" class="char">'D'</span> | <span title="Char('E')" class="char">'E'</span> | <span title="Char('F')" class="char">'F'</span> =&gt;
            <span title="AnyVal with NotNull" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#713957" title="Boolean">hex</a>)
              <a href="#608452" title="(str: String)Char">reportSyntaxError</a>(<span class="string">&quot;hex char not allowed in decimal char ref\n&quot;</span>
                           <span title="java.lang.String(&quot;hex char not allowed in decimal char ref\012Did you mean to write &amp;#x ?&quot;)">+</span><span class="string">&quot;Did you mean to write &amp;#x ?&quot;</span>);
            <span class="keyword">else</span>
              <a href="#713959" title="Int">i</a> = <a href="#713959" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">*</span> <a href="#713958" title="Int">base</a> + <a href="#608412" title="implicit scala.Predef.charWrapper : (c: Char)scala.runtime.RichChar">ch</a>.<span title="=&gt; Int">asDigit</span>
          <span title="Nothing" class="keyword">case</span> <span title="Char('\032')">SU</span> =&gt;
            <span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
          <span title="Char" class="keyword">case</span> _ =&gt;
            <a href="#608452" title="(str: String)Char">reportSyntaxError</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;character '&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#608412" title="=&gt; Char">ch</a>+<span title="java.lang.String(&quot;' not allowed in char ref&quot;)" class="string">&quot;' not allowed in char ref&quot;</span>)
        }
        <a href="#608413" title="=&gt; Char">nextch</a>
      }
      <a title="(x$1: Array[Char])java.lang.String" id="6561" class="keyword">new</a> <a title="java.lang.String" id="7817">String</a>(<a title="(xs: Char*)Array[Char]" id="888">Array</a>(<a href="#713959" title="Int">i</a>.<a title="[T0]T0" id="3623">asInstanceOf</a><span title="Char">[</span><span title="Char">Char</span>]))
    }

    /** Comment ::= '&lt;!--' ((Char - '-') | ('-' (Char - '-')))* '--&gt;'
     *
     * see [15]
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="608429">xComment</a>: <a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="Int" id="714115">start</a> = <a href="#608408" title="(x$1: Int)Int">curOffset</a> - <span title="Int(2)" class="int">2</span> // ? right so ?
      <span class="keyword">val</span> <a title="StringBuilder" id="714116">sb</a>: <span title="StringBuilder">StringBuilder</span> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>()
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('-')" class="char">'-'</span>)
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('-')" class="char">'-'</span>)
      <span title="Unit" class="keyword">while</span> (<span title="Boolean(true)" class="keyword">true</span>) <a href="#714117" title="()Unit">{</a>
        <span title="StringBuilder" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a><span title="(x$1: Boolean)Boolean">==</span><span title="Char('-')" class="char">'-'</span>  &amp;&amp; { <a href="#714116" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('-')" class="char">'-'</span> }) {
          <a href="#714116" title="StringBuilder">sb</a>.<span title="(n: Int)Unit">length</span> = <a href="#714116" title="StringBuilder">sb</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(1)" class="int">1</span>
          <a href="#608413" title="=&gt; Char">nextch</a>
          <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
          <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605504" title="(pos: scala.tools.nsc.util.Position,text: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">comment</a>(<a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#714115" title="Int">start</a>, <a href="#714115" title="Int">start</a>, <a href="#608408" title="=&gt; Int">curOffset</a>), <a href="#714116" title="StringBuilder">sb</a>.<span title="()String">toString</span>())
        } <span class="keyword">else</span> <span title="StringBuilder" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>) {
          <span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
        } <span class="keyword">else</span> <a href="#714116" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>)
        <a href="#608413" title="=&gt; Char">nextch</a>
      }
      <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;this cannot happen&quot;)" class="string">&quot;this cannot happen&quot;</span>)
    }

    /**
     *  @param pos ...
     *  @param ts  ...
     *  @param txt ...
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position,ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree],txt: String)Unit" id="608430">appendText</a>(<a title="scala.tools.nsc.util.Position" id="714208">pos</a>: <a href="../../util/Position.scala.html#14710" title="scala.tools.nsc.util.Position">Position</a>, <a title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]" id="714209">ts</a>: mutable.<span title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">Buffer</span>[Tree],
                                   <a title="String" id="714210">txt</a>: <span title="String">String</span>) {
      <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#608402" title="=&gt; Boolean">preserveWS</a>) {
        <span class="keyword">for</span> (<a title="scala.xml.Text" id="714241">t</a> &lt;- <a title="object scala.xml.TextBuffer" id="40807">TextBuffer</a>.<a title="(str: String)scala.xml.TextBuffer" id="714213">fromString</a>(<a href="#714210" title="String">txt</a>).<a title="(f: (scala.xml.Text) =&gt; Unit)Unit" id="714226">toText</a>) {
          <a href="#714209" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605501" title="(pos: scala.tools.nsc.util.Position,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">text</a>(<a href="#714208" title="scala.tools.nsc.util.Position">pos</a>, <a href="#714241" title="scala.xml.Text">t</a>.<a title="=&gt; String" id="133851">text</a>))
        }
      }
      <span class="keyword">else</span>
        <a href="#714209" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>( <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605501" title="(pos: scala.tools.nsc.util.Position,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">text</a>(<a href="#714208" title="scala.tools.nsc.util.Position">pos</a>, <a href="#714210" title="String">txt</a>))
    }

    /** adds entity/character to to ts as side-effect 
     *  @precond ch == '&amp;amp;'
     */
    <span class="keyword">def</span> <a title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit" id="608431">content_AMP</a>(<a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="714255">ts</a>: mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]) {
      <a href="#608413" title="=&gt; Char">nextch</a>
      <a href="#608412" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> {
        <span title="Unit" class="keyword">case</span> <span title="Char('#')" class="char">'#'</span> =&gt; // CharacterRef
          <a href="#608413" title="=&gt; Char">nextch</a>
          <span class="keyword">val</span> <a title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" id="714257">theChar</a> = <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605501" title="(pos: scala.tools.nsc.util.Position,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">text</a>(<a href="#608410" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#608428" title="=&gt; String">xCharRef</a>)
          <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char(';')" class="char">';'</span>)
          <a href="#714255" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#714257" title="MarkupParser.this.parser.symbXMLBuilder.global.Tree">theChar</a>)
        <span title="Unit" class="keyword">case</span> _ =&gt; // EntityRef
          <span class="keyword">val</span> <a title="String" id="714265">n</a> = <a href="#608436" title="=&gt; String">xName</a>
          <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char(';')" class="char">';'</span>)
          <a href="#714255" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605500" title="(pos: scala.tools.nsc.util.Position,n: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">entityRef</a>(<a href="#608410" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#714265" title="String">n</a>))
      }
    }

    /**
     *  @precond ch == '{'
     *  @postcond: xEmbeddedBlock == false!
     */
    <span class="keyword">def</span> <a title="(p: scala.tools.nsc.util.Position,ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit" id="608432">content_BRACE</a>(<a title="scala.tools.nsc.util.Position" id="714273">p</a>: <a href="../../util/Position.scala.html#14710" title="scala.tools.nsc.util.Position">Position</a>, <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="714274">ts</a>:mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]) {
      <span title="Unit" class="keyword">if</span> (<a href="#608421" title="=&gt; Boolean">xCheckEmbeddedBlock</a>)
        <a href="#714274" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#608447" title="=&gt; MarkupParsers.this.global.Tree">xEmbeddedExpr</a>)
      <span class="keyword">else</span> {
        <a href="#608430" title="(pos: scala.tools.nsc.util.Position,ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree],txt: String)Unit">appendText</a>(<a href="#714273" title="scala.tools.nsc.util.Position">p</a>, <a href="#714274" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>, <a href="#608441" title="=&gt; String">xText</a>)/*
        val str = new StringBuilder(&quot;{&quot;)
        str.append(xText)
        nextch
        appendText(p, ts, str.toString())*/
      }
    }

    /** Returns true if it encounters an end tag (without consuming it),
     *  appends trees to ts as side-effect.
     *
     *  @param ts ...
     *  @return   ...
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Boolean" id="608433">content_LT</a>(<a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="714283">ts</a>: mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]): <span title="Boolean">Boolean</span> = {
      <a href="#608412" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> {
        <span title="Nothing" class="keyword">case</span> <span title="Char('/')" class="char">'/'</span> =&gt;
          <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>               // end tag
        <span title="Unit" class="keyword">case</span> <span title="Char('!')" class="char">'!'</span> =&gt;
          <a href="#608413" title="=&gt; Char">nextch</a>                    // CDATA or Comment
          <a href="#714283" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<span title="MarkupParsers.this.global.Tree" class="keyword">if</span> (<span title="(x$1: Char)Boolean" class="char">'['</span> == <a href="#608412" title="=&gt; Char">ch</a>) <a href="#608426" title="=&gt; MarkupParsers.this.global.Tree">xCharData</a> <span class="keyword">else</span> <a href="#608429" title="=&gt; MarkupParsers.this.global.Tree">xComment</a>)
        <span title="Unit" class="keyword">case</span> <span title="Char('?')" class="char">'?'</span> =&gt;                 // PI
          <a href="#608413" title="=&gt; Char">nextch</a>
          <a href="#714283" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#608440" title="=&gt; MarkupParsers.this.global.Tree">xProcInstr</a>)
        <span title="Unit" class="keyword">case</span> _   =&gt;
          <a href="#714283" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#608435" title="=&gt; MarkupParsers.this.global.Tree">element</a>)        // child node
      }
      <span title="Boolean(false)" class="keyword">false</span>
    }

    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]" id="608434">content</a>: mutable.<span title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">Buffer</span>[Tree] = {
      <span class="keyword">var</span> <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="714307">ts</a> = <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]
      <span class="keyword">var</span> <a title="Boolean" id="714308">exit</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span title="Unit" class="keyword">while</span> (<span title="=&gt; Boolean">!</span><a href="#714308" title="Boolean">exit</a>) {
        <a href="#714309" title="Unit" class="keyword">if</a> (<a href="#608415" title="=&gt; Boolean">xEmbeddedBlock</a>)
          <a href="#714307" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#608447" title="=&gt; MarkupParsers.this.global.Tree">xEmbeddedExpr</a>)
        <span class="keyword">else</span> {
          <a href="#608410" title="(x$1: scala.tools.nsc.util.Position)Unit">tmppos</a> = <a href="Parsers.scala.html#121324" title="(offset: Int)scala.tools.nsc.util.Position">o2p</a>(<a href="#608408" title="=&gt; Int">curOffset</a>)
          <a href="#608412" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> <span title="Char('&lt;')" class="char">'&lt;'</span> =&gt; // end tag, cdata, comment, pi or child node
              <a href="#608413" title="=&gt; Char">nextch</a>
              <a href="#714308" title="Boolean">exit</a> = <a href="#608433" title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Boolean">content_LT</a>(<a href="#714307" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
            <span title="Unit" class="keyword">case</span> <span title="Char('{')" class="char">'{'</span> =&gt; // either the character '{' or an embedded scala block
              <a href="#608432" title="(p: scala.tools.nsc.util.Position,ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit">content_BRACE</a>(<a href="#608410" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#714307" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
            <span title="Unit" class="keyword">case</span> <span title="Char('&amp;')" class="char">'&amp;'</span> =&gt; // EntityRef or CharRef 
              <a href="#608431" title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit">content_AMP</a>(<a href="#714307" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
            <span title="Unit" class="keyword">case</span> <span title="Char('\032')">SU</span> =&gt;
              <a href="#714308" title="Boolean">exit</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="Unit" class="keyword">case</span> _ =&gt;  // text content
              <a href="#608430" title="(pos: scala.tools.nsc.util.Position,ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree],txt: String)Unit">appendText</a>(<a href="#608410" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#714307" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>, <a href="#608441" title="=&gt; String">xText</a>)
              // here xEmbeddedBlock might be true
          }
        }
      }
      <a href="#714307" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>
    }

    /** '&lt;' element ::= xmlTag1 '&gt;'  { xmlExpr | '{' simpleExpr '}' } ETag
     *                | xmlTag1 '/' '&gt;'
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="608435">element</a>: <a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="Int" id="714335">start</a> = <a href="#608408" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a href="#714337" title="(String, scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree])">(</a><a href="#714336" title="String" id="714337">qname</a>, <a href="#714336" title="scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree]" id="714338">attrMap</a>) = <a href="#608424" title="=&gt; (String, scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree])">xTag</a>
      <span title="MarkupParsers.this.global.Tree" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('/')" class="char">'/'</span>) { // empty element
        <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('/')" class="char">'/'</span>)
        <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
        <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605518" title="(pos: scala.tools.nsc.util.Position,qname: String,attrMap: scala.collection.mutable.Map[String,MarkupParser.this.parser.symbXMLBuilder.global.Tree],args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">element</a>(<a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#714335" title="Int">start</a>, <a href="#714335" title="Int">start</a>, <a href="#608408" title="=&gt; Int">curOffset</a>), <a href="#714337" title="String">qname</a>, <a href="#714338" title="scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree]">attrMap</a>, <span title="scala.collection.mutable.ListBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<a title="scala.collection.mutable.ListBuffer[MarkupParsers.this.global.Tree]" id="24819">ListBuffer</a>[Tree])
      }
      <span class="keyword">else</span> { // handle content
        <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
        <span title="Unit" class="keyword">if</span> (<a href="#714337" title="(x$1: AnyRef)Boolean" id="3626">qname</a> == <span title="java.lang.String(&quot;xml:unparsed&quot;)" class="string">&quot;xml:unparsed&quot;</span>)
          <span title="Nothing" class="keyword">return</span> <a href="#608427" title="=&gt; MarkupParsers.this.global.Tree">xUnparsed</a>

        <a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="(elem: (Int, java.lang.String))scala.collection.mutable.Stack[(Int, String)]">push</span>(<span title="(_1: Int,_2: String)(Int, String)">(</span><a href="#714335" title="Int">start</a>, <a href="#714337" title="String">qname</a>))
        <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]" id="714376">ts</a> = <a href="#608434" title="=&gt; scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">content</a>
        <a href="#608425" title="(startName: String)Unit">xEndTag</a>(<a href="#714337" title="String">qname</a>)
        <a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="()(Int, String)">pop</span>
        <span class="keyword">val</span> <a title="scala.tools.nsc.util.Position" id="714377">pos</a> = <a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#714335" title="Int">start</a>, <a href="#714335" title="Int">start</a>, <a href="#608408" title="=&gt; Int">curOffset</a>)
        <a href="#714337" title="String">qname</a> <span title="MarkupParsers.this.global.Tree" class="keyword">match</span> {
          <span title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" class="keyword">case</span> <span title="java.lang.String(&quot;xml:group&quot;)" class="string">&quot;xml:group&quot;</span> =&gt; <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605516" title="(pos: scala.tools.nsc.util.Position,args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">group</a>(<a href="#714377" title="scala.tools.nsc.util.Position">pos</a>, <a href="#714376" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a>)
          <span title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" class="keyword">case</span> _ =&gt; <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605518" title="(pos: scala.tools.nsc.util.Position,qname: String,attrMap: scala.collection.mutable.Map[String,MarkupParser.this.parser.symbXMLBuilder.global.Tree],args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">element</a>(<a href="#714377" title="scala.tools.nsc.util.Position">pos</a>, <a href="#714337" title="String">qname</a>, <a href="#714338" title="scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree]">attrMap</a>, <a href="#714376" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a>)
        }
      }
    }

    /** actually, Name ::= (Letter | '_' | ':') (NameChar)*  but starting with ':' cannot happen
     *  Name ::= (Letter | '_') (NameChar)*
     *
     *  see  [5] of XML 1.0 specification
     *
     *  pre-condition:  ch != ':' // assured by definition of XMLSTART token
     *  post-condition: name does neither start, nor end in ':'
     */
    /*[Duplicate]*/   <span class="keyword">def</span> <a title="=&gt; String" id="608436">xName</a>: <span title="String">String</span> = {
      <span title="Unit" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>) {
	<span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
      } <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> ( <span title="=&gt; Boolean">!</span>xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isNameStart</span>(<a href="#608412" title="=&gt; Char">ch</a>)) {
        <a href="#608452" title="(str: String)Char">reportSyntaxError</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;name expected, but char '&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#608412" title="=&gt; Char">ch</a>+<span title="java.lang.String(&quot;' cannot start a name&quot;)" class="string">&quot;' cannot start a name&quot;</span>)
        <span title="Nothing" class="keyword">return</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      }
      <span class="keyword">val</span> <a title="StringBuilder" id="714430">buf</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>
      <a href="#714432" title="Unit" class="keyword">do</a> {
        <a href="#714430" title="(x: Char)StringBuilder">buf</a> append <a href="#608412" title="=&gt; Char">ch</a>; <a href="#608413" title="=&gt; Char">nextch</a>        
      } <span class="keyword">while</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<a title="(ch: Char)Boolean" id="524098">isNameChar</a>(<a href="#608412" title="=&gt; Char">ch</a>))
      <span title="Unit" class="keyword">if</span> (<span title="(x$1: Char)Boolean" class="char">':'</span> == <a href="#714430" title="StringBuilder">buf</a>.<a title="=&gt; Char" id="25782">last</a>) {
        <a href="#608452" title="(str: String)Char">reportSyntaxError</a>( <span title="java.lang.String(&quot;name cannot end in ':'&quot;)" class="string">&quot;name cannot end in ':'&quot;</span> )
        <a href="#714430" title="StringBuilder">buf</a>.<a title="(n: Int)Unit" id="57408">setLength</a>(<a href="#714430" title="StringBuilder">buf</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(1)" class="int">1</span>)
      }
      <span class="keyword">val</span> <a title="java.lang.String" id="714431">n</a> = <a href="#714430" title="StringBuilder">buf</a>.<span title="()String">toString</span>().<a title="()java.lang.String" id="7092">intern</a>()
      //cbuf.length = 0
      <a href="#714431" title="java.lang.String">n</a>
    }

    /** scan [S] '=' [S]*/
    /*[Duplicate]*/   <span class="keyword">def</span> <a title="=&gt; Unit" id="608437">xEQ</a> = { <a href="#608438" title="=&gt; Unit">xSpaceOpt</a>; <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('=')" class="char">'='</span>); <a href="#608438" title="=&gt; Unit">xSpaceOpt</a> }

    /** skip optional space S? */
    /*[Duplicate]*/   <span class="keyword">def</span> <a title="=&gt; Unit" id="608438">xSpaceOpt</a> = { <span title="Unit" class="keyword">while</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isSpace</span>(<a href="#608412" title="=&gt; Char">ch</a>)) { <a href="#608413" title="=&gt; Char">nextch</a> }}

    /** scan [3] S ::= (#x20 | #x9 | #xD | #xA)+ */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; AnyVal" id="608439">xSpace</a> =
      <span title="AnyVal with NotNull" class="keyword">if</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isSpace</span>(<a href="#608412" title="=&gt; Char">ch</a>)) { <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608438" title="=&gt; Unit">xSpaceOpt</a> }
      <span class="keyword">else</span> <span title="Char" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>)
        <span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
      <span class="keyword">else</span> <a href="#608452" title="(str: String)Char">reportSyntaxError</a>(<span title="java.lang.String(&quot;whitespace expected&quot;)" class="string">&quot;whitespace expected&quot;</span>)

    /** '&lt;?' ProcInstr ::= Name [S ({Char} - ({Char}'&gt;?' {Char})]'?&gt;'
     *
     * see [15]
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="608440">xProcInstr</a>: <a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="StringBuilder" id="714503">sb</a>: <span title="StringBuilder">StringBuilder</span> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>()
      <span class="keyword">val</span> <a title="String" id="714504">n</a> = <a href="#608436" title="=&gt; String">xName</a>
      <span title="Unit" class="keyword">if</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isSpace</span>(<a href="#608412" title="=&gt; Char">ch</a>)) {
        <a href="#608439" title="=&gt; AnyVal">xSpace</a>
        <span title="Unit" class="keyword">while</span> (<span title="Boolean(true)" class="keyword">true</span>) <a href="#714523" title="()Unit">{</a>
          <span title="StringBuilder" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> <span title="(x$1: Boolean)Boolean">==</span> <span title="Char('?')" class="char">'?'</span> &amp;&amp; { <a href="#714503" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>); <a href="#608413" title="=&gt; Char">nextch</a>; <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&gt;')" class="char">'&gt;'</span> }) {
            <a href="#714503" title="StringBuilder">sb</a>.<span title="(n: Int)Unit">length</span> = <a href="#714503" title="StringBuilder">sb</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(1)" class="int">1</span>
            <a href="#608413" title="=&gt; Char">nextch</a>
            <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605506" title="(pos: scala.tools.nsc.util.Position,target: String,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">procInstr</a>(<a href="#608410" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#714504" title="String">n</a>, <a href="#714503" title="StringBuilder">sb</a>.<span title="()String">toString</span>)
          } <span class="keyword">else</span> 
            <a href="#714503" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#608412" title="=&gt; Char">ch</a>);
          <a href="#608413" title="=&gt; Char">nextch</a>
        }
      }
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('?')" class="char">'?'</span>)
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>) 
      <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605506" title="(pos: scala.tools.nsc.util.Position,target: String,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">procInstr</a>(<a href="#608410" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#714504" title="String">n</a>, <a href="#714503" title="StringBuilder">sb</a>.<span title="()String">toString</span>)
    }

    /** parse character data.
     *  precondition: xEmbeddedBlock == false (we are not in a scala block)
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; String" id="608441">xText</a>: <span title="String">String</span> = {
      <span title="Unit" class="keyword">if</span> (<a href="#608415" title="=&gt; Boolean">xEmbeddedBlock</a>) <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;internal error: encountered embedded block&quot;)" class="string">&quot;internal error: encountered embedded block&quot;</span>); // assert
      //Console.println(&quot;xText ch now &quot;+ch)
      //if( xCheckEmbeddedBlock ) {
      //  return &quot;&quot;
      //} else {
        <span class="keyword">var</span> <a title="Boolean" id="714586">exit</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">val</span> <a title="StringBuilder" id="714587">buf</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>
        <span title="Unit" class="keyword">while</span> (<span title="(x$1: Boolean)Boolean">!</span><a href="#714586" title="Boolean">exit</a> &amp;&amp; (<a href="#608412" title="(x$1: Char)Boolean">ch</a>!=<span title="Char('\032')">SU</span>)) <a href="#714589" title="()Unit">{</a>
          <span class="keyword">val</span> <a title="Boolean" id="714614">expectRBRACE</a> = <a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('}')" class="char">'}'</span>
          <span title="AnyVal with NotNull" class="keyword">if</span> (<a href="#714614" title="Boolean">expectRBRACE</a>) {
            <span class="keyword">val</span> <a title="scala.tools.nsc.util.CharArrayReader" id="714622">la</a> = <a href="#608405" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#121697" title="=&gt; scala.tools.nsc.util.CharArrayReader">lookaheadReader</a>
            <a href="#714622" title="scala.tools.nsc.util.CharArrayReader">la</a>.<a href="../../util/CharArrayReader.scala.html#121693" title="()Unit">nextChar</a>()
            <span title="Unit" class="keyword">if</span> (<a href="#714622" title="scala.tools.nsc.util.CharArrayReader">la</a>.<a href="../../util/CharArrayReader.scala.html#121677" title="(x$1: Char)Boolean">ch</a> != <span title="Char('}')" class="char">'}'</span>) {
              <a href="#608452" title="(str: String)Char">reportSyntaxError</a>(<span title="java.lang.String(&quot;in XML content, please use '}}' to express '}'&quot;)" class="string">&quot;in XML content, please use '}}' to express '}'&quot;</span>)
              <span title="Nothing" class="keyword">throw</span> <a href="#713180" title="object MarkupParsers.this.ConfusedAboutBracesException">ConfusedAboutBracesException</a>
            }
            <a href="#608413" title="=&gt; Char">nextch</a>
          }
          <a href="#714587" title="(x: Char)StringBuilder">buf</a> append <a href="#608412" title="=&gt; Char">ch</a>
          <a href="#608413" title="=&gt; Char">nextch</a>
          <a href="#714586" title="Boolean">exit</a> = <a href="#608421" title="(x$1: Boolean)Boolean">xCheckEmbeddedBlock</a> <span title="(x$1: Boolean)Boolean">||</span>(<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&lt;')" class="char">'&lt;'</span>) || (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&amp;')" class="char">'&amp;'</span>)
        }
        <span class="keyword">val</span> <a title="String" id="714588">str</a> = <a href="#714587" title="StringBuilder">buf</a>.<span title="()String">toString</span>()
        //cbuf.length = 0
        <a href="#714588" title="String">str</a>
      //}
    }

    //val cbuf = new StringBuilder()

    /** append Unicode character to name buffer*/
    //private def putChar(c: char) = cbuf.append(c)

    /** xLiteral = element { element }
     *  @return Scala representation of this xml literal
     *  precondition: s.xStartsXML == true
     */
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="608442">xLiteral</a>: <a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = <span class="keyword">try</span> {
      <a href="#608405" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>
      <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605453" title="(x$1: Boolean)Unit">isPattern</a> = <span title="Boolean(false)" class="keyword">false</span>
      
      //val pos = s.currentPos
      <span class="keyword">var</span> <a title="MarkupParsers.this.global.Tree" id="714668">tree</a>:<a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="714669">ts</a> = <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]()
      <span class="keyword">val</span> <a title="Int" id="714670">start</a> = <a href="#608408" title="=&gt; Int">curOffset</a>
      <a href="#608410" title="(x$1: scala.tools.nsc.util.Position)Unit">tmppos</a> = <a href="Parsers.scala.html#121324" title="(offset: Int)scala.tools.nsc.util.Position">o2p</a>(<a href="#608408" title="=&gt; Int">curOffset</a>)    // Iuli: added this line, as it seems content_LT uses tmppos when creating trees
//      assert(ch == '&lt;')
//      nextch
      <a href="#608433" title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Boolean">content_LT</a>(<a href="#714669" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
      //Console.println(&quot;xLiteral:ts = &quot;+ts.toList)
      //lastend = s.in.bp
      //lastch  = s.in.ch
      //if (settings.debug.value) {
      //  Console.println(&quot;DEBUG 1: I am getting char '&quot;+ch+&quot;' at lastend &quot;+lastend+&quot; pos = &quot;+pos); // DEBUG 
      //}
      <a href="#608405" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#608405" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#121697" title="=&gt; scala.tools.nsc.util.CharArrayReader">lookaheadReader</a>
      <a href="#608438" title="=&gt; Unit">xSpaceOpt</a>
      // parse more XML ?
      <span title="Unit" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&lt;')" class="char">'&lt;'</span>) {
        <a href="#608405" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>
        <a href="#608438" title="=&gt; Unit">xSpaceOpt</a>
        <span title="Unit" class="keyword">while</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&lt;')" class="char">'&lt;'</span>) <a href="#714698" title="()Unit">{</a>
          <a href="#608413" title="=&gt; Char">nextch</a>
          <a href="#714669" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#608435" title="=&gt; MarkupParsers.this.global.Tree">element</a>)
          <a href="#608438" title="=&gt; Unit">xSpaceOpt</a>
        }
        <a href="#714668" title="MarkupParsers.this.global.Tree">tree</a> = <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605514" title="(pos: scala.tools.nsc.util.Position,args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Block">makeXMLseq</a>(<a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#714670" title="Int">start</a>, <a href="#714670" title="Int">start</a>, <a href="#608408" title="=&gt; Int">curOffset</a>), <a href="#714669" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
      } <span class="keyword">else</span> {
        <a href="#608405" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>
        <a title="(assertion: Boolean)Unit" id="7874">assert</a>(<a href="#714669" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<a title="(x$1: Int)Boolean" id="108582">length</a> == <span title="Int(1)" class="int">1</span>)
        <a href="#714668" title="MarkupParsers.this.global.Tree">tree</a> = <a href="#714669" title="(idx: Int)MarkupParsers.this.global.Tree" id="108583">ts</a>(<span title="Int(0)" class="int">0</span>)
      }
      <a href="#714668" title="MarkupParsers.this.global.Tree">tree</a>
    } <span class="keyword">catch</span> {
      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> <a title="object MarkupParsers.this.TruncatedXML" id="714741">c</a> @ <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a> =&gt;
        <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121333" title="(msg: String)Unit">incompleteInputError</a>(<a href="#714741" title="object MarkupParsers.this.TruncatedXML">c</a>.<a href="#713182" title="()java.lang.String">getMessage</a>)
        <a href="../Trees.scala.html#26602" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>

      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> <a title="java.lang.Throwable" id="714746">c</a> @ (<a href="#713146" title="object MarkupParsers.this.MissingEndTagException">MissingEndTagException</a> | <a href="#713180" title="object MarkupParsers.this.ConfusedAboutBracesException">ConfusedAboutBracesException</a>) =&gt;
        <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121334" title="(offset: Int,msg: String)Unit">syntaxError</a>((<a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; Int">_1</span>):<span title="Int">Int</span>,
                           <a href="#714746" title="java.lang.Throwable">c</a>.<span title="(x$1: Any)java.lang.String">getMessage</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; String">_2</span>+<span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>)
        <a href="../Trees.scala.html#26602" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>

      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> _:<span title="ArrayIndexOutOfBoundsException">ArrayIndexOutOfBoundsException</span> =&gt; 
        <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121334" title="(offset: Int,msg: String)Unit">syntaxError</a>((<a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; Int">_1</span>),
                      <span title="(x$1: Any)java.lang.String" class="string">&quot;missing end tag in XML literal for &lt;&quot;</span>
                      <span title="(x$1: Any)java.lang.String">+</span><a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; String">_2</span>+<span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>);
        <a href="../Trees.scala.html#26602" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>
    } <span class="keyword">finally</span> {
      <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#121700" title="(lastCode: Int)Unit">resume</a>(Tokens.<span title="Int(96)">XMLSTART</span>)
    }

    /** @see xmlPattern. resynchronizes after successful parse 
     *  @return this xml pattern
     *  precondition: s.xStartsXML == true
     */
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="608443">xLiteralPattern</a>: <a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = <span class="keyword">try</span> {
      <a href="#608405" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>
      <span class="keyword">val</span> <a title="Boolean" id="714775">oldMode</a> = <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605452" title="=&gt; Boolean">isPattern</a>;
      <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605453" title="(x$1: Boolean)Unit">isPattern</a> = <span title="Boolean(true)" class="keyword">true</span>
//      assert(ch == '&lt;')
//      nextch
      <span class="keyword">var</span> <a title="MarkupParsers.this.global.Tree" id="714776">tree</a> = <a href="#608453" title="=&gt; MarkupParsers.this.global.Tree">xPattern</a>; <a href="#608438" title="=&gt; Unit">xSpaceOpt</a>;
      <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605453" title="(x$1: Boolean)Unit">isPattern</a> = <a href="#714775" title="Boolean">oldMode</a>;
      <a href="#714776" title="MarkupParsers.this.global.Tree">tree</a>
    } <span class="keyword">catch</span> {
      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> <a title="object MarkupParsers.this.TruncatedXML" id="714785">c</a> @ <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a> =&gt;
        <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121334" title="(offset: Int,msg: String)Unit">syntaxError</a>(<a href="#608408" title="=&gt; Int">curOffset</a>, <a href="#714785" title="object MarkupParsers.this.TruncatedXML">c</a>.<a href="#713182" title="()java.lang.String">getMessage</a>)
        <a href="../Trees.scala.html#26602" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>

      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> <a title="java.lang.Throwable" id="714794">c</a> @ (<a href="#713146" title="object MarkupParsers.this.MissingEndTagException">MissingEndTagException</a> | <a href="#713180" title="object MarkupParsers.this.ConfusedAboutBracesException">ConfusedAboutBracesException</a>) =&gt;
        <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121334" title="(offset: Int,msg: String)Unit">syntaxError</a>((<a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; Int">_1</span>),
                      <a href="#714794" title="java.lang.Throwable">c</a>.<span title="(x$1: Any)java.lang.String">getMessage</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; String">_2</span>+<span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>)
        <a href="../Trees.scala.html#26602" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>

      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> _:<span title="ArrayIndexOutOfBoundsException">ArrayIndexOutOfBoundsException</span> =&gt;
        <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121334" title="(offset: Int,msg: String)Unit">syntaxError</a>((<a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; Int">_1</span>),
                      <span title="(x$1: Any)java.lang.String" class="string">&quot;missing end tag in XML literal for &lt;&quot;</span>
                      <span title="(x$1: Any)java.lang.String">+</span><a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; String">_2</span>+<span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>)
        <a href="../Trees.scala.html#26602" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>
    } <span class="keyword">finally</span> {
      <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#121700" title="(lastCode: Int)Unit">resume</a>(Tokens.<span title="Int(96)">XMLSTART</span>)
    }

    <span class="keyword">def</span> <a title="[A](op: =&gt; A,kind: String)A" id="608444">escapeToScala</a>[<a title="&gt;: Nothing &lt;: Any" id="608446">A</a><a id="1">]</a>(<a title="=&gt; A" id="714823">op</a>: =&gt; A, <a title="String" id="714824">kind</a>: <span title="String">String</span>) = {
      <a href="#608415" title="(x$1: Boolean)Unit">xEmbeddedBlock</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">val</span> <a title="List[Int]" id="714827">savedSepRegions</a> = <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#121724" title="=&gt; List[Int]">sepRegions</a>
      <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#121700" title="(lastCode: Int)Unit">resume</a>(<span title="Int(94)">LBRACE</span>)
      <span class="keyword">try</span> {
        <a href="#714823" title="=&gt; A">op</a> //p.expr(true,false);
      } <span class="keyword">finally</span> {
        <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#121725" title="(x$1: List[Int])Unit">sepRegions</a> = <a href="#714827" title="List[Int]">savedSepRegions</a> // parser.in.sepRegions.tail
        <span title="Unit" class="keyword">if</span> (<a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121321" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#121759" title="(x$1: Int)Boolean">token</a> != <span title="Int(95)">RBRACE</span>) {
          <a href="#608452" title="(str: String)Char">reportSyntaxError</a><span title="Unit">(</span><span title="(x$1: Any)java.lang.String" class="string">&quot; expected end of Scala &quot;</span>+<a href="#714824" title="String">kind</a>)
        }
      }
    } 

    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="608447">xEmbeddedExpr</a>: <a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = <a href="#608444" title="(op: =&gt; MarkupParsers.this.global.Tree,kind: String)MarkupParsers.this.global.Tree">escapeToScala</a>(<a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121251" title="()MarkupParsers.this.global.Tree">block</a>(), <span title="java.lang.String(&quot;block&quot;)" class="string">&quot;block&quot;</span>)

    /** xScalaPatterns  ::= patterns
     */
    <span class="keyword">def</span> <a title="=&gt; List[MarkupParsers.this.global.Tree]" id="608448">xScalaPatterns</a>: <span title="List[MarkupParsers.this.global.Tree]">List</span>[Tree] = <a href="#608444" title="(op: =&gt; List[MarkupParsers.this.global.Tree],kind: String)List[MarkupParsers.this.global.Tree]">escapeToScala</a>(<a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121259" title="(seqOK: Boolean)List[MarkupParsers.this.global.Tree]">patterns</a>(<span title="Boolean(true)" class="keyword">true</span>), <span title="java.lang.String(&quot;pattern&quot;)" class="string">&quot;pattern&quot;</span>)

    <span class="keyword">var</span> <a title="List[List[Int]]" id="608450">scannerState</a>: <span title="List[List[Int]]">List</span>[List[Int]] = <a title="object Nil" id="7634">Nil</a>

/*
    private def pushScannerState {
      scannerState = s.sepRegions :: scannerState
      s.sepRegions = Nil
    }
    private def popScannerState { 
      s.sepRegions = scannerState.head
      scannerState = scannerState.tail
    }
    */
/*
    private def init {
      ch = s.in.ch
      curOffset = s.in.ccurOffset
    }
    */

    <span class="keyword">def</span> <a title="(str: String)Char" id="608452">reportSyntaxError</a>(<a title="String" id="713273">str</a>: <span title="String">String</span>) = {
      <a href="#608454" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121334" title="(offset: Int,msg: String)Unit">syntaxError</a>(<a href="#608408" title="=&gt; Int">curOffset</a>, <span title="(x$1: Any)java.lang.String" class="string">&quot;in XML literal: &quot;</span> + <a href="#713273" title="String">str</a>)
      <a href="#608413" title="=&gt; Char">nextch</a>
    }
/*
    private def sync {
      xEmbeddedBlock = false
      s.xSync
    }
*/
    /** '&lt;' xPattern  ::= Name [S] { xmlPattern | '{' pattern3 '}' } ETag
     *                  | Name [S] '/' '&gt;'
     */
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="608453">xPattern</a>: <a href="../Trees.scala.html#26593" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">var</span> <a title="Int" id="714867">start</a> = <a href="#608408" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a title="String" id="714868">qname</a> = <a href="#608436" title="=&gt; String">xName</a>
      <a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="(elem: (Int, java.lang.String))scala.collection.mutable.Stack[(Int, String)]">push</span>(<span title="(_1: Int,_2: String)(Int, String)">(</span><a href="#714867" title="Int">start</a>, <a href="#714868" title="String">qname</a>))
      <a href="#608438" title="=&gt; Unit">xSpaceOpt</a>
      <span title="Unit" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('/')" class="char">'/'</span>) { // empty tag
        <a href="#608413" title="=&gt; Char">nextch</a>
        <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
        <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605509" title="(pos: scala.tools.nsc.util.Position,n: String,args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">makeXMLpat</a>(<a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#714867" title="Int">start</a>, <a href="#714867" title="Int">start</a>, <a href="#608408" title="=&gt; Int">curOffset</a>), <a href="#714868" title="String">qname</a>, <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]())
      }

      // else: tag with content
      <a href="#608417" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
      <span class="keyword">var</span> <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="714869">ts</a> = <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]
      <span class="keyword">var</span> <a title="Boolean" id="714870">exit</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span title="Unit" class="keyword">while</span> (<span title="=&gt; Boolean">!</span> <a href="#714870" title="Boolean">exit</a>) <a href="#714871" title="()Unit">{</a>
        <span class="keyword">val</span> <a title="Int" id="714934">start1</a> = <a href="#608408" title="=&gt; Int">curOffset</a>
        <span title="Any" class="keyword">if</span> (<a href="#608415" title="=&gt; Boolean">xEmbeddedBlock</a>) {
          <a href="#714869" title="(iter: Traversable[MarkupParsers.this.global.Tree])scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> ++= <a href="#608448" title="=&gt; List[MarkupParsers.this.global.Tree]">xScalaPatterns</a>
        } <span class="keyword">else</span>
          <a href="#608412" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> <span title="Char('&lt;')" class="char">'&lt;'</span> =&gt; // tag
              <a href="#608413" title="=&gt; Char">nextch</a>
              <span title="Unit" class="keyword">if</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> != <span title="Char('/')" class="char">'/'</span>) { //child
                <a href="#714869" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#608453" title="=&gt; MarkupParsers.this.global.Tree">xPattern</a>)
              } <span class="keyword">else</span> {
                <a href="#714870" title="Boolean">exit</a> = <span title="Boolean(true)" class="keyword">true</span>
              }
            <span title="Unit" class="keyword">case</span> <span title="Char('{')" class="char">'{'</span> =&gt; // embedded Scala patterns
              <span title="Unit" class="keyword">while</span> (<a href="#608412" title="(x$1: Char)Boolean">ch</a> == <span title="Char('{')" class="char">'{'</span>) <a href="#714986" title="()Unit">{</a>
                <a href="#608413" title="=&gt; Char">nextch</a>
                <a href="#714869" title="(iter: Traversable[MarkupParsers.this.global.Tree])scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> ++= <a href="#608448" title="=&gt; List[MarkupParsers.this.global.Tree]">xScalaPatterns</a>
              }
              // postcond: xEmbeddedBlock = false;
              <span title="Unit" class="keyword">if</span> (<a href="#608415" title="=&gt; Boolean">xEmbeddedBlock</a>) <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;problem with embedded block&quot;)" class="string">&quot;problem with embedded block&quot;</span>); // assert

            <span title="Nothing" class="keyword">case</span> <span title="Char('\032')">SU</span> =&gt;
              <span title="Nothing" class="keyword">throw</span> <a href="#713214" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>

            <span title="Unit" class="keyword">case</span> _ =&gt; // text 
              <a href="#608430" title="(pos: scala.tools.nsc.util.Position,ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree],txt: String)Unit">appendText</a>(<a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#714934" title="Int">start1</a>, <a href="#714934" title="Int">start1</a>, <a href="#608408" title="=&gt; Int">curOffset</a>), <a href="#714869" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>, <a href="#608441" title="=&gt; String">xText</a>)
              // here  xEmbeddedBlock might be true;
              //if( xEmbeddedBlock ) throw new ApplicationError(&quot;after:&quot;+text); // assert
          }
      }
      <a href="#608425" title="(startName: String)Unit">xEndTag</a>(<a href="#714868" title="String">qname</a>)
      <a href="#608419" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="()(Int, String)">pop</span>
      <a href="Parsers.scala.html#121338" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#605509" title="(pos: scala.tools.nsc.util.Position,n: String,args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">makeXMLpat</a>(<a href="Parsers.scala.html#121325" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#714867" title="Int">start</a>, <a href="#714867" title="Int">start</a>, <a href="#608408" title="=&gt; Int">curOffset</a>), <a href="#714868" title="String">qname</a>, <a href="#714869" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
    }

  } /* class MarkupParser */
}

        </pre>
    </body>
</html>