<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/ast/parser/MarkupParsers.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author Burak Emir
 */
// $Id: MarkupParsers.scala 17754 2009-05-18 10:54:00Z milessabin $

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> ast.parser

<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> scala.util.control.ControlException
<span class="keyword">import</span> scala.tools.nsc.util.{Position,NoPosition,SourceFile,CharArrayReader}
<span class="keyword">import</span> scala.xml.{Text, TextBuffer}
<span class="keyword">import</span> SourceFile.{SU,LF}
<span class="keyword">import</span> scala.annotation.switch

/** This trait ...
 *
 *  @author  Burak Emir
 *  @version 1.0
 */
<span class="keyword">trait</span> <a title="trait MarkupParsers extends java.lang.Object with ScalaObject" id="12332">MarkupParsers</a> <span title="ScalaObject">{</span>self: Parsers =&gt;
  case <span class="keyword">object</span> <a href="#714842" title="object MarkupParsers.this.MissingEndTagException" id="714853">MissingEndTagException</a> <span title="ScalaObject" class="keyword">extends</span> <span title="java.lang.RuntimeException">RuntimeException</span> <span class="keyword">with</span> <span title="scala.util.control.ControlException">ControlException</span> {
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="714818">getMessage</a> = <span title="java.lang.String(&quot;start tag was here: &quot;)" class="string">&quot;start tag was here: &quot;</span>
  }

  case <span class="keyword">object</span> <a href="#714876" title="object MarkupParsers.this.ConfusedAboutBracesException" id="714887">ConfusedAboutBracesException</a> <span title="ScalaObject" class="keyword">extends</span> <span title="java.lang.RuntimeException">RuntimeException</span> <span class="keyword">with</span> <span title="scala.util.control.ControlException">ControlException</span> {
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="714855">getMessage</a> = <span title="java.lang.String(&quot; I encountered a '}' where I didn't expect one, maybe this tag isn't closed &lt;&quot;)" class="string">&quot; I encountered a '}' where I didn't expect one, maybe this tag isn't closed &lt;&quot;</span>
  }

  case <span class="keyword">object</span> <a href="#714910" title="object MarkupParsers.this.TruncatedXML" id="714921">TruncatedXML</a> <span title="ScalaObject" class="keyword">extends</span> <span title="java.lang.RuntimeException">RuntimeException</span> <span class="keyword">with</span> <span title="scala.util.control.ControlException">ControlException</span> {
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="714889">getMessage</a> = <span title="java.lang.String(&quot;input ended while parsing XML&quot;)" class="string">&quot;input ended while parsing XML&quot;</span>
  }

  <span class="keyword">import</span> global._

  <span class="keyword">class</span> <a title="class MarkupParser extends java.lang.Object with ScalaObject" id="39976">MarkupParser</a><span title="ScalaObject">(</span><a title="MarkupParsers.this.UnitParser" id="610053">parser</a>: <a href="Parsers.scala.html#39941" title="MarkupParsers.this.UnitParser">UnitParser</a>, <a title="Boolean" id="610054">presWS</a>: <span title="Boolean">Boolean</span>) /*with scala.xml.parsing.MarkupParser[Tree,Tree] */{

    <span class="keyword">import</span> Tokens.{EMPTY, LBRACE, RBRACE}

    <span class="keyword">final</span> <span class="keyword">val</span> <a title="Boolean" id="610001">preserveWS</a> = <a href="#610054" title="Boolean">presWS</a>
    <span class="keyword">var</span> <a title="scala.tools.nsc.util.CharArrayReader" id="610004">input</a> : <a href="../../util/CharArrayReader.scala.html#14674" title="scala.tools.nsc.util.CharArrayReader">CharArrayReader</a> = _

    <span class="keyword">import</span> parser.{symbXMLBuilder =&gt; handle, o2p, r2p}

    <span class="keyword">def</span> <a title="=&gt; Int" id="610007">curOffset</a> : <span title="Int">Int</span> = <a href="#610004" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#122190" title="(x$1: Int)Int">charOffset</a> - <span title="Int(1)" class="int">1</span>
    <span class="keyword">var</span> <a title="scala.tools.nsc.util.Position" id="610009">tmppos</a> : <a href="../../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a> = <a href="../../util/Position.scala.html#14615" title="object scala.tools.nsc.util.NoPosition">NoPosition</a>
    <span class="keyword">def</span> <a title="=&gt; Char" id="610011">ch</a> = <a href="#610004" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#122187" title="=&gt; Char">ch</a>
    /** this method assign the next character to ch and advances in input */
    <span class="keyword">def</span> <a title="=&gt; Char" id="610012">nextch</a> = { <span class="keyword">val</span> <a title="Char" id="714961">result</a> = <a href="#610004" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#122187" title="=&gt; Char">ch</a>; <a href="#610004" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#122203" title="()Unit">nextChar</a>(); <a href="#714961" title="Char">result</a> } // { s.in.next; /*s.xNext;*/ ch = s.in.ch ; pos = s.in.cpos }

    <span class="keyword">var</span> <a title="Boolean" id="610014">xEmbeddedBlock</a> = <span title="Boolean(false)" class="keyword">false</span>

    /** munch expected XML token, report syntax error for unexpected.
     *
     *  @param that ...
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="(that: Char)Unit" id="610016">xToken</a>(<a title="Char" id="714964">that</a>: <span title="Char">Char</span>) {
      <span title="Unit" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <a href="#714964" title="Char">that</a>) <a href="#610012" title="=&gt; Char">nextch</a>
      <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>)
	<span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
      <span class="keyword">else</span> <a href="#610051" title="(str: String)Char">reportSyntaxError</a><span title="Unit">(</span><span title="(x$1: Any)java.lang.String" class="string">&quot;'&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#714964" title="Char">that</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' expected instead of '&quot;)" class="string">&quot;' expected instead of '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#610011" title="=&gt; Char">ch</a> + <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
    }

    <span class="keyword">var</span> <a title="scala.collection.mutable.Stack[(Int, String)]" id="610018">debugLastStartElement</a> = <a title="()scala.collection.mutable.Stack[(Int, String)]" id="79374" class="keyword">new</a> mutable.<a title="scala.collection.mutable.Stack[(Int, String)]" id="25101">Stack</a>[(Int, String)]

    /** checks whether next character starts a Scala block, if yes, skip it.
     * @return true if next character starts a scala block 
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; Boolean" id="610020">xCheckEmbeddedBlock</a>: <span title="Boolean">Boolean</span> = {
      // attentions, side-effect, used in xText
      <a href="#610014" title="(x$1: Boolean)Unit">xEmbeddedBlock</a> = <span title="(x$1: Boolean)Boolean">(</span><a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('{')" class="char">'{'</span>) &amp;&amp; { <a href="#610012" title="=&gt; Char">nextch</a>; (<a href="#610011" title="(x$1: Char)Boolean">ch</a> != <span title="Char('{')" class="char">'{'</span>) }
      //Console.println(&quot;pos = &quot;+pos+&quot; xEmbeddedBlock returns &quot;+xEmbeddedBlock)
      <a href="#610014" title="=&gt; Boolean">xEmbeddedBlock</a>
    }

    /** parse attribute and add it to listmap
     *  [41] Attributes   ::= { S Name Eq AttValue }
     *       AttValue     ::= `'` { _  } `'`
     *                      | `&quot;` { _ } `&quot;`
     *                      | `{` scalablock `}`
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" id="610021">xAttributes</a> = {
      <span class="keyword">var</span> <a title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" id="715024">aMap</a> = <span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">HashMap</span>[String, Tree]()
      <span title="Unit" class="keyword">while</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isNameStart</span>(<a href="#610011" title="=&gt; Char">ch</a>)) <a href="#715025" title="()Unit">{</a>
        <span class="keyword">val</span> <a title="Int" id="715030">start</a> = <a href="#610007" title="=&gt; Int">curOffset</a>
        <span class="keyword">val</span> <a title="String" id="715031">key</a> = <a href="#610035" title="=&gt; String">xName</a>
        <a href="#610036" title="=&gt; Unit">xEQ</a>
        <span class="keyword">val</span> <a title="Char" id="715032">delim</a> = <a href="#610011" title="=&gt; Char">ch</a>
        <span class="keyword">val</span> <a title="Int" id="715033">mid</a> = <a href="#610007" title="=&gt; Int">curOffset</a>
        <span class="keyword">val</span> <a title="MarkupParsers.this.global.Tree" id="715034">value</a>: /* AttribValue[*/<a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a>/*]*/ = <a href="#610011" title="=&gt; Char">ch</a> <span title="MarkupParsers.this.global.Tree" class="keyword">match</span> {
          <span title="MarkupParsers.this.global.Tree" class="keyword">case</span> <span title="Char('&quot;')" class="char">'&quot;'</span> | <span title="Char(''')" class="char">'\''</span> =&gt;
            <a href="#610012" title="=&gt; Char">nextch</a>
            <span class="keyword">val</span> <a title="String" id="715054">tmp</a> = <a href="#610022" title="(endCh: Char)String">xAttributeValue</a>(<a href="#715032" title="Char">delim</a>)
            <a href="#610012" title="=&gt; Char">nextch</a>
            <span class="keyword">try</span> {
              <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607111" title="(pos: scala.tools.nsc.util.Position,s: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">parseAttribute</a>(<a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#715030" title="Int">start</a>, <a href="#715033" title="Int">mid</a>, <a href="#610007" title="=&gt; Int">curOffset</a>), <a href="#715054" title="String">tmp</a>)
            } <span class="keyword">catch</span> {
              <span title="MarkupParsers.this.global.Literal" class="keyword">case</span> <a title="java.lang.Throwable" id="715063">e</a> =&gt; 
                <a href="#610051" title="(str: String)Char">reportSyntaxError</a>(<span title="java.lang.String(&quot;error parsing attribute value&quot;)" class="string">&quot;error parsing attribute value&quot;</span>)
                <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121679" title="=&gt; MarkupParsers.this.global.Literal">errorTermTree</a>
            }
          
          <span title="MarkupParsers.this.global.Tree" class="keyword">case</span> <span title="Char('{')" class="char">'{'</span>  =&gt;
            <a href="#610012" title="=&gt; Char">nextch</a>
            <a href="#610046" title="=&gt; MarkupParsers.this.global.Tree">xEmbeddedExpr</a>
          <span title="Nothing" class="keyword">case</span> <span title="Char('\032')">SU</span> =&gt;
            <span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
          <span title="MarkupParsers.this.global.Literal" class="keyword">case</span> _ =&gt;
            <a href="#610051" title="(str: String)Char">reportSyntaxError</a>(<span class="string">&quot;' or \&quot; delimited attribute value&quot;</span> <span title="java.lang.String(&quot;' or &quot; delimited attribute value or '{' scala-expr '}' expected&quot;)">+</span>
                              <span class="string">&quot; or '{' scala-expr '}' expected&quot;</span> )
            <a href="../Trees.scala.html#49595" title="(value: MarkupParsers.this.global.Constant)MarkupParsers.this.global.Literal">Literal</a>(<a href="../../symtab/Constants.scala.html#49805" title="(value: Any)MarkupParsers.this.global.Constant">Constant</a>(<span title="java.lang.String(&quot;&lt;syntax-error&gt;&quot;)" class="string">&quot;&lt;syntax-error&gt;&quot;</span>))
        }
        // well-formedness constraint: unique attribute names
        <span title="AnyVal with NotNull" class="keyword">if</span> (<a href="#715024" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a>.<a title="(key: String)Boolean" id="44678">contains</a>(<a href="#715031" title="String">key</a>)) {
          <a href="#610051" title="(str: String)Char">reportSyntaxError</a>( <span title="(x$1: Any)java.lang.String" class="string">&quot;attribute &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#715031" title="String">key</a>+<span title="java.lang.String(&quot; may only be defined once&quot;)" class="string">&quot; may only be defined once&quot;</span> )
        }
        <a href="#715024" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a>.<a title="(key: String,value: MarkupParsers.this.global.Tree)Unit" id="44618">update</a>(<a href="#715031" title="String">key</a>, <a href="#715034" title="MarkupParsers.this.global.Tree">value</a>)
        <span title="AnyVal" class="keyword">if</span> (<span title="(x$1: Boolean)Boolean">(</span><a href="#610011" title="(x$1: Char)Boolean">ch</a> != <span title="Char('/')" class="char">'/'</span>) &amp;&amp; (<a href="#610011" title="(x$1: Char)Boolean">ch</a> != <span title="Char('&gt;')" class="char">'&gt;'</span>)) {
          <a href="#610038" title="=&gt; AnyVal">xSpace</a>
        }
      }
      <a href="#715024" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a>
    }

    /** attribute value, terminated by either ' or &quot;. value may not contain &lt;.
     *  @param endch either ' or &quot;
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="(endCh: Char)String" id="610022">xAttributeValue</a>(<a title="Char" id="715055">endCh</a>: <span title="Char">Char</span>): <span title="String">String</span> = {
      <span class="keyword">val</span> <a title="StringBuilder" id="715173">buf</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>      
      <span title="Unit" class="keyword">while</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> != <a href="#715055" title="Char">endCh</a>) <a href="#715175" title="()Unit">{</a>
        <span title="Unit" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>)
          <span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
        <a href="#715173" title="(x: Char)StringBuilder">buf</a> append <a href="#610011" title="=&gt; Char">ch</a>
        <a href="#610012" title="=&gt; Char">nextch</a>
      }
      <span class="keyword">val</span> <a title="String" id="715174">str</a> = <a href="#715173" title="StringBuilder">buf</a>.<span title="()String">toString</span>()
      
      // @todo: normalize attribute value
      // well-formedness constraint
      <span title="String" class="keyword">if</span> (<a href="#715174" title="String">str</a>.<a title="(x$1: Int)Int" id="7047">indexOf</a><span title="(x$1: Int)Boolean">(</span><span title="Int(60)" class="char">'&lt;'</span>) != <span title="Int(-1)">-</span><span class="int">1</span>) {
        <a href="#610051" title="(str: String)Char">reportSyntaxError</a>( <span title="java.lang.String(&quot;'&lt;' not allowed in attrib value&quot;)" class="string">&quot;'&lt;' not allowed in attrib value&quot;</span> ); <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      } <span class="keyword">else</span> {
        <a href="#715174" title="String">str</a>
      }
    }

    /** parse a start or empty tag.
     *  [40] STag         ::= '&lt;' Name { S Attribute } [S] 
     *  [44] EmptyElemTag ::= '&lt;' Name { S Attribute } [S] 
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; (String, scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree])" id="610023">xTag</a>: <a title="(String, scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree])" id="1175">(</a>String, mutable.Map[String, Tree]) = {
      <span class="keyword">val</span> <a title="String" id="715237">elemName</a> = <a href="#610035" title="=&gt; String">xName</a>
      <a href="#610037" title="=&gt; Unit">xSpaceOpt</a>
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" id="715238">aMap</a> =
        <span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" class="keyword">if</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isNameStart</span>(<a href="#610011" title="=&gt; Char">ch</a>)) <a href="#610021" title="=&gt; scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">xAttributes</a>
        <span class="keyword">else</span> <span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">HashMap</span>[String, Tree]()
      <span title="(_1: String,_2: scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree])(String, scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree])">(</span><a href="#715237" title="String">elemName</a>, <a href="#715238" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a>)
    }

    /** [42]  '&lt;' xmlEndTag ::=  '&lt;' '/' Name S? '&gt;'
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="(startName: String)Unit" id="610024">xEndTag</a>(<a title="String" id="715251">startName</a>: <span title="String">String</span>) {
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('/')" class="char">'/'</span>)
      <span class="keyword">val</span> <a title="String" id="715253">endName</a> = <a href="#610035" title="=&gt; String">xName</a>
      <span title="Unit" class="keyword">if</span> (<a href="#715253" title="(x$1: AnyRef)Boolean" id="6609">endName</a> != <a href="#715251" title="String">startName</a>) {
        <a href="#610051" title="(str: String)Char">reportSyntaxError</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;expected closing tag of &quot;</span> + <a href="#715251" title="String">startName</a>)
        <span title="Nothing" class="keyword">throw</span> <a href="#714853" title="object MarkupParsers.this.MissingEndTagException">MissingEndTagException</a>
      }
      <a href="#610037" title="=&gt; Unit">xSpaceOpt</a>
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
    }

    /** '&lt;! CharData ::= [CDATA[ ( {char} - {char}&quot;]]&gt;&quot;{char} ) ']]&gt;'
     *
     * see [15]
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="610025">xCharData</a>: <a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="Int" id="715270">start</a> = <a href="#610007" title="=&gt; Int">curOffset</a>
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('[')" class="char">'['</span>)
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('C')" class="char">'C'</span>)
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('D')" class="char">'D'</span>)
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('A')" class="char">'A'</span>)
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('T')" class="char">'T'</span>)
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('A')" class="char">'A'</span>)
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('[')" class="char">'['</span>)
      <span class="keyword">val</span> <a title="Int" id="715271">mid</a> = <a href="#610007" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a title="StringBuilder" id="715272">sb</a>: <span title="StringBuilder">StringBuilder</span> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>()
      <span title="Unit" class="keyword">while</span> (<span title="Boolean(true)" class="keyword">true</span>) <a href="#715273" title="()Unit">{</a>
        <span title="StringBuilder" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a><span title="(x$1: Boolean)Boolean">==</span><span title="Char(']')" class="char">']'</span> <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715272" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char(']')" class="char">']'</span> } &amp;&amp;
           { <a href="#715272" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&gt;')" class="char">'&gt;'</span> }) {
          <a href="#715272" title="StringBuilder">sb</a>.<span title="(n: Int)Unit">length</span> = <a href="#715272" title="StringBuilder">sb</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(2)" class="int">2</span>
          <a href="#610012" title="=&gt; Char">nextch</a>
          <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607104" title="(pos: scala.tools.nsc.util.Position,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">charData</a>(<a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#715270" title="Int">start</a>, <a href="#715271" title="Int">mid</a>, <a href="#610007" title="=&gt; Int">curOffset</a>), <a href="#715272" title="StringBuilder">sb</a>.<span title="()String">toString</span>())
        } <span class="keyword">else</span> <span title="StringBuilder" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>)
          <span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
        <span class="keyword">else</span>
          <a href="#715272" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>)
        <a href="#610012" title="=&gt; Char">nextch</a>
      }
      <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;this cannot happen&quot;)" class="string">&quot;this cannot happen&quot;</span>)
    }

    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="610026">xUnparsed</a>: <a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="Int" id="715383">start</a> = <a href="#610007" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a title="StringBuilder" id="715384">sb</a>: <span title="StringBuilder">StringBuilder</span> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>()
      <span title="Unit" class="keyword">while</span> (<span title="Boolean(true)" class="keyword">true</span>) <a href="#715385" title="()Unit">{</a>
        <span title="StringBuilder" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a><span title="(x$1: Boolean)Boolean">==</span><span title="Char('&lt;')" class="char">'&lt;'</span> <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('/')" class="char">'/'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('x')" class="char">'x'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('m')" class="char">'m'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('l')" class="char">'l'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char(':')" class="char">':'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('u')" class="char">'u'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('n')" class="char">'n'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('p')" class="char">'p'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('a')" class="char">'a'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('r')" class="char">'r'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('s')" class="char">'s'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('e')" class="char">'e'</span> } <span title="(x$1: Boolean)Boolean">&amp;&amp;</span>
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('d')" class="char">'d'</span> } &amp;&amp;
           { <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&gt;')" class="char">'&gt;'</span> }) {
          <a href="#715384" title="StringBuilder">sb</a>.<span title="(n: Int)Unit">length</span> = <a href="#715384" title="StringBuilder">sb</a>.<span title="(x$1: Int)Int">length</span> - <span title="java.lang.String(&quot;&lt;/xml:unparsed&quot;)" class="string">&quot;&lt;/xml:unparsed&quot;</span>.<a title="()Int" id="6984">length</a>
          <a href="#610012" title="=&gt; Char">nextch</a>
          <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607116" title="(pos: scala.tools.nsc.util.Position,str: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">unparsed</a>(<a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#715383" title="Int">start</a>, <a href="#715383" title="Int">start</a>, <a href="#610007" title="=&gt; Int">curOffset</a>), <a href="#715384" title="StringBuilder">sb</a>.<span title="()String">toString</span>())
        } <span class="keyword">else</span> <span title="StringBuilder" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>) {
          <span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
        } <span class="keyword">else</span> <a href="#715384" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>)
        <a href="#610012" title="=&gt; Char">nextch</a>
      }
      <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;this cannot happen&quot;)" class="string">&quot;this cannot happen&quot;</span>)
    }

    /** CharRef ::= &quot;&amp;#&quot; '0'..'9' {'0'..'9'} &quot;;&quot;
     *            | &quot;&amp;#x&quot; '0'..'9'|'A'..'F'|'a'..'f' { hexdigit } &quot;;&quot;
     *
     * see [66]
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; String" id="610027">xCharRef</a>: <span title="String">String</span> = {
      <span class="keyword">val</span> <a title="Boolean" id="715664">hex</a> = <span title="(x$1: Boolean)Boolean">(</span><a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('x')" class="char">'x'</span>) &amp;&amp; { <a href="#610012" title="=&gt; Char">nextch</a>; <span title="Boolean(true)" class="keyword">true</span> }
      <span class="keyword">val</span> <a title="Int" id="715665">base</a> = <span title="Int" class="keyword">if</span> (<a href="#715664" title="Boolean">hex</a>) <span title="Int(16)" class="int">16</span> <span class="keyword">else</span> <span title="Int(10)" class="int">10</span>
      <span class="keyword">var</span> <a title="Int" id="715666">i</a> = <span title="Int(0)" class="int">0</span>
      <span title="Unit" class="keyword">while</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> != <span title="Char(';')" class="char">';'</span>) <a href="#715667" title="()Unit">{</a> 
        (<a href="#610011" title="=&gt; Char">ch</a>: @<span title="Char @scala.annotation.switch">switch</span>) <span title="AnyVal" class="keyword">match</span> {
          <span title="Unit" class="keyword">case</span> <span title="Char('0')" class="char">'0'</span> | <span title="Char('1')" class="char">'1'</span> | <span title="Char('2')" class="char">'2'</span> | <span title="Char('3')" class="char">'3'</span> | <span title="Char('4')" class="char">'4'</span> | <span title="Char('5')" class="char">'5'</span> | <span title="Char('6')" class="char">'6'</span> | <span title="Char('7')" class="char">'7'</span> | <span title="Char('8')" class="char">'8'</span> | <span title="Char('9')" class="char">'9'</span> =&gt;
            <a href="#715666" title="Int">i</a> = <a href="#715666" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">*</span> <a href="#715665" title="Int">base</a> + <a href="#610011" title="implicit scala.Predef.charWrapper : (c: Char)scala.runtime.RichChar">ch</a>.<span title="=&gt; Int">asDigit</span>
          <span title="AnyVal with NotNull" class="keyword">case</span> <span title="Char('a')" class="char">'a'</span> | <span title="Char('b')" class="char">'b'</span> | <span title="Char('c')" class="char">'c'</span> | <span title="Char('d')" class="char">'d'</span> | <span title="Char('e')" class="char">'e'</span> | <span title="Char('f')" class="char">'f'</span>
             | <span title="Char('A')" class="char">'A'</span> | <span title="Char('B')" class="char">'B'</span> | <span title="Char('C')" class="char">'C'</span> | <span title="Char('D')" class="char">'D'</span> | <span title="Char('E')" class="char">'E'</span> | <span title="Char('F')" class="char">'F'</span> =&gt;
            <span title="AnyVal with NotNull" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#715664" title="Boolean">hex</a>)
              <a href="#610051" title="(str: String)Char">reportSyntaxError</a>(<span class="string">&quot;hex char not allowed in decimal char ref\n&quot;</span>
                           <span title="java.lang.String(&quot;hex char not allowed in decimal char ref\012Did you mean to write &amp;#x ?&quot;)">+</span><span class="string">&quot;Did you mean to write &amp;#x ?&quot;</span>);
            <span class="keyword">else</span>
              <a href="#715666" title="Int">i</a> = <a href="#715666" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">*</span> <a href="#715665" title="Int">base</a> + <a href="#610011" title="implicit scala.Predef.charWrapper : (c: Char)scala.runtime.RichChar">ch</a>.<span title="=&gt; Int">asDigit</span>
          <span title="Nothing" class="keyword">case</span> <span title="Char('\032')">SU</span> =&gt;
            <span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
          <span title="Char" class="keyword">case</span> _ =&gt;
            <a href="#610051" title="(str: String)Char">reportSyntaxError</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;character '&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#610011" title="=&gt; Char">ch</a>+<span title="java.lang.String(&quot;' not allowed in char ref&quot;)" class="string">&quot;' not allowed in char ref&quot;</span>)
        }
        <a href="#610012" title="=&gt; Char">nextch</a>
      }
      <a title="(x$1: Array[Char])java.lang.String" id="6630" class="keyword">new</a> <a title="java.lang.String" id="7886">String</a>(<a title="(xs: Char*)Array[Char]" id="906">Array</a>(<a href="#715666" title="Int">i</a>.<a title="[T0]T0" id="3644">asInstanceOf</a><span title="Char">[</span><span title="Char">Char</span>]))
    }

    /** Comment ::= '&lt;!--' ((Char - '-') | ('-' (Char - '-')))* '--&gt;'
     *
     * see [15]
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="610028">xComment</a>: <a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="Int" id="715822">start</a> = <a href="#610007" title="(x$1: Int)Int">curOffset</a> - <span title="Int(2)" class="int">2</span> // ? right so ?
      <span class="keyword">val</span> <a title="StringBuilder" id="715823">sb</a>: <span title="StringBuilder">StringBuilder</span> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>()
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('-')" class="char">'-'</span>)
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('-')" class="char">'-'</span>)
      <span title="Unit" class="keyword">while</span> (<span title="Boolean(true)" class="keyword">true</span>) <a href="#715824" title="()Unit">{</a>
        <span title="StringBuilder" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a><span title="(x$1: Boolean)Boolean">==</span><span title="Char('-')" class="char">'-'</span>  &amp;&amp; { <a href="#715823" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('-')" class="char">'-'</span> }) {
          <a href="#715823" title="StringBuilder">sb</a>.<span title="(n: Int)Unit">length</span> = <a href="#715823" title="StringBuilder">sb</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(1)" class="int">1</span>
          <a href="#610012" title="=&gt; Char">nextch</a>
          <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
          <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607103" title="(pos: scala.tools.nsc.util.Position,text: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">comment</a>(<a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#715822" title="Int">start</a>, <a href="#715822" title="Int">start</a>, <a href="#610007" title="=&gt; Int">curOffset</a>), <a href="#715823" title="StringBuilder">sb</a>.<span title="()String">toString</span>())
        } <span class="keyword">else</span> <span title="StringBuilder" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>) {
          <span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
        } <span class="keyword">else</span> <a href="#715823" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>)
        <a href="#610012" title="=&gt; Char">nextch</a>
      }
      <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;this cannot happen&quot;)" class="string">&quot;this cannot happen&quot;</span>)
    }

    /**
     *  @param pos ...
     *  @param ts  ...
     *  @param txt ...
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position,ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree],txt: String)Unit" id="610029">appendText</a>(<a title="scala.tools.nsc.util.Position" id="715915">pos</a>: <a href="../../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a>, <a title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]" id="715916">ts</a>: mutable.<span title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">Buffer</span>[Tree],
                                   <a title="String" id="715917">txt</a>: <span title="String">String</span>) {
      <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span><a href="#610001" title="=&gt; Boolean">preserveWS</a>) {
        <span class="keyword">for</span> (<a title="scala.xml.Text" id="715948">t</a> &lt;- <a title="object scala.xml.TextBuffer" id="41039">TextBuffer</a>.<a title="(str: String)scala.xml.TextBuffer" id="715920">fromString</a>(<a href="#715917" title="String">txt</a>).<a title="(f: (scala.xml.Text) =&gt; Unit)Unit" id="715933">toText</a>) {
          <a href="#715916" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607100" title="(pos: scala.tools.nsc.util.Position,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">text</a>(<a href="#715915" title="scala.tools.nsc.util.Position">pos</a>, <a href="#715948" title="scala.xml.Text">t</a>.<a title="=&gt; String" id="134429">text</a>))
        }
      }
      <span class="keyword">else</span>
        <a href="#715916" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>( <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607100" title="(pos: scala.tools.nsc.util.Position,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">text</a>(<a href="#715915" title="scala.tools.nsc.util.Position">pos</a>, <a href="#715917" title="String">txt</a>))
    }

    /** adds entity/character to to ts as side-effect 
     *  @precond ch == '&amp;amp;'
     */
    <span class="keyword">def</span> <a title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit" id="610030">content_AMP</a>(<a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="715962">ts</a>: mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]) {
      <a href="#610012" title="=&gt; Char">nextch</a>
      <a href="#610011" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> {
        <span title="Unit" class="keyword">case</span> <span title="Char('#')" class="char">'#'</span> =&gt; // CharacterRef
          <a href="#610012" title="=&gt; Char">nextch</a>
          <span class="keyword">val</span> <a title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" id="715964">theChar</a> = <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607100" title="(pos: scala.tools.nsc.util.Position,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">text</a>(<a href="#610009" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#610027" title="=&gt; String">xCharRef</a>)
          <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char(';')" class="char">';'</span>)
          <a href="#715962" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#715964" title="MarkupParser.this.parser.symbXMLBuilder.global.Tree">theChar</a>)
        <span title="Unit" class="keyword">case</span> _ =&gt; // EntityRef
          <span class="keyword">val</span> <a title="String" id="715972">n</a> = <a href="#610035" title="=&gt; String">xName</a>
          <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char(';')" class="char">';'</span>)
          <a href="#715962" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607099" title="(pos: scala.tools.nsc.util.Position,n: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">entityRef</a>(<a href="#610009" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#715972" title="String">n</a>))
      }
    }

    /**
     *  @precond ch == '{'
     *  @postcond: xEmbeddedBlock == false!
     */
    <span class="keyword">def</span> <a title="(p: scala.tools.nsc.util.Position,ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit" id="610031">content_BRACE</a>(<a title="scala.tools.nsc.util.Position" id="715980">p</a>: <a href="../../util/Position.scala.html#14785" title="scala.tools.nsc.util.Position">Position</a>, <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="715981">ts</a>:mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]) {
      <span title="Unit" class="keyword">if</span> (<a href="#610020" title="=&gt; Boolean">xCheckEmbeddedBlock</a>)
        <a href="#715981" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#610046" title="=&gt; MarkupParsers.this.global.Tree">xEmbeddedExpr</a>)
      <span class="keyword">else</span> {
        <a href="#610029" title="(pos: scala.tools.nsc.util.Position,ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree],txt: String)Unit">appendText</a>(<a href="#715980" title="scala.tools.nsc.util.Position">p</a>, <a href="#715981" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>, <a href="#610040" title="=&gt; String">xText</a>)/*
        val str = new StringBuilder(&quot;{&quot;)
        str.append(xText)
        nextch
        appendText(p, ts, str.toString())*/
      }
    }

    /** Returns true if it encounters an end tag (without consuming it),
     *  appends trees to ts as side-effect.
     *
     *  @param ts ...
     *  @return   ...
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Boolean" id="610032">content_LT</a>(<a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="715990">ts</a>: mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]): <span title="Boolean">Boolean</span> = {
      <a href="#610011" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> {
        <span title="Nothing" class="keyword">case</span> <span title="Char('/')" class="char">'/'</span> =&gt;
          <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>               // end tag
        <span title="Unit" class="keyword">case</span> <span title="Char('!')" class="char">'!'</span> =&gt;
          <a href="#610012" title="=&gt; Char">nextch</a>                    // CDATA or Comment
          <a href="#715990" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<span title="MarkupParsers.this.global.Tree" class="keyword">if</span> (<span title="(x$1: Char)Boolean" class="char">'['</span> == <a href="#610011" title="=&gt; Char">ch</a>) <a href="#610025" title="=&gt; MarkupParsers.this.global.Tree">xCharData</a> <span class="keyword">else</span> <a href="#610028" title="=&gt; MarkupParsers.this.global.Tree">xComment</a>)
        <span title="Unit" class="keyword">case</span> <span title="Char('?')" class="char">'?'</span> =&gt;                 // PI
          <a href="#610012" title="=&gt; Char">nextch</a>
          <a href="#715990" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#610039" title="=&gt; MarkupParsers.this.global.Tree">xProcInstr</a>)
        <span title="Unit" class="keyword">case</span> _   =&gt;
          <a href="#715990" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#610034" title="=&gt; MarkupParsers.this.global.Tree">element</a>)        // child node
      }
      <span title="Boolean(false)" class="keyword">false</span>
    }

    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]" id="610033">content</a>: mutable.<span title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">Buffer</span>[Tree] = {
      <span class="keyword">var</span> <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="716014">ts</a> = <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]
      <span class="keyword">var</span> <a title="Boolean" id="716015">exit</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span title="Unit" class="keyword">while</span> (<span title="=&gt; Boolean">!</span><a href="#716015" title="Boolean">exit</a>) {
        <a href="#716016" title="Unit" class="keyword">if</a> (<a href="#610014" title="=&gt; Boolean">xEmbeddedBlock</a>)
          <a href="#716014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#610046" title="=&gt; MarkupParsers.this.global.Tree">xEmbeddedExpr</a>)
        <span class="keyword">else</span> {
          <a href="#610009" title="(x$1: scala.tools.nsc.util.Position)Unit">tmppos</a> = <a href="Parsers.scala.html#121834" title="(offset: Int)scala.tools.nsc.util.Position">o2p</a>(<a href="#610007" title="=&gt; Int">curOffset</a>)
          <a href="#610011" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> <span title="Char('&lt;')" class="char">'&lt;'</span> =&gt; // end tag, cdata, comment, pi or child node
              <a href="#610012" title="=&gt; Char">nextch</a>
              <a href="#716015" title="Boolean">exit</a> = <a href="#610032" title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Boolean">content_LT</a>(<a href="#716014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
            <span title="Unit" class="keyword">case</span> <span title="Char('{')" class="char">'{'</span> =&gt; // either the character '{' or an embedded scala block
              <a href="#610031" title="(p: scala.tools.nsc.util.Position,ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit">content_BRACE</a>(<a href="#610009" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#716014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
            <span title="Unit" class="keyword">case</span> <span title="Char('&amp;')" class="char">'&amp;'</span> =&gt; // EntityRef or CharRef 
              <a href="#610030" title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit">content_AMP</a>(<a href="#716014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
            <span title="Unit" class="keyword">case</span> <span title="Char('\032')">SU</span> =&gt;
              <a href="#716015" title="Boolean">exit</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="Unit" class="keyword">case</span> _ =&gt;  // text content
              <a href="#610029" title="(pos: scala.tools.nsc.util.Position,ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree],txt: String)Unit">appendText</a>(<a href="#610009" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#716014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>, <a href="#610040" title="=&gt; String">xText</a>)
              // here xEmbeddedBlock might be true
          }
        }
      }
      <a href="#716014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>
    }

    /** '&lt;' element ::= xmlTag1 '&gt;'  { xmlExpr | '{' simpleExpr '}' } ETag
     *                | xmlTag1 '/' '&gt;'
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="610034">element</a>: <a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="Int" id="716042">start</a> = <a href="#610007" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a href="#716044" title="(String, scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree])">(</a><a href="#716043" title="String" id="716044">qname</a>, <a href="#716043" title="scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree]" id="716045">attrMap</a>) = <a href="#610023" title="=&gt; (String, scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree])">xTag</a>
      <span title="MarkupParsers.this.global.Tree" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('/')" class="char">'/'</span>) { // empty element
        <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('/')" class="char">'/'</span>)
        <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
        <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607117" title="(pos: scala.tools.nsc.util.Position,qname: String,attrMap: scala.collection.mutable.Map[String,MarkupParser.this.parser.symbXMLBuilder.global.Tree],args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">element</a>(<a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#716042" title="Int">start</a>, <a href="#716042" title="Int">start</a>, <a href="#610007" title="=&gt; Int">curOffset</a>), <a href="#716044" title="String">qname</a>, <a href="#716045" title="scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree]">attrMap</a>, <span title="scala.collection.mutable.ListBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<a title="scala.collection.mutable.ListBuffer[MarkupParsers.this.global.Tree]" id="24978">ListBuffer</a>[Tree])
      }
      <span class="keyword">else</span> { // handle content
        <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
        <span title="Unit" class="keyword">if</span> (<a href="#716044" title="(x$1: AnyRef)Boolean" id="3647">qname</a> == <span title="java.lang.String(&quot;xml:unparsed&quot;)" class="string">&quot;xml:unparsed&quot;</span>)
          <span title="Nothing" class="keyword">return</span> <a href="#610026" title="=&gt; MarkupParsers.this.global.Tree">xUnparsed</a>

        <a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="(elem: (Int, java.lang.String))scala.collection.mutable.Stack[(Int, String)]">push</span>(<span title="(_1: Int,_2: String)(Int, String)">(</span><a href="#716042" title="Int">start</a>, <a href="#716044" title="String">qname</a>))
        <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]" id="716083">ts</a> = <a href="#610033" title="=&gt; scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">content</a>
        <a href="#610024" title="(startName: String)Unit">xEndTag</a>(<a href="#716044" title="String">qname</a>)
        <a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="()(Int, String)">pop</span>
        <span class="keyword">val</span> <a title="scala.tools.nsc.util.Position" id="716084">pos</a> = <a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#716042" title="Int">start</a>, <a href="#716042" title="Int">start</a>, <a href="#610007" title="=&gt; Int">curOffset</a>)
        <a href="#716044" title="String">qname</a> <span title="MarkupParsers.this.global.Tree" class="keyword">match</span> {
          <span title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" class="keyword">case</span> <span title="java.lang.String(&quot;xml:group&quot;)" class="string">&quot;xml:group&quot;</span> =&gt; <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607115" title="(pos: scala.tools.nsc.util.Position,args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">group</a>(<a href="#716084" title="scala.tools.nsc.util.Position">pos</a>, <a href="#716083" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a>)
          <span title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" class="keyword">case</span> _ =&gt; <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607117" title="(pos: scala.tools.nsc.util.Position,qname: String,attrMap: scala.collection.mutable.Map[String,MarkupParser.this.parser.symbXMLBuilder.global.Tree],args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">element</a>(<a href="#716084" title="scala.tools.nsc.util.Position">pos</a>, <a href="#716044" title="String">qname</a>, <a href="#716045" title="scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree]">attrMap</a>, <a href="#716083" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a>)
        }
      }
    }

    /** actually, Name ::= (Letter | '_' | ':') (NameChar)*  but starting with ':' cannot happen
     *  Name ::= (Letter | '_') (NameChar)*
     *
     *  see  [5] of XML 1.0 specification
     *
     *  pre-condition:  ch != ':' // assured by definition of XMLSTART token
     *  post-condition: name does neither start, nor end in ':'
     */
    /*[Duplicate]*/   <span class="keyword">def</span> <a title="=&gt; String" id="610035">xName</a>: <span title="String">String</span> = {
      <span title="Unit" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>) {
	<span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
      } <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> ( <span title="=&gt; Boolean">!</span>xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isNameStart</span>(<a href="#610011" title="=&gt; Char">ch</a>)) {
        <a href="#610051" title="(str: String)Char">reportSyntaxError</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;name expected, but char '&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#610011" title="=&gt; Char">ch</a>+<span title="java.lang.String(&quot;' cannot start a name&quot;)" class="string">&quot;' cannot start a name&quot;</span>)
        <span title="Nothing" class="keyword">return</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      }
      <span class="keyword">val</span> <a title="StringBuilder" id="716137">buf</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>
      <a href="#716139" title="Unit" class="keyword">do</a> {
        <a href="#716137" title="(x: Char)StringBuilder">buf</a> append <a href="#610011" title="=&gt; Char">ch</a>; <a href="#610012" title="=&gt; Char">nextch</a>        
      } <span class="keyword">while</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<a title="(ch: Char)Boolean" id="525286">isNameChar</a>(<a href="#610011" title="=&gt; Char">ch</a>))
      <span title="Unit" class="keyword">if</span> (<span title="(x$1: Char)Boolean" class="char">':'</span> == <a href="#716137" title="StringBuilder">buf</a>.<a title="=&gt; Char" id="25941">last</a>) {
        <a href="#610051" title="(str: String)Char">reportSyntaxError</a>( <span title="java.lang.String(&quot;name cannot end in ':'&quot;)" class="string">&quot;name cannot end in ':'&quot;</span> )
        <a href="#716137" title="StringBuilder">buf</a>.<a title="(n: Int)Unit" id="57668">setLength</a>(<a href="#716137" title="StringBuilder">buf</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(1)" class="int">1</span>)
      }
      <span class="keyword">val</span> <a title="java.lang.String" id="716138">n</a> = <a href="#716137" title="StringBuilder">buf</a>.<span title="()String">toString</span>().<a title="()java.lang.String" id="7161">intern</a>()
      //cbuf.length = 0
      <a href="#716138" title="java.lang.String">n</a>
    }

    /** scan [S] '=' [S]*/
    /*[Duplicate]*/   <span class="keyword">def</span> <a title="=&gt; Unit" id="610036">xEQ</a> = { <a href="#610037" title="=&gt; Unit">xSpaceOpt</a>; <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('=')" class="char">'='</span>); <a href="#610037" title="=&gt; Unit">xSpaceOpt</a> }

    /** skip optional space S? */
    /*[Duplicate]*/   <span class="keyword">def</span> <a title="=&gt; Unit" id="610037">xSpaceOpt</a> = { <span title="Unit" class="keyword">while</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isSpace</span>(<a href="#610011" title="=&gt; Char">ch</a>)) { <a href="#610012" title="=&gt; Char">nextch</a> }}

    /** scan [3] S ::= (#x20 | #x9 | #xD | #xA)+ */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; AnyVal" id="610038">xSpace</a> =
      <span title="AnyVal with NotNull" class="keyword">if</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isSpace</span>(<a href="#610011" title="=&gt; Char">ch</a>)) { <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610037" title="=&gt; Unit">xSpaceOpt</a> }
      <span class="keyword">else</span> <span title="Char" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('\032')">SU</span>)
        <span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>
      <span class="keyword">else</span> <a href="#610051" title="(str: String)Char">reportSyntaxError</a>(<span title="java.lang.String(&quot;whitespace expected&quot;)" class="string">&quot;whitespace expected&quot;</span>)

    /** '&lt;?' ProcInstr ::= Name [S ({Char} - ({Char}'&gt;?' {Char})]'?&gt;'
     *
     * see [15]
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="610039">xProcInstr</a>: <a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">val</span> <a title="StringBuilder" id="716210">sb</a>: <span title="StringBuilder">StringBuilder</span> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>()
      <span class="keyword">val</span> <a title="String" id="716211">n</a> = <a href="#610035" title="=&gt; String">xName</a>
      <span title="Unit" class="keyword">if</span> (xml.<span title="object scala.xml.Parsing">Parsing</span>.<span title="(ch: Char)Boolean">isSpace</span>(<a href="#610011" title="=&gt; Char">ch</a>)) {
        <a href="#610038" title="=&gt; AnyVal">xSpace</a>
        <span title="Unit" class="keyword">while</span> (<span title="Boolean(true)" class="keyword">true</span>) <a href="#716230" title="()Unit">{</a>
          <span title="StringBuilder" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> <span title="(x$1: Boolean)Boolean">==</span> <span title="Char('?')" class="char">'?'</span> &amp;&amp; { <a href="#716210" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>); <a href="#610012" title="=&gt; Char">nextch</a>; <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&gt;')" class="char">'&gt;'</span> }) {
            <a href="#716210" title="StringBuilder">sb</a>.<span title="(n: Int)Unit">length</span> = <a href="#716210" title="StringBuilder">sb</a>.<span title="(x$1: Int)Int">length</span> - <span title="Int(1)" class="int">1</span>
            <a href="#610012" title="=&gt; Char">nextch</a>
            <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607105" title="(pos: scala.tools.nsc.util.Position,target: String,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">procInstr</a>(<a href="#610009" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#716211" title="String">n</a>, <a href="#716210" title="StringBuilder">sb</a>.<span title="()String">toString</span>)
          } <span class="keyword">else</span> 
            <a href="#716210" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span>(<a href="#610011" title="=&gt; Char">ch</a>);
          <a href="#610012" title="=&gt; Char">nextch</a>
        }
      }
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('?')" class="char">'?'</span>)
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>) 
      <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607105" title="(pos: scala.tools.nsc.util.Position,target: String,txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">procInstr</a>(<a href="#610009" title="=&gt; scala.tools.nsc.util.Position">tmppos</a>, <a href="#716211" title="String">n</a>, <a href="#716210" title="StringBuilder">sb</a>.<span title="()String">toString</span>)
    }

    /** parse character data.
     *  precondition: xEmbeddedBlock == false (we are not in a scala block)
     */
    /*[Duplicate]*/ <span class="keyword">def</span> <a title="=&gt; String" id="610040">xText</a>: <span title="String">String</span> = {
      <span title="Unit" class="keyword">if</span> (<a href="#610014" title="=&gt; Boolean">xEmbeddedBlock</a>) <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;internal error: encountered embedded block&quot;)" class="string">&quot;internal error: encountered embedded block&quot;</span>); // assert
      //Console.println(&quot;xText ch now &quot;+ch)
      //if( xCheckEmbeddedBlock ) {
      //  return &quot;&quot;
      //} else {
        <span class="keyword">var</span> <a title="Boolean" id="716293">exit</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">val</span> <a title="StringBuilder" id="716294">buf</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>
        <span title="Unit" class="keyword">while</span> (<span title="(x$1: Boolean)Boolean">!</span><a href="#716293" title="Boolean">exit</a> &amp;&amp; (<a href="#610011" title="(x$1: Char)Boolean">ch</a>!=<span title="Char('\032')">SU</span>)) <a href="#716296" title="()Unit">{</a>
          <span class="keyword">val</span> <a title="Boolean" id="716321">expectRBRACE</a> = <a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('}')" class="char">'}'</span>
          <span title="AnyVal with NotNull" class="keyword">if</span> (<a href="#716321" title="Boolean">expectRBRACE</a>) {
            <span class="keyword">val</span> <a title="scala.tools.nsc.util.CharArrayReader" id="716329">la</a> = <a href="#610004" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#122207" title="=&gt; scala.tools.nsc.util.CharArrayReader">lookaheadReader</a>
            <a href="#716329" title="scala.tools.nsc.util.CharArrayReader">la</a>.<a href="../../util/CharArrayReader.scala.html#122203" title="()Unit">nextChar</a>()
            <span title="Unit" class="keyword">if</span> (<a href="#716329" title="scala.tools.nsc.util.CharArrayReader">la</a>.<a href="../../util/CharArrayReader.scala.html#122187" title="(x$1: Char)Boolean">ch</a> != <span title="Char('}')" class="char">'}'</span>) {
              <a href="#610051" title="(str: String)Char">reportSyntaxError</a>(<span title="java.lang.String(&quot;in XML content, please use '}}' to express '}'&quot;)" class="string">&quot;in XML content, please use '}}' to express '}'&quot;</span>)
              <span title="Nothing" class="keyword">throw</span> <a href="#714887" title="object MarkupParsers.this.ConfusedAboutBracesException">ConfusedAboutBracesException</a>
            }
            <a href="#610012" title="=&gt; Char">nextch</a>
          }
          <a href="#716294" title="(x: Char)StringBuilder">buf</a> append <a href="#610011" title="=&gt; Char">ch</a>
          <a href="#610012" title="=&gt; Char">nextch</a>
          <a href="#716293" title="Boolean">exit</a> = <a href="#610020" title="(x$1: Boolean)Boolean">xCheckEmbeddedBlock</a> <span title="(x$1: Boolean)Boolean">||</span>(<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&lt;')" class="char">'&lt;'</span>) || (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&amp;')" class="char">'&amp;'</span>)
        }
        <span class="keyword">val</span> <a title="String" id="716295">str</a> = <a href="#716294" title="StringBuilder">buf</a>.<span title="()String">toString</span>()
        //cbuf.length = 0
        <a href="#716295" title="String">str</a>
      //}
    }

    //val cbuf = new StringBuilder()

    /** append Unicode character to name buffer*/
    //private def putChar(c: char) = cbuf.append(c)

    /** xLiteral = element { element }
     *  @return Scala representation of this xml literal
     *  precondition: s.xStartsXML == true
     */
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="610041">xLiteral</a>: <a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = <span class="keyword">try</span> {
      <a href="#610004" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>
      <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607052" title="(x$1: Boolean)Unit">isPattern</a> = <span title="Boolean(false)" class="keyword">false</span>
      
      //val pos = s.currentPos
      <span class="keyword">var</span> <a title="MarkupParsers.this.global.Tree" id="716375">tree</a>:<a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="716376">ts</a> = <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]()
      <span class="keyword">val</span> <a title="Int" id="716377">start</a> = <a href="#610007" title="=&gt; Int">curOffset</a>
      <a href="#610009" title="(x$1: scala.tools.nsc.util.Position)Unit">tmppos</a> = <a href="Parsers.scala.html#121834" title="(offset: Int)scala.tools.nsc.util.Position">o2p</a>(<a href="#610007" title="=&gt; Int">curOffset</a>)    // Iuli: added this line, as it seems content_LT uses tmppos when creating trees
//      assert(ch == '&lt;')
//      nextch
      <a href="#610032" title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Boolean">content_LT</a>(<a href="#716376" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
      //Console.println(&quot;xLiteral:ts = &quot;+ts.toList)
      //lastend = s.in.bp
      //lastch  = s.in.ch
      //if (settings.debug.value) {
      //  Console.println(&quot;DEBUG 1: I am getting char '&quot;+ch+&quot;' at lastend &quot;+lastend+&quot; pos = &quot;+pos); // DEBUG 
      //}
      <a href="#610004" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#610004" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#122207" title="=&gt; scala.tools.nsc.util.CharArrayReader">lookaheadReader</a>
      <a href="#610037" title="=&gt; Unit">xSpaceOpt</a>
      // parse more XML ?
      <span title="Unit" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&lt;')" class="char">'&lt;'</span>) {
        <a href="#610004" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>
        <a href="#610037" title="=&gt; Unit">xSpaceOpt</a>
        <span title="Unit" class="keyword">while</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('&lt;')" class="char">'&lt;'</span>) <a href="#716405" title="()Unit">{</a>
          <a href="#610012" title="=&gt; Char">nextch</a>
          <a href="#716376" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#610034" title="=&gt; MarkupParsers.this.global.Tree">element</a>)
          <a href="#610037" title="=&gt; Unit">xSpaceOpt</a>
        }
        <a href="#716375" title="MarkupParsers.this.global.Tree">tree</a> = <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607113" title="(pos: scala.tools.nsc.util.Position,args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Block">makeXMLseq</a>(<a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#716377" title="Int">start</a>, <a href="#716377" title="Int">start</a>, <a href="#610007" title="=&gt; Int">curOffset</a>), <a href="#716376" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
      } <span class="keyword">else</span> {
        <a href="#610004" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>
        <a title="(assertion: Boolean)Unit" id="7943">assert</a>(<a href="#716376" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<a title="(x$1: Int)Boolean" id="108980">length</a> == <span title="Int(1)" class="int">1</span>)
        <a href="#716375" title="MarkupParsers.this.global.Tree">tree</a> = <a href="#716376" title="(idx: Int)MarkupParsers.this.global.Tree" id="108981">ts</a>(<span title="Int(0)" class="int">0</span>)
      }
      <a href="#716375" title="MarkupParsers.this.global.Tree">tree</a>
    } <span class="keyword">catch</span> {
      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> <a title="object MarkupParsers.this.TruncatedXML" id="716448">c</a> @ <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a> =&gt;
        <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121843" title="(msg: String)Unit">incompleteInputError</a>(<a href="#716448" title="object MarkupParsers.this.TruncatedXML">c</a>.<a href="#714889" title="()java.lang.String">getMessage</a>)
        <a href="../Trees.scala.html#26761" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>

      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> <a title="java.lang.Throwable" id="716453">c</a> @ (<a href="#714853" title="object MarkupParsers.this.MissingEndTagException">MissingEndTagException</a> | <a href="#714887" title="object MarkupParsers.this.ConfusedAboutBracesException">ConfusedAboutBracesException</a>) =&gt;
        <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121844" title="(offset: Int,msg: String)Unit">syntaxError</a>((<a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; Int">_1</span>):<span title="Int">Int</span>,
                           <a href="#716453" title="java.lang.Throwable">c</a>.<span title="(x$1: Any)java.lang.String">getMessage</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; String">_2</span>+<span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>)
        <a href="../Trees.scala.html#26761" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>

      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> _:<span title="ArrayIndexOutOfBoundsException">ArrayIndexOutOfBoundsException</span> =&gt; 
        <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121844" title="(offset: Int,msg: String)Unit">syntaxError</a>((<a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; Int">_1</span>),
                      <span title="(x$1: Any)java.lang.String" class="string">&quot;missing end tag in XML literal for &lt;&quot;</span>
                      <span title="(x$1: Any)java.lang.String">+</span><a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; String">_2</span>+<span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>);
        <a href="../Trees.scala.html#26761" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>
    } <span class="keyword">finally</span> {
      <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#122210" title="(lastCode: Int)Unit">resume</a>(Tokens.<span title="Int(96)">XMLSTART</span>)
    }

    /** @see xmlPattern. resynchronizes after successful parse 
     *  @return this xml pattern
     *  precondition: s.xStartsXML == true
     */
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="610042">xLiteralPattern</a>: <a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = <span class="keyword">try</span> {
      <a href="#610004" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>
      <span class="keyword">val</span> <a title="Boolean" id="716482">oldMode</a> = <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607051" title="=&gt; Boolean">isPattern</a>;
      <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607052" title="(x$1: Boolean)Unit">isPattern</a> = <span title="Boolean(true)" class="keyword">true</span>
//      assert(ch == '&lt;')
//      nextch
      <span class="keyword">var</span> <a title="MarkupParsers.this.global.Tree" id="716483">tree</a> = <a href="#610052" title="=&gt; MarkupParsers.this.global.Tree">xPattern</a>; <a href="#610037" title="=&gt; Unit">xSpaceOpt</a>;
      <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607052" title="(x$1: Boolean)Unit">isPattern</a> = <a href="#716482" title="Boolean">oldMode</a>;
      <a href="#716483" title="MarkupParsers.this.global.Tree">tree</a>
    } <span class="keyword">catch</span> {
      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> <a title="object MarkupParsers.this.TruncatedXML" id="716492">c</a> @ <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a> =&gt;
        <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121844" title="(offset: Int,msg: String)Unit">syntaxError</a>(<a href="#610007" title="=&gt; Int">curOffset</a>, <a href="#716492" title="object MarkupParsers.this.TruncatedXML">c</a>.<a href="#714889" title="()java.lang.String">getMessage</a>)
        <a href="../Trees.scala.html#26761" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>

      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> <a title="java.lang.Throwable" id="716501">c</a> @ (<a href="#714853" title="object MarkupParsers.this.MissingEndTagException">MissingEndTagException</a> | <a href="#714887" title="object MarkupParsers.this.ConfusedAboutBracesException">ConfusedAboutBracesException</a>) =&gt;
        <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121844" title="(offset: Int,msg: String)Unit">syntaxError</a>((<a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; Int">_1</span>),
                      <a href="#716501" title="java.lang.Throwable">c</a>.<span title="(x$1: Any)java.lang.String">getMessage</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; String">_2</span>+<span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>)
        <a href="../Trees.scala.html#26761" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>

      <span title="MarkupParsers.this.global.EmptyTree.type" class="keyword">case</span> _:<span title="ArrayIndexOutOfBoundsException">ArrayIndexOutOfBoundsException</span> =&gt;
        <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121844" title="(offset: Int,msg: String)Unit">syntaxError</a>((<a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; Int">_1</span>),
                      <span title="(x$1: Any)java.lang.String" class="string">&quot;missing end tag in XML literal for &lt;&quot;</span>
                      <span title="(x$1: Any)java.lang.String">+</span><a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; String">_2</span>+<span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>)
        <a href="../Trees.scala.html#26761" title="object MarkupParsers.this.global.EmptyTree">EmptyTree</a>
    } <span class="keyword">finally</span> {
      <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#122210" title="(lastCode: Int)Unit">resume</a>(Tokens.<span title="Int(96)">XMLSTART</span>)
    }

    <span class="keyword">def</span> <a title="[A](op: =&gt; A,kind: String)A" id="610043">escapeToScala</a>[<a title="&gt;: Nothing &lt;: Any" id="610045">A</a><a id="1">]</a>(<a title="=&gt; A" id="716530">op</a>: =&gt; A, <a title="String" id="716531">kind</a>: <span title="String">String</span>) = {
      <a href="#610014" title="(x$1: Boolean)Unit">xEmbeddedBlock</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">val</span> <a title="List[Int]" id="716534">savedSepRegions</a> = <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#122234" title="=&gt; List[Int]">sepRegions</a>
      <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#122210" title="(lastCode: Int)Unit">resume</a>(<span title="Int(94)">LBRACE</span>)
      <span class="keyword">try</span> {
        <a href="#716530" title="=&gt; A">op</a> //p.expr(true,false);
      } <span class="keyword">finally</span> {
        <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#122235" title="(x$1: List[Int])Unit">sepRegions</a> = <a href="#716534" title="List[Int]">savedSepRegions</a> // parser.in.sepRegions.tail
        <span title="Unit" class="keyword">if</span> (<a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121831" title="=&gt; MarkupParsers.this.UnitScanner">in</a>.<a href="Scanners.scala.html#122269" title="(x$1: Int)Boolean">token</a> != <span title="Int(95)">RBRACE</span>) {
          <a href="#610051" title="(str: String)Char">reportSyntaxError</a><span title="Unit">(</span><span title="(x$1: Any)java.lang.String" class="string">&quot; expected end of Scala &quot;</span>+<a href="#716531" title="String">kind</a>)
        }
      }
    } 

    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="610046">xEmbeddedExpr</a>: <a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = <a href="#610043" title="(op: =&gt; MarkupParsers.this.global.Tree,kind: String)MarkupParsers.this.global.Tree">escapeToScala</a>(<a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121761" title="()MarkupParsers.this.global.Tree">block</a>(), <span title="java.lang.String(&quot;block&quot;)" class="string">&quot;block&quot;</span>)

    /** xScalaPatterns  ::= patterns
     */
    <span class="keyword">def</span> <a title="=&gt; List[MarkupParsers.this.global.Tree]" id="610047">xScalaPatterns</a>: <span title="List[MarkupParsers.this.global.Tree]">List</span>[Tree] = <a href="#610043" title="(op: =&gt; List[MarkupParsers.this.global.Tree],kind: String)List[MarkupParsers.this.global.Tree]">escapeToScala</a>(<a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121769" title="(seqOK: Boolean)List[MarkupParsers.this.global.Tree]">patterns</a>(<span title="Boolean(true)" class="keyword">true</span>), <span title="java.lang.String(&quot;pattern&quot;)" class="string">&quot;pattern&quot;</span>)

    <span class="keyword">var</span> <a title="List[List[Int]]" id="610049">scannerState</a>: <span title="List[List[Int]]">List</span>[List[Int]] = <a title="object Nil" id="7700">Nil</a>

/*
    private def pushScannerState {
      scannerState = s.sepRegions :: scannerState
      s.sepRegions = Nil
    }
    private def popScannerState { 
      s.sepRegions = scannerState.head
      scannerState = scannerState.tail
    }
    */
/*
    private def init {
      ch = s.in.ch
      curOffset = s.in.ccurOffset
    }
    */

    <span class="keyword">def</span> <a title="(str: String)Char" id="610051">reportSyntaxError</a>(<a title="String" id="714980">str</a>: <span title="String">String</span>) = {
      <a href="#610053" title="MarkupParsers.this.UnitParser">parser</a>.<a href="Parsers.scala.html#121844" title="(offset: Int,msg: String)Unit">syntaxError</a>(<a href="#610007" title="=&gt; Int">curOffset</a>, <span title="(x$1: Any)java.lang.String" class="string">&quot;in XML literal: &quot;</span> + <a href="#714980" title="String">str</a>)
      <a href="#610012" title="=&gt; Char">nextch</a>
    }
/*
    private def sync {
      xEmbeddedBlock = false
      s.xSync
    }
*/
    /** '&lt;' xPattern  ::= Name [S] { xmlPattern | '{' pattern3 '}' } ETag
     *                  | Name [S] '/' '&gt;'
     */
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="610052">xPattern</a>: <a href="../Trees.scala.html#26752" title="MarkupParsers.this.global.Tree">Tree</a> = {
      <span class="keyword">var</span> <a title="Int" id="716574">start</a> = <a href="#610007" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a title="String" id="716575">qname</a> = <a href="#610035" title="=&gt; String">xName</a>
      <a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="(elem: (Int, java.lang.String))scala.collection.mutable.Stack[(Int, String)]">push</span>(<span title="(_1: Int,_2: String)(Int, String)">(</span><a href="#716574" title="Int">start</a>, <a href="#716575" title="String">qname</a>))
      <a href="#610037" title="=&gt; Unit">xSpaceOpt</a>
      <span title="Unit" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('/')" class="char">'/'</span>) { // empty tag
        <a href="#610012" title="=&gt; Char">nextch</a>
        <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
        <span title="Nothing" class="keyword">return</span> <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607108" title="(pos: scala.tools.nsc.util.Position,n: String,args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">makeXMLpat</a>(<a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#716574" title="Int">start</a>, <a href="#716574" title="Int">start</a>, <a href="#610007" title="=&gt; Int">curOffset</a>), <a href="#716575" title="String">qname</a>, <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]())
      }

      // else: tag with content
      <a href="#610016" title="(that: Char)Unit">xToken</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
      <span class="keyword">var</span> <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="716576">ts</a> = <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span>[Tree]
      <span class="keyword">var</span> <a title="Boolean" id="716577">exit</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span title="Unit" class="keyword">while</span> (<span title="=&gt; Boolean">!</span> <a href="#716577" title="Boolean">exit</a>) <a href="#716578" title="()Unit">{</a>
        <span class="keyword">val</span> <a title="Int" id="716641">start1</a> = <a href="#610007" title="=&gt; Int">curOffset</a>
        <span title="Any" class="keyword">if</span> (<a href="#610014" title="=&gt; Boolean">xEmbeddedBlock</a>) {
          <a href="#716576" title="(iter: Traversable[MarkupParsers.this.global.Tree])scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> ++= <a href="#610047" title="=&gt; List[MarkupParsers.this.global.Tree]">xScalaPatterns</a>
        } <span class="keyword">else</span>
          <a href="#610011" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> {
            <span title="Unit" class="keyword">case</span> <span title="Char('&lt;')" class="char">'&lt;'</span> =&gt; // tag
              <a href="#610012" title="=&gt; Char">nextch</a>
              <span title="Unit" class="keyword">if</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> != <span title="Char('/')" class="char">'/'</span>) { //child
                <a href="#716576" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span>(<a href="#610052" title="=&gt; MarkupParsers.this.global.Tree">xPattern</a>)
              } <span class="keyword">else</span> {
                <a href="#716577" title="Boolean">exit</a> = <span title="Boolean(true)" class="keyword">true</span>
              }
            <span title="Unit" class="keyword">case</span> <span title="Char('{')" class="char">'{'</span> =&gt; // embedded Scala patterns
              <span title="Unit" class="keyword">while</span> (<a href="#610011" title="(x$1: Char)Boolean">ch</a> == <span title="Char('{')" class="char">'{'</span>) <a href="#716693" title="()Unit">{</a>
                <a href="#610012" title="=&gt; Char">nextch</a>
                <a href="#716576" title="(iter: Traversable[MarkupParsers.this.global.Tree])scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> ++= <a href="#610047" title="=&gt; List[MarkupParsers.this.global.Tree]">xScalaPatterns</a>
              }
              // postcond: xEmbeddedBlock = false;
              <span title="Unit" class="keyword">if</span> (<a href="#610014" title="=&gt; Boolean">xEmbeddedBlock</a>) <span title="object Predef">Predef</span>.<span title="(message: String)Nothing">error</span>(<span title="java.lang.String(&quot;problem with embedded block&quot;)" class="string">&quot;problem with embedded block&quot;</span>); // assert

            <span title="Nothing" class="keyword">case</span> <span title="Char('\032')">SU</span> =&gt;
              <span title="Nothing" class="keyword">throw</span> <a href="#714921" title="object MarkupParsers.this.TruncatedXML">TruncatedXML</a>

            <span title="Unit" class="keyword">case</span> _ =&gt; // text 
              <a href="#610029" title="(pos: scala.tools.nsc.util.Position,ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree],txt: String)Unit">appendText</a>(<a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#716641" title="Int">start1</a>, <a href="#716641" title="Int">start1</a>, <a href="#610007" title="=&gt; Int">curOffset</a>), <a href="#716576" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>, <a href="#610040" title="=&gt; String">xText</a>)
              // here  xEmbeddedBlock might be true;
              //if( xEmbeddedBlock ) throw new ApplicationError(&quot;after:&quot;+text); // assert
          }
      }
      <a href="#610024" title="(startName: String)Unit">xEndTag</a>(<a href="#716575" title="String">qname</a>)
      <a href="#610018" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="()(Int, String)">pop</span>
      <a href="Parsers.scala.html#121848" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#607108" title="(pos: scala.tools.nsc.util.Position,n: String,args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">makeXMLpat</a>(<a href="Parsers.scala.html#121835" title="(start: Int,mid: Int,end: Int)scala.tools.nsc.util.Position">r2p</a>(<a href="#716574" title="Int">start</a>, <a href="#716574" title="Int">start</a>, <a href="#610007" title="=&gt; Int">curOffset</a>), <a href="#716575" title="String">qname</a>, <a href="#716576" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>)
    }

  } /* class MarkupParser */
}

        </pre>
    </body>
</html>