<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/ScriptRunner.scala</title>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */</span>
<span class="comment">// $Id: ScriptRunner.scala 17288 2009-03-12 18:15:25Z extempore $</span>

<span class="keyword">package</span> scala.tools.nsc

<span class="keyword">import</span> java.io.{BufferedReader, File, FileInputStream, FileOutputStream,
                FileReader, InputStreamReader, PrintWriter,
	        FileWriter, IOException}
<span class="keyword">import</span> java.lang.reflect.InvocationTargetException
<span class="keyword">import</span> java.net.URL
<span class="keyword">import</span> java.util.jar.{JarEntry, JarOutputStream}

<span class="keyword">import</span> scala.tools.nsc.io.PlainFile
<span class="keyword">import</span> scala.tools.nsc.reporters.{Reporter,ConsoleReporter}
<span class="keyword">import</span> scala.tools.nsc.util.{ClassPath, CompoundSourceFile, BatchSourceFile, SourceFile, SourceFileFragment}

<span class="comment">/** An object that runs Scala code in script files.
 *
 *  &lt;p&gt;For example, here is a complete Scala script on Unix:&lt;/pre&gt;
 *  &lt;pre&gt;
 *    #!/bin/sh
 *    exec scala &quot;$0&quot; &quot;$@&quot;
 *    !#
 *    Console.println(&quot;Hello, world!&quot;)
 *    argv.toList foreach Console.println
 *  &lt;/pre&gt;
 *  &lt;p&gt;And here is a batch file example on Windows XP:&lt;/p&gt;
 *  &lt;pre&gt;
 *    ::#!
 *    @echo off
 *    call scala %0 %*
 *    goto :eof
 *    ::!#
 *    Console.println(&quot;Hello, world!&quot;)
 *    argv.toList foreach Console.println
 *  &lt;/pre&gt;
 *
 *  @author  Lex Spoon
 *  @version 1.0, 15/05/2006
 *  @todo    It would be better if error output went to stderr instead
 *           of stdout...
 */</span>
<span class="keyword">object</span> <span class="typed"><span class="type">object scala.tools.nsc.ScriptRunner</span><a id="7207">ScriptRunner</a></span> {
  <span class="comment">/** Default name to use for the wrapped script */</span>
  <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><span id="58036"><a id="58035">defaultScriptMain</a></span></span> = <span class="typed"><span class="type">java.lang.String(&quot;Main&quot;)</span><span class="string">&quot;Main&quot;</span></span>

  <span class="comment">/** Pick a main object name from the specified settings */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.Settings)java.lang.String</span><a id="58037">scriptMain</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="114316">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>) =
    <span class="typed"><span class="type">java.lang.String</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#114316">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30040">script</a></span>.<span class="typed"><span class="type">=&gt; settings.script.T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
      <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#58035">defaultScriptMain</a></span>
    <span class="keyword">else</span>
      <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#114316">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30040">script</a></span>.<span class="typed"><span class="type">=&gt; settings.script.T</span><a href="Settings.scala.html#30301">value</a></span>

  <span class="comment">/** Choose a jar filename to hold the compiled version
   * of a script
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)java.io.File</span><a id="58038">jarFileFor</a></span>(<span class="typed"><span class="type">String</span><a id="114320">scriptFile</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="114321">filename</a></span> =
      <span class="typed"><span class="type">java.lang.String</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#114320">scriptFile</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5859">matches</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;.*\.[^.\\/]*&quot;)</span><span class="string">&quot;.*\\.[^.\\\\/]*&quot;</span></span>))
        <span class="typed"><span class="type">String</span><a href="#114320">scriptFile</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.lang.String</span><a id="5861">replaceFirst</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;\.[^.\\/]*$&quot;)</span><span class="string">&quot;\\.[^.\\\\/]*$&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;.jar&quot;)</span><span class="string">&quot;.jar&quot;</span></span>)
      <span class="keyword">else</span>
        <span class="typed"><span class="type">String</span><a href="#114320">scriptFile</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;.jar&quot;)</span><span class="string">&quot;.jar&quot;</span></span>

    <span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#114321">filename</a></span>)
  }

  <span class="comment">/** Try to create a jar file out of all the contents
   *  of the directory &lt;code&gt;sourcePath&lt;/code&gt;.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File,java.io.File)AnyVal</span><a id="58039">tryMakeJar</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="114324">jarFile</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>, <span class="typed"><span class="type">java.io.File</span><a id="114325">sourcePath</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) = {
    <span class="keyword">try</span> {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileOutputStream</span><a id="114327">jarFileStream</a></span> = <span class="typed"><span class="type">(java.io.File)java.io.FileOutputStream</span><a id="48703" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileOutputStream</span><a id="3798">FileOutputStream</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114324">jarFile</a></span>)
      <span class="keyword">val</span> <span class="typed"><span class="type">java.util.jar.JarOutputStream</span><a id="114328">jar</a></span> = <span class="typed"><span class="type">(java.io.OutputStream)java.util.jar.JarOutputStream</span><a id="114334" class="keyword">new</a></span> <span class="typed"><span class="type">java.util.jar.JarOutputStream</span><a id="57325">JarOutputStream</a></span>(<span class="typed"><span class="type">java.io.FileOutputStream</span><a href="#114327">jarFileStream</a></span>)
      <span class="keyword">val</span> <span class="typed"><span class="type">Array[Byte]</span><a id="114329">buf</a></span> = <span class="typed"><span class="type">Array[Byte]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Byte]</span><a id="1072">Array</a></span>[Byte](<span class="typed"><span class="type">Int(10240)</span><span class="int">10240</span></span>)

      <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File,String)Unit</span><a id="114330">addFromDir</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="114356">dir</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>, <span class="typed"><span class="type">String</span><a id="114357">prefix</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) {
        <span class="keyword">for</span> (<span class="typed"><span class="type">((java.io.File) =&gt; Unit)Unit</span><span id="21792"><a id="114360">entry</a></span></span> &lt;- <span class="typed"><span class="type">java.io.File</span><a href="#114356">dir</a></span>.<span class="typed"><span class="type">()Array[java.io.File]</span><a id="40708">listFiles</a></span>) {
          <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.io.File</span><a href="#114360">entry</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40699">isFile</a></span>) {
            <span class="typed"><span class="type">java.util.jar.JarOutputStream</span><a href="#114328">jar</a></span>.<span class="typed"><span class="type">(java.util.zip.ZipEntry)Unit</span><a id="114335">putNextEntry</a></span>(<span class="typed"><span class="type">java.util.jar.JarEntry</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.jar.JarEntry</span><a id="57313">JarEntry</a></span>(<span class="typed"><span class="type">String</span><a href="#114357">prefix</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.io.File</span><a href="#114360">entry</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40684">getName</a></span>))

            <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileInputStream</span><a id="114361">input</a></span> = <span class="typed"><span class="type">(java.io.File)java.io.FileInputStream</span><a id="48679" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileInputStream</span><a id="3810">FileInputStream</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114360">entry</a></span>)
            <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="114362">n</a></span> = <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#114361">input</a></span>.<span class="typed"><span class="type">(Array[Byte],Int,Int)Int</span><a id="48683">read</a></span>(<span class="typed"><span class="type">Array[Byte]</span><a href="#114329">buf</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Array[Byte]</span><a href="#114329">buf</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span>)
            <span class="typed"><span class="type">Unit</span><a href="#114363" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#114362">n</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3146">&gt;=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) {
              <span class="typed"><span class="type">java.util.jar.JarOutputStream</span><a href="#114328">jar</a></span>.<span class="typed"><span class="type">(Array[Byte],Int,Int)Unit</span><a id="114081">write</a></span> (<span class="typed"><span class="type">Array[Byte]</span><a href="#114329">buf</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Int</span><a href="#114362">n</a></span>)
              <span class="typed"><span class="type">Int</span><a href="#114362">n</a></span> = <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#114361">input</a></span>.<span class="typed"><span class="type">(Array[Byte],Int,Int)Int</span><a id="48683">read</a></span>(<span class="typed"><span class="type">Array[Byte]</span><a href="#114329">buf</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Array[Byte]</span><a href="#114329">buf</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span>)
            }
            <span class="typed"><span class="type">java.util.jar.JarOutputStream</span><a href="#114328">jar</a></span>.<span class="typed"><span class="type">()Unit</span><a id="114080">closeEntry</a></span>
            <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#114361">input</a></span>.<span class="typed"><span class="type">()Unit</span><a id="48686">close</a></span>
          } <span class="keyword">else</span> {
            <span class="typed"><span class="type">(java.io.File,String)Unit</span><a href="#114330">addFromDir</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114360">entry</a></span>, <span class="typed"><span class="type">String</span><a href="#114357">prefix</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.io.File</span><a href="#114360">entry</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40684">getName</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;/&quot;)</span><span class="string">&quot;/&quot;</span></span>)
          }
        }
      }

      <span class="typed"><span class="type">(java.io.File,String)Unit</span><a href="#114330">addFromDir</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114325">sourcePath</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
      <span class="typed"><span class="type">java.util.jar.JarOutputStream</span><a href="#114328">jar</a></span>.<span class="typed"><span class="type">()Unit</span><a id="114083">close</a></span>
    } <span class="keyword">catch</span> {
      <span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> _:<span class="typed"><span class="type">Error</span><a id="1801">Error</a></span> =&gt; <span class="typed"><span class="type">java.io.File</span><a href="#114324">jarFile</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40704">delete</a></span> <span class="comment">// XXX what errors to catch?</span>
    }
  }


  <span class="comment">/** Read the entire contents of a file as a String. */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)String</span><a id="58040">contentsOfFile</a></span>(<span class="typed"><span class="type">String</span><a id="114432">filename</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">StringBuilder</span><a id="114433">strbuf</a></span> = <span class="typed"><span class="type">()StringBuilder</span><a id="23671" class="keyword">new</a></span> <span class="typed"><span class="type">StringBuilder</span><a id="1435">StringBuilder</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileReader</span><a id="114434">reader</a></span> = <span class="typed"><span class="type">java.io.FileReader</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.FileReader</span><a id="3828">FileReader</a></span>(<span class="typed"><span class="type">String</span><a href="#114432">filename</a></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">Array[Char]</span><a id="114435">cbuf</a></span> = <span class="typed"><span class="type">Array[Char]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Char]</span><a id="1072">Array</a></span>[Char](<span class="typed"><span class="type">Int(1024)</span><span class="int">1024</span></span>)
    <span class="typed"><span class="type">Unit</span><a href="#114436" class="keyword">while</a></span>(<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>) {
      <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="114443">n</a></span> = <span class="typed"><span class="type">java.io.FileReader</span><a href="#114434">reader</a></span>.<span class="typed"><span class="type">(Array[Char])Int</span><a id="47569">read</a></span>(<span class="typed"><span class="type">Array[Char]</span><a href="#114435">cbuf</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#114443">n</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3144">&lt;=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
        <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">StringBuilder</span><a href="#114433">strbuf</a></span>.<span class="typed"><span class="type">()String</span><a id="23723">toString</a></span>
      <span class="typed"><span class="type">StringBuilder</span><a href="#114433">strbuf</a></span>.<span class="typed"><span class="type">(Array[Char],Int,Int)StringBuilder</span><a id="23694">append</a></span>(<span class="typed"><span class="type">Array[Char]</span><a href="#114435">cbuf</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Int</span><a href="#114443">n</a></span>)
    }
    <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)java.lang.Error</span><a id="27228" class="keyword">new</a></span> <span class="typed"><span class="type">java.lang.Error</span><span id="5975"><a id="821">Error</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;impossible&quot;)</span><span class="string">&quot;impossible&quot;</span></span>)
  }

  <span class="comment">/** Find the length of the header in the specified file, if
    * there is one.  The header part starts with &quot;#!&quot; or &quot;::#!&quot;
    * and ends with a line that begins with &quot;!#&quot; or &quot;::!#&quot;.
    */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Int</span><a id="58041">headerLength</a></span>(<span class="typed"><span class="type">String</span><a id="114533">filename</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span> = {
    <span class="keyword">import</span> java.util.regex._

    <span class="keyword">val</span> <span class="typed"><span class="type">String</span><a id="114535">fileContents</a></span> = <span class="typed"><span class="type">(String)String</span><a href="#58040">contentsOfFile</a></span>(<span class="typed"><span class="type">String</span><a href="#114533">filename</a></span>)

    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span>(<span class="typed"><span class="type">String</span><a href="#114535">fileContents</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;#!&quot;)</span><span class="string">&quot;#!&quot;</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2750">||</a></span> <span class="typed"><span class="type">String</span><a href="#114535">fileContents</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;::#!&quot;)</span><span class="string">&quot;::#!&quot;</span></span>)))
      <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>

    <span class="keyword">val</span> <span class="typed"><span class="type">java.util.regex.Matcher</span><a id="114536">matcher</a></span> =
      (<span class="typed"><span class="type">object java.util.regex.Pattern</span><a id="22978">Pattern</a></span>.<span class="typed"><span class="type">(java.lang.String,Int)java.util.regex.Pattern</span><a id="67777">compile</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;^(::)?!#.*(\r|\n|\r\n)&quot;)</span><span class="string">&quot;^(::)?!#.*(\\r|\\n|\\r\\n)&quot;</span></span>, Pattern.<span class="typed"><span class="type">Int(8)</span><span >MULTILINE</span></span>)
              .<span class="typed"><span class="type">(java.lang.CharSequence)java.util.regex.Matcher</span><a id="67780">matcher</a></span>(<span class="typed"><span class="type">String</span><a href="#114535">fileContents</a></span>))
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">java.util.regex.Matcher</span><a href="#114536">matcher</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="79744">find</a></span>)
      <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)java.io.IOException</span><a id="34438" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.IOException</span><a id="3519">IOException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;script file does not close its header with !# or ::!#&quot;)</span><span class="string">&quot;script file does not close its header with !# or ::!#&quot;</span></span>)
    <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">java.util.regex.Matcher</span><a href="#114536">matcher</a></span>.<span class="typed"><span class="type">()Int</span><a id="79738">end</a></span>
  }

  <span class="comment">/** Split a fully qualified object name into a
   *  package and an unqualified object name */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)(Option[String], String)</span><a id="58042">splitObjectName</a></span>(<span class="typed"><span class="type">String</span><a id="114549">fullname</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>):
  <span class="typed"><span class="type">(Option[String], String)</span><a id="1378">(</a></span>Option[String],String) =
  {
    <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="114550">idx</a></span> = <span class="typed"><span class="type">String</span><a href="#114549">fullname</a></span>.<span class="typed"><span class="type">(Int)Int</span><a id="5846">lastIndexOf</a></span>(<span class="typed"><span class="type">Int(46)</span><span class="char">'.'</span></span>)
    <span class="typed"><span class="type">(Option[String], String)</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#114550">idx</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
      <span class="typed"><span class="type">(object None,String)(object None, String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">object None</span><a id="536">None</a></span>, <span class="typed"><span class="type">String</span><a href="#114549">fullname</a></span>)
    <span class="keyword">else</span>
      <span class="typed"><span class="type">(Some[java.lang.String],java.lang.String)(Some[java.lang.String], java.lang.String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">(java.lang.String)Some[java.lang.String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#114549">fullname</a></span>.<span class="typed"><span class="type">(Int,Int)java.lang.String</span><a id="5855">substring</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>,<span class="typed"><span class="type">Int</span><a href="#114550">idx</a></span>)), <span class="typed"><span class="type">String</span><a href="#114549">fullname</a></span>.<span class="typed"><span class="type">(Int)java.lang.String</span><a id="5854">substring</a></span>(<span class="typed"><span class="type">Int</span><a href="#114550">idx</a></span><span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span><span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>))
  }

  <span class="comment">/** Code that is added to the beginning of a script file to make
   *  it a complete Scala compilation unit.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)java.lang.String</span><a id="58043">preambleCode</a></span>(<span class="typed"><span class="type">String</span><a id="114589">objectName</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =  {
    <span class="keyword">val</span> <span class="typed"><span class="type">(Option[String], String)</span><span id="23625"><a href="#114595" id="1379">(</a></span></span><span class="typed"><span class="type">Option[String]</span><span id="114595"><span id="114592"><a href="#114591" id="23614">maybePack</a></span></span></span>, <span class="typed"><span class="type">String</span><span id="114596"><span id="114593"><a href="#114591" id="23616">objName</a></span></span></span>) = <span class="typed"><span class="type">(String)(Option[String], String)</span><a href="#58042">splitObjectName</a></span>(<span class="typed"><span class="type">String</span><a href="#114589">objectName</a></span>)

    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="114594">packageDecl</a></span> =
      <span class="typed"><span class="type">Option[String]</span><a href="#114592">maybePack</a></span> <span class="typed"><span class="type">java.lang.String</span><span class="keyword">match</span></span> {
	<span class="typed"><span class="type">java.lang.String</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">String</span><a id="114599">pack</a></span>) =&gt; <span class="typed"><span class="type">java.lang.String(&quot;package &quot;)</span><span class="string">&quot;package &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#114599">pack</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;\012&quot;)</span><span class="string">&quot;\n&quot;</span></span>
	<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt; <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>
      }

    (<span class="typed"><span class="type">java.lang.String</span><a href="#114594">packageDecl</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
     <span class="typed"><span class="type">java.lang.String(&quot;object &quot;)</span><span class="string">&quot;object &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#114593">objName</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; {\012&quot;)</span><span class="string">&quot; {\n&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
     <span class="typed"><span class="type">java.lang.String(&quot;  def main(argv: Array[String]): Unit = {\012&quot;)</span><span class="string">&quot;  def main(argv: Array[String]): Unit = {\n&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
     <span class="typed"><span class="type">java.lang.String(&quot;  val args = argv;\012&quot;)</span><span class="string">&quot;  val args = argv;\n&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
     <span class="typed"><span class="type">java.lang.String(&quot;  new AnyRef {\012&quot;)</span><span class="string">&quot;  new AnyRef {\n&quot;</span></span>)
  }

  <span class="comment">/** Code that is added to the end of a script file to make
   *  it a complete Scala compilation unit.
   */</span>
  <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><span id="58045"><a id="58044">endCode</a></span></span> = <span class="typed"><span class="type">java.lang.String(&quot;\012} \012} }\012&quot;)</span><span class="string">&quot;\n} \n} }\n&quot;</span></span>


  <span class="comment">/** Wrap a script file into a runnable object named
   *  &lt;code&gt;scala.scripting.Main&lt;/code&gt;.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String,String,(scala.tools.nsc.io.PlainFile) =&gt; scala.tools.nsc.util.SourceFile)scala.tools.nsc.util.SourceFile</span><a id="58046">wrappedScript</a></span>(
    <span class="typed"><span class="type">String</span><a id="86838">objectName</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, 
    <span class="typed"><span class="type">String</span><a id="86839">filename</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, 
    <span class="typed"><span class="type">(scala.tools.nsc.io.PlainFile) =&gt; scala.tools.nsc.util.SourceFile</span><a id="86840">getSourceFile</a></span>: PlainFile =&gt; SourceFile): <span class="typed"><span class="type">scala.tools.nsc.util.SourceFile</span><a href="util/SourceFile.scala.html#8483">SourceFile</a></span> = 
  {
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a id="114600">preamble</a></span> =    
      <span class="typed"><span class="type">(String,Seq[Char])scala.tools.nsc.util.BatchSourceFile</span><a href="util/SourceFile.scala.html#22673" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a href="util/SourceFile.scala.html#8435">BatchSourceFile</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&lt;script preamble&gt;&quot;)</span><span class="string">&quot;&lt;script preamble&gt;&quot;</span></span>,
		     <span class="typed"><span class="type">(String)java.lang.String</span><a href="#58043">preambleCode</a></span>(<span class="typed"><span class="type">String</span><a href="#86838">objectName</a></span>).<span class="typed"><span class="type">()Array[Char]</span><a id="5872">toCharArray</a></span>)

    <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.util.SourceFileFragment</span><a id="114601">middle</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="114613">f</a></span> = <span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">String</span><a href="#86839">filename</a></span>)
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a id="114614">bsf</a></span> = <span class="typed"><span class="type">(scala.tools.nsc.io.PlainFile)scala.tools.nsc.util.SourceFile</span><a href="#86840" id="21757">getSourceFile</a></span>(<span class="typed"><span class="type">scala.tools.nsc.io.PlainFile</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.io.PlainFile</span><a href="io/PlainFile.scala.html#12720">PlainFile</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114613">f</a></span>)).<span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a href="util/SourceFile.scala.html#8435">BatchSourceFile</a></span>]
      <span class="typed"><span class="type">(scala.tools.nsc.util.BatchSourceFile,Int,Int)scala.tools.nsc.util.SourceFileFragment</span><a href="util/SourceFile.scala.html#114631" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.util.SourceFileFragment</span><a href="util/SourceFile.scala.html#8408">SourceFileFragment</a></span>(
          <span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a href="#114614">bsf</a></span>,
          <span class="typed"><span class="type">(String)Int</span><a href="#58041">headerLength</a></span>(<span class="typed"><span class="type">String</span><a href="#86839">filename</a></span>),
          <span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a href="#114614">bsf</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="util/SourceFile.scala.html#22679">length</a></span>)
<span class="comment">//          f.length.asInstanceOf[Int])</span>
    }
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a id="114602">end</a></span> = <span class="typed"><span class="type">(String,Seq[Char])scala.tools.nsc.util.BatchSourceFile</span><a href="util/SourceFile.scala.html#22673" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a href="util/SourceFile.scala.html#8435">BatchSourceFile</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&lt;script trailer&gt;&quot;)</span><span class="string">&quot;&lt;script trailer&gt;&quot;</span></span>, <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#58044">endCode</a></span>.<span class="typed"><span class="type">()Array[Char]</span><a id="5872">toCharArray</a></span>)

    <span class="typed"><span class="type">(scala.tools.nsc.util.BatchSourceFile*)scala.tools.nsc.util.CompoundSourceFile</span><a href="util/SourceFile.scala.html#114660" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.util.CompoundSourceFile</span><a href="util/SourceFile.scala.html#8246">CompoundSourceFile</a></span>(<span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a href="#114600">preamble</a></span>, <span class="typed"><span class="type">scala.tools.nsc.util.SourceFileFragment</span><a href="#114601">middle</a></span>, <span class="typed"><span class="type">scala.tools.nsc.util.BatchSourceFile</span><a href="#114602">end</a></span>)
  }

  <span class="comment">/** Compile a script using the fsc compilation deamon.
   *
   *  @param settings     ...
   *  @param scriptFileIn ...
   *  @return             ...
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String)Boolean</span><a id="58047">compileWithDaemon</a></span>(
      <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a id="114669">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="GenericRunnerSettings.scala.html#7302">GenericRunnerSettings</a></span>,
      <span class="typed"><span class="type">String</span><a id="114670">scriptFileIn</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> =
  {
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="114671">scriptFile</a></span> = <span class="typed"><span class="type">object scala.tools.nsc.CompileClient</span><a href="CompileClient.scala.html#6361">CompileClient</a></span>.<span class="typed"><span class="type">(String)java.lang.String</span><a href="CompileClient.scala.html#67855">absFileName</a></span>(<span class="typed"><span class="type">String</span><a href="#114670">scriptFileIn</a></span>)
    <span class="keyword">for</span> (<span class="typed"><span class="type">((scala.tools.nsc.Settings.StringSetting) =&gt; Unit)Unit</span><span id="21366"><a id="114685">setting</a></span></span> &lt;- <span class="typed"><span class="type">(scala.tools.nsc.Settings.StringSetting*)List[scala.tools.nsc.Settings.StringSetting]</span><span id="21328"><a id="527">List</a></span></span>(
            <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114669">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#29952">classpath</a></span>,
            <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114669">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#29978">sourcepath</a></span>,
            <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114669">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#29950">bootclasspath</a></span>,
            <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114669">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#29964">extdirs</a></span>,
            <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114669">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#29954">outdir</a></span>))
      <span class="typed"><span class="type">scala.tools.nsc.Settings.StringSetting</span><a href="#114685">setting</a></span>.<span class="typed"><span class="type">(setting.T)Unit</span><a href="Settings.scala.html#30302">value</a></span> = <span class="typed"><span class="type">object scala.tools.nsc.CompileClient</span><a href="CompileClient.scala.html#6361">CompileClient</a></span>.<span class="typed"><span class="type">(String)String</span><a href="CompileClient.scala.html#67856">absFileNames</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings.StringSetting</span><a href="#114685">setting</a></span>.<span class="typed"><span class="type">=&gt; setting.T</span><a href="Settings.scala.html#30301">value</a></span>)
      
    <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="114672">compSettingNames</a></span> =
      (<span class="typed"><span class="type">scala.tools.nsc.Settings</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>(<span class="typed"><span class="type">(String)Nothing</span><span id="6000"><a href="#114688" id="821">error</a></span></span>)).<span class="typed"><span class="type">=&gt; List[scala.tools.nsc.Settings.Setting]</span><a href="Settings.scala.html#29944">allSettings</a></span>.<span class="typed"><span class="type">((scala.tools.nsc.Settings.Setting) =&gt; String)List[String]</span><a id="21362">map</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings.Setting</span><a href="#114692">_</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="Settings.scala.html#30238">name</a></span>)

    <span class="keyword">val</span> <span class="typed"><span class="type">List[scala.tools.nsc.Settings.Setting]</span><a id="114673">compSettings</a></span> =
      <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114669">settings</a></span>.<span class="typed"><span class="type">=&gt; List[scala.tools.nsc.Settings.Setting]</span><a href="Settings.scala.html#29944">allSettings</a></span>.<span class="typed"><span class="type">((scala.tools.nsc.Settings.Setting) =&gt; Boolean)List[scala.tools.nsc.Settings.Setting]</span><a id="21367">filter</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings.Setting</span><a id="114695">stg</a></span> =&gt; 
        <span class="typed"><span class="type">List[String]</span><a href="#114672">compSettingNames</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="21673">contains</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings.Setting</span><a href="#114695">stg</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="Settings.scala.html#30238">name</a></span>))

    <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><a id="114674">coreCompArgs</a></span> =
      <span class="typed"><span class="type">List[scala.tools.nsc.Settings.Setting]</span><a href="#114673">compSettings</a></span>.<span class="typed"><span class="type">(List[String])((List[String], scala.tools.nsc.Settings.Setting) =&gt; List[String])List[String]</span><a id="21375">foldLeft</a></span>[<span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]](<span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>)((<span class="typed"><span class="type">List[String]</span><a id="114697">args</a></span>, <span class="typed"><span class="type">scala.tools.nsc.Settings.Setting</span><a id="114698">stg</a></span>) =&gt;
        <span class="typed"><span class="type">scala.tools.nsc.Settings.Setting</span><a href="#114698">stg</a></span>.<span class="typed"><span class="type">=&gt; List[String]</span><a href="Settings.scala.html#30262">unparse</a></span> <span class="typed"><span class="type">(List[String])List[String]</span><a href="#114699" id="21339">:::</a></span> <span class="typed"><span class="type">List[String]</span><a href="#114697">args</a></span>)

    <span class="keyword">val</span> <span class="typed"><span class="type">List[java.lang.String]</span><a id="114675">compArgs</a></span> = 
      (<span class="typed"><span class="type">List[String]</span><a href="#114674">coreCompArgs</a></span> <span class="typed"><span class="type">(List[java.lang.String])List[java.lang.String]</span><a href="#114702" id="21339">:::</a></span>
        <span class="typed"><span class="type">(java.lang.String*)List[java.lang.String]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;-Xscript&quot;)</span><span class="string">&quot;-Xscript&quot;</span></span>, <span class="typed"><span class="type">(scala.tools.nsc.Settings)java.lang.String</span><a href="#58037">scriptMain</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114669">settings</a></span>), <span class="typed"><span class="type">java.lang.String</span><a href="#114671">scriptFile</a></span>))

    <span class="keyword">val</span> <span class="typed"><span class="type">java.net.Socket</span><a id="114676">socket</a></span> = <span class="typed"><span class="type">object scala.tools.nsc.CompileSocket</span><a href="CompileSocket.scala.html#6853">CompileSocket</a></span>.<span class="typed"><span class="type">(String)java.net.Socket</span><a href="CompileSocket.scala.html#67473">getOrCreateSocket</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.net.Socket</span><a href="#114676">socket</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5794">eq</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>)
      <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>

    <span class="keyword">val</span> <span class="typed"><span class="type">java.io.PrintWriter</span><a id="114677">out</a></span> = <span class="typed"><span class="type">(java.io.OutputStream,Boolean)java.io.PrintWriter</span><a id="28680" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.PrintWriter</span><a id="3759">PrintWriter</a></span>(<span class="typed"><span class="type">java.net.Socket</span><a href="#114676">socket</a></span>.<span class="typed"><span class="type">()java.io.OutputStream</span><a id="47508">getOutputStream</a></span>(), <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">java.io.BufferedReader</span><a id="114678">in</a></span> = <span class="typed"><span class="type">(java.io.Reader)java.io.BufferedReader</span><a id="46775" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.BufferedReader</span><a id="3549">BufferedReader</a></span>(<span class="typed"><span class="type">java.io.InputStreamReader</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.InputStreamReader</span><a id="3741">InputStreamReader</a></span>(<span class="typed"><span class="type">java.net.Socket</span><a href="#114676">socket</a></span>.<span class="typed"><span class="type">()java.io.InputStream</span><a id="47507">getInputStream</a></span>()))

    <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#114677">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">object scala.tools.nsc.CompileSocket</span><a href="CompileSocket.scala.html#6853">CompileSocket</a></span>.<span class="typed"><span class="type">(Int)String</span><a href="CompileSocket.scala.html#67476">getPassword</a></span>(<span class="typed"><span class="type">java.net.Socket</span><a href="#114676">socket</a></span>.<span class="typed"><span class="type">()Int</span><a id="47502">getPort</a></span>))
    <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#114677">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28711">println</a></span>(<span class="typed"><span class="type">List[java.lang.String]</span><a href="#114675">compArgs</a></span>.<span class="typed"><span class="type">(String,String,String)String</span><a id="21818">mkString</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;\00&quot;)</span><span class="string">&quot;\0&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>))

    <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><a id="114679">compok</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>

    <span class="keyword">var</span> <span class="typed"><span class="type">java.lang.String</span><a id="114680">fromServer</a></span> = <span class="typed"><span class="type">java.io.BufferedReader</span><a href="#114678">in</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="46779">readLine</a></span>()
    <span class="typed"><span class="type">Unit</span><a href="#114681" class="keyword">while</a></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#114680">fromServer</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5795">ne</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
      <span class="typed"><span class="type">object Console</span><a id="440">Console</a></span>.<span class="typed"><span class="type">=&gt; java.io.PrintStream</span><a id="27045">err</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="27111">println</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#114680">fromServer</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">object scala.tools.nsc.CompileSocket</span><a href="CompileSocket.scala.html#6853">CompileSocket</a></span>.<span class="typed"><span class="type">=&gt; java.util.regex.Pattern</span><a href="CompileSocket.scala.html#67452">errorPattern</a></span>.<span class="typed"><span class="type">(java.lang.CharSequence)java.util.regex.Matcher</span><a id="67780">matcher</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#114680">fromServer</a></span>).<span class="typed"><span class="type">()Boolean</span><a id="79743">matches</a></span>)
        <span class="typed"><span class="type">Boolean</span><a href="#114679">compok</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>

      <span class="typed"><span class="type">java.lang.String</span><a href="#114680">fromServer</a></span> = <span class="typed"><span class="type">java.io.BufferedReader</span><a href="#114678">in</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="46779">readLine</a></span>()
    }
    <span class="typed"><span class="type">java.io.BufferedReader</span><a href="#114678">in</a></span>.<span class="typed"><span class="type">()Unit</span><a id="46785">close</a></span>()
    <span class="typed"><span class="type">java.io.PrintWriter</span><a href="#114677">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="28686">close</a></span>()
    <span class="typed"><span class="type">java.net.Socket</span><a href="#114676">socket</a></span>.<span class="typed"><span class="type">()Unit</span><a id="47528">close</a></span>()

    <span class="typed"><span class="type">Boolean</span><a href="#114679">compok</a></span>
  }

  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.Settings,scala.tools.nsc.reporters.Reporter)scala.tools.nsc.Global</span><a id="58048">newGlobal</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="114744">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="Settings.scala.html#6744">Settings</a></span>, <span class="typed"><span class="type">scala.tools.nsc.reporters.Reporter</span><a id="114745">reporter</a></span>: <span class="typed"><span class="type">scala.tools.nsc.reporters.Reporter</span><a href="reporters/Reporter.scala.html#15905">Reporter</a></span>) =
    <span class="typed"><span class="type">scala.tools.nsc.Global</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><a href="Global.scala.html#6489">Global</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#114744">settings</a></span>, <span class="typed"><span class="type">scala.tools.nsc.reporters.Reporter</span><a href="#114745">reporter</a></span>)

  <span class="comment">/** Compile a script and then run the specified closure with
    * a classpath for the compiled script.
    *
    * @returns true if compilation and the handler succeeds, false otherwise.
    */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String)((String) =&gt; Boolean)Boolean</span><a id="58049">withCompiledScript</a></span>
        (<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a id="114758">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="GenericRunnerSettings.scala.html#7302">GenericRunnerSettings</a></span>, <span class="typed"><span class="type">String</span><a id="114759">scriptFile</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>)
        (<span class="typed"><span class="type">(String) =&gt; Boolean</span><a id="114760">handler</a></span>: String =&gt; Boolean)
        : <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = {
    <span class="keyword">import</span> Interpreter.deleteRecursively
 
    <span class="comment">/* If the script is running on pre-jvm-1.5 JVM, 
       it is necessary to force the target setting to jvm-1.4 */</span>
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="114762">major</a></span> = <span class="typed"><span class="type">object java.lang.System</span><a id="1886">System</a></span>.<span class="typed"><span class="type">(java.lang.String)java.lang.String</span><a id="47450">getProperty</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;java.class.version&quot;)</span><span class="string">&quot;java.class.version&quot;</span></span>).<span class="typed"><span class="type">(Int)java.lang.String</span><span id="21509"><a id="5865">split</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;\.&quot;)</span><span class="string">&quot;\\.&quot;</span></span>)(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString</span><span id="6140"><a href="#114762" id="821">major</a></span></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="23114">toInt</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int(49)</span><span class="int">49</span></span>) {
      <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114758">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.ChoiceSetting</span><a href="Settings.scala.html#29980">target</a></span>.<span class="typed"><span class="type">(settings.target.T)Unit</span><a href="Settings.scala.html#30302">value</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;jvm-1.4&quot;)</span><span class="string">&quot;jvm-1.4&quot;</span></span>
    }

    <span class="comment">/** Compiles the script file, and returns 
      * the directory with the compiled class files,
      * if the compilation succeeded.
      */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a id="114763">compile</a></span>: <span class="typed"><span class="type">Option[java.io.File]</span><a id="934">Option</a></span>[File] = {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="114785">compiledPath</a></span> = <span class="typed"><span class="type">object java.io.File</span><a id="3670">File</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.io.File</span><a id="40718">createTempFile</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;scalascript&quot;)</span><span class="string">&quot;scalascript&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
      <span class="typed"><span class="type">java.io.File</span><a href="#114785">compiledPath</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40704">delete</a></span>  <span class="comment">// the file is created as a file; make it a directory</span>
      <span class="typed"><span class="type">java.io.File</span><a href="#114785">compiledPath</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40712">mkdirs</a></span>

      <span class="comment">// delete the directory after the user code has finished</span>
      <span class="typed"><span class="type">object java.lang.Runtime</span><a id="1751">Runtime</a></span>.<span class="typed"><span class="type">()java.lang.Runtime</span><a id="67890">getRuntime</a></span>.<span class="typed"><span class="type">(java.lang.Thread)Unit</span><a id="67892">addShutdownHook</a></span>(<span class="typed"><span class="type">template $anon extends java.lang.Thread</span><a id="114787" class="keyword">new</a></span> <span class="typed"><span class="type">java.lang.Thread</span><a id="2083">Thread</a></span> {
	<span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="114789">run</a></span> { <span class="typed"><span class="type">(java.io.File)Unit</span><a href="Interpreter.scala.html#114767">deleteRecursively</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114785">compiledPath</a></span>) }})

      <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114758">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#29954">outdir</a></span>.<span class="typed"><span class="type">(settings.outdir.T)Unit</span><a href="Settings.scala.html#30302">value</a></span> = <span class="typed"><span class="type">java.io.File</span><a href="#114785">compiledPath</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40687">getPath</a></span>

      <span class="typed"><span class="type">Option[java.io.File]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114758">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="GenericRunnerSettings.scala.html#57753">nocompdaemon</a></span>.<span class="typed"><span class="type">=&gt; settings.nocompdaemon.T</span><a href="Settings.scala.html#30301">value</a></span>) {
        <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.reporters.ConsoleReporter</span><a id="114839">reporter</a></span> = <span class="typed"><span class="type">(scala.tools.nsc.Settings)scala.tools.nsc.reporters.ConsoleReporter</span><a href="reporters/ConsoleReporter.scala.html#46758" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.reporters.ConsoleReporter</span><a href="reporters/ConsoleReporter.scala.html#15935">ConsoleReporter</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114758">settings</a></span>)
        <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><a id="114840">compiler</a></span> = <span class="typed"><span class="type">(scala.tools.nsc.Settings,scala.tools.nsc.reporters.Reporter)scala.tools.nsc.Global</span><a href="#58048">newGlobal</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114758">settings</a></span>, <span class="typed"><span class="type">scala.tools.nsc.reporters.ConsoleReporter</span><a href="#114839">reporter</a></span>)
        <span class="keyword">val</span> <span class="typed"><span class="type">compiler.Run</span><a id="114841">cr</a></span> = <span class="typed"><span class="type">compiler.Run</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><a href="#114840">compiler</a></span>.<span class="typed"><span class="type">compiler.Run</span><a href="Global.scala.html#21313">Run</a></span>
	  <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.util.SourceFile</span><a id="114842">wrapped</a></span> = 
	    <span class="typed"><span class="type">(String,String,(scala.tools.nsc.io.PlainFile) =&gt; scala.tools.nsc.util.SourceFile)scala.tools.nsc.util.SourceFile</span><a href="#58046">wrappedScript</a></span>(
	      <span class="typed"><span class="type">(scala.tools.nsc.Settings)java.lang.String</span><a href="#58037">scriptMain</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114758">settings</a></span>), 
	      <span class="typed"><span class="type">String</span><a href="#114759">scriptFile</a></span>, 
	      <span class="typed"><span class="type">scala.tools.nsc.Global</span><a href="#114840">compiler</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.io.AbstractFile)scala.tools.nsc.util.SourceFile</span><a href="Global.scala.html#21223">getSourceFile</a></span> _)
          <span class="typed"><span class="type">compiler.Run</span><a href="#114841">cr</a></span>.<span class="typed"><span class="type">(List[scala.tools.nsc.util.SourceFile])Unit</span><a href="Global.scala.html#36587">compileSources</a></span>(<span class="typed"><span class="type">(scala.tools.nsc.util.SourceFile*)List[scala.tools.nsc.util.SourceFile]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">scala.tools.nsc.util.SourceFile</span><a href="#114842">wrapped</a></span>))
          <span class="typed"><span class="type">Option[java.io.File]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">scala.tools.nsc.reporters.ConsoleReporter</span><a href="#114839">reporter</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="reporters/Reporter.scala.html#34460">hasErrors</a></span>) 
	    <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114785">compiledPath</a></span>) 
	  <span class="keyword">else</span>
	    <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
      } <span class="keyword">else</span> {
        <span class="typed"><span class="type">Option[java.io.File]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String)Boolean</span><a href="#58047">compileWithDaemon</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114758">settings</a></span>, <span class="typed"><span class="type">String</span><a href="#114759">scriptFile</a></span>))
          <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114785">compiledPath</a></span>)
	<span class="keyword">else</span>
	  <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
      }
    }

    <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114758">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.BooleanSetting</span><a href="GenericRunnerSettings.scala.html#57751">savecompiled</a></span>.<span class="typed"><span class="type">=&gt; settings.savecompiled.T</span><a href="Settings.scala.html#30301">value</a></span>) {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="114851">jarFile</a></span> = <span class="typed"><span class="type">(String)java.io.File</span><a href="#58038">jarFileFor</a></span>(<span class="typed"><span class="type">String</span><a href="#114759">scriptFile</a></span>)

      <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="114852">jarOK</a></span> = (<span class="typed"><span class="type">java.io.File</span><a href="#114851">jarFile</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40695">canRead</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> 
        (<span class="typed"><span class="type">java.io.File</span><a href="#114851">jarFile</a></span>.<span class="typed"><span class="type">()Long</span><a id="40701">lastModified</a></span> <span class="typed"><span class="type">(Long)Boolean</span><a id="3268">&gt;</a></span> <span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">String</span><a href="#114759">scriptFile</a></span>).<span class="typed"><span class="type">()Long</span><a id="40701">lastModified</a></span>))

      <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a href="#114852">jarOK</a></span>) {
        <span class="comment">// pre-compiled jar is current</span>
        <span class="typed"><span class="type">(String)Boolean</span><a href="#114760" id="21757">handler</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114851">jarFile</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40689">getAbsolutePath</a></span>)
      } <span class="keyword">else</span> {
        <span class="comment">// The pre-compiled jar is old.  Recompile the script.</span>
        <span class="typed"><span class="type">java.io.File</span><a href="#114851">jarFile</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40704">delete</a></span>

        <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#114763">compile</a></span> <span class="typed"><span class="type">Boolean</span><span class="keyword">match</span></span> {
          <span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">java.io.File</span><a id="114856">compiledPath</a></span>) =&gt;
            <span class="typed"><span class="type">(java.io.File,java.io.File)AnyVal</span><a href="#58039">tryMakeJar</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114851">jarFile</a></span>, <span class="typed"><span class="type">java.io.File</span><a href="#114856">compiledPath</a></span>)
            <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a href="#114852">jarOK</a></span>) {
	      <span class="typed"><span class="type">(java.io.File)Unit</span><a href="Interpreter.scala.html#114767">deleteRecursively</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114856">compiledPath</a></span>)  <span class="comment">// may as well do it now</span>
	      <span class="typed"><span class="type">(String)Boolean</span><a href="#114760" id="21757">handler</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114851">jarFile</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40689">getAbsolutePath</a></span>)
            } <span class="keyword">else</span> {
	      <span class="comment">// jar failed; run directly from the class files</span>
	      <span class="typed"><span class="type">(String)Boolean</span><a href="#114760" id="21757">handler</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114856">compiledPath</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40687">getPath</a></span>)
            }            
	  <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt; <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
        }
      }
    } <span class="keyword">else</span> {
      <span class="comment">// don't use a cache jar at all--just use the class files</span>
      <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#114763">compile</a></span> <span class="typed"><span class="type">Boolean</span><span class="keyword">match</span></span> {
	<span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">java.io.File</span><a id="114857">compiledPath</a></span>) =&gt; <span class="typed"><span class="type">(String)Boolean</span><a href="#114760" id="21757">handler</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114857">compiledPath</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40687">getPath</a></span>)
	<span class="typed"><span class="type">Boolean(false)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt; <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
      }
    }
  }


  <span class="comment">/** Run a script after it has been compiled 
   *
   * @returns true if execution succeeded, false otherwise
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String,List[String])Boolean</span><a id="58050">runCompiled</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a id="114858">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="GenericRunnerSettings.scala.html#7302">GenericRunnerSettings</a></span>,
			  <span class="typed"><span class="type">String</span><a id="114859">compiledLocation</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>,
			  <span class="typed"><span class="type">List[String]</span><a id="114860">scriptArgs</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) : <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = {
    <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)Option[java.net.URL]</span><a id="114861">fileToURL</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="114864">f</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>): <span class="typed"><span class="type">Option[java.net.URL]</span><a id="934">Option</a></span>[URL] =
      <span class="keyword">try</span> { <span class="typed"><span class="type">(java.net.URL)Some[java.net.URL]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114864">f</a></span>.<span class="typed"><span class="type">()java.net.URL</span><a id="40693">toURL</a></span>) }
    <span class="keyword">catch</span> { <span class="typed"><span class="type">None.type</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="114866">e</a></span> =&gt; <span class="typed"><span class="type">object Console</span><a id="440">Console</a></span>.<span class="typed"><span class="type">=&gt; java.io.PrintStream</span><a id="27045">err</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a id="27112">println</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#114866">e</a></span>); <span class="typed"><span class="type">object None</span><a id="536">None</a></span> }

    <span class="keyword">def</span> <span class="typed"><span class="type">(String,Boolean)List[java.net.URL]</span><a id="114862">paths</a></span>(<span class="typed"><span class="type">String</span><a id="114869">str</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">Boolean</span><a id="114870">expandStar</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span>): <span class="typed"><span class="type">List[java.net.URL]</span><a id="526">List</a></span>[URL] =
      <span class="keyword">for</span> (
        <span class="typed"><span class="type">(((java.io.File, Option[java.net.URL])) =&gt; java.net.URL)List[java.net.URL]</span><span id="21362"><span id="114895"><span id="114901"><span id="114884"><span id="114888"><span id="23625"><span id="21367"><a id="1379">file</a></span></span></span></span></span></span></span></span> &lt;- <span class="typed"><span class="type">object scala.tools.nsc.util.ClassPath</span><a href="util/ClassPath.scala.html#8490">ClassPath</a></span>.<span class="typed"><span class="type">(String,Boolean)List[String]</span><a href="util/ClassPath.scala.html#34569">expandPath</a></span>(<span class="typed"><span class="type">String</span><a href="#114869">str</a></span>, <span class="typed"><span class="type">Boolean</span><a href="#114870">expandStar</a></span>) <span class="typed"><span class="type">((String) =&gt; java.io.File)List[java.io.File]</span><a id="21362">map</a></span> (<span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">String</span><a href="#114879">_</a></span>)) <span class="keyword">if</span> <span class="typed"><span class="type">java.io.File</span><a href="#114884">file</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40697">exists</a></span>;
        <span class="keyword">val</span> <span class="typed"><span class="type">Option[java.net.URL]</span><span id="114889"><span id="114896"><a id="114902">url</a></span></span></span> = <span class="typed"><span class="type">(java.io.File)Option[java.net.URL]</span><a href="#114861">fileToURL</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114888">file</a></span>); <span class="keyword">if</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">Option[java.net.URL]</span><a href="#114896">url</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>
      ) <span class="keyword">yield</span> <span class="typed"><span class="type">Option[java.net.URL]</span><a href="#114902">url</a></span>.<span class="typed"><span class="type">=&gt; java.net.URL</span><a id="25408">get</a></span>

    <span class="keyword">val</span> <span class="typed"><span class="type">List[java.net.URL]</span><a id="114863">classpath</a></span> =
      (<span class="typed"><span class="type">(String,Boolean)List[java.net.URL]</span><a href="#114862">paths</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114858">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#29950">bootclasspath</a></span>.<span class="typed"><span class="type">=&gt; settings.bootclasspath.T</span><a href="Settings.scala.html#30301">value</a></span>, <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>) <span class="typed"><span class="type">(List[java.net.URL])List[java.net.URL]</span><a href="#114905" id="21339">:::</a></span>
       <span class="typed"><span class="type">(String,Boolean)List[java.net.URL]</span><a href="#114862">paths</a></span>(<span class="typed"><span class="type">String</span><a href="#114859">compiledLocation</a></span>, <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>) <span class="typed"><span class="type">(List[java.net.URL])List[java.net.URL]</span><a href="#114906" id="21339">:::</a></span>
       <span class="typed"><span class="type">(String,Boolean)List[java.net.URL]</span><a href="#114862">paths</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114858">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#29952">classpath</a></span>.<span class="typed"><span class="type">=&gt; settings.classpath.T</span><a href="Settings.scala.html#30301">value</a></span>, <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>))

    <span class="keyword">try</span> {
      <span class="typed"><span class="type">object scala.tools.nsc.ObjectRunner</span><a href="ObjectRunner.scala.html#6826">ObjectRunner</a></span>.<span class="typed"><span class="type">(List[java.net.URL],String,Seq[String])Unit</span><a href="ObjectRunner.scala.html#58147">run</a></span>(
        <span class="typed"><span class="type">List[java.net.URL]</span><a href="#114863">classpath</a></span>,
        <span class="typed"><span class="type">(scala.tools.nsc.Settings)java.lang.String</span><a href="#58037">scriptMain</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#114858">settings</a></span>),
        <span class="typed"><span class="type">List[String]</span><a href="#114860">scriptArgs</a></span>.<span class="typed"><span class="type">Array[String]</span><a id="21675">toArray</a></span>)
      <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
    } <span class="keyword">catch</span> {
      <span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.ClassNotFoundException</span><a id="114915">e</a></span>: <span class="typed"><span class="type">java.lang.ClassNotFoundException</span><a id="1729">ClassNotFoundException</a></span> =&gt;
        <span class="typed"><span class="type">object Console</span><a id="440">Console</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a id="27062">println</a></span>(<span class="typed"><span class="type">java.lang.ClassNotFoundException</span><a href="#114915">e</a></span>)
        <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
      <span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.NoSuchMethodException</span><a id="114917">e</a></span>: <span class="typed"><span class="type">java.lang.NoSuchMethodException</span><a id="2089">NoSuchMethodException</a></span> =&gt;
        <span class="typed"><span class="type">object Console</span><a id="440">Console</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a id="27062">println</a></span>(<span class="typed"><span class="type">java.lang.NoSuchMethodException</span><a href="#114917">e</a></span>)
        <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
      <span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.reflect.InvocationTargetException</span><a id="114919">e</a></span>:<span class="typed"><span class="type">java.lang.reflect.InvocationTargetException</span><a id="3906">InvocationTargetException</a></span> =&gt;
        <span class="typed"><span class="type">java.lang.reflect.InvocationTargetException</span><a href="#114919">e</a></span>.<span class="typed"><span class="type">()java.lang.Throwable</span><a id="58169">getCause</a></span>.<span class="typed"><span class="type">()Unit</span><a id="23651">printStackTrace</a></span>
        <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
    }
  }


  <span class="comment">/** Run a script file with the specified arguments and compilation
   *  settings.
   *
   * @returns true if compilation and execution succeeded, false otherwise.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String,List[String])Boolean</span><a id="58051">runScript</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a id="58171">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="GenericRunnerSettings.scala.html#7302">GenericRunnerSettings</a></span>,
		<span class="typed"><span class="type">String</span><a id="58172">scriptFile</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>,
		<span class="typed"><span class="type">List[String]</span><a id="58173">scriptArgs</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) : <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = { 
    <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="114921">f</a></span> = <span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">String</span><a href="#58172">scriptFile</a></span>)
    <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">java.io.File</span><a href="#114921">f</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40699">isFile</a></span>) {
      <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)java.io.IOException</span><a id="34438" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.IOException</span><a id="3519">IOException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;no such file: &quot;)</span><span class="string">&quot;no such file: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#58172">scriptFile</a></span>)
    } <span class="keyword">else</span> {
      <span class="keyword">try</span> {
	<span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String)((String) =&gt; Boolean)Boolean</span><a href="#58049">withCompiledScript</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#58171">settings</a></span>, <span class="typed"><span class="type">String</span><a href="#58172">scriptFile</a></span>){<span class="typed"><span class="type">String</span><a id="114926">compiledLocation</a></span> =&gt;
	  <span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String,List[String])Boolean</span><a href="#58050">runCompiled</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#58171">settings</a></span>, <span class="typed"><span class="type">String</span><a href="#114926">compiledLocation</a></span>, <span class="typed"><span class="type">List[String]</span><a href="#58173">scriptArgs</a></span>)
	}
      } <span class="keyword">catch</span> {
	<span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="114927">e</a></span> =&gt; <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="#114927">e</a></span>
      }
    }
  }

  <span class="comment">/** Run a command 
   *
   * @returns true if compilation and execution succeeded, false otherwise.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String,List[String])Boolean</span><a id="58052">runCommand</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a id="58053">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="GenericRunnerSettings.scala.html#7302">GenericRunnerSettings</a></span>,
		 <span class="typed"><span class="type">String</span><a id="58054">command</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>,
		 <span class="typed"><span class="type">List[String]</span><a id="58055">scriptArgs</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]) : <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="114928">scriptFile</a></span> = <span class="typed"><span class="type">object java.io.File</span><a id="3670">File</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.io.File</span><a id="40718">createTempFile</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;scalacmd&quot;)</span><span class="string">&quot;scalacmd&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;.scala&quot;)</span><span class="string">&quot;.scala&quot;</span></span>)

    <span class="comment">// save the command to the file</span>
    {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileWriter</span><a id="114930">str</a></span> = <span class="typed"><span class="type">(java.io.File)java.io.FileWriter</span><a id="79515" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileWriter</span><a id="3624">FileWriter</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114928">scriptFile</a></span>)
      <span class="typed"><span class="type">java.io.FileWriter</span><a href="#114930">str</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28732">write</a></span>(<span class="typed"><span class="type">String</span><a href="#58054">command</a></span>)
      <span class="typed"><span class="type">java.io.FileWriter</span><a href="#114930">str</a></span>.<span class="typed"><span class="type">()Unit</span><a id="79528">close</a></span>()
    }

    <span class="keyword">try</span> {
      <span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String)((String) =&gt; Boolean)Boolean</span><a href="#58049">withCompiledScript</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#58053">settings</a></span>, <span class="typed"><span class="type">java.io.File</span><a href="#114928">scriptFile</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40687">getPath</a></span>){<span class="typed"><span class="type">String</span><a id="114936">compiledLocation</a></span> =&gt;
        <span class="typed"><span class="type">(scala.tools.nsc.GenericRunnerSettings,String,List[String])Boolean</span><a href="#58050">runCompiled</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerSettings</span><a href="#58053">settings</a></span>, <span class="typed"><span class="type">String</span><a href="#114936">compiledLocation</a></span>, <span class="typed"><span class="type">List[String]</span><a href="#58055">scriptArgs</a></span>)
      } 
    } <span class="keyword">catch</span> {
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="114937">e</a></span> =&gt; <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="#114937">e</a></span>
    } <span class="keyword">finally</span> <span class="typed"><span class="type">java.io.File</span><a href="#114928">scriptFile</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40704">delete</a></span>()  <span class="comment">// in case there was a compilation error</span>
  }
}

        </pre>
    </body>
</html>