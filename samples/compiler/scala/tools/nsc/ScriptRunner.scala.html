<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/ScriptRunner.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */
// $Id: ScriptRunner.scala 18610 2009-08-30 20:42:17Z extempore $

<span class="keyword">package</span> scala.tools.nsc

<span class="keyword">import</span> java.io.{
  InputStream, OutputStream,
  BufferedReader, FileInputStream, FileOutputStream,
  FileReader, InputStreamReader, PrintWriter, FileWriter,
  IOException
}
<span class="keyword">import</span> scala.io.{ Directory, File, Path }
// import scala.io.arm.ManagedResource
<span class="keyword">import</span> java.io.{ File =&gt; JFile }
<span class="keyword">import</span> java.lang.reflect.InvocationTargetException
<span class="keyword">import</span> java.net.URL
<span class="keyword">import</span> java.util.jar.{ JarEntry, JarOutputStream }
<span class="keyword">import</span> java.util.regex.Pattern

<span class="keyword">import</span> scala.tools.nsc.io.PlainFile
<span class="keyword">import</span> scala.tools.nsc.reporters.{Reporter,ConsoleReporter}
<span class="keyword">import</span> scala.tools.nsc.util.{ClassPath, CompoundSourceFile, BatchSourceFile, SourceFile, SourceFileFragment}

/** An object that runs Scala code in script files.
 *
 *  &lt;p&gt;For example, here is a complete Scala script on Unix:&lt;/pre&gt;
 *  &lt;pre&gt;
 *    #!/bin/sh
 *    exec scala &quot;$0&quot; &quot;$@&quot;
 *    !#
 *    Console.println(&quot;Hello, world!&quot;)
 *    argv.toList foreach Console.println
 *  &lt;/pre&gt;
 *  &lt;p&gt;And here is a batch file example on Windows XP:&lt;/p&gt;
 *  &lt;pre&gt;
 *    ::#!
 *    @echo off
 *    call scala %0 %*
 *    goto :eof
 *    ::!#
 *    Console.println(&quot;Hello, world!&quot;)
 *    argv.toList foreach Console.println
 *  &lt;/pre&gt;
 *
 *  @author  Lex Spoon
 *  @version 1.0, 15/05/2006
 *  @todo    It would be better if error output went to stderr instead
 *           of stdout...
 */
<span class="keyword">object</span> <a title="object scala.tools.nsc.ScriptRunner" id="9301">ScriptRunner</a>
<a title="ScalaObject" id="977">{</a>
  /* While I'm chasing down the fsc and script bugs. */
  <span class="keyword">def</span> <a title="(msg: Any)Unit" id="130912">DBG</a>(<a title="Any" id="130956">msg</a>: <a title="Any" id="49">Any</a>) {
    <span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">err</span>.<span title="(x$1: java.lang.String)Unit">println</span>(<a href="#130956" title="Any">msg</a>.<a title="()java.lang.String" id="3640">toString</a>)
    <span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">err</span>.<a title="()Unit" id="41389">flush</a>()
  }
  
  /** Default name to use for the wrapped script */
  <span class="keyword">val</span> <a title="java.lang.String" id="130913">defaultScriptMain</a> = <span title="java.lang.String(&quot;Main&quot;)" class="string">&quot;Main&quot;</span>
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(body: =&gt; Unit)Unit" id="130915">addShutdownHook</a>(<a title="=&gt; Unit" id="130968">body</a>: =&gt; Unit) =
    <a title="object java.lang.Runtime" id="1519">Runtime</a>.<a title="(x$1: java.lang.Thread)Unit" id="130971">getRuntime</a> addShutdownHook <a href="#1848" title="java.lang.Thread{ ... }" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Thread" id="1848">Thread</a> { <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="131153">run</a> { <a href="#130968" title="=&gt; Unit">body</a> } }

  /** Pick a main object name from the specified settings */
  <span class="keyword">def</span> <a title="(settings: scala.tools.nsc.Settings)java.lang.String" id="130916">scriptMain</a>(<a title="scala.tools.nsc.Settings" id="131235">settings</a>: <a href="Settings.scala.html#8775" title="scala.tools.nsc.Settings">Settings</a>) = <a href="#131235" title="scala.tools.nsc.Settings">settings</a>.<a href="Settings.scala.html#37319" title="=&gt; scala.tools.nsc.Settings.StringSetting">script</a>.<a href="Settings.scala.html#37988" title="=&gt; settings.script.T">value</a> <span title="java.lang.String" class="keyword">match</span> {
    <span title="java.lang.String" class="keyword">case</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> =&gt; <a href="#130913" title="=&gt; java.lang.String">defaultScriptMain</a>
    <span title="settings.script.T" class="keyword">case</span> <a title="settings.script.T" id="131244">x</a>  =&gt; <a href="#131244" title="settings.script.T">x</a>
  }

  /** Choose a jar filename to hold the compiled version of a script. */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(scriptFile: String)scala.io.File" id="130917">jarFileFor</a>(<a title="String" id="131245">scriptFile</a>: <span title="String">String</span>): <span title="scala.io.File">File</span> = {
    <span class="keyword">val</span> <a title="String" id="131340">name</a> =
      <span title="String" class="keyword">if</span> (<a href="#131245" title="(x$1: java.lang.String)Boolean" id="7044">scriptFile</a> endsWith <span title="java.lang.String(&quot;.jar&quot;)" class="string">&quot;.jar&quot;</span>) <a href="#131245" title="String">scriptFile</a>
      <span class="keyword">else</span> <a href="#131245" title="(x$1: Any)java.lang.String">scriptFile</a> + <span title="java.lang.String(&quot;.jar&quot;)" class="string">&quot;.jar&quot;</span>
    
    <span title="object scala.io.File">File</span><a title="scala.io.Codec" id="131414">(</a><a href="#131340" title="scala.io.Path" id="131409">name</a>)
  }
  
  <span class="keyword">def</span> <a title="(in: java.io.InputStream,out: java.io.OutputStream)Unit" id="130918">copyStreams</a>(<a title="java.io.InputStream" id="131417">in</a>: <a title="java.io.InputStream" id="3915">InputStream</a>, <a title="java.io.OutputStream" id="131418">out</a>: <a title="java.io.OutputStream" id="3972">OutputStream</a>) = {
    <span class="keyword">val</span> <a title="Array[Byte]" id="131421">buf</a> = <span title="Array[Byte]" class="keyword">new</span> <a title="Array[Byte]" id="905">Array</a>[Byte](<span title="Int(10240)" class="int">10240</span>)
    
    <span class="keyword">def</span> <a title="=&gt; Unit" id="131422">loop</a>: <a title="Unit" id="1971">Unit</a> = <a href="#131417" title="java.io.InputStream">in</a>.<a title="(x$1: Array[Byte],x$2: Int,x$3: Int)Int" id="84345">read</a>(<a href="#131421" title="Array[Byte]">buf</a>, <span title="Int(0)" class="int">0</span>, <a href="#131421" title="Array[Byte]">buf</a>.<a title="=&gt; Int" id="24728">length</a>) <span title="Unit" class="keyword">match</span> {
      <span title="Unit" class="keyword">case</span> <span title="Int(-1)">-</span><span class="int">1</span> =&gt; <a href="#131417" title="java.io.InputStream">in</a>.<a title="()Unit" id="84352">close</a>()
      <span title="Unit" class="keyword">case</span> <a title="Int" id="131465">n</a>  =&gt; <a href="#131418" title="java.io.OutputStream">out</a>.<a title="(x$1: Array[Byte],x$2: Int,x$3: Int)Unit" id="41545">write</a>(<a href="#131421" title="Array[Byte]">buf</a>, <span title="Int(0)" class="int">0</span>, <a href="#131465" title="Int">n</a>) ; <a href="#131422" title="=&gt; Unit">loop</a>
    }
    
    <a href="#131422" title="=&gt; Unit">loop</a>
  }

  /** Try to create a jar file out of all the contents
   *  of the directory &lt;code&gt;sourcePath&lt;/code&gt;.
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(jarFile: scala.io.File,sourcePath: scala.io.Directory)AnyVal" id="130919">tryMakeJar</a>(<a title="scala.io.File" id="131484">jarFile</a>: <span title="scala.io.File">File</span>, <a title="scala.io.Directory" id="131485">sourcePath</a>: <span title="scala.io.Directory">Directory</span>) = {
    <span class="keyword">def</span> <a title="(jar: java.util.jar.JarOutputStream,dir: scala.io.Directory,prefix: String)Unit" id="131488">addFromDir</a>(<a title="java.util.jar.JarOutputStream" id="131489">jar</a>: <span title="java.util.jar.JarOutputStream">JarOutputStream</span>, <a title="scala.io.Directory" id="131490">dir</a>: <span title="scala.io.Directory">Directory</span>, <a title="String" id="131491">prefix</a>: <span title="String">String</span>) {
      <span class="keyword">def</span> <a title="(entry: scala.io.File)Unit" id="131528">addFileToJar</a>(<a title="scala.io.File" id="131529">entry</a>: <span title="scala.io.File">File</span>) = {
        <a href="#131489" title="(x$1: java.util.zip.ZipEntry)Unit" id="131497">jar</a> putNextEntry <span title="java.util.jar.JarEntry" class="keyword">new</span> <a title="java.util.jar.JarEntry" id="119237">JarEntry</a>(<a href="#131491" title="(x$1: Any)java.lang.String">prefix</a> + <a href="#131529" title="scala.io.File">entry</a>.<span title="=&gt; String">name</span>)
        <a href="#130918" title="(in: java.io.InputStream,out: java.io.OutputStream)Unit">copyStreams</a>(<a href="#131529" title="scala.io.File">entry</a>.<a title="()java.io.FileInputStream" id="131262">inputStream</a>, <a href="#131489" title="java.util.jar.JarOutputStream">jar</a>)
        <a href="#131489" title="java.util.jar.JarOutputStream">jar</a>.<a title="()Unit" id="131545">closeEntry</a>
      }

      <a href="#131490" title="scala.io.Directory">dir</a>.<a title="(f: (scala.io.Path) =&gt; Unit)Unit" id="131507">list</a> foreach { <a title="scala.io.Path" id="131607">entry</a> =&gt;
        <span title="Unit" class="keyword">if</span> (<a href="#131607" title="scala.io.Path">entry</a>.<span title="=&gt; Boolean">isFile</span>) <a href="#131528" title="(entry: scala.io.File)Unit">addFileToJar</a>(<a href="#131607" title="scala.io.Path">entry</a>.<a title="=&gt; scala.io.File" id="112283">toFile</a>)
        <span class="keyword">else</span> <a href="#131488" title="(jar: java.util.jar.JarOutputStream,dir: scala.io.Directory,prefix: String)Unit">addFromDir</a>(<a href="#131489" title="java.util.jar.JarOutputStream">jar</a>, <a href="#131607" title="scala.io.Path">entry</a>.<a title="=&gt; scala.io.Directory" id="112284">toDirectory</a>, <a href="#131491" title="(x$1: Any)java.lang.String">prefix</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#131607" title="scala.io.Path">entry</a>.<span title="=&gt; String">name</span> + <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>)
      }
    }

    <span class="keyword">try</span> {
      <span class="keyword">val</span> <a title="java.util.jar.JarOutputStream" id="131619">jar</a> = <a title="(x$1: java.io.OutputStream)java.util.jar.JarOutputStream" id="131495" class="keyword">new</a> <span title="java.util.jar.JarOutputStream">JarOutputStream</span>(<a href="#131484" title="scala.io.File">jarFile</a>.<a title="(append: Boolean)java.io.FileOutputStream" id="131264">outputStream</a>())
      <a href="#131488" title="(jar: java.util.jar.JarOutputStream,dir: scala.io.Directory,prefix: String)Unit">addFromDir</a>(<a href="#131619" title="java.util.jar.JarOutputStream">jar</a>, <a href="#131485" title="scala.io.Directory">sourcePath</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <a href="#131619" title="java.util.jar.JarOutputStream">jar</a>.<a title="()Unit" id="131551">close</a>
    } 
    <span class="keyword">catch</span> {
      <span title="Boolean" class="keyword">case</span> _: <a title="Error" id="1572">Error</a> =&gt; <a href="#131484" title="scala.io.File">jarFile</a>.<span title="()Boolean">delete</span>() // XXX what errors to catch?
    }
  }

  /** Read the entire contents of a file as a String. */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(filename: String)String" id="130920">contentsOfFile</a>(<a title="String" id="131684">filename</a>: <span title="String">String</span>) = <span title="object scala.io.File">File</span><a title="scala.io.File" id="131699">(</a><a href="#131684" title="scala.io.Path" id="131694">filename</a>).<a href="#131699" title="scala.io.Codec" id="131336">slurp</a>()

  /** Find the length of the header in the specified file, if
    * there is one.  The header part starts with &quot;#!&quot; or &quot;::#!&quot;
    * and ends with a line that begins with &quot;!#&quot; or &quot;::!#&quot;.
    */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(filename: String)Int" id="130921">headerLength</a>(<a title="String" id="131707">filename</a>: <span title="String">String</span>): <a title="Int" id="2198">Int</a> = {
    <span class="keyword">val</span> <a title="java.util.regex.Pattern" id="131709">headerPattern</a> = <a title="object java.util.regex.Pattern" id="30801">Pattern</a>.<a title="(x$1: java.lang.String,x$2: Int)java.util.regex.Pattern" id="56089">compile</a>(<span title="java.lang.String(&quot;^(::)?!#.*(\r|\n|\r\n)&quot;)" class="string">&quot;&quot;&quot;^(::)?!#.*(\r|\n|\r\n)&quot;&quot;&quot;</span>, Pattern.<span title="Int(8)">MULTILINE</span>)
    <span class="keyword">val</span> <a title="String" id="131710">fileContents</a> = <a href="#130920" title="(filename: String)String">contentsOfFile</a>(<a href="#131707" title="String">filename</a>)
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="131711">isValid</a> = <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><a title="(p: (java.lang.String) =&gt; Boolean)Boolean" id="29123">(</a><span title="java.lang.String(&quot;#!&quot;)" class="string">&quot;#!&quot;</span>, <span title="java.lang.String(&quot;::#!&quot;)" class="string">&quot;::#!&quot;</span>) exists (<a href="#131710" title="(x$1: java.lang.String)Boolean" id="7042">fileContents</a> startsWith <a href="#131736" title="java.lang.String">_</a>)
    
    <span title="Int" class="keyword">if</span> (<a title="=&gt; Boolean" id="2226">!</a><a href="#131711" title="=&gt; Boolean">isValid</a>) <span title="Int(0)" class="int">0</span> <span class="keyword">else</span> {
      <span class="keyword">val</span> <a title="java.util.regex.Matcher" id="131743">matcher</a> = <a href="#131709" title="(x$1: java.lang.CharSequence)java.util.regex.Matcher">headerPattern</a> matcher <a href="#131710" title="String">fileContents</a>
      <span title="Int" class="keyword">if</span> (<a href="#131743" title="java.util.regex.Matcher">matcher</a>.<a title="()Boolean" id="131784">find</a>) <a href="#131743" title="java.util.regex.Matcher">matcher</a>.<a title="()Int" id="131776">end</a>
      <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span>(<span title="java.lang.String(&quot;script file does not close its header with !# or ::!#&quot;)" class="string">&quot;script file does not close its header with !# or ::!#&quot;</span>)
    }
  }

  /** Split a fully qualified object name into a
   *  package and an unqualified object name */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(fullname: String)(Option[String], String)" id="130922">splitObjectName</a>(<a title="String" id="131850">fullname</a>: <span title="String">String</span>): <span title="(Option[String], String)">(</span>Option[String], String) =
    (<a href="#131850" title="(x$1: Int)Int" id="7052">fullname</a> lastIndexOf <span title="Int(46)" class="char">'.'</span>) <span title="(Option[String], String)" class="keyword">match</span> {
      <span title="(object None, String)" class="keyword">case</span> <span title="Int(-1)">-</span><span class="int">1</span>   =&gt; <span title="(_1: object None,_2: String)(object None, String)">(</span><span title="object None">None</span>, <a href="#131850" title="String">fullname</a>)
      <span title="(Some[String], String)" class="keyword">case</span> <a title="Int" id="131874">idx</a>  =&gt; <span title="(_1: Some[String],_2: String)(Some[String], String)">(</span><span title="(x: String)Some[String]">Some</span>(<a href="#131850" title="(n: Int)scala.runtime.RichString" id="25943">fullname</a> <span title="implicit scala.Predef.richString2String : (x: scala.runtime.RichString)String">take</span> <a href="#131874" title="Int">idx</a>), <a href="#131850" title="(n: Int)scala.runtime.RichString" id="25945">fullname</a> <span title="implicit scala.Predef.richString2String : (x: scala.runtime.RichString)String">drop</span> (<a href="#131874" title="(x$1: Int)Int" id="2985">idx</a> + <span title="Int(1)" class="int">1</span>))
    }

  /** Code that is added to the beginning of a script file to make
   *  it a complete Scala compilation unit.
   */
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(objectName: String)String" id="130923">preambleCode</a>(<a title="String" id="131958">objectName</a>: <span title="String">String</span>): <span title="String">String</span> = {
    <span class="keyword">val</span> <a href="#36621" title="(Option[String], String)">(</a><a href="#131960" title="Option[String]" id="36621">maybePack</a>, <a href="#131960" title="String" id="36623">objName</a>)  = <a href="#130922" title="(fullname: String)(Option[String], String)">splitObjectName</a><span title="(Option[String], String) @unchecked">(</span><a href="#131958" title="String">objectName</a>)
    <span class="keyword">val</span> <a title="String" id="131963">packageDecl</a>           = <a href="#36621" title="(f: (String) =&gt; String)Option[String]">maybePack</a> <span title="(default: =&gt; String)String">map</span> (<span title="(args: Any*)String" class="string">&quot;package %s\n&quot;</span> format <a href="#131986" title="String">_</a>) getOrElse (<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)

    <span title="Nothing" class="keyword">return</span> <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;|
    |  object %s {
    |    def main(argv: Array[String]): Unit = {
    |      val args = argv
    |      new AnyRef {
    |&quot;&quot;&quot;</span>.<span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">stripMargin</span>.<span title="(args: Any*)String">format</span>(<a href="#36623" title="String">objName</a>)
  }

  /** Code that is added to the end of a script file to make
   *  it a complete Scala compilation unit.
   */
  <span class="keyword">val</span> <a title="String" id="130924">endCode</a> = <span title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString" class="string">&quot;&quot;&quot;
    |      }
    |    }
    |  }
    |&quot;&quot;&quot;</span>.<span title="=&gt; String">stripMargin</span>

  /** Wrap a script file into a runnable object named
   *  &lt;code&gt;scala.scripting.Main&lt;/code&gt;.
   */
  <span class="keyword">def</span> <a title="(objectName: String,filename: String,getSourceFile: (scala.tools.nsc.io.PlainFile) =&gt; scala.tools.nsc.util.BatchSourceFile)scala.tools.nsc.util.SourceFile" id="130926">wrappedScript</a>(
    <a title="String" id="132056">objectName</a>: <span title="String">String</span>, 
    <a title="String" id="132057">filename</a>: <span title="String">String</span>, 
    <a title="(scala.tools.nsc.io.PlainFile) =&gt; scala.tools.nsc.util.BatchSourceFile" id="132058">getSourceFile</a>: PlainFile =&gt; BatchSourceFile): <a href="util/SourceFile.scala.html#14788" title="scala.tools.nsc.util.SourceFile">SourceFile</a> = 
  {
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="132060">preamble</a> = <a href="util/SourceFile.scala.html#121515" title="(sourceName: String,cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="util/SourceFile.scala.html#14734" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a>(<span title="java.lang.String(&quot;&lt;script preamble&gt;&quot;)" class="string">&quot;&lt;script preamble&gt;&quot;</span>, <a href="#130923" title="(objectName: String)String">preambleCode</a>(<a href="#132056" title="String">objectName</a>).<span title="()Array[Char]">toCharArray</span>)
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.SourceFileFragment" id="132061">middle</a> = {
      <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="132077">bsf</a> = <a href="#132058" title="(v1: scala.tools.nsc.io.PlainFile)scala.tools.nsc.util.BatchSourceFile">getSourceFile</a>(<a href="io/PlainFile.scala.html#132080" title="(file: scala.io.Path)scala.tools.nsc.io.PlainFile">PlainFile</a> fromPath <a href="#132057" title="implicit scala.io.Path.string2path : (s: String)scala.io.Path">filename</a>)
      <a href="util/SourceFile.scala.html#132105" title="(underlyingFile: scala.tools.nsc.util.BatchSourceFile,start: Int,stop: Int)scala.tools.nsc.util.SourceFileFragment" class="keyword">new</a> <a href="util/SourceFile.scala.html#14713" title="scala.tools.nsc.util.SourceFileFragment">SourceFileFragment</a>(<a href="#132077" title="scala.tools.nsc.util.BatchSourceFile">bsf</a>, <a href="#130921" title="(filename: String)Int">headerLength</a>(<a href="#132057" title="String">filename</a>), <a href="#132077" title="scala.tools.nsc.util.BatchSourceFile">bsf</a>.<a href="util/SourceFile.scala.html#121519" title="=&gt; Int">length</a>)
    }
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="132062">end</a> = <a href="util/SourceFile.scala.html#121515" title="(sourceName: String,cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="util/SourceFile.scala.html#14734" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a>(<span title="java.lang.String(&quot;&lt;script trailer&gt;&quot;)" class="string">&quot;&lt;script trailer&gt;&quot;</span>, <a href="#130924" title="=&gt; String">endCode</a>.<span title="()Array[Char]">toCharArray</span>)

    <a href="util/SourceFile.scala.html#132144" title="(components: scala.tools.nsc.util.BatchSourceFile*)scala.tools.nsc.util.CompoundSourceFile" class="keyword">new</a> <a href="util/SourceFile.scala.html#14563" title="scala.tools.nsc.util.CompoundSourceFile">CompoundSourceFile</a>(<a href="#132060" title="scala.tools.nsc.util.BatchSourceFile">preamble</a>, <a href="#132061" title="scala.tools.nsc.util.SourceFileFragment">middle</a>, <a href="#132062" title="scala.tools.nsc.util.BatchSourceFile">end</a>)
  }

  /** Compile a script using the fsc compilation deamon.
   *
   *  @param settings     ...
   *  @param scriptFileIn ...
   *  @return             ...
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(settings: scala.tools.nsc.GenericRunnerSettings,scriptFileIn: String)Boolean" id="130927">compileWithDaemon</a>(
      <a title="scala.tools.nsc.GenericRunnerSettings" id="132158">settings</a>: <a href="GenericRunnerSettings.scala.html#9408" title="scala.tools.nsc.GenericRunnerSettings">GenericRunnerSettings</a>,
      <a title="String" id="132159">scriptFileIn</a>: <span title="String">String</span>): <span title="Boolean">Boolean</span> =
  {
    <span class="keyword">val</span> <a title="java.lang.String" id="132176">scriptFile</a> = <a href="CompileClient.scala.html#60585" title="(path: String)java.lang.String">CompileClient</a> absFileName <a href="#132159" title="String">scriptFileIn</a>
    
    {
      <span class="keyword">import</span> settings._
      <span class="keyword">for</span> (<a title="scala.tools.nsc.Settings.StringSetting" id="132225">setting</a> &lt;- <span title="(xs: scala.tools.nsc.Settings.StringSetting*)List[scala.tools.nsc.Settings.StringSetting]">List</span><a title="(f: (scala.tools.nsc.Settings.StringSetting) =&gt; Unit)Unit" id="29118">(</a><a href="Settings.scala.html#37231" title="=&gt; scala.tools.nsc.Settings.StringSetting">classpath</a>, <a href="Settings.scala.html#37257" title="=&gt; scala.tools.nsc.Settings.StringSetting">sourcepath</a>, <a href="Settings.scala.html#37229" title="=&gt; scala.tools.nsc.Settings.StringSetting">bootclasspath</a>, <a href="Settings.scala.html#37243" title="=&gt; scala.tools.nsc.Settings.StringSetting">extdirs</a>, <a href="Settings.scala.html#37233" title="=&gt; scala.tools.nsc.Settings.OutputSetting">outdir</a>)) {
        // DBG(&quot;%s = %s&quot;.format(setting.name, setting.value))
        <a href="#132225" title="scala.tools.nsc.Settings.StringSetting">setting</a>.<a href="Settings.scala.html#37989" title="(arg: setting.T)Unit">value</a> = <a href="CompileClient.scala.html#60585" title="(path: String)java.lang.String">CompileClient</a> absFileName <a href="#132225" title="scala.tools.nsc.Settings.StringSetting">setting</a>.<a href="Settings.scala.html#37988" title="=&gt; setting.T">value</a>
      }
    }
      
    <span class="keyword">val</span> <a title="List[String]" id="132177">compSettingNames</a>  = <span title="scala.tools.nsc.Settings" class="keyword">new</span> <a href="Settings.scala.html#8775" title="scala.tools.nsc.Settings">Settings</a>(<a href="#132238" title="(message: String)Nothing" id="7938">error</a>).<a href="Settings.scala.html#37223" title="(f: (scala.tools.nsc.Settings.Setting) =&gt; String)(implicit bf: scala.collection.generic.BuilderFactory[String,List[String],List[scala.tools.nsc.Settings.Setting]])List[String]">allSettings</a> <span title="scala.collection.generic.BuilderFactory[String,List[String],List#Coll]">map</span> (<a href="#132252" title="scala.tools.nsc.Settings.Setting">_</a>.<a href="Settings.scala.html#37913" title="=&gt; String">name</a>)
    <span class="keyword">val</span> <a title="List[scala.tools.nsc.Settings.Setting]" id="132178">compSettings</a>      = <a href="#132158" title="scala.tools.nsc.GenericRunnerSettings">settings</a>.<a href="Settings.scala.html#37223" title="(p: (scala.tools.nsc.Settings.Setting) =&gt; Boolean)List[scala.tools.nsc.Settings.Setting]">allSettings</a> filter (<a href="#132177" title="(elem: Any)Boolean" id="25768">compSettingNames</a> contains <a href="#132338" title="scala.tools.nsc.Settings.Setting">_</a>.<a href="Settings.scala.html#37913" title="=&gt; String">name</a>)
    <span class="keyword">val</span> <a title="List[String]" id="132179">coreCompArgs</a>      = <a href="#132178" title="(f: (scala.tools.nsc.Settings.Setting) =&gt; Traversable[String])(implicit bf: scala.collection.generic.BuilderFactory[String,List[String],List[scala.tools.nsc.Settings.Setting]])List[String]">compSettings</a> <span title="scala.collection.generic.BuilderFactory[String,List[String],List#Coll]">flatMap</span> (<a href="#132351" title="scala.tools.nsc.Settings.Setting">_</a>.<a href="Settings.scala.html#37937" title="=&gt; List[String]">unparse</a>)
    <span class="keyword">val</span> <a title="List[java.lang.String]" id="132180">compArgs</a>          = <a href="#132179" title="List[String]">coreCompArgs</a> <a href="#132437" title="List[String]">:::</a> <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span title="(prefix: List[java.lang.String])List[java.lang.String]">(</span><span title="java.lang.String(&quot;-Xscript&quot;)" class="string">&quot;-Xscript&quot;</span>, <a href="#130916" title="(settings: scala.tools.nsc.Settings)java.lang.String">scriptMain</a>(<a href="#132158" title="scala.tools.nsc.GenericRunnerSettings">settings</a>), <a href="#132176" title="java.lang.String">scriptFile</a>)
    <span class="keyword">var</span> <a title="Boolean" id="132181">compok</a>            = <span title="Boolean(true)" class="keyword">true</span>
        
    // XXX temporary as I started using ManagedResource not remembering it wasn't checked in.
    <span class="keyword">def</span> <a title="[T](x: =&gt; T)Some[T]" id="132182">ManagedResource</a>[<a title="&gt;: Nothing &lt;: Any" id="132184">T</a>](<a title="=&gt; T" id="132456">x</a>: =&gt; T) = <span title="(x: T)Some[T]">Some</span>(<a href="#132456" title="=&gt; T">x</a>)
    
    <span class="keyword">for</span> {
      <a title="java.net.Socket" id="132646">socket</a> &lt;- <a href="#132182" title="(x: =&gt; java.net.Socket)Some[java.net.Socket]">ManagedResource</a><span title="(f: (java.net.Socket) =&gt; (java.net.Socket, Unit))Option[(java.net.Socket, Unit)]">(</span><a href="CompileSocket.scala.html#132495" title="(vmArgs: String,create: Boolean)java.net.Socket">CompileSocket</a> getOrCreateSocket <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)
      <span class="keyword">val</span> <a title="Unit" id="132619">_</a> = <span title="Unit" class="keyword">if</span> (<a href="#132646" title="(x$1: AnyRef)Boolean" id="3647">socket</a> == <span title="Null(null)" class="keyword">null</span>) <span title="Nothing" class="keyword">return</span> <span title="Boolean(false)" class="keyword">false</span>
      <a title="java.io.PrintWriter" id="132692">out</a> &lt;- <a href="#132182" title="(x: =&gt; java.io.PrintWriter)Some[java.io.PrintWriter]">ManagedResource</a><span title="(f: (java.io.PrintWriter) =&gt; Unit)Unit">(</span><a title="(x$1: java.io.OutputStream,x$2: Boolean)java.io.PrintWriter" id="39099" class="keyword">new</a> <a title="java.io.PrintWriter" id="3927">PrintWriter</a>(<a href="#132646" title="java.net.Socket">socket</a>.<a title="()java.io.OutputStream" id="132558">getOutputStream</a>(), <span title="Boolean(true)" class="keyword">true</span>))
      <a title="java.io.BufferedReader" id="132731">in</a> &lt;- <a href="#132182" title="(x: =&gt; java.io.BufferedReader)Some[java.io.BufferedReader]">ManagedResource</a><span title="(f: (java.io.BufferedReader) =&gt; Unit)Unit">(</span><a title="(x$1: java.io.Reader)java.io.BufferedReader" id="39072" class="keyword">new</a> <a title="java.io.BufferedReader" id="3690">BufferedReader</a>(<span title="java.io.InputStreamReader" class="keyword">new</span> <a title="java.io.InputStreamReader" id="3909">InputStreamReader</a>(<a href="#132646" title="java.net.Socket">socket</a>.<a title="()java.io.InputStream" id="132557">getInputStream</a>())))
    } {
      <a href="#132692" title="(x$1: java.lang.String)Unit">out</a> println (<a href="CompileSocket.scala.html#132499" title="(port: Int)String">CompileSocket</a> getPassword <a href="#132646" title="java.net.Socket">socket</a>.<a title="()Int" id="132552">getPort</a>)
      <a href="#132692" title="(x$1: java.lang.String)Unit">out</a> println (<a href="#132180" title="(sep: String)String" id="25523">compArgs</a> mkString <span title="java.lang.String(&quot;\00&quot;)" class="string">&quot;\0&quot;</span>)
      
      <span class="keyword">for</span> (<a title="java.lang.String" id="132777">fromServer</a> &lt;- <a title="(p: (java.lang.String) =&gt; Boolean)Iterator[java.lang.String]" id="32334">(</a><a title="(elem: =&gt; java.lang.String)Iterator[java.lang.String]" id="375">Iterator</a> continually <a href="#132731" title="java.io.BufferedReader">in</a>.<a title="()java.lang.String" id="39081">readLine</a>()) <span title="(f: (java.lang.String) =&gt; Unit)Unit">takeWhile</span> (<a href="#132764" title="(x$1: AnyRef)Boolean" id="6609">_</a> != <span title="Null(null)" class="keyword">null</span>)) {
        <span title="object Console">Console</span>.<a title="(x$1: java.lang.String)Unit" id="51534">err</a> println <a href="#132777" title="java.lang.String">fromServer</a>
        <span title="Unit" class="keyword">if</span> (<a href="CompileSocket.scala.html#8908" title="object scala.tools.nsc.CompileSocket">CompileSocket</a>.<a href="CompileSocket.scala.html#132475" title="(x$1: java.lang.CharSequence)java.util.regex.Matcher">errorPattern</a> matcher <a href="#132777" title="java.lang.String">fromServer</a> <a title="()Boolean" id="131783">matches</a>)
          <a href="#132181" title="Boolean">compok</a> = <span title="Boolean(false)" class="keyword">false</span>
      }
      // XXX temp until managed resource is available
      <a href="#132731" title="java.io.BufferedReader">in</a>.<a title="()Unit" id="39089">close</a>() ; <a href="#132692" title="java.io.PrintWriter">out</a>.<a title="()Unit" id="39113">close</a>() ; <a href="#132646" title="java.net.Socket">socket</a>.<a title="()Unit" id="132589">close</a>()
    }
    
    <a href="#132181" title="Boolean">compok</a>
  }

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(settings: scala.tools.nsc.Settings,reporter: scala.tools.nsc.reporters.Reporter)scala.tools.nsc.Global" id="130928">newGlobal</a>(<a title="scala.tools.nsc.Settings" id="132810">settings</a>: <a href="Settings.scala.html#8775" title="scala.tools.nsc.Settings">Settings</a>, <a title="scala.tools.nsc.reporters.Reporter" id="132811">reporter</a>: <a href="reporters/Reporter.scala.html#13147" title="scala.tools.nsc.reporters.Reporter">Reporter</a>) =
    <span title="scala.tools.nsc.Global" class="keyword">new</span> <a href="Global.scala.html#8529" title="scala.tools.nsc.Global">Global</a>(<a href="#132810" title="scala.tools.nsc.Settings">settings</a>, <a href="#132811" title="scala.tools.nsc.reporters.Reporter">reporter</a>)

  /** Compile a script and then run the specified closure with
    * a classpath for the compiled script.
    *
    * @returns true if compilation and the handler succeeds, false otherwise.
    */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(settings: scala.tools.nsc.GenericRunnerSettings,scriptFile: String)(handler: (String) =&gt; Boolean)Boolean" id="130929">withCompiledScript</a>(
    <a title="scala.tools.nsc.GenericRunnerSettings" id="132826">settings</a>: <a href="GenericRunnerSettings.scala.html#9408" title="scala.tools.nsc.GenericRunnerSettings">GenericRunnerSettings</a>,
    <a title="String" id="132827">scriptFile</a>: <span title="String">String</span>)
    (<a title="(String) =&gt; Boolean" id="132828">handler</a>: String =&gt; Boolean): <span title="Boolean">Boolean</span> =
  {
    /** Compiles the script file, and returns the directory with the compiled
     *  class files, if the compilation succeeded.
     */
    <span class="keyword">def</span> <a title="=&gt; Option[scala.io.Directory]" id="132830">compile</a>: <span title="Option[scala.io.Directory]">Option</span>[Directory] = {
      <span class="keyword">val</span> <a title="scala.io.Directory" id="132831">compiledPath</a> = <a title="(prefix: String,suffix: String,dir: java.io.File)scala.io.Directory" id="131526">Directory</a> makeTemp <span title="java.lang.String(&quot;scalascript&quot;)" class="string">&quot;scalascript&quot;</span>

      // delete the directory after the user code has finished
      <a href="#130915" title="(body: =&gt; Unit)Unit">addShutdownHook</a>(<a href="#132831" title="scala.io.Directory">compiledPath</a>.<span title="()Boolean">deleteRecursively</span><span title="Unit">(</span>))

      <a href="#132826" title="scala.tools.nsc.GenericRunnerSettings">settings</a>.<a href="Settings.scala.html#37233" title="=&gt; scala.tools.nsc.Settings.OutputSetting">outdir</a>.<a href="Settings.scala.html#37979" title="(str: String)Unit">value</a> = <a href="#132831" title="scala.io.Directory">compiledPath</a>.<span title="=&gt; String">path</span>

      <span title="Option[scala.io.Directory]" class="keyword">if</span> (<a href="#132826" title="scala.tools.nsc.GenericRunnerSettings">settings</a>.<a href="GenericRunnerSettings.scala.html#132172" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">nocompdaemon</a>.<a href="Settings.scala.html#37988" title="=&gt; settings.nocompdaemon.T">value</a>) {
        <span class="keyword">val</span> <a title="scala.tools.nsc.reporters.ConsoleReporter" id="132846">reporter</a> = <a href="reporters/ConsoleReporter.scala.html#39052" title="(settings: scala.tools.nsc.Settings)scala.tools.nsc.reporters.ConsoleReporter" class="keyword">new</a> <a href="reporters/ConsoleReporter.scala.html#13171" title="scala.tools.nsc.reporters.ConsoleReporter">ConsoleReporter</a>(<a href="#132826" title="scala.tools.nsc.GenericRunnerSettings">settings</a>)
        <span class="keyword">val</span> <a title="scala.tools.nsc.Global" id="132847">compiler</a> = <a href="#130928" title="(settings: scala.tools.nsc.Settings,reporter: scala.tools.nsc.reporters.Reporter)scala.tools.nsc.Global">newGlobal</a>(<a href="#132826" title="scala.tools.nsc.GenericRunnerSettings">settings</a>, <a href="#132846" title="scala.tools.nsc.reporters.ConsoleReporter">reporter</a>)
        <span class="keyword">val</span> <a title="compiler.Run" id="132848">cr</a> = <span title="compiler.Run" class="keyword">new</span> <a href="#132847" title="scala.tools.nsc.Global">compiler</a>.<a href="Global.scala.html#39410" title="compiler.Run">Run</a>
        <span class="keyword">val</span> <a title="scala.tools.nsc.util.SourceFile" id="132849">wrapped</a> = <a href="#130926" title="(objectName: String,filename: String,getSourceFile: (scala.tools.nsc.io.PlainFile) =&gt; scala.tools.nsc.util.BatchSourceFile)scala.tools.nsc.util.SourceFile">wrappedScript</a>(<a href="#130916" title="(settings: scala.tools.nsc.Settings)java.lang.String">scriptMain</a>(<a href="#132826" title="scala.tools.nsc.GenericRunnerSettings">settings</a>), <a href="#132827" title="String">scriptFile</a>, <a href="Global.scala.html#39318" title="(f: scala.tools.nsc.io.AbstractFile)scala.tools.nsc.util.BatchSourceFile">compiler</a> getSourceFile <a href="#132861" title="scala.tools.nsc.io.PlainFile">_</a>)
        
        <a href="Global.scala.html#40450" title="(_sources: List[scala.tools.nsc.util.SourceFile])Unit">cr</a> compileSources <span title="(xs: scala.tools.nsc.util.SourceFile*)List[scala.tools.nsc.util.SourceFile]">List</span>(<a href="#132849" title="scala.tools.nsc.util.SourceFile">wrapped</a>)
        <span title="Option[scala.io.Directory]" class="keyword">if</span> (<a href="#132846" title="scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="reporters/Reporter.scala.html#39006" title="=&gt; Boolean">hasErrors</a>) <span title="object None">None</span> <span class="keyword">else</span> <span title="(x: scala.io.Directory)Some[scala.io.Directory]">Some</span>(<a href="#132831" title="scala.io.Directory">compiledPath</a>)
      }
      <span class="keyword">else</span> <span title="Option[scala.io.Directory]" class="keyword">if</span> (<a href="#130927" title="(settings: scala.tools.nsc.GenericRunnerSettings,scriptFileIn: String)Boolean">compileWithDaemon</a>(<a href="#132826" title="scala.tools.nsc.GenericRunnerSettings">settings</a>, <a href="#132827" title="String">scriptFile</a>)) <span title="(x: scala.io.Directory)Some[scala.io.Directory]">Some</span>(<a href="#132831" title="scala.io.Directory">compiledPath</a>)
      <span class="keyword">else</span> <span title="object None">None</span>  	      
    }

    <span title="Boolean" class="keyword">if</span> (<a href="#132826" title="scala.tools.nsc.GenericRunnerSettings">settings</a>.<a href="GenericRunnerSettings.scala.html#132170" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">savecompiled</a>.<a href="Settings.scala.html#37988" title="=&gt; settings.savecompiled.T">value</a>) {
      <span class="keyword">val</span> <a title="scala.io.File" id="132912">jarFile</a> = <a href="#130917" title="(scriptFile: String)scala.io.File">jarFileFor</a>(<a href="#132827" title="String">scriptFile</a>)
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="132913">jarOK</a>   = <a href="#132912" title="scala.io.File">jarFile</a>.<a title="(x$1: Boolean)Boolean" id="112302">canRead</a> &amp;&amp; (<a href="#132912" title="(other: scala.io.Path)Boolean" id="112321">jarFile</a> isFresher <span title="object scala.io.File">File</span><a title="scala.io.Codec" id="132929">(</a><a href="#132827" title="scala.io.Path" id="132924">scriptFile</a>))
      
      <span class="keyword">def</span> <a title="()Boolean" id="132914">recompile</a>() = {
        <a href="#132912" title="scala.io.File">jarFile</a>.<span title="()Boolean">delete</span>()
        
        <a href="#132830" title="=&gt; Option[scala.io.Directory]">compile</a> <span title="Boolean" class="keyword">match</span> {
          <span title="Boolean" class="keyword">case</span> Some(<a title="scala.io.Directory" id="132939">compiledPath</a>) =&gt;
            <a href="#130919" title="(jarFile: scala.io.File,sourcePath: scala.io.Directory)AnyVal">tryMakeJar</a>(<a href="#132912" title="scala.io.File">jarFile</a>, <a href="#132939" title="scala.io.Directory">compiledPath</a>)
            <span title="Boolean" class="keyword">if</span> (<a href="#132913" title="=&gt; Boolean">jarOK</a>) {
              <a href="#132939" title="scala.io.Directory">compiledPath</a>.<span title="()Boolean">deleteRecursively</span>()
              <a href="#132828" title="(v1: String)Boolean">handler</a>(<a href="#132912" title="scala.io.File">jarFile</a>.<span title="=&gt; scala.io.Path">toAbsolute</span>.<span title="=&gt; String">path</span>)
            }            
            // jar failed; run directly from the class files
            <span class="keyword">else</span> <a href="#132828" title="(v1: String)Boolean">handler</a>(<a href="#132939" title="scala.io.Directory">compiledPath</a>.<span title="=&gt; String">path</span>)
          <span title="Boolean(false)" class="keyword">case</span> _  =&gt; <span title="Boolean(false)" class="keyword">false</span>
        }
      }

      <span title="Boolean" class="keyword">if</span> (<a href="#132913" title="=&gt; Boolean">jarOK</a>) <a href="#132828" title="(v1: String)Boolean">handler</a>(<a href="#132912" title="scala.io.File">jarFile</a>.<span title="=&gt; scala.io.Path">toAbsolute</span>.<span title="=&gt; String">path</span>) // pre-compiled jar is current
      <span class="keyword">else</span> <a href="#132914" title="()Boolean">recompile</a>()                            // jar old - recompile the script.
    }
    // don't use a cache jar at all--just use the class files
    <span class="keyword">else</span> <a href="#132830" title="(f: (scala.io.Directory) =&gt; Boolean)Option[Boolean]">compile</a> <span title="(default: =&gt; Boolean)Boolean">map</span> (<a title="scala.io.Directory" id="132962">cp</a> =&gt; <a href="#132828" title="(v1: String)Boolean">handler</a>(<a href="#132962" title="scala.io.Directory">cp</a>.<span title="=&gt; String">path</span>)) getOrElse <span title="Boolean(false)" class="keyword">false</span>
  }

  /** Run a script after it has been compiled 
   *
   * @returns true if execution succeeded, false otherwise
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(settings: scala.tools.nsc.GenericRunnerSettings,compiledLocation: String,scriptArgs: List[String])Boolean" id="130930">runCompiled</a>(
    <a title="scala.tools.nsc.GenericRunnerSettings" id="132976">settings</a>: <a href="GenericRunnerSettings.scala.html#9408" title="scala.tools.nsc.GenericRunnerSettings">GenericRunnerSettings</a>,
		<a title="String" id="132977">compiledLocation</a>: <span title="String">String</span>,
		<a title="List[String]" id="132978">scriptArgs</a>: <span title="List[String]">List</span>[String]): <span title="Boolean">Boolean</span> =
	{
    <span class="keyword">def</span> <a title="(f: java.io.File)Option[java.net.URL]" id="132980">fileToURL</a>(<a title="java.io.File" id="132983">f</a>: <span title="java.io.File">JFile</span>): <span title="Option[java.net.URL]">Option</span>[URL] =
      <span class="keyword">try</span> <span title="(x: java.net.URL)Some[java.net.URL]">Some</span>(<a href="#132983" title="java.io.File">f</a>.<a title="()java.net.URL" id="35377">toURL</a>) <span class="keyword">catch</span> { <span title="None.type" class="keyword">case</span> _: <a title="Exception" id="1896">Exception</a> =&gt; <span title="object None">None</span> }

    <span class="keyword">def</span> <a title="(str: String,expandStar: Boolean)List[java.net.URL]" id="132981">paths</a>(<a title="String" id="132991">str</a>: <span title="String">String</span>, <a title="Boolean" id="132992">expandStar</a>: <span title="Boolean">Boolean</span>): <span title="List[java.net.URL]">List</span>[URL] =
      <span class="keyword">for</span> {
        <a title="java.io.File" id="133113">file</a> &lt;- <a href="util/ClassPath.scala.html#14795" title="object scala.tools.nsc.util.ClassPath">ClassPath</a>.<a href="util/ClassPath.scala.html#118240" title="(path: String,expandStar: Boolean)List[String]">expandPath</a><span title="(f: (String) =&gt; java.io.File)(implicit bf: scala.collection.generic.BuilderFactory[java.io.File,List[java.io.File],List[String]])List[java.io.File]">(</span><a href="#132991" title="String">str</a>, <a href="#132992" title="Boolean">expandStar</a>) <span title="(f: (java.io.File) =&gt; Traversable[java.net.URL])(implicit bf: scala.collection.generic.BuilderFactory[java.net.URL,List[java.net.URL],List[java.io.File]])List[java.net.URL]">map</span> (<span title="java.io.File" class="keyword">new</span> <span title="java.io.File">JFile</span>(<a href="#133009" title="String">_</a>))
        <span class="keyword">if</span> <a href="#133113" title="java.io.File">file</a>.<a title="()Boolean" id="35381">exists</a> 
        <a title="java.net.URL" id="133131">url</a> &lt;- <a href="#132980" title="(f: java.io.File)Option[java.net.URL]">fileToURL</a><span title="(f: (java.net.URL) =&gt; java.net.URL)Option[java.net.URL]">(</span><a href="#133113" title="java.io.File">file</a>)
      } <span class="keyword">yield</span> <a href="#133131" title="java.net.URL">url</a>

    <span class="keyword">val</span> <a title="List[java.net.URL]" id="132982">classpath</a> =
      (<a href="#132981" title="(str: String,expandStar: Boolean)List[java.net.URL]">paths</a>(<a href="#132976" title="scala.tools.nsc.GenericRunnerSettings">settings</a>.<a href="Settings.scala.html#37229" title="=&gt; scala.tools.nsc.Settings.StringSetting">bootclasspath</a>.<a href="Settings.scala.html#37988" title="=&gt; settings.bootclasspath.T">value</a>, <span title="Boolean(true)" class="keyword">true</span>) <a href="#133176" title="List[java.net.URL]">:::</a>
       <a href="#132981" title="(str: String,expandStar: Boolean)List[java.net.URL]">paths</a>(<a href="#132977" title="String">compiledLocation</a>, <span title="Boolean(false)" class="keyword">false</span>) <a href="#133179" title="(prefix: List[java.net.URL])List[java.net.URL]">:::</a>
       <a href="#132981" title="(str: String,expandStar: Boolean)List[java.net.URL]">paths</a><span title="(prefix: List[java.net.URL])List[java.net.URL]">(</span><a href="#132976" title="scala.tools.nsc.GenericRunnerSettings">settings</a>.<a href="Settings.scala.html#37231" title="=&gt; scala.tools.nsc.Settings.StringSetting">classpath</a>.<a href="Settings.scala.html#37988" title="=&gt; settings.classpath.T">value</a>, <span title="Boolean(true)" class="keyword">true</span>))

    <span class="keyword">try</span> {
      <a href="ObjectRunner.scala.html#8872" title="object scala.tools.nsc.ObjectRunner">ObjectRunner</a>.<a href="ObjectRunner.scala.html#133200" title="(urls: List[java.net.URL],objectName: String,arguments: Seq[String])Unit">run</a>(
        <a href="#132982" title="List[java.net.URL]">classpath</a>,
        <a href="#130916" title="(settings: scala.tools.nsc.Settings)java.lang.String">scriptMain</a>(<a href="#132976" title="scala.tools.nsc.GenericRunnerSettings">settings</a>),
        <a href="#132978" title="List[String]">scriptArgs</a>.<a title="(implicit evidence$1: scala.reflect.ClassManifest[String])Array[String]" id="27492">toArray</a>)
      <span title="Boolean(true)" class="keyword">true</span>
    } 
    <span class="keyword">catch</span> {
      <span title="Boolean" class="keyword">case</span> <a title="java.lang.Throwable" id="133225">e</a> @ (_: <a title="java.lang.ClassNotFoundException" id="1494">ClassNotFoundException</a> | _: <a title="java.lang.NoSuchMethodException" id="1854">NoSuchMethodException</a>) =&gt;
        <a title="(x: Any)Unit" id="51576">Console</a> println <a href="#133225" title="java.lang.Throwable">e</a>
        <span title="Boolean(false)" class="keyword">false</span>
      <span title="Boolean" class="keyword">case</span> <a title="java.lang.reflect.InvocationTargetException" id="133241">e</a>: <a title="java.lang.reflect.InvocationTargetException" id="4077">InvocationTargetException</a> =&gt;
        <a href="#133241" title="java.lang.reflect.InvocationTargetException">e</a>.<a title="()java.lang.Throwable" id="125598">getCause</a>.<a title="()Unit" id="26091">printStackTrace</a>
        <span title="Boolean(false)" class="keyword">false</span>
    }
  }

  /** Run a script file with the specified arguments and compilation
   *  settings.
   *
   * @returns true if compilation and execution succeeded, false otherwise.
   */
  <span class="keyword">def</span> <a title="(settings: scala.tools.nsc.GenericRunnerSettings,scriptFile: String,scriptArgs: List[String])Boolean" id="130931">runScript</a>(
    <a title="scala.tools.nsc.GenericRunnerSettings" id="133248">settings</a>: <a href="GenericRunnerSettings.scala.html#9408" title="scala.tools.nsc.GenericRunnerSettings">GenericRunnerSettings</a>,
		<a title="String" id="133249">scriptFile</a>: <span title="String">String</span>,
		<a title="List[String]" id="133250">scriptArgs</a>: <span title="List[String]">List</span>[String]): <span title="Boolean">Boolean</span> =
	{
	  <span title="Boolean" class="keyword">if</span> (<span title="object scala.io.File">File</span><a title="scala.io.Codec" id="133264">(</a><a href="#133249" title="scala.io.Path" id="133259">scriptFile</a>).<span title="=&gt; Boolean">isFile</span>)
	    <a href="#130929" title="(settings: scala.tools.nsc.GenericRunnerSettings,scriptFile: String)(handler: (String) =&gt; Boolean)Boolean">withCompiledScript</a>(<a href="#133248" title="scala.tools.nsc.GenericRunnerSettings">settings</a>, <a href="#133249" title="String">scriptFile</a>) { <a href="#130930" title="(settings: scala.tools.nsc.GenericRunnerSettings,compiledLocation: String,scriptArgs: List[String])Boolean">runCompiled</a>(<a href="#133248" title="scala.tools.nsc.GenericRunnerSettings">settings</a>, <a href="#133270" title="String">_</a>, <a href="#133250" title="List[String]">scriptArgs</a>) }
	  <span class="keyword">else</span>
	    <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span>(<span title="(x$1: Any)java.lang.String" class="string">&quot;no such file: &quot;</span> + <a href="#133249" title="String">scriptFile</a>)
  }

  /** Run a command 
   *
   * @returns true if compilation and execution succeeded, false otherwise.
   */
  <span class="keyword">def</span> <a title="(settings: scala.tools.nsc.GenericRunnerSettings,command: String,scriptArgs: List[String])Boolean" id="130932">runCommand</a>(
    <a title="scala.tools.nsc.GenericRunnerSettings" id="133283">settings</a>: <a href="GenericRunnerSettings.scala.html#9408" title="scala.tools.nsc.GenericRunnerSettings">GenericRunnerSettings</a>,
    <a title="String" id="133284">command</a>: <span title="String">String</span>,
		<a title="List[String]" id="133285">scriptArgs</a>: <span title="List[String]">List</span>[String]) : <span title="Boolean">Boolean</span> =
	{
    <span class="keyword">val</span> <a title="scala.io.File" id="133287">scriptFile</a> = <span title="object scala.io.File">File</span>.<a title="(prefix: String,suffix: String,dir: java.io.File)scala.io.File" id="131299">makeTemp</a>(<span title="java.lang.String(&quot;scalacmd&quot;)" class="string">&quot;scalacmd&quot;</span>, <span title="java.lang.String(&quot;.scala&quot;)" class="string">&quot;.scala&quot;</span>)
    // save the command to the file
    <a href="#133287" title="(xs: Traversable[String],append: Boolean,codec: scala.io.Codec)Unit" id="131283">scriptFile</a> writeAll <span title="(xs: String*)List[String]">List</span>(<a href="#133284" title="String">command</a>)
    
    <span class="keyword">try</span> <a href="#130929" title="(settings: scala.tools.nsc.GenericRunnerSettings,scriptFile: String)(handler: (String) =&gt; Boolean)Boolean">withCompiledScript</a>(<a href="#133283" title="scala.tools.nsc.GenericRunnerSettings">settings</a>, <a href="#133287" title="scala.io.File">scriptFile</a>.<span title="=&gt; String">path</span>) { <a href="#130930" title="(settings: scala.tools.nsc.GenericRunnerSettings,compiledLocation: String,scriptArgs: List[String])Boolean">runCompiled</a>(<a href="#133283" title="scala.tools.nsc.GenericRunnerSettings">settings</a>, <a href="#133304" title="String">_</a>, <a href="#133285" title="List[String]">scriptArgs</a>) }
    <span class="keyword">finally</span> <a href="#133287" title="scala.io.File">scriptFile</a>.<span title="()Boolean">delete</span><span title="Unit">(</span>)  // in case there was a compilation error
  }
}

        </pre>
    </body>
</html>