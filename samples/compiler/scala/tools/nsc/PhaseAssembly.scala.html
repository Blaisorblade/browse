<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/PhaseAssembly.scala</title>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2007-2009 LAMP/EPFL
 * @author Anders Bach Nielsen
 * @version 1.0
 */</span>
<span class="comment">// $Id: PhaseAssembly.scala 17274 2009-03-10 11:39:04Z michelou $</span>

<span class="keyword">package</span> scala.tools.nsc

<span class="keyword">import</span> scala.collection.mutable.{HashSet, HashMap}
<span class="keyword">import</span> java.io.{BufferedWriter, FileWriter}

<span class="comment">/** 
 * PhaseAssembly
 * Trait made to seperate the constraint solving of the phase order from
 * the rest of the compiler. See SIP 00002
 *   
 */</span>
<span class="keyword">trait</span> <span class="typed"><span class="type">trait PhaseAssembly extends java.lang.Object with ScalaObject</span><a id="6867">PhaseAssembly</a></span> { self: Global =&gt;
  
  <span class="comment">/**
   * Aux datastructure for solving the constraint system
   * The depency graph container with helper methods for node and edge creation
   */</span>
  <span class="keyword">class</span> <span class="typed"><span class="type">class DependencyGraph extends java.lang.Object with ScalaObject</span><a id="22589">DependencyGraph</a></span> {

    <span class="comment">/**
     * Simple edge with to and from refs
     */</span>
    <span class="keyword">class</span> <span class="typed"><span class="type">class Edge extends java.lang.Object with ScalaObject</span><a id="141622">Edge</a></span>(<span class="keyword">var</span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><span id="141677"><span id="141654"><span id="141642"><span id="141640"><a id="141641">frm</a></span></span></span></span></span>: <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span>, <span class="keyword">var</span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><span id="141644"><span id="141678"><span id="141655"><span id="141643"><a id="141645">to</a></span></span></span></span></span>: <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span>, <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="141656"><span id="141646"><span id="141648"><span id="141679"><a id="141647">hard</a></span></span></span></span></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span>) 
    
    <span class="comment">/**
     * Simple node with name and object ref for the phase object,
     * also sets of in and out going dependencies
     */</span>
    <span class="keyword">class</span> <span class="typed"><span class="type">class Node extends java.lang.Object with ScalaObject</span><a id="141623">Node</a></span>(<span class="typed"><span class="type">String</span><span id="141658"><a id="141686">name</a></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) {
      <span class="keyword">val</span> <span class="typed"><span class="type">String</span><span id="141661"><a id="141660">phasename</a></span></span> = <span class="typed"><span class="type">String</span><a href="#141658">name</a></span>
      <span class="keyword">var</span> <span class="typed"><span class="type">Option[List[scala.tools.nsc.SubComponent]]</span><span id="141664"><span id="141662"><span id="141663"><a id="141682">phaseobj</a></span></span></span></span>: <span class="typed"><span class="type">Option[List[scala.tools.nsc.SubComponent]]</span><a id="934">Option</a></span>[List[SubComponent]] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><span id="141666"><a id="141665">after</a></span></span> = <span class="typed"><span class="type">scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a id="19895">HashSet</a></span>[Edge]()
      <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><span id="141669"><span id="141667"><span id="141668"><a id="141683">before</a></span></span></span></span> = <span class="typed"><span class="type">scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a id="19895">HashSet</a></span>[Edge]()
      <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="141672"><span id="141670"><span id="141671"><a id="141684">visited</a></span></span></span></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
      <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><span id="141675"><span id="141673"><span id="141674"><a id="141685">level</a></span></span></span></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>

      <span class="keyword">def</span> <span class="typed"><span class="type">()String</span><a id="141676">allPhaseNames</a></span>(): <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = <span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span> <span class="typed"><span class="type">String</span><span class="keyword">match</span></span> {
	<span class="typed"><span class="type">String</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt; <span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span>
	<span class="typed"><span class="type">String</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a id="141687">lst</a></span>) =&gt; <span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a href="#141687">lst</a></span>.<span class="typed"><span class="type">((scala.tools.nsc.SubComponent) =&gt; String)List[String]</span><a id="21362">map</a></span>(<span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a href="#141690">_</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="SubComponent.scala.html#29450">phaseName</a></span>).<span class="typed"><span class="type">((String, String) =&gt; String)String</span><a id="21379">reduceLeft</a></span>(<span class="typed"><span class="type">String</span><a href="#141697">_</a></span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span><span class="typed"><span class="type">java.lang.String(&quot;,&quot;)</span><span class="string">&quot;,&quot;</span></span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span><span class="typed"><span class="type">String</span><a href="#141698">_</a></span>)
      }
    }

    <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><span id="141625"><a id="141624">nodes</a></span></span> = <span class="typed"><span class="type">scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><a id="20081">HashMap</a></span>[String,Node]()
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><span id="141627"><a id="141626">edges</a></span></span> = <span class="typed"><span class="type">scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a id="19895">HashSet</a></span>[Edge]()

    <span class="comment">/* Given a phase object, get the node for this phase object. If the
     * node object does not exist, then create it.
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.SubComponent)DependencyGraph.this.Node</span><a id="141628">getNodeByPhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a id="141699">phs</a></span>: <span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a href="SubComponent.scala.html#6300">SubComponent</a></span>): <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span> = {
      <span class="keyword">var</span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><a id="141700">node</a></span>: <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span> = <span class="typed"><span class="type">(String)DependencyGraph.this.Node</span><a href="#141629">getNodeByPhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a href="#141699">phs</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="SubComponent.scala.html#29450">phaseName</a></span>)
      <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141700">node</a></span>.<span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
	<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt;
	  <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141700">node</a></span>.<span class="typed"><span class="type">(Option[List[scala.tools.nsc.SubComponent]])Unit</span><a href="#141663">phaseobj</a></span> = <span class="typed"><span class="type">(List[scala.tools.nsc.SubComponent])Some[List[scala.tools.nsc.SubComponent]]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">(scala.tools.nsc.SubComponent*)List[scala.tools.nsc.SubComponent]</span><span id="21328"><a id="527">List</a></span></span>[<span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a href="SubComponent.scala.html#6300">SubComponent</a></span>](<span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a href="#141699">phs</a></span>))
	<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _ =&gt;
      }
      <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141700">node</a></span>
    }

    <span class="comment">/* Given the name of a phase object, get the node for that name. If the
     * node object does not exits, then create it.
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)DependencyGraph.this.Node</span><a id="141629">getNodeByPhase</a></span>(<span class="typed"><span class="type">String</span><a id="141702">name</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span> = {
      <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><a href="#141624">nodes</a></span>.<span class="typed"><span class="type">(String)Option[DependencyGraph.this.Node]</span><a id="24295">get</a></span>(<span class="typed"><span class="type">String</span><a href="#141702">name</a></span>).<span class="typed"><span class="type">(=&gt; DependencyGraph.this.Node)DependencyGraph.this.Node</span><a id="25411">getOrElse</a></span> {
        <span class="keyword">val</span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><a id="141706">node</a></span> = <span class="typed"><span class="type">DependencyGraph.this.Node</span><span class="keyword">new</span></span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span>(<span class="typed"><span class="type">String</span><a href="#141702">name</a></span>)
        <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><a href="#141624">nodes</a></span> <span class="typed"><span class="type">((String, DependencyGraph.this.Node))Unit</span><a id="24189">+=</a></span> (<span class="typed"><span class="type">(String)ArrowAssoc[String]</span><span id="6054"><a href="#141702" id="821">name</a></span></span> <span class="typed"><span class="type">(DependencyGraph.this.Node)(String, DependencyGraph.this.Node)</span><a id="6050">-&gt;</a></span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141706">node</a></span>)
        <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141706">node</a></span>
      }
    }
    
    <span class="comment">/* Connect the frm and to nodes with an edge and make it soft.
     * Also add the edge object to the set of edges, and to the dependency
     * list of the nodes
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(DependencyGraph.this.Node,DependencyGraph.this.Node)Unit</span><a id="141630">softConnectNodes</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Node</span><a id="141718">frm</a></span>: <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span>, <span class="typed"><span class="type">DependencyGraph.this.Node</span><a id="141719">to</a></span>: <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span>) {
      <span class="keyword">var</span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a id="141720">e</a></span> = <span class="typed"><span class="type">DependencyGraph.this.Edge</span><span class="keyword">new</span></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141622">Edge</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141718">frm</a></span>, <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141719">to</a></span>, <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>)
      <span class="typed"><span class="type">DependencyGraph.this.type</span><a href="#22589" class="keyword">this</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141626">edges</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141720">e</a></span>
      
      <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141718">frm</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141665">after</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141720">e</a></span>
      <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141719">to</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141720">e</a></span>
    }
    
    <span class="comment">/* Connect the frm and to nodes with an edge and make it hard.
     * Also add the edge object to the set of edges, and to the dependency
     * list of the nodes
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(DependencyGraph.this.Node,DependencyGraph.this.Node)Unit</span><a id="141631">hardConnectNodes</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Node</span><a id="141725">frm</a></span>: <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span>, <span class="typed"><span class="type">DependencyGraph.this.Node</span><a id="141726">to</a></span>: <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span>) {
      <span class="keyword">var</span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a id="141727">e</a></span> = <span class="typed"><span class="type">DependencyGraph.this.Edge</span><span class="keyword">new</span></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141622">Edge</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141725">frm</a></span>, <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141726">to</a></span>, <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>)
      <span class="typed"><span class="type">DependencyGraph.this.type</span><a href="#22589" class="keyword">this</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141626">edges</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141727">e</a></span>
      
      <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141725">frm</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141665">after</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141727">e</a></span>
      <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141726">to</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141727">e</a></span>
    }

    <span class="comment">/* Given the entire graph, collect the phase objects at each level, where the phase
     * names are sorted alphabetical at each level, into the compiler phase list
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">()List[scala.tools.nsc.SubComponent]</span><a id="141632">compilerPhaseList</a></span>(): <span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a id="526">List</a></span>[SubComponent] = {
      <span class="keyword">var</span> <span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a id="141732">chain</a></span>: <span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a id="526">List</a></span>[SubComponent] = <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>

      <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="141733">lvl</a></span> = <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
      <span class="keyword">var</span> <span class="typed"><span class="type">List[DependencyGraph.this.Node]</span><a id="141734">nds</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><a href="#141624">nodes</a></span>.<span class="typed"><span class="type">=&gt; Iterator[DependencyGraph.this.Node]</span><a id="24244">values</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Node) =&gt; Boolean)Iterator[DependencyGraph.this.Node]</span><a id="32193">filter</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141737">_</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#141673">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int</span><a href="#141733">lvl</a></span>).<span class="typed"><span class="type">=&gt; List[DependencyGraph.this.Node]</span><a id="32235">toList</a></span>
      <span class="typed"><span class="type">Unit</span><a href="#141735" class="keyword">while</a></span>(<span class="typed"><span class="type">List[DependencyGraph.this.Node]</span><a href="#141734">nds</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) {
	<span class="typed"><span class="type">List[DependencyGraph.this.Node]</span><a href="#141734">nds</a></span> = <span class="typed"><span class="type">List[DependencyGraph.this.Node]</span><a href="#141734">nds</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Node, DependencyGraph.this.Node) =&gt; Boolean)List[DependencyGraph.this.Node]</span><a id="21370">sort</a></span>((<span class="typed"><span class="type">DependencyGraph.this.Node</span><a id="141743">n1</a></span>,<span class="typed"><span class="type">DependencyGraph.this.Node</span><a id="141744">n2</a></span>) =&gt; (<span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141743">n1</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(java.lang.String)Int</span><a id="5836">compareTo</a></span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141744">n2</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span>) <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
	<span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Node) =&gt; Unit)Unit</span><span id="21366"><a id="141748">n</a></span></span> &lt;- <span class="typed"><span class="type">List[DependencyGraph.this.Node]</span><a href="#141734">nds</a></span>) {
	  <span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a href="#141732">chain</a></span> = <span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a href="#141732">chain</a></span> <span class="typed"><span class="type">(List[scala.tools.nsc.SubComponent])List[scala.tools.nsc.SubComponent]</span><a href="#141749" id="21339">:::</a></span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141748">n</a></span>.<span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span>.<span class="typed"><span class="type">=&gt; List[scala.tools.nsc.SubComponent]</span><a id="25408">get</a></span>
	}      
	<span class="typed"><span class="type">Int</span><a href="#141733">lvl</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
	<span class="typed"><span class="type">List[DependencyGraph.this.Node]</span><a href="#141734">nds</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><a href="#141624">nodes</a></span>.<span class="typed"><span class="type">=&gt; Iterator[DependencyGraph.this.Node]</span><a id="24244">values</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Node) =&gt; Boolean)Iterator[DependencyGraph.this.Node]</span><a id="32193">filter</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141779">_</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#141673">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int</span><a href="#141733">lvl</a></span>).<span class="typed"><span class="type">=&gt; List[DependencyGraph.this.Node]</span><a id="32235">toList</a></span>
      }
      <span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a href="#141732">chain</a></span>
    }

    <span class="comment">/* Test if there are cycles in the graph, assign levels to the nodes
     * and collapse hard links into nodes
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(DependencyGraph.this.Node,Int)Unit</span><a id="141633">collapseHardLinksAndLevels</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Node</span><a id="141782">node</a></span>: <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141623">Node</a></span>, <span class="typed"><span class="type">Int</span><a id="141783">lvl</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) {
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#141670">visited</a></span>) {
	<span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><a href="FatalError.scala.html#6270">FatalError</a></span>(
          <span class="typed"><span class="type">java.lang.String(&quot;Cycle in compiler phase dependencies detected, phase &quot;)</span><span class="string">&quot;Cycle in compiler phase dependencies detected, phase &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
          <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; reacted twice!&quot;)</span><span class="string">&quot; reacted twice!&quot;</span></span>)
      }

      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#141673">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int</span><a href="#141783">lvl</a></span>) <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a href="#141674">level</a></span> = <span class="typed"><span class="type">Int</span><a href="#141783">lvl</a></span>
      
      <span class="keyword">var</span> <span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a id="141784">hls</a></span> = <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span> <span class="typed"><span class="type">(Iterable[DependencyGraph.this.Edge])List[DependencyGraph.this.Edge]</span><a id="21341">++</a></span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Boolean)Iterable[DependencyGraph.this.Edge]</span><a id="21786">filter</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141794">_</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#141646">hard</a></span>)
      <span class="typed"><span class="type">Unit</span><a href="#141785" class="keyword">while</a></span> (<span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141784">hls</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) {
	<span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Unit)Unit</span><span id="21366"><a id="141799">hl</a></span></span> &lt;- <span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141784">hls</a></span>) {
	  <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">(Option[List[scala.tools.nsc.SubComponent]])Unit</span><a href="#141663">phaseobj</a></span> = <span class="typed"><span class="type">(List[scala.tools.nsc.SubComponent])Some[List[scala.tools.nsc.SubComponent]]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span>.<span class="typed"><span class="type">=&gt; List[scala.tools.nsc.SubComponent]</span><a id="25408">get</a></span> <span class="typed"><span class="type">(Iterable[scala.tools.nsc.SubComponent])List[scala.tools.nsc.SubComponent]</span><a id="21341">++</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141799">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span>.<span class="typed"><span class="type">=&gt; List[scala.tools.nsc.SubComponent]</span><a id="25408">get</a></span>)
	  <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">(scala.collection.mutable.HashSet[DependencyGraph.this.Edge])Unit</span><a href="#141668">before</a></span> = <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141799">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span>
	  <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><a href="#141624">nodes</a></span> <span class="typed"><span class="type">(String)Unit</span><a id="24167">-=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141799">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span>
	  <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141626">edges</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25500">-=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141799">hl</a></span>
	  <span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Unit)Unit</span><span id="21792"><a id="141817">edge</a></span></span> &lt;- <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span>) <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141817">edge</a></span>.<span class="typed"><span class="type">(DependencyGraph.this.Node)Unit</span><a href="#141644">to</a></span> = <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>
	}
	<span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141784">hls</a></span> = <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span> <span class="typed"><span class="type">(Iterable[DependencyGraph.this.Edge])List[DependencyGraph.this.Edge]</span><a id="21341">++</a></span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Boolean)Iterable[DependencyGraph.this.Edge]</span><a id="21786">filter</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141825">_</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#141646">hard</a></span>)
      }
      <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">(Boolean)Unit</span><a href="#141671">visited</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
      
      <span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Unit)Unit</span><span id="21792"><a id="141827">edge</a></span></span> &lt;- <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span>) {
	<span class="typed"><span class="type">(DependencyGraph.this.Node,Int)Unit</span><a href="#141633">collapseHardLinksAndLevels</a></span>( <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141827">edge</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>, <span class="typed"><span class="type">Int</span><a href="#141783">lvl</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)
      }

      <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141782">node</a></span>.<span class="typed"><span class="type">(Boolean)Unit</span><a href="#141671">visited</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
    }

    <span class="comment">/* Find all edges in the given graph that are hard links. For each hard link we
     * need to check that its the only dependency. If not, then we will promote the
     * other dependencies down
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="141634">validateAndEnforceHardlinks</a></span>() {
      <span class="keyword">var</span> <span class="typed"><span class="type">Iterable[DependencyGraph.this.Edge]</span><a id="141846">hardlinks</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141626">edges</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Boolean)Iterable[DependencyGraph.this.Edge]</span><a id="21786">filter</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141849">_</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#141646">hard</a></span>)
      <span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Unit)Unit</span><span id="21792"><a id="141851">hl</a></span></span> &lt;- <span class="typed"><span class="type">Iterable[DependencyGraph.this.Edge]</span><a href="#141846">hardlinks</a></span>) {
	<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141851">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141665">after</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="25568">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) {
	  <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><a href="FatalError.scala.html#6270">FatalError</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;phase &quot;)</span><span class="string">&quot;phase &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141851">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; want to run right after &quot;)</span><span class="string">&quot; want to run right after &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141851">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;, but some phase has declared to run before &quot;)</span><span class="string">&quot;, but some phase has declared to run before &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141851">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;. Re-run with -Xgenerate-phase-graph &lt;filename&gt; to better see the problem.&quot;)</span><span class="string">&quot;. Re-run with -Xgenerate-phase-graph &lt;filename&gt; to better see the problem.&quot;</span></span>)
	}
      }

      <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><a id="141847">rerun</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
      <span class="typed"><span class="type">Unit</span><a href="#141854" class="keyword">while</a></span> (<span class="typed"><span class="type">Boolean</span><a href="#141847">rerun</a></span>) {
	<span class="typed"><span class="type">Boolean</span><a href="#141847">rerun</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
	<span class="typed"><span class="type">Iterable[DependencyGraph.this.Edge]</span><a href="#141846">hardlinks</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141626">edges</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Boolean)Iterable[DependencyGraph.this.Edge]</span><a id="21786">filter</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141856">_</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#141646">hard</a></span>)
	<span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Unit)Unit</span><span id="21792"><a id="141858">hl</a></span></span> &lt;- <span class="typed"><span class="type">Iterable[DependencyGraph.this.Edge]</span><a href="#141846">hardlinks</a></span>) {
	  <span class="keyword">var</span> <span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a id="141859">sanity</a></span> = <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span> <span class="typed"><span class="type">(Iterable[DependencyGraph.this.Edge])List[DependencyGraph.this.Edge]</span><a id="21341">++</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141858">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Boolean)Iterable[DependencyGraph.this.Edge]</span><a id="21786">filter</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141867">_</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#141646">hard</a></span>)
	  <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141859">sanity</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21345">length</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) {
	    <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><a href="FatalError.scala.html#6270">FatalError</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;There is no runs right after dependency, where there should be one! This is not supposed to happen!&quot;)</span><span class="string">&quot;There is no runs right after dependency, where there should be one! This is not supposed to happen!&quot;</span></span>)
	  } <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141859">sanity</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21345">length</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) {
	    <span class="keyword">var</span> <span class="typed"><span class="type">java.lang.String</span><a id="141873">msg</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;Multiple phases want to run right after the phase &quot;)</span><span class="string">&quot;Multiple phases want to run right after the phase &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141859">sanity</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Edge</span><a id="21650">first</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;\012&quot;)</span><span class="string">&quot;\n&quot;</span></span>
	    <span class="typed"><span class="type">java.lang.String</span><a href="#141873">msg</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;Phases: &quot;)</span><span class="string">&quot;Phases: &quot;</span></span>
	    <span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141859">sanity</a></span> = <span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141859">sanity</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Edge, DependencyGraph.this.Edge) =&gt; Boolean)List[DependencyGraph.this.Edge]</span><a id="21370">sort</a></span>((<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a id="141879">e1</a></span>,<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a id="141880">e2</a></span>) =&gt; (<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141879">e1</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(java.lang.String)Int</span><a id="5836">compareTo</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141880">e2</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span>) <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
	    <span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Unit)Unit</span><span id="21366"><a id="141885">edge</a></span></span> &lt;- <span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141859">sanity</a></span>) {
	      <span class="typed"><span class="type">java.lang.String</span><a href="#141873">msg</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141885">edge</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;, &quot;)</span><span class="string">&quot;, &quot;</span></span>
	    }
	    <span class="typed"><span class="type">java.lang.String</span><a href="#141873">msg</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;\012Re-run with -Xgenerate-phase-graph &lt;filename&gt; to better see the problem.&quot;)</span><span class="string">&quot;\nRe-run with -Xgenerate-phase-graph &lt;filename&gt; to better see the problem.&quot;</span></span>
	    <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.tools.nsc.FatalError</span><a href="FatalError.scala.html#6270">FatalError</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#141873">msg</a></span>)
	    
	  } <span class="keyword">else</span> {
	    
	    <span class="keyword">var</span> <span class="typed"><span class="type">Iterable[DependencyGraph.this.Edge]</span><a id="141894">promote</a></span> = <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141858">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Boolean)Iterable[DependencyGraph.this.Edge]</span><a id="21786">filter</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a id="141896">e</a></span> =&gt; (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141896">e</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#141646">hard</a></span>))
	    <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141858">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span>.<span class="typed"><span class="type">()Unit</span><a id="25501">clear</a></span>
	    <span class="typed"><span class="type">List[DependencyGraph.this.Edge]</span><a href="#141859">sanity</a></span> <span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Unit)Unit</span><a id="21366">foreach</a></span> (<span class="typed"><span class="type">DependencyGraph.this.Edge</span><a id="141900">edge</a></span> =&gt; <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141858">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141900">edge</a></span>)
	    <span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Unit)Unit</span><span id="21792"><a id="141904">edge</a></span></span> &lt;- <span class="typed"><span class="type">Iterable[DependencyGraph.this.Edge]</span><a href="#141894">promote</a></span>) {
	      <span class="typed"><span class="type">Boolean</span><a href="#141847">rerun</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
	      <span class="typed"><span class="type">(String)Unit</span><a href="Global.scala.html#21203">informProgress</a></span>(
                <span class="typed"><span class="type">java.lang.String(&quot;promote the dependency of &quot;)</span><span class="string">&quot;promote the dependency of &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141904">edge</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span>
                <span class="typed"><span class="type">java.lang.String(&quot;: &quot;)</span><span class="string">&quot;: &quot;</span></span>  <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141904">edge</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; =&gt; &quot;)</span><span class="string">&quot; =&gt; &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141858">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span>)
	      <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141904">edge</a></span>.<span class="typed"><span class="type">(DependencyGraph.this.Node)Unit</span><a href="#141644">to</a></span> = <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141858">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>
	      <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141858">hl</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141904">edge</a></span>
	    }
	  }
	}
      }
    }

    <span class="comment">/** Remove all nodes in the given graph, that have no phase object
     *  Make sure to clean up all edges when removing the node object
     *  &lt;code&gt;Inform&lt;/code&gt; with warnings, if an external phase has a
     *  dependency on something that is dropped.
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="141635">removeDanglingNodes</a></span>() {
      <span class="keyword">var</span> <span class="typed"><span class="type">Iterator[DependencyGraph.this.Node]</span><a id="141907">dnodes</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><a href="#141624">nodes</a></span>.<span class="typed"><span class="type">=&gt; Iterator[DependencyGraph.this.Node]</span><a id="24244">values</a></span>.<span class="typed"><span class="type">((DependencyGraph.this.Node) =&gt; Boolean)Iterator[DependencyGraph.this.Node]</span><a id="32193">filter</a></span>(<span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141909">_</a></span>.<span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>)
      <span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Node) =&gt; Unit)Unit</span><span id="32202"><a id="141911">node</a></span></span> &lt;- <span class="typed"><span class="type">Iterator[DependencyGraph.this.Node]</span><a href="#141907">dnodes</a></span>) {
	<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="141912">msg</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;dropping dependency on node with no phase object: &quot;)</span><span class="string">&quot;dropping dependency on node with no phase object: &quot;</span></span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span><span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141911">node</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span>
        <span class="typed"><span class="type">(String)Unit</span><a href="Global.scala.html#21203">informProgress</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#141912">msg</a></span>)
	<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,DependencyGraph.this.Node]</span><a href="#141624">nodes</a></span> <span class="typed"><span class="type">(String)Unit</span><a id="24167">-=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141911">node</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span>
	<span class="keyword">for</span> (<span class="typed"><span class="type">((DependencyGraph.this.Edge) =&gt; Unit)Unit</span><span id="21792"><a id="141915">edge</a></span></span> &lt;- <span class="typed"><span class="type">DependencyGraph.this.Node</span><a href="#141911">node</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141667">before</a></span>) {
	  <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141626">edges</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25500">-=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141915">edge</a></span>
	  <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141915">edge</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[DependencyGraph.this.Edge]</span><a href="#141665">after</a></span> <span class="typed"><span class="type">(DependencyGraph.this.Edge)Unit</span><a id="25500">-=</a></span> <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141915">edge</a></span>
	  <span class="typed"><span class="type">DependencyGraph.this.Edge</span><a href="#141915">edge</a></span>.<span class="typed"><span class="type">=&gt; DependencyGraph.this.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
	    <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a id="141919">lsc</a></span>) =&gt; <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span> <span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a href="#141919">lsc</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.SubComponent</span><a id="21332">head</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="SubComponent.scala.html#29455">internal</a></span>) <span class="typed"><span class="type">(String)Unit</span><a href="Global.scala.html#21198">warning</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#141912">msg</a></span>)
	    <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _ =&gt; 
	  }
	}
      }
    }
    
  }

  <span class="comment">/* Method called from computePhaseDescriptors in class Global
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()List[scala.tools.nsc.SubComponent]</span><a id="22590">buildCompilerFromPhasesSet</a></span>(): <span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a id="526">List</a></span>[SubComponent] = {

    <span class="comment">// Add all phases in the set to the graph  </span>
    <span class="keyword">val</span> <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a id="141920">graph</a></span> = <span class="typed"><span class="type">(scala.collection.mutable.HashSet[scala.tools.nsc.SubComponent])PhaseAssembly.this.DependencyGraph</span><a href="#22591">phasesSetToDepGraph</a></span>(<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[scala.tools.nsc.SubComponent]</span><a href="Global.scala.html#21298">phasesSet</a></span>)

    <span class="comment">// Output the phase dependency graph at this stage</span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30008">genPhaseGraph</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting#T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
      <span class="typed"><span class="type">(PhaseAssembly.this.DependencyGraph,String)Unit</span><a href="#22592">graphToDotFile</a></span>(<span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141920">graph</a></span>, <span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30008">genPhaseGraph</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting#T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;1.dot&quot;)</span><span class="string">&quot;1.dot&quot;</span></span>)

    <span class="comment">// Remove nodes without phaseobj</span>
    <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141920">graph</a></span>.<span class="typed"><span class="type">()Unit</span><a href="#141635">removeDanglingNodes</a></span>() 

    <span class="comment">// Output the phase dependency graph at this stage</span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30008">genPhaseGraph</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting#T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
      <span class="typed"><span class="type">(PhaseAssembly.this.DependencyGraph,String)Unit</span><a href="#22592">graphToDotFile</a></span>(<span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141920">graph</a></span>, <span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30008">genPhaseGraph</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting#T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;2.dot&quot;)</span><span class="string">&quot;2.dot&quot;</span></span>)

    <span class="comment">// Validate and Enforce hardlinks / runsRightAfter and promote nodes down the tree    </span>
    <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141920">graph</a></span>.<span class="typed"><span class="type">()Unit</span><a href="#141634">validateAndEnforceHardlinks</a></span>()

    <span class="comment">// Output the phase dependency graph at this stage</span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30008">genPhaseGraph</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting#T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
      <span class="typed"><span class="type">(PhaseAssembly.this.DependencyGraph,String)Unit</span><a href="#22592">graphToDotFile</a></span>(<span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141920">graph</a></span>, <span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30008">genPhaseGraph</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting#T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;3.dot&quot;)</span><span class="string">&quot;3.dot&quot;</span></span>)

    <span class="comment">// test for cycles, assign levels and collapse hard links into nodes</span>
    <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141920">graph</a></span>.<span class="typed"><span class="type">(graph.Node,Int)Unit</span><a href="#141633">collapseHardLinksAndLevels</a></span>(<span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141920">graph</a></span>.<span class="typed"><span class="type">(String)graph.Node</span><a href="#141629">getNodeByPhase</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;parser&quot;)</span><span class="string">&quot;parser&quot;</span></span>), <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)

    <span class="comment">// Output the phase dependency graph at this stage</span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30008">genPhaseGraph</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting#T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
      <span class="typed"><span class="type">(PhaseAssembly.this.DependencyGraph,String)Unit</span><a href="#22592">graphToDotFile</a></span>(<span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141920">graph</a></span>, <span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="Global.scala.html#21157">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a href="Settings.scala.html#30008">genPhaseGraph</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting#T</span><a href="Settings.scala.html#30301">value</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;4.dot&quot;)</span><span class="string">&quot;4.dot&quot;</span></span>)
    
    <span class="comment">// assemble the compiler</span>
    <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141920">graph</a></span>.<span class="typed"><span class="type">()List[scala.tools.nsc.SubComponent]</span><a href="#141632">compilerPhaseList</a></span>()
  }

  <span class="comment">/** Given the phases set, will build a dependency graph from the phases set
   *  Using the aux. method of the DependencyGraph to create nodes and egdes.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(scala.collection.mutable.HashSet[scala.tools.nsc.SubComponent])PhaseAssembly.this.DependencyGraph</span><a id="22591">phasesSetToDepGraph</a></span>(<span class="typed"><span class="type">scala.collection.mutable.HashSet[scala.tools.nsc.SubComponent]</span><a id="141921">phsSet</a></span>: <span class="typed"><span class="type">scala.collection.mutable.HashSet[scala.tools.nsc.SubComponent]</span><a id="19895">HashSet</a></span>[SubComponent]): <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#22589">DependencyGraph</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a id="141949">graph</a></span> = <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><span class="keyword">new</span></span> <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#22589">DependencyGraph</a></span>()

    <span class="keyword">for</span> (<span class="typed"><span class="type">((scala.tools.nsc.SubComponent) =&gt; Unit)Unit</span><span id="21792"><a id="141951">phs</a></span></span> &lt;- <span class="typed"><span class="type">scala.collection.mutable.HashSet[scala.tools.nsc.SubComponent]</span><a href="#141921">phsSet</a></span>) {
      
      <span class="keyword">var</span> <span class="typed"><span class="type">graph.Node</span><a id="141952">fromnode</a></span> = <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141949">graph</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.SubComponent)graph.Node</span><a href="#141628">getNodeByPhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a href="#141951">phs</a></span>)
      
      <span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a href="#141951">phs</a></span>.<span class="typed"><span class="type">=&gt; Option[String]</span><a href="SubComponent.scala.html#29454">runsRightAfter</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
	<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt;
	  <span class="keyword">for</span> (<span class="typed"><span class="type">((String) =&gt; Unit)Unit</span><span id="21366"><a id="141955">phsname</a></span></span> &lt;- <span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a href="#141951">phs</a></span>.<span class="typed"><span class="type">=&gt; List[String]</span><a href="SubComponent.scala.html#29451">runsAfter</a></span>) {
	    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#141955">phsname</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;terminal&quot;)</span><span class="string">&quot;terminal&quot;</span></span>) {
	      <span class="keyword">val</span> <span class="typed"><span class="type">graph.Node</span><a id="141957">tonode</a></span> = <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141949">graph</a></span>.<span class="typed"><span class="type">(String)graph.Node</span><a href="#141629">getNodeByPhase</a></span>(<span class="typed"><span class="type">String</span><a href="#141955">phsname</a></span>)
	      <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141949">graph</a></span>.<span class="typed"><span class="type">(graph.Node,graph.Node)Unit</span><a href="#141630">softConnectNodes</a></span>(<span class="typed"><span class="type">graph.Node</span><a href="#141952">fromnode</a></span>, <span class="typed"><span class="type">graph.Node</span><a href="#141957">tonode</a></span>)
	    } <span class="keyword">else</span> {
	      <span class="typed"><span class="type">(String)Unit</span><a href="Global.scala.html#21197">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;[phase assembly, after dependency on terminal phase not allowed: &quot;)</span><span class="string">&quot;[phase assembly, after dependency on terminal phase not allowed: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Node</span><a href="#141952">fromnode</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; =&gt; &quot;)</span><span class="string">&quot; =&gt; &quot;</span></span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#141955">phsname</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;]&quot;)</span><span class="string">&quot;]&quot;</span></span>)	    
	    }
	  }
	  <span class="keyword">for</span> (<span class="typed"><span class="type">((String) =&gt; Unit)Unit</span><span id="21366"><a id="141960">phsname</a></span></span> &lt;- <span class="typed"><span class="type">scala.tools.nsc.SubComponent</span><a href="#141951">phs</a></span>.<span class="typed"><span class="type">=&gt; List[String]</span><a href="SubComponent.scala.html#29452">runsBefore</a></span>) {
	    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#141960">phsname</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;parser&quot;)</span><span class="string">&quot;parser&quot;</span></span>) {
	      <span class="keyword">val</span> <span class="typed"><span class="type">graph.Node</span><a id="141962">tonode</a></span> = <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141949">graph</a></span>.<span class="typed"><span class="type">(String)graph.Node</span><a href="#141629">getNodeByPhase</a></span>(<span class="typed"><span class="type">String</span><a href="#141960">phsname</a></span>)
	      <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141949">graph</a></span>.<span class="typed"><span class="type">(graph.Node,graph.Node)Unit</span><a href="#141630">softConnectNodes</a></span>(<span class="typed"><span class="type">graph.Node</span><a href="#141962">tonode</a></span>, <span class="typed"><span class="type">graph.Node</span><a href="#141952">fromnode</a></span>)
	    } <span class="keyword">else</span> {
	      <span class="typed"><span class="type">(String)Unit</span><a href="Global.scala.html#21197">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;[phase assembly, before dependency on parser phase not allowed: &quot;)</span><span class="string">&quot;[phase assembly, before dependency on parser phase not allowed: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#141960">phsname</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; =&gt; &quot;)</span><span class="string">&quot; =&gt; &quot;</span></span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Node</span><a href="#141952">fromnode</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;]&quot;)</span><span class="string">&quot;]&quot;</span></span>)	    
	    }
	  }
	<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">String</span><a id="141964">phsname</a></span>) =&gt;
	  <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#141964">phsname</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;terminal&quot;)</span><span class="string">&quot;terminal&quot;</span></span>) {
	    <span class="keyword">val</span> <span class="typed"><span class="type">graph.Node</span><a id="141966">tonode</a></span> = <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141949">graph</a></span>.<span class="typed"><span class="type">(String)graph.Node</span><a href="#141629">getNodeByPhase</a></span>(<span class="typed"><span class="type">String</span><a href="#141964">phsname</a></span>)
            <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141949">graph</a></span>.<span class="typed"><span class="type">(graph.Node,graph.Node)Unit</span><a href="#141631">hardConnectNodes</a></span>(<span class="typed"><span class="type">graph.Node</span><a href="#141952">fromnode</a></span>, <span class="typed"><span class="type">graph.Node</span><a href="#141966">tonode</a></span>)
	  } <span class="keyword">else</span> {
	    <span class="typed"><span class="type">(String)Unit</span><a href="Global.scala.html#21197">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;[phase assembly, right after dependency on terminal phase not allowed: &quot;)</span><span class="string">&quot;[phase assembly, right after dependency on terminal phase not allowed: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Node</span><a href="#141952">fromnode</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#141660">phasename</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; =&gt; &quot;)</span><span class="string">&quot; =&gt; &quot;</span></span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#141964">phsname</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;]&quot;)</span><span class="string">&quot;]&quot;</span></span>)
	  }
      }
    }
    <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141949">graph</a></span>
  }

  <span class="comment">/* This is a helper method, that given a dependency graph will generate a graphviz dot
   * file showing its structure.
   * Plug-in supplied phases are marked as green nodes and hard links are marked as blue edges.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(PhaseAssembly.this.DependencyGraph,String)Unit</span><a id="22592">graphToDotFile</a></span>(<span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a id="141926">graph</a></span>: <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#22589">DependencyGraph</a></span>, <span class="typed"><span class="type">String</span><a id="141927">filename</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) {
    <span class="keyword">var</span> <span class="typed"><span class="type">StringBuilder</span><a id="141968">sbuf</a></span> = <span class="typed"><span class="type">()StringBuilder</span><a id="23671" class="keyword">new</a></span> <span class="typed"><span class="type">StringBuilder</span><a id="1435">StringBuilder</a></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><a id="141969">extnodes</a></span> = <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><a id="19895">HashSet</a></span>[graph.Node]()
    <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><a id="141970">fatnodes</a></span> = <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><a id="19895">HashSet</a></span>[graph.Node]()
    <span class="typed"><span class="type">StringBuilder</span><a href="#141968">sbuf</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;digraph G {\012&quot;)</span><span class="string">&quot;digraph G {\n&quot;</span></span>)
    <span class="keyword">for</span> (<span class="typed"><span class="type">((graph.Edge) =&gt; Unit)Unit</span><span id="21792"><a id="141978">edge</a></span></span> &lt;- <span class="typed"><span class="type">PhaseAssembly.this.DependencyGraph</span><a href="#141926">graph</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[graph.Edge]</span><a href="#141626">edges</a></span>) {
      <span class="typed"><span class="type">StringBuilder</span><a href="#141968">sbuf</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;&quot;)</span><span class="string">&quot;\&quot;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">()String</span><a href="#141676">allPhaseNames</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;(&quot;)</span><span class="string">&quot;(&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#141673">level</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;)&quot;)</span><span class="string">&quot;)&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;-&gt;&quot;&quot;)</span><span class="string">&quot;\&quot;-&gt;\&quot;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">()String</span><a href="#141676">allPhaseNames</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;(&quot;)</span><span class="string">&quot;(&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#141673">level</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;)&quot;)</span><span class="string">&quot;)&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;&quot;)</span><span class="string">&quot;\&quot;&quot;</span></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span> <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span>.<span class="typed"><span class="type">=&gt; List[scala.tools.nsc.SubComponent]</span><a id="25408">get</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.SubComponent</span><a id="21650">first</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="SubComponent.scala.html#29455">internal</a></span>) {
       	<span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><a href="#141969">extnodes</a></span> <span class="typed"><span class="type">(graph.Node)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141640">frm</a></span>
      }
      <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141640">frm</a></span>.<span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span> <span class="typed"><span class="type">Any</span><span class="keyword">match</span></span> { <span class="typed"><span class="type">Null(null)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt; <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a id="141987">ln</a></span>) =&gt; <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a href="#141987">ln</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><a href="#141970">fatnodes</a></span> <span class="typed"><span class="type">(graph.Node)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141640">frm</a></span> }
      <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141643">to</a></span>.<span class="typed"><span class="type">=&gt; Option[List[scala.tools.nsc.SubComponent]]</span><a href="#141662">phaseobj</a></span> <span class="typed"><span class="type">Any</span><span class="keyword">match</span></span> { <span class="typed"><span class="type">Null(null)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt; <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a id="141997">ln</a></span>) =&gt; <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">List[scala.tools.nsc.SubComponent]</span><a href="#141997">ln</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><a href="#141970">fatnodes</a></span> <span class="typed"><span class="type">(graph.Node)Unit</span><a id="25499">+=</a></span> <span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; graph.Node</span><a href="#141643">to</a></span> }
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">graph.Edge</span><a href="#141978">edge</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#141646">hard</a></span>) {
	<span class="typed"><span class="type">StringBuilder</span><a href="#141968">sbuf</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">java.lang.String(&quot; [color=&quot;#0000ff&quot;]\012&quot;)</span><span class="string">&quot; [color=\&quot;#0000ff\&quot;]\n&quot;</span></span>)
      } <span class="keyword">else</span> {
	<span class="typed"><span class="type">StringBuilder</span><a href="#141968">sbuf</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">java.lang.String(&quot; [color=&quot;#000000&quot;]\012&quot;)</span><span class="string">&quot; [color=\&quot;#000000\&quot;]\n&quot;</span></span>)
      }
    }
    <span class="keyword">for</span> (<span class="typed"><span class="type">((graph.Node) =&gt; Unit)Unit</span><span id="21792"><a id="142012">node</a></span></span> &lt;- <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><a href="#141969">extnodes</a></span>) {
      <span class="typed"><span class="type">StringBuilder</span><a href="#141968">sbuf</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;&quot;)</span><span class="string">&quot;\&quot;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Node</span><a href="#142012">node</a></span>.<span class="typed"><span class="type">()String</span><a href="#141676">allPhaseNames</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;(&quot;)</span><span class="string">&quot;(&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Node</span><a href="#142012">node</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#141673">level</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;)&quot;)</span><span class="string">&quot;)&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot; [color=&quot;#00ff00&quot;]\012&quot;)</span><span class="string">&quot;\&quot; [color=\&quot;#00ff00\&quot;]\n&quot;</span></span>)
    }
    <span class="keyword">for</span> (<span class="typed"><span class="type">((graph.Node) =&gt; Unit)Unit</span><span id="21792"><a id="142016">node</a></span></span> &lt;- <span class="typed"><span class="type">scala.collection.mutable.HashSet[graph.Node]</span><a href="#141970">fatnodes</a></span>) {
      <span class="typed"><span class="type">StringBuilder</span><a href="#141968">sbuf</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;&quot;)</span><span class="string">&quot;\&quot;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Node</span><a href="#142016">node</a></span>.<span class="typed"><span class="type">()String</span><a href="#141676">allPhaseNames</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;(&quot;)</span><span class="string">&quot;(&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">graph.Node</span><a href="#142016">node</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#141673">level</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;)&quot;)</span><span class="string">&quot;)&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot; [color=&quot;#0000ff&quot;]\012&quot;)</span><span class="string">&quot;\&quot; [color=\&quot;#0000ff\&quot;]\n&quot;</span></span>)
    }
    <span class="typed"><span class="type">StringBuilder</span><a href="#141968">sbuf</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;}\012&quot;)</span><span class="string">&quot;}\n&quot;</span></span>)
    <span class="keyword">var</span> <span class="typed"><span class="type">java.io.BufferedWriter</span><a id="141971">out</a></span> = <span class="typed"><span class="type">java.io.BufferedWriter</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.BufferedWriter</span><a id="3807">BufferedWriter</a></span>(<span class="typed"><span class="type">java.io.FileWriter</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.FileWriter</span><a id="3624">FileWriter</a></span>(<span class="typed"><span class="type">String</span><a href="#141927">filename</a></span>))
    <span class="typed"><span class="type">java.io.BufferedWriter</span><a href="#141971">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28732">write</a></span>(<span class="typed"><span class="type">StringBuilder</span><a href="#141968">sbuf</a></span>.<span class="typed"><span class="type">()String</span><a id="23723">toString</a></span>)
    <span class="typed"><span class="type">java.io.BufferedWriter</span><a href="#141971">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="142028">flush</a></span>()
    <span class="typed"><span class="type">java.io.BufferedWriter</span><a href="#141971">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="142029">close</a></span>()
  }

}

        </pre>
    </body>
</html>