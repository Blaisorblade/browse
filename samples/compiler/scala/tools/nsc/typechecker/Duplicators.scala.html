<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/typechecker/Duplicators.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> typechecker

<span class="keyword">import</span> scala.tools.nsc.symtab.Flags

<span class="keyword">import</span> scala.collection.{mutable, immutable}

/** Duplicate trees and re-type check them, taking care to replace
 *  and create fresh symbols for new local definitions.
 */
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class Duplicators extends java.lang.Object with scala.tools.nsc.typechecker.Analyzer with ScalaObject" id="16395">Duplicators</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Analyzer.scala.html#17208" title="scala.tools.nsc.typechecker.Analyzer">Analyzer</a> {
  <span class="keyword">import</span> global._

  <span class="keyword">def</span> <a title="(context: Duplicators.this.Context,tree: Duplicators.this.global.Tree)Duplicators.this.global.Tree" id="257037">retyped</a>(<a title="Duplicators.this.Context" id="257061">context</a>: <a href="Contexts.scala.html#40053" title="Duplicators.this.Context">Context</a>, <a title="Duplicators.this.global.Tree" id="257062">tree</a>: <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a>): <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a> = {
    <a href="#257041" title="=&gt; Unit">resetClassOwners</a>
    (<span title="Duplicators.this.BodyDuplicator" class="keyword">new</span> <a href="#257054" title="Duplicators.this.BodyDuplicator">BodyDuplicator</a>(<a href="#257061" title="Duplicators.this.Context">context</a>)).<a href="Typers.scala.html#42872" title="(tree: Duplicators.this.global.Tree)Duplicators.this.global.Tree">typed</a>(<a href="#257062" title="Duplicators.this.global.Tree">tree</a>)
  }

  /** Retype the given tree in the given context. Use this method when retyping
   *  a method in a different class. The typer will replace references to the this of
   *  the old class with the new class, and map symbols through the given 'env'. The
   *  environment is a map from type skolems to concrete types (see SpecializedTypes).
   */
  <span class="keyword">def</span> <a title="(context: Duplicators.this.Context,tree: Duplicators.this.global.Tree,oldThis: Duplicators.this.global.Symbol,newThis: Duplicators.this.global.Symbol,env: scala.collection.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Type])Duplicators.this.global.Tree" id="257038">retyped</a>(<a title="Duplicators.this.Context" id="257105">context</a>: <a href="Contexts.scala.html#40053" title="Duplicators.this.Context">Context</a>, <a title="Duplicators.this.global.Tree" id="257106">tree</a>: <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a>, <a title="Duplicators.this.global.Symbol" id="257107">oldThis</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>, <a title="Duplicators.this.global.Symbol" id="257108">newThis</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>, <a title="scala.collection.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Type]" id="257109">env</a>: collection.<a title="scala.collection.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Type]" id="4225">Map</a>[Symbol, Type]): <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a> = {
    <span title="Unit" class="keyword">if</span> (<a href="#257107" title="(x$1: AnyRef)Boolean">oldThis</a> ne <a href="#257108" title="Duplicators.this.global.Symbol">newThis</a>) {
      <a href="#257043" title="(x$1: Duplicators.this.global.Symbol)Unit">oldClassOwner</a> = <a href="#257107" title="Duplicators.this.global.Symbol">oldThis</a>
      <a href="#257046" title="(x$1: Duplicators.this.global.Symbol)Unit">newClassOwner</a> = <a href="#257108" title="Duplicators.this.global.Symbol">newThis</a>
    } <span class="keyword">else</span> <a href="#257041" title="=&gt; Unit">resetClassOwners</a>

    <a href="#257049" title="(x$1: Duplicators.this.global.SubstTypeMap)Unit">envSubstitution</a> = <span title="Duplicators.this.SubstSkolemsTypeMap" class="keyword">new</span> <a href="#257051" title="Duplicators.this.SubstSkolemsTypeMap">SubstSkolemsTypeMap</a>(<a href="#257109" title="scala.collection.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Type]">env</a>.<a title="=&gt; Iterator[Duplicators.this.global.Symbol]" id="44696">keysIterator</a>.<span title="=&gt; List[Duplicators.this.global.Symbol]">toList</span>, <a href="#257109" title="scala.collection.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Type]">env</a>.<a title="=&gt; Iterator[Duplicators.this.global.Type]" id="44706">valuesIterator</a>.<span title="=&gt; List[Duplicators.this.global.Type]">toList</span>)
    <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;retyped with env: &quot;</span> + <a href="#257109" title="scala.collection.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Type]">env</a>)
    (<span title="Duplicators.this.BodyDuplicator" class="keyword">new</span> <a href="#257054" title="Duplicators.this.BodyDuplicator">BodyDuplicator</a>(<a href="#257105" title="Duplicators.this.Context">context</a>)).<a href="Typers.scala.html#42872" title="(tree: Duplicators.this.global.Tree)Duplicators.this.global.Tree">typed</a>(<a href="#257106" title="Duplicators.this.global.Tree">tree</a>)
  }

  <span class="keyword">def</span> <a title="(context: Duplicators.this.Context,tree: Duplicators.this.global.Tree,oldThis: Duplicators.this.global.Symbol,newThis: Duplicators.this.global.Symbol)Duplicators.this.global.Tree" id="257039">retypedMethod</a>(<a title="Duplicators.this.Context" id="257150">context</a>: <a href="Contexts.scala.html#40053" title="Duplicators.this.Context">Context</a>, <a title="Duplicators.this.global.Tree" id="257151">tree</a>: <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a>, <a title="Duplicators.this.global.Symbol" id="257152">oldThis</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>, <a title="Duplicators.this.global.Symbol" id="257153">newThis</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>): <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a> =
    (<span title="Duplicators.this.BodyDuplicator" class="keyword">new</span> <a href="#257054" title="Duplicators.this.BodyDuplicator">BodyDuplicator</a>(<a href="#257150" title="Duplicators.this.Context">context</a>)).<a href="#257074" title="(ddef: Duplicators.this.global.DefDef,oldThis: Duplicators.this.global.Symbol,newThis: Duplicators.this.global.Symbol)Duplicators.this.global.Tree">retypedMethod</a>(<a href="#257151" title="Duplicators.this.global.Tree">tree</a>.<span title="[T0]T0">asInstanceOf</span><span title="Duplicators.this.global.DefDef">[</span><a href="../ast/Trees.scala.html#26785" title="Duplicators.this.global.DefDef">DefDef</a>], <a href="#257152" title="Duplicators.this.global.Symbol">oldThis</a>, <a href="#257153" title="Duplicators.this.global.Symbol">newThis</a>)

  /** Return the special typer for duplicate method bodies. */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(context: Duplicators.this.Context)Duplicators.this.Typer" id="257040">newTyper</a>(<a title="Duplicators.this.Context" id="257163">context</a>: <a href="Contexts.scala.html#40053" title="Duplicators.this.Context">Context</a>): <a href="Typers.scala.html#40153" title="Duplicators.this.Typer">Typer</a> = 
    <span title="Duplicators.this.BodyDuplicator" class="keyword">new</span> <a href="#257054" title="Duplicators.this.BodyDuplicator">BodyDuplicator</a>(<a href="#257163" title="Duplicators.this.Context">context</a>)

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="257041">resetClassOwners</a> {
    <a href="#257043" title="(x$1: Duplicators.this.global.Symbol)Unit">oldClassOwner</a> = <span title="Null(null)" class="keyword">null</span>
    <a href="#257046" title="(x$1: Duplicators.this.global.Symbol)Unit">newClassOwner</a> = <span title="Null(null)" class="keyword">null</span>
  }

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Duplicators.this.global.Symbol" id="257043">oldClassOwner</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a> = _
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Duplicators.this.global.Symbol" id="257046">newClassOwner</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a> = _
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Duplicators.this.global.SubstTypeMap" id="257049">envSubstitution</a>: <a href="../symtab/Types.scala.html#26501" title="Duplicators.this.global.SubstTypeMap">SubstTypeMap</a> = _

  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class SubstSkolemsTypeMap extends Duplicators.this.global.SubstTypeMap with ScalaObject" id="257051">SubstSkolemsTypeMap</a><span title="ScalaObject">(</span><a title="List[Duplicators.this.global.Symbol]" id="257123">from</a>: <span title="List[Duplicators.this.global.Symbol]">List</span>[Symbol], <a title="List[Duplicators.this.global.Type]" id="257124">to</a>: <span title="List[Duplicators.this.global.Type]">List</span>[Type]) <span class="keyword">extends</span> <a href="../symtab/Types.scala.html#26501" title="Duplicators.this.global.SubstTypeMap">SubstTypeMap</a>(<a href="#257123" title="List[Duplicators.this.global.Symbol]">from</a>, <a href="#257124" title="List[Duplicators.this.global.Type]">to</a>) {
    <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="(sym1: Duplicators.this.global.Symbol,sym2: Duplicators.this.global.Symbol)Boolean" id="257122">matches</a>(<a title="Duplicators.this.global.Symbol" id="257179">sym1</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>, <a title="Duplicators.this.global.Symbol" id="257180">sym2</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>) = 
      <span title="Boolean" class="keyword">if</span> (<a href="#257180" title="Duplicators.this.global.Symbol">sym2</a>.<a href="../symtab/Symbols.scala.html#27084" title="=&gt; Boolean">isTypeSkolem</a>) <a href="#257180" title="Duplicators.this.global.Symbol">sym2</a>.<a href="../symtab/Symbols.scala.html#27230" title="(x$1: AnyRef)Boolean">deSkolemize</a> eq <a href="#257179" title="Duplicators.this.global.Symbol">sym1</a>
      <span class="keyword">else</span> <a href="#257179" title="(x$1: AnyRef)Boolean">sym1</a> eq <a href="#257180" title="Duplicators.this.global.Symbol">sym2</a>
  }

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Tree]" id="257052">invalidSyms</a>: mutable.<a title="scala.collection.mutable.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Tree]" id="24948">Map</a>[Symbol, Tree] = mutable.<a title="object scala.collection.mutable.HashMap" id="25114">HashMap</a>.<a title="[A, B]scala.collection.mutable.HashMap[A,B]" id="44632">empty</a><span title="scala.collection.mutable.HashMap[Duplicators.this.global.Symbol,Duplicators.this.global.Tree]">[</span><a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>, <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a>]
  
  /** A typer that creates new symbols for all definitions in the given tree
   *  and updates references to them while re-typechecking. All types in the 
   *  tree, except for TypeTrees, are erased prior to type checking. TypeTrees
   *  are fixed by substituting invalid symbols for the new ones.
   */
  <span class="keyword">class</span> <a title="class BodyDuplicator extends Duplicators.this.Typer with ScalaObject" id="257054">BodyDuplicator</a><span title="ScalaObject">(</span><a title="Duplicators.this.Context" id="257076">context</a>: <a href="Contexts.scala.html#40053" title="Duplicators.this.Context">Context</a>) <span class="keyword">extends</span> <a href="Typers.scala.html#40153" title="Duplicators.this.Typer">Typer</a>(<a href="#257076" title="Duplicators.this.Context">context</a>: <a href="Contexts.scala.html#40053" title="Duplicators.this.Context">Context</a>) {

    <span class="keyword">class</span> <a title="class FixInvalidSyms extends Duplicators.this.global.TypeMap with ScalaObject" id="257069">FixInvalidSyms</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../symtab/Types.scala.html#26479" title="Duplicators.this.global.TypeMap">TypeMap</a> {

      <span class="keyword">def</span> <a title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type" id="257211">apply</a>(<a title="Duplicators.this.global.Type" id="257216">tpe</a>: <a href="../symtab/Types.scala.html#26364" title="Duplicators.this.global.Type">Type</a>): <a href="../symtab/Types.scala.html#26364" title="Duplicators.this.global.Type">Type</a> = {
        <a href="#257212" title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type">mapOver</a>(<a href="#257216" title="Duplicators.this.global.Type">tpe</a>)
      }

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type" id="257212">mapOver</a>(<a title="Duplicators.this.global.Type" id="257219">tpe</a>: <a href="../symtab/Types.scala.html#26364" title="Duplicators.this.global.Type">Type</a>): <a href="../symtab/Types.scala.html#26364" title="Duplicators.this.global.Type">Type</a> = <a href="#257219" title="Duplicators.this.global.Type">tpe</a> <span title="Duplicators.this.global.Type" class="keyword">match</span> {
        <span title="Duplicators.this.global.Type" class="keyword">case</span> TypeRef(<a href="../symtab/Types.scala.html#26385" title="object Duplicators.this.global.NoPrefix">NoPrefix</a>, <a title="Duplicators.this.global.Symbol" id="257303">sym</a>, <a title="List[Duplicators.this.global.Type]" id="257304">args</a>) <span class="keyword">if</span> <a href="#257303" title="Duplicators.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#27083" title="=&gt; Boolean">isTypeParameterOrSkolem</a> =&gt;
          <span class="keyword">val</span> <a title="Duplicators.this.global.Symbol" id="257307">sym1</a> = <a href="#257076" title="Duplicators.this.Context">context</a>.<a href="Contexts.scala.html#48618" title="=&gt; Duplicators.this.global.Scope">scope</a>.<a href="../symtab/Scopes.scala.html#27297" title="(name: Duplicators.this.global.Name)Duplicators.this.global.Symbol">lookup</a>(<a href="#257303" title="Duplicators.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#27147" title="=&gt; Duplicators.this.global.Name">name</a>)
//          assert(sym1 ne NoSymbol, tpe)
          <span title="Duplicators.this.global.Type" class="keyword">if</span> (<span title="(x$1: Boolean)Boolean">(</span><a href="#257307" title="(x$1: AnyRef)Boolean">sym1</a> ne <a href="../symtab/Symbols.scala.html#26293" title="object Duplicators.this.global.NoSymbol">NoSymbol</a>) &amp;&amp; (<a href="#257307" title="(x$1: AnyRef)Boolean">sym1</a> ne <a href="#257303" title="Duplicators.this.global.Symbol">sym</a>)) {
            <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;fixing &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#257303" title="Duplicators.this.global.Symbol">sym</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span> + <a href="#257307" title="Duplicators.this.global.Symbol">sym1</a>)
            <a href="../symtab/Types.scala.html#26454" title="(pre: Duplicators.this.global.Type,sym: Duplicators.this.global.Symbol,args: List[Duplicators.this.global.Type])Duplicators.this.global.Type">typeRef</a>(<a href="../symtab/Types.scala.html#26385" title="object Duplicators.this.global.NoPrefix">NoPrefix</a>, <a href="#257307" title="Duplicators.this.global.Symbol">sym1</a>, <a href="../symtab/Types.scala.html#42955" title="(args: List[Duplicators.this.global.Type],tparams: List[Duplicators.this.global.Symbol])List[Duplicators.this.global.Type]">mapOverArgs</a>(<a href="#257304" title="List[Duplicators.this.global.Type]">args</a>, <a href="#257307" title="Duplicators.this.global.Symbol">sym1</a>.<a href="../symtab/Symbols.scala.html#27175" title="=&gt; List[Duplicators.this.global.Symbol]">typeParams</a>))
          } <span class="keyword">else</span> <span class="keyword">super</span>.<a href="../symtab/Types.scala.html#42954" title="(tp: Duplicators.this.global.Type)Duplicators.this.global.Type">mapOver</a>(<a href="#257219" title="Duplicators.this.global.Type">tpe</a>)

        <span title="Duplicators.this.global.Type" class="keyword">case</span> TypeRef(<a title="Duplicators.this.global.Type" id="257364">pre</a>, <a title="Duplicators.this.global.Symbol" id="257365">sym</a>, <a title="List[Duplicators.this.global.Type]" id="257366">args</a>) =&gt;
          <span class="keyword">val</span> <a title="Duplicators.this.global.Symbol" id="257369">newsym</a> = <a href="#257071" title="(sym: Duplicators.this.global.Symbol)Duplicators.this.global.Symbol">updateSym</a>(<a href="#257365" title="Duplicators.this.global.Symbol">sym</a>)
          <span title="Duplicators.this.global.Type" class="keyword">if</span> (<a href="#257369" title="(x$1: AnyRef)Boolean">newsym</a> ne <a href="#257365" title="Duplicators.this.global.Symbol">sym</a>) {
            <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;fixing &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#257365" title="Duplicators.this.global.Symbol">sym</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span> + <a href="#257369" title="Duplicators.this.global.Symbol">newsym</a>)
            <a href="../symtab/Types.scala.html#26454" title="(pre: Duplicators.this.global.Type,sym: Duplicators.this.global.Symbol,args: List[Duplicators.this.global.Type])Duplicators.this.global.Type">typeRef</a>(<a href="#257212" title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type">mapOver</a>(<a href="#257364" title="Duplicators.this.global.Type">pre</a>), <a href="#257369" title="Duplicators.this.global.Symbol">newsym</a>, <a href="../symtab/Types.scala.html#42955" title="(args: List[Duplicators.this.global.Type],tparams: List[Duplicators.this.global.Symbol])List[Duplicators.this.global.Type]">mapOverArgs</a>(<a href="#257366" title="List[Duplicators.this.global.Type]">args</a>, <a href="#257369" title="Duplicators.this.global.Symbol">newsym</a>.<a href="../symtab/Symbols.scala.html#27175" title="=&gt; List[Duplicators.this.global.Symbol]">typeParams</a>))
          } <span class="keyword">else</span> 
            <span class="keyword">super</span>.<a href="../symtab/Types.scala.html#42954" title="(tp: Duplicators.this.global.Type)Duplicators.this.global.Type">mapOver</a>(<a href="#257219" title="Duplicators.this.global.Type">tpe</a>)
        <span title="Duplicators.this.global.Type" class="keyword">case</span> _ =&gt;
          <span class="keyword">super</span>.<a href="../symtab/Types.scala.html#42954" title="(tp: Duplicators.this.global.Type)Duplicators.this.global.Type">mapOver</a>(<a href="#257219" title="Duplicators.this.global.Type">tpe</a>)
      }
    }
    
    /** Fix the given type by replacing invalid symbols with the new ones. */
    <span class="keyword">def</span> <a title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type" id="257070">fixType</a>(<a title="Duplicators.this.global.Type" id="257469">tpe</a>: <a href="../symtab/Types.scala.html#26364" title="Duplicators.this.global.Type">Type</a>): <a href="../symtab/Types.scala.html#26364" title="Duplicators.this.global.Type">Type</a> = {
      <span class="keyword">val</span> <a title="Duplicators.this.global.Type" id="257471">tpe1</a> = <a href="../symtab/Types.scala.html#117216" title="(tp0: Duplicators.this.global.Type)Duplicators.this.global.Type">envSubstitution</a>(<a href="#257469" title="Duplicators.this.global.Type">tpe</a>)
      <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;tpe1: &quot;</span> + <a href="#257471" title="Duplicators.this.global.Type">tpe1</a>)
      (<a href="#257211" title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type" class="keyword">new</a> <a href="#257069" title="BodyDuplicator.this.FixInvalidSyms">FixInvalidSyms</a>)(<a href="#257471" title="Duplicators.this.global.Type">tpe1</a>)
    }

    /** Return the new symbol corresponding to `sym'. */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: Duplicators.this.global.Symbol)Duplicators.this.global.Symbol" id="257071">updateSym</a>(<a title="Duplicators.this.global.Symbol" id="257370">sym</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>): <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a> =
      <span title="Duplicators.this.global.Symbol" class="keyword">if</span> (<a href="#257052" title="=&gt; scala.collection.mutable.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Tree]">invalidSyms</a>.<span title="(key: Duplicators.this.global.Symbol)Boolean">isDefinedAt</span>(<a href="#257370" title="Duplicators.this.global.Symbol">sym</a>)) 
        <a href="#257052" title="(key: Duplicators.this.global.Symbol)Duplicators.this.global.Tree" id="44676">invalidSyms</a>(<a href="#257370" title="Duplicators.this.global.Symbol">sym</a>).<a href="../ast/Trees.scala.html#29553" title="=&gt; Duplicators.this.global.Symbol">symbol</a>
      <span class="keyword">else</span>
        <a href="#257370" title="Duplicators.this.global.Symbol">sym</a>
      
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tree: Duplicators.this.global.Tree)Unit" id="257072">invalidate</a>(<a title="Duplicators.this.global.Tree" id="257522">tree</a>: <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a>) {
      <span title="Unit" class="keyword">if</span> (<a href="#257522" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29557" title="(x$1: Boolean)Boolean">isDef</a> &amp;&amp; <a href="#257522" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="(x$1: AnyRef)Boolean">symbol</a> != <a href="../symtab/Symbols.scala.html#26293" title="object Duplicators.this.global.NoSymbol">NoSymbol</a>) {
        <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;invalid &quot;</span> + <a href="#257522" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="=&gt; Duplicators.this.global.Symbol">symbol</a>)
        <a href="#257052" title="(key: Duplicators.this.global.Symbol,value: Duplicators.this.global.Tree)Unit">invalidSyms</a>(<a href="#257522" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="=&gt; Duplicators.this.global.Symbol">symbol</a>) = <a href="#257522" title="Duplicators.this.global.Tree">tree</a>

        <a href="#257522" title="Duplicators.this.global.Tree">tree</a> <span title="Unit" class="keyword">match</span> { 
          <span title="Unit" class="keyword">case</span> <a title="Duplicators.this.global.LabelDef" id="257541">ldef</a> @ LabelDef(<a title="Duplicators.this.global.Name" id="257547">name</a>, <a title="List[Duplicators.this.global.Ident]" id="257548">params</a>, <a title="Duplicators.this.global.Tree" id="257549">rhs</a>) =&gt;        
            <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;LabelDef &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#257547" title="Duplicators.this.global.Name">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; sym.info: &quot;)" class="string">&quot; sym.info: &quot;</span> + <a href="#257541" title="Duplicators.this.global.LabelDef">ldef</a>.<a href="../ast/Trees.scala.html#48738" title="=&gt; Duplicators.this.global.Symbol">symbol</a>.<a href="../symtab/Symbols.scala.html#27163" title="=&gt; Duplicators.this.global.Type">info</a>)
            <a href="#257052" title="(key: Duplicators.this.global.Symbol,value: Duplicators.this.global.Tree)Unit">invalidSyms</a>(<a href="#257541" title="Duplicators.this.global.LabelDef">ldef</a>.<a href="../ast/Trees.scala.html#48738" title="=&gt; Duplicators.this.global.Symbol">symbol</a>) = <a href="#257541" title="Duplicators.this.global.LabelDef">ldef</a>
          //          breakIf(true, this, ldef, context)
            <span class="keyword">val</span> <a title="Duplicators.this.global.Symbol" id="257552">newsym</a> = <a href="#257541" title="Duplicators.this.global.LabelDef">ldef</a>.<a href="../ast/Trees.scala.html#48738" title="=&gt; Duplicators.this.global.Symbol">symbol</a>.<a href="../symtab/Symbols.scala.html#27188" title="(owner: Duplicators.this.global.Symbol)Duplicators.this.global.Symbol">cloneSymbol</a>(<a href="#257076" title="Duplicators.this.Context">context</a>.<a href="Contexts.scala.html#48615" title="=&gt; Duplicators.this.global.Symbol">owner</a>)
            <a href="#257552" title="Duplicators.this.global.Symbol">newsym</a>.<a href="../symtab/Symbols.scala.html#27164" title="(info: Duplicators.this.global.Type)newsym.type">setInfo</a>(<a href="#257070" title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type">fixType</a>(<a href="#257541" title="Duplicators.this.global.LabelDef">ldef</a>.<a href="../ast/Trees.scala.html#48738" title="=&gt; Duplicators.this.global.Symbol">symbol</a>.<a href="../symtab/Symbols.scala.html#27163" title="=&gt; Duplicators.this.global.Type">info</a>))
            <a href="#257541" title="Duplicators.this.global.LabelDef">ldef</a>.<a href="../ast/Trees.scala.html#48739" title="(x$1: Duplicators.this.global.Symbol)Unit">symbol</a> = <a href="#257552" title="Duplicators.this.global.Symbol">newsym</a>
            <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;newsym: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#257552" title="Duplicators.this.global.Symbol">newsym</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; info: &quot;)" class="string">&quot; info: &quot;</span> + <a href="#257552" title="Duplicators.this.global.Symbol">newsym</a>.<a href="../symtab/Symbols.scala.html#27163" title="=&gt; Duplicators.this.global.Type">info</a>)

          <span title="Unit" class="keyword">case</span> DefDef(_, _, _, _, _, <a title="Duplicators.this.global.Tree" id="257597">rhs</a>) =&gt;
            // invalidate parameters
            <a href="#257073" title="(stats: List[Duplicators.this.global.Tree])Unit">invalidate</a>(<a href="#257522" title="Duplicators.this.global.Tree">tree</a>.<span title="[T0]T0">asInstanceOf</span><span title="Duplicators.this.global.DefDef">[</span><a href="../ast/Trees.scala.html#26785" title="Duplicators.this.global.DefDef">DefDef</a>].<a href="../ast/Trees.scala.html#52444" title="=&gt; List[Duplicators.this.global.TypeDef]">tparams</a>)
            <a href="#257073" title="(stats: List[Duplicators.this.global.Tree])Unit">invalidate</a>(<span title="object List">List</span>.<span title="(xss: List[List[Duplicators.this.global.ValDef]])List[Duplicators.this.global.ValDef]">flatten</span>(<a href="#257522" title="Duplicators.this.global.Tree">tree</a>.<span title="[T0]T0">asInstanceOf</span><span title="Duplicators.this.global.DefDef">[</span><a href="../ast/Trees.scala.html#26785" title="Duplicators.this.global.DefDef">DefDef</a>].<a href="../ast/Trees.scala.html#52446" title="=&gt; List[List[Duplicators.this.global.ValDef]]">vparamss</a>))
            <a href="#257522" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29554" title="(sym: Duplicators.this.global.Symbol)Unit">symbol</a> = <a href="../symtab/Symbols.scala.html#26293" title="object Duplicators.this.global.NoSymbol">NoSymbol</a>

          <span title="Unit" class="keyword">case</span> _ =&gt; 
            <a href="#257522" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29554" title="(sym: Duplicators.this.global.Symbol)Unit">symbol</a> = <a href="../symtab/Symbols.scala.html#26293" title="object Duplicators.this.global.NoSymbol">NoSymbol</a>
        }
      }
    }

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(stats: List[Duplicators.this.global.Tree])Unit" id="257073">invalidate</a>(<a title="List[Duplicators.this.global.Tree]" id="257603">stats</a>: <span title="List[Duplicators.this.global.Tree]">List</span>[Tree]) {
      <a href="#257603" title="(f: (Duplicators.this.global.Tree) =&gt; Unit)Unit">stats</a> foreach <a href="#257072" title="(tree: Duplicators.this.global.Tree)Unit">invalidate</a>
    }
      

    <span class="keyword">def</span> <a title="(ddef: Duplicators.this.global.DefDef,oldThis: Duplicators.this.global.Symbol,newThis: Duplicators.this.global.Symbol)Duplicators.this.global.Tree" id="257074">retypedMethod</a>(<a title="Duplicators.this.global.DefDef" id="257157">ddef</a>: <a href="../ast/Trees.scala.html#26785" title="Duplicators.this.global.DefDef">DefDef</a>, <a title="Duplicators.this.global.Symbol" id="257158">oldThis</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>, <a title="Duplicators.this.global.Symbol" id="257159">newThis</a>: <a href="../symtab/Symbols.scala.html#26286" title="Duplicators.this.global.Symbol">Symbol</a>): <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a> = {
      <a href="#257043" title="(x$1: Duplicators.this.global.Symbol)Unit">oldClassOwner</a> = <a href="#257158" title="Duplicators.this.global.Symbol">oldThis</a>
      <a href="#257046" title="(x$1: Duplicators.this.global.Symbol)Unit">newClassOwner</a> = <a href="#257159" title="Duplicators.this.global.Symbol">newThis</a>
      <a href="#257073" title="(stats: List[Duplicators.this.global.Tree])Unit">invalidate</a>(<a href="#257157" title="Duplicators.this.global.DefDef">ddef</a>.<a href="../ast/Trees.scala.html#52444" title="=&gt; List[Duplicators.this.global.TypeDef]">tparams</a>)
      <span class="keyword">for</span> (<a title="Duplicators.this.global.ValDef" id="257689">vdef</a> &lt;- <span title="object List">List</span>.<span title="(xss: List[List[Duplicators.this.global.ValDef]])List[Duplicators.this.global.ValDef]">flatten</span><span title="(f: (Duplicators.this.global.ValDef) =&gt; Unit)Unit">(</span><a href="#257157" title="Duplicators.this.global.DefDef">ddef</a>.<a href="../ast/Trees.scala.html#52446" title="=&gt; List[List[Duplicators.this.global.ValDef]]">vparamss</a>)) {
        <a href="#257072" title="(tree: Duplicators.this.global.Tree)Unit">invalidate</a>(<a href="#257689" title="Duplicators.this.global.ValDef">vdef</a>)
        <a href="#257689" title="Duplicators.this.global.ValDef">vdef</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <span title="Null(null)" class="keyword">null</span>
      }
      <a href="#257157" title="Duplicators.this.global.DefDef">ddef</a>.<a href="../ast/Trees.scala.html#48739" title="(x$1: Duplicators.this.global.Symbol)Unit">symbol</a> = <a href="../symtab/Symbols.scala.html#26293" title="object Duplicators.this.global.NoSymbol">NoSymbol</a>
      <a href="Typers.scala.html#42837" title="(txt: Duplicators.this.Context,tree: Duplicators.this.global.Tree)Duplicators.this.Context">enterSym</a>(<a href="#257076" title="Duplicators.this.Context">context</a>, <a href="#257157" title="Duplicators.this.global.DefDef">ddef</a>)
      <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;remapping this of &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#257043" title="=&gt; Duplicators.this.global.Symbol">oldClassOwner</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; to &quot;)" class="string">&quot; to &quot;</span> + <a href="#257046" title="=&gt; Duplicators.this.global.Symbol">newClassOwner</a>)
      <a href="Typers.scala.html#42872" title="(tree: Duplicators.this.global.Tree)Duplicators.this.global.Tree">typed</a>(<a href="#257157" title="Duplicators.this.global.DefDef">ddef</a>)
    }
    
    /** Special typer method allowing for re-type checking trees. It expects a typed tree.
     *  Returns a typed tree that has fresh symbols for all definitions in the original tree.
     *
     *  Each definition tree is visited and its symbol added to the invalidSyms map (except LabelDefs),
     *  then cleared (forcing the namer to create fresh symbols).
     *  All invalid symbols found in trees are cleared (except for LabelDefs), forcing the
     *  typechecker to look for fresh ones in the context.
     *
     *  Type trees are typed by substituting old symbols for new ones (@see fixType).
     *
     *  LabelDefs are not typable from trees alone, unless they have the type ()Unit. Therefore,
     *  their symbols are recreated ad-hoc and their types are fixed inline, instead of letting the
     *  namer/typer handle them, or Idents that refer to them.
     */
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree" id="257075">typed</a>(<a title="Duplicators.this.global.Tree" id="257080">tree</a>: <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a>, <a title="Int" id="257081">mode</a>: <a title="Int" id="2198">Int</a>, <a title="Duplicators.this.global.Type" id="257082">pt</a>: <a href="../symtab/Types.scala.html#26364" title="Duplicators.this.global.Type">Type</a>): <a href="../ast/Trees.scala.html#26752" title="Duplicators.this.global.Tree">Tree</a> = {
      <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;typing &quot;</span> + <a href="#257080" title="Duplicators.this.global.Tree">tree</a>)
      <span title="Unit" class="keyword">if</span> (<a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29556" title="(x$1: Boolean)Boolean">hasSymbol</a> <span title="(x$1: Boolean)Boolean">&amp;&amp;</span> <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="(x$1: AnyRef)Boolean">symbol</a> != <a href="../symtab/Symbols.scala.html#26293" title="object Duplicators.this.global.NoSymbol">NoSymbol</a> 
          <span title="(x$1: Boolean)Boolean">&amp;&amp;</span> <a title="=&gt; Boolean" id="2226">!</a><a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="=&gt; Duplicators.this.global.Symbol">symbol</a>.<a href="../symtab/Symbols.scala.html#27071" title="=&gt; Boolean">isLabel</a>  // labels cannot be retyped by the type checker as LabelDef has no ValDef/return type trees
          &amp;&amp; <a href="#257052" title="=&gt; scala.collection.mutable.Map[Duplicators.this.global.Symbol,Duplicators.this.global.Tree]">invalidSyms</a>.<span title="(key: Duplicators.this.global.Symbol)Boolean">isDefinedAt</span>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="=&gt; Duplicators.this.global.Symbol">symbol</a>)) {
        <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29554" title="(sym: Duplicators.this.global.Symbol)Unit">symbol</a> = <a href="../symtab/Symbols.scala.html#26293" title="object Duplicators.this.global.NoSymbol">NoSymbol</a>
      }

      <a href="#257080" title="Duplicators.this.global.Tree">tree</a> <span title="Duplicators.this.global.Tree" class="keyword">match</span> {
        <span title="Duplicators.this.global.TypeTree" class="keyword">case</span> <a title="Duplicators.this.global.TypeTree" id="257763">ttree</a> @ TypeTree() =&gt;
          <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;fixing tpe: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29549" title="=&gt; Duplicators.this.global.Type">tpe</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with sym: &quot;)" class="string">&quot; with sym: &quot;</span> + <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29549" title="=&gt; Duplicators.this.global.Type">tpe</a>.<a href="../symtab/Types.scala.html#30366" title="=&gt; Duplicators.this.global.Symbol">typeSymbol</a>)
          <a href="#257763" title="Duplicators.this.global.TypeTree">ttree</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <a href="#257070" title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type">fixType</a>(<a href="#257763" title="Duplicators.this.global.TypeTree">ttree</a>.<a href="../ast/Trees.scala.html#29549" title="=&gt; Duplicators.this.global.Type">tpe</a>)
          <a href="#257763" title="Duplicators.this.global.TypeTree">ttree</a>
        <span title="Duplicators.this.global.Tree" class="keyword">case</span> Block(<a title="List[Duplicators.this.global.Tree]" id="257783">stats</a>, <a title="Duplicators.this.global.Tree" id="257784">res</a>) =&gt;
          <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="java.lang.String(&quot;invalidating block&quot;)" class="string">&quot;invalidating block&quot;</span>)
          <a href="#257073" title="(stats: List[Duplicators.this.global.Tree])Unit">invalidate</a>(<a href="#257783" title="List[Duplicators.this.global.Tree]">stats</a>)
          <a href="#257072" title="(tree: Duplicators.this.global.Tree)Unit">invalidate</a>(<a href="#257784" title="Duplicators.this.global.Tree">res</a>)
          <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>, <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)
        
        <span title="Duplicators.this.global.Tree" class="keyword">case</span> ClassDef(_, _, _, <a title="Duplicators.this.global.Template" id="257834">tmpl</a> @ Template(<a title="List[Duplicators.this.global.Tree]" id="257840">parents</a>, _, <a title="List[Duplicators.this.global.Tree]" id="257841">stats</a>)) =&gt;
//          log(&quot;invalidating classdef &quot; + tree.tpe)
          <a href="#257834" title="Duplicators.this.global.Template">tmpl</a>.<a href="../ast/Trees.scala.html#48739" title="(x$1: Duplicators.this.global.Symbol)Unit">symbol</a> = <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="=&gt; Duplicators.this.global.Symbol">symbol</a>.<a href="../symtab/Symbols.scala.html#27025" title="(pos: scala.tools.nsc.util.Position)Duplicators.this.global.TermSymbol">newLocalDummy</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>)
          <a href="#257073" title="(stats: List[Duplicators.this.global.Tree])Unit">invalidate</a>(<a href="#257841" title="List[Duplicators.this.global.Tree]">stats</a>)
          <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>, <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)

        <span title="Duplicators.this.global.Tree" class="keyword">case</span> <a title="Duplicators.this.global.DefDef" id="257881">ddef</a> @ DefDef(_, _, _, _, <a title="Duplicators.this.global.Tree" id="257890">tpt</a>, <a title="Duplicators.this.global.Tree" id="257891">rhs</a>) =&gt;
          <a href="#257881" title="Duplicators.this.global.DefDef">ddef</a>.<a href="../ast/Trees.scala.html#52448" title="=&gt; Duplicators.this.global.Tree">tpt</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <a href="#257070" title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type">fixType</a>(<a href="#257881" title="Duplicators.this.global.DefDef">ddef</a>.<a href="../ast/Trees.scala.html#52448" title="=&gt; Duplicators.this.global.Tree">tpt</a>.<a href="../ast/Trees.scala.html#29549" title="=&gt; Duplicators.this.global.Type">tpe</a>)
          <a href="#257881" title="Duplicators.this.global.DefDef">ddef</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="#257881" title="Duplicators.this.global.DefDef">ddef</a>, <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)
          
        <span title="Duplicators.this.global.Tree" class="keyword">case</span> <a title="Duplicators.this.global.ValDef" id="257920">vdef</a> @ ValDef(_, _, <a title="Duplicators.this.global.Tree" id="257927">tpt</a>, <a title="Duplicators.this.global.Tree" id="257928">rhs</a>) =&gt;
//          log(&quot;vdef fixing tpe: &quot; + tree.tpe + &quot; with sym: &quot; + tree.tpe.typeSymbol + &quot; and &quot; + invalidSyms)
          <a href="#257920" title="Duplicators.this.global.ValDef">vdef</a>.<a href="../ast/Trees.scala.html#53783" title="=&gt; Duplicators.this.global.Tree">tpt</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <a href="#257070" title="(tpe: Duplicators.this.global.Type)Duplicators.this.global.Type">fixType</a>(<a href="#257920" title="Duplicators.this.global.ValDef">vdef</a>.<a href="../ast/Trees.scala.html#53783" title="=&gt; Duplicators.this.global.Tree">tpt</a>.<a href="../ast/Trees.scala.html#29549" title="=&gt; Duplicators.this.global.Type">tpe</a>)
          <a href="#257920" title="Duplicators.this.global.ValDef">vdef</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="#257920" title="Duplicators.this.global.ValDef">vdef</a>, <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)

        <span title="Duplicators.this.global.Tree" class="keyword">case</span> <a title="Duplicators.this.global.LabelDef" id="257957">ldef</a> @ LabelDef(<a title="Duplicators.this.global.Name" id="257963">name</a>, <a title="List[Duplicators.this.global.Ident]" id="257964">params</a>, <a title="Duplicators.this.global.Tree" id="257965">rhs</a>) =&gt;
          <a href="#257957" title="Duplicators.this.global.LabelDef">ldef</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">val</span> <a title="List[Duplicators.this.global.Ident]" id="257968">params1</a> = <a href="#257964" title="(f: (Duplicators.this.global.Ident) =&gt; Duplicators.this.global.Ident)(implicit bf: scala.collection.generic.BuilderFactory[Duplicators.this.global.Ident,List[Duplicators.this.global.Ident],List[Duplicators.this.global.Ident]])List[Duplicators.this.global.Ident]" id="25402">params</a> <a title="scala.collection.generic.BuilderFactory[Duplicators.this.global.Ident,List[Duplicators.this.global.Ident],List#Coll]" id="24472">map</a> { <a title="Duplicators.this.global.Ident" id="257980">p</a> =&gt; <a href="../ast/Trees.scala.html#26895" title="(sym: Duplicators.this.global.Symbol)Duplicators.this.global.Ident">Ident</a>(<a href="#257071" title="(sym: Duplicators.this.global.Symbol)Duplicators.this.global.Symbol">updateSym</a>(<a href="#257980" title="Duplicators.this.global.Ident">p</a>.<a href="../ast/Trees.scala.html#48738" title="=&gt; Duplicators.this.global.Symbol">symbol</a>)) }
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="../ast/Trees.scala.html#26743" title="=&gt; Duplicators.this.global.LazyTreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#48848" title="(tree: Duplicators.this.global.Tree,name: Duplicators.this.global.Name,params: List[Duplicators.this.global.Ident],rhs: Duplicators.this.global.Tree)Duplicators.this.global.LabelDef">LabelDef</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>, <a href="#257963" title="Duplicators.this.global.Name">name</a>, <a href="#257968" title="List[Duplicators.this.global.Ident]">params1</a>, <a href="#257965" title="Duplicators.this.global.Tree">rhs</a>), <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)

        <span title="Duplicators.this.global.Tree" class="keyword">case</span> Bind(<a title="Duplicators.this.global.Name" id="258118">name</a>, _) =&gt;
          <a href="#257072" title="(tree: Duplicators.this.global.Tree)Unit">invalidate</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>)
          <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>, <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)

        <span title="Duplicators.this.global.Tree" class="keyword">case</span> Ident(_) <span class="keyword">if</span> <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="=&gt; Duplicators.this.global.Symbol">symbol</a>.<a href="../symtab/Symbols.scala.html#27071" title="=&gt; Boolean">isLabel</a> =&gt;
          <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Ident to labeldef &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#257080" title="Duplicators.this.global.Tree">tree</a> + <span title="java.lang.String(&quot; switched to &quot;)" class="string">&quot; switched to &quot;</span>)
          <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29554" title="(sym: Duplicators.this.global.Symbol)Unit">symbol</a> = <a href="#257071" title="(sym: Duplicators.this.global.Symbol)Duplicators.this.global.Symbol">updateSym</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="=&gt; Duplicators.this.global.Symbol">symbol</a>)
          <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>, <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)

        <span title="Duplicators.this.global.Tree" class="keyword">case</span> Select(<a title="Duplicators.this.global.This" id="258190">th</a> @ This(_), <a title="Duplicators.this.global.Name" id="258196">sel</a>) <span class="keyword">if</span> <span title="(x$1: Boolean)Boolean">(</span><a href="#257043" title="(x$1: AnyRef)Boolean">oldClassOwner</a> ne <span title="Null(null)" class="keyword">null</span>) &amp;&amp; (<a href="#258190" title="Duplicators.this.global.This">th</a>.<a href="../ast/Trees.scala.html#48738" title="(x$1: AnyRef)Boolean">symbol</a> == <a href="#257043" title="=&gt; Duplicators.this.global.Symbol">oldClassOwner</a>) =&gt;
          <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="java.lang.String(&quot;selection on this, no type ascription required&quot;)" class="string">&quot;selection on this, no type ascription required&quot;</span>)
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="../ast/Trees.scala.html#26943" title="(pos: scala.tools.nsc.util.Position)(tree: Duplicators.this.global.Select)Duplicators.this.global.Select">atPos</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>)(<a href="../ast/Trees.scala.html#50528" title="(qualifier: Duplicators.this.global.Tree,name: Duplicators.this.global.Name)Duplicators.this.global.Select">Select</a>(<a href="../ast/Trees.scala.html#26886" title="(sym: Duplicators.this.global.Symbol)Duplicators.this.global.Tree">This</a>(<a href="#257046" title="=&gt; Duplicators.this.global.Symbol">newClassOwner</a>), <a href="#258196" title="Duplicators.this.global.Name">sel</a>)), <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)

        <span title="Duplicators.this.global.Tree" class="keyword">case</span> This(_) <span class="keyword">if</span> <span title="(x$1: Boolean)Boolean">(</span><a href="#257043" title="(x$1: AnyRef)Boolean">oldClassOwner</a> ne <span title="Null(null)" class="keyword">null</span>) &amp;&amp; (<a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="(x$1: AnyRef)Boolean">symbol</a> == <a href="#257043" title="=&gt; Duplicators.this.global.Symbol">oldClassOwner</a>) =&gt;
//          val tree1 = Typed(This(newClassOwner), TypeTree(fixType(tree.tpe.widen)))
          <span class="keyword">val</span> <a title="Duplicators.this.global.Tree" id="258316">tree1</a> = <a href="../ast/Trees.scala.html#26886" title="(sym: Duplicators.this.global.Symbol)Duplicators.this.global.Tree">This</a>(<a href="#257046" title="=&gt; Duplicators.this.global.Symbol">newClassOwner</a>)
          <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;mapped &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#257080" title="Duplicators.this.global.Tree">tree</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; to &quot;)" class="string">&quot; to &quot;</span> + <a href="#258316" title="Duplicators.this.global.Tree">tree1</a>)
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="../ast/Trees.scala.html#26943" title="(pos: scala.tools.nsc.util.Position)(tree: Duplicators.this.global.Tree)Duplicators.this.global.Tree">atPos</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>)(<a href="#258316" title="Duplicators.this.global.Tree">tree1</a>), <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)

        <span title="Duplicators.this.global.Tree" class="keyword">case</span> Super(<a title="Duplicators.this.global.Name" id="258375">qual</a>, <a title="Duplicators.this.global.Name" id="258376">mix</a>) <span class="keyword">if</span> <span title="(x$1: Boolean)Boolean">(</span><a href="#257043" title="(x$1: AnyRef)Boolean">oldClassOwner</a> ne <span title="Null(null)" class="keyword">null</span>) &amp;&amp; (<a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29553" title="(x$1: AnyRef)Boolean">symbol</a> == <a href="#257043" title="=&gt; Duplicators.this.global.Symbol">oldClassOwner</a>) =&gt;
          <span class="keyword">val</span> <a title="Duplicators.this.global.Super" id="258390">tree1</a> = <a href="../ast/Trees.scala.html#97892" title="(qual: Duplicators.this.global.Name,mix: Duplicators.this.global.Name)Duplicators.this.global.Super">Super</a>(<a href="#258375" title="Duplicators.this.global.Name">qual</a>, <a href="#258376" title="Duplicators.this.global.Name">mix</a>)
          <a href="../Global.scala.html#39300" title="(msg: AnyRef)Unit">log</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;changed &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#257080" title="Duplicators.this.global.Tree">tree</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; to &quot;)" class="string">&quot; to &quot;</span> + <a href="#258390" title="Duplicators.this.global.Super">tree1</a>)
          <span class="keyword">super</span>.<a href="Typers.scala.html#42872" title="(tree: Duplicators.this.global.Tree)Duplicators.this.global.Tree">typed</a>(<a href="../ast/Trees.scala.html#26943" title="(pos: scala.tools.nsc.util.Position)(tree: Duplicators.this.global.Super)Duplicators.this.global.Super">atPos</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29547" title="=&gt; scala.tools.nsc.util.Position">pos</a>)(<a href="#258390" title="Duplicators.this.global.Super">tree1</a>))

        <span title="Duplicators.this.global.Tree" class="keyword">case</span> _ =&gt;
          <a href="#257080" title="Duplicators.this.global.Tree">tree</a>.<a href="../ast/Trees.scala.html#29550" title="(t: Duplicators.this.global.Type)Unit">tpe</a> = <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">super</span>.<a href="Typers.scala.html#42869" title="(tree: Duplicators.this.global.Tree,mode: Int,pt: Duplicators.this.global.Type)Duplicators.this.global.Tree">typed</a>(<a href="#257080" title="Duplicators.this.global.Tree">tree</a>, <a href="#257081" title="Int">mode</a>, <a href="#257082" title="Duplicators.this.global.Type">pt</a>)
      }
    }
  }
}


        </pre>
    </body>
</html>