<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/nsc/typechecker/EtaExpansion.scala</title>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Martin Odersky
 */</span>
<span class="comment">// $Id: EtaExpansion.scala 16893 2009-01-13 13:09:22Z cunei $</span>

<span class="keyword">package</span> scala.tools.nsc.typechecker

<span class="keyword">import</span> scala.collection.mutable.ListBuffer
<span class="keyword">import</span> symtab.Flags._

<span class="comment">/** This trait ...
 *
 *  @author  Martin Odersky
 *  @version 1.0
 */</span>
<span class="keyword">trait</span> <span class="typed"><span class="type">trait EtaExpansion extends java.lang.Object with ScalaObject</span><a id="15848">EtaExpansion</a></span> { self: Analyzer =&gt;

  <span class="keyword">import</span> global._
  <span class="keyword">import</span> posAssigner.atPos

  <span class="keyword">object</span> <span class="typed"><span class="type">object EtaExpansion.this.etaExpansion</span><a id="28525">etaExpansion</a></span> {
    <span class="keyword">def</span> <span class="typed"><span class="type">(EtaExpansion.this.global.Tree)Option[(List[EtaExpansion.this.global.ValDef], EtaExpansion.this.global.Tree, List[EtaExpansion.this.global.Tree])]</span><a id="109003">unapply</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109005">tree</a></span>: <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">Option[(List[EtaExpansion.this.global.ValDef], EtaExpansion.this.global.Tree, List[EtaExpansion.this.global.Tree])]</span><a id="934">Option</a></span>[(List[ValDef], Tree, List[Tree])] = <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109005">tree</a></span> <span class="typed"><span class="type">Option[(List[EtaExpansion.this.global.ValDef], EtaExpansion.this.global.Tree, List[EtaExpansion.this.global.Tree])]</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">Some[(List[EtaExpansion.this.global.ValDef], EtaExpansion.this.global.Tree, List[EtaExpansion.this.global.Tree])]</span><span class="keyword">case</span></span> <a id="1">Function</a>(<span class="typed"><span class="type">List[EtaExpansion.this.global.ValDef]</span><a id="109006">vparams</a></span>, <a id="1">Apply</a>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109007">fn</a></span>, <span class="typed"><span class="type">List[EtaExpansion.this.global.Tree]</span><a id="109008">args</a></span>)) 
      <span class="keyword">if</span> (<span class="typed"><span class="type">object List</span><a id="527">List</a></span>.<span class="typed"><span class="type">(List[EtaExpansion.this.global.ValDef],List[EtaExpansion.this.global.Tree])((EtaExpansion.this.global.ValDef, EtaExpansion.this.global.Tree) =&gt; Boolean)Boolean</span><a id="21458">forall2</a></span>(<span class="typed"><span class="type">List[EtaExpansion.this.global.ValDef]</span><a href="#109006">vparams</a></span>, <span class="typed"><span class="type">List[EtaExpansion.this.global.Tree]</span><a href="#109008">args</a></span>) <span class="typed"><span class="type">Boolean</span><span id="23625"><a href="#109012" id="1379">{</a></span></span>
        <span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> <a id="1">(</a><span class="typed"><span class="type">EtaExpansion.this.global.ValDef</span><a id="109016">vparam</a></span>, <a id="1">Ident</a>(<span class="typed"><span class="type">EtaExpansion.this.global.Name</span><a id="109018">name</a></span>)) =&gt; <span class="typed"><span class="type">EtaExpansion.this.global.ValDef</span><a href="#109016">vparam</a></span>.<span class="typed"><span class="type">=&gt; EtaExpansion.this.global.Name</span><a href="../ast/Trees.scala.html#27180">name</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">EtaExpansion.this.global.Name</span><a href="#109018">name</a></span>
        <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">case</span></span> _ =&gt; <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
      }) =&gt; 
        <span class="typed"><span class="type">((List[EtaExpansion.this.global.ValDef], EtaExpansion.this.global.Tree, List[EtaExpansion.this.global.Tree]))Some[(List[EtaExpansion.this.global.ValDef], EtaExpansion.this.global.Tree, List[EtaExpansion.this.global.Tree])]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">(List[EtaExpansion.this.global.ValDef],EtaExpansion.this.global.Tree,List[EtaExpansion.this.global.Tree])(List[EtaExpansion.this.global.ValDef], EtaExpansion.this.global.Tree, List[EtaExpansion.this.global.Tree])</span><span id="23590"><a id="449">(</a></span></span><span class="typed"><span class="type">List[EtaExpansion.this.global.ValDef]</span><a href="#109006">vparams</a></span>, <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109007">fn</a></span>, <span class="typed"><span class="type">List[EtaExpansion.this.global.Tree]</span><a href="#109008">args</a></span>))
      <span class="typed"><span class="type">None.type</span><span class="keyword">case</span></span> _ =&gt;
        <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
    }
  }

  <span class="comment">/** &lt;p&gt;
   *    Expand partial function applications of type &lt;code&gt;type&lt;/code&gt;.
   *  &lt;/p&gt;&lt;pre&gt;
   *  p.f(es_1)...(es_n)
   *     ==&gt;  {
   *            &lt;b&gt;private synthetic val&lt;/b&gt; eta$f   = p.f   // if p is not stable
   *            ...
   *            &lt;b&gt;private synthetic val&lt;/b&gt; eta$e_i = e_i    // if e_i is not stable
   *            ...
   *            (ps_1 =&gt; ... =&gt; ps_m =&gt; eta$f([es_1])...([es_m])(ps_1)...(ps_m))
   *          }&lt;/pre&gt;
   *  &lt;p&gt;
   *    tree is already attributed
   *  &lt;/p&gt;
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(EtaExpansion.this.global.CompilationUnit,EtaExpansion.this.global.Tree)EtaExpansion.this.global.Tree</span><a id="28527">etaExpand</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.CompilationUnit</span><a id="109024">unit</a></span> : <span class="typed"><span class="type">EtaExpansion.this.global.CompilationUnit</span><a href="../CompilationUnits.scala.html#22571">CompilationUnit</a></span>, <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109025">tree</a></span>: <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">EtaExpansion.this.global.Type</span><a id="109026">tpe</a></span> = <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109025">tree</a></span>.<span class="typed"><span class="type">=&gt; EtaExpansion.this.global.Type</span><a href="../ast/Trees.scala.html#25354">tpe</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="109027">symbolHash</a></span> = <span class="typed"><span class="type">java.lang.String</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/SymbolTable.scala.html#21113">inIDE</a></span>) <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">object java.lang.Integer</span><a id="1784">Integer</a></span>.<span class="typed"><span class="type">(Int,Int)java.lang.String</span><a id="26734">toString</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109025">tree</a></span>.<span class="typed"><span class="type">=&gt; EtaExpansion.this.global.Symbol</span><a href="../ast/Trees.scala.html#25358">symbol</a></span>.<span class="typed"><span class="type">()Int</span><a id="5782">hashCode</a></span>, <span class="int">10</span> <span class="typed"><span class="type">Int(35)</span><span >+</span></span> (<span class="char">'z'</span> - <span class="char">'a'</span>)) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;$&quot;)</span><span class="string">&quot;$&quot;</span></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="109028">cnt</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span> <span class="comment">// for NoPosition</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.util.Position,Int)EtaExpansion.this.global.Name</span><a id="109029">freshName</a></span>(<span class="typed"><span class="type">scala.tools.nsc.util.Position</span><a id="109062">pos</a></span> : util.<span class="typed"><span class="type">scala.tools.nsc.util.Position</span><a href="../util/Position.scala.html#8480">Position</a></span>, <span class="typed"><span class="type">Int</span><a id="109063">n</a></span> : <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span>) = {
      <span class="typed"><span class="type">Int</span><a href="#109028">cnt</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
      <span class="typed"><span class="type">EtaExpansion.this.global.Name</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; Boolean</span><a href="../symtab/SymbolTable.scala.html#21113">inIDE</a></span>) {
        <span class="typed"><span class="type">(String)EtaExpansion.this.global.Name</span><a href="../symtab/Names.scala.html#21096">newTermName</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.CompilationUnit</span><a href="#109024">unit</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.FreshNameCreator</span><a href="../CompilationUnits.scala.html#24130">fresh</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.util.Position,String)String</span><a href="../util/FreshNameCreator.scala.html#48784">newName</a></span>(<span class="typed"><span class="type">scala.tools.nsc.util.Position</span><a href="#109062">pos</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;eta$&quot;)</span><span class="string">&quot;eta$&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> (<span class="typed"><span class="type">Int</span><a href="#109028">cnt</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;$&quot;)</span><span class="string">&quot;$&quot;</span></span>))
      } <span class="keyword">else</span> <span class="typed"><span class="type">EtaExpansion.this.global.Name</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.tools.nsc.util.Position</span><a href="#109062">pos</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> util.<span class="typed"><span class="type">object scala.tools.nsc.util.NoPosition</span><a href="../util/Position.scala.html#8304">NoPosition</a></span>) {
        <span class="comment">// nothing we can do, hope for no conflict!</span>
        <span class="typed"><span class="type">(String)EtaExpansion.this.global.Name</span><a href="../symtab/Names.scala.html#21096">newTermName</a></span>((<span class="typed"><span class="type">java.lang.String(&quot;eta$&quot;)</span><span class="string">&quot;eta$&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#109027">symbolHash</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> (<span class="typed"><span class="type">Int</span><a href="#109028">cnt</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)))
      } <span class="keyword">else</span> 
        <span class="typed"><span class="type">(String)EtaExpansion.this.global.Name</span><a href="../symtab/Names.scala.html#21096">newTermName</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.CompilationUnit</span><a href="#109024">unit</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.FreshNameCreator</span><a href="../CompilationUnits.scala.html#24130">fresh</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.util.Position,String)String</span><a href="../util/FreshNameCreator.scala.html#48784">newName</a></span>(<span class="typed"><span class="type">scala.tools.nsc.util.Position</span><a href="#109062">pos</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;eta$&quot;)</span><span class="string">&quot;eta$&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#109027">symbolHash</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> (<span class="typed"><span class="type">Int</span><a href="#109028">cnt</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;$&quot;)</span><span class="string">&quot;$&quot;</span></span>))
        <span class="comment">// Martin to Sean: I removed the </span>
        <span class="comment">// else if (n == 0) branch and changed `n' in the line above to `(cnt - 1)'</span>
        <span class="comment">// this was necessary because otherwise curried eta-expansions would get the same</span>
        <span class="comment">// symbol. An example which failes test/files/run/Course-2002-02.scala</span>
        <span class="comment">// todo: review and get rid of the `n' argument (which is unused right now).</span>
    }
    <span class="comment">// { cnt = cnt + 1; newTermName(&quot;eta$&quot; + cnt) }</span>
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[EtaExpansion.this.global.Tree]</span><a id="109030">defs</a></span> = <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[EtaExpansion.this.global.Tree]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[EtaExpansion.this.global.Tree]</span><a id="19925">ListBuffer</a></span>[Tree]

    <span class="comment">/** Append to &lt;code&gt;defs&lt;/code&gt; value definitions for all non-stable
     *  subexpressions of the function application &lt;code&gt;tree&lt;/code&gt;.
     *
     *  @param tree ...
     *  @return     ...
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(EtaExpansion.this.global.Tree)EtaExpansion.this.global.Tree</span><a id="109031">liftoutPrefix</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109115">tree</a></span>: <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> = {
      <span class="keyword">def</span> <span class="typed"><span class="type">(EtaExpansion.this.global.Tree)EtaExpansion.this.global.Tree</span><a id="109116">liftout</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109117">tree</a></span>: <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>): <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> =
        <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">object EtaExpansion.this.global.treeInfo</span><a href="../ast/Trees.scala.html#22360">treeInfo</a></span>.<span class="typed"><span class="type">(EtaExpansion.this.global.treeInfo.trees.Tree)Boolean</span><a href="../ast/TreeInfo.scala.html#42439">isPureExpr</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109117">tree</a></span>)) <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109117">tree</a></span>
        <span class="keyword">else</span> {
          <span class="keyword">val</span> <span class="typed"><span class="type">EtaExpansion.this.global.Name</span><a id="109118">vname</a></span>: <span class="typed"><span class="type">EtaExpansion.this.global.Name</span><a href="../symtab/Names.scala.html#21103">Name</a></span> = <span class="typed"><span class="type">(scala.tools.nsc.util.Position,Int)EtaExpansion.this.global.Name</span><a href="#109029">freshName</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109117">tree</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.Position</span><a href="../ast/Trees.scala.html#25352">pos</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
          <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[EtaExpansion.this.global.Tree]</span><a href="#109030">defs</a></span> <span class="typed"><span class="type">(EtaExpansion.this.global.Tree)Unit</span><a id="33306">+=</a></span> <span class="typed"><span class="type">(scala.tools.nsc.util.Position)(EtaExpansion.this.global.ValDef)EtaExpansion.this.global.ValDef</span><a href="../ast/Trees.scala.html#28572">atPos</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109117">tree</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.Position</span><a href="../ast/Trees.scala.html#25352">pos</a></span>)(<span class="typed"><span class="type">(EtaExpansion.this.global.Modifiers,EtaExpansion.this.global.Name,EtaExpansion.this.global.Tree,EtaExpansion.this.global.Tree)EtaExpansion.this.global.ValDef</span><a href="../ast/Trees.scala.html#31860">ValDef</a></span>(<span class="typed"><span class="type">(Long)EtaExpansion.this.global.Modifiers</span><a href="../ast/Trees.scala.html#22368">Modifiers</a></span>(<span class="typed"><span class="type">Long(2097152L)</span><span >SYNTHETIC</span></span>), <span class="typed"><span class="type">EtaExpansion.this.global.Name</span><a href="#109118">vname</a></span>, <span class="typed"><span class="type">()EtaExpansion.this.global.TypeTree</span><a href="../ast/Trees.scala.html#31097">TypeTree</a></span>(), <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109117">tree</a></span>))
          <span class="typed"><span class="type">(EtaExpansion.this.global.Name)EtaExpansion.this.global.Ident</span><a href="../ast/Trees.scala.html#30408">Ident</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Name</span><a href="#109118">vname</a></span>) <span class="typed"><span class="type">(scala.tools.nsc.util.Position)EtaExpansion.this.global.Ident</span><a href="../ast/Trees.scala.html#25356">setPos</a></span> <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109117">tree</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.Position</span><a href="../ast/Trees.scala.html#25352">pos</a></span>
        }
      <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109115">tree</a></span> <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">EtaExpansion.this.global.Apply</span><span class="keyword">case</span></span> <a id="1">Apply</a>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109131">fn</a></span>, <span class="typed"><span class="type">List[EtaExpansion.this.global.Tree]</span><a id="109132">args</a></span>) =&gt;
          <span class="typed"><span class="type">=&gt; EtaExpansion.this.global.LazyTreeCopier</span><a href="../ast/Trees.scala.html#22362">copy</a></span>.<span class="typed"><span class="type">(EtaExpansion.this.global.Tree,EtaExpansion.this.global.Tree,List[EtaExpansion.this.global.Tree])EtaExpansion.this.global.Apply</span><a href="../ast/Trees.scala.html#43631">Apply</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109115">tree</a></span>, <span class="typed"><span class="type">(EtaExpansion.this.global.Tree)EtaExpansion.this.global.Tree</span><a href="#109031">liftoutPrefix</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109131">fn</a></span>), <span class="typed"><span class="type">object List</span><a id="527">List</a></span>.<span class="typed"><span class="type">(List[EtaExpansion.this.global.Tree])((EtaExpansion.this.global.Tree) =&gt; EtaExpansion.this.global.Tree)List[EtaExpansion.this.global.Tree]</span><a id="21447">mapConserve</a></span>(<span class="typed"><span class="type">List[EtaExpansion.this.global.Tree]</span><a href="#109132">args</a></span>)(<span class="typed"><span class="type">(EtaExpansion.this.global.Tree)EtaExpansion.this.global.Tree</span><a href="#109116">liftout</a></span>)) <span class="typed"><span class="type">(EtaExpansion.this.global.Type)EtaExpansion.this.global.Apply</span><a href="../ast/Trees.scala.html#25357">setType</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
        <span class="typed"><span class="type">EtaExpansion.this.global.TypeApply</span><span class="keyword">case</span></span> <a id="1">TypeApply</a>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109138">fn</a></span>, <span class="typed"><span class="type">List[EtaExpansion.this.global.Tree]</span><a id="109139">args</a></span>) =&gt;
          <span class="typed"><span class="type">=&gt; EtaExpansion.this.global.LazyTreeCopier</span><a href="../ast/Trees.scala.html#22362">copy</a></span>.<span class="typed"><span class="type">(EtaExpansion.this.global.Tree,EtaExpansion.this.global.Tree,List[EtaExpansion.this.global.Tree])EtaExpansion.this.global.TypeApply</span><a href="../ast/Trees.scala.html#43630">TypeApply</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109115">tree</a></span>, <span class="typed"><span class="type">(EtaExpansion.this.global.Tree)EtaExpansion.this.global.Tree</span><a href="#109031">liftoutPrefix</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109138">fn</a></span>), <span class="typed"><span class="type">List[EtaExpansion.this.global.Tree]</span><a href="#109139">args</a></span>) <span class="typed"><span class="type">(EtaExpansion.this.global.Type)EtaExpansion.this.global.TypeApply</span><a href="../ast/Trees.scala.html#25357">setType</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
        <span class="typed"><span class="type">EtaExpansion.this.global.Select</span><span class="keyword">case</span></span> <a id="1">Select</a>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109143">qual</a></span>, <span class="typed"><span class="type">EtaExpansion.this.global.Name</span><a id="109144">name</a></span>) =&gt;
          <span class="typed"><span class="type">=&gt; EtaExpansion.this.global.LazyTreeCopier</span><a href="../ast/Trees.scala.html#22362">copy</a></span>.<span class="typed"><span class="type">(EtaExpansion.this.global.Tree,EtaExpansion.this.global.Tree,EtaExpansion.this.global.Name)EtaExpansion.this.global.Select</span><a href="../ast/Trees.scala.html#43635">Select</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109115">tree</a></span>, <span class="typed"><span class="type">(EtaExpansion.this.global.Tree)EtaExpansion.this.global.Tree</span><a href="#109116">liftout</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109143">qual</a></span>), <span class="typed"><span class="type">EtaExpansion.this.global.Name</span><a href="#109144">name</a></span>) <span class="typed"><span class="type">(EtaExpansion.this.global.Symbol)EtaExpansion.this.global.Select</span><a href="../ast/Trees.scala.html#25360">setSymbol</a></span> <span class="typed"><span class="type">object EtaExpansion.this.global.NoSymbol</span><a href="../symtab/Symbols.scala.html#21873">NoSymbol</a></span> <span class="typed"><span class="type">(EtaExpansion.this.global.Type)EtaExpansion.this.global.Select</span><a href="../ast/Trees.scala.html#25357">setType</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
        <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><span class="keyword">case</span></span> <a id="1">Ident</a>(<span class="typed"><span class="type">EtaExpansion.this.global.Name</span><a id="109150">name</a></span>) =&gt;
          <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109115">tree</a></span>
      }
    }

    <span class="comment">/** Eta-expand lifted tree.
     *
     *  @param tree ...
     *  @param tpe  ...
     *  @return     ...
     */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(EtaExpansion.this.global.Tree,EtaExpansion.this.global.Type)EtaExpansion.this.global.Tree</span><a id="109032">expand</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109151">tree</a></span>: <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span>, <span class="typed"><span class="type">EtaExpansion.this.global.Type</span><a id="109152">tpe</a></span>: <span class="typed"><span class="type">EtaExpansion.this.global.Type</span><a href="../symtab/Types.scala.html#21944">Type</a></span>): <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="../ast/Trees.scala.html#22371">Tree</a></span> = <span class="typed"><span class="type">EtaExpansion.this.global.Type</span><a href="#109152">tpe</a></span> <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><span class="keyword">case</span></span> <span class="typed"><span class="type">EtaExpansion.this.global.ImplicitMethodType</span><a id="109153">mt</a></span>: <span class="typed"><span class="type">EtaExpansion.this.global.ImplicitMethodType</span><a href="../symtab/Types.scala.html#21999">ImplicitMethodType</a></span> =&gt;
        <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109151">tree</a></span>
      <span class="typed"><span class="type">EtaExpansion.this.global.Function</span><span class="keyword">case</span></span> <a id="1">MethodType</a>(<span class="typed"><span class="type">List[EtaExpansion.this.global.Type]</span><a id="109154">formals</a></span>, <span class="typed"><span class="type">EtaExpansion.this.global.Type</span><a id="109155">restpe</a></span>) =&gt;
        <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="109156">cnt0</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
        <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Int</span><a id="109157">cnt</a></span> = {
          <span class="typed"><span class="type">Int</span><a href="#109156">cnt0</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3147">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
          <span class="typed"><span class="type">Int</span><a href="#109156">cnt0</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3148">-</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
        } 
        <span class="keyword">val</span> <span class="typed"><span class="type">List[EtaExpansion.this.global.ValDef]</span><a id="109158">params</a></span> = <span class="typed"><span class="type">List[EtaExpansion.this.global.Type]</span><a href="#109154">formals</a></span> <span class="typed"><span class="type">((EtaExpansion.this.global.Type) =&gt; EtaExpansion.this.global.ValDef)List[EtaExpansion.this.global.ValDef]</span><a id="21362">map</a></span> (<span class="typed"><span class="type">EtaExpansion.this.global.Type</span><a id="109184">formal</a></span> =&gt;
          <span class="typed"><span class="type">(EtaExpansion.this.global.Modifiers,EtaExpansion.this.global.Name,EtaExpansion.this.global.Tree,EtaExpansion.this.global.Tree)EtaExpansion.this.global.ValDef</span><a href="../ast/Trees.scala.html#31860">ValDef</a></span>(<span class="typed"><span class="type">(Long)EtaExpansion.this.global.Modifiers</span><a href="../ast/Trees.scala.html#22368">Modifiers</a></span>(SYNTHETIC <span class="typed"><span class="type">Long(2105344L)</span><span >|</span></span> PARAM), <span class="typed"><span class="type">(scala.tools.nsc.util.Position,Int)EtaExpansion.this.global.Name</span><a href="#109029">freshName</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109151">tree</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.Position</span><a href="../ast/Trees.scala.html#25352">pos</a></span>, <span class="typed"><span class="type">=&gt; Int</span><a href="#109157">cnt</a></span>), <span class="typed"><span class="type">(EtaExpansion.this.global.Type)EtaExpansion.this.global.TypeTree</span><a href="../ast/Trees.scala.html#22522">TypeTree</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Type</span><a href="#109184">formal</a></span>), <span class="typed"><span class="type">object EtaExpansion.this.global.EmptyTree</span><a href="../ast/Trees.scala.html#22380">EmptyTree</a></span>))
        <span class="typed"><span class="type">(scala.tools.nsc.util.Position)(EtaExpansion.this.global.Function)EtaExpansion.this.global.Function</span><a href="../ast/Trees.scala.html#28572">atPos</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109151">tree</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.Position</span><a href="../ast/Trees.scala.html#25352">pos</a></span>)(<span class="typed"><span class="type">(List[EtaExpansion.this.global.ValDef],EtaExpansion.this.global.Tree)EtaExpansion.this.global.Function</span><a href="../ast/Trees.scala.html#51065">Function</a></span>(<span class="typed"><span class="type">List[EtaExpansion.this.global.ValDef]</span><a href="#109158">params</a></span>, <span class="typed"><span class="type">(EtaExpansion.this.global.Tree,EtaExpansion.this.global.Type)EtaExpansion.this.global.Tree</span><a href="#109032">expand</a></span>(<span class="typed"><span class="type">(EtaExpansion.this.global.Tree,List[EtaExpansion.this.global.Tree])EtaExpansion.this.global.Apply</span><a href="../ast/Trees.scala.html#31199">Apply</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109151">tree</a></span>, <span class="typed"><span class="type">List[EtaExpansion.this.global.ValDef]</span><a href="#109158">params</a></span> <span class="typed"><span class="type">((EtaExpansion.this.global.ValDef) =&gt; Product with EtaExpansion.this.global.gen.global.Tree)List[Product with EtaExpansion.this.global.gen.global.Tree]</span><a id="21362">map</a></span> <span class="typed"><span class="type">object EtaExpansion.this.global.gen</span><a href="../Global.scala.html#21170">gen</a></span>.<span class="typed"><span class="type">(EtaExpansion.this.global.gen.global.ValDef)Product with EtaExpansion.this.global.gen.global.Tree</span><a href="../ast/TreeGen.scala.html#27633">paramToArg</a></span>), <span class="typed"><span class="type">EtaExpansion.this.global.Type</span><a href="#109155">restpe</a></span>)))
        <span class="comment">//atPos(tree.pos)(Function(params, expand(Apply(tree, args), restpe)))</span>
      <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><span class="keyword">case</span></span> _ =&gt;
        <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109151">tree</a></span>
    }

    <span class="keyword">val</span> <span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a id="109033">tree1</a></span> = <span class="typed"><span class="type">(EtaExpansion.this.global.Tree)EtaExpansion.this.global.Tree</span><a href="#109031">liftoutPrefix</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109025">tree</a></span>)
    <span class="typed"><span class="type">(scala.tools.nsc.util.Position)(EtaExpansion.this.global.Block)EtaExpansion.this.global.Block</span><a href="../ast/Trees.scala.html#28572">atPos</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109025">tree</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.util.Position</span><a href="../ast/Trees.scala.html#25352">pos</a></span>)(<span class="typed"><span class="type">(List[EtaExpansion.this.global.Tree],EtaExpansion.this.global.Tree)EtaExpansion.this.global.Block</span><a href="../ast/Trees.scala.html#42662">Block</a></span>(<span class="typed"><span class="type">scala.collection.mutable.ListBuffer[EtaExpansion.this.global.Tree]</span><a href="#109030">defs</a></span>.<span class="typed"><span class="type">=&gt; List[EtaExpansion.this.global.Tree]</span><a id="33309">toList</a></span>, <span class="typed"><span class="type">(EtaExpansion.this.global.Tree,EtaExpansion.this.global.Type)EtaExpansion.this.global.Tree</span><a href="#109032">expand</a></span>(<span class="typed"><span class="type">EtaExpansion.this.global.Tree</span><a href="#109033">tree1</a></span>, <span class="typed"><span class="type">EtaExpansion.this.global.Type</span><a href="#109026">tpe</a></span>)))
  }
}

        </pre>
    </body>
</html>