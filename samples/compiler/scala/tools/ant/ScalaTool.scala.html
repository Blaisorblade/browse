<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/ant/ScalaTool.scala</title>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala Ant Tasks                      **
**    / __/ __// _ | / /  / _ |    (c) 2005-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: ScalaTool.scala 16893 2009-01-13 13:09:22Z cunei $</span>

<span class="keyword">package</span> scala.tools.ant

<span class="keyword">import</span> java.io.{File, InputStream, FileWriter}

<span class="keyword">import</span> org.apache.tools.ant.BuildException
<span class="keyword">import</span> org.apache.tools.ant.taskdefs.MatchingTask
<span class="keyword">import</span> org.apache.tools.ant.types.{Path, Reference}

<span class="comment">/** &lt;p&gt;
 *    An Ant task that generates a shell or batch script to execute a
 *    Scala program.
 *    This task can take the following parameters as attributes:
 *  &lt;/p&gt;&lt;ul&gt;
 *  &lt;li&gt;file (mandatory),&lt;/li&gt;
 *  &lt;li&gt;class (mandatory),&lt;/li&gt;
 *  &lt;li&gt;platforms,&lt;/li&gt;
 *  &lt;li&gt;classpath,&lt;/li&gt;
 *  &lt;li&gt;properties,&lt;/li&gt;
 *  &lt;li&gt;javaflags,&lt;/li&gt;
 *  &lt;li&gt;toolflags.&lt;/li&gt;&lt;/ul&gt;
 *
 * @author  Gilles Dubochet
 * @version 1.1
 */</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class ScalaTool extends org.apache.tools.ant.taskdefs.MatchingTask with ScalaObject</span><a id="13744">ScalaTool</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">org.apache.tools.ant.taskdefs.MatchingTask</span><a id="44197">MatchingTask</a></span> {
  
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; org.apache.tools.ant.types.Path</span><a id="114942">emptyPath</a></span> = <span class="typed"><span class="type">(org.apache.tools.ant.Project)org.apache.tools.ant.types.Path</span><a id="45744" class="keyword">new</a></span> <span class="typed"><span class="type">org.apache.tools.ant.types.Path</span><a id="44918">Path</a></span>(<span class="typed"><span class="type">()org.apache.tools.ant.Project</span><a href="#13744" id="45414">getProject</a></span>)

<span class="comment">/*============================================================================*\
**                             Ant user-properties                            **
\*============================================================================*/</span>

  <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class PermissibleValue extends java.lang.Object with ScalaObject</span><a id="114943">PermissibleValue</a></span> {
    <span class="keyword">val</span> <span class="typed"><span class="type">=&gt; List[String]</span><a id="114997">values</a></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String]
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Boolean</span><a id="114998">isPermissible</a></span>(<span class="typed"><span class="type">String</span><a id="115000">value</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> =
      (<span class="typed"><span class="type">String</span><a href="#115000">value</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2750">||</a></span> <span class="typed"><span class="type">=&gt; List[String]</span><a href="#114997">values</a></span>.<span class="typed"><span class="type">((String) =&gt; Boolean)Boolean</span><a id="21373">exists</a></span>(<span class="typed"><span class="type">String</span><a href="#115003">_</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5841">startsWith</a></span>(<span class="typed"><span class="type">String</span><a href="#115000">value</a></span>))
  }

  <span class="comment">/** Defines valid values for the platforms property. */</span>
  <span class="keyword">object</span> <span class="typed"><span class="type">object ScalaTool.this.Platforms</span><a id="114944">Platforms</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">ScalaTool.this.PermissibleValue</span><a href="#114943">PermissibleValue</a></span> {
    <span class="keyword">val</span> <span class="typed"><span class="type">List[java.lang.String]</span><span id="115007"><a id="115006">values</a></span></span> = <span class="typed"><span class="type">(java.lang.String*)List[java.lang.String]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;unix&quot;)</span><span class="string">&quot;unix&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;windows&quot;)</span><span class="string">&quot;windows&quot;</span></span>)
  }

  <span class="comment">/** The path to the exec script file. &quot;.bat&quot; will be appended for the
    * Windows BAT file, if generated. */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[java.io.File]</span><span id="114948"><span id="114946"><span id="114947"><a id="114986">file</a></span></span></span></span>: <span class="typed"><span class="type">Option[java.io.File]</span><a id="934">Option</a></span>[File] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>

  <span class="comment">/** The main class to run. */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[String]</span><span id="114951"><span id="114949"><span id="114950"><a id="114987">mainClass</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>

  <span class="comment">/** Supported platforms for the script. Either &quot;unix&quot; or &quot;windows&quot;.
    * Defaults to both. */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">List[String]</span><span id="114954"><span id="114952"><span id="114953"><a id="114988">platforms</a></span></span></span></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String] = <span class="typed"><span class="type">(java.lang.String*)List[java.lang.String]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;unix&quot;)</span><span class="string">&quot;unix&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;windows&quot;)</span><span class="string">&quot;windows&quot;</span></span>)

  <span class="comment">/** An (optional) path to all JARs that this script depend on. Paths must be
    * relative to the scala home directory. If not set, all JAR archives and
    * folders in &quot;lib/&quot; are automatically added. */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[org.apache.tools.ant.types.Path]</span><span id="114957"><span id="114955"><span id="114956"><a id="114989">classpath</a></span></span></span></span>: <span class="typed"><span class="type">Option[org.apache.tools.ant.types.Path]</span><a id="934">Option</a></span>[Path] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>

  <span class="comment">/** Comma-separated Java system properties to pass to the JRE. Properties
    * are formated as name=value. Properties scala.home, scala.tool.name and
    * scala.tool.version are always set. */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">List[(String, String)]</span><span id="114960"><span id="114958"><span id="114959"><a id="114990">properties</a></span></span></span></span>: <span class="typed"><span class="type">List[(String, String)]</span><a id="526">List</a></span>[(String, String)] = <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>

  <span class="comment">/** Additional flags passed to the JRE (&quot;java [javaFlags] class&quot;). */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">String</span><span id="114963"><span id="114961"><span id="114962"><a id="114991">javaFlags</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>

  <span class="comment">/** Additional flags passed to the tool (&quot;java class [toolFlags]&quot;). Can only
    * be set when a main class is defined. */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">String</span><span id="114966"><span id="114964"><span id="114965"><a id="114992">toolFlags</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>

<span class="comment">/*============================================================================*\
**                             Properties setters                             **
\*============================================================================*/</span>

  <span class="comment">/** Sets the file attribute. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)Unit</span><a id="114967">setFile</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="115011">input</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) =
    <span class="typed"><span class="type">(Option[java.io.File])Unit</span><a href="#114947">file</a></span> = <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#115011">input</a></span>)

  <span class="comment">/** Sets the main class attribute. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="114968">setClass</a></span>(<span class="typed"><span class="type">String</span><a id="115014">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
    <span class="typed"><span class="type">(Option[String])Unit</span><a href="#114950">mainClass</a></span> = <span class="typed"><span class="type">(String)Some[String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#115014">input</a></span>)

  <span class="comment">/** Sets the platforms attribute. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="114969">setPlatforms</a></span>(<span class="typed"><span class="type">String</span><a id="115017">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = {
    <span class="typed"><span class="type">(List[String])Unit</span><a href="#114953">platforms</a></span> = <span class="typed"><span class="type">object List</span><a id="527">List</a></span>.<span class="typed"><span class="type">(Array[java.lang.String])List[java.lang.String]</span><a id="21440">fromArray</a></span>(<span class="typed"><span class="type">String</span><a href="#115017">input</a></span>.<span class="typed"><span class="type">(java.lang.String)Array[java.lang.String]</span><a id="5865">split</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;,&quot;)</span><span class="string">&quot;,&quot;</span></span>)).<span class="typed"><span class="type">((java.lang.String) =&gt; Iterable[String])List[String]</span><a id="21383">flatMap</a></span> { <span class="typed"><span class="type">String</span><a id="115027">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> =&gt;
      <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="115028">st</a></span> = <span class="typed"><span class="type">String</span><a href="#115027">s</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="5870">trim</a></span>
      <span class="typed"><span class="type">Iterable[String]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">object ScalaTool.this.Platforms</span><a href="#114944">Platforms</a></span>.<span class="typed"><span class="type">(String)Boolean</span><a href="#114998">isPermissible</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#115028">st</a></span>))
        (<span class="typed"><span class="type">Iterable[String]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#115017">input</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>) <span class="typed"><span class="type">(java.lang.String*)List[java.lang.String]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#115028">st</a></span>) <span class="keyword">else</span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>)
      <span class="keyword">else</span> {
        <span class="typed"><span class="type">(String)Nothing</span><a href="#114979">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Platform &quot;)</span><span class="string">&quot;Platform &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#115028">st</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; does not exist.&quot;)</span><span class="string">&quot; does not exist.&quot;</span></span>)
        <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>
      }
    }
  }

  <span class="comment">/** Sets the classpath with which to run the tool. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.types.Path)Unit</span><a id="114970">setClassPath</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.Path</span><a id="115032">input</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.Path</span><a id="44918">Path</a></span>): <span class="typed"><span class="type">Unit</span><a id="2169">Unit</a></span> =
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[org.apache.tools.ant.types.Path]</span><a href="#114955">classpath</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>)
      <span class="typed"><span class="type">(Option[org.apache.tools.ant.types.Path])Unit</span><a href="#114956">classpath</a></span> = <span class="typed"><span class="type">(org.apache.tools.ant.types.Path)Some[org.apache.tools.ant.types.Path]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.Path</span><a href="#115032">input</a></span>)
    <span class="keyword">else</span>
      <span class="typed"><span class="type">=&gt; Option[org.apache.tools.ant.types.Path]</span><a href="#114955">classpath</a></span>.<span class="typed"><span class="type">=&gt; org.apache.tools.ant.types.Path</span><a id="25408">get</a></span>.<span class="typed"><span class="type">(org.apache.tools.ant.types.Path)Unit</span><a id="45758">append</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.Path</span><a href="#115032">input</a></span>)
  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; org.apache.tools.ant.types.Path</span><a id="114971">createClassPath</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.Path</span><a id="44918">Path</a></span> = {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[org.apache.tools.ant.types.Path]</span><a href="#114955">classpath</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(Option[org.apache.tools.ant.types.Path])Unit</span><a href="#114956">classpath</a></span> = <span class="typed"><span class="type">(org.apache.tools.ant.types.Path)Some[org.apache.tools.ant.types.Path]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">=&gt; org.apache.tools.ant.types.Path</span><a href="#114942">emptyPath</a></span>)
    <span class="typed"><span class="type">=&gt; Option[org.apache.tools.ant.types.Path]</span><a href="#114955">classpath</a></span>.<span class="typed"><span class="type">=&gt; org.apache.tools.ant.types.Path</span><a id="25408">get</a></span>.<span class="typed"><span class="type">()org.apache.tools.ant.types.Path</span><a id="45757">createPath</a></span>()
  }
  <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.types.Reference)Unit</span><a id="114972">setClassPathRef</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.Reference</span><a id="115044">input</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.Reference</span><a id="44984">Reference</a></span>): <span class="typed"><span class="type">Unit</span><a id="2169">Unit</a></span> =
    <span class="typed"><span class="type">=&gt; org.apache.tools.ant.types.Path</span><a href="#114971">createClassPath</a></span>.<span class="typed"><span class="type">(org.apache.tools.ant.types.Reference)Unit</span><a id="45747">setRefid</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.Reference</span><a href="#115044">input</a></span>)

  <span class="comment">/** Sets JVM properties that will be set whilst running the tool. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="114973">setProperties</a></span>(<span class="typed"><span class="type">String</span><a id="115046">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = {
    <span class="typed"><span class="type">(List[(String, String)])Unit</span><a href="#114959">properties</a></span> = <span class="typed"><span class="type">object List</span><a id="527">List</a></span>.<span class="typed"><span class="type">(Array[java.lang.String])List[java.lang.String]</span><a id="21440">fromArray</a></span>(<span class="typed"><span class="type">String</span><a href="#115046">input</a></span>.<span class="typed"><span class="type">(java.lang.String)Array[java.lang.String]</span><a id="5865">split</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;,&quot;)</span><span class="string">&quot;,&quot;</span></span>)).<span class="typed"><span class="type">((java.lang.String) =&gt; Iterable[(String, String)])List[(String, String)]</span><a id="21383">flatMap</a></span> { <span class="typed"><span class="type">String</span><a id="115056">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> =&gt;
      <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="115057">st</a></span> = <span class="typed"><span class="type">String</span><a href="#115056">s</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="5870">trim</a></span>
      <span class="keyword">val</span> <span class="typed"><span class="type">Array[java.lang.String]</span><a id="115058">stArray</a></span> = <span class="typed"><span class="type">java.lang.String</span><a href="#115057">st</a></span>.<span class="typed"><span class="type">(java.lang.String,Int)Array[java.lang.String]</span><a id="5864">split</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;=&quot;)</span><span class="string">&quot;=&quot;</span></span>, <span class="typed"><span class="type">Int(2)</span><span class="int">2</span></span>)
      <span class="typed"><span class="type">Iterable[(String, String)]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Array[java.lang.String]</span><a href="#115058">stArray</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int(2)</span><span class="int">2</span></span>) {
        <span class="typed"><span class="type">Iterable[(String, String)]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#115046">input</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>) <span class="typed"><span class="type">((java.lang.String, java.lang.String)*)List[(java.lang.String, java.lang.String)]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">(java.lang.String,java.lang.String)(java.lang.String, java.lang.String)</span><span id="6015"><span id="6013"><a id="821">Pair</a></span></span></span>(<span class="typed"><span class="type">(Int)java.lang.String</span><a href="#115058" id="21509">stArray</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>), <span class="typed"><span class="type">(Int)java.lang.String</span><a href="#115058" id="21509">stArray</a></span>(<span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>))) <span class="keyword">else</span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>
      }
      <span class="keyword">else</span>
        <span class="typed"><span class="type">(String)Nothing</span><a href="#114979">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Property &quot;)</span><span class="string">&quot;Property &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#115057">st</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; is not formatted properly.&quot;)</span><span class="string">&quot; is not formatted properly.&quot;</span></span>)
    }
  }

  <span class="comment">/** Sets flags to be passed to the Java interpreter. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="114974">setJavaflags</a></span>(<span class="typed"><span class="type">String</span><a id="115079">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
    <span class="typed"><span class="type">(String)Unit</span><a href="#114962">javaFlags</a></span> = <span class="typed"><span class="type">String</span><a href="#115079">input</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="5870">trim</a></span>

  <span class="comment">/** Sets flags to be passed to the tool. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="114975">setToolflags</a></span>(<span class="typed"><span class="type">String</span><a id="115081">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
    <span class="typed"><span class="type">(String)Unit</span><a href="#114965">toolFlags</a></span> = <span class="typed"><span class="type">String</span><a href="#115081">input</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="5870">trim</a></span>

<span class="comment">/*============================================================================*\
**                             Properties getters                             **
\*============================================================================*/</span>

    <span class="comment">/** Gets the value of the classpath attribute in a Scala-friendly form.
      * @returns The class path as a list of files. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; String</span><a id="114976">getUnixclasspath</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> =
      <span class="typed"><span class="type">=&gt; Option[org.apache.tools.ant.types.Path]</span><a href="#114955">classpath</a></span>.<span class="typed"><span class="type">(=&gt; org.apache.tools.ant.types.Path)org.apache.tools.ant.types.Path</span><a id="25411">getOrElse</a></span>(<span class="typed"><span class="type">=&gt; org.apache.tools.ant.types.Path</span><a href="#114942">emptyPath</a></span>).<span class="typed"><span class="type">()Array[java.lang.String]</span><a id="45761">list</a></span>.<span class="typed"><span class="type">(String,String,String)String</span><a id="21818">mkString</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;:&quot;)</span><span class="string">&quot;:&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)

    <span class="comment">/** Gets the value of the classpath attribute in a Scala-friendly form.
      * @returns The class path as a list of files. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; String</span><a id="114977">getWinclasspath</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> =
      <span class="typed"><span class="type">=&gt; Option[org.apache.tools.ant.types.Path]</span><a href="#114955">classpath</a></span>.<span class="typed"><span class="type">(=&gt; org.apache.tools.ant.types.Path)org.apache.tools.ant.types.Path</span><a id="25411">getOrElse</a></span>(<span class="typed"><span class="type">=&gt; org.apache.tools.ant.types.Path</span><a href="#114942">emptyPath</a></span>).<span class="typed"><span class="type">()Array[java.lang.String]</span><a id="45761">list</a></span>.<span class="typed"><span class="type">((java.lang.String) =&gt; java.lang.String)Array[java.lang.String]</span><a id="21516">map</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#115098">_</a></span>.<span class="typed"><span class="type">(Char,Char)java.lang.String</span><a id="5858">replace</a></span>(<span class="typed"><span class="type">Char('/')</span><span class="char">'/'</span></span>, <span class="typed"><span class="type">Char('\')</span><span class="char">'\\'</span></span>)).
                <span class="typed"><span class="type">(String,String,String)String</span><a id="21818">mkString</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;;&quot;)</span><span class="string">&quot;;&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)

    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; String</span><a id="114978">getProperties</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> =
      <span class="typed"><span class="type">=&gt; List[(String, String)]</span><a href="#114958">properties</a></span>.<span class="typed"><span class="type">(((String, String)) =&gt; java.lang.String)List[java.lang.String]</span><a id="21362">map</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#115109">{</a></span>
        <span class="typed"><span class="type">java.lang.String</span><span class="keyword">case</span></span> <span class="typed"><span class="type">((String, String))Option[(String, String)]</span><span id="6018"><span id="6013"><a href="#115110" id="821">Pair</a></span></span></span>(<span class="typed"><span class="type">String</span><a id="115115">name</a></span>,<span class="typed"><span class="type">String</span><a id="115116">value</a></span>) =&gt; <span class="typed"><span class="type">java.lang.String(&quot;-D&quot;)</span><span class="string">&quot;-D&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#115115">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;=&quot;&quot;)</span><span class="string">&quot;=\&quot;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#115116">value</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;&quot;)</span><span class="string">&quot;\&quot;&quot;</span></span>
      }).<span class="typed"><span class="type">(String,String,String)String</span><a id="21818">mkString</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot; &quot;)</span><span class="string">&quot; &quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)

<span class="comment">/*============================================================================*\
**                       Compilation and support methods                      **
\*============================================================================*/</span>

    <span class="comment">/** Generates a build error. Error location will be the current task in the  
      * ant file.
      * @param message A message describing the error.
      * @throws BuildException A build error exception thrown in every case. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Nothing</span><a id="114979">error</a></span>(<span class="typed"><span class="type">String</span><a id="115031">message</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Nothing</span><a id="2167">Nothing</a></span> =
      <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,org.apache.tools.ant.Location)org.apache.tools.ant.BuildException</span><a id="46264" class="keyword">new</a></span> <span class="typed"><span class="type">org.apache.tools.ant.BuildException</span><a id="43886">BuildException</a></span>(<span class="typed"><span class="type">String</span><a href="#115031">message</a></span>, <span class="typed"><span class="type">()org.apache.tools.ant.Location</span><a href="#13744" id="45415">getLocation</a></span>())

    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String,Map[String,String])String</span><a id="114980">readAndPatchResource</a></span>(<span class="typed"><span class="type">String</span><a id="115134">resource</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">Map[String,String]</span><a id="115135">tokens</a></span>: <span class="typed"><span class="type">Map[String,String]</span><a id="26197">Map</a></span>[String, String]): <span class="typed"><span class="type">String</span><a id="1861">String</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">&lt;refinement&gt; extends java.lang.Object with Iterator[Char]</span><a id="115136">chars</a></span> = <span class="typed"><span class="type">template $anon extends java.lang.Object with Iterator[Char]</span><a id="115139" class="keyword">new</a></span> <span class="typed"><span class="type">Iterator[Char]</span><a id="1339">Iterator</a></span>[Char] {
        <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">java.io.InputStream</span><span id="115142"><a id="115141">stream</a></span></span> =
          <span class="typed"><span class="type">this.type</span><a href="#115139" class="keyword">this</a></span>.<span class="typed"><span class="type">()java.lang.Class[_ &lt;: java.lang.Object]</span><a id="3511">getClass</a></span>().<span class="typed"><span class="type">()java.lang.ClassLoader</span><a id="3949">getClassLoader</a></span>().<span class="typed"><span class="type">(java.lang.String)java.io.InputStream</span><a id="57249">getResourceAsStream</a></span>(<span class="typed"><span class="type">String</span><a href="#115134">resource</a></span>)
        <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Char</span><a id="115143">readStream</a></span>(): <span class="typed"><span class="type">Char</span><a id="2389">Char</a></span> = <span class="typed"><span class="type">=&gt; java.io.InputStream</span><a href="#115141">stream</a></span>.<span class="typed"><span class="type">()Int</span><a id="41372">read</a></span>().<span class="typed"><span class="type">Char</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">Char</span><a id="2389">Char</a></span>]
        <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Char</span><span id="115146"><span id="115144"><span id="115145"><a id="115152">buf</a></span></span></span></span>: <span class="typed"><span class="type">Char</span><a id="2389">Char</a></span> = <span class="typed"><span class="type">()Char</span><a href="#115143">readStream</a></span>()
        <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="115147">hasNext</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = (<span class="typed"><span class="type">=&gt; Char</span><a href="#115144">buf</a></span> <span class="typed"><span class="type">(Char)Boolean</span><a id="3019">!=</a></span> (-<span class="typed"><span class="type">Double(-1.0)</span><span class="double">1.</span></span>).<span class="typed"><span class="type">Char</span><a id="3503">asInstanceOf</a></span>[<span class="typed"><span class="type">Char</span><a id="2389">Char</a></span>])
        <span class="keyword">def</span> <span class="typed"><span class="type">()Char</span><a id="115148">next</a></span>: <span class="typed"><span class="type">Char</span><a id="2389">Char</a></span> = {
          <span class="keyword">val</span> <span class="typed"><span class="type">Char</span><a id="115168">bufbuf</a></span> = <span class="typed"><span class="type">=&gt; Char</span><a href="#115144">buf</a></span>
          <span class="typed"><span class="type">(Char)Unit</span><a href="#115145">buf</a></span> = <span class="typed"><span class="type">()Char</span><a href="#115143">readStream</a></span>()
          <span class="typed"><span class="type">Char</span><a href="#115168">bufbuf</a></span>
        }
      }
      <span class="keyword">val</span> <span class="typed"><span class="type">StringBuilder</span><a id="115137">builder</a></span> = <span class="typed"><span class="type">()StringBuilder</span><a id="23671" class="keyword">new</a></span> <span class="typed"><span class="type">StringBuilder</span><a id="1435">StringBuilder</a></span>()
      <span class="typed"><span class="type">Unit</span><a href="#115138" class="keyword">while</a></span> (<span class="typed"><span class="type">&lt;refinement&gt; extends java.lang.Object with Iterator[Char]</span><a href="#115136">chars</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="32163">hasNext</a></span>) {
        <span class="keyword">val</span> <span class="typed"><span class="type">Char</span><a id="115179">char</a></span> = <span class="typed"><span class="type">&lt;refinement&gt; extends java.lang.Object with Iterator[Char]</span><a href="#115136">chars</a></span>.<span class="typed"><span class="type">()Char</span><a id="32164">next</a></span>
        <span class="typed"><span class="type">StringBuilder</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Char</span><a href="#115179">char</a></span> <span class="typed"><span class="type">(Char)Boolean</span><a id="3018">==</a></span> <span class="typed"><span class="type">Char('@')</span><span class="char">'@'</span></span>) {
          <span class="keyword">var</span> <span class="typed"><span class="type">Char</span><a id="115181">char</a></span> = <span class="typed"><span class="type">&lt;refinement&gt; extends java.lang.Object with Iterator[Char]</span><a href="#115136">chars</a></span>.<span class="typed"><span class="type">()Char</span><a id="32164">next</a></span>
          <span class="keyword">val</span> <span class="typed"><span class="type">StringBuilder</span><a id="115182">token</a></span> = <span class="typed"><span class="type">()StringBuilder</span><a id="23671" class="keyword">new</a></span> <span class="typed"><span class="type">StringBuilder</span><a id="1435">StringBuilder</a></span>()
          <span class="typed"><span class="type">Unit</span><a href="#115183" class="keyword">while</a></span> (<span class="typed"><span class="type">&lt;refinement&gt; extends java.lang.Object with Iterator[Char]</span><a href="#115136">chars</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="32163">hasNext</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">Char</span><a href="#115181">char</a></span> <span class="typed"><span class="type">(Char)Boolean</span><a id="3019">!=</a></span> <span class="typed"><span class="type">Char('@')</span><span class="char">'@'</span></span>) {
            <span class="typed"><span class="type">StringBuilder</span><a href="#115182">token</a></span>.<span class="typed"><span class="type">(Char)StringBuilder</span><a id="23697">append</a></span>(<span class="typed"><span class="type">Char</span><a href="#115181">char</a></span>)
            <span class="typed"><span class="type">Char</span><a href="#115181">char</a></span> = <span class="typed"><span class="type">&lt;refinement&gt; extends java.lang.Object with Iterator[Char]</span><a href="#115136">chars</a></span>.<span class="typed"><span class="type">()Char</span><a id="32164">next</a></span>
          }
          <span class="typed"><span class="type">StringBuilder</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Map[String,String]</span><a href="#115135">tokens</a></span>.<span class="typed"><span class="type">(String)Boolean</span><a id="24240">contains</a></span>(<span class="typed"><span class="type">StringBuilder</span><a href="#115182">token</a></span>.<span class="typed"><span class="type">()String</span><a id="23723">toString</a></span>))
            <span class="typed"><span class="type">StringBuilder</span><a href="#115137">builder</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">(String)String</span><a href="#115135" id="24239">tokens</a></span>(<span class="typed"><span class="type">StringBuilder</span><a href="#115182">token</a></span>.<span class="typed"><span class="type">()String</span><a id="23723">toString</a></span>))
          <span class="keyword">else</span> <span class="typed"><span class="type">StringBuilder</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">StringBuilder</span><a href="#115182">token</a></span>.<span class="typed"><span class="type">()String</span><a id="23723">toString</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3509">==</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
            <span class="typed"><span class="type">StringBuilder</span><a href="#115137">builder</a></span>.<span class="typed"><span class="type">(Char)StringBuilder</span><a id="23697">append</a></span>(<span class="typed"><span class="type">Char('@')</span><span class="char">'@'</span></span>)
          <span class="keyword">else</span>
            <span class="typed"><span class="type">StringBuilder</span><a href="#115137">builder</a></span>.<span class="typed"><span class="type">(String)StringBuilder</span><a id="23690">append</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;@&quot;)</span><span class="string">&quot;@&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">StringBuilder</span><a href="#115182">token</a></span>.<span class="typed"><span class="type">()String</span><a id="23723">toString</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;@&quot;)</span><span class="string">&quot;@&quot;</span></span>)
        } <span class="keyword">else</span> <span class="typed"><span class="type">StringBuilder</span><a href="#115137">builder</a></span>.<span class="typed"><span class="type">(Char)StringBuilder</span><a id="23697">append</a></span>(<span class="typed"><span class="type">Char</span><a href="#115179">char</a></span>)
      }
      <span class="typed"><span class="type">StringBuilder</span><a href="#115137">builder</a></span>.<span class="typed"><span class="type">()String</span><a id="23723">toString</a></span>
    }

    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File,String)Unit</span><a id="114981">writeFile</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="115204">file</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>, <span class="typed"><span class="type">String</span><a id="115205">content</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.io.File</span><a href="#115204">file</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40697">exists</a></span>() <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">java.io.File</span><a href="#115204">file</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40696">canWrite</a></span>())
        <span class="typed"><span class="type">(String)Nothing</span><a href="#114979">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;File &quot;)</span><span class="string">&quot;File &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.io.File</span><a href="#115204">file</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; is not writable&quot;)</span><span class="string">&quot; is not writable&quot;</span></span>)
      <span class="keyword">else</span> {
        <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileWriter</span><a id="115207">writer</a></span> = <span class="typed"><span class="type">(java.io.File,Boolean)java.io.FileWriter</span><a id="79516" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileWriter</span><a id="3624">FileWriter</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#115204">file</a></span>, <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>)
        <span class="typed"><span class="type">java.io.FileWriter</span><a href="#115207">writer</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28732">write</a></span>(<span class="typed"><span class="type">String</span><a href="#115205">content</a></span>)
        <span class="typed"><span class="type">java.io.FileWriter</span><a href="#115207">writer</a></span>.<span class="typed"><span class="type">()Unit</span><a id="79528">close</a></span>()
      }

    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Map[String,String])Map[String,String]</span><a id="114982">expandUnixVar</a></span>(<span class="typed"><span class="type">Map[String,String]</span><a id="115230">vars</a></span>: <span class="typed"><span class="type">Map[String,String]</span><a id="26197">Map</a></span>[String,String]): <span class="typed"><span class="type">Map[String,String]</span><a id="26197">Map</a></span>[String,String] =
      <span class="typed"><span class="type">Map[String,String]</span><a href="#115230">vars</a></span> <span class="typed"><span class="type">((String, String) =&gt; java.lang.String)scala.collection.immutable.Map[String,java.lang.String]</span><a id="32817">transform</a></span> { (<span class="typed"><span class="type">String</span><a id="115233">x</a></span>, <span class="typed"><span class="type">String</span><a id="115234">vari</a></span>) =&gt; <span class="typed"><span class="type">String</span><a href="#115234">vari</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.lang.String</span><a id="5862">replaceAll</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;#([^#]*)#&quot;)</span><span class="string">&quot;#([^#]*)#&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;\$$1&quot;)</span><span class="string">&quot;\\$$1&quot;</span></span>) }

    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Map[String,String])Map[String,String]</span><a id="114983">expandWinVar</a></span>(<span class="typed"><span class="type">Map[String,String]</span><a id="115235">vars</a></span>: <span class="typed"><span class="type">Map[String,String]</span><a id="26197">Map</a></span>[String,String]): <span class="typed"><span class="type">Map[String,String]</span><a id="26197">Map</a></span>[String,String] =
      <span class="typed"><span class="type">Map[String,String]</span><a href="#115235">vars</a></span> <span class="typed"><span class="type">((String, String) =&gt; java.lang.String)scala.collection.immutable.Map[String,java.lang.String]</span><a id="32817">transform</a></span> { (<span class="typed"><span class="type">String</span><a id="115238">x</a></span>, <span class="typed"><span class="type">String</span><a id="115239">vari</a></span>) =&gt; <span class="typed"><span class="type">String</span><a href="#115239">vari</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.lang.String</span><a id="5862">replaceAll</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;#([^#]*)#&quot;)</span><span class="string">&quot;#([^#]*)#&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;%_$1%&quot;)</span><span class="string">&quot;%_$1%&quot;</span></span>) }


<span class="comment">/*============================================================================*\
**                           The big execute method                           **
\*============================================================================*/</span>

  <span class="comment">/** Performs the tool creation. */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="114984">execute</a></span>() = {
    <span class="comment">// Tests if all mandatory attributes are set and valid.</span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#114946">file</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><a href="#114979">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Attribute 'file' is not set.&quot;)</span><span class="string">&quot;Attribute 'file' is not set.&quot;</span></span>)
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#114949">mainClass</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><a href="#114979">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Main class must be set.&quot;)</span><span class="string">&quot;Main class must be set.&quot;</span></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="115241">resourceRoot</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;scala/tools/ant/templates/&quot;)</span><span class="string">&quot;scala/tools/ant/templates/&quot;</span></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.immutable.Map[java.lang.String,String]</span><a id="115242">patches</a></span> = <span class="typed"><span class="type">((java.lang.String, String)*)scala.collection.immutable.Map[java.lang.String,String]</span><span id="32836"><span id="5996"><a id="821">Map</a></span></span></span> (
      <span class="typed"><span class="type">(java.lang.String,String)(java.lang.String, String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">java.lang.String(&quot;class&quot;)</span><span class="string">&quot;class&quot;</span></span>, <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#114949">mainClass</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="25408">get</a></span>),
      <span class="typed"><span class="type">(java.lang.String,String)(java.lang.String, String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">java.lang.String(&quot;properties&quot;)</span><span class="string">&quot;properties&quot;</span></span>, <span class="typed"><span class="type">=&gt; String</span><a href="#114978">getProperties</a></span>),
      <span class="typed"><span class="type">(java.lang.String,String)(java.lang.String, String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">java.lang.String(&quot;javaflags&quot;)</span><span class="string">&quot;javaflags&quot;</span></span>, <span class="typed"><span class="type">=&gt; String</span><a href="#114961">javaFlags</a></span>),
      <span class="typed"><span class="type">(java.lang.String,String)(java.lang.String, String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">java.lang.String(&quot;toolflags&quot;)</span><span class="string">&quot;toolflags&quot;</span></span>, <span class="typed"><span class="type">=&gt; String</span><a href="#114964">toolFlags</a></span>)
    )
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; List[String]</span><a href="#114952">platforms</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="21673">contains</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;unix&quot;)</span><span class="string">&quot;unix&quot;</span></span>)) {
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.immutable.Map[java.lang.String,String]</span><a id="115257">unixPatches</a></span> = <span class="typed"><span class="type">scala.collection.immutable.Map[java.lang.String,String]</span><a href="#115242">patches</a></span> <span class="typed"><span class="type">((java.lang.String, String))scala.collection.immutable.Map[java.lang.String,String]</span><a id="32801">+</a></span> (<span class="typed"><span class="type">(java.lang.String,String)(java.lang.String, String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">java.lang.String(&quot;classpath&quot;)</span><span class="string">&quot;classpath&quot;</span></span>, <span class="typed"><span class="type">=&gt; String</span><a href="#114976">getUnixclasspath</a></span>))
      <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="115258">unixTemplateResource</a></span> = <span class="typed"><span class="type">java.lang.String</span><a href="#115241">resourceRoot</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;tool-unix.tmpl&quot;)</span><span class="string">&quot;tool-unix.tmpl&quot;</span></span>
      <span class="keyword">val</span> <span class="typed"><span class="type">String</span><a id="115259">unixTemplate</a></span> = <span class="typed"><span class="type">(String,Map[String,String])String</span><a href="#114980">readAndPatchResource</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#115258">unixTemplateResource</a></span>, <span class="typed"><span class="type">scala.collection.immutable.Map[java.lang.String,String]</span><a href="#115257">unixPatches</a></span>)
      <span class="typed"><span class="type">(java.io.File,String)Unit</span><a href="#114981">writeFile</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#114946">file</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>, <span class="typed"><span class="type">String</span><a href="#115259">unixTemplate</a></span>)
    }
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; List[String]</span><a href="#114952">platforms</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="21673">contains</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;windows&quot;)</span><span class="string">&quot;windows&quot;</span></span>)) {
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.immutable.Map[java.lang.String,String]</span><a id="115274">winPatches</a></span> = <span class="typed"><span class="type">scala.collection.immutable.Map[java.lang.String,String]</span><a href="#115242">patches</a></span> <span class="typed"><span class="type">((java.lang.String, String))scala.collection.immutable.Map[java.lang.String,String]</span><a id="32801">+</a></span> (<span class="typed"><span class="type">(java.lang.String,String)(java.lang.String, String)</span><span id="23625"><a id="1379">(</a></span></span><span class="typed"><span class="type">java.lang.String(&quot;classpath&quot;)</span><span class="string">&quot;classpath&quot;</span></span>, <span class="typed"><span class="type">=&gt; String</span><a href="#114977">getWinclasspath</a></span>))
      <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="115275">winTemplateResource</a></span> = <span class="typed"><span class="type">java.lang.String</span><a href="#115241">resourceRoot</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;tool-windows.tmpl&quot;)</span><span class="string">&quot;tool-windows.tmpl&quot;</span></span>
      <span class="keyword">val</span> <span class="typed"><span class="type">String</span><a id="115276">winTemplate</a></span> = <span class="typed"><span class="type">(String,Map[String,String])String</span><a href="#114980">readAndPatchResource</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#115275">winTemplateResource</a></span>, <span class="typed"><span class="type">scala.collection.immutable.Map[java.lang.String,String]</span><a href="#115274">winPatches</a></span>)
      <span class="typed"><span class="type">(java.io.File,String)Unit</span><a href="#114981">writeFile</a></span>(<span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#114946">file</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40689">getAbsolutePath</a></span>() <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;.bat&quot;)</span><span class="string">&quot;.bat&quot;</span></span>), <span class="typed"><span class="type">String</span><a href="#115276">winTemplate</a></span>)
    }
  }

}

        </pre>
    </body>
</html>