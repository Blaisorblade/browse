<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/ant/ScalaBazaar.scala</title>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala Ant Tasks                      **
**    / __/ __// _ | / /  / _ |    (c) 2005-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: ScalaBazaar.scala 16893 2009-01-13 13:09:22Z cunei $</span>

  
<span class="keyword">package</span> scala.tools.ant {
  
  <span class="keyword">import</span> scala.collection.Map
  <span class="keyword">import</span> scala.collection.mutable.HashMap
  <span class="keyword">import</span> java.io.{File, FileInputStream, FileOutputStream,
                  FileWriter, StringReader}
  <span class="keyword">import</span> java.net.{URL, URLClassLoader}
  <span class="keyword">import</span> java.util.{ArrayList, Vector}
  <span class="keyword">import</span> java.util.zip.{ZipOutputStream, ZipEntry}
  
  <span class="keyword">import</span> org.apache.tools.ant.{AntClassLoader, BuildException,
                               DirectoryScanner, Project}
  <span class="keyword">import</span> org.apache.tools.ant.Task
  <span class="keyword">import</span> org.apache.tools.ant.types.Path
  <span class="keyword">import</span> org.apache.tools.ant.util.{FileUtils, MergingMapper,
                                    SourceFileScanner}
  <span class="keyword">import</span> org.apache.tools.ant.types.{EnumeratedAttribute, Reference, FileSet}
    
  <span class="comment">/** A set of files that can be installed at any relative location */</span>
    <span class="keyword">class</span> <span class="typed"><span class="type">class LooseFileSet extends java.lang.Object with ScalaObject</span><a id="13894">LooseFileSet</a></span> {
      <span class="keyword">var</span> <span class="typed"><span class="type">Option[String]</span><span id="113678"><span id="113676"><span id="113677"><a id="113685">destination</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
      <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="113679">setDestination</a></span>(<span class="typed"><span class="type">String</span><a id="113693">dest</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = {
        <span class="typed"><span class="type">(Option[String])Unit</span><a href="#113677">destination</a></span> = <span class="typed"><span class="type">(String)Some[String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#113693">dest</a></span>)
      }
      
      <span class="keyword">var</span> <span class="typed"><span class="type">Option[org.apache.tools.ant.types.FileSet]</span><span id="113682"><span id="113680"><span id="113681"><a id="113692">fileset</a></span></span></span></span>: <span class="typed"><span class="type">Option[org.apache.tools.ant.types.FileSet]</span><a id="934">Option</a></span>[FileSet] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
      <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet)Unit</span><a id="113683">addConfiguredFileSet</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="113757">fs</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="44969">FileSet</a></span>) = {
        <span class="typed"><span class="type">(Option[org.apache.tools.ant.types.FileSet])Unit</span><a href="#113681">fileset</a></span> = <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet)Some[org.apache.tools.ant.types.FileSet]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113757">fs</a></span>)
      }
    }
  <span class="comment">/** An Ant task that generates a Scala Bazaars package (sbp file) along
    * with an advertisement of that package.
    *
    * This task can take the following parameters as attributes:&lt;ul&gt;
    *  &lt;li&gt;file (mandatory),&lt;/li&gt;
    *  &lt;li&gt;adfile,&lt;/li&gt;
    *  &lt;li&gt;name (mandatory),&lt;/li&gt;
    *  &lt;li&gt;version (mandatory),&lt;/li&gt;
    *  &lt;li&gt;depends,&lt;/li&gt;
    *  &lt;li&gt;description,&lt;/li&gt;
    *  &lt;li&gt;link.&lt;/li&gt;
    *  &lt;/ul&gt;
    * 
    * @author Gilles Dubochet */</span>
  <span class="keyword">class</span> <span class="typed"><span class="type">class ScalaBazaar extends org.apache.tools.ant.Task with ScalaObject</span><a id="13795">ScalaBazaar</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">org.apache.tools.ant.Task</span><a id="43859">Task</a></span> {
    
    <span class="comment">/** The unique Ant file utilities instance to use in this task. */</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">org.apache.tools.ant.util.FileUtils</span><span id="113762"><a id="113761">fileUtils</a></span></span> = <span class="typed"><span class="type">object org.apache.tools.ant.util.FileUtils</span><a id="45154">FileUtils</a></span>.<span class="typed"><span class="type">()org.apache.tools.ant.util.FileUtils</span><a id="45673">newFileUtils</a></span>()
    
<span class="comment">/******************************************************************************\
**                             Ant user-properties                            **
\******************************************************************************/</span>
    
    <span class="comment">/** The path to the archive file. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[java.io.File]</span><span id="113765"><span id="113763"><span id="113764"><a id="113810">file</a></span></span></span></span>: <span class="typed"><span class="type">Option[java.io.File]</span><a id="934">Option</a></span>[File] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
    <span class="comment">/** The optional path to the advertisement file. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[java.io.File]</span><span id="113768"><span id="113766"><span id="113767"><a id="113811">adfile</a></span></span></span></span>: <span class="typed"><span class="type">Option[java.io.File]</span><a id="934">Option</a></span>[File] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
    <span class="comment">/** The name of the package. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[String]</span><span id="113771"><span id="113769"><span id="113770"><a id="113812">name</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
    <span class="comment">/** The version number of the package. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[String]</span><span id="113774"><span id="113772"><span id="113773"><a id="113813">version</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
    <span class="comment">/** An (optional) list of names of the packages it depends of. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">List[String]</span><span id="113777"><span id="113775"><span id="113776"><a id="113814">depends</a></span></span></span></span>: <span class="typed"><span class="type">List[String]</span><a id="526">List</a></span>[String] = <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>
    <span class="comment">/** An (optional) description of this package. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[String]</span><span id="113780"><span id="113778"><span id="113779"><a id="113815">desc</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
    <span class="comment">/** An (optional) URL link pointing to the location of the package */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[String]</span><span id="113783"><span id="113781"><span id="113782"><a id="113816">link</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
    
    <span class="comment">/** The sets of files to include in the package */</span>
    <span class="keyword">private</span> <span class="keyword">object</span> <span class="typed"><span class="type">object ScalaBazaar.this.fileSetsMap</span><a id="113784">fileSetsMap</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.collection.Map[String,List[org.apache.tools.ant.types.FileSet]]</span><a id="19775">Map</a></span>[String, List[FileSet]] {
      <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]</span><span id="113820"><span id="113818"><span id="113819"><a id="113827">content</a></span></span></span></span> = <span class="typed"><span class="type">scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]</span><a id="20081">HashMap</a></span>[String, List[FileSet]]()
      <span class="keyword">def</span> <span class="typed"><span class="type">(String)Option[List[org.apache.tools.ant.types.FileSet]]</span><a id="113821">get</a></span>(<span class="typed"><span class="type">String</span><a id="113828">key</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Option[List[org.apache.tools.ant.types.FileSet]]</span><a id="934">Option</a></span>[List[FileSet]] = <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]</span><a href="#113818">content</a></span>.<span class="typed"><span class="type">(String)Option[List[org.apache.tools.ant.types.FileSet]]</span><a id="24295">get</a></span>(<span class="typed"><span class="type">String</span><a href="#113828">key</a></span>)
      <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Int</span><a id="113822">size</a></span>: <span class="typed"><span class="type">Int</span><a id="2394">Int</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]</span><a href="#113818">content</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="24276">size</a></span>
      <span class="keyword">def</span> <span class="typed"><span class="type">(String,org.apache.tools.ant.types.FileSet)Unit</span><a id="113823">update</a></span>(<span class="typed"><span class="type">String</span><a id="113832">key</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="113833">value</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="44969">FileSet</a></span>) = {
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]</span><a href="#113818">content</a></span>.<span class="typed"><span class="type">(String)Boolean</span><a id="24240">contains</a></span>(<span class="typed"><span class="type">String</span><a href="#113832">key</a></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">(String)List[org.apache.tools.ant.types.FileSet]</span><a href="#113818" id="24239">content</a></span>(<span class="typed"><span class="type">String</span><a href="#113832">key</a></span>) <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>)
          <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]</span><a href="#113818">content</a></span>.<span class="typed"><span class="type">(String,List[org.apache.tools.ant.types.FileSet])Unit</span><a id="24296">update</a></span>(<span class="typed"><span class="type">String</span><a href="#113832">key</a></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113833">value</a></span> <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet)List[org.apache.tools.ant.types.FileSet]</span><a href="#113842" id="21335">::</a></span> <span class="typed"><span class="type">(String)List[org.apache.tools.ant.types.FileSet]</span><a href="#113818" id="24239">content</a></span>(<span class="typed"><span class="type">String</span><a href="#113832">key</a></span>))
        <span class="keyword">else</span> <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]</span><a href="#113818">content</a></span>.<span class="typed"><span class="type">(String,List[org.apache.tools.ant.types.FileSet])Unit</span><a id="24296">update</a></span>(<span class="typed"><span class="type">String</span><a href="#113832">key</a></span>, <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet*)List[org.apache.tools.ant.types.FileSet]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113833">value</a></span>))
      }
      <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; List[(String, List[org.apache.tools.ant.types.FileSet])]</span><a id="113824">fileSets</a></span> = <span class="typed"><span class="type">=&gt; Iterator[(String, List[org.apache.tools.ant.types.FileSet])]</span><a href="#113825">elements</a></span>.<span class="typed"><span class="type">=&gt; List[(String, List[org.apache.tools.ant.types.FileSet])]</span><a id="32235">toList</a></span>
      <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Iterator[(String, List[org.apache.tools.ant.types.FileSet])]</span><a id="113825">elements</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]</span><a href="#113818">content</a></span>.<span class="typed"><span class="type">=&gt; Iterator[(String, List[org.apache.tools.ant.types.FileSet])]</span><a id="24297">elements</a></span>
    }
    
    
    
<span class="comment">/******************************************************************************\
**                             Internal properties                            **
\******************************************************************************/</span>

      
<span class="comment">/******************************************************************************\
**                             Properties setters                             **
\******************************************************************************/</span>
    
    <span class="comment">/** Sets the file attribute. Used by Ant.
      * @param input The value of &lt;code&gt;file&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)Unit</span><a id="113786">setFile</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="113856">input</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) =
      <span class="typed"><span class="type">(Option[java.io.File])Unit</span><a href="#113764">file</a></span> = <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#113856">input</a></span>)
      
    <span class="comment">/** Sets the advertisement file attribute. Used by Ant.
      * @param input The value of &lt;code&gt;adfile&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)Unit</span><a id="113787">setAdfile</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="113859">input</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) =
      <span class="typed"><span class="type">(Option[java.io.File])Unit</span><a href="#113767">adfile</a></span> = <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#113859">input</a></span>)
      
    <span class="comment">/** Sets the name attribute of this package. Used by Ant.
      * @param input The value of &lt;code&gt;name&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="113788">setName</a></span>(<span class="typed"><span class="type">String</span><a id="113862">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
      <span class="typed"><span class="type">(Option[String])Unit</span><a href="#113770">name</a></span> = <span class="typed"><span class="type">(String)Some[String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#113862">input</a></span>)
      
    <span class="comment">/** Sets the version attribute of this package. Used by Ant.
      * @param input The value of &lt;code&gt;version&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="113789">setVersion</a></span>(<span class="typed"><span class="type">String</span><a id="113865">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
      <span class="typed"><span class="type">(Option[String])Unit</span><a href="#113773">version</a></span> = <span class="typed"><span class="type">(String)Some[String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#113865">input</a></span>)
    
    <span class="comment">/** Sets the depends attribute. Used by Ant.
      * @param input The value for &lt;code&gt;depends&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="113790">setDepends</a></span>(<span class="typed"><span class="type">String</span><a id="113868">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) = {
      <span class="typed"><span class="type">(List[String])Unit</span><a href="#113776">depends</a></span> = <span class="typed"><span class="type">object List</span><a id="527">List</a></span>.<span class="typed"><span class="type">(Array[java.lang.String])List[java.lang.String]</span><a id="21440">fromArray</a></span>(<span class="typed"><span class="type">String</span><a href="#113868">input</a></span>.<span class="typed"><span class="type">(java.lang.String)Array[java.lang.String]</span><a id="5865">split</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;,&quot;)</span><span class="string">&quot;,&quot;</span></span>)).<span class="typed"><span class="type">((java.lang.String) =&gt; Iterable[String])List[String]</span><a id="21383">flatMap</a></span> { <span class="typed"><span class="type">String</span><a id="113878">s</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> =&gt;
        <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="113879">st</a></span> = <span class="typed"><span class="type">String</span><a href="#113878">s</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="5870">trim</a></span>()
        (<span class="typed"><span class="type">Iterable[String]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#113879">st</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">!=</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>) <span class="typed"><span class="type">(java.lang.String*)List[java.lang.String]</span><span id="21328"><a id="527">List</a></span></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#113879">st</a></span>) <span class="keyword">else</span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>)
      }
    }
      
    <span class="comment">/** Sets the description attribute of this package. Used by Ant.
      * @param input The value of &lt;code&gt;description&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="113791">setDesc</a></span>(<span class="typed"><span class="type">String</span><a id="113882">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
      <span class="typed"><span class="type">(Option[String])Unit</span><a href="#113779">desc</a></span> = <span class="typed"><span class="type">(String)Some[String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#113882">input</a></span>)

    <span class="comment">/** Sets the link attribute of this package. Used by Ant.
      * @param input The value of &lt;code&gt;link&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="113792">setLink</a></span>(<span class="typed"><span class="type">String</span><a id="113885">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
      <span class="typed"><span class="type">(Option[String])Unit</span><a href="#113782">link</a></span> = <span class="typed"><span class="type">(String)Some[String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#113885">input</a></span>)

    <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet)Unit</span><a id="113793">addConfiguredLibset</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="113888">input</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="44969">FileSet</a></span>) =
      <span class="typed"><span class="type">object ScalaBazaar.this.fileSetsMap</span><a href="#113784">fileSetsMap</a></span>.<span class="typed"><span class="type">(String,org.apache.tools.ant.types.FileSet)Unit</span><a href="#113823">update</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;lib&quot;)</span><span class="string">&quot;lib&quot;</span></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113888">input</a></span>)
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet)Unit</span><a id="113794">addConfiguredBinset</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="113890">input</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="44969">FileSet</a></span>) =
      <span class="typed"><span class="type">object ScalaBazaar.this.fileSetsMap</span><a href="#113784">fileSetsMap</a></span>.<span class="typed"><span class="type">(String,org.apache.tools.ant.types.FileSet)Unit</span><a href="#113823">update</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;bin&quot;)</span><span class="string">&quot;bin&quot;</span></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113890">input</a></span>)
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet)Unit</span><a id="113795">addConfiguredSrcset</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="113892">input</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="44969">FileSet</a></span>) =
      <span class="typed"><span class="type">object ScalaBazaar.this.fileSetsMap</span><a href="#113784">fileSetsMap</a></span>.<span class="typed"><span class="type">(String,org.apache.tools.ant.types.FileSet)Unit</span><a href="#113823">update</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;src&quot;)</span><span class="string">&quot;src&quot;</span></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113892">input</a></span>)
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet)Unit</span><a id="113796">addConfiguredManset</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="113894">input</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="44969">FileSet</a></span>) =
      <span class="typed"><span class="type">object ScalaBazaar.this.fileSetsMap</span><a href="#113784">fileSetsMap</a></span>.<span class="typed"><span class="type">(String,org.apache.tools.ant.types.FileSet)Unit</span><a href="#113823">update</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;man&quot;)</span><span class="string">&quot;man&quot;</span></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113894">input</a></span>)
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet)Unit</span><a id="113797">addConfiguredDocset</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="113896">input</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="44969">FileSet</a></span>) =
      <span class="typed"><span class="type">object ScalaBazaar.this.fileSetsMap</span><a href="#113784">fileSetsMap</a></span>.<span class="typed"><span class="type">(String,org.apache.tools.ant.types.FileSet)Unit</span><a href="#113823">update</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;doc/&quot;)</span><span class="string">&quot;doc/&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; String</span><a href="#113800">getName</a></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113896">input</a></span>)
    
    <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.types.FileSet)Unit</span><a id="113798">addConfiguredMiscset</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="113899">input</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="44969">FileSet</a></span>) =
      <span class="typed"><span class="type">object ScalaBazaar.this.fileSetsMap</span><a href="#113784">fileSetsMap</a></span>.<span class="typed"><span class="type">(String,org.apache.tools.ant.types.FileSet)Unit</span><a href="#113823">update</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;misc/&quot;)</span><span class="string">&quot;misc/&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; String</span><a href="#113800">getName</a></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113899">input</a></span>)
      
    <span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.ant.LooseFileSet)Unit</span><a id="113799">addConfiguredLooseset</a></span>(<span class="typed"><span class="type">scala.tools.ant.LooseFileSet</span><a id="113901">set</a></span>: <span class="typed"><span class="type">scala.tools.ant.LooseFileSet</span><a href="#13894">LooseFileSet</a></span>) = {
      <span class="typed"><span class="type">(Option[String],Option[org.apache.tools.ant.types.FileSet])(Option[String], Option[org.apache.tools.ant.types.FileSet])</span><span id="6015"><span id="6013"><a id="821">Pair</a></span></span></span>(<span class="typed"><span class="type">scala.tools.ant.LooseFileSet</span><a href="#113901">set</a></span>.<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113676">destination</a></span>, <span class="typed"><span class="type">scala.tools.ant.LooseFileSet</span><a href="#113901">set</a></span>.<span class="typed"><span class="type">=&gt; Option[org.apache.tools.ant.types.FileSet]</span><a href="#113680">fileset</a></span>) <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">((Option[String], Option[org.apache.tools.ant.types.FileSet]))Option[(Option[String], Option[org.apache.tools.ant.types.FileSet])]</span><span id="6018"><span id="6013"><a href="#113905" id="821">Pair</a></span></span></span>(<span class="typed"><span class="type">object None</span><a id="536">None</a></span>, _) =&gt;
          <span class="typed"><span class="type">(String)Nothing</span><a href="#113806">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;destination not specified for a loose file set&quot;)</span><span class="string">&quot;destination not specified for a loose file set&quot;</span></span>)
        
        <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">((Option[String], Option[org.apache.tools.ant.types.FileSet]))Option[(Option[String], Option[org.apache.tools.ant.types.FileSet])]</span><span id="6018"><span id="6013"><a href="#113911" id="821">Pair</a></span></span></span>(_, <span class="typed"><span class="type">object None</span><a id="536">None</a></span>) =&gt; 
          <span class="typed"><span class="type">(String)Nothing</span><a href="#113806">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;no files specified for a loose file set&quot;)</span><span class="string">&quot;no files specified for a loose file set&quot;</span></span>)
          
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">((Option[String], Option[org.apache.tools.ant.types.FileSet]))Option[(Option[String], Option[org.apache.tools.ant.types.FileSet])]</span><span id="6018"><span id="6013"><a href="#113916" id="821">Pair</a></span></span></span>(<a id="1">Some</a>(<span class="typed"><span class="type">String</span><a id="113921">dest</a></span>), <a id="1">Some</a>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a id="113922">fileset</a></span>)) =&gt;
          <span class="typed"><span class="type">object ScalaBazaar.this.fileSetsMap</span><a href="#113784">fileSetsMap</a></span>.<span class="typed"><span class="type">(String,org.apache.tools.ant.types.FileSet)Unit</span><a href="#113823">update</a></span>(<span class="typed"><span class="type">String</span><a href="#113921">dest</a></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#113922">fileset</a></span>)
      }
    }

<span class="comment">/******************************************************************************\
**                             Properties getters                             **
\******************************************************************************/</span>
    
    <span class="comment">/** Gets the value of the file attribute in a Scala-friendly form. 
      * @returns The file as a file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; String</span><a id="113800">getName</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> =
      <span class="typed"><span class="type">String</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113769">name</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><a href="#113806">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Name attribute must be defined first.&quot;)</span><span class="string">&quot;Name attribute must be defined first.&quot;</span></span>)
      <span class="keyword">else</span> <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113769">name</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="25408">get</a></span>
      
    <span class="comment">/** Gets the value of the file attribute in a Scala-friendly form. 
      * @returns The file as a file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; java.io.File</span><a id="113801">getFile</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span> =
      <span class="typed"><span class="type">java.io.File</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#113763">file</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><a href="#113806">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Member 'file' is empty.&quot;)</span><span class="string">&quot;Member 'file' is empty.&quot;</span></span>)
      <span class="keyword">else</span> <span class="typed"><span class="type">()org.apache.tools.ant.Project</span><a href="#13795" id="45414">getProject</a></span>().<span class="typed"><span class="type">(java.lang.String)java.io.File</span><a id="45939">resolveFile</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#113763">file</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40722">toString</a></span>())
      
    <span class="comment">/** Gets the value of the adfile attribute in a Scala-friendly form. 
      * @returns The adfile as a file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; java.io.File</span><a id="113802">getAdfile</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span> =
      <span class="typed"><span class="type">java.io.File</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#113766">adfile</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><a href="#113806">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Member 'adfile' is empty.&quot;)</span><span class="string">&quot;Member 'adfile' is empty.&quot;</span></span>)
      <span class="keyword">else</span> <span class="typed"><span class="type">()org.apache.tools.ant.Project</span><a href="#13795" id="45414">getProject</a></span>().<span class="typed"><span class="type">(java.lang.String)java.io.File</span><a id="45939">resolveFile</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#113766">adfile</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40722">toString</a></span>())

<span class="comment">/******************************************************************************\
**                       Compilation and support methods                      **
\******************************************************************************/</span>
    <span class="comment">/** Transforms a string name into a file relative to the provided base
      * directory.
      * @param base A file pointing to the location relative to which the name
      *   will be resolved.
      * @param name A relative or absolute path to the file as a string.
      * @return A file created from the name and the base file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)(String)java.io.File</span><a id="113803">nameToFile</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="113939">base</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>)(<span class="typed"><span class="type">String</span><a id="113940">name</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span> =
      <span class="typed"><span class="type">(java.io.File)java.io.File</span><a href="#113805">existing</a></span>(<span class="typed"><span class="type">=&gt; org.apache.tools.ant.util.FileUtils</span><a href="#113761">fileUtils</a></span>.<span class="typed"><span class="type">(java.io.File,java.lang.String)java.io.File</span><a id="45692">resolveFile</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#113939">base</a></span>, <span class="typed"><span class="type">String</span><a href="#113940">name</a></span>))
    
    <span class="comment">/** Transforms a string name into a file relative to the build root
      * directory.
      * @param name A relative or absolute path to the file as a string.
      * @return A file created from the name. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)java.io.File</span><a id="113804">nameToFile</a></span>(<span class="typed"><span class="type">String</span><a id="113942">name</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span> =
      <span class="typed"><span class="type">(java.io.File)java.io.File</span><a href="#113805">existing</a></span>(<span class="typed"><span class="type">()org.apache.tools.ant.Project</span><a href="#13795" id="45414">getProject</a></span>().<span class="typed"><span class="type">(java.lang.String)java.io.File</span><a id="45939">resolveFile</a></span>(<span class="typed"><span class="type">String</span><a href="#113942">name</a></span>))
    
    <span class="comment">/** Tests if a file exists and prints a warning in case it doesn't. Always
      * returns the file, even if it doesn't exist.
      * @param file A file to test for existance.
      * @return The same file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)java.io.File</span><a id="113805">existing</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="113941">file</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>): <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span> = {
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">java.io.File</span><a href="#113941">file</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40697">exists</a></span>())
        <span class="typed"><span class="type">(java.lang.String,Int)Unit</span><a href="#13795" id="45633">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Element '&quot;)</span><span class="string">&quot;Element '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.io.File</span><a href="#113941">file</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40722">toString</a></span>() <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;' does not exist.&quot;)</span><span class="string">&quot;' does not exist.&quot;</span></span>,
            Project.<span class="typed"><span class="type">Int(1)</span><span >MSG_WARN</span></span>)
      <span class="typed"><span class="type">java.io.File</span><a href="#113941">file</a></span>
    }
    
    <span class="comment">/** Generates a build error. Error location will be the current task in the  
      * ant file.
      * @param message A message describing the error.
      * @throws BuildException A build error exception thrown in every case. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Nothing</span><a id="113806">error</a></span>(<span class="typed"><span class="type">String</span><a id="113910">message</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>): <span class="typed"><span class="type">Nothing</span><a id="2167">Nothing</a></span> =
      <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,org.apache.tools.ant.Location)org.apache.tools.ant.BuildException</span><a id="46264" class="keyword">new</a></span> <span class="typed"><span class="type">org.apache.tools.ant.BuildException</span><a id="43886">BuildException</a></span>(<span class="typed"><span class="type">String</span><a href="#113910">message</a></span>, <span class="typed"><span class="type">()org.apache.tools.ant.Location</span><a href="#13795" id="45415">getLocation</a></span>())
    
    <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File,String)Unit</span><a id="113807">writeFile</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="113965">file</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>, <span class="typed"><span class="type">String</span><a id="113966">content</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.io.File</span><a href="#113965">file</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40697">exists</a></span>() <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">java.io.File</span><a href="#113965">file</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40696">canWrite</a></span>())
        <span class="typed"><span class="type">(String)Nothing</span><a href="#113806">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;File &quot;)</span><span class="string">&quot;File &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.io.File</span><a href="#113965">file</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; is not writable&quot;)</span><span class="string">&quot; is not writable&quot;</span></span>)
      <span class="keyword">else</span> {
        <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileWriter</span><a id="113968">writer</a></span> = <span class="typed"><span class="type">(java.io.File,Boolean)java.io.FileWriter</span><a id="79516" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileWriter</span><a id="3624">FileWriter</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#113965">file</a></span>, <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>)
        <span class="typed"><span class="type">java.io.FileWriter</span><a href="#113968">writer</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="28732">write</a></span>(<span class="typed"><span class="type">String</span><a href="#113966">content</a></span>)
        <span class="typed"><span class="type">java.io.FileWriter</span><a href="#113968">writer</a></span>.<span class="typed"><span class="type">()Unit</span><a id="79528">close</a></span>()
      }

<span class="comment">/******************************************************************************\
**                           The big execute method                           **
\******************************************************************************/</span>

    <span class="comment">/** Performs the compilation. */</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="113808">execute</a></span>() = {
      <span class="comment">// Tests if all mandatory attributes are set and valid.</span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#113763">file</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><a href="#113806">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Attribute 'file' is not set.&quot;)</span><span class="string">&quot;Attribute 'file' is not set.&quot;</span></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113769">name</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><a href="#113806">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Attribute 'name' is not set.&quot;)</span><span class="string">&quot;Attribute 'name' is not set.&quot;</span></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113772">version</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><a href="#113806">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Attribute 'version' is not set.&quot;)</span><span class="string">&quot;Attribute 'version' is not set.&quot;</span></span>)
      
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.xml.Elem</span><a id="113993">pack</a></span> = {
        &lt;package&gt;
          &lt;name&gt;{<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113769">name</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="25408">get</a></span>}&lt;/name&gt;
          &lt;version&gt;{<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113772">version</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="25408">get</a></span>}&lt;/version&gt;{
            <span class="typed"><span class="type">Any</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; List[String]</span><a href="#113775">depends</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="21645">isEmpty</a></span>)
              &lt;depends&gt;{
                <span class="keyword">for</span> (<span class="typed"><span class="type">((String) =&gt; scala.xml.Elem)List[scala.xml.Elem]</span><span id="21362"><a id="114016">depend</a></span></span> &lt;- <span class="typed"><span class="type">=&gt; List[String]</span><a href="#113775">depends</a></span>) <span class="keyword">yield</span>
                  &lt;name&gt;{<span class="typed"><span class="type">String</span><a href="#114016">depend</a></span>}&lt;/name&gt;
              }&lt;/depends&gt;
            <span class="keyword">else</span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>
          }{
            <span class="typed"><span class="type">Any</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113778">desc</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>)
              &lt;description&gt;{<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113778">desc</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="25408">get</a></span>}&lt;/description&gt;
            <span class="keyword">else</span> <span class="typed"><span class="type">object Nil</span><a id="335">Nil</a></span>
          }
        &lt;/<span class="keyword">package</span>&gt;
      }

      <span class="typed"><span class="type">(java.lang.String)Unit</span><a href="#13795" id="45632">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Creating package '&quot;)</span><span class="string">&quot;Creating package '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113769">name</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="25408">get</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;'&quot;)</span><span class="string">&quot;'&quot;</span></span>)
      
      <span class="comment">// Creates the advert file</span>
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.xml.Elem</span><a id="113994">advert</a></span> = {
        &lt;availablePackage&gt;
          {<span class="typed"><span class="type">scala.xml.Elem</span><a href="#113993">pack</a></span>}
          {<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#113781">link</a></span> <span class="typed"><span class="type">Any</span><span class="keyword">match</span></span> {
            <span class="typed"><span class="type">scala.xml.Elem</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt; &lt;link&gt;<span class="typed"><span class="type">scala.xml.Text</span><a id="39477">INSERT</a></span> LINK HERE&lt;/link&gt;
            <span class="typed"><span class="type">scala.xml.Elem</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">String</span><a id="114030">str</a></span>) =&gt; &lt;link&gt;{<span class="typed"><span class="type">String</span><a href="#114030">str</a></span>}&lt;/link&gt;
          }}
        &lt;/availablePackage&gt;
      };
      
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#113766">adfile</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>)
        <span class="typed"><span class="type">(java.io.File,String)Unit</span><a href="#113807">writeFile</a></span>(<span class="typed"><span class="type">=&gt; java.io.File</span><a href="#113802">getAdfile</a></span>, <span class="typed"><span class="type">scala.xml.Elem</span><a href="#113994">advert</a></span>.<span class="typed"><span class="type">()String</span><a id="65740">toString</a></span>())
      
      <span class="comment">// Checks for new files and creates the ZIP</span>
      
      <span class="keyword">val</span> <span class="typed"><span class="type">List[(String, java.io.File, java.lang.String)]</span><a id="113995">zipContent</a></span> =
        <span class="keyword">for</span> {
          <span class="typed"><span class="type">(((String, List[org.apache.tools.ant.types.FileSet])) =&gt; Iterable[(String, java.io.File, java.lang.String)])List[(String, java.io.File, java.lang.String)]</span><span id="6018"><span id="6013"><span id="821"><span id="21367"><a href="#114037" id="21383">Pair</a></span></span></span></span></span>(<span class="typed"><span class="type">String</span><span id="114043"><a id="114054">folder</a></span></span>, <span class="typed"><span class="type">List[org.apache.tools.ant.types.FileSet]</span><span id="114044"><a id="114055">fileSets</a></span></span>) &lt;- <span class="typed"><span class="type">object ScalaBazaar.this.fileSetsMap</span><a href="#113784">fileSetsMap</a></span>.<span class="typed"><span class="type">=&gt; List[(String, List[org.apache.tools.ant.types.FileSet])]</span><a href="#113824">fileSets</a></span>
          <span class="typed"><span class="type">((org.apache.tools.ant.types.FileSet) =&gt; Iterable[(String, java.io.File, java.lang.String)])List[(String, java.io.File, java.lang.String)]</span><span id="21383"><a id="114058">fileSet</a></span></span> &lt;- <span class="typed"><span class="type">List[org.apache.tools.ant.types.FileSet]</span><a href="#114055">fileSets</a></span>
          <span class="typed"><span class="type">((java.lang.String) =&gt; (String, java.io.File, java.lang.String))List[(String, java.io.File, java.lang.String)]</span><span id="21362"><a id="114068">file</a></span></span> &lt;- <span class="typed"><span class="type">object List</span><a id="527">List</a></span>.<span class="typed"><span class="type">(Array[java.lang.String])List[java.lang.String]</span><a id="21440">fromArray</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#114058">fileSet</a></span>.<span class="typed"><span class="type">(org.apache.tools.ant.Project)org.apache.tools.ant.DirectoryScanner</span><a id="113722">getDirectoryScanner</a></span>(<span class="typed"><span class="type">()org.apache.tools.ant.Project</span><a href="#13795" id="45414">getProject</a></span>).<span class="typed"><span class="type">()Array[java.lang.String]</span><a id="46222">getIncludedFiles</a></span>)
        } <span class="keyword">yield</span> <span class="typed"><span class="type">(String,java.io.File,java.lang.String)(String, java.io.File, java.lang.String)</span><span id="6028"><span id="6026"><a id="821">Triple</a></span></span></span>(<span class="typed"><span class="type">String</span><a href="#114054">folder</a></span>, <span class="typed"><span class="type">org.apache.tools.ant.types.FileSet</span><a href="#114058">fileSet</a></span>.<span class="typed"><span class="type">(org.apache.tools.ant.Project)java.io.File</span><a id="113701">getDir</a></span>(<span class="typed"><span class="type">()org.apache.tools.ant.Project</span><a href="#13795" id="45414">getProject</a></span>), <span class="typed"><span class="type">java.lang.String</span><a href="#114068">file</a></span>)
      <span class="keyword">val</span> <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><a id="113996">zip</a></span> = <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><a id="40642">ZipOutputStream</a></span>(<span class="typed"><span class="type">(java.io.File,Boolean)java.io.FileOutputStream</span><a id="48704" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileOutputStream</span><a id="3798">FileOutputStream</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#113763">file</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>, <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>))
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">List[(String, java.io.File, java.lang.String)]</span><a href="#113995">zipContent</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="21645">isEmpty</a></span>) {
        <span class="keyword">for</span> (<span class="typed"><span class="type">(((String, java.io.File, java.lang.String)) =&gt; Unit)Unit</span><span id="6026"><span id="21366"><span id="6032"><span id="821"><a href="#114121" id="21367">Triple</a></span></span></span></span></span>(<span class="typed"><span class="type">String</span><span id="114129"><a id="114142">destFolder</a></span></span>, <span class="typed"><span class="type">java.io.File</span><span id="114130"><a id="114143">srcFolder</a></span></span>, <span class="typed"><span class="type">java.lang.String</span><span id="114131"><a id="114144">file</a></span></span>) &lt;- <span class="typed"><span class="type">List[(String, java.io.File, java.lang.String)]</span><a href="#113995">zipContent</a></span>) {
          <span class="typed"><span class="type">(java.lang.String,Int)Unit</span><a href="#13795" id="45633">log</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#114144">file</a></span>, Project.<span class="typed"><span class="type">Int(4)</span><span >MSG_DEBUG</span></span>)
          <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><a href="#113996">zip</a></span>.<span class="typed"><span class="type">(java.util.zip.ZipEntry)Unit</span><a id="114079">putNextEntry</a></span>(<span class="typed"><span class="type">java.util.zip.ZipEntry</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.zip.ZipEntry</span><a id="40603">ZipEntry</a></span>(<span class="typed"><span class="type">String</span><a href="#114142">destFolder</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;/&quot;)</span><span class="string">&quot;/&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#114144">file</a></span>))
          <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileInputStream</span><a id="114145">input</a></span> = <span class="typed"><span class="type">(java.io.File)java.io.FileInputStream</span><a id="48679" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileInputStream</span><a id="3810">FileInputStream</a></span>(<span class="typed"><span class="type">(java.io.File)(String)java.io.File</span><a href="#113803">nameToFile</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#114143">srcFolder</a></span>)(<span class="typed"><span class="type">java.lang.String</span><a href="#114144">file</a></span>))
          <span class="keyword">val</span> <span class="typed"><span class="type">Array[Byte]</span><a id="114146">buf</a></span> = <span class="typed"><span class="type">Array[Byte]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Byte]</span><a id="1072">Array</a></span>[Byte](<span class="typed"><span class="type">Int(10240)</span><span class="int">10240</span></span>)
          <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="114147">n</a></span> = <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#114145">input</a></span>.<span class="typed"><span class="type">(Array[Byte],Int,Int)Int</span><a id="48683">read</a></span>(<span class="typed"><span class="type">Array[Byte]</span><a href="#114146">buf</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Array[Byte]</span><a href="#114146">buf</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span>)
          <span class="typed"><span class="type">Unit</span><a href="#114148" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#114147">n</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3146">&gt;=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) {
            <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><a href="#113996">zip</a></span>.<span class="typed"><span class="type">(Array[Byte],Int,Int)Unit</span><a id="114081">write</a></span> (<span class="typed"><span class="type">Array[Byte]</span><a href="#114146">buf</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Int</span><a href="#114147">n</a></span>)
            <span class="typed"><span class="type">Int</span><a href="#114147">n</a></span> = <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#114145">input</a></span>.<span class="typed"><span class="type">(Array[Byte],Int,Int)Int</span><a id="48683">read</a></span>(<span class="typed"><span class="type">Array[Byte]</span><a href="#114146">buf</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Array[Byte]</span><a href="#114146">buf</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21508">length</a></span>)
          }
          <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><a href="#113996">zip</a></span>.<span class="typed"><span class="type">()Unit</span><a id="114080">closeEntry</a></span>()
          <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#114145">input</a></span>.<span class="typed"><span class="type">()Unit</span><a id="48686">close</a></span>()
        }
      } <span class="keyword">else</span> <span class="typed"><span class="type">(java.lang.String,Int)Unit</span><a href="#13795" id="45633">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Archive contains no files.&quot;)</span><span class="string">&quot;Archive contains no files.&quot;</span></span>, Project.<span class="typed"><span class="type">Int(3)</span><span >MSG_VERBOSE</span></span>)
      <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><a href="#113996">zip</a></span>.<span class="typed"><span class="type">(java.util.zip.ZipEntry)Unit</span><a id="114079">putNextEntry</a></span>(<span class="typed"><span class="type">java.util.zip.ZipEntry</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.zip.ZipEntry</span><a id="40603">ZipEntry</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;meta/description&quot;)</span><span class="string">&quot;meta/description&quot;</span></span>))
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.StringReader</span><a id="113997">packInput</a></span> = <span class="typed"><span class="type">java.io.StringReader</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.StringReader</span><a id="3582">StringReader</a></span>(<span class="typed"><span class="type">scala.xml.Elem</span><a href="#113993">pack</a></span>.<span class="typed"><span class="type">()String</span><a id="65740">toString</a></span>())
      <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="113998">byte</a></span> = <span class="typed"><span class="type">java.io.StringReader</span><a href="#113997">packInput</a></span>.<span class="typed"><span class="type">()Int</span><a id="114225">read</a></span>()
      <span class="typed"><span class="type">Unit</span><a href="#113999" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#113998">byte</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3142">!=</a></span> -<span class="typed"><span class="type">Int(-1)</span><span class="int">1</span></span>) {
        <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><a href="#113996">zip</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a id="114091">write</a></span> (<span class="typed"><span class="type">Int</span><a href="#113998">byte</a></span>)
        <span class="typed"><span class="type">Int</span><a href="#113998">byte</a></span> = <span class="typed"><span class="type">java.io.StringReader</span><a href="#113997">packInput</a></span>.<span class="typed"><span class="type">()Int</span><a id="114225">read</a></span>()
      }
      <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><a href="#113996">zip</a></span>.<span class="typed"><span class="type">()Unit</span><a id="114080">closeEntry</a></span>()
      <span class="typed"><span class="type">java.io.StringReader</span><a href="#113997">packInput</a></span>.<span class="typed"><span class="type">()Unit</span><a id="114232">close</a></span>()
      <span class="typed"><span class="type">java.util.zip.ZipOutputStream</span><a href="#113996">zip</a></span>.<span class="typed"><span class="type">()Unit</span><a id="114083">close</a></span>
    }
  
  }
  
}

        </pre>
    </body>
</html>