<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/ant/FastScalac.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala Ant Tasks                      **
**    / __/ __// _ | / /  / _ |    (c) 2005-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

// $Id: FastScalac.scala 18387 2009-07-24 15:28:37Z odersky $

<span class="keyword">package</span> scala.tools.ant

/** &lt;p&gt;
 *    An Ant task to compile with the fast Scala compiler (&lt;code&gt;fsc&lt;/code&gt;).
 *  &lt;/p&gt;
 *  &lt;p&gt;
 *    In addition to the attributes shared with the &lt;code&gt;Scalac&lt;/code&gt;
 *    task, this task also accepts the following attributes:
 *  &lt;/p&gt;
 *  &lt;ul style=&quot;font-family:Courier;&quot;&gt;
 *    &lt;li&gt;reset&lt;/li&gt;
 *    &lt;li&gt;server&lt;/li&gt;
 *    &lt;li&gt;shutdown&lt;/li&gt;
 *  &lt;/ul&gt;
 *
 *  @author Stephane Micheloud
 */
<span class="keyword">class</span> <a title="class FastScalac extends scala.tools.ant.Scalac with ScalaObject" id="11304">FastScalac</a> <a title="ScalaObject" id="959" class="keyword">extends</a> <a href="Scalac.scala.html#11319" title="scala.tools.ant.Scalac">Scalac</a> {

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="59161">resetCaches</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[String]" id="59164">serverAddr</a>: <a title="Option[String]" id="782">Option</a>[String] = <a title="object None" id="465">None</a>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="59167">shutdownServer</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>

/*============================================================================*\
**                             Properties setters                             **
\*============================================================================*/

  /** Sets the &lt;code&gt;reset&lt;/code&gt; attribute. Used by Ant.
   *
   *  @param input The value for &lt;code&gt;reset&lt;/code&gt;.
   */
  <span class="keyword">def</span> <a title="(input: Boolean)Unit" id="59169">setReset</a>(<a title="Boolean" id="59179">input</a>: <span title="Boolean">Boolean</span>): <span title="Unit">Unit</span> =
    <a href="#59161" title="(x$1: Boolean)Unit">resetCaches</a> = <a href="#59179" title="Boolean">input</a>

  /** Sets the &lt;code&gt;server&lt;/code&gt; attribute. Used by Ant.
   *
   *  @param input The value for &lt;code&gt;server&lt;/code&gt;.
   */
  <span class="keyword">def</span> <a title="(input: String)Unit" id="59170">setServer</a>(<a title="String" id="59183">input</a>: <a title="String" id="1605">String</a>): <span title="Unit">Unit</span> = {
    <a href="#59164" title="(x$1: Option[String])Unit">serverAddr</a> = <a title="(x: String)Some[String]" id="258">Some</a>(<a href="#59183" title="String">input</a>)
  }

  /** Sets the &lt;code&gt;shutdown&lt;/code&gt; attribute. Used by Ant.
   *
   *  @param input The value for &lt;code&gt;shutdown&lt;/code&gt;.
   */
  <span class="keyword">def</span> <a title="(input: Boolean)Unit" id="59171">setShutdown</a>(<a title="Boolean" id="59192">input</a>: <span title="Boolean">Boolean</span>): <span title="Unit">Unit</span> =
    <a href="#59167" title="(x$1: Boolean)Unit">shutdownServer</a> = <a href="#59192" title="Boolean">input</a>

/*============================================================================*\
**                             The execute method                             **
\*============================================================================*/

  /** Performs the compilation. */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="59172">execute</a>() = {
    <span class="keyword">val</span> <a href="#32686" title="(scala.tools.nsc.Settings, List[java.io.File], Boolean)" id="396">(</a><a href="#59199" title="scala.tools.nsc.Settings" id="32686">settings</a>, <a href="#59199" title="List[java.io.File]" id="32688">sourceFiles</a>, <a href="#59199" title="Boolean" id="32690">javaOnly</a>) = <a href="Scalac.scala.html#59155" title="=&gt; (scala.tools.nsc.Settings, List[java.io.File], Boolean)">initialize</a>

    <span title="Unit" class="keyword">if</span> (<span title="(x$1: Boolean)Boolean">!</span><a href="#32688" title="List[java.io.File]">sourceFiles</a>.<span title="=&gt; Boolean">isEmpty</span> &amp;&amp; <span title="=&gt; Boolean">!</span><a href="#32690" title="Boolean">javaOnly</a>) {
      <span class="keyword">def</span> <a title="(xs: List[String])List[String]" id="59228">trim</a>(<a title="List[String]" id="59233">xs</a>: <a title="List[String]" id="7345">List</a>[String]) = <a href="#59233" title="(p: (String) =&gt; Boolean)List[String]" id="25253">xs</a> filter (<a title="String" id="59236">x</a> =&gt; <a href="#59236" title="String">x</a>.<a title="(x$1: Int)Boolean" id="6915">length</a> &gt; <span title="Int(0)" class="int">0</span>)
      <span class="keyword">val</span> <a title="scala.tools.nsc.Settings.BooleanSetting" id="59229">reset</a> = <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37227" title="(v1: String,v2: String)scala.tools.nsc.Settings.BooleanSetting">BooleanSetting</a>(<span title="java.lang.String(&quot;-reset&quot;)" class="string">&quot;-reset&quot;</span>, <span title="java.lang.String(&quot;Reset compile server caches&quot;)" class="string">&quot;Reset compile server caches&quot;</span>)
      <span class="keyword">val</span> <a title="scala.tools.nsc.Settings.BooleanSetting" id="59230">shutdown</a> = <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37227" title="(v1: String,v2: String)scala.tools.nsc.Settings.BooleanSetting">BooleanSetting</a>(<span title="java.lang.String(&quot;-shutdown&quot;)" class="string">&quot;-shutdown&quot;</span>, <span title="java.lang.String(&quot;Shutdown compile server&quot;)" class="string">&quot;Shutdown compile server&quot;</span>)

      <a href="#59229" title="scala.tools.nsc.Settings.BooleanSetting">reset</a>.<a href="../nsc/Settings.scala.html#37760" title="(arg: reset.T)Unit">value</a> = <a href="#59161" title="=&gt; Boolean">resetCaches</a>
      <a href="#59230" title="scala.tools.nsc.Settings.BooleanSetting">shutdown</a>.<a href="../nsc/Settings.scala.html#37760" title="(arg: shutdown.T)Unit">value</a> = <a href="#59167" title="=&gt; Boolean">shutdownServer</a>
      <span class="keyword">val</span> <a title="List[String]" id="59231">cmdOptions</a> =
        // StringSetting
        <span title="object List">List</span>.<a title="(xss: List[List[java.lang.String]])List[java.lang.String]" id="24330">flatten</a>(
          <span title="(xs: scala.tools.nsc.Settings.StringSetting*)List[scala.tools.nsc.Settings.StringSetting]">List</span><span title="(f: (scala.tools.nsc.Settings.StringSetting) =&gt; List[java.lang.String])(implicit bf: scala.collection.generic.BuilderFactory[List[java.lang.String],List[List[java.lang.String]],List[scala.tools.nsc.Settings.StringSetting]])List[List[java.lang.String]]">(</span><a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37038" title="=&gt; scala.tools.nsc.Settings.OutputSetting">outdir</a>, <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37036" title="=&gt; scala.tools.nsc.Settings.StringSetting">classpath</a>, <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37034" title="=&gt; scala.tools.nsc.Settings.StringSetting">bootclasspath</a>,
               <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37048" title="=&gt; scala.tools.nsc.Settings.StringSetting">extdirs</a>, <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37044" title="=&gt; scala.tools.nsc.Settings.StringSetting">encoding</a>) <span title="scala.collection.generic.BuilderFactory[List[java.lang.String],List[List[java.lang.String]],List#Coll]">map</span> (<a title="scala.tools.nsc.Settings.StringSetting" id="59281">s</a> =&gt; <span title="(xs: s.T*)List[s.T]">List</span>(<a href="#59281" title="scala.tools.nsc.Settings.StringSetting">s</a>.<a href="../nsc/Settings.scala.html#37729" title="=&gt; String">name</a>, <a href="#59281" title="scala.tools.nsc.Settings.StringSetting">s</a>.<a href="../nsc/Settings.scala.html#37759" title="=&gt; s.T">value</a>))) <a href="#59261" title="List[java.lang.String]">:::</a>
        // '-server' option
        (<span title="List[String]" class="keyword">if</span> (<a href="#59164" title="=&gt; Option[String]">serverAddr</a>.<a title="=&gt; Boolean" id="35041">isEmpty</a>) <a title="object Nil" id="7634">Nil</a> <span class="keyword">else</span> <span title="(xs: String*)List[String]">List</span>(<span title="java.lang.String(&quot;-server&quot;)" class="string">&quot;-server&quot;</span>, <a href="#59164" title="=&gt; Option[String]">serverAddr</a>.<a title="=&gt; String" id="35043">get</a>)) <a href="#59573" title="(prefix: List[String])List[String]">:::</a>
        // ChoiceSetting
        (<span title="(xs: scala.tools.nsc.Settings.ChoiceSetting*)List[scala.tools.nsc.Settings.ChoiceSetting]">List</span><span title="(f: (scala.tools.nsc.Settings.ChoiceSetting) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[scala.tools.nsc.Settings.ChoiceSetting]])List[java.lang.String]">(</span><a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37050" title="=&gt; scala.tools.nsc.Settings.DebugSetting">debuginfo</a>, <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37064" title="=&gt; scala.tools.nsc.Settings.ChoiceSetting">target</a>) <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">map</span> (<a title="scala.tools.nsc.Settings.ChoiceSetting" id="59811">s</a> =&gt; <a href="#59811" title="scala.tools.nsc.Settings.ChoiceSetting">s</a>.<a href="../nsc/Settings.scala.html#41614" title="(x$1: Any)java.lang.String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> + <a href="#59811" title="scala.tools.nsc.Settings.ChoiceSetting">s</a>.<a href="../nsc/Settings.scala.html#37759" title="=&gt; s.T">value</a>)) <a href="#59591" title="(prefix: List[String])List[String]">:::</a>
        // BooleanSetting
        <a href="#59228" title="(xs: List[String])List[String]">trim</a>(
          <span title="(xs: scala.tools.nsc.Settings.BooleanSetting*)List[scala.tools.nsc.Settings.BooleanSetting]">List</span><span title="(f: (scala.tools.nsc.Settings.BooleanSetting) =&gt; String)(implicit bf: scala.collection.generic.BuilderFactory[String,List[String],List[scala.tools.nsc.Settings.BooleanSetting]])List[String]">(</span><a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37150" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">debug</a>, <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37042" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">deprecation</a>, <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37164" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">nopredefs</a>,
               <a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37070" title="=&gt; scala.tools.nsc.Settings.BooleanSetting">verbose</a>, <a href="#59229" title="scala.tools.nsc.Settings.BooleanSetting">reset</a>, <a href="#59230" title="scala.tools.nsc.Settings.BooleanSetting">shutdown</a>) <span title="scala.collection.generic.BuilderFactory[String,List[String],List#Coll]">map</span> (<a title="scala.tools.nsc.Settings.BooleanSetting" id="59922">s</a> =&gt; <span title="String" class="keyword">if</span> (<a href="#59922" title="scala.tools.nsc.Settings.BooleanSetting">s</a>.<a href="../nsc/Settings.scala.html#37759" title="=&gt; s.T">value</a>) <a href="#59922" title="scala.tools.nsc.Settings.BooleanSetting">s</a>.<a href="../nsc/Settings.scala.html#38452" title="=&gt; String">name</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>)) <a href="#59896" title="(prefix: List[String])List[String]">:::</a>
        // PhaseSetting
        <a href="#59228" title="(xs: List[String])List[String]">trim</a><span title="(prefix: List[String])List[String]">(</span>
          <span title="(xs: scala.tools.nsc.Settings.PhasesSetting*)List[scala.tools.nsc.Settings.PhasesSetting]">List</span><span title="(f: (scala.tools.nsc.Settings.PhasesSetting) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[String],List[scala.tools.nsc.Settings.PhasesSetting]])List[String]">(</span><a href="#32686" title="scala.tools.nsc.Settings">settings</a>.<a href="../nsc/Settings.scala.html#37158" title="=&gt; scala.tools.nsc.Settings.PhasesSetting">log</a>) <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">map</span> (<a title="scala.tools.nsc.Settings.PhasesSetting" id="60125">s</a> =&gt; <span title="java.lang.String" class="keyword">if</span> (<a href="#60125" title="scala.tools.nsc.Settings.PhasesSetting">s</a>.<a href="../nsc/Settings.scala.html#37759" title="=&gt; s.T">value</a>.<span title="=&gt; Boolean">isEmpty</span>) <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <a href="#60125" title="scala.tools.nsc.Settings.PhasesSetting">s</a>.<a href="../nsc/Settings.scala.html#60016" title="(x$1: Any)java.lang.String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> + <a href="#60125" title="scala.tools.nsc.Settings.PhasesSetting">s</a>.<a href="../nsc/Settings.scala.html#37759" title="=&gt; s.T">value</a>))

      <span class="keyword">val</span> <a title="Array[java.lang.String]" id="59232">args</a> = (<a href="#59231" title="List[String]">cmdOptions</a> <a href="#60188" title="List[String]">:::</a> <span title="(prefix: List[java.lang.String])List[java.lang.String]">(</span><a href="#32688" title="(f: (java.io.File) =&gt; java.lang.String)(implicit bf: scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List[java.io.File]])List[java.lang.String]">sourceFiles</a> <span title="scala.collection.generic.BuilderFactory[java.lang.String,List[java.lang.String],List#Coll]">map</span> (<a href="#60197" title="java.io.File">_</a>.<a title="()java.lang.String" id="35248">toString</a>))).<a title="(implicit evidence$1: scala.reflect.ClassManifest[java.lang.String])Array[java.lang.String]" id="27330">toArray</a>
      <span class="keyword">try</span> {
        <span title="Unit" class="keyword">if</span> (scala.tools.nsc.<a href="../nsc/CompileClient.scala.html#8314" title="object scala.tools.nsc.CompileClient">CompileClient</a>.<a href="../nsc/CompileClient.scala.html#60319" title="(args0: Array[String])Int">main0</a><span title="(x$1: Int)Boolean">(</span><a href="#59232" title="Array[java.lang.String]">args</a>) <span title="(x$1: Boolean)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> &amp;&amp; <a href="Scalac.scala.html#59089" title="=&gt; Boolean">failonerror</a>)
          <a href="Scalac.scala.html#59152" title="(message: String)Nothing">error</a>(<span title="java.lang.String(&quot;Compile failed; see the compiler error output for details.&quot;)" class="string">&quot;Compile failed; see the compiler error output for details.&quot;</span>)
      } 
      <span class="keyword">catch</span> {
        <span title="Nothing" class="keyword">case</span> <a title="java.lang.Throwable" id="60338">exception</a>: <a title="Throwable" id="1887">Throwable</a> <span class="keyword">if</span> (<a href="#60338" title="java.lang.Throwable">exception</a>.<a title="(x$1: AnyRef)Boolean" id="6544">getMessage</a> ne <span title="Null(null)" class="keyword">null</span>) =&gt;
          <a href="#60338" title="java.lang.Throwable">exception</a>.<span title="()Unit">printStackTrace</span>()
          <a href="Scalac.scala.html#59152" title="(message: String)Nothing">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;Compile failed because of an internal compiler error (&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
            <a href="#60338" title="java.lang.Throwable">exception</a>.<span title="()java.lang.String">getMessage</span> + <span title="java.lang.String(&quot;); see the error output for details.&quot;)" class="string">&quot;); see the error output for details.&quot;</span>)
        <span title="Nothing" class="keyword">case</span> <a title="java.lang.Throwable" id="60363">exception</a> =&gt;
          <a href="#60363" title="java.lang.Throwable">exception</a>.<span title="()Unit">printStackTrace</span>()
          <a href="Scalac.scala.html#59152" title="(message: String)Nothing">error</a>(<span class="string">&quot;Compile failed because of an internal compiler error &quot;</span> <span title="java.lang.String(&quot;Compile failed because of an internal compiler error (no error message provided); see the error output for details.&quot;)">+</span>
            <span class="string">&quot;(no error message provided); see the error output for details.&quot;</span>)
      }
    }
  }
}

        </pre>
    </body>
</html>