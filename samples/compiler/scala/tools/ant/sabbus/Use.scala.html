<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/ant/sabbus/Use.scala</title>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala Ant Tasks                      **
**    / __/ __// _ | / /  / _ |    (c) 2005-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: Use.scala 17235 2009-03-03 18:43:32Z michelou $</span>

<span class="keyword">package</span> scala.tools.ant.sabbus

<span class="keyword">import</span> java.io.File

<span class="keyword">import</span> org.apache.tools.ant.taskdefs.MatchingTask
<span class="keyword">import</span> org.apache.tools.ant.types.{Path, Reference}
<span class="keyword">import</span> org.apache.tools.ant.util.{GlobPatternMapper, SourceFileScanner}

<span class="keyword">class</span> <span class="typed"><span class="type">class Use extends org.apache.tools.ant.taskdefs.MatchingTask with ScalaObject</span><a id="18482">Use</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">org.apache.tools.ant.taskdefs.MatchingTask</span><a id="44197">MatchingTask</a></span> {
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="130729">setId</a></span>(<span class="typed"><span class="type">String</span><a id="130751">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) {
    <span class="typed"><span class="type">(Option[String])Unit</span><a href="#130734">id</a></span> = <span class="typed"><span class="type">(String)Some[String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#130751">input</a></span>)
  }
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)Unit</span><a id="130730">setSrcdir</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="130753">input</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) {
    <span class="typed"><span class="type">(Option[java.io.File])Unit</span><a href="#130737">sourceDir</a></span> = <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#130753">input</a></span>)
  }
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)Unit</span><a id="130731">setDestdir</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="130755">input</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) {
    <span class="typed"><span class="type">(Option[java.io.File])Unit</span><a href="#130740">destinationDir</a></span> = <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#130755">input</a></span>)
  }
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(Boolean)Unit</span><a id="130732">setFailOnError</a></span>(<span class="typed"><span class="type">Boolean</span><a id="130757">input</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span>) {
    <span class="typed"><span class="type">(Boolean)Unit</span><a href="#130743">failOnError</a></span> = <span class="typed"><span class="type">Boolean</span><a href="#130757">input</a></span>
  }
  
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[String]</span><span id="130735"><span id="130733"><span id="130734"><a id="130747">id</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[java.io.File]</span><span id="130738"><span id="130736"><span id="130737"><a id="130748">sourceDir</a></span></span></span></span>: <span class="typed"><span class="type">Option[java.io.File]</span><a id="934">Option</a></span>[File] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[java.io.File]</span><span id="130741"><span id="130739"><span id="130740"><a id="130749">destinationDir</a></span></span></span></span>: <span class="typed"><span class="type">Option[java.io.File]</span><a id="934">Option</a></span>[File] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="130744"><span id="130742"><span id="130743"><a id="130750">failOnError</a></span></span></span></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
  
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="130745">execute</a></span>() {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#130733">id</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><span id="6000"><a id="821">error</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;Mandatory attribute 'id' is not set.&quot;)</span><span class="string">&quot;Mandatory attribute 'id' is not set.&quot;</span></span>)
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#130736">sourceDir</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><span id="6000"><a id="821">error</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;Mandatory attribute 'srcdir' is not set.&quot;)</span><span class="string">&quot;Mandatory attribute 'srcdir' is not set.&quot;</span></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.ant.sabbus.Compiler</span><a id="130758">compiler</a></span> = <span class="typed"><span class="type">(String)scala.tools.ant.sabbus.Compiler</span><a href="Compilers.scala.html#18438" id="24239">Compilers</a></span>(<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#130733">id</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="25408">get</a></span>)
    <span class="typed"><span class="type">Any</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#130739">destinationDir</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">scala.tools.ant.sabbus.Compiler</span><a href="#130758">compiler</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.ant.sabbus.Settings</span><a href="Compiler.scala.html#130776">settings</a></span>.<span class="typed"><span class="type">(java.io.File)compiler.settings.type</span><a href="Settings.scala.html#130824">d</a></span> = <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#130739">destinationDir</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">org.apache.tools.ant.util.GlobPatternMapper</span><a id="130759">mapper</a></span> = <span class="typed"><span class="type">org.apache.tools.ant.util.GlobPatternMapper</span><span class="keyword">new</span></span> <span class="typed"><span class="type">org.apache.tools.ant.util.GlobPatternMapper</span><a id="45216">GlobPatternMapper</a></span>()
    <span class="typed"><span class="type">org.apache.tools.ant.util.GlobPatternMapper</span><a href="#130759">mapper</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="46377">setTo</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;*.class&quot;)</span><span class="string">&quot;*.class&quot;</span></span>)
    <span class="typed"><span class="type">org.apache.tools.ant.util.GlobPatternMapper</span><a href="#130759">mapper</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="46376">setFrom</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;*.scala&quot;)</span><span class="string">&quot;*.scala&quot;</span></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">Array[java.io.File]</span><a id="130760">includedFiles</a></span>: <span class="typed"><span class="type">Array[java.io.File]</span><a id="1072">Array</a></span>[File] =
      <span class="typed"><span class="type">org.apache.tools.ant.util.SourceFileScanner</span><span class="keyword">new</span></span> <span class="typed"><span class="type">org.apache.tools.ant.util.SourceFileScanner</span><a id="45102">SourceFileScanner</a></span>(<span class="typed"><span class="type">scala.tools.ant.sabbus.Use</span><a href="#18482" class="keyword">this</a></span>).<span class="typed"><span class="type">(Array[java.lang.String],java.io.File,java.io.File,org.apache.tools.ant.util.FileNameMapper)Array[java.lang.String]</span><a id="56102">restrict</a></span>(
        <span class="typed"><span class="type">(java.io.File)org.apache.tools.ant.DirectoryScanner</span><a href="#18482" id="45447">getDirectoryScanner</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#130736">sourceDir</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>).<span class="typed"><span class="type">()Array[java.lang.String]</span><a id="46222">getIncludedFiles</a></span>,
        <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#130736">sourceDir</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>,
        <span class="typed"><span class="type">scala.tools.ant.sabbus.Compiler</span><a href="#130758">compiler</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.ant.sabbus.Settings</span><a href="Compiler.scala.html#130776">settings</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a href="Settings.scala.html#130823">d</a></span>,
        <span class="typed"><span class="type">org.apache.tools.ant.util.GlobPatternMapper</span><a href="#130759">mapper</a></span>
      ) <span class="typed"><span class="type">((java.lang.String) =&gt; java.io.File)Array[java.io.File]</span><a id="21516">map</a></span> (<span class="typed"><span class="type">(java.io.File,java.lang.String)java.io.File</span><a id="40682" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#130736">sourceDir</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>, <span class="typed"><span class="type">java.lang.String</span><a href="#130872">_</a></span>))
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Array[java.io.File]</span><a href="#130760">includedFiles</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
      <span class="keyword">try</span> {
        <span class="typed"><span class="type">(java.lang.String)Unit</span><a href="#18482" id="45632">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Compiling &quot;)</span><span class="string">&quot;Compiling &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">Array[java.io.File]</span><a href="#130760">includedFiles</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; file&quot;)</span><span class="string">&quot; file&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> (<span class="typed"><span class="type">Any</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Array[java.io.File]</span><a href="#130760">includedFiles</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="21644">size</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="typed"><span class="type">java.lang.String(&quot;s&quot;)</span><span class="string">&quot;s&quot;</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; to &quot;)</span><span class="string">&quot; to &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">scala.tools.ant.sabbus.Compiler</span><a href="#130758">compiler</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.ant.sabbus.Settings</span><a href="Compiler.scala.html#130776">settings</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a href="Settings.scala.html#130823">d</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="40689">getAbsolutePath</a></span>)
        <span class="keyword">val</span> <span class="typed"><span class="type">(Int, Int)</span><span id="23625"><a href="#130899" id="1379">(</a></span></span><span class="typed"><span class="type">Int</span><span id="130899"><span id="130894"><a href="#130893" id="23614">errors</a></span></span></span>, <span class="typed"><span class="type">Int</span><span id="130900"><span id="130895"><a href="#130893" id="23616">warnings</a></span></span></span>) = <span class="typed"><span class="type">scala.tools.ant.sabbus.Compiler</span><a href="#130758">compiler</a></span>.<span class="typed"><span class="type">(Array[java.io.File])(Int, Int)</span><a href="Compiler.scala.html#130787">compile</a></span>(<span class="typed"><span class="type">Array[java.io.File]</span><a href="#130760">includedFiles</a></span>)
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#130894">errors</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
          <span class="typed"><span class="type">(String)Nothing</span><span id="6000"><a id="821">error</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;Compilation failed with &quot;)</span><span class="string">&quot;Compilation failed with &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">Int</span><a href="#130894">errors</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; error&quot;)</span><span class="string">&quot; error&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> (<span class="typed"><span class="type">Any</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#130894">errors</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="typed"><span class="type">java.lang.String(&quot;s&quot;)</span><span class="string">&quot;s&quot;</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;.&quot;)</span><span class="string">&quot;.&quot;</span></span>)
        <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#130895">warnings</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
          <span class="typed"><span class="type">(java.lang.String)Unit</span><a href="#18482" id="45632">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Compilation suceeded with &quot;)</span><span class="string">&quot;Compilation suceeded with &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">Int</span><a href="#130895">warnings</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; warning&quot;)</span><span class="string">&quot; warning&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> (<span class="typed"><span class="type">Any</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#130895">warnings</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="typed"><span class="type">java.lang.String(&quot;s&quot;)</span><span class="string">&quot;s&quot;</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;.&quot;)</span><span class="string">&quot;.&quot;</span></span>)
      }
      <span class="keyword">catch</span> {
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">CompilationFailure</a>(<span class="typed"><span class="type">String</span><a id="130925">msg</a></span>, <span class="typed"><span class="type">Exception</span><a id="130926">ex</a></span>) =&gt;
          <span class="typed"><span class="type">Exception</span><a href="#130926">ex</a></span>.<span class="typed"><span class="type">()Unit</span><a id="23651">printStackTrace</a></span>
          <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="130927">errorMsg</a></span> =
            <span class="typed"><span class="type">java.lang.String(&quot;Compilation failed because of an internal compiler error (&quot;)</span><span class="string">&quot;Compilation failed because of an internal compiler error (&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">String</span><a href="#130925">msg</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;); see the error output for details.&quot;)</span><span class="string">&quot;); see the error output for details.&quot;</span></span>
          <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a href="#130742">failOnError</a></span>) <span class="typed"><span class="type">(String)Nothing</span><span id="6000"><a id="821">error</a></span></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#130927">errorMsg</a></span>) <span class="keyword">else</span> <span class="typed"><span class="type">(java.lang.String)Unit</span><a href="#18482" id="45632">log</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#130927">errorMsg</a></span>)
      }
  }
  
}

        </pre>
    </body>
</html>