<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/tools/ant/Same.scala</title>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala Ant Tasks                      **
**    / __/ __// _ | / /  / _ |    (c) 2005-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: Same.scala 16893 2009-01-13 13:09:22Z cunei $</span>

<span class="keyword">package</span> scala.tools.ant

<span class="keyword">import</span> java.io.{File, FileInputStream}

<span class="keyword">import</span> org.apache.tools.ant.{BuildException, Project}
<span class="keyword">import</span> org.apache.tools.ant.taskdefs.MatchingTask
<span class="keyword">import</span> org.apache.tools.ant.util.FileUtils
<span class="keyword">import</span> org.apache.tools.ant.util.{FileNameMapper, IdentityMapper}

<span class="keyword">import</span> org.apache.tools.ant.types.Mapper

<span class="comment">/** &lt;p&gt;
 *    An Ant task that, for a set of files, tests them for byte-to-byte
 *    equality with one or more other files.
 *    This task supports the following parameters as attributes:
 *  &lt;/p&gt;&lt;ul&gt;
 *  &lt;li&gt;dir&lt;/li&gt;
 *  &lt;li&gt;todir&lt;/li&gt;
 *  &lt;li&gt;resultproperty (a property to be set when all tested files pairs are equal, if not set, the task will fail instead),&lt;/li&gt;
 *  &lt;li&gt;failing (whether to stop if all files are not equal).&lt;/li&gt;&lt;/ul&gt;
 *  &lt;p&gt;It also support the following nested elements:&lt;/p&gt;&lt;ul&gt;
 *  &lt;li&gt;mapper (a mapper from original files to test files).&lt;/li&gt;&lt;/ul&gt;
 *  &lt;p&gt;This task itself defines a fileset that represents the set of original files.&lt;/p&gt;
 *
 * @author  Gilles Dubochet
 * @version 1.0 */</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class Same extends org.apache.tools.ant.taskdefs.MatchingTask with ScalaObject</span><a id="13837">Same</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">org.apache.tools.ant.taskdefs.MatchingTask</span><a id="44197">MatchingTask</a></span> {

  <span class="comment">/** The unique Ant file utilities instance to use in this task. */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">org.apache.tools.ant.util.FileUtils</span><span id="81896"><a id="81895">fileUtils</a></span></span> = <span class="typed"><span class="type">object org.apache.tools.ant.util.FileUtils</span><a id="45154">FileUtils</a></span>.<span class="typed"><span class="type">()org.apache.tools.ant.util.FileUtils</span><a id="45673">newFileUtils</a></span>()

<span class="comment">/*============================================================================*\
**                             Ant user-properties                            **
\*============================================================================*/</span>
  
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[java.io.File]</span><span id="81899"><span id="81897"><span id="81898"><a id="81927">origin</a></span></span></span></span>: <span class="typed"><span class="type">Option[java.io.File]</span><a id="934">Option</a></span>[File] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[java.io.File]</span><span id="81902"><span id="81900"><span id="81901"><a id="81928">destination</a></span></span></span></span>: <span class="typed"><span class="type">Option[java.io.File]</span><a id="934">Option</a></span>[File] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
  
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[String]</span><span id="81905"><span id="81903"><span id="81904"><a id="81929">resultProperty</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="934">Option</a></span>[String] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="81908"><span id="81906"><span id="81907"><a id="81930">failing</a></span></span></span></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
  
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Option[org.apache.tools.ant.types.Mapper]</span><span id="81911"><span id="81909"><span id="81910"><a id="81955">mapperElement</a></span></span></span></span>: <span class="typed"><span class="type">Option[org.apache.tools.ant.types.Mapper]</span><a id="934">Option</a></span>[Mapper] = <span class="typed"><span class="type">object None</span><a id="536">None</a></span>

<span class="comment">/*============================================================================*\
**                             Properties setters                             **
\*============================================================================*/</span>
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)Unit</span><a id="81912">setDir</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="81957">input</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) =
    <span class="typed"><span class="type">(Option[java.io.File])Unit</span><a href="#81898">origin</a></span> = <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#81957">input</a></span>)
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)Unit</span><a id="81913">setTodir</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="81960">input</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) =
    <span class="typed"><span class="type">(Option[java.io.File])Unit</span><a href="#81901">destination</a></span> = <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><a href="#81960">input</a></span>)
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="81914">setResultproperty</a></span>(<span class="typed"><span class="type">String</span><a id="81963">input</a></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span>) =
    <span class="typed"><span class="type">(Option[String])Unit</span><a href="#81904">resultProperty</a></span> = <span class="typed"><span class="type">(String)Some[String]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#81963">input</a></span>)
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(Boolean)Unit</span><a id="81915">setFailondifferent</a></span>(<span class="typed"><span class="type">Boolean</span><a id="81966">input</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2170">Boolean</a></span>) =
    <span class="typed"><span class="type">(Boolean)Unit</span><a href="#81907">failing</a></span> = <span class="typed"><span class="type">Boolean</span><a href="#81966">input</a></span>
  
  <span class="keyword">def</span> <span class="typed"><span class="type">()org.apache.tools.ant.types.Mapper</span><a id="81916">createMapper</a></span>(): <span class="typed"><span class="type">org.apache.tools.ant.types.Mapper</span><a id="44909">Mapper</a></span> =
    <span class="typed"><span class="type">org.apache.tools.ant.types.Mapper</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[org.apache.tools.ant.types.Mapper]</span><a href="#81909">mapperElement</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) {
      <span class="keyword">val</span> <span class="typed"><span class="type">org.apache.tools.ant.types.Mapper</span><a id="81968">mapper</a></span> = <span class="typed"><span class="type">org.apache.tools.ant.types.Mapper</span><span class="keyword">new</span></span> <span class="typed"><span class="type">org.apache.tools.ant.types.Mapper</span><a id="44909">Mapper</a></span>(<span class="typed"><span class="type">()org.apache.tools.ant.Project</span><a href="#13837" id="45414">getProject</a></span>)
      <span class="typed"><span class="type">(Option[org.apache.tools.ant.types.Mapper])Unit</span><a href="#81910">mapperElement</a></span> = <span class="typed"><span class="type">(org.apache.tools.ant.types.Mapper)Some[org.apache.tools.ant.types.Mapper]</span><span id="29737"><a id="308">Some</a></span></span>(<span class="typed"><span class="type">org.apache.tools.ant.types.Mapper</span><a href="#81968">mapper</a></span>)
      <span class="typed"><span class="type">org.apache.tools.ant.types.Mapper</span><a href="#81968">mapper</a></span>
    }
    <span class="keyword">else</span> <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,org.apache.tools.ant.Location)org.apache.tools.ant.BuildException</span><a id="46264" class="keyword">new</a></span> <span class="typed"><span class="type">org.apache.tools.ant.BuildException</span><a id="43886">BuildException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Cannot define more than one mapper&quot;)</span><span class="string">&quot;Cannot define more than one mapper&quot;</span></span>, <span class="typed"><span class="type">()org.apache.tools.ant.Location</span><a href="#13837" id="45415">getLocation</a></span>)
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(org.apache.tools.ant.util.FileNameMapper)Unit</span><a id="81917">add</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.util.FileNameMapper</span><a id="81983">fileNameMapper</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.util.FileNameMapper</span><a id="45231">FileNameMapper</a></span>) =
    <span class="typed"><span class="type">()org.apache.tools.ant.types.Mapper</span><a href="#81916">createMapper</a></span>().<span class="typed"><span class="type">(org.apache.tools.ant.util.FileNameMapper)Unit</span><a id="81942">add</a></span>(<span class="typed"><span class="type">org.apache.tools.ant.util.FileNameMapper</span><a href="#81983">fileNameMapper</a></span>)

<span class="comment">/*============================================================================*\
**                             Properties getters                             **
\*============================================================================*/</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; org.apache.tools.ant.util.FileNameMapper</span><a id="81918">getMapper</a></span>: <span class="typed"><span class="type">org.apache.tools.ant.util.FileNameMapper</span><a id="45231">FileNameMapper</a></span> = <span class="typed"><span class="type">=&gt; Option[org.apache.tools.ant.types.Mapper]</span><a href="#81909">mapperElement</a></span> <span class="typed"><span class="type">org.apache.tools.ant.util.FileNameMapper</span><span class="keyword">match</span></span> {
    <span class="typed"><span class="type">org.apache.tools.ant.util.IdentityMapper</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="536">None</a></span> =&gt;
      <span class="typed"><span class="type">org.apache.tools.ant.util.IdentityMapper</span><span class="keyword">new</span></span> <span class="typed"><span class="type">org.apache.tools.ant.util.IdentityMapper</span><a id="45240">IdentityMapper</a></span>()
    <span class="typed"><span class="type">org.apache.tools.ant.util.FileNameMapper</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">org.apache.tools.ant.types.Mapper</span><a id="81990">me</a></span>) =&gt;
      <span class="typed"><span class="type">org.apache.tools.ant.types.Mapper</span><a href="#81990">me</a></span>.<span class="typed"><span class="type">()org.apache.tools.ant.util.FileNameMapper</span><a id="81951">getImplementation</a></span>
  }

<span class="comment">/*============================================================================*\
**                               Support methods                              **
\*============================================================================*/</span>
  
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="81921"><span id="81919"><span id="81920"><a id="81956">allEqualNow</a></span></span></span></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
  
  <span class="comment">/** Tests if all mandatory attributes are set and valid. */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Unit</span><a id="81922">validateAttributes</a></span> = {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81897">origin</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><span id="6000"><a id="821">error</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;Mandatory attribute 'dir' is not set.&quot;)</span><span class="string">&quot;Mandatory attribute 'dir' is not set.&quot;</span></span>)
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81900">destination</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>) <span class="typed"><span class="type">(String)Nothing</span><span id="6000"><a id="821">error</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;Mandatory attribute 'todir' is not set.&quot;)</span><span class="string">&quot;Mandatory attribute 'todir' is not set.&quot;</span></span>)
  }
  
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File,java.io.File)Unit</span><a id="81923">reportDiff</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="81993">f1</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>, <span class="typed"><span class="type">java.io.File</span><a id="81994">f2</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) = {
    <span class="typed"><span class="type">(Boolean)Unit</span><a href="#81920">allEqualNow</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
    <span class="typed"><span class="type">(java.lang.String)Unit</span><a href="#13837" id="45632">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;File '&quot;)</span><span class="string">&quot;File '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.io.File</span><a href="#81993">f1</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;' is different from correspondant.&quot;)</span><span class="string">&quot;' is different from correspondant.&quot;</span></span>)
  }
  
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.File)Unit</span><a id="81924">reportMissing</a></span>(<span class="typed"><span class="type">java.io.File</span><a id="81997">f1</a></span>: <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>) = {
    <span class="typed"><span class="type">(Boolean)Unit</span><a href="#81920">allEqualNow</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
    <span class="typed"><span class="type">(java.lang.String)Unit</span><a href="#13837" id="45632">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;File '&quot;)</span><span class="string">&quot;File '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.io.File</span><a href="#81997">f1</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;' has no correspondant.&quot;)</span><span class="string">&quot;' has no correspondant.&quot;</span></span>)
  }

<span class="comment">/*============================================================================*\
**                           The big execute method                           **
\*============================================================================*/</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="81925">execute</a></span>() = {
    <span class="typed"><span class="type">=&gt; Unit</span><a href="#81922">validateAttributes</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">org.apache.tools.ant.util.FileNameMapper</span><a id="82001">mapper</a></span> = <span class="typed"><span class="type">=&gt; org.apache.tools.ant.util.FileNameMapper</span><a href="#81918">getMapper</a></span>
    <span class="typed"><span class="type">(Boolean)Unit</span><a href="#81920">allEqualNow</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">Array[String]</span><a id="82002">originNames</a></span>: <span class="typed"><span class="type">Array[String]</span><a id="1072">Array</a></span>[String] = <span class="typed"><span class="type">(java.io.File)org.apache.tools.ant.DirectoryScanner</span><a href="#13837" id="45447">getDirectoryScanner</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81897">origin</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>).<span class="typed"><span class="type">()Array[java.lang.String]</span><a id="46222">getIncludedFiles</a></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="82003">bufferSize</a></span> = <span class="typed"><span class="type">Int(1024)</span><span class="int">1024</span></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">Array[Byte]</span><a id="82004">originBuffer</a></span> = <span class="typed"><span class="type">Array[Byte]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Byte]</span><a id="1072">Array</a></span>[Byte](<span class="typed"><span class="type">Int</span><a href="#82003">bufferSize</a></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">Array[Byte]</span><a id="82005">destBuffer</a></span> = <span class="typed"><span class="type">Array[Byte]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Byte]</span><a id="1072">Array</a></span>[Byte](<span class="typed"><span class="type">Int</span><a href="#82003">bufferSize</a></span>)
    <span class="keyword">for</span> (
      <span class="typed"><span class="type">((String) =&gt; Unit)Unit</span><span id="21792"><a id="82012">originName</a></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> &lt;- <span class="typed"><span class="type">Array[String]</span><a href="#82002">originNames</a></span>; 
      <span class="typed"><span class="type">((java.lang.String) =&gt; Unit)Unit</span><span id="21792"><a id="82014">destName</a></span></span>: <span class="typed"><span class="type">String</span><a id="1861">String</a></span> &lt;- <span class="typed"><span class="type">org.apache.tools.ant.util.FileNameMapper</span><a href="#82001">mapper</a></span>.<span class="typed"><span class="type">(java.lang.String)Array[java.lang.String]</span><a id="46382">mapFileName</a></span>(<span class="typed"><span class="type">String</span><a href="#82012">originName</a></span>)
    ) {
      <span class="comment">//println(&quot;originName=&quot;+originName)</span>
      <span class="comment">//println(&quot;destName  =&quot;+destName)</span>
      <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><a id="82015">equalNow</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="82016">originFile</a></span> = <span class="typed"><span class="type">(java.io.File,java.lang.String)java.io.File</span><a id="40682" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81897">origin</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>, <span class="typed"><span class="type">String</span><a href="#82012">originName</a></span>)
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><a id="82017">destFile</a></span> = <span class="typed"><span class="type">(java.io.File,java.lang.String)java.io.File</span><a id="40682" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.File</span><a id="3669">File</a></span>(<span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81900">destination</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span>, <span class="typed"><span class="type">String</span><a href="#82014">destName</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.io.File</span><a href="#82016">originFile</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40695">canRead</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">java.io.File</span><a href="#82017">destFile</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="40695">canRead</a></span>) {
        <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileInputStream</span><a id="82055">originStream</a></span> = <span class="typed"><span class="type">(java.io.File)java.io.FileInputStream</span><a id="48679" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileInputStream</span><a id="3810">FileInputStream</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#82016">originFile</a></span>)
        <span class="keyword">val</span> <span class="typed"><span class="type">java.io.FileInputStream</span><a id="82056">destStream</a></span> = <span class="typed"><span class="type">(java.io.File)java.io.FileInputStream</span><a id="48679" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.FileInputStream</span><a id="3810">FileInputStream</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#82017">destFile</a></span>)
        <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="82057">originRemaining</a></span> = <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#82055">originStream</a></span>.<span class="typed"><span class="type">(Array[Byte])Int</span><a id="48682">read</a></span>(<span class="typed"><span class="type">Array[Byte]</span><a href="#82004">originBuffer</a></span>)
        <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="82058">destRemaining</a></span> = <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#82056">destStream</a></span>.<span class="typed"><span class="type">(Array[Byte])Int</span><a id="48682">read</a></span>(<span class="typed"><span class="type">Array[Byte]</span><a href="#82005">destBuffer</a></span>)
        <span class="typed"><span class="type">Unit</span><a href="#82059" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#82057">originRemaining</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> <span class="typed"><span class="type">Boolean</span><a href="#82015">equalNow</a></span>) {
          <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#82057">originRemaining</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">==</a></span> <span class="typed"><span class="type">Int</span><a href="#82058">destRemaining</a></span>)
            <span class="keyword">for</span> (<span class="typed"><span class="type">((Int) =&gt; Unit)Unit</span><span id="40475"><a id="82076">idx</a></span></span> &lt;- <span class="typed"><span class="type">implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt</span><span id="6133"><a id="821" class="int">0</a></span></span> <span class="typed"><span class="type">(Int)Range</span><a id="26778">until</a></span> <span class="typed"><span class="type">Int</span><a href="#82057">originRemaining</a></span>)
              <span class="typed"><span class="type">Boolean</span><a href="#82015">equalNow</a></span> = <span class="typed"><span class="type">Boolean</span><a href="#82015">equalNow</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2751">&amp;&amp;</a></span> (<span class="typed"><span class="type">(Int)Byte</span><a href="#82004" id="21509">originBuffer</a></span>(<span class="typed"><span class="type">Int</span><a href="#82076">idx</a></span>) <span class="typed"><span class="type">(Byte)Boolean</span><a id="2772">==</a></span> <span class="typed"><span class="type">(Int)Byte</span><a href="#82005" id="21509">destBuffer</a></span>(<span class="typed"><span class="type">Int</span><a href="#82076">idx</a></span>))
          <span class="keyword">else</span>
            <span class="typed"><span class="type">Boolean</span><a href="#82015">equalNow</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
          <span class="typed"><span class="type">Int</span><a href="#82057">originRemaining</a></span> = <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#82055">originStream</a></span>.<span class="typed"><span class="type">(Array[Byte])Int</span><a id="48682">read</a></span>(<span class="typed"><span class="type">Array[Byte]</span><a href="#82004">originBuffer</a></span>)
          <span class="typed"><span class="type">Int</span><a href="#82058">destRemaining</a></span> = <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#82056">destStream</a></span>.<span class="typed"><span class="type">(Array[Byte])Int</span><a id="48682">read</a></span>(<span class="typed"><span class="type">Array[Byte]</span><a href="#82005">destBuffer</a></span>)
        }
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#82058">destRemaining</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3145">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
          <span class="typed"><span class="type">Boolean</span><a href="#82015">equalNow</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">Boolean</span><a href="#82015">equalNow</a></span>)
          <span class="typed"><span class="type">(java.io.File,java.io.File)Unit</span><a href="#81923">reportDiff</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#82016">originFile</a></span>, <span class="typed"><span class="type">java.io.File</span><a href="#82017">destFile</a></span>)
        <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#82055">originStream</a></span>.<span class="typed"><span class="type">()Unit</span><a id="48686">close</a></span>
        <span class="typed"><span class="type">java.io.FileInputStream</span><a href="#82056">destStream</a></span>.<span class="typed"><span class="type">()Unit</span><a id="48686">close</a></span>
      }
      <span class="keyword">else</span> <span class="typed"><span class="type">(java.io.File)Unit</span><a href="#81924">reportMissing</a></span>(<span class="typed"><span class="type">java.io.File</span><a href="#82016">originFile</a></span>)
    }
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; Boolean</span><a href="#81919">allEqualNow</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a href="#81906">failing</a></span>)
        <span class="typed"><span class="type">(String)Nothing</span><span id="6000"><a id="821">error</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;There were differences between '&quot;)</span><span class="string">&quot;There were differences between '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81897">origin</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;' and '&quot;)</span><span class="string">&quot;' and '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81900">destination</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;'&quot;)</span><span class="string">&quot;'&quot;</span></span>)
      <span class="keyword">else</span>
        <span class="typed"><span class="type">(java.lang.String)Unit</span><a href="#13837" id="45632">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;There were differences between '&quot;)</span><span class="string">&quot;There were differences between '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81897">origin</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;' and '&quot;)</span><span class="string">&quot;' and '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81900">destination</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;'&quot;)</span><span class="string">&quot;'&quot;</span></span>)
    <span class="keyword">else</span> {
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2747">!</a></span><span class="typed"><span class="type">=&gt; Option[String]</span><a href="#81903">resultProperty</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="25406">isEmpty</a></span>)
        <span class="typed"><span class="type">()org.apache.tools.ant.Project</span><a href="#13837" id="45414">getProject</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)Unit</span><a id="45886">setProperty</a></span>(<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#81903">resultProperty</a></span>.<span class="typed"><span class="type">=&gt; String</span><a id="25408">get</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;yes&quot;)</span><span class="string">&quot;yes&quot;</span></span>)
      <span class="typed"><span class="type">(java.lang.String,Int)Unit</span><a href="#13837" id="45633">log</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;All files in '&quot;)</span><span class="string">&quot;All files in '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81897">origin</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;' and '&quot;)</span><span class="string">&quot;' and '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">=&gt; Option[java.io.File]</span><a href="#81900">destination</a></span>.<span class="typed"><span class="type">=&gt; java.io.File</span><a id="25408">get</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5802">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;' are equal&quot;)</span><span class="string">&quot;' are equal&quot;</span></span>, Project.<span class="typed"><span class="type">Int(3)</span><span >MSG_VERBOSE</span></span>)
    }
  }

}

        </pre>
    </body>
</html>