<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>BrowsePlugin.scala</title>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sxr -- Scala X-Ray
 * Copyright 2009 Mark Harrah
 */</span>

<span class="keyword">package</span> sxr

<span class="keyword">import</span> scala.tools.nsc.{plugins, Global, Phase}
<span class="keyword">import</span> plugins.PluginComponent
<span class="keyword">import</span> scala.collection.jcl.{TreeMap, TreeSet}
<span class="keyword">import</span> java.io.File

<span class="keyword">object</span> <span class="typed"><span class="type">object sxr.BrowsePlugin</span><a id="6240">BrowsePlugin</a></span>
{
	<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><span id="22204"><a id="22203">PluginName</a></span></span> = <span class="typed"><span class="type">java.lang.String(&quot;sxr&quot;)</span><span class="string">&quot;sxr&quot;</span></span>
	<span class="comment">/** This is the name of the option that specifies the base directory against which sources
	* should be relativized.*/</span>
	<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><span id="22206"><a id="22205">BaseDirectoryOptionName</a></span></span> = <span class="typed"><span class="type">java.lang.String(&quot;base-directory:&quot;)</span><span class="string">&quot;base-directory:&quot;</span></span>
}
<span class="comment">/* The standard plugin setup.  The main implementation is in Browse.  The entry point is Browse.generateOutput */</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class BrowsePlugin extends sxr.Browse with ScalaObject</span><a id="6242">BrowsePlugin</a></span>(<span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><span id="22210"><span id="22209"><a id="22671">global</a></span></span></span>: <span class="typed"><span class="type">scala.tools.nsc.Global</span><a id="6516">Global</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">sxr.Browse</span><a href="Browse.scala.html#6201">Browse</a></span>
{
	<span class="keyword">import</span> global._
	<span class="keyword">import</span> BrowsePlugin._
	
	<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><span id="22215"><a id="22214">name</a></span></span> = <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#22203">PluginName</a></span>
	<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><span id="22217"><a id="22216">description</a></span></span> = <span class="typed"><span class="type">java.lang.String(&quot;A plugin to produce a browsable representation of the input sources.&quot;)</span><span class="string">&quot;A plugin to produce a browsable representation of the input sources.&quot;</span></span>
	<span class="keyword">val</span> <span class="typed"><span class="type">List[scala.tools.nsc.plugins.PluginComponent]</span><span id="22219"><a id="22218">components</a></span></span> = <span class="typed"><span class="type">(scala.tools.nsc.plugins.PluginComponent*)List[scala.tools.nsc.plugins.PluginComponent]</span><span id="11782"><a id="502">List</a></span></span>[<span class="typed"><span class="type">scala.tools.nsc.plugins.PluginComponent</span><a id="8795">PluginComponent</a></span>](<span class="typed"><span class="type">object BrowsePlugin.this.Component</span><a href="#22231">Component</a></span>)
	
	<span class="comment">/** The directory to which the annotated sources will be written. */</span>
	<span class="keyword">val</span> <span class="typed"><span class="type">java.io.File</span><span id="22221"><a id="22220">outputDirectory</a></span></span> = (<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.io.File</span><a id="12307" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.File</span><a id="3644">File</a></span>(<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings</span><a href="#22209" id="11302">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a id="22518">outdir</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting#T</span><a id="22299">value</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;../browse&quot;)</span><span class="string">&quot;../browse&quot;</span></span>)).<span class="typed"><span class="type">()java.io.File</span><a id="12316">getAbsoluteFile</a></span>
	<span class="typed"><span class="type">=&gt; java.io.File</span><a href="#22220">outputDirectory</a></span>.<span class="typed"><span class="type">()Boolean</span><a id="12338">mkdirs</a></span>()

	<span class="comment">/** The directory against which the input source paths will be relativized.*/</span>
	<span class="keyword">var</span> <span class="typed"><span class="type">Option[java.io.File]</span><span id="22224"><span id="22222"><span id="22223"><a id="22670">baseDirectory</a></span></span></span></span>: <span class="typed"><span class="type">Option[java.io.File]</span><a id="909">Option</a></span>[File] = <span class="typed"><span class="type">object None</span><a id="511">None</a></span>

	<span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(List[String],(String) =&gt; Unit)Unit</span><a id="22225">processOptions</a></span>(<span class="typed"><span class="type">List[String]</span><a id="22672">options</a></span>: <span class="typed"><span class="type">List[String]</span><a id="501">List</a></span>[String], <span class="typed"><span class="type">(String) =&gt; Unit</span><a id="22673">error</a></span>: String =&gt; Unit)
	{
		<span class="keyword">for</span>(<span class="typed"><span class="type">((String) =&gt; Unit)Unit</span><span id="11820"><a id="22675">option</a></span></span> &lt;- <span class="typed"><span class="type">List[String]</span><a href="#22672">options</a></span>)
		{
			<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">String</span><a href="#22675">option</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5807">startsWith</a></span>(<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#22205">BaseDirectoryOptionName</a></span>))
				<span class="typed"><span class="type">(Option[java.io.File])Unit</span><a href="#22223">baseDirectory</a></span> = <span class="typed"><span class="type">(java.io.File)Some[java.io.File]</span><span id="20399"><a id="283">Some</a></span></span>(<span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.File</span><a id="3644">File</a></span>(<span class="typed"><span class="type">String</span><a href="#22675">option</a></span>.<span class="typed"><span class="type">(Int)java.lang.String</span><a id="5820">substring</a></span>(<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#22205">BaseDirectoryOptionName</a></span>.<span class="typed"><span class="type">()Int</span><a id="5787">length</a></span>)))
			<span class="keyword">else</span>
				<span class="typed"><span class="type">(String)Unit</span><a href="#22673" id="12211">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Option for source browser plugin not understood: &quot;)</span><span class="string">&quot;Option for source browser plugin not understood: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5768">+</a></span> <span class="typed"><span class="type">String</span><a href="#22675">option</a></span>)
		}
	}
	<span class="keyword">override</span> <span class="keyword">val</span> <span class="typed"><span class="type">Option[String]</span><span id="22227"><a id="22226">optionsHelp</a></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="909">Option</a></span>[String] =
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="22681">prefix</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;  -P:&quot;)</span><span class="string">&quot;  -P:&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5768">+</a></span> <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#22214">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5768">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;:&quot;)</span><span class="string">&quot;:&quot;</span></span>
		<span class="typed"><span class="type">(java.lang.String)Some[java.lang.String]</span><span id="20399"><a id="283">Some</a></span></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#22681">prefix</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5768">+</a></span> <span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#22205">BaseDirectoryOptionName</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5768">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&lt;name&gt;            Set the base source directory .\012&quot;)</span><span class="string">&quot;&lt;name&gt;            Set the base source directory .\n&quot;</span></span>)
	}

	<span class="comment">/* For source compatibility between 2.7.x and 2.8.x */</span>
	<span class="keyword">private</span> <span class="keyword">object</span> <span class="typed"><span class="type">object BrowsePlugin.this.runsBefore</span><a id="22228">runsBefore</a></span> { <span class="keyword">def</span> <span class="typed"><span class="type">(String)String</span><a id="22684">::</a></span> (<span class="typed"><span class="type">String</span><a id="22686">s</a></span>: <span class="typed"><span class="type">String</span><a id="1836">String</a></span>) = <span class="typed"><span class="type">String</span><a href="#22686">s</a></span> }
	<span class="keyword">private</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class CompatiblePluginComponent extends scala.tools.nsc.plugins.PluginComponent with ScalaObject</span><a id="22230">CompatiblePluginComponent</a></span>(<span class="typed"><span class="type">String</span><span id="22242"><a id="22693">afterPhase</a></span></span>: <span class="typed"><span class="type">String</span><a id="1836">String</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.plugins.PluginComponent</span><a id="8795">PluginComponent</a></span>
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><span id="22245"><a id="22244">runsAfter</a></span></span> = <span class="typed"><span class="type">String</span><a href="#22242">afterPhase</a></span> <span class="typed"><span class="type">(String)List[String]</span><a href="#22690" id="11789">::</a></span> <span class="typed"><span class="type">=&gt; List[String]</span><a href="#22230" id="19204">runsBefore</a></span>
	}
	<span class="keyword">private</span> <span class="keyword">object</span> <span class="typed"><span class="type">object BrowsePlugin.this.Component</span><a id="22231">Component</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">BrowsePlugin.this.CompatiblePluginComponent</span><a href="#22230">CompatiblePluginComponent</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;typer&quot;)</span><span class="string">&quot;typer&quot;</span></span>)
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.Global</span><span id="22248"><a id="22247">global</a></span></span> = <span class="typed"><span class="type">BrowsePlugin.this.type</span><a href="#6242">BrowsePlugin</a></span>.<span class="keyword">this</span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Global</span><a href="#22209">global</a></span>
		<span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><span id="22250"><a id="22249">phaseName</a></span></span> = <span class="typed"><span class="type">BrowsePlugin.this.type</span><a href="#6242">BrowsePlugin</a></span>.<span class="keyword">this</span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#22214">name</a></span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(scala.tools.nsc.Phase)BrowsePlugin.this.BrowsePhase</span><a id="22251">newPhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="22695">prev</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="6900">Phase</a></span>) = <span class="typed"><span class="type">BrowsePlugin.this.BrowsePhase</span><span class="keyword">new</span></span> <span class="typed"><span class="type">BrowsePlugin.this.BrowsePhase</span><a href="#22233">BrowsePhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a href="#22695">prev</a></span>)
	}

	<span class="keyword">private</span> <span class="keyword">class</span> <span class="typed"><span class="type">class BrowsePhase extends scala.tools.nsc.Phase with ScalaObject</span><a id="22233">BrowsePhase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><span id="22723"><a id="22727">prev</a></span></span>: <span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="6900">Phase</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.tools.nsc.Phase</span><a id="6900">Phase</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Phase</span><a href="#22727">prev</a></span>)
	{
		<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; java.lang.String</span><a id="22725">name</a></span> = <span class="typed"><span class="type">BrowsePlugin.this.type</span><a href="#6242">BrowsePlugin</a></span>.<span class="keyword">this</span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a href="#22214">name</a></span>
		<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Unit</span><a id="22726">run</a></span> = <span class="typed"><span class="type">()Unit</span><a href="Browse.scala.html#11287">generateOutput</a></span>()
	}
}
        </pre>
    </body>
</html>