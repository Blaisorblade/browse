<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Token.scala</title>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sxr -- Scala X-Ray
 * Copyright 2009 Mark Harrah
 */</span>

<span class="keyword">package</span> sxr

<span class="comment">/** Represents a link to a definition.  The path is the path to the file and target is
* the symbol ID targeted.  The '#' is not included.  To get the constructed path,
* call toString. */</span>
<span class="keyword">private</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Link extends java.lang.Object with NotNull with ScalaObject</span><a id="6212">Link</a></span>(<span class="keyword">val</span> <span class="typed"><span class="type">String</span><span id="20906"><span id="20905"><a id="20990">path</a></span></span></span>: <span class="typed"><span class="type">String</span><a id="1836">String</a></span>, <span class="keyword">val</span> <span class="typed"><span class="type">String</span><span id="20908"><span id="20907"><a id="20991">target</a></span></span></span>: <span class="typed"><span class="type">String</span><a id="1836">String</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="180">NotNull</a></span>
{
	<span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()java.lang.String</span><a id="20910">toString</a></span> = <span class="typed"><span class="type">=&gt; String</span><a href="#20905">path</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5768">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;#&quot;)</span><span class="string">&quot;#&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5768">+</a></span> <span class="typed"><span class="type">=&gt; String</span><a href="#20907">target</a></span>
}
<span class="keyword">private</span> <span class="keyword">object</span> <span class="typed"><span class="type">object sxr.BlockLink</span><a id="6213">BlockLink</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">sxr.Link</span><a href="#6212">Link</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
<span class="comment">/** Represents a token at the lexer level with associated type information.
* 'start' is the offset of the token in the original source file.
* 'length' is the length of the token in the original source file
* 'code' is the class of the token (see Tokens in the compiler)*/</span>
<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Token extends java.lang.Object with NotNull with Ordered[sxr.Token] with ScalaObject with Product</span><span id="21382"><span id="21397"><span id="21396"><span id="21392"><span id="6216"><span id="17834"><span id="21377"><span id="21363"><span id="21391"><span id="283"><span id="21378"><span id="21380"><span id="3116"><span id="5760"><span id="21379"><span id="3475"><span id="2725"><span id="3476"><span id="2726"><span id="21384"><span id="424"><span id="21390"><span id="21398"><span id="21401"><span id="20399"><span id="6215"><span id="21364"><span id="21399"><a id="21383">Token</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">Int</span><span id="19066"><span id="19065"><span id="20129"><a id="21438">start</a></span></span></span></span>: <span class="typed"><span class="type">Int</span><a id="2369">Int</a></span>, <span class="typed"><span class="type">Int</span><span id="19068"><span id="19067"><span id="20130"><a id="21439">length</a></span></span></span></span>: <span class="typed"><span class="type">Int</span><a id="2369">Int</a></span>, <span class="typed"><span class="type">Int</span><span id="19070"><span id="19069"><span id="20131"><a id="21440">code</a></span></span></span></span>: <span class="typed"><span class="type">Int</span><a id="2369">Int</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="180">NotNull</a></span> <span class="keyword">with</span> <span class="typed"><span class="type">Ordered[sxr.Token]</span><a id="1437">Ordered</a></span>[Token]
{
	<span class="typed"><span class="type">(Boolean)Unit</span><span id="5965"><a id="796">require</a></span></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="#19065">start</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3121">&gt;=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
	<span class="typed"><span class="type">(Boolean)Unit</span><span id="5965"><a id="796">require</a></span></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="#19067">length</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3120">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
	<span class="comment">/** Tokens are sorted by their start position, so that they may be searched by offset in
	* the extraction code and then processed in sequence in the annotation code. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(sxr.Token)Int</span><a id="19072">compare</a></span>(<span class="typed"><span class="type">sxr.Token</span><a id="21304">other</a></span>: <span class="typed"><span class="type">sxr.Token</span><a href="#6215">Token</a></span>) = <span class="typed"><span class="type">implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt</span><span id="6091"><a href="#19065" id="796">start</a></span></span> <span class="typed"><span class="type">(Int)Int</span><a id="21231">compare</a></span> <span class="typed"><span class="type">sxr.Token</span><a href="#21304">other</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#19065">start</a></span>
	
	<span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">var</span> <span class="typed"><span class="type">Option[sxr.TypeAttribute]</span><a id="19073">rawType</a></span>: <span class="typed"><span class="type">Option[sxr.TypeAttribute]</span><a id="909">Option</a></span>[TypeAttribute] = <span class="typed"><span class="type">object None</span><a id="511">None</a></span>
	<span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">var</span> <span class="typed"><span class="type">Option[sxr.Link]</span><a id="19074">rawReference</a></span>: <span class="typed"><span class="type">Option[sxr.Link]</span><a id="909">Option</a></span>[Link] = <span class="typed"><span class="type">object None</span><a id="511">None</a></span>
	<span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">var</span> <span class="typed"><span class="type">List[Int]</span><a id="19075">rawDefinitions</a></span>: <span class="typed"><span class="type">List[Int]</span><a id="501">List</a></span>[Int] = <span class="typed"><span class="type">object Nil</span><a id="310">Nil</a></span>
	<span class="comment">/** Sets the type information for this token. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(sxr.TypeAttribute)Unit</span><a id="19076">tpe_=</a></span>(<span class="typed"><span class="type">sxr.TypeAttribute</span><a id="20882">t</a></span>: <span class="typed"><span class="type">sxr.TypeAttribute</span><a href="#6218">TypeAttribute</a></span>)
	{
		<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">Option[sxr.TypeAttribute]</span><a href="#19073">rawType</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="12357">isEmpty</a></span>)
			<span class="typed"><span class="type">Option[sxr.TypeAttribute]</span><a href="#19073">rawType</a></span> = <span class="typed"><span class="type">(sxr.TypeAttribute)Some[sxr.TypeAttribute]</span><span id="20399"><a id="283">Some</a></span></span>(<span class="typed"><span class="type">sxr.TypeAttribute</span><a href="#20882">t</a></span>)
	}
	<span class="comment">/** Sets the defining location for the symbol for this token. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(sxr.Link)Unit</span><a id="19077">reference_=</a></span>(<span class="typed"><span class="type">sxr.Link</span><a id="20948">l</a></span>: <span class="typed"><span class="type">sxr.Link</span><a href="#6212">Link</a></span>)
	{
		<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">Option[sxr.Link]</span><a href="#19074">rawReference</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="12357">isEmpty</a></span>)
			<span class="typed"><span class="type">Option[sxr.Link]</span><a href="#19074">rawReference</a></span> = <span class="typed"><span class="type">(sxr.Link)Some[sxr.Link]</span><span id="20399"><a id="283">Some</a></span></span>(<span class="typed"><span class="type">sxr.Link</span><a href="#20948">l</a></span>)
	}
	<span class="comment">/** Adds an ID for this token.  An ID is used to mark this token as the source of a symbol. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(Int)Unit</span><a id="19078">+=</a></span>(<span class="typed"><span class="type">Int</span><a id="20946">id</a></span>: <span class="typed"><span class="type">Int</span><a id="2369">Int</a></span>)
		{ <span class="typed"><span class="type">List[Int]</span><a href="#19075">rawDefinitions</a></span> <span class="typed"><span class="type">(Int)List[Int]</span><a id="11789">::=</a></span> <span class="typed"><span class="type">Int</span><a href="#20946">id</a></span> }
	<span class="comment">/** Gets the type information. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Option[sxr.TypeAttribute]</span><a id="19079">tpe</a></span> = <span class="typed"><span class="type">Option[sxr.TypeAttribute]</span><a href="#19073">rawType</a></span>
	<span class="comment">/** Gets the link to the defining location for this token. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Option[sxr.Link]</span><a id="19080">reference</a></span> = <span class="typed"><span class="type">Option[sxr.Link]</span><a href="#19074">rawReference</a></span>
	<span class="comment">/** Gets the definition IDs. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; List[Int]</span><a id="19081">definitions</a></span> = <span class="typed"><span class="type">List[Int]</span><a href="#19075">rawDefinitions</a></span>
	<span class="comment">/** True if this token has no reference to a definition and has no definitions itself. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="19082">isSimple</a></span> = <span class="typed"><span class="type">=&gt; Option[sxr.Link]</span><a href="#19080">reference</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="12357">isEmpty</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2726">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; List[Int]</span><a href="#19081">definitions</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="12099">isEmpty</a></span>
	<span class="comment">/** True if this token has no reference to a definition, has no definitions itself, and
	* has no type information. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="19083">isPlain</a></span> = <span class="typed"><span class="type">=&gt; Boolean</span><a href="#19082">isSimple</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2726">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Option[sxr.TypeAttribute]</span><a href="#19079">tpe</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="12357">isEmpty</a></span>
}
<span class="comment">/** Holds type information.  This class will probably change to accomodate tokeninzing types. */</span>
<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class TypeAttribute extends java.lang.Object with NotNull with ScalaObject with Product</span><span id="3484"><span id="21428"><span id="6218"><span id="21421"><span id="21427"><span id="21363"><span id="283"><span id="21432"><span id="16985"><span id="21422"><span id="5760"><span id="3475"><span id="2725"><span id="21433"><span id="3476"><span id="20899"><span id="21434"><span id="2726"><span id="21418"><span id="6219"><span id="20891"><span id="21419"><span id="21401"><span id="21420"><span id="20399"><span id="21431"><span id="21364"><a id="1354">TypeAttribute</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">String</span><span id="20895"><span id="20894"><span id="21416"><a id="20900">name</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1836">String</a></span>, <span class="typed"><span class="type">Option[sxr.Link]</span><span id="20897"><span id="20896"><span id="21417"><a id="20901">definition</a></span></span></span></span>: <span class="typed"><span class="type">Option[sxr.Link]</span><a id="909">Option</a></span>[Link]) <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="180">NotNull</a></span>

        </pre>
    </body>
</html>