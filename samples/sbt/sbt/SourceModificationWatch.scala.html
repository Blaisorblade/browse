<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/SourceModificationWatch.scala</title>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mikko Peltonen, Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">object</span> <a title="object sbt.SourceModificationWatch" id="6577">SourceModificationWatch</a>
{
	<span class="keyword">def</span> <a title="(sbt.Project,Int)(=&gt; Boolean)(=&gt; Unit)Unit" id="53482">watchUntil</a>(<a title="sbt.Project" id="53483">project</a>: <a href="Project.scala.html#6395" title="sbt.Project">Project</a>, <a title="Int" id="53484">pollDelaySec</a>: <a title="Int" id="2296">Int</a>)(<a title="=&gt; Boolean" id="53485">terminationCondition</a>: =&gt; Boolean)(<a title="=&gt; Unit" id="53486">onSourcesModified</a>: =&gt; Unit)
	{
		<span class="keyword">def</span> <a title="=&gt; Iterable[java.io.File]" id="54898">sourceFiles</a>: <a title="Iterable[java.io.File]" id="358">Iterable</a>[java.io.File] =
			<a href="#54899" title="=&gt; sbt.PathFinder">sourcesFinder</a>.<a href="Path.scala.html#9518" title="=&gt; scala.collection.Set[sbt.Path]">get</a>.<a title="((sbt.Path) =&gt; Option[sbt.Path])Iterable[Option[sbt.Path]]" id="7246">map</a>(<a href="Path.scala.html#6701" title="object sbt.Path">Path</a>.<a href="Path.scala.html#9502" title="(sbt.Path,sbt.Path)Option[sbt.Path]">relativize</a>(<a href="#53483" title="sbt.Project">project</a>.<a href="Project.scala.html#26173" title="=&gt; sbt.ProjectInfo">info</a>.<a href="ProjectInfo.scala.html#27931" title="=&gt; sbt.ProjectDirectory">projectPath</a>, <a href="#54903" title="sbt.Path">_</a>)).<a title="((Option[sbt.Path]) =&gt; Boolean)Iterable[Option[sbt.Path]]" id="7250">filter</a>(<a href="#54907" title="Option[sbt.Path]">_</a>.<a title="=&gt; Boolean" id="10151">isDefined</a>).<a title="((Option[sbt.Path]) =&gt; java.io.File)Iterable[java.io.File]" id="7246">map</a>(<a href="#54910" title="Option[sbt.Path]">_</a>.<a title="=&gt; sbt.Path" id="10152">get</a>.<a href="Path.scala.html#9529" title="=&gt; java.io.File">asFile</a>)
	
		<span class="keyword">def</span> <a title="=&gt; sbt.PathFinder" id="54899">sourcesFinder</a>: <a href="Path.scala.html#6703" title="sbt.PathFinder">PathFinder</a> = <a href="#53483" title="sbt.Project">project</a>.<a href="Dag.scala.html#26240" title="=&gt; List[sbt.Project]">topologicalSort</a>.<a title="(sbt.PathFinder)((sbt.PathFinder, sbt.Project) =&gt; sbt.PathFinder)sbt.PathFinder" id="6848">foldLeft</a>(<a href="Path.scala.html#6701" title="object sbt.Path">Path</a>.<a href="Path.scala.html#9495" title="=&gt; sbt.PathFinder">emptyPathFinder</a>) {
			(<a title="sbt.PathFinder" id="54919">acc</a>, <a title="sbt.Project" id="54920">prj</a>) =&gt; <a href="#54919" title="sbt.PathFinder">acc</a> <a href="Path.scala.html#9510" title="(sbt.PathFinder)sbt.PathFinder">+++</a> (<a href="#54920" title="sbt.Project">prj</a> <span title="sbt.PathFinder" class="keyword">match</span> {
				<span title="sbt.PathFinder" class="keyword">case</span> <a title="sbt.BasicScalaProject" id="54921">prj</a>: <a href="DefaultProject.scala.html#6728" title="sbt.BasicScalaProject">BasicScalaProject</a> =&gt; <a href="#54921" title="sbt.BasicScalaProject">prj</a>.<a href="DefaultProject.scala.html#32125" title="=&gt; sbt.PathFinder">mainSources</a> <a href="Path.scala.html#9510" title="(sbt.PathFinder)sbt.PathFinder">+++</a> <a href="#54921" title="sbt.BasicScalaProject">prj</a>.<a href="DefaultProject.scala.html#32126" title="=&gt; sbt.PathFinder">testSources</a>
				<span title="sbt.PathFinder" class="keyword">case</span> _ =&gt; <a href="Path.scala.html#6701" title="object sbt.Path">Path</a>.<a href="Path.scala.html#9495" title="=&gt; sbt.PathFinder">emptyPathFinder</a>
			})
		}
		<span class="keyword">def</span> <a title="(Long,Int)Unit" id="54900">loop</a>(<a title="Long" id="54937">lastCallbackCallTime</a>: <a title="Long" id="2301">Long</a>, <a title="Int" id="54938">previousFileCount</a>: <a title="Int" id="2296">Int</a>)
		{
			<span class="keyword">val</span> <span id="9252"><a href="#55113" title="(Long, Int)" id="1283">(</a></span><span id="55113"><span id="54940"><a href="#54939" title="Long" id="9240">lastModifiedTime</a></span></span>, <span id="55114"><span id="54941"><a href="#54939" title="Int" id="9242">fileCount</a></span></span>) = <a href="#54898" title="=&gt; Iterable[java.io.File]">sourceFiles</a>.<a title="((Long, Int))(((Long, Int), java.io.File) =&gt; (Long, Int))(Long, Int)" id="7263">foldLeft</a>(<span id="9252"><a title="(Long,Int)(Long, Int)" id="1283">(</a></span><span title="Long(0L)" class="long">0L</span>, <span title="Int(0)" class="int">0</span>)){(<a title="(Long, Int)" id="54947">acc</a>, <a title="java.io.File" id="54948">file</a>) =&gt; <span id="9252"><a title="(Long,Int)(Long, Int)" id="1283">(</a></span><a title="object Math" id="557">Math</a>.<a title="(Long,Long)Long" id="55026">max</a>(<a href="#54947" title="(Long, Int)">acc</a>.<a title="=&gt; Long" id="9240">_1</a>, <a href="#54948" title="java.io.File">file</a>.<a title="()Long" id="9563">lastModified</a>), <a href="#54947" title="(Long, Int)">acc</a>.<a title="=&gt; Int" id="9242">_2</a> <a title="(Int)Int" id="3037">+</a> <span title="Int(1)" class="int">1</span>)}
			<span class="keyword">val</span> <a title="Long" id="54942">newCallbackCallTime</a> =
				<span class="comment">// check if sources are modified</span>
				<span title="Long" class="keyword">if</span> (<a href="#54940" title="Long">lastModifiedTime</a> <a title="(Long)Boolean" id="3158">&gt;</a> <a href="#54937" title="Long">lastCallbackCallTime</a> <a title="(Boolean)Boolean" id="2640">||</a> <a href="#54938" title="Int">previousFileCount</a> <a title="(Int)Boolean" id="3032">!=</a> <a href="#54941" title="Int">fileCount</a>)
				{
					<span class="keyword">val</span> <a title="Long" id="55119">now</a> = <a title="object java.lang.System" id="1776">System</a>.<a title="()Long" id="24451">currentTimeMillis</a>
					<a href="#53486" title="=&gt; Unit">onSourcesModified</a>
					<a href="#55119" title="Long">now</a>
				}
				<span class="keyword">else</span>
					<a href="#54937" title="Long">lastCallbackCallTime</a>
			<a title="object java.lang.Thread" id="1974">Thread</a>.<a title="(Long)Unit" id="35642">sleep</a>(<a href="#53484" title="Int">pollDelaySec</a> <span id="6084"><span id="770"><a title="implicit scala.Predef.int2long : (Int)Long" id="3039">*</a></span></span> <span title="Int(1000)" class="int">1000</span>)
			<span title="Unit" class="keyword">if</span>(<a title="=&gt; Boolean" id="2637">!</a><a href="#53485" title="=&gt; Boolean">terminationCondition</a>)
				<a href="#54900" title="(Long,Int)Unit">loop</a>(<a href="#54942" title="Long">newCallbackCallTime</a>, <a href="#54941" title="Int">fileCount</a>)
		}
		<a href="#54900" title="(Long,Int)Unit">loop</a>(<span title="Long(0L)" class="long">0L</span>, <span title="Int(0)" class="int">0</span>)
	}
}
        </pre>
    </body>
</html>