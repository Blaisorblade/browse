<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/ParallelRunner.scala</title>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">import</span> scala.actors.Actor
<span class="keyword">import</span> scala.collection.mutable.{ArrayBuffer, Buffer, HashMap, HashSet, ListBuffer, Map, PriorityQueue, Set}

<span class="keyword">object</span> <span class="typed"><span class="type">object sbt.ParallelRunner</span><a id="6654">ParallelRunner</a></span>
{
	<span class="keyword">def</span> <span class="typed"><span class="type">[D &lt;: sbt.Dag[D]](D,(D) =&gt; String,(D) =&gt; Option[String],Int,(D) =&gt; sbt.Logger)List[sbt.WorkFailure[D]]</span><a id="54739">run</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: sbt.Dag[D]</span><a id="54741">D</a></span> &lt;: Dag[D]](<span class="typed"><span class="type">D</span><a id="54747">node</a></span>: <span class="typed"><span class="type">D</span><a href="#54741">D</a></span>, <span class="typed"><span class="type">(D) =&gt; String</span><a id="54748">name</a></span>: D =&gt; String, <span class="typed"><span class="type">(D) =&gt; Option[String]</span><a id="54749">action</a></span>: D =&gt; Option[String], <span class="typed"><span class="type">Int</span><a id="54750">maximumTasks</a></span>: <span class="typed"><span class="type">Int</span><a id="2375">Int</a></span>, <span class="typed"><span class="type">(D) =&gt; sbt.Logger</span><a id="54751">log</a></span>: D =&gt; Logger): <span class="typed"><span class="type">List[sbt.WorkFailure[D]]</span><a id="507">List</a></span>[WorkFailure[D]] =
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">sbt.BasicDagScheduler[D]</span><a id="54922">jobScheduler</a></span> = <span class="typed"><span class="type">sbt.BasicDagScheduler[D]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">sbt.BasicDagScheduler[D]</span><a href="#6671">BasicDagScheduler</a></span>(<span class="typed"><span class="type">D</span><a href="#54747">node</a></span>, <span class="typed"><span class="type">(D) =&gt; String</span><a href="#54748">name</a></span>, (<span class="typed"><span class="type">D</span><a id="55011">d</a></span>: <span class="typed"><span class="type">D</span><a href="#54741">D</a></span>) =&gt; <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)
		<span class="keyword">val</span> <span class="typed"><span class="type">sbt.Distributor[sbt.Work[D]]</span><a id="54923">distributor</a></span> = <span class="typed"><span class="type">sbt.Distributor[sbt.Work[D]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">sbt.Distributor[sbt.Work[D]]</span><a href="#6658">Distributor</a></span>(<span class="typed"><span class="type">sbt.BasicDagScheduler[D]</span><a href="#54922">jobScheduler</a></span>, <span class="typed"><span class="type">((D) =&gt; Option[String])(sbt.Work[D])Option[String]</span><a href="#54742">withWork</a></span>(<span class="typed"><span class="type">(D) =&gt; Option[String]</span><a href="#54749">action</a></span>), <span class="typed"><span class="type">Int</span><a href="#54750">maximumTasks</a></span>, <span class="typed"><span class="type">((D) =&gt; sbt.Logger)(sbt.Work[D])sbt.Logger</span><a href="#54742">withWork</a></span>(<span class="typed"><span class="type">(D) =&gt; sbt.Logger</span><a href="#54751">log</a></span>))
		<span class="typed"><span class="type">sbt.Distributor[sbt.Work[D]]</span><a href="#54923">distributor</a></span>.<span class="typed"><span class="type">()scala.actors.Actor</span><a id="55068">start</a></span>()
		<span class="keyword">val</span> <span class="typed"><span class="type">List[sbt.WorkFailure[sbt.Work[D]]]</span><a id="54924">result</a></span> = (<span class="typed"><span class="type">sbt.Distributor[sbt.Work[D]]</span><a href="#54923">distributor</a></span> <span class="typed"><span class="type">(Any)Any</span><a id="55043">!?</a></span> <span class="typed"><span class="type">object sbt.Start</span><a href="#6656">Start</a></span>).<span class="typed"><span class="type">List[sbt.WorkFailure[sbt.Work[D]]]</span><a id="3484">asInstanceOf</a></span>[<span class="typed"><span class="type">List[sbt.WorkFailure[sbt.Work[D]]]</span><a id="507">List</a></span>[WorkFailure[Work[D]]]]
		<span class="keyword">for</span>( <span class="typed"><span class="type">((sbt.WorkFailure[sbt.Work[D]]) =&gt; sbt.WorkFailure[D])List[sbt.WorkFailure[D]]</span><span id="6935"><a href="#55202" id="6940">WorkFailure</a></span></span>(<span class="typed"><span class="type">sbt.Work[D]</span><span id="55210"><a id="55216">work</a></span></span>, <span class="typed"><span class="type">String</span><span id="55211"><a id="55217">message</a></span></span>) &lt;- <span class="typed"><span class="type">List[sbt.WorkFailure[sbt.Work[D]]]</span><a href="#54924">result</a></span> ) <span class="keyword">yield</span> <span class="typed"><span class="type">(D,String)sbt.WorkFailure[D]</span><a href="#54780">WorkFailure</a></span>(<span class="typed"><span class="type">sbt.Work[D]</span><a href="#55216">work</a></span>.<span class="typed"><span class="type">=&gt; D</span><a href="#54984">data</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;Error running &quot;)</span><span class="string">&quot;Error running &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">(D)String</span><a href="#54748" id="7330">name</a></span>(<span class="typed"><span class="type">sbt.Work[D]</span><a href="#55216">work</a></span>.<span class="typed"><span class="type">=&gt; D</span><a href="#54984">data</a></span>) <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;: &quot;)</span><span class="string">&quot;: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">String</span><a href="#55217">message</a></span>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">[D, T]((D) =&gt; T)(sbt.Work[D])T</span><a id="54742">withWork</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="54745">D</a></span>, <span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="54746">T</a></span>](<span class="typed"><span class="type">(D) =&gt; T</span><a id="55188">f</a></span>: D =&gt; T)(<span class="typed"><span class="type">sbt.Work[D]</span><a id="55189">w</a></span>: <span class="typed"><span class="type">sbt.Work[D]</span><a href="#6666">Work</a></span>[D]) = <span class="typed"><span class="type">(D)T</span><a href="#55188" id="7330">f</a></span>(<span class="typed"><span class="type">sbt.Work[D]</span><a href="#55189">w</a></span>.<span class="typed"><span class="type">=&gt; D</span><a href="#54984">data</a></span>)
}
<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">object</span> <span class="typed"><span class="type">object sbt.Start</span><span id="55221"><span id="55220"><span id="55224"><span id="55226"><span id="6656"><span id="55223"><span id="29016"><span id="3481"><a id="55222">Start</a></span></span></span></span></span></span></span></span></span>
<span class="keyword">final</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Distributor[D] extends java.lang.Object with scala.actors.Actor with NotNull with ScalaObject</span><a id="6658">Distributor</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="6659">D</a></span>](<span class="typed"><span class="type">sbt.Scheduler[D]</span><span id="55145"><a id="55184">scheduler</a></span></span>: <span class="typed"><span class="type">sbt.Scheduler[D]</span><a href="#6664">Scheduler</a></span>[D], <span class="typed"><span class="type">(D) =&gt; Option[String]</span><span id="55146"><a id="55185">doWork</a></span></span>: D =&gt; Option[String], <span class="typed"><span class="type">Int</span><span id="55147"><a id="55186">workers</a></span></span>: <span class="typed"><span class="type">Int</span><a id="2375">Int</a></span>, <span class="typed"><span class="type">(D) =&gt; sbt.Logger</span><span id="55148"><a id="55187">log</a></span></span>: D =&gt; Logger) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.actors.Actor</span><a id="47397">Actor</a></span> <span class="keyword">with</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
{
	<span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[Distributor.this.Worker]</span><span id="55151"><a id="55150">running</a></span></span> = <span class="typed"><span class="type">scala.collection.mutable.HashSet[Distributor.this.Worker]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[Distributor.this.Worker]</span><a id="8018">HashSet</a></span>[Worker]
	<span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Buffer[Distributor.this.Worker]</span><span id="55153"><a id="55152">idle</a></span></span>: <span class="typed"><span class="type">scala.collection.mutable.Buffer[Distributor.this.Worker]</span><a id="8084">Buffer</a></span>[Worker] = <span class="typed"><span class="type">scala.collection.mutable.ArrayBuffer[Distributor.this.Worker]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.ArrayBuffer[Distributor.this.Worker]</span><a id="8255">ArrayBuffer</a></span>[Worker]
	<span class="typed"><span class="type">=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]</span><a href="#55152">idle</a></span> <span class="typed"><span class="type">(Iterable[Distributor.this.Worker])Unit</span><a id="22685">++=</a></span> <span class="typed"><span class="type">object Array</span><a id="1054">Array</a></span>.<span class="typed"><span class="type">((Int) =&gt; Distributor.this.Worker)(Int)Array[Distributor.this.Worker]</span><a id="7116">fromFunction</a></span>( (<span class="typed"><span class="type">Int</span><a id="55251">i</a></span>: <span class="typed"><span class="type">Int</span><a id="2375">Int</a></span>) =&gt; { <span class="keyword">val</span> <span class="typed"><span class="type">Distributor.this.Worker</span><a id="55252">w</a></span> = <span class="typed"><span class="type">Distributor.this.Worker</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55157">Worker</a></span>; <span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55252">w</a></span>.<span class="typed"><span class="type">()scala.actors.Actor</span><a id="55068">start</a></span>(); <span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55252">w</a></span> } )(<span class="typed"><span class="type">Int</span><a href="#55147">workers</a></span>)
	
	<span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="55154">act</a></span>
	{
		<span class="typed"><span class="type">(PartialFunction[Any,Unit])Unit</span><a href="#6658" id="55034">receive</a></span> <span class="typed"><span class="type">Unit</span><a href="#55258">{</a></span>
			<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object sbt.Start</span><a href="#6656">Start</a></span> =&gt;
				<span class="typed"><span class="type">(Any)Unit</span><a href="#6658" id="55048">reply</a></span> {
					<span class="typed"><span class="type">()Unit</span><a href="#55155">runNext</a></span>()
					<span class="typed"><span class="type">sbt.Scheduler[D]</span><a href="#55145">scheduler</a></span>.<span class="typed"><span class="type">=&gt; Iterable[sbt.WorkFailure[D]]</span><a href="#54928">result</a></span>
				}
		}
		<span class="typed"><span class="type">()Nothing</span><a href="#6658" id="55090">exit</a></span>()
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="55155">runNext</a></span>()
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">Boolean</span><a id="55268">done</a></span> = <span class="typed"><span class="type">()Boolean</span><a href="#55156">next</a></span>()
		<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">=&gt; Boolean</span><a id="2728">!</a></span><span class="typed"><span class="type">Boolean</span><a href="#55268">done</a></span>)
		{
			<span class="typed"><span class="type">(PartialFunction[Any,Unit])Unit</span><a href="#6658" id="55034">receive</a></span>
			<span class="typed"><span class="type">Unit</span><a href="#55312">{</a></span>
				<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Done</a>(<span class="typed"><span class="type">Option[String]</span><a id="55335">result</a></span>, <span class="typed"><span class="type">Distributor.this.Worker</span><a id="55336">worker</a></span>, <span class="typed"><span class="type">D</span><a id="55337">data</a></span>) =&gt;
					<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[Distributor.this.Worker]</span><a href="#55150">running</a></span> <span class="typed"><span class="type">(Distributor.this.Worker)Unit</span><a id="22727">-=</a></span> <span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55336">worker</a></span>
					<span class="typed"><span class="type">=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]</span><a href="#55152">idle</a></span> <span class="typed"><span class="type">(Distributor.this.Worker)Unit</span><a id="22681">+=</a></span> <span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55336">worker</a></span>
					<span class="typed"><span class="type">sbt.Scheduler[D]</span><a href="#55145">scheduler</a></span>.<span class="typed"><span class="type">(D,Option[String])Unit</span><a href="#54925">complete</a></span>(<span class="typed"><span class="type">D</span><a href="#55337">data</a></span>, <span class="typed"><span class="type">Option[String]</span><a href="#55335">result</a></span>)
					<span class="typed"><span class="type">()Unit</span><a href="#55155">runNext</a></span>()
			}
		}
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Boolean</span><a id="55156">next</a></span>() =
	{
		<span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]</span><a href="#55152">idle</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="7218">isEmpty</a></span>)
			<span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
		<span class="keyword">else</span> <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">sbt.Scheduler[D]</span><a href="#55145">scheduler</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#54926">hasPending</a></span>)
		{
			<span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="55271">available</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]</span><a href="#55152">idle</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="7217">size</a></span>
			<span class="keyword">val</span> <span class="typed"><span class="type">Seq[D]</span><a id="55272">next</a></span> = <span class="typed"><span class="type">sbt.Scheduler[D]</span><a href="#55145">scheduler</a></span>.<span class="typed"><span class="type">(Int)Seq[D]</span><a href="#54927">next</a></span>(<span class="typed"><span class="type">Int</span><a href="#55271">available</a></span>)
			<span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="55273">nextSize</a></span> = <span class="typed"><span class="type">Seq[D]</span><a href="#55272">next</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="7217">size</a></span>
			<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">Int</span><a href="#55273">nextSize</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3125">&lt;=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
				<span class="typed"><span class="type">(Boolean)Unit</span><span id="5969"><a id="802">assume</a></span></span>(<span class="typed"><span class="type">=&gt; Boolean</span><a id="2728">!</a></span><span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[Distributor.this.Worker]</span><a href="#55150">running</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="22296">isEmpty</a></span>)
			<span class="keyword">else</span>
			{
				<span class="typed"><span class="type">(Boolean)Unit</span><span id="5969"><a id="802">assume</a></span></span>(<span class="typed"><span class="type">Int</span><a href="#55273">nextSize</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3126">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
				<span class="typed"><span class="type">(Boolean)Unit</span><span id="5969"><a id="802">assume</a></span></span>(<span class="typed"><span class="type">Int</span><a href="#55273">nextSize</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3125">&lt;=</a></span> <span class="typed"><span class="type">Int</span><a href="#55271">available</a></span>)
				<span class="keyword">for</span>(<span class="typed"><span class="type">((D) =&gt; Unit)Unit</span><span id="7365"><a id="55282">data</a></span></span> &lt;- <span class="typed"><span class="type">Seq[D]</span><a href="#55272">next</a></span>)
				{
					<span class="keyword">val</span> <span class="typed"><span class="type">Distributor.this.Worker</span><a id="55283">worker</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]</span><a href="#55152">idle</a></span>.<span class="typed"><span class="type">(Int)Distributor.this.Worker</span><a id="22701">remove</a></span>(<span class="typed"><span class="type">=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]</span><a href="#55152">idle</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a id="7217">size</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3129">-</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)
					<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[Distributor.this.Worker]</span><a href="#55150">running</a></span> <span class="typed"><span class="type">(Distributor.this.Worker)Unit</span><a id="22726">+=</a></span> <span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55283">worker</a></span>
					<span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55283">worker</a></span> <span class="typed"><span class="type">(Any)Unit</span><a id="55041">!</a></span> <span class="typed"><span class="type">(D)Distributor.this.Run</span><a href="#55300">Run</a></span>(<span class="typed"><span class="type">D</span><a href="#55282">data</a></span>)
				}
			}
			<span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
		}
		<span class="keyword">else</span> <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[Distributor.this.Worker]</span><a href="#55150">running</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="22296">isEmpty</a></span>)
		{
			<span class="typed"><span class="type">=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]</span><a href="#55152">idle</a></span>.<span class="typed"><span class="type">((Distributor.this.Worker) =&gt; Unit)Unit</span><a id="7365">foreach</a></span>(<span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55308">_</a></span> <span class="typed"><span class="type">(Any)Unit</span><a id="55041">!</a></span> <span class="typed"><span class="type">object Distributor.this.Shutdown</span><a href="#55158">Shutdown</a></span>)
			<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
		}
		<span class="keyword">else</span>
			<span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
	}
	<span class="keyword">private</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Worker extends java.lang.Object with scala.actors.Actor with NotNull with ScalaObject</span><a id="55157">Worker</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.actors.Actor</span><a id="47397">Actor</a></span> <span class="keyword">with</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
	{
		<span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="55254">act</a></span>
		{
			<span class="typed"><span class="type">Unit</span><a href="#55343" class="keyword">while</a></span>(<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>)
			{
				<span class="typed"><span class="type">(PartialFunction[Any,Unit])Unit</span><a href="#55157" id="55034">receive</a></span>
				<span class="typed"><span class="type">Unit</span><a href="#55346">{</a></span>
					<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Run</a>(<span class="typed"><span class="type">D</span><a id="55351">data</a></span>)  =&gt;
					{
						<span class="keyword">val</span> <span class="typed"><span class="type">Option[String]</span><a id="55352">result</a></span> = <span class="typed"><span class="type">object sbt.Control</span><a href="Control.scala.html#6704">Control</a></span>.<span class="typed"><span class="type">(=&gt; String,sbt.Logger)(=&gt; Option[String])Option[String]</span><a href="Control.scala.html#10298">trapUnit</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>, <span class="typed"><span class="type">(D)sbt.Logger</span><a href="#55148" id="7330">log</a></span>(<span class="typed"><span class="type">D</span><a href="#55351">data</a></span>))(<span class="typed"><span class="type">(D)Option[String]</span><a href="#55146" id="7330">doWork</a></span>(<span class="typed"><span class="type">D</span><a href="#55351">data</a></span>))
						<span class="typed"><span class="type">Distributor.this.type</span><a href="#6658">Distributor</a></span>.<span class="keyword">this</span> <span class="typed"><span class="type">(Any)Unit</span><a id="55041">!</a></span> <span class="typed"><span class="type">(Option[String],Distributor.this.Worker,D)Distributor.this.Done</span><a href="#55314">Done</a></span>(<span class="typed"><span class="type">Option[String]</span><a href="#55352">result</a></span>, <span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55157" class="keyword">this</a></span>, <span class="typed"><span class="type">D</span><a href="#55351">data</a></span>)
					}
					<span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object Distributor.this.Shutdown</span><a href="#55158">Shutdown</a></span> =&gt; <span class="typed"><span class="type">()Nothing</span><a href="#55157" id="55090">exit</a></span>()
				}
			}
		}
	}
	
	<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">object</span> <span class="typed"><span class="type">object Distributor.this.Shutdown</span><span id="55158"><span id="55365"><span id="55368"><span id="55369"><span id="55367"><span id="55366"><span id="29016"><span id="3481"><a id="55371">Shutdown</a></span></span></span></span></span></span></span></span></span> <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
	<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Run extends java.lang.Object with NotNull with ScalaObject with Product</span><span id="2731"><span id="55305"><span id="55347"><span id="28985"><span id="55160"><span id="55300"><span id="55379"><span id="55382"><span id="28986"><span id="289"><span id="29016"><span id="3481"><span id="55377"><span id="55374"><span id="55161"><span id="2732"><span id="55380"><span id="10375"><span id="55375"><span id="5766"><span id="55376"><span id="3482"><span id="55378"><span id="55381"><a id="3477">Run</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">D</span><span id="55303"><span id="55302"><span id="55350"><a id="55306">data</a></span></span></span></span>: <span class="typed"><span class="type">D</span><a href="#6659">D</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
	<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Done extends java.lang.Object with NotNull with ScalaObject with Product</span><span id="2731"><span id="55391"><span id="55392"><span id="3490"><span id="9327"><span id="55163"><span id="3481"><span id="55390"><span id="55164"><span id="55400"><span id="55399"><span id="5766"><span id="3482"><span id="55389"><span id="55325"><span id="3477"><span id="55397"><span id="28985"><span id="28986"><span id="289"><span id="55398"><span id="29016"><span id="55326"><span id="55394"><span id="55393"><span id="2732"><span id="10375"><span id="55388"><span id="430"><a id="55314">Done</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span class="typed"><span class="type">Option[String]</span><span id="55319"><span id="55318"><span id="55332"><a id="55353">result</a></span></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String], <span class="typed"><span class="type">Distributor.this.Worker</span><span id="55321"><span id="55320"><span id="55333"><a id="55354">worker</a></span></span></span></span>: <span class="typed"><span class="type">Distributor.this.Worker</span><a href="#55157">Worker</a></span>, <span class="typed"><span class="type">D</span><span id="55323"><span id="55322"><span id="55334"><a id="55355">data</a></span></span></span></span>: <span class="typed"><span class="type">D</span><a href="#6659">D</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
}
<span class="keyword">final</span> <span class="keyword">case</span> <span class="keyword">class</span> <span class="typed"><span class="type">class WorkFailure[D] extends java.lang.Object with NotNull with ScalaObject with Product</span><span id="55409"><span id="2731"><span id="54783"><span id="3490"><span id="55417"><span id="54780"><span id="28986"><span id="55411"><span id="55412"><span id="1360"><span id="289"><span id="9362"><span id="29016"><span id="3481"><span id="55413"><span id="55418"><span id="55203"><span id="55410"><span id="2732"><span id="6660"><span id="10375"><span id="5766"><span id="3482"><span id="55415"><span id="6662"><span id="55416"><a id="3477">WorkFailure</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><span id="6661"><span id="54785"><a id="54782">D</a></span></span></span>](<span class="typed"><span class="type">D</span><span id="47741"><span id="47740"><span id="55208"><a id="54786">work</a></span></span></span></span>: <span class="typed"><span class="type">D</span><a href="#6661">D</a></span>, <span class="typed"><span class="type">String</span><span id="47743"><span id="47742"><span id="55209"><a id="54787">message</a></span></span></span></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
{
	<span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()String</span><a id="47745">toString</a></span> = <span class="typed"><span class="type">=&gt; String</span><a href="#47742">message</a></span>
}
<span class="keyword">trait</span> <span class="typed"><span class="type">trait Scheduler[D] extends java.lang.Object with NotNull</span><a id="6664">Scheduler</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="6665">D</a></span>] <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
{
	<span class="keyword">def</span> <span class="typed"><span class="type">(D,Option[String])Unit</span><a id="54925">complete</a></span>(<span class="typed"><span class="type">D</span><a id="55339">d</a></span>: <span class="typed"><span class="type">D</span><a href="#6665">D</a></span>, <span class="typed"><span class="type">Option[String]</span><a id="55340">result</a></span>: <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String]): <span class="typed"><span class="type">Unit</span><a id="2150">Unit</a></span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="54926">hasPending</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2151">Boolean</a></span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(Int)Seq[D]</span><a id="54927">next</a></span>(<span class="typed"><span class="type">Int</span><a id="55274">max</a></span>: <span class="typed"><span class="type">Int</span><a id="2375">Int</a></span>): <span class="typed"><span class="type">Seq[D]</span><a id="744">Seq</a></span>[D]
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Iterable[sbt.WorkFailure[D]]</span><a id="54928">result</a></span>: <span class="typed"><span class="type">Iterable[sbt.WorkFailure[D]]</span><a id="384">Iterable</a></span>[WorkFailure[D]]
}

<span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Work[D] extends java.lang.Object with Ordered[sbt.Work[D]] with ScalaObject</span><a id="6666">Work</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="6667">D</a></span>](<span class="keyword">val</span> <span class="typed"><span class="type">String</span><span id="54983"><span id="54982"><a id="55425">name</a></span></span></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>, <span class="keyword">val</span> <span class="typed"><span class="type">D</span><span id="54985"><span id="54984"><a id="55426">data</a></span></span></span>: <span class="typed"><span class="type">D</span><a href="#6667">D</a></span>, <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><span id="54987"><span id="54986"><a id="55427">cost</a></span></span></span>: <span class="typed"><span class="type">Int</span><a id="2375">Int</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">Ordered[sbt.Work[D]]</span><a id="1443">Ordered</a></span>[Work[D]]
{
	<span class="keyword">def</span> <span class="typed"><span class="type">(sbt.Work[D])Int</span><a id="54989">compare</a></span>(<span class="typed"><span class="type">sbt.Work[D]</span><a id="55428">o</a></span>: <span class="typed"><span class="type">sbt.Work[D]</span><a href="#6666">Work</a></span>[D]) = <span class="typed"><span class="type">implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt</span><span id="6097"><a href="#54990" id="802">pathCost</a></span></span> <span class="typed"><span class="type">(Int)Int</span><a id="21590">compare</a></span> <span class="typed"><span class="type">sbt.Work[D]</span><a href="#55428">o</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#54990">pathCost</a></span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Int</span><a id="54990">pathCost</a></span>: <span class="typed"><span class="type">Int</span><a id="2375">Int</a></span>
	<span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()java.lang.String</span><a id="54991">toString</a></span> = <span class="typed"><span class="type">=&gt; String</span><a href="#54982">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;(&quot;)</span><span class="string">&quot;(&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">=&gt; Int</span><a href="#54990">pathCost</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;)&quot;)</span><span class="string">&quot;)&quot;</span></span>
}

<span class="keyword">private</span>[sbt] <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class AbstractDagScheduler[D &lt;: sbt.Dag[D], W] extends java.lang.Object with sbt.Scheduler[W] with ScalaObject</span><a id="6668">AbstractDagScheduler</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: sbt.Dag[D]</span><a id="6669">D</a></span> &lt;: Dag[D], <span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="6670">W</a></span>](<span class="typed"><span class="type">D</span><span id="54931"><a id="55443">root</a></span></span>: <span class="typed"><span class="type">D</span><a href="#6669">D</a></span>, <span class="typed"><span class="type">(D) =&gt; String</span><span id="54932"><a id="55444">name</a></span></span>: D =&gt; String) <span class="keyword">extends</span> <span class="typed"><span class="type">sbt.Scheduler[W]</span><a href="#6664">Scheduler</a></span>[W]
{
	<span class="keyword">protected</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><span id="54935"><a id="54934">remainingDeps</a></span></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a id="8003">Map</a></span>[W, Set[W]] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[W,scala.collection.mutable.Set[W]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[W,scala.collection.mutable.Set[W]]</span><a id="8204">HashMap</a></span>
	<span class="keyword">protected</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><span id="54937"><a id="54936">reverseDeps</a></span></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a id="8003">Map</a></span>[W, Set[W]] = <span class="typed"><span class="type">scala.collection.mutable.HashMap[W,scala.collection.mutable.Set[W]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[W,scala.collection.mutable.Set[W]]</span><a id="8204">HashMap</a></span>
	<span class="keyword">protected</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]</span><span id="54939"><a id="54938">errors</a></span></span> = <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]</span><a id="8048">ListBuffer</a></span>[WorkFailure[W]]
	
	<span class="typed"><span class="type">()Unit</span><a href="#54947">setup</a></span>()
	
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; List[sbt.WorkFailure[W]]</span><a id="54940">result</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]</span><a href="#54938">errors</a></span>.<span class="typed"><span class="type">=&gt; List[sbt.WorkFailure[W]]</span><a id="22662">readOnly</a></span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(W,Option[String])Unit</span><a id="54941">complete</a></span>(<span class="typed"><span class="type">W</span><a id="55453">work</a></span>: <span class="typed"><span class="type">W</span><a href="#6670">W</a></span>, <span class="typed"><span class="type">Option[String]</span><a id="55454">result</a></span>: <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String])
	{
		<span class="typed"><span class="type">Option[String]</span><a href="#55454">result</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span>
		{
			<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="517">None</a></span> =&gt; <span class="typed"><span class="type">(W)Unit</span><a href="#54942">workComplete</a></span>(<span class="typed"><span class="type">W</span><a href="#55453">work</a></span>)
			<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">String</span><a id="55456">errorMessage</a></span>) =&gt;
			{
				<span class="keyword">def</span> <span class="typed"><span class="type">(W)Unit</span><a id="55457">clear</a></span>(<span class="typed"><span class="type">W</span><a id="55458">w</a></span>: <span class="typed"><span class="type">W</span><a href="#6670">W</a></span>)
				{
					<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54934">remainingDeps</a></span> <span class="typed"><span class="type">(W)Unit</span><a id="21400">-=</a></span> <span class="typed"><span class="type">W</span><a href="#55458">w</a></span>
					<span class="keyword">for</span>(<span class="typed"><span class="type">((scala.collection.mutable.Set[W]) =&gt; Unit)Unit</span><span id="10271"><a id="55461">deps</a></span></span> &lt;- <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54936">reverseDeps</a></span>.<span class="typed"><span class="type">(W)Option[scala.collection.mutable.Set[W]]</span><a id="21405">removeKey</a></span>(<span class="typed"><span class="type">W</span><a href="#55458">w</a></span>); <span class="typed"><span class="type">((W) =&gt; Unit)Unit</span><span id="7365"><a id="55463">dep</a></span></span> &lt;- <span class="typed"><span class="type">scala.collection.mutable.Set[W]</span><a href="#55461">deps</a></span>)
						<span class="typed"><span class="type">(W)Unit</span><a href="#55457">clear</a></span>(<span class="typed"><span class="type">W</span><a href="#55463">dep</a></span>)
				}
				<span class="typed"><span class="type">(W)Unit</span><a href="#55457">clear</a></span>(<span class="typed"><span class="type">W</span><a href="#55453">work</a></span>)
				<span class="typed"><span class="type">=&gt; scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]</span><a href="#54938">errors</a></span> <span class="typed"><span class="type">(sbt.WorkFailure[W])Unit</span><a id="22658">+=</a></span> <span class="typed"><span class="type">(W,String)sbt.WorkFailure[W]</span><a href="#54780">WorkFailure</a></span>(<span class="typed"><span class="type">W</span><a href="#55453">work</a></span>, <span class="typed"><span class="type">String</span><a href="#55456">errorMessage</a></span>)
			}
		}
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(W)Unit</span><a id="54942">workComplete</a></span>(<span class="typed"><span class="type">W</span><a id="55455">work</a></span>: <span class="typed"><span class="type">W</span><a href="#6670">W</a></span>)
	{
		<span class="keyword">for</span>(<span class="typed"><span class="type">((scala.collection.mutable.Set[W]) =&gt; Unit)Unit</span><span id="10271"><a id="55466">deps</a></span></span> &lt;- <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54936">reverseDeps</a></span>.<span class="typed"><span class="type">(W)Option[scala.collection.mutable.Set[W]]</span><a id="21405">removeKey</a></span>(<span class="typed"><span class="type">W</span><a href="#55455">work</a></span>); <span class="typed"><span class="type">((W) =&gt; Unit)Unit</span><span id="7365"><a id="55468">dep</a></span></span> &lt;- <span class="typed"><span class="type">scala.collection.mutable.Set[W]</span><a href="#55466">deps</a></span>; <span class="typed"><span class="type">((scala.collection.mutable.Set[W]) =&gt; Unit)Unit</span><span id="10271"><a id="55470">depRemaining</a></span></span> &lt;- <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54934">remainingDeps</a></span>.<span class="typed"><span class="type">(W)Option[scala.collection.mutable.Set[W]]</span><a id="21438">get</a></span>(<span class="typed"><span class="type">W</span><a href="#55468">dep</a></span>))
		{
			<span class="typed"><span class="type">scala.collection.mutable.Set[W]</span><a href="#55470">depRemaining</a></span> <span class="typed"><span class="type">(W)Unit</span><a id="22487">-=</a></span> <span class="typed"><span class="type">W</span><a href="#55455">work</a></span>
			<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">scala.collection.mutable.Set[W]</span><a href="#55470">depRemaining</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="22296">isEmpty</a></span>)
			{
				<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54934">remainingDeps</a></span> <span class="typed"><span class="type">(W)Unit</span><a id="21400">-=</a></span> <span class="typed"><span class="type">W</span><a href="#55468">dep</a></span>
				<span class="typed"><span class="type">(W)Unit</span><a href="#54943">workReady</a></span>(<span class="typed"><span class="type">W</span><a href="#55468">dep</a></span>)
			}
		}
	}
	<span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(W)Unit</span><a id="54943">workReady</a></span>(<span class="typed"><span class="type">W</span><a id="55473">work</a></span>: <span class="typed"><span class="type">W</span><a href="#6670">W</a></span>): <span class="typed"><span class="type">Unit</span><a id="2150">Unit</a></span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="54944">hasReady</a></span>: <span class="typed"><span class="type">Boolean</span><a id="2151">Boolean</a></span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="54945">hasPending</a></span> = <span class="typed"><span class="type">=&gt; Boolean</span><a href="#54944">hasReady</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2731">||</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2728">!</a></span><span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54934">remainingDeps</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="21441">isEmpty</a></span>
	<span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String,D)W</span><a id="54946">workConstructor</a></span>(<span class="typed"><span class="type">String</span><a id="55477">name</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>, <span class="typed"><span class="type">D</span><a id="55478">data</a></span>: <span class="typed"><span class="type">D</span><a href="#6669">D</a></span>): <span class="typed"><span class="type">W</span><a href="#6670">W</a></span>
	
	<span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="54947">setup</a></span>()
	{
		<span class="typed"><span class="type">(D)Unit</span><a href="#54948">setup</a></span>(<span class="typed"><span class="type">D</span><a href="#54931">root</a></span>)
		<span class="keyword">val</span> <span class="typed"><span class="type">Iterable[W]</span><a id="55479">startReady</a></span> = <span class="keyword">for</span>( <span class="typed"><span class="type">(((W, scala.collection.mutable.Set[W])) =&gt; W)Iterable[W]</span><span id="7355"><a href="#55482" id="7359">(</a></span></span><span class="typed"><span class="type">W</span><span id="55483"><span id="55487"><a id="55492">key</a></span></span></span>, <span class="typed"><span class="type">scala.collection.mutable.Set[W]</span><span id="55484"><span id="55488"><a id="55493">value</a></span></span></span>) &lt;- <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54934">remainingDeps</a></span> <span class="keyword">if</span>(<span class="typed"><span class="type">scala.collection.mutable.Set[W]</span><a href="#55488">value</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="22296">isEmpty</a></span>)) <span class="keyword">yield</span> <span class="typed"><span class="type">W</span><a href="#55492">key</a></span>
		<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54934">remainingDeps</a></span> <span class="typed"><span class="type">(Iterable[W])Unit</span><a id="21402">--=</a></span> <span class="typed"><span class="type">Iterable[W]</span><a href="#55479">startReady</a></span>
		<span class="typed"><span class="type">Iterable[W]</span><a href="#55479">startReady</a></span>.<span class="typed"><span class="type">((W) =&gt; Unit)Unit</span><a id="7365">foreach</a></span>(<span class="typed"><span class="type">(W)Unit</span><a href="#54943">workReady</a></span>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(D)Unit</span><a id="54948">setup</a></span>(<span class="typed"><span class="type">D</span><a id="55450">node</a></span>: <span class="typed"><span class="type">D</span><a href="#6669">D</a></span>)
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[D,W]</span><a id="55497">dToWork</a></span> = <span class="typed"><span class="type">scala.collection.mutable.HashMap[D,W]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[D,W]</span><a id="8204">HashMap</a></span>[D, W]()
		<span class="keyword">def</span> <span class="typed"><span class="type">(D)W</span><a id="55498">getWork</a></span>(<span class="typed"><span class="type">D</span><a id="55500">node</a></span>: <span class="typed"><span class="type">D</span><a href="#6669">D</a></span>) = <span class="typed"><span class="type">scala.collection.mutable.HashMap[D,W]</span><a href="#55497">dToWork</a></span>.<span class="typed"><span class="type">(D,=&gt; W)W</span><a id="21411">getOrElseUpdate</a></span>(<span class="typed"><span class="type">D</span><a href="#55500">node</a></span>, <span class="typed"><span class="type">(D)W</span><a href="#55499">createWork</a></span>(<span class="typed"><span class="type">D</span><a href="#55500">node</a></span>))
		<span class="keyword">def</span> <span class="typed"><span class="type">(D)W</span><a id="55499">createWork</a></span>(<span class="typed"><span class="type">D</span><a id="55501">node</a></span>: <span class="typed"><span class="type">D</span><a href="#6669">D</a></span>): <span class="typed"><span class="type">W</span><a href="#6670">W</a></span> =
		{
			<span class="keyword">val</span> <span class="typed"><span class="type">Iterable[W]</span><a id="55502">workDependencies</a></span> = <span class="typed"><span class="type">D</span><a href="#55501">node</a></span>.<span class="typed"><span class="type">=&gt; Iterable[D]</span><a href="Dag.scala.html#25363">dependencies</a></span>.<span class="typed"><span class="type">((D) =&gt; W)Iterable[W]</span><a id="7355">map</a></span>(<span class="typed"><span class="type">(D)W</span><a href="#55498">getWork</a></span>(<span class="typed"><span class="type">D</span><a href="#55506">_</a></span>))
			<span class="keyword">val</span> <span class="typed"><span class="type">W</span><a id="55503">w</a></span> = <span class="typed"><span class="type">(String,D)W</span><a href="#54946">workConstructor</a></span>(<span class="typed"><span class="type">(D)String</span><a href="#54932" id="7330">name</a></span>(<span class="typed"><span class="type">D</span><a href="#55501">node</a></span>), <span class="typed"><span class="type">D</span><a href="#55501">node</a></span>)
			<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54934">remainingDeps</a></span>(<span class="typed"><span class="type">W</span><a href="#55503">w</a></span>) = <span class="typed"><span class="type">(W*)scala.collection.mutable.Set[W]</span><span id="22731"><a id="8019">HashSet</a></span></span>(<span class="typed"><span class="type">Iterable[W]</span><a href="#55502">workDependencies</a></span>.<span class="typed"><span class="type">=&gt; Seq[W]</span><a id="7389">toSeq</a></span>: _*)
			<span class="keyword">for</span>(<span class="typed"><span class="type">((W) =&gt; Unit)Unit</span><span id="7365"><a id="55509">dep</a></span></span> &lt;- <span class="typed"><span class="type">Iterable[W]</span><a href="#55502">workDependencies</a></span>)
				<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]</span><a href="#54936">reverseDeps</a></span>.<span class="typed"><span class="type">(W,=&gt; scala.collection.mutable.Set[W])scala.collection.mutable.Set[W]</span><a id="21411">getOrElseUpdate</a></span>(<span class="typed"><span class="type">W</span><a href="#55509">dep</a></span>, <span class="typed"><span class="type">scala.collection.mutable.HashSet[W]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[W]</span><a id="8018">HashSet</a></span>[W]) <span class="typed"><span class="type">(W)Unit</span><a id="22478">+=</a></span> <span class="typed"><span class="type">W</span><a href="#55503">w</a></span>
			<span class="typed"><span class="type">W</span><a href="#55503">w</a></span>
		}
		<span class="typed"><span class="type">(D)W</span><a href="#55498">getWork</a></span>(<span class="typed"><span class="type">D</span><a href="#55450">node</a></span>)
	}
}
<span class="keyword">private</span> <span class="keyword">class</span> <span class="typed"><span class="type">class BasicDagScheduler[D &lt;: sbt.Dag[D]] extends sbt.AbstractDagScheduler[D,sbt.Work[D]] with ScalaObject</span><a id="6671">BasicDagScheduler</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: sbt.Dag[D]</span><a id="6672">D</a></span> &lt;: Dag[D]](<span class="typed"><span class="type">D</span><span id="54997"><a id="55007">root</a></span></span>: <span class="typed"><span class="type">D</span><a href="#6672">D</a></span>, <span class="typed"><span class="type">(D) =&gt; String</span><span id="54998"><a id="55008">name</a></span></span>: D =&gt; String, <span class="typed"><span class="type">(D) =&gt; Int</span><span id="54999"><a id="55009">cost</a></span></span>: D =&gt; Int) <span class="keyword">extends</span>
{
	<span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.PriorityQueue[sbt.Work[D]]</span><span id="54996"><span id="54995"><a id="55520">ready</a></span></span></span> = <span class="typed"><span class="type">scala.collection.mutable.PriorityQueue[sbt.Work[D]]</span><span id="6093"><a href="#55523" id="802" class="keyword">new</a></span></span> <span class="typed"><span class="type">scala.collection.mutable.PriorityQueue[sbt.Work[D]]</span><a id="8324">PriorityQueue</a></span>[Work[D]]

} <span class="keyword">with</span> <span class="typed"><span class="type">sbt.AbstractDagScheduler[D,sbt.Work[D]]</span><a href="#6668">AbstractDagScheduler</a></span>[D, Work[D]](<span class="typed"><span class="type">D</span><a href="#55007">root</a></span>, <span class="typed"><span class="type">(D) =&gt; String</span><a href="#55008">name</a></span>) {
	
	<span class="keyword">def</span> <span class="typed"><span class="type">(Int)List[sbt.Work[D]]</span><a id="55001">next</a></span>(<span class="typed"><span class="type">Int</span><a id="55524">max</a></span>: <span class="typed"><span class="type">Int</span><a id="2375">Int</a></span>): <span class="typed"><span class="type">List[sbt.Work[D]]</span><a id="507">List</a></span>[Work[D]] =
	{
		<span class="typed"><span class="type">(Boolean)Unit</span><span id="5971"><a id="802">require</a></span></span>(<span class="typed"><span class="type">Int</span><a href="#55524">max</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3126">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
		<span class="keyword">def</span> <span class="typed"><span class="type">(Int)List[sbt.Work[D]]</span><a id="55525">nextImpl</a></span>(<span class="typed"><span class="type">Int</span><a id="55528">remaining</a></span>: <span class="typed"><span class="type">Int</span><a id="2375">Int</a></span>): <span class="typed"><span class="type">List[sbt.Work[D]]</span><a id="507">List</a></span>[Work[D]] =
			<span class="typed"><span class="type">List[sbt.Work[D]]</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">Int</span><a href="#55528">remaining</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3125">&lt;=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2731">||</a></span> <span class="typed"><span class="type">=&gt; scala.collection.mutable.PriorityQueue[sbt.Work[D]]</span><a href="#54995">ready</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="54959">isEmpty</a></span>)
				<span class="typed"><span class="type">object Nil</span><a id="316">Nil</a></span>
			<span class="keyword">else</span>
				<span class="typed"><span class="type">=&gt; scala.collection.mutable.PriorityQueue[sbt.Work[D]]</span><a href="#54995">ready</a></span>.<span class="typed"><span class="type">()sbt.Work[D]</span><a id="54969">dequeue</a></span> <span class="typed"><span class="type">(sbt.Work[D])List[sbt.Work[D]]</span><a href="#55530" id="6908">::</a></span> <span class="typed"><span class="type">(Int)List[sbt.Work[D]]</span><a href="#55525">nextImpl</a></span>(<span class="typed"><span class="type">Int</span><a href="#55528">remaining</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3129">-</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)
		<span class="typed"><span class="type">(Int)List[sbt.Work[D]]</span><a href="#55525">nextImpl</a></span>(<span class="typed"><span class="type">Int</span><a href="#55524">max</a></span>)
	}
	
	<span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(sbt.Work[D])Unit</span><a id="55002">workReady</a></span>(<span class="typed"><span class="type">sbt.Work[D]</span><a id="55547">dep</a></span>: <span class="typed"><span class="type">sbt.Work[D]</span><a href="#6666">Work</a></span>[D]) { <span class="typed"><span class="type">=&gt; scala.collection.mutable.PriorityQueue[sbt.Work[D]]</span><a href="#54995">ready</a></span> <span class="typed"><span class="type">(sbt.Work[D])Unit</span><a id="54960">+=</a></span> <span class="typed"><span class="type">sbt.Work[D]</span><a href="#55547">dep</a></span> }
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="55003">hasReady</a></span> = <span class="typed"><span class="type">=&gt; Boolean</span><a id="2728">!</a></span><span class="typed"><span class="type">=&gt; scala.collection.mutable.PriorityQueue[sbt.Work[D]]</span><a href="#54995">ready</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="54959">isEmpty</a></span>
	<span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String,D)sbt.Work[D]</span><a id="55004">workConstructor</a></span>(<span class="typed"><span class="type">String</span><a id="55551">name</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>, <span class="typed"><span class="type">D</span><a id="55552">data</a></span>: <span class="typed"><span class="type">D</span><a href="#6672">D</a></span>) =
		<span class="typed"><span class="type">template $anon extends sbt.Work[D]</span><a id="55554" class="keyword">new</a></span> <span class="typed"><span class="type">sbt.Work[D]</span><a href="#6666">Work</a></span>(<span class="typed"><span class="type">String</span><a href="#55551">name</a></span>, <span class="typed"><span class="type">D</span><a href="#55552">data</a></span>, <span class="typed"><span class="type">(D)Int</span><a href="#54999" id="7330">cost</a></span>(<span class="typed"><span class="type">D</span><a href="#55552">data</a></span>)) {
			<span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="55558">pathCost</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[sbt.Work[D],scala.collection.mutable.Set[sbt.Work[D]]]</span><a href="#54936">reverseDeps</a></span>.<span class="typed"><span class="type">(sbt.Work[D],=&gt; Collection[sbt.Work[D]] with (sbt.Work[D] with Int) =&gt; Boolean)Collection[sbt.Work[D]] with (sbt.Work[D] with Int) =&gt; Boolean</span><a id="21439">getOrElse</a></span>(<span class="typed"><span class="type">sbt.Work[D]{ ... }</span><a href="#55554" class="keyword">this</a></span>, <span class="typed"><span class="type">object Nil</span><a id="316">Nil</a></span>).<span class="typed"><span class="type">(Int)((Int, sbt.Work[D]) =&gt; Int)Int</span><a id="7372">foldLeft</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)(<span class="typed"><span class="type">implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt</span><span id="6097"><a href="#55594" id="802">_</a></span></span> <span class="typed"><span class="type">(Int)Int</span><a id="21595">max</a></span> <span class="typed"><span class="type">sbt.Work[D]</span><a href="#55595">_</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#54990">pathCost</a></span>) <span class="typed"><span class="type">(Int)Int</span><a id="3128">+</a></span> <span class="typed"><span class="type">this.type</span><a href="#55554" class="keyword">this</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#54986">cost</a></span>
		}
	<span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="55005">setup</a></span>()
	{
		<span class="keyword">super</span>.<span class="typed"><span class="type">()Unit</span><a href="#54947">setup</a></span>()
		<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[sbt.Work[D],scala.collection.mutable.Set[sbt.Work[D]]]</span><a href="#54934">remainingDeps</a></span>.<span class="typed"><span class="type">=&gt; Iterator[sbt.Work[D]]</span><a id="21445">keys</a></span>.<span class="typed"><span class="type">((sbt.Work[D]) =&gt; Unit)Unit</span><a id="21186">foreach</a></span>(<span class="typed"><span class="type">sbt.Work[D]</span><a id="55609">dep</a></span> =&gt; <span class="typed"><span class="type">sbt.Work[D]</span><a href="#55609">dep</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="#54990">pathCost</a></span>)
	}
}
        </pre>
    </body>
</html>