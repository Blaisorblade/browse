<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/ParallelRunner.scala</title>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">import</span> scala.actors.Actor
<span class="keyword">import</span> scala.collection.mutable.{ArrayBuffer, Buffer, HashMap, HashSet, ListBuffer, Map, PriorityQueue, Set}

<span class="keyword">object</span> <a title="object sbt.ParallelRunner" id="6555">ParallelRunner</a>
{
	<span class="keyword">def</span> <a title="[D &lt;: sbt.Dag[D]](D,(D) =&gt; String,(D) =&gt; Option[String],Int,(D) =&gt; sbt.Logger)List[sbt.WorkFailure[D]]" id="53889">run</a>[<a title="&gt;: Nothing &lt;: sbt.Dag[D]" id="53891">D</a> &lt;: Dag[D]](<a title="D" id="53897">node</a>: <a href="#53891" title="D">D</a>, <a title="(D) =&gt; String" id="53898">name</a>: D =&gt; String, <a title="(D) =&gt; Option[String]" id="53899">action</a>: D =&gt; Option[String], <a title="Int" id="53900">maximumTasks</a>: <a title="Int" id="2296">Int</a>, <a title="(D) =&gt; sbt.Logger" id="53901">log</a>: D =&gt; Logger): <a title="List[sbt.WorkFailure[D]]" id="481">List</a>[WorkFailure[D]] =
	{
		<span class="keyword">val</span> <a title="sbt.BasicDagScheduler[D]" id="54073">jobScheduler</a> = <span title="sbt.BasicDagScheduler[D]" class="keyword">new</span> <a href="#6572" title="sbt.BasicDagScheduler[D]">BasicDagScheduler</a>(<a href="#53897" title="D">node</a>, <a href="#53898" title="(D) =&gt; String">name</a>, (<a title="D" id="54165">d</a>: <a href="#53891" title="D">D</a>) =&gt; <span title="Int(1)" class="int">1</span>)
		<span class="keyword">val</span> <a title="sbt.Distributor[sbt.Work[D]]" id="54074">distributor</a> = <span title="sbt.Distributor[sbt.Work[D]]" class="keyword">new</span> <a href="#6559" title="sbt.Distributor[sbt.Work[D]]">Distributor</a>(<a href="#54073" title="sbt.BasicDagScheduler[D]">jobScheduler</a>, <a href="#53892" title="((D) =&gt; Option[String])(sbt.Work[D])Option[String]">withWork</a>(<a href="#53899" title="(D) =&gt; Option[String]">action</a>), <a href="#53900" title="Int">maximumTasks</a>, <a href="#53892" title="((D) =&gt; sbt.Logger)(sbt.Work[D])sbt.Logger">withWork</a>(<a href="#53901" title="(D) =&gt; sbt.Logger">log</a>))
		<a href="#54074" title="sbt.Distributor[sbt.Work[D]]">distributor</a>.<a title="()scala.actors.Actor" id="54231">start</a>()
		<span class="keyword">val</span> <a title="List[sbt.WorkFailure[sbt.Work[D]]]" id="54075">result</a> = (<a href="#54074" title="sbt.Distributor[sbt.Work[D]]">distributor</a> <a title="(Any)Any" id="54197">!?</a> <a href="#6557" title="object sbt.Start">Start</a>).<a title="List[sbt.WorkFailure[sbt.Work[D]]]" id="3393">asInstanceOf</a>[<a title="List[sbt.WorkFailure[sbt.Work[D]]]" id="481">List</a>[WorkFailure[Work[D]]]]
		<span class="keyword">for</span>( <span id="6835"><a href="#54362" title="((sbt.WorkFailure[sbt.Work[D]]) =&gt; sbt.WorkFailure[D])List[sbt.WorkFailure[D]]" id="6840">WorkFailure</a></span>(<span id="54370"><a title="sbt.Work[D]" id="54376">work</a></span>, <span id="54371"><a title="String" id="54377">message</a></span>) &lt;- <a href="#54075" title="List[sbt.WorkFailure[sbt.Work[D]]]">result</a> ) <span class="keyword">yield</span> <a href="#53930" title="(D,String)sbt.WorkFailure[D]">WorkFailure</a>(<a href="#54376" title="sbt.Work[D]">work</a>.<a href="#54135" title="=&gt; D">data</a>, <span title="java.lang.String(&quot;Error running &quot;)" class="string">&quot;Error running &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#53898" title="(D)String" id="7221">name</a>(<a href="#54376" title="sbt.Work[D]">work</a>.<a href="#54135" title="=&gt; D">data</a>) <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#54377" title="String">message</a>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="[D, T]((D) =&gt; T)(sbt.Work[D])T" id="53892">withWork</a>[<a title="&gt;: Nothing &lt;: Any" id="53895">D</a>, <a title="&gt;: Nothing &lt;: Any" id="53896">T</a>](<a title="(D) =&gt; T" id="54348">f</a>: D =&gt; T)(<a title="sbt.Work[D]" id="54349">w</a>: <a href="#6567" title="sbt.Work[D]">Work</a>[D]) = <a href="#54348" title="(D)T" id="7221">f</a>(<a href="#54349" title="sbt.Work[D]">w</a>.<a href="#54135" title="=&gt; D">data</a>)
}
<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">object</span> <span id="54387"><span id="54382"><span id="6557"><span id="54385"><span id="54381"><span id="3390"><span id="54384"><span id="54380"><span id="27651"><a title="object sbt.Start" id="54383">Start</a></span></span></span></span></span></span></span></span></span>
<span class="keyword">final</span> <span class="keyword">class</span> <a title="class Distributor[D] extends java.lang.Object with scala.actors.Actor with NotNull with ScalaObject" id="6559">Distributor</a>[<a title="&gt;: Nothing &lt;: Any" id="6560">D</a>](<span id="54305"><a title="sbt.Scheduler[D]" id="54344">scheduler</a></span>: <a href="#6565" title="sbt.Scheduler[D]">Scheduler</a>[D], <span id="54306"><a title="(D) =&gt; Option[String]" id="54345">doWork</a></span>: D =&gt; Option[String], <span id="54307"><a title="Int" id="54346">workers</a></span>: <a title="Int" id="2296">Int</a>, <span id="54308"><a title="(D) =&gt; sbt.Logger" id="54347">log</a></span>: D =&gt; Logger) <span class="keyword">extends</span> <a title="scala.actors.Actor" id="46499">Actor</a> <span class="keyword">with</span> <a title="NotNull" id="187">NotNull</a>
{
	<span class="keyword">private</span> <span class="keyword">val</span> <span id="54311"><a title="scala.collection.mutable.HashSet[Distributor.this.Worker]" id="54310">running</a></span> = <span title="scala.collection.mutable.HashSet[Distributor.this.Worker]" class="keyword">new</span> <a title="scala.collection.mutable.HashSet[Distributor.this.Worker]" id="7909">HashSet</a>[Worker]
	<span class="keyword">private</span> <span class="keyword">val</span> <span id="54313"><a title="scala.collection.mutable.Buffer[Distributor.this.Worker]" id="54312">idle</a></span>: <a title="scala.collection.mutable.Buffer[Distributor.this.Worker]" id="7975">Buffer</a>[Worker] = <span title="scala.collection.mutable.ArrayBuffer[Distributor.this.Worker]" class="keyword">new</span> <a title="scala.collection.mutable.ArrayBuffer[Distributor.this.Worker]" id="8143">ArrayBuffer</a>[Worker]
	<a href="#54312" title="=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]">idle</a> <a title="(Iterable[Distributor.this.Worker])Unit" id="21719">++=</a> <a title="object Array" id="1004">Array</a>.<a title="((Int) =&gt; Distributor.this.Worker)(Int)Array[Distributor.this.Worker]" id="7016">fromFunction</a>( (<a title="Int" id="54412">i</a>: <a title="Int" id="2296">Int</a>) =&gt; { <span class="keyword">val</span> <a title="Distributor.this.Worker" id="54413">w</a> = <span title="Distributor.this.Worker" class="keyword">new</span> <a href="#54317" title="Distributor.this.Worker">Worker</a>; <a href="#54413" title="Distributor.this.Worker">w</a>.<a title="()scala.actors.Actor" id="54231">start</a>(); <a href="#54413" title="Distributor.this.Worker">w</a> } )(<a href="#54307" title="Int">workers</a>)
	
	<span class="keyword">def</span> <a title="()Unit" id="54314">act</a>
	{
		<a href="#6559" title="(PartialFunction[Any,Unit])Unit" id="54188">receive</a> <a href="#54419" title="Unit">{</a>
			<span title="Unit" class="keyword">case</span> <a href="#6557" title="object sbt.Start">Start</a> =&gt;
				<a href="#6559" title="(Any)Unit" id="54202">reply</a> {
					<a href="#54315" title="()Unit">runNext</a>()
					<a href="#54305" title="sbt.Scheduler[D]">scheduler</a>.<a href="#54079" title="=&gt; Iterable[sbt.WorkFailure[D]]">result</a>
				}
		}
		<a href="#6559" title="()Nothing" id="54253">exit</a>()
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="54315">runNext</a>()
	{
		<span class="keyword">val</span> <a title="Boolean" id="54427">done</a> = <a href="#54316" title="()Boolean">next</a>()
		<span title="Unit" class="keyword">if</span>(<a title="=&gt; Boolean" id="2637">!</a><a href="#54427" title="Boolean">done</a>)
		{
			<a href="#6559" title="(PartialFunction[Any,Unit])Unit" id="54188">receive</a>
			<a href="#54471" title="Unit">{</a>
				<span title="Unit" class="keyword">case</span> <a id="1">Done</a>(<a title="Option[String]" id="54494">result</a>, <a title="Distributor.this.Worker" id="54495">worker</a>, <a title="D" id="54496">data</a>) =&gt;
					<a href="#54310" title="=&gt; scala.collection.mutable.HashSet[Distributor.this.Worker]">running</a> <a title="(Distributor.this.Worker)Unit" id="21761">-=</a> <a href="#54495" title="Distributor.this.Worker">worker</a>
					<a href="#54312" title="=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]">idle</a> <a title="(Distributor.this.Worker)Unit" id="21715">+=</a> <a href="#54495" title="Distributor.this.Worker">worker</a>
					<a href="#54305" title="sbt.Scheduler[D]">scheduler</a>.<a href="#54076" title="(D,Option[String])Unit">complete</a>(<a href="#54496" title="D">data</a>, <a href="#54494" title="Option[String]">result</a>)
					<a href="#54315" title="()Unit">runNext</a>()
			}
		}
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()Boolean" id="54316">next</a>() =
	{
		<span title="Boolean" class="keyword">if</span>(<a href="#54312" title="=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]">idle</a>.<a title="=&gt; Boolean" id="7108">isEmpty</a>)
			<span title="Boolean(false)" class="keyword">false</span>
		<span class="keyword">else</span> <span title="Boolean" class="keyword">if</span>(<a href="#54305" title="sbt.Scheduler[D]">scheduler</a>.<a href="#54077" title="=&gt; Boolean">hasPending</a>)
		{
			<span class="keyword">val</span> <a title="Int" id="54430">available</a> = <a href="#54312" title="=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]">idle</a>.<a title="=&gt; Int" id="7107">size</a>
			<span class="keyword">val</span> <a title="Seq[D]" id="54431">next</a> = <a href="#54305" title="sbt.Scheduler[D]">scheduler</a>.<a href="#54078" title="(Int)Seq[D]">next</a>(<a href="#54430" title="Int">available</a>)
			<span class="keyword">val</span> <a title="Int" id="54432">nextSize</a> = <a href="#54431" title="Seq[D]">next</a>.<a title="=&gt; Int" id="7107">size</a>
			<span title="Unit" class="keyword">if</span>(<a href="#54432" title="Int">nextSize</a> <a title="(Int)Boolean" id="3034">&lt;=</a> <span title="Int(0)" class="int">0</span>)
				<span id="5878"><a title="(Boolean)Unit" id="770">assume</a></span>(<a title="=&gt; Boolean" id="2637">!</a><a href="#54310" title="=&gt; scala.collection.mutable.HashSet[Distributor.this.Worker]">running</a>.<a title="=&gt; Boolean" id="21330">isEmpty</a>)
			<span class="keyword">else</span>
			{
				<span id="5878"><a title="(Boolean)Unit" id="770">assume</a></span>(<a href="#54432" title="Int">nextSize</a> <a title="(Int)Boolean" id="3035">&gt;</a> <span title="Int(0)" class="int">0</span>)
				<span id="5878"><a title="(Boolean)Unit" id="770">assume</a></span>(<a href="#54432" title="Int">nextSize</a> <a title="(Int)Boolean" id="3034">&lt;=</a> <a href="#54430" title="Int">available</a>)
				<span class="keyword">for</span>(<span id="7256"><a title="((D) =&gt; Unit)Unit" id="54441">data</a></span> &lt;- <a href="#54431" title="Seq[D]">next</a>)
				{
					<span class="keyword">val</span> <a title="Distributor.this.Worker" id="54442">worker</a> = <a href="#54312" title="=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]">idle</a>.<a title="(Int)Distributor.this.Worker" id="21735">remove</a>(<a href="#54312" title="=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]">idle</a>.<a title="=&gt; Int" id="7107">size</a> <a title="(Int)Int" id="3038">-</a> <span title="Int(1)" class="int">1</span>)
					<a href="#54310" title="=&gt; scala.collection.mutable.HashSet[Distributor.this.Worker]">running</a> <a title="(Distributor.this.Worker)Unit" id="21760">+=</a> <a href="#54442" title="Distributor.this.Worker">worker</a>
					<a href="#54442" title="Distributor.this.Worker">worker</a> <a title="(Any)Unit" id="54195">!</a> <a href="#54459" title="(D)Distributor.this.Run">Run</a>(<a href="#54441" title="D">data</a>)
				}
			}
			<span title="Boolean(false)" class="keyword">false</span>
		}
		<span class="keyword">else</span> <span title="Boolean" class="keyword">if</span>(<a href="#54310" title="=&gt; scala.collection.mutable.HashSet[Distributor.this.Worker]">running</a>.<a title="=&gt; Boolean" id="21330">isEmpty</a>)
		{
			<a href="#54312" title="=&gt; scala.collection.mutable.Buffer[Distributor.this.Worker]">idle</a>.<a title="((Distributor.this.Worker) =&gt; Unit)Unit" id="7256">foreach</a>(<a href="#54467" title="Distributor.this.Worker">_</a> <a title="(Any)Unit" id="54195">!</a> <a href="#54318" title="object Distributor.this.Shutdown">Shutdown</a>)
			<span title="Boolean(true)" class="keyword">true</span>
		}
		<span class="keyword">else</span>
			<span title="Boolean(false)" class="keyword">false</span>
	}
	<span class="keyword">private</span> <span class="keyword">class</span> <a title="class Worker extends java.lang.Object with scala.actors.Actor with NotNull with ScalaObject" id="54317">Worker</a> <span class="keyword">extends</span> <a title="scala.actors.Actor" id="46499">Actor</a> <span class="keyword">with</span> <a title="NotNull" id="187">NotNull</a>
	{
		<span class="keyword">def</span> <a title="()Unit" id="54415">act</a>
		{
			<a href="#54502" title="Unit" class="keyword">while</a>(<span title="Boolean(true)" class="keyword">true</span>)
			{
				<a href="#54317" title="(PartialFunction[Any,Unit])Unit" id="54188">receive</a>
				<a href="#54505" title="Unit">{</a>
					<span title="Unit" class="keyword">case</span> <a id="1">Run</a>(<a title="D" id="54510">data</a>)  =&gt;
					{
						<span class="keyword">val</span> <a title="Option[String]" id="54511">result</a> = <a href="Control.scala.html#6605" title="object sbt.Control">Control</a>.<a href="Control.scala.html#10189" title="(=&gt; String,sbt.Logger)(=&gt; Option[String])Option[String]">trapUnit</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#54308" title="(D)sbt.Logger" id="7221">log</a>(<a href="#54510" title="D">data</a>))(<a href="#54306" title="(D)Option[String]" id="7221">doWork</a>(<a href="#54510" title="D">data</a>))
						<a href="#6559" title="Distributor.this.type">Distributor</a>.<span class="keyword">this</span> <a title="(Any)Unit" id="54195">!</a> <a href="#54473" title="(Option[String],Distributor.this.Worker,D)Distributor.this.Done">Done</a>(<a href="#54511" title="Option[String]">result</a>, <a href="#54317" title="Distributor.this.Worker" class="keyword">this</a>, <a href="#54510" title="D">data</a>)
					}
					<span title="Nothing" class="keyword">case</span> <a href="#54318" title="object Distributor.this.Shutdown">Shutdown</a> =&gt; <a href="#54317" title="()Nothing" id="54253">exit</a>()
				}
			}
		}
	}
	
	<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">object</span> <span id="54527"><span id="54523"><span id="54522"><span id="3390"><span id="54318"><span id="54526"><span id="54529"><span id="27651"><span id="54524"><a title="object Distributor.this.Shutdown" id="54525">Shutdown</a></span></span></span></span></span></span></span></span></span> <span class="keyword">extends</span> <a title="NotNull" id="187">NotNull</a>
	<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">class</span> <span id="2640"><span id="54539"><span id="5675"><span id="54320"><span id="3391"><span id="54537"><span id="54534"><span id="54321"><span id="54541"><span id="3386"><span id="275"><span id="10256"><span id="54535"><span id="27624"><span id="54464"><span id="54506"><span id="54459"><span id="54538"><span id="54536"><span id="54533"><span id="27623"><span id="3390"><span id="2641"><span id="54532"><span id="54540"><a title="class Run extends java.lang.Object with NotNull with ScalaObject with Product" id="27651">Run</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span id="54462"><span id="54461"><span id="54509"><a title="D" id="54465">data</a></span></span></span>: <a href="#6560" title="D">D</a>) <span class="keyword">extends</span> <a title="NotNull" id="187">NotNull</a>
	<span class="keyword">private</span> <span class="keyword">case</span> <span class="keyword">class</span> <span id="2640"><span id="54473"><span id="3391"><span id="54484"><span id="54558"><span id="10256"><span id="54547"><span id="9216"><span id="27624"><span id="54553"><span id="54551"><span id="27623"><span id="54552"><span id="2641"><span id="54324"><span id="54557"><span id="54554"><span id="54323"><span id="5675"><span id="54549"><span id="3386"><span id="54550"><span id="275"><span id="3399"><span id="54560"><span id="54559"><span id="3390"><span id="54485"><span id="404"><span id="27651"><a title="class Done extends java.lang.Object with NotNull with ScalaObject with Product" id="54548">Done</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>(<span id="54478"><span id="54477"><span id="54491"><a title="Option[String]" id="54512">result</a></span></span></span>: <a title="Option[String]" id="871">Option</a>[String], <span id="54480"><span id="54479"><span id="54492"><a title="Distributor.this.Worker" id="54513">worker</a></span></span></span>: <a href="#54317" title="Distributor.this.Worker">Worker</a>, <span id="54482"><span id="54481"><span id="54493"><a title="D" id="54514">data</a></span></span></span>: <a href="#6560" title="D">D</a>) <span class="keyword">extends</span> <a title="NotNull" id="187">NotNull</a>
}
<span class="keyword">final</span> <span class="keyword">case</span> <span class="keyword">class</span> <span id="2640"><span id="3391"><span id="53933"><span id="54577"><span id="54578"><span id="10256"><span id="27624"><span id="54572"><span id="6563"><span id="54569"><span id="54571"><span id="54574"><span id="54363"><span id="2641"><span id="53930"><span id="54576"><span id="5675"><span id="6561"><span id="54573"><span id="3386"><span id="275"><span id="9252"><span id="1283"><span id="54579"><span id="3399"><span id="54570"><span id="3390"><a title="class WorkFailure[D] extends java.lang.Object with NotNull with ScalaObject with Product" id="27651">WorkFailure</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>[<span id="6562"><span id="53935"><a title="&gt;: Nothing &lt;: Any" id="53932">D</a></span></span>](<span id="46840"><span id="46839"><span id="54368"><a title="D" id="53936">work</a></span></span></span>: <a href="#6562" title="D">D</a>, <span id="46842"><span id="46841"><span id="54369"><a title="String" id="53937">message</a></span></span></span>: <a title="String" id="1751">String</a>) <span class="keyword">extends</span> <a title="NotNull" id="187">NotNull</a>
{
	<span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="46844">toString</a> = <a href="#46841" title="=&gt; String">message</a>
}
<span class="keyword">trait</span> <a title="trait Scheduler[D] extends java.lang.Object with NotNull" id="6565">Scheduler</a>[<a title="&gt;: Nothing &lt;: Any" id="6566">D</a>] <span class="keyword">extends</span> <a title="NotNull" id="187">NotNull</a>
{
	<span class="keyword">def</span> <a title="(D,Option[String])Unit" id="54076">complete</a>(<a title="D" id="54498">d</a>: <a href="#6566" title="D">D</a>, <a title="Option[String]" id="54499">result</a>: <a title="Option[String]" id="871">Option</a>[String]): <a title="Unit" id="2059">Unit</a>
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="54077">hasPending</a>: <a title="Boolean" id="2060">Boolean</a>
	<span class="keyword">def</span> <a title="(Int)Seq[D]" id="54078">next</a>(<a title="Int" id="54433">max</a>: <a title="Int" id="2296">Int</a>): <a title="Seq[D]" id="715">Seq</a>[D]
	<span class="keyword">def</span> <a title="=&gt; Iterable[sbt.WorkFailure[D]]" id="54079">result</a>: <a title="Iterable[sbt.WorkFailure[D]]" id="358">Iterable</a>[WorkFailure[D]]
}

<span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class Work[D] extends java.lang.Object with Ordered[sbt.Work[D]] with ScalaObject" id="6567">Work</a>[<a title="&gt;: Nothing &lt;: Any" id="6568">D</a>](<span class="keyword">val</span> <span id="54134"><span id="54133"><a title="String" id="54586">name</a></span></span>: <a title="String" id="1751">String</a>, <span class="keyword">val</span> <span id="54136"><span id="54135"><a title="D" id="54587">data</a></span></span>: <a href="#6568" title="D">D</a>, <span class="keyword">val</span> <span id="54138"><span id="54137"><a title="Int" id="54588">cost</a></span></span>: <a title="Int" id="2296">Int</a>) <span class="keyword">extends</span> <a title="Ordered[sbt.Work[D]]" id="1360">Ordered</a>[Work[D]]
{
	<span class="keyword">def</span> <a title="(sbt.Work[D])Int" id="54140">compare</a>(<a title="sbt.Work[D]" id="54589">o</a>: <a href="#6567" title="sbt.Work[D]">Work</a>[D]) = <span id="6006"><a href="#54141" title="implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt" id="770">pathCost</a></span> <a title="(Int)Int" id="20654">compare</a> <a href="#54589" title="sbt.Work[D]">o</a>.<a href="#54141" title="=&gt; Int">pathCost</a>
	<span class="keyword">def</span> <a title="=&gt; Int" id="54141">pathCost</a>: <a title="Int" id="2296">Int</a>
	<span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="54142">toString</a> = <a href="#54133" title="=&gt; String">name</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#54141" title="=&gt; Int">pathCost</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
}

<span class="keyword">private</span>[sbt] <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class AbstractDagScheduler[D &lt;: sbt.Dag[D], W] extends java.lang.Object with sbt.Scheduler[W] with ScalaObject" id="6569">AbstractDagScheduler</a>[<a title="&gt;: Nothing &lt;: sbt.Dag[D]" id="6570">D</a> &lt;: Dag[D], <a title="&gt;: Nothing &lt;: Any" id="6571">W</a>](<span id="54082"><a title="D" id="54604">root</a></span>: <a href="#6570" title="D">D</a>, <span id="54083"><a title="(D) =&gt; String" id="54605">name</a></span>: D =&gt; String) <span class="keyword">extends</span> <a href="#6565" title="sbt.Scheduler[W]">Scheduler</a>[W]
{
	<span class="keyword">protected</span> <span class="keyword">val</span> <span id="54086"><a title="scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]" id="54085">remainingDeps</a></span>: <a title="scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]" id="7894">Map</a>[W, Set[W]] = <span title="scala.collection.mutable.HashMap[W,scala.collection.mutable.Set[W]]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[W,scala.collection.mutable.Set[W]]" id="8092">HashMap</a>
	<span class="keyword">protected</span> <span class="keyword">val</span> <span id="54088"><a title="scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]" id="54087">reverseDeps</a></span>: <a title="scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]" id="7894">Map</a>[W, Set[W]] = <span title="scala.collection.mutable.HashMap[W,scala.collection.mutable.Set[W]]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[W,scala.collection.mutable.Set[W]]" id="8092">HashMap</a>
	<span class="keyword">protected</span> <span class="keyword">val</span> <span id="54090"><a title="scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]" id="54089">errors</a></span> = <span title="scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]" class="keyword">new</span> <a title="scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]" id="7939">ListBuffer</a>[WorkFailure[W]]
	
	<a href="#54098" title="()Unit">setup</a>()
	
	<span class="keyword">def</span> <a title="=&gt; List[sbt.WorkFailure[W]]" id="54091">result</a> = <a href="#54089" title="=&gt; scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]">errors</a>.<a title="=&gt; List[sbt.WorkFailure[W]]" id="21696">readOnly</a>
	<span class="keyword">def</span> <a title="(W,Option[String])Unit" id="54092">complete</a>(<a title="W" id="54614">work</a>: <a href="#6571" title="W">W</a>, <a title="Option[String]" id="54615">result</a>: <a title="Option[String]" id="871">Option</a>[String])
	{
		<a href="#54615" title="Option[String]">result</a> <span title="Unit" class="keyword">match</span>
		{
			<span title="Unit" class="keyword">case</span> <a title="object None" id="488">None</a> =&gt; <a href="#54093" title="(W)Unit">workComplete</a>(<a href="#54614" title="W">work</a>)
			<span title="Unit" class="keyword">case</span> <a id="1">Some</a>(<a title="String" id="54617">errorMessage</a>) =&gt;
			{
				<span class="keyword">def</span> <a title="(W)Unit" id="54618">clear</a>(<a title="W" id="54619">w</a>: <a href="#6571" title="W">W</a>)
				{
					<a href="#54085" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">remainingDeps</a> <a title="(W)Unit" id="20462">-=</a> <a href="#54619" title="W">w</a>
					<span class="keyword">for</span>(<span id="10162"><a title="((scala.collection.mutable.Set[W]) =&gt; Unit)Unit" id="54622">deps</a></span> &lt;- <a href="#54087" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">reverseDeps</a>.<a title="(W)Option[scala.collection.mutable.Set[W]]" id="20467">removeKey</a>(<a href="#54619" title="W">w</a>); <span id="7256"><a title="((W) =&gt; Unit)Unit" id="54624">dep</a></span> &lt;- <a href="#54622" title="scala.collection.mutable.Set[W]">deps</a>)
						<a href="#54618" title="(W)Unit">clear</a>(<a href="#54624" title="W">dep</a>)
				}
				<a href="#54618" title="(W)Unit">clear</a>(<a href="#54614" title="W">work</a>)
				<a href="#54089" title="=&gt; scala.collection.mutable.ListBuffer[sbt.WorkFailure[W]]">errors</a> <a title="(sbt.WorkFailure[W])Unit" id="21692">+=</a> <a href="#53930" title="(W,String)sbt.WorkFailure[W]">WorkFailure</a>(<a href="#54614" title="W">work</a>, <a href="#54617" title="String">errorMessage</a>)
			}
		}
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(W)Unit" id="54093">workComplete</a>(<a title="W" id="54616">work</a>: <a href="#6571" title="W">W</a>)
	{
		<span class="keyword">for</span>(<span id="10162"><a title="((scala.collection.mutable.Set[W]) =&gt; Unit)Unit" id="54627">deps</a></span> &lt;- <a href="#54087" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">reverseDeps</a>.<a title="(W)Option[scala.collection.mutable.Set[W]]" id="20467">removeKey</a>(<a href="#54616" title="W">work</a>); <span id="7256"><a title="((W) =&gt; Unit)Unit" id="54629">dep</a></span> &lt;- <a href="#54627" title="scala.collection.mutable.Set[W]">deps</a>; <span id="10162"><a title="((scala.collection.mutable.Set[W]) =&gt; Unit)Unit" id="54631">depRemaining</a></span> &lt;- <a href="#54085" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">remainingDeps</a>.<a title="(W)Option[scala.collection.mutable.Set[W]]" id="20500">get</a>(<a href="#54629" title="W">dep</a>))
		{
			<a href="#54631" title="scala.collection.mutable.Set[W]">depRemaining</a> <a title="(W)Unit" id="21521">-=</a> <a href="#54616" title="W">work</a>
			<span title="Unit" class="keyword">if</span>(<a href="#54631" title="scala.collection.mutable.Set[W]">depRemaining</a>.<a title="=&gt; Boolean" id="21330">isEmpty</a>)
			{
				<a href="#54085" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">remainingDeps</a> <a title="(W)Unit" id="20462">-=</a> <a href="#54629" title="W">dep</a>
				<a href="#54094" title="(W)Unit">workReady</a>(<a href="#54629" title="W">dep</a>)
			}
		}
	}
	<span class="keyword">protected</span> <span class="keyword">def</span> <a title="(W)Unit" id="54094">workReady</a>(<a title="W" id="54634">work</a>: <a href="#6571" title="W">W</a>): <a title="Unit" id="2059">Unit</a>
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="54095">hasReady</a>: <a title="Boolean" id="2060">Boolean</a>
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="54096">hasPending</a> = <a href="#54095" title="=&gt; Boolean">hasReady</a> <a title="(Boolean)Boolean" id="2640">||</a> <a title="=&gt; Boolean" id="2637">!</a><a href="#54085" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">remainingDeps</a>.<a title="=&gt; Boolean" id="20503">isEmpty</a>
	<span class="keyword">protected</span> <span class="keyword">def</span> <a title="(String,D)W" id="54097">workConstructor</a>(<a title="String" id="54638">name</a>: <a title="String" id="1751">String</a>, <a title="D" id="54639">data</a>: <a href="#6570" title="D">D</a>): <a href="#6571" title="W">W</a>
	
	<span class="keyword">protected</span> <span class="keyword">def</span> <a title="()Unit" id="54098">setup</a>()
	{
		<a href="#54099" title="(D)Unit">setup</a>(<a href="#54082" title="D">root</a>)
		<span class="keyword">val</span> <a title="Iterable[W]" id="54640">startReady</a> = <span class="keyword">for</span>( <span id="7246"><a href="#54643" title="(((W, scala.collection.mutable.Set[W])) =&gt; W)Iterable[W]" id="7250">(</a></span><span id="54644"><span id="54648"><a title="W" id="54653">key</a></span></span>, <span id="54645"><span id="54649"><a title="scala.collection.mutable.Set[W]" id="54654">value</a></span></span>) &lt;- <a href="#54085" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">remainingDeps</a> <span class="keyword">if</span>(<a href="#54649" title="scala.collection.mutable.Set[W]">value</a>.<a title="=&gt; Boolean" id="21330">isEmpty</a>)) <span class="keyword">yield</span> <a href="#54653" title="W">key</a>
		<a href="#54085" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">remainingDeps</a> <a title="(Iterable[W])Unit" id="20464">--=</a> <a href="#54640" title="Iterable[W]">startReady</a>
		<a href="#54640" title="Iterable[W]">startReady</a>.<a title="((W) =&gt; Unit)Unit" id="7256">foreach</a>(<a href="#54094" title="(W)Unit">workReady</a>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(D)Unit" id="54099">setup</a>(<a title="D" id="54611">node</a>: <a href="#6570" title="D">D</a>)
	{
		<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[D,W]" id="54658">dToWork</a> = <span title="scala.collection.mutable.HashMap[D,W]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[D,W]" id="8092">HashMap</a>[D, W]()
		<span class="keyword">def</span> <a title="(D)W" id="54659">getWork</a>(<a title="D" id="54661">node</a>: <a href="#6570" title="D">D</a>) = <a href="#54658" title="scala.collection.mutable.HashMap[D,W]">dToWork</a>.<a title="(D,=&gt; W)W" id="20473">getOrElseUpdate</a>(<a href="#54661" title="D">node</a>, <a href="#54660" title="(D)W">createWork</a>(<a href="#54661" title="D">node</a>))
		<span class="keyword">def</span> <a title="(D)W" id="54660">createWork</a>(<a title="D" id="54662">node</a>: <a href="#6570" title="D">D</a>): <a href="#6571" title="W">W</a> =
		{
			<span class="keyword">val</span> <a title="Iterable[W]" id="54663">workDependencies</a> = <a href="#54662" title="D">node</a>.<a href="Dag.scala.html#26239" title="=&gt; Iterable[D]">dependencies</a>.<a title="((D) =&gt; W)Iterable[W]" id="7246">map</a>(<a href="#54659" title="(D)W">getWork</a>(<a href="#54667" title="D">_</a>))
			<span class="keyword">val</span> <a title="W" id="54664">w</a> = <a href="#54097" title="(String,D)W">workConstructor</a>(<a href="#54083" title="(D)String" id="7221">name</a>(<a href="#54662" title="D">node</a>), <a href="#54662" title="D">node</a>)
			<a href="#54085" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">remainingDeps</a>(<a href="#54664" title="W">w</a>) = <span id="21765"><a title="(W*)scala.collection.mutable.Set[W]" id="7910">HashSet</a></span>(<a href="#54663" title="Iterable[W]">workDependencies</a>.<a title="=&gt; Seq[W]" id="7280">toSeq</a>: _*)
			<span class="keyword">for</span>(<span id="7256"><a title="((W) =&gt; Unit)Unit" id="54670">dep</a></span> &lt;- <a href="#54663" title="Iterable[W]">workDependencies</a>)
				<a href="#54087" title="=&gt; scala.collection.mutable.Map[W,scala.collection.mutable.Set[W]]">reverseDeps</a>.<a title="(W,=&gt; scala.collection.mutable.Set[W])scala.collection.mutable.Set[W]" id="20473">getOrElseUpdate</a>(<a href="#54670" title="W">dep</a>, <span title="scala.collection.mutable.HashSet[W]" class="keyword">new</span> <a title="scala.collection.mutable.HashSet[W]" id="7909">HashSet</a>[W]) <a title="(W)Unit" id="21512">+=</a> <a href="#54664" title="W">w</a>
			<a href="#54664" title="W">w</a>
		}
		<a href="#54659" title="(D)W">getWork</a>(<a href="#54611" title="D">node</a>)
	}
}
<span class="keyword">private</span> <span class="keyword">class</span> <a title="class BasicDagScheduler[D &lt;: sbt.Dag[D]] extends sbt.AbstractDagScheduler[D,sbt.Work[D]] with ScalaObject" id="6572">BasicDagScheduler</a>[<a title="&gt;: Nothing &lt;: sbt.Dag[D]" id="6573">D</a> &lt;: Dag[D]](<span id="54151"><a title="D" id="54161">root</a></span>: <a href="#6573" title="D">D</a>, <span id="54152"><a title="(D) =&gt; String" id="54162">name</a></span>: D =&gt; String, <span id="54153"><a title="(D) =&gt; Int" id="54163">cost</a></span>: D =&gt; Int) <span class="keyword">extends</span>
{
	<span class="keyword">private</span> <span class="keyword">val</span> <span id="54150"><span id="54149"><a title="scala.collection.mutable.PriorityQueue[sbt.Work[D]]" id="54684">ready</a></span></span> = <span id="6002"><a href="#54690" title="scala.collection.mutable.PriorityQueue[sbt.Work[D]]" id="770" class="keyword">new</a></span> <a title="scala.collection.mutable.PriorityQueue[sbt.Work[D]]" id="8212">PriorityQueue</a>[Work[D]]

} <span class="keyword">with</span> <a href="#6569" title="sbt.AbstractDagScheduler[D,sbt.Work[D]]">AbstractDagScheduler</a>[D, Work[D]](<a href="#54161" title="D">root</a>, <a href="#54162" title="(D) =&gt; String">name</a>) {
	
	<span class="keyword">def</span> <a title="(Int)List[sbt.Work[D]]" id="54155">next</a>(<a title="Int" id="54691">max</a>: <a title="Int" id="2296">Int</a>): <a title="List[sbt.Work[D]]" id="481">List</a>[Work[D]] =
	{
		<span id="5880"><a title="(Boolean)Unit" id="770">require</a></span>(<a href="#54691" title="Int">max</a> <a title="(Int)Boolean" id="3035">&gt;</a> <span title="Int(0)" class="int">0</span>)
		<span class="keyword">def</span> <a title="(Int)List[sbt.Work[D]]" id="54692">nextImpl</a>(<a title="Int" id="54695">remaining</a>: <a title="Int" id="2296">Int</a>): <a title="List[sbt.Work[D]]" id="481">List</a>[Work[D]] =
			<span title="List[sbt.Work[D]]" class="keyword">if</span>(<a href="#54695" title="Int">remaining</a> <a title="(Int)Boolean" id="3034">&lt;=</a> <span title="Int(0)" class="int">0</span> <a title="(Boolean)Boolean" id="2640">||</a> <a href="#54149" title="=&gt; scala.collection.mutable.PriorityQueue[sbt.Work[D]]">ready</a>.<a title="=&gt; Boolean" id="54110">isEmpty</a>)
				<a title="object Nil" id="299">Nil</a>
			<span class="keyword">else</span>
				<a href="#54149" title="=&gt; scala.collection.mutable.PriorityQueue[sbt.Work[D]]">ready</a>.<a title="()sbt.Work[D]" id="54120">dequeue</a> <a href="#54697" title="(sbt.Work[D])List[sbt.Work[D]]" id="6808">::</a> <a href="#54692" title="(Int)List[sbt.Work[D]]">nextImpl</a>(<a href="#54695" title="Int">remaining</a> <a title="(Int)Int" id="3038">-</a> <span title="Int(1)" class="int">1</span>)
		<a href="#54692" title="(Int)List[sbt.Work[D]]">nextImpl</a>(<a href="#54691" title="Int">max</a>)
	}
	
	<span class="keyword">protected</span> <span class="keyword">def</span> <a title="(sbt.Work[D])Unit" id="54156">workReady</a>(<a title="sbt.Work[D]" id="54714">dep</a>: <a href="#6567" title="sbt.Work[D]">Work</a>[D]) { <a href="#54149" title="=&gt; scala.collection.mutable.PriorityQueue[sbt.Work[D]]">ready</a> <a title="(sbt.Work[D])Unit" id="54111">+=</a> <a href="#54714" title="sbt.Work[D]">dep</a> }
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="54157">hasReady</a> = <a title="=&gt; Boolean" id="2637">!</a><a href="#54149" title="=&gt; scala.collection.mutable.PriorityQueue[sbt.Work[D]]">ready</a>.<a title="=&gt; Boolean" id="54110">isEmpty</a>
	<span class="keyword">protected</span> <span class="keyword">def</span> <a title="(String,D)sbt.Work[D]" id="54158">workConstructor</a>(<a title="String" id="54718">name</a>: <a title="String" id="1751">String</a>, <a title="D" id="54719">data</a>: <a href="#6573" title="D">D</a>) =
		<a title="template $anon extends sbt.Work[D]" id="54721" class="keyword">new</a> <a href="#6567" title="sbt.Work[D]">Work</a>(<a href="#54718" title="String">name</a>, <a href="#54719" title="D">data</a>, <a href="#54153" title="(D)Int" id="7221">cost</a>(<a href="#54719" title="D">data</a>)) {
			<span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Int" id="54725">pathCost</a> = <a href="#54087" title="=&gt; scala.collection.mutable.Map[sbt.Work[D],scala.collection.mutable.Set[sbt.Work[D]]]">reverseDeps</a>.<a title="(sbt.Work[D],=&gt; Collection[sbt.Work[D]] with (sbt.Work[D] with Int) =&gt; Boolean)Collection[sbt.Work[D]] with (sbt.Work[D] with Int) =&gt; Boolean" id="20501">getOrElse</a>(<a href="#54721" title="sbt.Work[D]{ ... }" class="keyword">this</a>, <a title="object Nil" id="299">Nil</a>).<a title="(Int)((Int, sbt.Work[D]) =&gt; Int)Int" id="7263">foldLeft</a>(<span title="Int(0)" class="int">0</span>)(<span id="6006"><a href="#54877" title="implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt" id="770">_</a></span> <a title="(Int)Int" id="20659">max</a> <a href="#54878" title="sbt.Work[D]">_</a>.<a href="#54141" title="=&gt; Int">pathCost</a>) <a title="(Int)Int" id="3037">+</a> <a href="#54721" title="this.type" class="keyword">this</a>.<a href="#54137" title="=&gt; Int">cost</a>
		}
	<span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="54159">setup</a>()
	{
		<span class="keyword">super</span>.<a href="#54098" title="()Unit">setup</a>()
		<a href="#54085" title="=&gt; scala.collection.mutable.Map[sbt.Work[D],scala.collection.mutable.Set[sbt.Work[D]]]">remainingDeps</a>.<a title="=&gt; Iterator[sbt.Work[D]]" id="20507">keys</a>.<a title="((sbt.Work[D]) =&gt; Unit)Unit" id="20249">foreach</a>(<a title="sbt.Work[D]" id="54892">dep</a> =&gt; <a href="#54892" title="sbt.Work[D]">dep</a>.<a href="#54141" title="=&gt; Int">pathCost</a>)
	}
}
        </pre>
    </body>
</html>