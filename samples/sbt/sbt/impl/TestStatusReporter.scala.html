<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/impl/TestStatusReporter.scala</title>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt.impl

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> scala.collection.mutable.{HashMap, Map}

<span class="comment">/** Only intended to be used once per instance. */</span>
<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <span class="typed"><span class="type">class TestStatusReporter extends java.lang.Object with sbt.TestsListener with ScalaObject</span><a id="6251">TestStatusReporter</a></span>(<span class="typed"><span class="type">sbt.Path</span><span id="26074"><a id="26090">path</a></span></span>: <span class="typed"><span class="type">sbt.Path</span><a href="../Path.scala.html#6796">Path</a></span>, <span class="typed"><span class="type">sbt.Logger</span><span id="26075"><a id="26091">log</a></span></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="../Logger.scala.html#6766">Logger</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">sbt.TestsListener</span><a href="../TestFramework.scala.html#6366">TestsListener</a></span>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[String,Long]</span><a id="26078">succeeded</a></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[String,Long]</span><a id="8003">Map</a></span>[String, Long] = <span class="typed"><span class="type">object sbt.impl.TestStatus</span><a href="#6253">TestStatus</a></span>.<span class="typed"><span class="type">(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]</span><a href="#26094">read</a></span>(<span class="typed"><span class="type">sbt.Path</span><a href="#26074">path</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#26075">log</a></span>)

	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Unit</span><a id="26079">doInit</a></span> <span class="typed"><span class="type">Unit</span><span >{</span></span>}
	<span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="26080">startGroup</a></span>(<span class="typed"><span class="type">String</span><a id="26101">name</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>) { <span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[String,Long]</span><a href="#26077">succeeded</a></span> <span class="typed"><span class="type">(String)Option[Long]</span><a id="21405">removeKey</a></span> <span class="typed"><span class="type">String</span><a href="#26101">name</a></span> }
	<span class="keyword">def</span> <span class="typed"><span class="type">(sbt.TestEvent)Unit</span><a id="26081">testEvent</a></span>(<span class="typed"><span class="type">sbt.TestEvent</span><a id="26102">event</a></span>: <span class="typed"><span class="type">sbt.TestEvent</span><a href="../TestFramework.scala.html#6369">TestEvent</a></span>) <span class="typed"><span class="type">Unit</span><span >{</span></span>}
	<span class="keyword">def</span> <span class="typed"><span class="type">(String,Throwable)Unit</span><a id="26082">endGroup</a></span>(<span class="typed"><span class="type">String</span><a id="26391">name</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>, <span class="typed"><span class="type">Throwable</span><a id="26392">t</a></span>: <span class="typed"><span class="type">Throwable</span><a id="2124">Throwable</a></span>) <span class="typed"><span class="type">Unit</span><span >{</span></span>}
	<span class="keyword">def</span> <span class="typed"><span class="type">(String,sbt.Result.Value)Unit</span><a id="26083">endGroup</a></span>(<span class="typed"><span class="type">String</span><a id="26393">name</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>, <span class="typed"><span class="type">sbt.Result.Value</span><a id="26394">result</a></span>: Result.<span class="typed"><span class="type">sbt.Result.Value</span><a id="21282">Value</a></span>)
	{
		<span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">sbt.Result.Value</span><a href="#26394">result</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3490">==</a></span> <span class="typed"><span class="type">object sbt.Result</span><a href="../TestFramework.scala.html#6359">Result</a></span>.<span class="typed"><span class="type">=&gt; sbt.Result.Value</span><a href="../TestFramework.scala.html#26398">Passed</a></span>)
			<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[String,Long]</span><a href="#26077">succeeded</a></span>(<span class="typed"><span class="type">String</span><a href="#26393">name</a></span>) = <span class="typed"><span class="type">object java.lang.System</span><a id="1867">System</a></span>.<span class="typed"><span class="type">()Long</span><a id="26413">currentTimeMillis</a></span>
	}
	<span class="keyword">def</span> <span class="typed"><span class="type">(sbt.Result.Value)Unit</span><a id="26084">doComplete</a></span>(<span class="typed"><span class="type">sbt.Result.Value</span><a id="26437">finalResult</a></span>: Result.<span class="typed"><span class="type">sbt.Result.Value</span><a id="21282">Value</a></span>) { <span class="typed"><span class="type">()Unit</span><a href="#26086">complete</a></span>() }
	<span class="keyword">def</span> <span class="typed"><span class="type">(Throwable)Unit</span><a id="26085">doComplete</a></span>(<span class="typed"><span class="type">Throwable</span><a id="26438">t</a></span>: <span class="typed"><span class="type">Throwable</span><a id="2124">Throwable</a></span>) { <span class="typed"><span class="type">()Unit</span><a href="#26086">complete</a></span>() }
	
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="26086">complete</a></span>()
	{
		<span class="typed"><span class="type">object sbt.impl.TestStatus</span><a href="#6253">TestStatus</a></span>.<span class="typed"><span class="type">(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit</span><a href="#26095">write</a></span>(<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[String,Long]</span><a href="#26077">succeeded</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;Successful Tests&quot;)</span><span class="string">&quot;Successful Tests&quot;</span></span>, <span class="typed"><span class="type">sbt.Path</span><a href="#26074">path</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#26075">log</a></span>)
	}
}

<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <span class="typed"><span class="type">class TestQuickFilter extends java.lang.Object with (String) =&gt; Boolean with NotNull with ScalaObject</span><a id="6252">TestQuickFilter</a></span>(<span class="typed"><span class="type">sbt.CompileAnalysis</span><span id="26447"><a id="26462">testAnalysis</a></span></span>: <span class="typed"><span class="type">sbt.CompileAnalysis</span><a href="../Analysis.scala.html#6230">CompileAnalysis</a></span>, <span class="typed"><span class="type">Boolean</span><span id="26448"><a id="26463">failedOnly</a></span></span>: <span class="typed"><span class="type">Boolean</span><a id="2151">Boolean</a></span>, <span class="typed"><span class="type">sbt.Path</span><span id="26449"><a id="26464">path</a></span></span>: <span class="typed"><span class="type">sbt.Path</span><a href="../Path.scala.html#6796">Path</a></span>, <span class="typed"><span class="type">sbt.Logger</span><span id="26450"><a id="26465">log</a></span></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="../Logger.scala.html#6766">Logger</a></span>) <span class="keyword">extends</span> (String =&gt; Boolean) <span class="keyword">with</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[String,Long]</span><a id="26453">exclude</a></span> = <span class="typed"><span class="type">object sbt.impl.TestStatus</span><a href="#6253">TestStatus</a></span>.<span class="typed"><span class="type">(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]</span><a href="#26094">read</a></span>(<span class="typed"><span class="type">sbt.Path</span><a href="#26449">path</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#26450">log</a></span>)
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.Map[String,sbt.Path]</span><a id="26455">map</a></span> = <span class="typed"><span class="type">sbt.CompileAnalysis</span><a href="#26447">testAnalysis</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[String,sbt.Path]</span><a href="../Analysis.scala.html#22460">testSourceMap</a></span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(String)Boolean</span><a id="26456">apply</a></span>(<span class="typed"><span class="type">String</span><a id="26466">test</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>) =
		<span class="typed"><span class="type">=&gt; scala.collection.mutable.Map[String,Long]</span><a href="#26452">exclude</a></span>.<span class="typed"><span class="type">(String)Option[Long]</span><a id="21438">get</a></span>(<span class="typed"><span class="type">String</span><a href="#26466">test</a></span>) <span class="typed"><span class="type">Boolean</span><span class="keyword">match</span></span>
		{
			<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="517">None</a></span> =&gt; <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span> <span class="comment">// include because this test has not been run or did not succeed</span>
			<span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">Long</span><a id="26468">lastSuccessTime</a></span>) =&gt; <span class="comment">// succeeded the last time it was run</span>
				<span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">Boolean</span><a href="#26448">failedOnly</a></span>)
					<span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span> <span class="comment">// don't include because the last time succeeded</span>
				<span class="keyword">else</span>
					<span class="typed"><span class="type">sbt.CompileAnalysis</span><a href="#26447">testAnalysis</a></span>.<span class="typed"><span class="type">(sbt.Path)Option[scala.collection.mutable.Set[sbt.Path]]</span><a href="../Analysis.scala.html#22427">products</a></span>(<span class="typed"><span class="type">(String)sbt.Path</span><a href="#26454" id="21442">map</a></span>(<span class="typed"><span class="type">String</span><a href="#26466">test</a></span>)) <span class="typed"><span class="type">Boolean</span><span class="keyword">match</span></span>
					{
						<span class="typed"><span class="type">Boolean(true)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="517">None</a></span> =&gt; <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
						<span class="typed"><span class="type">Boolean</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">scala.collection.mutable.Set[sbt.Path]</span><a id="26473">products</a></span>) =&gt; <span class="typed"><span class="type">scala.collection.mutable.Set[sbt.Path]</span><a href="#26473">products</a></span>.<span class="typed"><span class="type">((sbt.Path) =&gt; Boolean)Boolean</span><a id="7367">exists</a></span>(<span class="typed"><span class="type">Long</span><a href="#26468">lastSuccessTime</a></span> <span class="typed"><span class="type">(Long)Boolean</span><a id="3248">&lt;=</a></span> <span class="typed"><span class="type">sbt.Path</span><a href="#26475">_</a></span>.<span class="typed"><span class="type">=&gt; Long</span><a href="../Path.scala.html#9635">lastModified</a></span>) <span class="comment">// include if the test is newer than the last run</span>
					}
		}
}
<span class="keyword">private</span> <span class="keyword">object</span> <span class="typed"><span class="type">object sbt.impl.TestStatus</span><a id="6253">TestStatus</a></span>
{
	<span class="keyword">import</span> java.util.Properties
	<span class="keyword">def</span> <span class="typed"><span class="type">(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]</span><a id="26094">read</a></span>(<span class="typed"><span class="type">sbt.Path</span><a id="26097">path</a></span>: <span class="typed"><span class="type">sbt.Path</span><a href="../Path.scala.html#6796">Path</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a id="26098">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="../Logger.scala.html#6766">Logger</a></span>): <span class="typed"><span class="type">scala.collection.mutable.Map[String,Long]</span><a id="8003">Map</a></span>[String, Long] =
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[String,Long]</span><a id="26480">map</a></span> = <span class="typed"><span class="type">scala.collection.mutable.HashMap[String,Long]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[String,Long]</span><a id="8204">HashMap</a></span>[String, Long]
		<span class="keyword">val</span> <span class="typed"><span class="type">java.util.Properties</span><a id="26481">properties</a></span> = <span class="typed"><span class="type">java.util.Properties</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.Properties</span><a id="5577">Properties</a></span>
		<span class="typed"><span class="type">(Option[String],String,sbt.Logger)Unit</span><a href="#26096">logError</a></span>(<span class="typed"><span class="type">object sbt.PropertiesUtilities</span><a href="../Analysis.scala.html#6233">PropertiesUtilities</a></span>.<span class="typed"><span class="type">(java.util.Properties,sbt.Path,sbt.Logger)Option[String]</span><a href="../Analysis.scala.html#22937">load</a></span>(<span class="typed"><span class="type">java.util.Properties</span><a href="#26481">properties</a></span>, <span class="typed"><span class="type">sbt.Path</span><a href="#26097">path</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#26098">log</a></span>), <span class="typed"><span class="type">java.lang.String(&quot;loading&quot;)</span><span class="string">&quot;loading&quot;</span></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#26098">log</a></span>)
		<span class="keyword">for</span>(<span class="typed"><span class="type">((String) =&gt; Unit)Unit</span><span id="7365"><a id="26492">test</a></span></span> &lt;- <span class="typed"><span class="type">object sbt.PropertiesUtilities</span><a href="../Analysis.scala.html#6233">PropertiesUtilities</a></span>.<span class="typed"><span class="type">(java.util.Properties)Iterable[String]</span><a href="../Analysis.scala.html#22938">propertyNames</a></span>(<span class="typed"><span class="type">java.util.Properties</span><a href="#26481">properties</a></span>))
			<span class="typed"><span class="type">scala.collection.mutable.HashMap[String,Long]</span><a href="#26480">map</a></span>.<span class="typed"><span class="type">(String,Long)Option[Long]</span><a id="21406">put</a></span>(<span class="typed"><span class="type">String</span><a href="#26492">test</a></span>, <span class="typed"><span class="type">java.util.Properties</span><a href="#26481">properties</a></span>.<span class="typed"><span class="type">implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString</span><span id="6104"><span id="802"><a id="22810">getProperty</a></span></span></span>(<span class="typed"><span class="type">String</span><a href="#26492">test</a></span>).<span class="typed"><span class="type">=&gt; Long</span><a id="8889">toLong</a></span>)
		<span class="typed"><span class="type">scala.collection.mutable.HashMap[String,Long]</span><a href="#26480">map</a></span>
	}
	<span class="keyword">def</span> <span class="typed"><span class="type">(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit</span><a id="26095">write</a></span>(<span class="typed"><span class="type">scala.collection.mutable.Map[String,Long]</span><a id="26439">map</a></span>: <span class="typed"><span class="type">scala.collection.mutable.Map[String,Long]</span><a id="8003">Map</a></span>[String, Long], <span class="typed"><span class="type">String</span><a id="26440">label</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>, <span class="typed"><span class="type">sbt.Path</span><a id="26441">path</a></span>: <span class="typed"><span class="type">sbt.Path</span><a href="../Path.scala.html#6796">Path</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a id="26442">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="../Logger.scala.html#6766">Logger</a></span>)
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">java.util.Properties</span><a id="26498">properties</a></span> = <span class="typed"><span class="type">java.util.Properties</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.Properties</span><a id="5577">Properties</a></span>
		<span class="keyword">for</span>( <span class="typed"><span class="type">(((String, Long)) =&gt; Unit)Unit</span><span id="7365"><a href="#26505" id="7359">(</a></span></span><span class="typed"><span class="type">String</span><span id="26506"><a id="26510">test</a></span></span>, <span class="typed"><span class="type">Long</span><span id="26507"><a id="26511">lastSuccessTime</a></span></span>) &lt;- <span class="typed"><span class="type">scala.collection.mutable.Map[String,Long]</span><a href="#26439">map</a></span>)
			<span class="typed"><span class="type">java.util.Properties</span><a href="#26498">properties</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.lang.Object</span><a id="22803">setProperty</a></span>(<span class="typed"><span class="type">String</span><a href="#26510">test</a></span>, <span class="typed"><span class="type">Long</span><a href="#26511">lastSuccessTime</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="3481">toString</a></span>)
		<span class="typed"><span class="type">(Option[String],String,sbt.Logger)Unit</span><a href="#26096">logError</a></span>(<span class="typed"><span class="type">object sbt.PropertiesUtilities</span><a href="../Analysis.scala.html#6233">PropertiesUtilities</a></span>.<span class="typed"><span class="type">(java.util.Properties,String,sbt.Path,sbt.Logger)Option[String]</span><a href="../Analysis.scala.html#22936">write</a></span>(<span class="typed"><span class="type">java.util.Properties</span><a href="#26498">properties</a></span>, <span class="typed"><span class="type">String</span><a href="#26440">label</a></span>, <span class="typed"><span class="type">sbt.Path</span><a href="#26441">path</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#26442">log</a></span>), <span class="typed"><span class="type">java.lang.String(&quot;writing&quot;)</span><span class="string">&quot;writing&quot;</span></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#26442">log</a></span>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Option[String],String,sbt.Logger)Unit</span><a id="26096">logError</a></span>(<span class="typed"><span class="type">Option[String]</span><a id="26488">result</a></span>: <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String], <span class="typed"><span class="type">String</span><a id="26489">action</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a id="26490">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="../Logger.scala.html#6766">Logger</a></span>)
	{
		<span class="typed"><span class="type">Option[String]</span><a href="#26488">result</a></span>.<span class="typed"><span class="type">((String) =&gt; Unit)Unit</span><a id="10271">foreach</a></span>(<span class="typed"><span class="type">String</span><a id="26513">msg</a></span> =&gt; <span class="typed"><span class="type">sbt.Logger</span><a href="#26490">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="../Logger.scala.html#8469">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Error &quot;)</span><span class="string">&quot;Error &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">String</span><a href="#26489">action</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; test status: &quot;)</span><span class="string">&quot; test status: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">String</span><a href="#26513">msg</a></span>))
	}
}
        </pre>
    </body>
</html>