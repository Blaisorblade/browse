<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/impl/RunTask.scala</title>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mark Harrah
 */</span>
 <span class="keyword">package</span> sbt.impl

<span class="keyword">import</span> scala.collection.{immutable, jcl, mutable}
<span class="keyword">import</span> scala.collection.Map
<span class="keyword">import</span> jcl.IdentityHashMap

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.impl.RunTask" id="6546">RunTask</a>
{
	<span class="keyword">final</span> <span class="keyword">type</span> <a title="sbt.Project#Task" id="46456">Task</a> = Project#<a href="../TaskManager.scala.html#26166" title="sbt.Project#Task">Task</a>
	<span class="keyword">val</span> <span id="46458"><a title="java.lang.String" id="46457">UnnamedName</a></span> = <span title="java.lang.String(&quot;&lt;anonymous&gt;&quot;)" class="string">&quot;&lt;anonymous&gt;&quot;</span>
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="46459">apply</a>(<a title="sbt.impl.RunTask.Task" id="46848">root</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="46849">rootName</a>: <a title="String" id="1751">String</a>): <a title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="481">List</a>[WorkFailure[Task]]  = <a href="#46460" title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#46848" title="sbt.impl.RunTask.Task">root</a>, <a href="#46849" title="String">rootName</a>, <span title="Boolean(true)" class="keyword">true</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="46460">apply</a>(<a title="sbt.impl.RunTask.Task" id="46845">root</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="46846">rootName</a>: <a title="String" id="1751">String</a>, <a title="Boolean" id="46847">parallelExecution</a>: <a title="Boolean" id="2060">Boolean</a>): <a title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="481">List</a>[WorkFailure[Task]] =
		<a href="#46461" title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#46845" title="sbt.impl.RunTask.Task">root</a>, <a href="#46846" title="String">rootName</a>, <span title="Int" class="keyword">if</span>(<a href="#46847" title="Boolean">parallelExecution</a>) <a title="object java.lang.Runtime" id="1641">Runtime</a>.<a title="()java.lang.Runtime" id="51320">getRuntime</a>.<a title="()Int" id="51332">availableProcessors</a> <span class="keyword">else</span> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="46461">apply</a>(<a title="sbt.impl.RunTask.Task" id="46464">root</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="46465">rootName</a>: <a title="String" id="1751">String</a>, <a title="Int" id="46466">maximumTasks</a>: <a title="Int" id="2296">Int</a>): <a title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="481">List</a>[WorkFailure[Task]]  = (<span title="sbt.impl.RunTask" class="keyword">new</span> <a href="#6549" title="sbt.impl.RunTask">RunTask</a>(<a href="#46464" title="sbt.impl.RunTask.Task">root</a>, <a href="#46465" title="String">rootName</a>, <a href="#46466" title="Int">maximumTasks</a>)).<a href="#53660" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>()
}
<span class="keyword">import</span> RunTask._
<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class RunTask extends java.lang.Object with NotNull with ScalaObject" id="6549">RunTask</a>(<span id="53654"><a title="sbt.impl.RunTask.Task" id="53698">root</a></span>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>, <span id="53655"><a title="String" id="53699">rootName</a></span>: <a title="String" id="1751">String</a>, <span id="53656"><a title="Int" id="53700">maximumTasks</a></span>: <a title="Int" id="2296">Int</a>) <span class="keyword">extends</span> <a title="NotNull" id="187">NotNull</a>
{
	<span id="5880"><a title="(Boolean)Unit" id="770">require</a></span>(<a href="#53656" title="Int">maximumTasks</a> <a title="(Int)Boolean" id="3036">&gt;=</a> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="53658">parallel</a> = <a href="#53656" title="Int">maximumTasks</a> <a title="(Int)Boolean" id="3035">&gt;</a> <span title="Int(1)" class="int">1</span>
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="53659">multiProject</a> = <a href="#53689" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<a title="=&gt; Int" id="21327">size</a> <a title="(Int)Boolean" id="3036">&gt;=</a> <span title="Int(2)" class="int">2</span>
	<span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="53660">run</a>(): <a title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="481">List</a>[WorkFailure[Task]]  =
	{
		<span class="keyword">try</span>
		{
			<a href="#53661" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">runTasksExceptRoot</a>() <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">match</span>
			{
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <a title="object Nil" id="299">Nil</a> =&gt;
					<span class="keyword">val</span> <a title="Option[String]" id="53923">result</a> = <a href="#53665" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#53654" title="sbt.impl.RunTask.Task">root</a>, <a href="#53655" title="String">rootName</a>)
					<a href="#53923" title="Option[String]">result</a>.<a title="((String) =&gt; sbt.WorkFailure[sbt.impl.RunTask.Task])Option[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="10157">map</a>( <a title="String" id="53928">errorMessage</a> =&gt; <a href="../ParallelRunner.scala.html#53930" title="(sbt.impl.RunTask.Task,String)sbt.WorkFailure[sbt.impl.RunTask.Task]">WorkFailure</a>(<a href="#53654" title="sbt.impl.RunTask.Task">root</a>, <span title="java.lang.String(&quot;Error running &quot;)" class="string">&quot;Error running &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#53655" title="String">rootName</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#53928" title="String">errorMessage</a>) ).<a title="=&gt; List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="10166">toList</a>
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <a title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="53939">failures</a> =&gt; <a href="#53939" title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">failures</a>
			}
		}
		<span class="keyword">finally</span>
		{
			<span class="keyword">for</span>(<span id="7256"><a title="((sbt.Project#ManagerType) =&gt; Unit)Unit" id="53941">project</a></span> &lt;- <a href="#53689" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>; <span id="10162"><a title="((String) =&gt; Unit)Unit" id="53943">saveError</a></span> &lt;- <a href="#53941" title="sbt.Project#ManagerType">project</a>.<a href="../Environment.scala.html#26306" title="()Option[String]">saveEnvironment</a>)
				<a href="#53941" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#26169" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#8353" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Could not save properties for project &quot;)" class="string">&quot;Could not save properties for project &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#53941" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#26174" title="=&gt; String">name</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#53943" title="String">saveError</a>)
		}
	}
	<span class="comment">// This runs all tasks except the root.task.</span>
	<span class="comment">// It uses a buffered logger in record mode to ensure that all output for a given task is consecutive</span>
	<span class="comment">// it ignores the root task so that the root task may be run with buffering disabled so that the output</span>
	<span class="comment">// occurs without delay.</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="53661">runTasksExceptRoot</a>() =
	{
		<a href="#53662" title="((sbt.BufferedLogger) =&gt; Unit)Unit">withBuffered</a>(<a href="#53887" title="sbt.BufferedLogger">_</a>.<a href="../Logger.scala.html#46105" title="()Unit">startRecording</a>())
		<span class="keyword">try</span> { <a href="../ParallelRunner.scala.html#6555" title="object sbt.ParallelRunner">ParallelRunner</a>.<a href="../ParallelRunner.scala.html#53889" title="(sbt.impl.RunTask.Task,(sbt.impl.RunTask.Task) =&gt; String,(sbt.impl.RunTask.Task) =&gt; Option[String],Int,(sbt.impl.RunTask.Task) =&gt; sbt.Logger)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>(<a href="#53685" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>, <a href="#53677" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>, <a href="#53663" title="(sbt.impl.RunTask.Task)Option[String]">runIfNotRoot</a>, <a href="#53656" title="Int">maximumTasks</a>, (<a title="sbt.impl.RunTask.Task" id="53914">t</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>) =&gt; <a href="#53914" title="sbt.impl.RunTask.Task">t</a>.<a href="../TaskManager.scala.html#28026" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#26169" title="=&gt; sbt.Logger">log</a>) }
		<span class="keyword">finally</span> { <a href="#53662" title="((sbt.BufferedLogger) =&gt; Unit)Unit">withBuffered</a>(<a href="#53922" title="sbt.BufferedLogger">_</a>.<a href="../Logger.scala.html#46109" title="()Unit">stop</a>()) }
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="53662">withBuffered</a>(<a title="(sbt.BufferedLogger) =&gt; Unit" id="53885">f</a>: BufferedLogger =&gt; Unit)
	{
		<span class="keyword">for</span>(<span id="6839"><a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="53945">buffered</a></span> &lt;- <a href="#53691" title="=&gt; List[sbt.BufferedLogger]">bufferedLoggers</a>)
			<a href="../Control.scala.html#6605" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#10191" title="(=&gt; Unit)Unit">trap</a>(<a href="#53885" title="(sbt.BufferedLogger)Unit" id="7221">f</a>(<a href="#53945" title="sbt.BufferedLogger">buffered</a>))
	}
	<span class="comment">/** Will be called in its own actor. Runs the given task if it is not the root task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="53663">runIfNotRoot</a>(<a title="sbt.impl.RunTask.Task" id="53910">action</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>): <a title="Option[String]" id="871">Option</a>[String] =
	{
		<span title="Option[String]" class="keyword">if</span>(<a href="#53664" title="(sbt.impl.RunTask.Task)Boolean">isRoot</a>(<a href="#53910" title="sbt.impl.RunTask.Task">action</a>))
			<a title="object None" id="488">None</a>
		<span class="keyword">else</span>
			<a href="#53665" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#53910" title="sbt.impl.RunTask.Task">action</a>, <a href="#53677" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>(<a href="#53910" title="sbt.impl.RunTask.Task">action</a>))
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Boolean" id="53664">isRoot</a>(<a title="sbt.impl.RunTask.Task" id="53948">t</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>) = <a href="#53948" title="sbt.impl.RunTask.Task">t</a> <a title="(AnyRef)Boolean" id="3399">==</a> <a href="#53685" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>
	<span class="comment">/** Will be called in its own actor except for the root task. */</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)Option[String]" id="53665">runTask</a>(<a title="sbt.impl.RunTask.Task" id="53924">action</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="53925">actionName</a>: <a title="String" id="1751">String</a>): <a title="Option[String]" id="871">Option</a>[String] =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="53951">label</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#53659" title="=&gt; Boolean">multiProject</a>) (<a href="#53924" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#28026" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#26174" title="=&gt; String">name</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#53925" title="String">actionName</a>) <span class="keyword">else</span> <a href="#53925" title="String">actionName</a>
		<span class="keyword">def</span> <a title="(sbt.ControlEvent.Value,String,String)Unit" id="53952">banner</a>(<a title="sbt.ControlEvent.Value" id="53955">event</a>: ControlEvent.<a title="sbt.ControlEvent.Value" id="20345">Value</a>, <a title="String" id="53956">firstSeparator</a>: <a title="String" id="1751">String</a>, <a title="String" id="53957">secondSeparator</a>: <a title="String" id="1751">String</a>) =
			<a href="../Control.scala.html#6605" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#10191" title="(=&gt; Unit)Unit">trap</a>(<a href="#53924" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#28026" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#26169" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#8357" title="(sbt.ControlEvent.Value,=&gt; String)Unit">control</a>(<a href="#53955" title="sbt.ControlEvent.Value">event</a>, <a href="#53956" title="String">firstSeparator</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#53951" title="java.lang.String">label</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#53957" title="String">secondSeparator</a>))
		<span title="Unit" class="keyword">if</span>(<a href="#53658" title="=&gt; Boolean">parallel</a>)
		{
			<span class="keyword">try</span> { <a href="#53952" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#6665" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#53966" title="=&gt; sbt.ControlEvent.Value">Start</a>, <span title="java.lang.String(&quot;\012  &quot;)" class="string">&quot;\n  &quot;</span>, <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>) }
			<span class="keyword">finally</span> { <a href="#53667" title="(sbt.impl.RunTask.Task)Unit">flush</a>(<a href="#53924" title="sbt.impl.RunTask.Task">action</a>) }
		}
		<a href="#53952" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#6665" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#53968" title="=&gt; sbt.ControlEvent.Value">Header</a>, <span title="java.lang.String(&quot;\012==&quot;)" class="string">&quot;\n==&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
		<span class="keyword">try</span> { <a href="#53924" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#28030" title="=&gt; Option[String]">invoke</a> }
		<span class="keyword">catch</span> { <span title="Some[java.lang.String]" class="keyword">case</span> <a title="Exception" id="53977">e</a>: <a title="Exception" id="2021">Exception</a> =&gt; <a href="#53924" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#28026" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#26169" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#8350" title="(=&gt; Throwable)Unit">trace</a>(<a href="#53977" title="Exception">e</a>); <span id="10256"><a title="(java.lang.String)Some[java.lang.String]" id="275">Some</a></span>(<a href="#53977" title="Exception">e</a>.<a title="()java.lang.String" id="9277">toString</a>) }
		<span class="keyword">finally</span>
		{
			<a href="#53952" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#6665" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#53970" title="=&gt; sbt.ControlEvent.Value">Finish</a>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
			<span title="Unit" class="keyword">if</span>(<a href="#53658" title="=&gt; Boolean">parallel</a>)
				<a href="#53667" title="(sbt.impl.RunTask.Task)Unit">flush</a>(<a href="#53924" title="sbt.impl.RunTask.Task">action</a>)
		}
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(=&gt; Unit)(=&gt; Unit)Unit" id="53666">trapFinally</a>(<a title="=&gt; Unit" id="53984">toTrap</a>: =&gt; Unit)(<a title="=&gt; Unit" id="53985">runFinally</a>: =&gt; Unit)
	{
		<span class="keyword">try</span> { <a href="#53984" title="=&gt; Unit">toTrap</a> }
		<span class="keyword">catch</span> { <span title="Unit" class="keyword">case</span> <a title="Exception" id="53986">e</a>: <a title="Exception" id="2021">Exception</a> =&gt; <span title="Unit">(</span>) }
		<span class="keyword">finally</span> { <span class="keyword">try</span> { <a href="#53985" title="=&gt; Unit">runFinally</a> } <span class="keyword">catch</span> { <span title="Unit" class="keyword">case</span> <a title="Exception" id="53987">e</a>: <a title="Exception" id="2021">Exception</a> =&gt; <span title="Unit">(</span>) } }
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Unit" id="53667">flush</a>(<a title="sbt.impl.RunTask.Task" id="53975">action</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>)
	{
		<span class="keyword">for</span>(<span id="10162"><a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="53991">buffered</a></span> &lt;- <a href="#53697" title="(sbt.Project)Option[sbt.BufferedLogger]">bufferedLogger</a>(<a href="#53975" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#28026" title="=&gt; sbt.Project#ManagerType">manager</a>))
			<a href="../Control.scala.html#6605" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#10191" title="(=&gt; Unit)Unit">trap</a>(<a href="#53668" title="(sbt.BufferedLogger)Unit">flush</a>(<a href="#53991" title="sbt.BufferedLogger">buffered</a>))
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.BufferedLogger)Unit" id="53668">flush</a>(<a title="sbt.BufferedLogger" id="53974">buffered</a>: <a href="../Logger.scala.html#6671" title="sbt.BufferedLogger">BufferedLogger</a>)
	{
		<a href="#53974" title="sbt.BufferedLogger">buffered</a>.<a href="../Logger.scala.html#46106" title="()Unit">play</a>()
		<a href="#53974" title="sbt.BufferedLogger">buffered</a>.<a href="../Logger.scala.html#46108" title="()Unit">clear</a>()
	}

	<span class="comment">/* Most of the following is for implicitly adding dependencies (see the expand method)*/</span>
	<span class="keyword">private</span> <span class="keyword">val</span> <span id="53670"><a title="scala.collection.jcl.IdentityHashMap[sbt.Project,Iterable[sbt.Project]]" id="53669">projectDependencyCache</a></span> = <a title="()scala.collection.jcl.IdentityHashMap[sbt.Project,Iterable[sbt.Project]]" id="53710" class="keyword">new</a> <a title="scala.collection.jcl.IdentityHashMap[sbt.Project,Iterable[sbt.Project]]" id="7807">IdentityHashMap</a>[Project, Iterable[Project]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Iterable[sbt.Project]" id="53671">dependencies</a>(<a title="sbt.Project" id="53995">project</a>: <a href="../Project.scala.html#6395" title="sbt.Project">Project</a>) = <a href="#53669" title="=&gt; scala.collection.jcl.IdentityHashMap[sbt.Project,Iterable[sbt.Project]]">projectDependencyCache</a>.<a title="(sbt.Project,=&gt; Iterable[sbt.Project])Iterable[sbt.Project]" id="20473">getOrElseUpdate</a>(<a href="#53995" title="sbt.Project">project</a>, <a href="#53995" title="sbt.Project">project</a>.<a href="../Dag.scala.html#26240" title="=&gt; List[sbt.Project]">topologicalSort</a>.<a title="(Int)List[sbt.Project]" id="6828">dropRight</a>(<span title="Int(1)" class="int">1</span>))

	<span class="keyword">private</span> <span class="keyword">val</span> <span id="53673"><a title="scala.collection.jcl.IdentityHashMap[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]" id="53672">expandedCache</a></span> = <a title="()scala.collection.jcl.IdentityHashMap[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]" id="53710" class="keyword">new</a> <a title="scala.collection.jcl.IdentityHashMap[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]" id="7807">IdentityHashMap</a>[Task, Task]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="53674">expanded</a>(<a title="sbt.impl.RunTask.Task" id="53997">task</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a> = <a href="#53672" title="=&gt; scala.collection.jcl.IdentityHashMap[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]">expandedCache</a>.<a title="(sbt.impl.RunTask.Task,=&gt; sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="20473">getOrElseUpdate</a>(<a href="#53997" title="sbt.impl.RunTask.Task">task</a>, <a href="#53694" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expandImpl</a>(<a href="#53997" title="sbt.impl.RunTask.Task">task</a>))

	<span class="keyword">private</span> <span class="keyword">val</span> <span id="53676"><a title="scala.collection.jcl.IdentityHashMap[sbt.impl.RunTask.Task,String]" id="53675">expandedTaskNameCache</a></span> = <a title="()scala.collection.jcl.IdentityHashMap[sbt.impl.RunTask.Task,String]" id="53710" class="keyword">new</a> <a title="scala.collection.jcl.IdentityHashMap[sbt.impl.RunTask.Task,String]" id="7807">IdentityHashMap</a>[Task, String]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)String" id="53677">expandedTaskName</a>(<a title="sbt.impl.RunTask.Task" id="53903">task</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>) =
		<span title="String" class="keyword">if</span>(<a href="#53903" title="sbt.impl.RunTask.Task">task</a> <a title="(AnyRef)Boolean" id="3399">==</a> <a href="#53685" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>)
			<a href="#53655" title="String">rootName</a>
		<span class="keyword">else</span>
			<a href="#53675" title="=&gt; scala.collection.jcl.IdentityHashMap[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>.<a title="(sbt.impl.RunTask.Task,=&gt; String)String" id="20501">getOrElse</a>(<a href="#53903" title="sbt.impl.RunTask.Task">task</a>, <a href="#46457" title="=&gt; java.lang.String">UnnamedName</a>)

	<span class="keyword">private</span> <span class="keyword">val</span> <span id="53679"><a title="scala.collection.jcl.IdentityHashMap[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]" id="53678">nameToTaskCache</a></span> = <a title="()scala.collection.jcl.IdentityHashMap[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]" id="53710" class="keyword">new</a> <a title="scala.collection.jcl.IdentityHashMap[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]" id="7807">IdentityHashMap</a>[Project, Map[String, Task]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]" id="53680">nameToTaskMap</a>(<a title="sbt.Project" id="53999">project</a>: <a href="../Project.scala.html#6395" title="sbt.Project">Project</a>): <a title="scala.collection.Map[String,sbt.impl.RunTask.Task]" id="7363">Map</a>[String, Task] = <a href="#53678" title="=&gt; scala.collection.jcl.IdentityHashMap[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]">nameToTaskCache</a>.<a title="(sbt.Project,=&gt; scala.collection.Map[String,sbt.impl.RunTask.Task])scala.collection.Map[String,sbt.impl.RunTask.Task]" id="20473">getOrElseUpdate</a>(<a href="#53999" title="sbt.Project">project</a>, <a href="#53999" title="sbt.Project">project</a>.<a href="../Project.scala.html#26179" title="=&gt; scala.collection.Map[String,project.Task]">tasks</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]" id="53681">taskForName</a>(<a title="sbt.Project" id="54000">project</a>: <a href="../Project.scala.html#6395" title="sbt.Project">Project</a>, <a title="String" id="54001">name</a>: <a title="String" id="1751">String</a>): <a title="Option[sbt.impl.RunTask.Task]" id="871">Option</a>[Task] = <a href="#53680" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#54000" title="sbt.Project">project</a>).<a title="(String)Option[sbt.impl.RunTask.Task]" id="20500">get</a>(<a href="#54001" title="String">name</a>)
	
	<span class="keyword">private</span> <span class="keyword">val</span> <span id="53683"><a title="scala.collection.jcl.IdentityHashMap[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]" id="53682">taskNameCache</a></span> = <a title="()scala.collection.jcl.IdentityHashMap[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]" id="53710" class="keyword">new</a> <a title="scala.collection.jcl.IdentityHashMap[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]" id="7807">IdentityHashMap</a>[Project, Map[Task, String]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="53684">taskName</a>(<a title="sbt.impl.RunTask.Task" id="54002">task</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>) =
	{
		<span class="keyword">val</span> <a title="sbt.Project#ManagerType" id="54004">project</a> = <a href="#54002" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#28026" title="=&gt; sbt.Project#ManagerType">manager</a>
		<a href="#53682" title="=&gt; scala.collection.jcl.IdentityHashMap[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]">taskNameCache</a>.<a title="(sbt.Project,=&gt; scala.collection.Map[sbt.impl.RunTask.Task,String])scala.collection.Map[sbt.impl.RunTask.Task,String]" id="20473">getOrElseUpdate</a>(<a href="#54004" title="sbt.Project#ManagerType">project</a>, <a href="#53696" title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]">taskNameMap</a>(<a href="#54004" title="sbt.Project#ManagerType">project</a>)).<a title="(sbt.impl.RunTask.Task)Option[String]" id="20500">get</a>(<a href="#54002" title="sbt.impl.RunTask.Task">task</a>)
	}
	
	<span class="keyword">private</span> <span class="keyword">val</span> <span id="53686"><a title="sbt.impl.RunTask.Task" id="53685">expandedRoot</a></span> = <a href="#53693" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expand</a>(<a href="#53654" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">val</span> <span id="53688"><a title="List[sbt.Project#ManagedTask]" id="53687">allTasks</a></span> = <a href="#53685" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>.<a href="../Dag.scala.html#26240" title="=&gt; List[sbt.Project#ManagedTask]">topologicalSort</a>
	<span class="keyword">private</span> <span class="keyword">val</span> <span id="53690"><a title="scala.collection.immutable.Set[sbt.Project#ManagerType]" id="53689">allProjects</a></span> = <span id="25932"><span id="5871"><a title="(sbt.Project#ManagerType*)scala.collection.immutable.Set[sbt.Project#ManagerType]" id="770">Set</a></span></span>(<a href="#53687" title="=&gt; List[sbt.Project#ManagedTask]">allTasks</a>.<a title="((sbt.Project#ManagedTask) =&gt; sbt.Project#ManagerType)List[sbt.Project#ManagerType]" id="6835">map</a>(<a href="#53863" title="sbt.Project#ManagedTask">_</a>.<a href="../TaskManager.scala.html#28026" title="=&gt; sbt.Project#ManagerType">manager</a>).<a title="=&gt; Seq[sbt.Project#ManagerType]" id="7140">toSeq</a> : _*)
	<span class="keyword">private</span> <span class="keyword">val</span> <span id="53692"><a title="List[sbt.BufferedLogger]" id="53691">bufferedLoggers</a></span> = <span title="List[sbt.BufferedLogger]" class="keyword">if</span>(<a href="#53658" title="=&gt; Boolean">parallel</a>) <a href="#53689" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<a title="=&gt; List[sbt.Project#ManagerType]" id="7279">toList</a>.<a title="((sbt.Project#ManagerType) =&gt; Iterable[sbt.BufferedLogger])List[sbt.BufferedLogger]" id="6856">flatMap</a>(<span id="10146"><a href="#53697" title="(Option[sbt.BufferedLogger])Iterable[sbt.BufferedLogger]" id="872">bufferedLogger</a></span>) <span class="keyword">else</span> <a title="object Nil" id="299">Nil</a>
	
	<span class="comment">/** Adds implicit dependencies, which are tasks with the same name in the project dependencies
	* of the enclosing project of the task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="53693">expand</a>(<a title="sbt.impl.RunTask.Task" id="53855">root</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a> = <a href="#53674" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>(<a href="#53855" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="53694">expandImpl</a>(<a title="sbt.impl.RunTask.Task" id="53998">task</a>: <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#26166" title="sbt.impl.RunTask.Task">Task</a> =
	{
		<span class="keyword">val</span> <a title="Option[String]" id="54014">nameOption</a> = <a href="#53684" title="(sbt.impl.RunTask.Task)Option[String]">taskName</a>(<a href="#53998" title="sbt.impl.RunTask.Task">task</a>)
		<span class="keyword">val</span> <a title="List[sbt.Project#ManagedTask]" id="54015">explicitDependencies</a> = <a href="#53998" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#28020" title="=&gt; List[sbt.Project#ManagedTask]">dependencies</a>
		<span class="keyword">val</span> <a title="Iterable[sbt.impl.RunTask.Task]" id="54016">implicitDependencies</a> = <a href="#54014" title="Option[String]">nameOption</a>.<a title="((String) =&gt; Iterable[sbt.impl.RunTask.Task])Option[Iterable[sbt.impl.RunTask.Task]]" id="10157">map</a>(<a title="String" id="54029">name</a> =&gt; <a href="#53671" title="(sbt.Project)Iterable[sbt.Project]">dependencies</a>(<a href="#53998" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#28026" title="=&gt; sbt.Project#ManagerType">manager</a>).<a title="((sbt.Project) =&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="7248">flatMap</a>(<span id="10146"><a href="#53695" title="(Option[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="872">noninteractiveTask</a></span>(<a href="#54029" title="String">name</a>)) ).<a title="(=&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="10155">getOrElse</a>(<a title="object Nil" id="299">Nil</a>)
		<span class="keyword">val</span> <a title="scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="54017">allDependencies</a> = mutable.<span id="21765"><a title="(sbt.Project#ManagedTask*)scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="7910">HashSet</a></span>( (<a href="#54015" title="List[sbt.Project#ManagedTask]">explicitDependencies</a> <a title="(Iterable[sbt.Project#ManagedTask])List[sbt.Project#ManagedTask]" id="6814">++</a> <a href="#54016" title="Iterable[sbt.impl.RunTask.Task]">implicitDependencies</a>).<a title="=&gt; Seq[sbt.Project#ManagedTask]" id="7140">toSeq</a>  : _* )
		<span class="keyword">val</span> <a title="sbt.Project#Task" id="54018">expandedTask</a> = <a href="#53998" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#28028" title="((List[_76.ManagedTask])_76.Task) forSome { val _76: sbt.Project }">setDependencies</a>(<a href="#54017" title="scala.collection.mutable.Set[sbt.Project#ManagedTask]">allDependencies</a>.<a title="=&gt; List[sbt.Project#ManagedTask]" id="7279">toList</a>.<a title="((sbt.Project#ManagedTask) =&gt; sbt.impl.RunTask.Task)List[sbt.impl.RunTask.Task]" id="6835">map</a>(<a href="#53674" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>))
		<a href="#54014" title="Option[String]">nameOption</a>.<a title="((String) =&gt; Unit)Unit" id="10162">foreach</a>(<a title="String" id="54062">name</a> =&gt; <a href="#53675" title="=&gt; scala.collection.jcl.IdentityHashMap[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>(<a href="#54018" title="sbt.Project#Task">expandedTask</a>) = <a href="#54062" title="String">name</a>)
		<a href="#54018" title="sbt.Project#Task">expandedTask</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)(sbt.Project)Option[sbt.impl.RunTask.Task]" id="53695">noninteractiveTask</a>(<a title="String" id="54033">name</a>: <a title="String" id="1751">String</a>)(<a title="sbt.Project" id="54034">project</a>: <a href="../Project.scala.html#6395" title="sbt.Project">Project</a>): <a title="Option[sbt.impl.RunTask.Task]" id="871">Option</a>[Task] =
		<a href="#53681" title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]">taskForName</a>(<a href="#54034" title="sbt.Project">project</a>, <a href="#54033" title="String">name</a>) <a title="((sbt.impl.RunTask.Task) =&gt; Option[sbt.impl.RunTask.Task])Option[sbt.impl.RunTask.Task]" id="10159">flatMap</a> { <a title="sbt.impl.RunTask.Task" id="54065">task</a> =&gt;
			<span title="Option[sbt.impl.RunTask.Task]" class="keyword">if</span>(<a href="#54065" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#28022" title="=&gt; Boolean">interactive</a>)
			{
				<a href="#54034" title="sbt.Project">project</a>.<a href="../Project.scala.html#26169" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#8351" title="(=&gt; String)Unit">debug</a>(<span title="java.lang.String(&quot;Not including task &quot;)" class="string">&quot;Not including task &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#54033" title="String">name</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot; in project &quot;)" class="string">&quot; in project &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#54034" title="sbt.Project">project</a>.<a href="../Project.scala.html#26174" title="=&gt; String">name</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot;: interactive tasks can only be run directly.&quot;)" class="string">&quot;: interactive tasks can only be run directly.&quot;</span>)
				<a title="object None" id="488">None</a>
			}
			<span class="keyword">else</span>
				<span id="10256"><a title="(sbt.impl.RunTask.Task)Some[sbt.impl.RunTask.Task]" id="275">Some</a></span>(<a href="#54065" title="sbt.impl.RunTask.Task">task</a>)
		}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="53696">taskNameMap</a>(<a title="sbt.Project" id="54007">project</a>: <a href="../Project.scala.html#6395" title="sbt.Project">Project</a>) = mutable.<span id="20489"><a title="((sbt.impl.RunTask.Task, String)*)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="7895">Map</a></span>(<a href="#53680" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#54007" title="sbt.Project">project</a>).<a title="(((String, sbt.impl.RunTask.Task)) =&gt; (sbt.impl.RunTask.Task, String))Iterable[(sbt.impl.RunTask.Task, String)]" id="7246">map</a>(<a href="#54013" title="(String, sbt.impl.RunTask.Task)">_</a>.<a title="=&gt; (sbt.impl.RunTask.Task, String)" id="9246">swap</a>).<a title="=&gt; Seq[(sbt.impl.RunTask.Task, String)]" id="7280">toSeq</a> : _*)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Option[sbt.BufferedLogger]" id="53697">bufferedLogger</a>(<a title="sbt.Project" id="53872">project</a>: <a href="../Project.scala.html#6395" title="sbt.Project">Project</a>): <a title="Option[sbt.BufferedLogger]" id="871">Option</a>[BufferedLogger] =
		<a href="#53872" title="sbt.Project">project</a>.<a href="../Project.scala.html#26169" title="=&gt; sbt.Logger">log</a> <span title="Option[sbt.BufferedLogger]" class="keyword">match</span>
		{
			<span title="Some[sbt.BufferedLogger]" class="keyword">case</span> <a title="sbt.BufferedLogger" id="54067">buffered</a>: <a href="../Logger.scala.html#6671" title="sbt.BufferedLogger">BufferedLogger</a> =&gt; <span id="10256"><a title="(sbt.BufferedLogger)Some[sbt.BufferedLogger]" id="275">Some</a></span>(<a href="#54067" title="sbt.BufferedLogger">buffered</a>)
			<span title="None.type" class="keyword">case</span> _ =&gt; <a title="object None" id="488">None</a>
		}
}
        </pre>
    </body>
</html>