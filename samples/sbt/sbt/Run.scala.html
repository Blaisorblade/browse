<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/Run.scala</title>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2008, 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">import</span> scala.tools.nsc.{interpreter, util, GenericRunnerCommand, InterpreterLoop, ObjectRunner, Settings}
<span class="keyword">import</span> util.ClassPath
<span class="keyword">import</span> java.net.URL

<span class="comment">/** This module is an interface to starting the scala interpreter or runner.*/</span>
<span class="keyword">object</span> <span class="typed"><span class="type">object sbt.Run</span><a id="6431">Run</a></span>
{
	<span class="comment">/** Starts an interactive scala interpreter session with the given classpath.*/</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(Iterable[sbt.Path],sbt.Logger)Option[String]</span><a id="43911">console</a></span>(<span class="typed"><span class="type">Iterable[sbt.Path]</span><a id="43917">classpath</a></span>: <span class="typed"><span class="type">Iterable[sbt.Path]</span><a id="384">Iterable</a></span>[Path], <span class="typed"><span class="type">sbt.Logger</span><a id="43918">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>) =
		<span class="typed"><span class="type">(sbt.Logger)((scala.tools.nsc.Settings) =&gt; Option[String])Option[String]</span><a href="#43915">createSettings</a></span>(<span class="typed"><span class="type">sbt.Logger</span><a href="#43918">log</a></span>)
		{
			(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="43971">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="10911">Settings</a></span>) =&gt;
			{
				<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#43971">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a id="12240">classpath</a></span>.<span class="typed"><span class="type">(settings.classpath.T)Unit</span><a id="12024">value</a></span> = <span class="typed"><span class="type">object sbt.Path</span><a href="Path.scala.html#6800">Path</a></span>.<span class="typed"><span class="type">(Iterable[sbt.Path])String</span><a href="Path.scala.html#9601">makeString</a></span>(<span class="typed"><span class="type">Iterable[sbt.Path]</span><a href="#43917">classpath</a></span>)
				<span class="typed"><span class="type">sbt.Logger</span><a href="#43918">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8467">info</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Starting scala interpreter...&quot;)</span><span class="string">&quot;Starting scala interpreter...&quot;</span></span>)
				<span class="typed"><span class="type">sbt.Logger</span><a href="#43918">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8466">debug</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;  Classpath: &quot;)</span><span class="string">&quot;  Classpath: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#43971">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a id="12240">classpath</a></span>.<span class="typed"><span class="type">=&gt; settings.classpath.T</span><a id="12023">value</a></span>)
				<span class="typed"><span class="type">sbt.Logger</span><a href="#43918">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8467">info</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)
				<span class="typed"><span class="type">object sbt.Control</span><a href="Control.scala.html#6704">Control</a></span>.<span class="typed"><span class="type">(=&gt; String,sbt.Logger)(=&gt; Option[String])Option[String]</span><a href="Control.scala.html#10298">trapUnit</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Error during session: &quot;)</span><span class="string">&quot;Error during session: &quot;</span></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#43918">log</a></span>)
				{
					<span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterLoop</span><a id="43972">loop</a></span> = <span class="typed"><span class="type">()scala.tools.nsc.InterpreterLoop</span><a id="43977" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.InterpreterLoop</span><a id="11223">InterpreterLoop</a></span>
					<span class="typed"><span class="type">(=&gt; Unit,sbt.Logger)Option[String]</span><a href="#43912">executeTrapExit</a></span>(<span class="typed"><span class="type">scala.tools.nsc.InterpreterLoop</span><a href="#43972">loop</a></span>.<span class="typed"><span class="type">(scala.tools.nsc.Settings)Unit</span><a id="44024">main</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#43971">settings</a></span>), <span class="typed"><span class="type">sbt.Logger</span><a href="#43918">log</a></span>)
				}
			}
		}
	<span class="comment">/** Executes the given function, trapping calls to System.exit. */</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(=&gt; Unit,sbt.Logger)Option[String]</span><a id="43912">executeTrapExit</a></span>(<span class="typed"><span class="type">=&gt; Unit</span><a id="44029">f</a></span>: =&gt; Unit, <span class="typed"><span class="type">sbt.Logger</span><a id="44030">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>): <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String] =
	{
		<span class="typed"><span class="type">(=&gt; Unit,sbt.Logger)Either[Int,Unit]</span><a href="TrapExit.scala.html#44033">TrapExit</a></span>(<span class="typed"><span class="type">=&gt; Unit</span><a href="#44029">f</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#44030">log</a></span>) <span class="typed"><span class="type">Option[String]</span><span class="keyword">match</span></span>
		{
			<span class="typed"><span class="type">Option[String]</span><span class="keyword">case</span></span> <a id="1">Left</a>(<span class="typed"><span class="type">Int</span><a id="44048">exitCode</a></span>) =&gt;
			{
				<span class="typed"><span class="type">Option[String]</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">Int</span><a href="#44048">exitCode</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3122">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
				{
					<span class="typed"><span class="type">sbt.Logger</span><a href="#44030">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8466">debug</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Exited with code 0&quot;)</span><span class="string">&quot;Exited with code 0&quot;</span></span>)
					<span class="typed"><span class="type">object None</span><a id="517">None</a></span>
				}
				<span class="keyword">else</span>
					<span class="typed"><span class="type">(java.lang.String)Some[java.lang.String]</span><span id="10375"><a id="289">Some</a></span></span>(<span class="typed"><span class="type">java.lang.String(&quot;Nonzero exit code: &quot;)</span><span class="string">&quot;Nonzero exit code: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">Int</span><a href="#44048">exitCode</a></span>)
			}
			<span class="typed"><span class="type">None.type</span><span class="keyword">case</span></span> _ =&gt; <span class="typed"><span class="type">object None</span><a id="517">None</a></span>
		}
	}
	<span class="comment">/** Runs the class 'mainClass' using the given classpath and options using the scala runner.*/</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(String,Iterable[sbt.Path],Seq[String],sbt.Logger)Option[String]</span><a id="43913">run</a></span>(<span class="typed"><span class="type">String</span><a id="44051">mainClass</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>, <span class="typed"><span class="type">Iterable[sbt.Path]</span><a id="44052">classpath</a></span>: <span class="typed"><span class="type">Iterable[sbt.Path]</span><a id="384">Iterable</a></span>[Path], <span class="typed"><span class="type">Seq[String]</span><a id="44053">options</a></span>: <span class="typed"><span class="type">Seq[String]</span><a id="744">Seq</a></span>[String], <span class="typed"><span class="type">sbt.Logger</span><a id="44054">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>) =
	{
		<span class="typed"><span class="type">(sbt.Logger)((scala.tools.nsc.Settings) =&gt; Option[String])Option[String]</span><a href="#43915">createSettings</a></span>(<span class="typed"><span class="type">sbt.Logger</span><a href="#44054">log</a></span>)
		{
			(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="44057">settings</a></span>: <span class="typed"><span class="type">scala.tools.nsc.Settings</span><a id="10911">Settings</a></span>) =&gt;
			{
				<span class="typed"><span class="type">object sbt.Control</span><a href="Control.scala.html#6704">Control</a></span>.<span class="typed"><span class="type">(=&gt; String,sbt.Logger)(=&gt; Option[String])Option[String]</span><a href="Control.scala.html#10298">trapUnit</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Error during run: &quot;)</span><span class="string">&quot;Error during run: &quot;</span></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#44054">log</a></span>)
				{
					<span class="keyword">val</span> <span class="typed"><span class="type">List[java.net.URL]</span><a id="44058">classpathURLs</a></span> = <span class="typed"><span class="type">Iterable[sbt.Path]</span><a href="#44052">classpath</a></span>.<span class="typed"><span class="type">((sbt.Path) =&gt; java.net.URL)Iterable[java.net.URL]</span><a id="7355">map</a></span>(<span class="typed"><span class="type">sbt.Path</span><a href="#44063">_</a></span>.<span class="typed"><span class="type">=&gt; java.net.URL</span><a href="Path.scala.html#9639">asURL</a></span>).<span class="typed"><span class="type">=&gt; List[java.net.URL]</span><a id="7388">toList</a></span>
					<span class="keyword">val</span> <span class="typed"><span class="type">Array[java.lang.String]</span><a id="44059">bootClasspath</a></span> = <span class="typed"><span class="type">object sbt.FileUtilities</span><a href="FileUtilities.scala.html#6450">FileUtilities</a></span>.<span class="typed"><span class="type">(String)Array[java.lang.String]</span><a href="FileUtilities.scala.html#9503">pathSplit</a></span>(<span class="typed"><span class="type">scala.tools.nsc.Settings</span><a href="#44057">settings</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.Settings.StringSetting</span><a id="12238">bootclasspath</a></span>.<span class="typed"><span class="type">=&gt; settings.bootclasspath.T</span><a id="12023">value</a></span>)
					<span class="keyword">val</span> <span class="typed"><span class="type">Array[java.net.URL]</span><a id="44060">extraURLs</a></span> =
						<span class="keyword">for</span>(<span class="typed"><span class="type">((java.lang.String) =&gt; java.net.URL)Array[java.net.URL]</span><span id="7089"><span id="7086"><span id="44065"><a id="44070">pathString</a></span></span></span></span> &lt;- <span class="typed"><span class="type">Array[java.lang.String]</span><a href="#44059">bootClasspath</a></span> <span class="keyword">if</span> <span class="typed"><span class="type">java.lang.String</span><a href="#44065">pathString</a></span>.<span class="typed"><span class="type">()Int</span><a id="5793">length</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3126">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="keyword">yield</span>
							(<span class="typed"><span class="type">java.io.File</span><span class="keyword">new</span></span> java.io.<span class="typed"><span class="type">java.io.File</span><a id="3650">File</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#44070">pathString</a></span>)).<span class="typed"><span class="type">()java.net.URI</span><a id="9665">toURI</a></span>.<span class="typed"><span class="type">()java.net.URL</span><a id="22211">toURL</a></span>
					<span class="typed"><span class="type">sbt.Logger</span><a href="#44054">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8467">info</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Running &quot;)</span><span class="string">&quot;Running &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">String</span><a href="#44051">mainClass</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; ...&quot;)</span><span class="string">&quot; ...&quot;</span></span>)
					<span class="typed"><span class="type">sbt.Logger</span><a href="#44054">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8466">debug</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;  Classpath:&quot;)</span><span class="string">&quot;  Classpath:&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> (<span class="typed"><span class="type">List[java.net.URL]</span><a href="#44058">classpathURLs</a></span> <span class="typed"><span class="type">(Iterable[java.net.URL])List[java.net.URL]</span><a id="6914">++</a></span> <span class="typed"><span class="type">Array[java.net.URL]</span><a href="#44060">extraURLs</a></span>).<span class="typed"><span class="type">(String,String,String)String</span><a id="7391">mkString</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;\012\011&quot;)</span><span class="string">&quot;\n\t&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;\012\011&quot;)</span><span class="string">&quot;\n\t&quot;</span></span>,<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>))
					<span class="typed"><span class="type">(=&gt; Unit,sbt.Logger)Option[String]</span><a href="#43912">executeTrapExit</a></span>( <span class="typed"><span class="type">object scala.tools.nsc.ObjectRunner</span><a id="10993">ObjectRunner</a></span>.<span class="typed"><span class="type">(List[java.net.URL],String,Seq[String])Unit</span><a id="44091">run</a></span>(<span class="typed"><span class="type">List[java.net.URL]</span><a href="#44058">classpathURLs</a></span> <span class="typed"><span class="type">(Iterable[java.net.URL])List[java.net.URL]</span><a id="6914">++</a></span> <span class="typed"><span class="type">Array[java.net.URL]</span><a href="#44060">extraURLs</a></span>, <span class="typed"><span class="type">String</span><a href="#44051">mainClass</a></span>, <span class="typed"><span class="type">Seq[String]</span><a href="#44053">options</a></span>.<span class="typed"><span class="type">=&gt; List[String]</span><a id="7388">toList</a></span>), <span class="typed"><span class="type">sbt.Logger</span><a href="#44054">log</a></span> )
				}
			}
		}
	}
	<span class="comment">/** If mainClassOption is None, then the interactive scala interpreter is started with the given classpath.
	* Otherwise, the class wrapped by Some is run using the scala runner with the given classpath and
	* options. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(Option[String],Iterable[sbt.Path],Seq[String],sbt.Logger)Option[String]</span><a id="43914">apply</a></span>(<span class="typed"><span class="type">Option[String]</span><a id="44098">mainClassOption</a></span>: <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String], <span class="typed"><span class="type">Iterable[sbt.Path]</span><a id="44099">classpath</a></span>: <span class="typed"><span class="type">Iterable[sbt.Path]</span><a id="384">Iterable</a></span>[Path], <span class="typed"><span class="type">Seq[String]</span><a id="44100">options</a></span>: <span class="typed"><span class="type">Seq[String]</span><a id="744">Seq</a></span>[String], <span class="typed"><span class="type">sbt.Logger</span><a id="44101">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>) =
	{
		<span class="typed"><span class="type">Option[String]</span><a href="#44098">mainClassOption</a></span> <span class="typed"><span class="type">Option[String]</span><span class="keyword">match</span></span>
		{
			<span class="typed"><span class="type">Option[String]</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">String</span><a id="44103">mainClass</a></span>) =&gt; <span class="typed"><span class="type">(String,Iterable[sbt.Path],Seq[String],sbt.Logger)Option[String]</span><a href="#43913">run</a></span>(<span class="typed"><span class="type">String</span><a href="#44103">mainClass</a></span>, <span class="typed"><span class="type">Iterable[sbt.Path]</span><a href="#44099">classpath</a></span>, <span class="typed"><span class="type">Seq[String]</span><a href="#44100">options</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#44101">log</a></span>)
			<span class="typed"><span class="type">Option[String]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="517">None</a></span> =&gt; <span class="typed"><span class="type">(Iterable[sbt.Path],sbt.Logger)Option[String]</span><a href="#43911">console</a></span>(<span class="typed"><span class="type">Iterable[sbt.Path]</span><a href="#44099">classpath</a></span>, <span class="typed"><span class="type">sbt.Logger</span><a href="#44101">log</a></span>)
		}
	}
	<span class="comment">/** Create a settings object and execute the provided function if the settings are created ok.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(sbt.Logger)((scala.tools.nsc.Settings) =&gt; Option[String])Option[String]</span><a id="43915">createSettings</a></span>(<span class="typed"><span class="type">sbt.Logger</span><a id="43920">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>)(<span class="typed"><span class="type">(scala.tools.nsc.Settings) =&gt; Option[String]</span><a id="43921">f</a></span>: Settings =&gt; Option[String]) =
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerCommand</span><a id="43923">command</a></span> = <span class="typed"><span class="type">(List[String],(String) =&gt; Unit)scala.tools.nsc.GenericRunnerCommand</span><a id="43929" class="keyword">new</a></span> <span class="typed"><span class="type">scala.tools.nsc.GenericRunnerCommand</span><a id="11568">GenericRunnerCommand</a></span>(<span class="typed"><span class="type">object Nil</span><a id="316">Nil</a></span>, <span class="typed"><span class="type">String</span><a id="43954">message</a></span> =&gt; <span class="typed"><span class="type">sbt.Logger</span><a href="#43920">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8469">error</a></span>(<span class="typed"><span class="type">String</span><a href="#43954">message</a></span>))
		<span class="typed"><span class="type">Option[String]</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerCommand</span><a href="#43923">command</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a id="12434">ok</a></span>)
			<span class="typed"><span class="type">(scala.tools.nsc.Settings)Option[String]</span><a href="#43921" id="7330">f</a></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerCommand</span><a href="#43923">command</a></span>.<span class="typed"><span class="type">=&gt; scala.tools.nsc.GenericRunnerSettings</span><a id="43925">settings</a></span>)
		<span class="keyword">else</span>
			<span class="typed"><span class="type">(java.lang.String)Some[java.lang.String]</span><span id="10375"><a id="289">Some</a></span></span>(<span class="typed"><span class="type">scala.tools.nsc.GenericRunnerCommand</span><a href="#43923">command</a></span>.<span class="typed"><span class="type">=&gt; java.lang.String</span><a id="43940">usageMsg</a></span>)
	}
}
        </pre>
    </body>
</html>