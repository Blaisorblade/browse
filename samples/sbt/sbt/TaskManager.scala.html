<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/TaskManager.scala</title>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2008 David MacIver, Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">trait</span> <span class="typed"><span class="type">trait Described extends java.lang.Object with NotNull</span><a id="6341">Described</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
{
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Option[String]</span><a id="29351">description</a></span>: <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String]
}
<span class="keyword">trait</span> <span class="typed"><span class="type">trait TaskManager extends java.lang.Object with ScalaObject</span><a id="6342">TaskManager</a></span>{
	<span class="keyword">type</span> <span class="typed"><span class="type">&gt;: TaskManager.this.type &lt;: sbt.TaskManager</span><a id="25075">ManagerType</a></span> &gt;: <span class="keyword">this</span>.<span class="keyword">type</span> &lt;: TaskManager
	<span class="keyword">type</span> <span class="typed"><span class="type">&gt;: TaskManager.this.Task &lt;: sbt.TaskManager#Task with sbt.Dag[TaskManager.this.ManagedTask]</span><a id="25076">ManagedTask</a></span> &gt;: Task &lt;: TaskManager#Task <span class="keyword">with</span> Dag[ManagedTask]
	<span class="comment">/** Creates a task that executes the given action when invoked.*/</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(=&gt; Option[String])TaskManager.this.Task</span><a id="25077">task</a></span>(<span class="typed"><span class="type">=&gt; Option[String]</span><a id="29392">action</a></span> : =&gt; Option[String]) = <span class="typed"><span class="type">TaskManager.this.Task</span><span class="keyword">new</span></span> <span class="typed"><span class="type">TaskManager.this.Task</span><a href="#25081">Task</a></span>(<span class="typed"><span class="type">object None</span><a id="517">None</a></span>, <span class="typed"><span class="type">object Nil</span><a id="316">Nil</a></span>, <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>, <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29392">action</a></span>)
	<span class="comment">/** An interactive task is one that is not executed across all dependent projects when
	* it is called directly.  The dependencies of the task are still invoked across all dependent
	* projects, however. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">(=&gt; Option[String])TaskManager.this.Task</span><a id="25078">interactiveTask</a></span>(<span class="typed"><span class="type">=&gt; Option[String]</span><a id="34102">action</a></span>: =&gt; Option[String]) = <span class="typed"><span class="type">TaskManager.this.Task</span><span class="keyword">new</span></span> <span class="typed"><span class="type">TaskManager.this.Task</span><a href="#25081">Task</a></span>(<span class="typed"><span class="type">object None</span><a id="517">None</a></span>, <span class="typed"><span class="type">object Nil</span><a id="316">Nil</a></span>, <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>, <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#34102">action</a></span>)
	<span class="comment">/** Creates a method task that executes the given action when invoked. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">((Array[String]) =&gt; TaskManager.this.ManagedTask)TaskManager.this.MethodTask</span><a id="25079">task</a></span>(<span class="typed"><span class="type">(Array[String]) =&gt; TaskManager.this.ManagedTask</span><a id="29349">action</a></span>: Array[String] =&gt; ManagedTask) = <span class="typed"><span class="type">TaskManager.this.MethodTask</span><span class="keyword">new</span></span> <span class="typed"><span class="type">TaskManager.this.MethodTask</span><a href="#25080">MethodTask</a></span>(<span class="typed"><span class="type">object None</span><a id="517">None</a></span>, <span class="typed"><span class="type">(Array[String]) =&gt; TaskManager.this.ManagedTask</span><a href="#29349">action</a></span>, <span class="typed"><span class="type">object Nil</span><a id="316">Nil</a></span>)
	
	<span class="comment">/** A method task is an action that has parameters.  Note that it is not a Task, though,
	* because it requires arguments to perform its work.  It therefore cannot be a dependency of
	* a Task..*/</span>
	<span class="keyword">final</span> <span class="keyword">class</span> <span class="typed"><span class="type">class MethodTask extends java.lang.Object with sbt.Described with ScalaObject</span><a id="25080">MethodTask</a></span>(<span class="keyword">val</span> <span class="typed"><span class="type">Option[String]</span><span id="29356"><span id="29355"><a id="29365">description</a></span></span></span>: <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String], <span class="typed"><span class="type">(Array[String]) =&gt; TaskManager.this.ManagedTask</span><span id="29357"><a id="29366">action</a></span></span>: Array[String] =&gt; ManagedTask, <span class="keyword">val</span> <span class="typed"><span class="type">List[String]</span><span id="29359"><span id="29358"><a id="29367">completions</a></span></span></span>: <span class="typed"><span class="type">List[String]</span><a id="507">List</a></span>[String]) <span class="keyword">extends</span> <span class="typed"><span class="type">sbt.Described</span><a href="#6341">Described</a></span>
	{
		<span class="comment">/** Creates a new method task, identical to this method task, except with thE[String]e given description.*/</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(String)TaskManager.this.MethodTask</span><a id="29361">describedAs</a></span>(<span class="typed"><span class="type">String</span><a id="34108">description</a></span> : <span class="typed"><span class="type">String</span><a id="1842">String</a></span>) = <span class="typed"><span class="type">TaskManager.this.MethodTask</span><span class="keyword">new</span></span> <span class="typed"><span class="type">TaskManager.this.MethodTask</span><a href="#25080">MethodTask</a></span>(<span class="typed"><span class="type">(String)Some[String]</span><span id="10375"><a id="289">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#34108">description</a></span>), <span class="typed"><span class="type">(Array[String]) =&gt; TaskManager.this.ManagedTask</span><a href="#29357">action</a></span>, <span class="typed"><span class="type">=&gt; List[String]</span><a href="#29358">completions</a></span>)
		<span class="comment">/** Invokes this method task with the given arguments.*/</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(Array[String])TaskManager.this.ManagedTask</span><a id="29362">apply</a></span>(<span class="typed"><span class="type">Array[String]</span><a id="34111">arguments</a></span>: <span class="typed"><span class="type">Array[String]</span><a id="1053">Array</a></span>[String]) = <span class="typed"><span class="type">(Array[String])TaskManager.this.ManagedTask</span><a href="#29357" id="7330">action</a></span>(<span class="typed"><span class="type">Array[String]</span><a href="#34111">arguments</a></span>)
		<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; TaskManager.this.ManagerType</span><a id="29363">manager</a></span>: <span class="typed"><span class="type">TaskManager.this.ManagerType</span><a href="#25075">ManagerType</a></span> = <span class="typed"><span class="type">TaskManager.this.type</span><a href="#6342">TaskManager</a></span>.<span class="keyword">this</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(Iterable[String])TaskManager.this.MethodTask</span><a id="29364">completeWith</a></span>(<span class="typed"><span class="type">Iterable[String]</span><a id="34114">add</a></span>: <span class="typed"><span class="type">Iterable[String]</span><a id="384">Iterable</a></span>[String]) = <span class="typed"><span class="type">TaskManager.this.MethodTask</span><span class="keyword">new</span></span> <span class="typed"><span class="type">TaskManager.this.MethodTask</span><a href="#25080">MethodTask</a></span>(<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29355">description</a></span>, <span class="typed"><span class="type">(Array[String]) =&gt; TaskManager.this.ManagedTask</span><a href="#29357">action</a></span>, (<span class="typed"><span class="type">Iterable[String]</span><a href="#34114">add</a></span> <span class="typed"><span class="type">(Iterable[String])Collection[String]</span><a id="7353">++</a></span> <span class="typed"><span class="type">=&gt; List[String]</span><a href="#29358">completions</a></span>).<span class="typed"><span class="type">=&gt; List[String]</span><a id="7388">toList</a></span>)
	}
	
	<span class="keyword">class</span> <span class="typed"><span class="type">class Task extends java.lang.Object with sbt.Dag[TaskManager.this.ManagedTask] with sbt.Described with ScalaObject</span><a id="25081">Task</a></span>(<span class="keyword">val</span> <span class="typed"><span class="type">Option[String]</span><span id="29375"><span id="29374"><a id="29394">description</a></span></span></span> : <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String], <span class="keyword">val</span> <span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><span id="29377"><span id="29376"><a id="29395">dependencies</a></span></span></span> : <span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a id="507">List</a></span>[ManagedTask], <span class="keyword">val</span> <span class="typed"><span class="type">Boolean</span><span id="29379"><span id="29378"><a id="29396">interactive</a></span></span></span>: <span class="typed"><span class="type">Boolean</span><a id="2151">Boolean</a></span>,
		<span class="typed"><span class="type">=&gt; Option[String]</span><span id="29380"><a id="29397">action</a></span></span> : =&gt; Option[String]) <span class="keyword">extends</span> <span class="typed"><span class="type">sbt.Dag[TaskManager.this.ManagedTask]</span><a href="Dag.scala.html#6325">Dag</a></span>[ManagedTask] <span class="keyword">with</span> <span class="typed"><span class="type">sbt.Described</span><a href="#6341">Described</a></span>
	{
		<span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])Unit</span><a href="#25082">checkTaskDependencies</a></span>(<span class="typed"><span class="type">=&gt; List[TaskManager.this.ManagedTask]</span><a href="#29376">dependencies</a></span>)
		<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; TaskManager.this.ManagerType</span><a id="29382">manager</a></span>: <span class="typed"><span class="type">TaskManager.this.ManagerType</span><a href="#25075">ManagerType</a></span> = <span class="typed"><span class="type">TaskManager.this.type</span><a href="#6342">TaskManager</a></span>.<span class="keyword">this</span>
		
		<span class="comment">/** Creates a new task, identical to this task, except with the additional dependencies specified.*/</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(TaskManager.this.ManagedTask*)TaskManager.this.Task</span><a id="29383">dependsOn</a></span>(<span class="typed"><span class="type">TaskManager.this.ManagedTask*</span><a id="32429">tasks</a></span> : <span class="typed"><span class="type">TaskManager.this.ManagedTask*</span><a id="2722">ManagedTask</a></span>*) = <span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])TaskManager.this.Task</span><a href="#29384">setDependencies</a></span>(<span class="typed"><span class="type">TaskManager.this.ManagedTask*</span><a href="#32429">tasks</a></span>.<span class="typed"><span class="type">=&gt; List[TaskManager.this.ManagedTask]</span><a id="7388">toList</a></span> <span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])List[TaskManager.this.ManagedTask]</span><a href="#32435" id="6912">:::</a></span> <span class="typed"><span class="type">=&gt; List[TaskManager.this.ManagedTask]</span><a href="#29376">dependencies</a></span>)
		<span class="keyword">private</span>[sbt] <span class="keyword">def</span> <span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])TaskManager.this.Task</span><a id="29384">setDependencies</a></span>(<span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a id="32431">dependencyList</a></span>: <span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a id="507">List</a></span>[ManagedTask]) =
		{
			<span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])Unit</span><a href="#25082">checkTaskDependencies</a></span>(<span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a href="#32431">dependencyList</a></span>)
			<span class="typed"><span class="type">TaskManager.this.Task</span><span class="keyword">new</span></span> <span class="typed"><span class="type">TaskManager.this.Task</span><a href="#25081">Task</a></span>(<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29374">description</a></span>, <span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a href="#32431">dependencyList</a></span>, <span class="typed"><span class="type">=&gt; Boolean</span><a href="#29378">interactive</a></span>, <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29380">action</a></span>)
		}
		<span class="comment">/** Creates a new task, identical to this task, except with the given description.*/</span>
		<span class="keyword">def</span> <span class="typed"><span class="type">(String)TaskManager.this.Task</span><a id="29385">describedAs</a></span>(<span class="typed"><span class="type">String</span><a id="32389">description</a></span> : <span class="typed"><span class="type">String</span><a id="1842">String</a></span>) = <span class="typed"><span class="type">TaskManager.this.Task</span><span class="keyword">new</span></span> <span class="typed"><span class="type">TaskManager.this.Task</span><a href="#25081">Task</a></span>(<span class="typed"><span class="type">(String)Some[String]</span><span id="10375"><a id="289">Some</a></span></span>(<span class="typed"><span class="type">String</span><a href="#32389">description</a></span>), <span class="typed"><span class="type">=&gt; List[TaskManager.this.ManagedTask]</span><a href="#29376">dependencies</a></span>, <span class="typed"><span class="type">=&gt; Boolean</span><a href="#29378">interactive</a></span>, <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29380">action</a></span>);
		<span class="keyword">private</span>[sbt] <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Option[String]</span><a id="29386">invoke</a></span> = <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29380">action</a></span>;
	
		<span class="keyword">final</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; TaskManager.this.Task</span><a id="29387">setInteractive</a></span> = <span class="typed"><span class="type">TaskManager.this.Task</span><span class="keyword">new</span></span> <span class="typed"><span class="type">TaskManager.this.Task</span><a href="#25081">Task</a></span>(<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29374">description</a></span>, <span class="typed"><span class="type">=&gt; List[TaskManager.this.ManagedTask]</span><a href="#29376">dependencies</a></span>, <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>, <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29380">action</a></span>)
		<span class="keyword">final</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Option[String]</span><a id="29388">run</a></span> = <span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])Option[String]</span><a href="#29390">runSequentially</a></span>(<span class="typed"><span class="type">=&gt; List[TaskManager.this.ManagedTask]</span><a href="Dag.scala.html#25364">topologicalSort</a></span>)
		<span class="keyword">final</span> <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Option[String]</span><a id="29389">runDependenciesOnly</a></span> = <span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])Option[String]</span><a href="#29390">runSequentially</a></span>(<span class="typed"><span class="type">=&gt; List[TaskManager.this.ManagedTask]</span><a href="Dag.scala.html#25364">topologicalSort</a></span>.<span class="typed"><span class="type">(Int)List[TaskManager.this.ManagedTask]</span><a id="6928">dropRight</a></span>(<span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>))
		<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])Option[String]</span><a id="29390">runSequentially</a></span>(<span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a id="34130">tasks</a></span>: <span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a id="507">List</a></span>[ManagedTask]) = <span class="typed"><span class="type">object sbt.Control</span><a href="Control.scala.html#6704">Control</a></span>.<span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])((TaskManager.this.ManagedTask) =&gt; Option[String])Option[String]</span><a href="Control.scala.html#10308">lazyFold</a></span>(<span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a href="#34130">tasks</a></span>)(<span class="typed"><span class="type">TaskManager.this.ManagedTask</span><a href="#34143">_</a></span>.<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29386">invoke</a></span>)
	
		<span class="keyword">def</span> <span class="typed"><span class="type">(TaskManager.this.Task)TaskManager.this.Task</span><a id="29391">&amp;&amp;</a></span>(<span class="typed"><span class="type">TaskManager.this.Task</span><a id="34146">that</a></span> : <span class="typed"><span class="type">TaskManager.this.Task</span><a href="#25081">Task</a></span>) =
			<span class="typed"><span class="type">TaskManager.this.Task</span><span class="keyword">new</span></span> <span class="typed"><span class="type">TaskManager.this.Task</span><a href="#25081">Task</a></span>(<span class="typed"><span class="type">object None</span><a id="517">None</a></span>, <span class="typed"><span class="type">=&gt; List[TaskManager.this.ManagedTask]</span><a href="#29376">dependencies</a></span> <span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])List[TaskManager.this.ManagedTask]</span><a href="#34148" id="6912">:::</a></span> <span class="typed"><span class="type">TaskManager.this.Task</span><a href="#34146">that</a></span>.<span class="typed"><span class="type">=&gt; List[TaskManager.this.ManagedTask]</span><a href="#29376">dependencies</a></span>, <span class="typed"><span class="type">=&gt; Boolean</span><a href="#29378">interactive</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2731">||</a></span> <span class="typed"><span class="type">TaskManager.this.Task</span><a href="#34146">that</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#29378">interactive</a></span>, <span class="typed"><span class="type">Task.this.type</span><a href="#25081" class="keyword">this</a></span>.<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29386">invoke</a></span>.<span class="typed"><span class="type">(=&gt; Option[String])Option[String]</span><a id="10272">orElse</a></span>(<span class="typed"><span class="type">TaskManager.this.Task</span><a href="#34146">that</a></span>.<span class="typed"><span class="type">=&gt; Option[String]</span><a href="#29386">invoke</a></span>))
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(List[TaskManager.this.ManagedTask])Unit</span><a id="25082">checkTaskDependencies</a></span>(<span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a id="32433">dependencyList</a></span>: <span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a id="507">List</a></span>[ManagedTask])
	{
		<span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="34153">nullDependencyIndex</a></span> = <span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a href="#32433">dependencyList</a></span>.<span class="typed"><span class="type">((TaskManager.this.ManagedTask) =&gt; Boolean)Int</span><a id="7231">findIndexOf</a></span>(<span class="typed"><span class="type">TaskManager.this.ManagedTask</span><a href="#34156">_</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3490">==</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>)
		<span class="typed"><span class="type">(Boolean,=&gt; Any)Unit</span><span id="5972"><a id="802">require</a></span></span>(<span class="typed"><span class="type">Int</span><a href="#34153">nullDependencyIndex</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3124">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;Dependency (at index &quot;)</span><span class="string">&quot;Dependency (at index &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">Int</span><a href="#34153">nullDependencyIndex</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;) is null.  This may be an initialization issue or a circular dependency.&quot;)</span><span class="string">&quot;) is null.  This may be an initialization issue or a circular dependency.&quot;</span></span>)
		<span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="34154">interactiveDependencyIndex</a></span> = <span class="typed"><span class="type">List[TaskManager.this.ManagedTask]</span><a href="#32433">dependencyList</a></span>.<span class="typed"><span class="type">((TaskManager.this.ManagedTask) =&gt; Boolean)Int</span><a id="7231">findIndexOf</a></span>(<span class="typed"><span class="type">TaskManager.this.ManagedTask</span><a href="#34168">_</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="#29378">interactive</a></span>)
		<span class="typed"><span class="type">(Boolean,=&gt; Any)Unit</span><span id="5972"><a id="802">require</a></span></span>(<span class="typed"><span class="type">Int</span><a href="#34154">interactiveDependencyIndex</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3124">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;Dependency (at index &quot;)</span><span class="string">&quot;Dependency (at index &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">Int</span><a href="#34154">interactiveDependencyIndex</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;) is interactive.  Interactive tasks cannot be dependencies.&quot;)</span><span class="string">&quot;) is interactive.  Interactive tasks cannot be dependencies.&quot;</span></span>)
	}
}

        </pre>
    </body>
</html>