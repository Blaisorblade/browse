<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/TaskManager.scala</title>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2008 David MacIver, Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">trait</span> <a title="trait Described extends java.lang.Object with NotNull" id="6242">Described</a> <span class="keyword">extends</span> <a title="NotNull" id="187">NotNull</a>
{
	<span class="keyword">def</span> <a title="=&gt; Option[String]" id="27995">description</a>: <a title="Option[String]" id="871">Option</a>[String]
}
<span class="keyword">trait</span> <a title="trait TaskManager extends java.lang.Object with ScalaObject" id="6243">TaskManager</a>{
	<span class="keyword">type</span> <a title="&gt;: TaskManager.this.type &lt;: sbt.TaskManager" id="26160">ManagerType</a> &gt;: <span class="keyword">this</span>.<span class="keyword">type</span> &lt;: TaskManager
	<span class="keyword">type</span> <a title="&gt;: TaskManager.this.Task &lt;: sbt.TaskManager#Task with sbt.Dag[TaskManager.this.ManagedTask]" id="26161">ManagedTask</a> &gt;: Task &lt;: TaskManager#Task <span class="keyword">with</span> Dag[ManagedTask]
	<span class="comment">/** Creates a task that executes the given action when invoked.*/</span>
	<span class="keyword">def</span> <a title="(=&gt; Option[String])TaskManager.this.Task" id="26162">task</a>(<a title="=&gt; Option[String]" id="28036">action</a> : =&gt; Option[String]) = <span title="TaskManager.this.Task" class="keyword">new</span> <a href="#26166" title="TaskManager.this.Task">Task</a>(<a title="object None" id="488">None</a>, <a title="object Nil" id="299">Nil</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#28036" title="=&gt; Option[String]">action</a>)
	<span class="comment">/** An interactive task is one that is not executed across all dependent projects when
	* it is called directly.  The dependencies of the task are still invoked across all dependent
	* projects, however. */</span>
	<span class="keyword">def</span> <a title="(=&gt; Option[String])TaskManager.this.Task" id="26163">interactiveTask</a>(<a title="=&gt; Option[String]" id="33096">action</a>: =&gt; Option[String]) = <span title="TaskManager.this.Task" class="keyword">new</span> <a href="#26166" title="TaskManager.this.Task">Task</a>(<a title="object None" id="488">None</a>, <a title="object Nil" id="299">Nil</a>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#33096" title="=&gt; Option[String]">action</a>)
	<span class="comment">/** Creates a method task that executes the given action when invoked. */</span>
	<span class="keyword">def</span> <a title="((Array[String]) =&gt; TaskManager.this.ManagedTask)TaskManager.this.MethodTask" id="26164">task</a>(<a title="(Array[String]) =&gt; TaskManager.this.ManagedTask" id="27993">action</a>: Array[String] =&gt; ManagedTask) = <span title="TaskManager.this.MethodTask" class="keyword">new</span> <a href="#26165" title="TaskManager.this.MethodTask">MethodTask</a>(<a title="object None" id="488">None</a>, <a href="#27993" title="(Array[String]) =&gt; TaskManager.this.ManagedTask">action</a>, <a title="object Nil" id="299">Nil</a>)
	
	<span class="comment">/** A method task is an action that has parameters.  Note that it is not a Task, though,
	* because it requires arguments to perform its work.  It therefore cannot be a dependency of
	* a Task..*/</span>
	<span class="keyword">final</span> <span class="keyword">class</span> <a title="class MethodTask extends java.lang.Object with sbt.Described with ScalaObject" id="26165">MethodTask</a>(<span class="keyword">val</span> <span id="28000"><span id="27999"><a title="Option[String]" id="28009">description</a></span></span>: <a title="Option[String]" id="871">Option</a>[String], <span id="28001"><a title="(Array[String]) =&gt; TaskManager.this.ManagedTask" id="28010">action</a></span>: Array[String] =&gt; ManagedTask, <span class="keyword">val</span> <span id="28003"><span id="28002"><a title="List[String]" id="28011">completions</a></span></span>: <a title="List[String]" id="481">List</a>[String]) <span class="keyword">extends</span> <a href="#6242" title="sbt.Described">Described</a>
	{
		<span class="comment">/** Creates a new method task, identical to this method task, except with thE[String]e given description.*/</span>
		<span class="keyword">def</span> <a title="(String)TaskManager.this.MethodTask" id="28005">describedAs</a>(<a title="String" id="33102">description</a> : <a title="String" id="1751">String</a>) = <span title="TaskManager.this.MethodTask" class="keyword">new</span> <a href="#26165" title="TaskManager.this.MethodTask">MethodTask</a>(<span id="10256"><a title="(String)Some[String]" id="275">Some</a></span>(<a href="#33102" title="String">description</a>), <a href="#28001" title="(Array[String]) =&gt; TaskManager.this.ManagedTask">action</a>, <a href="#28002" title="=&gt; List[String]">completions</a>)
		<span class="comment">/** Invokes this method task with the given arguments.*/</span>
		<span class="keyword">def</span> <a title="(Array[String])TaskManager.this.ManagedTask" id="28006">apply</a>(<a title="Array[String]" id="33105">arguments</a>: <a title="Array[String]" id="1003">Array</a>[String]) = <a href="#28001" title="(Array[String])TaskManager.this.ManagedTask" id="7221">action</a>(<a href="#33105" title="Array[String]">arguments</a>)
		<span class="keyword">def</span> <a title="=&gt; TaskManager.this.ManagerType" id="28007">manager</a>: <a href="#26160" title="TaskManager.this.ManagerType">ManagerType</a> = <a href="#6243" title="TaskManager.this.type">TaskManager</a>.<span class="keyword">this</span>
		<span class="keyword">def</span> <a title="(Iterable[String])TaskManager.this.MethodTask" id="28008">completeWith</a>(<a title="Iterable[String]" id="33108">add</a>: <a title="Iterable[String]" id="358">Iterable</a>[String]) = <span title="TaskManager.this.MethodTask" class="keyword">new</span> <a href="#26165" title="TaskManager.this.MethodTask">MethodTask</a>(<a href="#27999" title="=&gt; Option[String]">description</a>, <a href="#28001" title="(Array[String]) =&gt; TaskManager.this.ManagedTask">action</a>, (<a href="#33108" title="Iterable[String]">add</a> <a title="(Iterable[String])Collection[String]" id="7244">++</a> <a href="#28002" title="=&gt; List[String]">completions</a>).<a title="=&gt; List[String]" id="7279">toList</a>)
	}
	
	<span class="keyword">class</span> <a title="class Task extends java.lang.Object with sbt.Dag[TaskManager.this.ManagedTask] with sbt.Described with ScalaObject" id="26166">Task</a>(<span class="keyword">val</span> <span id="28019"><span id="28018"><a title="Option[String]" id="28038">description</a></span></span> : <a title="Option[String]" id="871">Option</a>[String], <span class="keyword">val</span> <span id="28021"><span id="28020"><a title="List[TaskManager.this.ManagedTask]" id="28039">dependencies</a></span></span> : <a title="List[TaskManager.this.ManagedTask]" id="481">List</a>[ManagedTask], <span class="keyword">val</span> <span id="28023"><span id="28022"><a title="Boolean" id="28040">interactive</a></span></span>: <a title="Boolean" id="2060">Boolean</a>,
		<span id="28024"><a title="=&gt; Option[String]" id="28041">action</a></span> : =&gt; Option[String]) <span class="keyword">extends</span> <a href="Dag.scala.html#6226" title="sbt.Dag[TaskManager.this.ManagedTask]">Dag</a>[ManagedTask] <span class="keyword">with</span> <a href="#6242" title="sbt.Described">Described</a>
	{
		<a href="#26167" title="(List[TaskManager.this.ManagedTask])Unit">checkTaskDependencies</a>(<a href="#28020" title="=&gt; List[TaskManager.this.ManagedTask]">dependencies</a>)
		<span class="keyword">def</span> <a title="=&gt; TaskManager.this.ManagerType" id="28026">manager</a>: <a href="#26160" title="TaskManager.this.ManagerType">ManagerType</a> = <a href="#6243" title="TaskManager.this.type">TaskManager</a>.<span class="keyword">this</span>
		
		<span class="comment">/** Creates a new task, identical to this task, except with the additional dependencies specified.*/</span>
		<span class="keyword">def</span> <a title="(TaskManager.this.ManagedTask*)TaskManager.this.Task" id="28027">dependsOn</a>(<a title="TaskManager.this.ManagedTask*" id="31074">tasks</a> : <a title="TaskManager.this.ManagedTask*" id="2631">ManagedTask</a>*) = <a href="#28028" title="(List[TaskManager.this.ManagedTask])TaskManager.this.Task">setDependencies</a>(<a href="#31074" title="TaskManager.this.ManagedTask*">tasks</a>.<a title="=&gt; List[TaskManager.this.ManagedTask]" id="7279">toList</a> <a href="#31080" title="(List[TaskManager.this.ManagedTask])List[TaskManager.this.ManagedTask]" id="6812">:::</a> <a href="#28020" title="=&gt; List[TaskManager.this.ManagedTask]">dependencies</a>)
		<span class="keyword">private</span>[sbt] <span class="keyword">def</span> <a title="(List[TaskManager.this.ManagedTask])TaskManager.this.Task" id="28028">setDependencies</a>(<a title="List[TaskManager.this.ManagedTask]" id="31076">dependencyList</a>: <a title="List[TaskManager.this.ManagedTask]" id="481">List</a>[ManagedTask]) =
		{
			<a href="#26167" title="(List[TaskManager.this.ManagedTask])Unit">checkTaskDependencies</a>(<a href="#31076" title="List[TaskManager.this.ManagedTask]">dependencyList</a>)
			<span title="TaskManager.this.Task" class="keyword">new</span> <a href="#26166" title="TaskManager.this.Task">Task</a>(<a href="#28018" title="=&gt; Option[String]">description</a>, <a href="#31076" title="List[TaskManager.this.ManagedTask]">dependencyList</a>, <a href="#28022" title="=&gt; Boolean">interactive</a>, <a href="#28024" title="=&gt; Option[String]">action</a>)
		}
		<span class="comment">/** Creates a new task, identical to this task, except with the given description.*/</span>
		<span class="keyword">def</span> <a title="(String)TaskManager.this.Task" id="28029">describedAs</a>(<a title="String" id="31034">description</a> : <a title="String" id="1751">String</a>) = <span title="TaskManager.this.Task" class="keyword">new</span> <a href="#26166" title="TaskManager.this.Task">Task</a>(<span id="10256"><a title="(String)Some[String]" id="275">Some</a></span>(<a href="#31034" title="String">description</a>), <a href="#28020" title="=&gt; List[TaskManager.this.ManagedTask]">dependencies</a>, <a href="#28022" title="=&gt; Boolean">interactive</a>, <a href="#28024" title="=&gt; Option[String]">action</a>);
		<span class="keyword">private</span>[sbt] <span class="keyword">def</span> <a title="=&gt; Option[String]" id="28030">invoke</a> = <a href="#28024" title="=&gt; Option[String]">action</a>;
	
		<span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; TaskManager.this.Task" id="28031">setInteractive</a> = <span title="TaskManager.this.Task" class="keyword">new</span> <a href="#26166" title="TaskManager.this.Task">Task</a>(<a href="#28018" title="=&gt; Option[String]">description</a>, <a href="#28020" title="=&gt; List[TaskManager.this.ManagedTask]">dependencies</a>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#28024" title="=&gt; Option[String]">action</a>)
		<span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; Option[String]" id="28032">run</a> = <a href="#28034" title="(List[TaskManager.this.ManagedTask])Option[String]">runSequentially</a>(<a href="Dag.scala.html#26240" title="=&gt; List[TaskManager.this.ManagedTask]">topologicalSort</a>)
		<span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; Option[String]" id="28033">runDependenciesOnly</a> = <a href="#28034" title="(List[TaskManager.this.ManagedTask])Option[String]">runSequentially</a>(<a href="Dag.scala.html#26240" title="=&gt; List[TaskManager.this.ManagedTask]">topologicalSort</a>.<a title="(Int)List[TaskManager.this.ManagedTask]" id="6828">dropRight</a>(<span title="Int(1)" class="int">1</span>))
		<span class="keyword">private</span> <span class="keyword">def</span> <a title="(List[TaskManager.this.ManagedTask])Option[String]" id="28034">runSequentially</a>(<a title="List[TaskManager.this.ManagedTask]" id="33124">tasks</a>: <a title="List[TaskManager.this.ManagedTask]" id="481">List</a>[ManagedTask]) = <a href="Control.scala.html#6605" title="object sbt.Control">Control</a>.<a href="Control.scala.html#10199" title="(List[TaskManager.this.ManagedTask])((TaskManager.this.ManagedTask) =&gt; Option[String])Option[String]">lazyFold</a>(<a href="#33124" title="List[TaskManager.this.ManagedTask]">tasks</a>)(<a href="#33137" title="TaskManager.this.ManagedTask">_</a>.<a href="#28030" title="=&gt; Option[String]">invoke</a>)
	
		<span class="keyword">def</span> <a title="(TaskManager.this.Task)TaskManager.this.Task" id="28035">&amp;&amp;</a>(<a title="TaskManager.this.Task" id="33140">that</a> : <a href="#26166" title="TaskManager.this.Task">Task</a>) =
			<span title="TaskManager.this.Task" class="keyword">new</span> <a href="#26166" title="TaskManager.this.Task">Task</a>(<a title="object None" id="488">None</a>, <a href="#28020" title="=&gt; List[TaskManager.this.ManagedTask]">dependencies</a> <a href="#33142" title="(List[TaskManager.this.ManagedTask])List[TaskManager.this.ManagedTask]" id="6812">:::</a> <a href="#33140" title="TaskManager.this.Task">that</a>.<a href="#28020" title="=&gt; List[TaskManager.this.ManagedTask]">dependencies</a>, <a href="#28022" title="=&gt; Boolean">interactive</a> <a title="(Boolean)Boolean" id="2640">||</a> <a href="#33140" title="TaskManager.this.Task">that</a>.<a href="#28022" title="=&gt; Boolean">interactive</a>, <a href="#26166" title="Task.this.type" class="keyword">this</a>.<a href="#28030" title="=&gt; Option[String]">invoke</a>.<a title="(=&gt; Option[String])Option[String]" id="10163">orElse</a>(<a href="#33140" title="TaskManager.this.Task">that</a>.<a href="#28030" title="=&gt; Option[String]">invoke</a>))
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(List[TaskManager.this.ManagedTask])Unit" id="26167">checkTaskDependencies</a>(<a title="List[TaskManager.this.ManagedTask]" id="31078">dependencyList</a>: <a title="List[TaskManager.this.ManagedTask]" id="481">List</a>[ManagedTask])
	{
		<span class="keyword">val</span> <a title="Int" id="33147">nullDependencyIndex</a> = <a href="#31078" title="List[TaskManager.this.ManagedTask]">dependencyList</a>.<a title="((TaskManager.this.ManagedTask) =&gt; Boolean)Int" id="7121">findIndexOf</a>(<a href="#33150" title="TaskManager.this.ManagedTask">_</a> <a title="(AnyRef)Boolean" id="3399">==</a> <span title="Null(null)" class="keyword">null</span>)
		<span id="5881"><a title="(Boolean,Any)Unit" id="770">require</a></span>(<a href="#33147" title="Int">nullDependencyIndex</a> <a title="(Int)Boolean" id="3033">&lt;</a> <span title="Int(0)" class="int">0</span>, <span title="java.lang.String(&quot;Dependency (at index &quot;)" class="string">&quot;Dependency (at index &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#33147" title="Int">nullDependencyIndex</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot;) is null.  This may be an initialization issue or a circular dependency.&quot;)" class="string">&quot;) is null.  This may be an initialization issue or a circular dependency.&quot;</span>)
		<span class="keyword">val</span> <a title="Int" id="33148">interactiveDependencyIndex</a> = <a href="#31078" title="List[TaskManager.this.ManagedTask]">dependencyList</a>.<a title="((TaskManager.this.ManagedTask) =&gt; Boolean)Int" id="7121">findIndexOf</a>(<a href="#33162" title="TaskManager.this.ManagedTask">_</a>.<a href="#28022" title="=&gt; Boolean">interactive</a>)
		<span id="5881"><a title="(Boolean,Any)Unit" id="770">require</a></span>(<a href="#33148" title="Int">interactiveDependencyIndex</a> <a title="(Int)Boolean" id="3033">&lt;</a> <span title="Int(0)" class="int">0</span>, <span title="java.lang.String(&quot;Dependency (at index &quot;)" class="string">&quot;Dependency (at index &quot;</span> <a title="(Any)java.lang.String" id="5683">+</a> <a href="#33148" title="Int">interactiveDependencyIndex</a> <a title="(Any)java.lang.String" id="5683">+</a> <span title="java.lang.String(&quot;) is interactive.  Interactive tasks cannot be dependencies.&quot;)" class="string">&quot;) is interactive.  Interactive tasks cannot be dependencies.&quot;</span>)
	}
}

        </pre>
    </body>
</html>