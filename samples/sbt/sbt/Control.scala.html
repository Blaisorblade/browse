<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/Control.scala</title>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2008, 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="comment">/** The trap methods execute the provided code in a try block and handle a thrown exception.*/</span>
<span class="keyword">object</span> <span class="typed"><span class="type">object sbt.Control</span><a id="6704">Control</a></span>
{
	<span class="keyword">def</span> <span class="typed"><span class="type">[T](=&gt; String,sbt.Logger)(=&gt; Either[String,T])Either[String,T]</span><a id="10292">trap</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="10294">T</a></span>](<span class="typed"><span class="type">=&gt; String</span><a id="30757">errorMessagePrefix</a></span>: =&gt; String, <span class="typed"><span class="type">sbt.Logger</span><a id="30758">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>)(<span class="typed"><span class="type">=&gt; Either[String,T]</span><a id="30759">execute</a></span>: =&gt; Either[String, T]): <span class="typed"><span class="type">Either[String,T]</span><a id="342">Either</a></span>[String, T] =
		<span class="keyword">try</span> { <span class="typed"><span class="type">=&gt; Either[String,T]</span><a href="#30759">execute</a></span> }
		<span class="keyword">catch</span> { <span class="typed"><span class="type">Left[java.lang.String,Nothing]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="56142">e</a></span> =&gt; <span class="typed"><span class="type">sbt.Logger</span><a href="#30758">log</a></span>.<span class="typed"><span class="type">(=&gt; Throwable)Unit</span><a href="Logger.scala.html#8465">trace</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#56142">e</a></span>); <span class="typed"><span class="type">(java.lang.String)Left[java.lang.String,Nothing]</span><span id="31304"><a id="1198">Left</a></span></span>(<span class="typed"><span class="type">=&gt; String</span><a href="#30757">errorMessagePrefix</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="#56142">e</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="9387">toString</a></span>) }
		
	<span class="keyword">def</span> <span class="typed"><span class="type">[T](=&gt; String,sbt.Logger)(=&gt; Either[String,T])(=&gt; Unit)Either[String,T]</span><a id="10295">trapAndFinally</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="10297">T</a></span>](<span class="typed"><span class="type">=&gt; String</span><a id="44322">errorMessagePrefix</a></span>: =&gt; String, <span class="typed"><span class="type">sbt.Logger</span><a id="44323">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>)(<span class="typed"><span class="type">=&gt; Either[String,T]</span><a id="44324">execute</a></span>: =&gt; Either[String, T])(<span class="typed"><span class="type">=&gt; Unit</span><a id="44325">doFinally</a></span>: =&gt; Unit): <span class="typed"><span class="type">Either[String,T]</span><a id="342">Either</a></span>[String, T] =
		<span class="keyword">try</span> { <span class="typed"><span class="type">=&gt; Either[String,T]</span><a href="#44324">execute</a></span> }
		<span class="keyword">catch</span> { <span class="typed"><span class="type">Left[java.lang.String,Nothing]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="56145">e</a></span> =&gt; <span class="typed"><span class="type">sbt.Logger</span><a href="#44323">log</a></span>.<span class="typed"><span class="type">(=&gt; Throwable)Unit</span><a href="Logger.scala.html#8465">trace</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#56145">e</a></span>); <span class="typed"><span class="type">(java.lang.String)Left[java.lang.String,Nothing]</span><span id="31304"><a id="1198">Left</a></span></span>(<span class="typed"><span class="type">=&gt; String</span><a href="#44322">errorMessagePrefix</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="#56145">e</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="9387">toString</a></span>) }
		<span class="keyword">finally</span> { <span class="typed"><span class="type">(sbt.Logger)(=&gt; Unit)Unit</span><a href="#10301">trapAndLog</a></span>(<span class="typed"><span class="type">sbt.Logger</span><a href="#44323">log</a></span>)(<span class="typed"><span class="type">=&gt; Unit</span><a href="#44325">doFinally</a></span>) }
		
	<span class="keyword">def</span> <span class="typed"><span class="type">(=&gt; String,sbt.Logger)(=&gt; Option[String])Option[String]</span><a id="10298">trapUnit</a></span>(<span class="typed"><span class="type">=&gt; String</span><a id="10319">errorMessagePrefix</a></span>: =&gt; String, <span class="typed"><span class="type">sbt.Logger</span><a id="10320">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>)(<span class="typed"><span class="type">=&gt; Option[String]</span><a id="10321">execute</a></span>: =&gt; Option[String]): <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String] =
		<span class="keyword">try</span> { <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#10321">execute</a></span> }
		<span class="keyword">catch</span> { <span class="typed"><span class="type">Some[java.lang.String]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="56148">e</a></span> =&gt; <span class="typed"><span class="type">sbt.Logger</span><a href="#10320">log</a></span>.<span class="typed"><span class="type">(=&gt; Throwable)Unit</span><a href="Logger.scala.html#8465">trace</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#56148">e</a></span>); <span class="typed"><span class="type">(java.lang.String)Some[java.lang.String]</span><span id="10375"><a id="289">Some</a></span></span>(<span class="typed"><span class="type">=&gt; String</span><a href="#10319">errorMessagePrefix</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="#56148">e</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="9387">toString</a></span>) }
		
	<span class="keyword">def</span> <span class="typed"><span class="type">(=&gt; String,sbt.Logger)(=&gt; Option[String])(=&gt; Unit)Option[String]</span><a id="10299">trapUnitAndFinally</a></span>(<span class="typed"><span class="type">=&gt; String</span><a id="33320">errorMessagePrefix</a></span>: =&gt; String, <span class="typed"><span class="type">sbt.Logger</span><a id="33321">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>)(<span class="typed"><span class="type">=&gt; Option[String]</span><a id="33322">execute</a></span>: =&gt; Option[String])(<span class="typed"><span class="type">=&gt; Unit</span><a id="33323">doFinally</a></span>: =&gt; Unit): <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String] =
		<span class="keyword">try</span> { <span class="typed"><span class="type">=&gt; Option[String]</span><a href="#33322">execute</a></span> }
		<span class="keyword">catch</span> { <span class="typed"><span class="type">Some[java.lang.String]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="56150">e</a></span> =&gt; <span class="typed"><span class="type">sbt.Logger</span><a href="#33321">log</a></span>.<span class="typed"><span class="type">(=&gt; Throwable)Unit</span><a href="Logger.scala.html#8465">trace</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#56150">e</a></span>); <span class="typed"><span class="type">(java.lang.String)Some[java.lang.String]</span><span id="10375"><a id="289">Some</a></span></span>(<span class="typed"><span class="type">=&gt; String</span><a href="#33320">errorMessagePrefix</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="#56150">e</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="9387">toString</a></span>) }
		<span class="keyword">finally</span> { <span class="typed"><span class="type">(sbt.Logger)(=&gt; Unit)Unit</span><a href="#10301">trapAndLog</a></span>(<span class="typed"><span class="type">sbt.Logger</span><a href="#33321">log</a></span>)(<span class="typed"><span class="type">=&gt; Unit</span><a href="#33323">doFinally</a></span>) }
		
	<span class="keyword">def</span> <span class="typed"><span class="type">(=&gt; Unit)Unit</span><a id="10300">trap</a></span>(<span class="typed"><span class="type">=&gt; Unit</span><a id="30752">execute</a></span>: =&gt; Unit)
	{
		<span class="keyword">try</span> { <span class="typed"><span class="type">=&gt; Unit</span><a href="#30752">execute</a></span> }
		<span class="keyword">catch</span> { <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Exception</span><a id="56152">e</a></span>: <span class="typed"><span class="type">Exception</span><a id="2112">Exception</a></span> =&gt; <span class="typed"><span class="type">Unit</span><span >(</span></span>) }
	}
	<span class="keyword">def</span> <span class="typed"><span class="type">(sbt.Logger)(=&gt; Unit)Unit</span><a id="10301">trapAndLog</a></span>(<span class="typed"><span class="type">sbt.Logger</span><a id="26994">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>)(<span class="typed"><span class="type">=&gt; Unit</span><a id="26995">execute</a></span>: =&gt; Unit)
	{
		<span class="keyword">try</span> { <span class="typed"><span class="type">=&gt; Unit</span><a href="#26995">execute</a></span> }
		<span class="keyword">catch</span> { <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="56153">e</a></span> =&gt; <span class="typed"><span class="type">sbt.Logger</span><a href="#26994">log</a></span>.<span class="typed"><span class="type">(=&gt; Throwable)Unit</span><a href="Logger.scala.html#8465">trace</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#56153">e</a></span>); <span class="typed"><span class="type">sbt.Logger</span><a href="#26994">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8469">error</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#56153">e</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="9387">toString</a></span>) }
	}
	<span class="keyword">def</span> <span class="typed"><span class="type">[T](=&gt; T)Either[Exception,T]</span><a id="10302">convertException</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="10304">T</a></span>](<span class="typed"><span class="type">=&gt; T</span><a id="56154">t</a></span>: =&gt; T): <span class="typed"><span class="type">Either[Exception,T]</span><a id="342">Either</a></span>[Exception, T] =
	{
		<span class="keyword">try</span> { <span class="typed"><span class="type">(T)Right[Nothing,T]</span><span id="30775"><a id="502">Right</a></span></span>(<span class="typed"><span class="type">=&gt; T</span><a href="#56154">t</a></span>) }
		<span class="keyword">catch</span> { <span class="typed"><span class="type">Left[Exception,Nothing]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Exception</span><a id="56157">e</a></span>: <span class="typed"><span class="type">Exception</span><a id="2112">Exception</a></span> =&gt; <span class="typed"><span class="type">(Exception)Left[Exception,Nothing]</span><span id="31304"><a id="1198">Left</a></span></span>(<span class="typed"><span class="type">Exception</span><a href="#56157">e</a></span>) }
	}
	<span class="keyword">def</span> <span class="typed"><span class="type">[T](sbt.Logger)(=&gt; T)Either[String,T]</span><a id="10305">convertErrorMessage</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="10307">T</a></span>](<span class="typed"><span class="type">sbt.Logger</span><a id="56160">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>)(<span class="typed"><span class="type">=&gt; T</span><a id="56161">t</a></span>: =&gt; T): <span class="typed"><span class="type">Either[String,T]</span><a id="342">Either</a></span>[String, T] =
	{
		<span class="keyword">try</span> { <span class="typed"><span class="type">(T)Right[Nothing,T]</span><span id="30775"><a id="502">Right</a></span></span>(<span class="typed"><span class="type">=&gt; T</span><a href="#56161">t</a></span>) }
		<span class="keyword">catch</span> { <span class="typed"><span class="type">Left[java.lang.String,Nothing]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Exception</span><a id="56164">e</a></span>: <span class="typed"><span class="type">Exception</span><a id="2112">Exception</a></span> =&gt; <span class="typed"><span class="type">sbt.Logger</span><a href="#56160">log</a></span>.<span class="typed"><span class="type">(=&gt; Throwable)Unit</span><a href="Logger.scala.html#8465">trace</a></span>(<span class="typed"><span class="type">Exception</span><a href="#56164">e</a></span>); <span class="typed"><span class="type">(java.lang.String)Left[java.lang.String,Nothing]</span><span id="31304"><a id="1198">Left</a></span></span>(<span class="typed"><span class="type">Exception</span><a href="#56164">e</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="9387">toString</a></span>) }
	}
	<span class="keyword">final</span> <span class="keyword">def</span> <span class="typed"><span class="type">[T](List[T])((T) =&gt; Option[String])Option[String]</span><a id="10308">lazyFold</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="10310">T</a></span>](<span class="typed"><span class="type">List[T]</span><a id="34138">list</a></span>: <span class="typed"><span class="type">List[T]</span><a id="507">List</a></span>[T])(<span class="typed"><span class="type">(T) =&gt; Option[String]</span><a id="34139">f</a></span>: T =&gt; Option[String]): <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String] =
		<span class="typed"><span class="type">List[T]</span><a href="#34138">list</a></span> <span class="typed"><span class="type">Option[String]</span><span class="keyword">match</span></span>
		{
			<span class="typed"><span class="type">None.type</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object Nil</span><a id="316">Nil</a></span> =&gt; <span class="typed"><span class="type">object None</span><a id="517">None</a></span>
			<span class="typed"><span class="type">Option[String]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">T</span><a id="56167">head</a></span> <a id="1">::</a> <span class="typed"><span class="type">List[T]</span><a id="56168">tail</a></span> =&gt;
				<span class="typed"><span class="type">(T)Option[String]</span><a href="#34139" id="7330">f</a></span>(<span class="typed"><span class="type">T</span><a href="#56167">head</a></span>) <span class="typed"><span class="type">Option[String]</span><span class="keyword">match</span></span>
				{
					<span class="typed"><span class="type">Option[String]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a id="517">None</a></span> =&gt; <span class="typed"><span class="type">(List[T])((T) =&gt; Option[String])Option[String]</span><a href="#10308">lazyFold</a></span>(<span class="typed"><span class="type">List[T]</span><a href="#56168">tail</a></span>)(<span class="typed"><span class="type">(T) =&gt; Option[String]</span><a href="#34139">f</a></span>)
					<span class="typed"><span class="type">Option[String]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Option[String]</span><a id="56174">x</a></span> =&gt; <span class="typed"><span class="type">Option[String]</span><a href="#56174">x</a></span>
				}
		}
	<span class="keyword">final</span> <span class="keyword">def</span> <span class="typed"><span class="type">[T, S](List[T],S)((S, T) =&gt; Either[String,S])Either[String,S]</span><a id="10311">lazyFold</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="10314">T</a></span>, <span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="10315">S</a></span>](<span class="typed"><span class="type">List[T]</span><a id="34133">list</a></span>: <span class="typed"><span class="type">List[T]</span><a id="507">List</a></span>[T], <span class="typed"><span class="type">S</span><a id="34134">value</a></span>: <span class="typed"><span class="type">S</span><a href="#10315">S</a></span>)(<span class="typed"><span class="type">(S, T) =&gt; Either[String,S]</span><a id="34135">f</a></span>: (S,T) =&gt; Either[String, S]): <span class="typed"><span class="type">Either[String,S]</span><a id="342">Either</a></span>[String, S] =
		<span class="typed"><span class="type">List[T]</span><a href="#34133">list</a></span> <span class="typed"><span class="type">Either[String,S]</span><span class="keyword">match</span></span>
		{
			<span class="typed"><span class="type">Right[Nothing,S]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object Nil</span><a id="316">Nil</a></span> =&gt; <span class="typed"><span class="type">(S)Right[Nothing,S]</span><span id="30775"><a id="502">Right</a></span></span>(<span class="typed"><span class="type">S</span><a href="#34134">value</a></span>)
			<span class="typed"><span class="type">Either[String,S]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">T</span><a id="56177">head</a></span> <a id="1">::</a> <span class="typed"><span class="type">List[T]</span><a id="56178">tail</a></span> =&gt;
				<span class="typed"><span class="type">(S,T)Either[String,S]</span><a href="#34135" id="12397">f</a></span>(<span class="typed"><span class="type">S</span><a href="#34134">value</a></span>, <span class="typed"><span class="type">T</span><a href="#56177">head</a></span>) <span class="typed"><span class="type">Either[String,S]</span><span class="keyword">match</span></span>
				{
					<span class="typed"><span class="type">Either[String,S]</span><span class="keyword">case</span></span> <a id="1">Right</a>(<span class="typed"><span class="type">S</span><a id="56179">newValue</a></span>) =&gt; <span class="typed"><span class="type">(List[T],S)((S, T) =&gt; Either[String,S])Either[String,S]</span><a href="#10311">lazyFold</a></span>(<span class="typed"><span class="type">List[T]</span><a href="#56178">tail</a></span>, <span class="typed"><span class="type">S</span><a href="#56179">newValue</a></span>)(<span class="typed"><span class="type">(S, T) =&gt; Either[String,S]</span><a href="#34135">f</a></span>)
					<span class="typed"><span class="type">Either[String,S]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Either[String,S]</span><a id="56197">x</a></span> =&gt; <span class="typed"><span class="type">Either[String,S]</span><a href="#56197">x</a></span>
				}
		}
	<span class="keyword">def</span> <span class="typed"><span class="type">[T](Either[String,T])((T) =&gt; Option[String])Option[String]</span><a id="10316">thread</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="10318">T</a></span>](<span class="typed"><span class="type">Either[String,T]</span><a id="51817">e</a></span>: <span class="typed"><span class="type">Either[String,T]</span><a id="342">Either</a></span>[String, T])(<span class="typed"><span class="type">(T) =&gt; Option[String]</span><a id="51818">f</a></span>: T =&gt; Option[String]): <span class="typed"><span class="type">Option[String]</span><a id="915">Option</a></span>[String] =
		<span class="typed"><span class="type">Either[String,T]</span><a href="#51817">e</a></span>.<span class="typed"><span class="type">=&gt; Either.RightProjection[String,T]</span><a id="23106">right</a></span>.<span class="typed"><span class="type">((T) =&gt; Either[String,Unit])Either[String,Unit]</span><a id="23071">flatMap</a></span>( <span class="typed"><span class="type">T</span><a id="56203">t</a></span> =&gt; <span class="typed"><span class="type">(T)Option[String]</span><a href="#51818" id="7330">f</a></span>(<span class="typed"><span class="type">T</span><a href="#56203">t</a></span>).<span class="typed"><span class="type">(=&gt; Unit)Either[String,Unit] with Product</span><a id="10278">toLeft</a></span>(<span class="typed"><span class="type">Unit</span><span >(</span></span>)) ).<span class="typed"><span class="type">=&gt; Either.LeftProjection[String,Unit]</span><a id="23012">left</a></span>.<span class="typed"><span class="type">=&gt; Option[String]</span><a id="23043">toOption</a></span>
}
        </pre>
    </body>
</html>