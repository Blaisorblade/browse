<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>sbt/ExitHook.scala</title>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="comment">/** Defines a function to call as sbt exits.*/</span>
<span class="keyword">trait</span> <span class="typed"><span class="type">trait ExitHook extends java.lang.Object with NotNull</span><a id="6694">ExitHook</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">NotNull</span><a id="186">NotNull</a></span>
{
	<span class="comment">/** Provides a name for this hook to be used to provide feedback to the user. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">=&gt; String</span><a id="56066">name</a></span>: <span class="typed"><span class="type">String</span><a id="1842">String</a></span>
	<span class="comment">/** Subclasses should implement this method, which is called when this hook is executed. */</span>
	<span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="56067">runBeforeExiting</a></span>(): <span class="typed"><span class="type">Unit</span><a id="2150">Unit</a></span>
}

<span class="keyword">object</span> <span class="typed"><span class="type">object sbt.ExitHooks</span><a id="6695">ExitHooks</a></span>
{
	<span class="comment">/** This is a list of hooks to call when sbt is finished executing.*/</span>
	<span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[sbt.ExitHook]</span><span id="53548"><a id="53547">exitHooks</a></span></span> = <span class="typed"><span class="type">scala.collection.mutable.HashSet[sbt.ExitHook]</span><span class="keyword">new</span></span> scala.collection.mutable.<span class="typed"><span class="type">scala.collection.mutable.HashSet[sbt.ExitHook]</span><a id="8018">HashSet</a></span>[ExitHook]
	<span class="comment">/** Adds a hook to call before sbt exits. */</span>
	<span class="keyword">private</span>[sbt] <span class="keyword">def</span> <span class="typed"><span class="type">(sbt.ExitHook)Unit</span><a id="53549">register</a></span>(<span class="typed"><span class="type">sbt.ExitHook</span><a id="56071">hook</a></span>: <span class="typed"><span class="type">sbt.ExitHook</span><a href="#6694">ExitHook</a></span>) { <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[sbt.ExitHook]</span><a href="#53547">exitHooks</a></span> <span class="typed"><span class="type">(sbt.ExitHook)Unit</span><a id="22726">+=</a></span> <span class="typed"><span class="type">sbt.ExitHook</span><a href="#56071">hook</a></span> }
	<span class="comment">/** Removes a hook. */</span>
	<span class="keyword">private</span>[sbt] <span class="keyword">def</span> <span class="typed"><span class="type">(sbt.ExitHook)Unit</span><a id="53550">unregister</a></span>(<span class="typed"><span class="type">sbt.ExitHook</span><a id="56073">hook</a></span>: <span class="typed"><span class="type">sbt.ExitHook</span><a href="#6694">ExitHook</a></span>) { <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[sbt.ExitHook]</span><a href="#53547">exitHooks</a></span> <span class="typed"><span class="type">(sbt.ExitHook)Unit</span><a id="22727">-=</a></span> <span class="typed"><span class="type">sbt.ExitHook</span><a href="#56073">hook</a></span> }
	<span class="comment">/** Calls each registered exit hook, trapping any exceptions so that each hook is given a chance to run. */</span>
	<span class="keyword">private</span>[sbt] <span class="keyword">def</span> <span class="typed"><span class="type">(sbt.Logger)Unit</span><a id="53551">runExitHooks</a></span>(<span class="typed"><span class="type">sbt.Logger</span><a id="53552">log</a></span>: <span class="typed"><span class="type">sbt.Logger</span><a href="Logger.scala.html#6766">Logger</a></span>)
	{
		<span class="keyword">for</span>(<span class="typed"><span class="type">((sbt.ExitHook) =&gt; Unit)Unit</span><span id="6939"><a id="56077">hook</a></span></span> &lt;- <span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[sbt.ExitHook]</span><a href="#53547">exitHooks</a></span>.<span class="typed"><span class="type">=&gt; List[sbt.ExitHook]</span><a id="7388">toList</a></span>)
		{
			<span class="keyword">try</span>
			{
				<span class="typed"><span class="type">sbt.Logger</span><a href="#53552">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8466">debug</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Running exit hook '&quot;)</span><span class="string">&quot;Running exit hook '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">sbt.ExitHook</span><a href="#56077">hook</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#56066">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;'...&quot;)</span><span class="string">&quot;'...&quot;</span></span>)
				<span class="typed"><span class="type">sbt.ExitHook</span><a href="#56077">hook</a></span>.<span class="typed"><span class="type">()Unit</span><a href="#56067">runBeforeExiting</a></span>()
			}
			<span class="keyword">catch</span>
			{
				<span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="56078">e</a></span> =&gt;
				{
					<span class="typed"><span class="type">sbt.Logger</span><a href="#53552">log</a></span>.<span class="typed"><span class="type">(=&gt; Throwable)Unit</span><a href="Logger.scala.html#8465">trace</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#56078">e</a></span>);
					<span class="typed"><span class="type">sbt.Logger</span><a href="#53552">log</a></span>.<span class="typed"><span class="type">(=&gt; String)Unit</span><a href="Logger.scala.html#8469">error</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Error running exit hook '&quot;)</span><span class="string">&quot;Error running exit hook '&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">sbt.ExitHook</span><a href="#56077">hook</a></span>.<span class="typed"><span class="type">=&gt; String</span><a href="#56066">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;': &quot;)</span><span class="string">&quot;': &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5774">+</a></span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="#56078">e</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="9387">toString</a></span>)
				}
			}
		}
	}
}
        </pre>
    </body>
</html>