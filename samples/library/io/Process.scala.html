<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>io/Process.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

<span class="keyword">package</span> scala.io

<span class="keyword">import</span> annotation.experimental
<span class="keyword">import</span> concurrent.ThreadRunner
<span class="keyword">import</span> util.Properties.{ isWin, isMac }
<span class="keyword">import</span> util.control.Exception.catching
<span class="keyword">import</span> java.lang.{ Process =&gt; JProcess, ProcessBuilder =&gt; JProcessBuilder }
<span class="keyword">import</span> java.io.{ IOException, InputStream, OutputStream, BufferedReader, InputStreamReader, PrintWriter, File =&gt; JFile }
<span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue

/** The &lt;code&gt;Process&lt;/code&gt; object contains convenience functions
 *  for running external processes.
 *
 *  An example usage:
 *  &lt;pre&gt;
 *    io.Process(&quot;ls&quot;, cwd = io.File(&quot;/&quot;)) foreach println
 *  &lt;/pre&gt;
 *
 *  See http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4109888
 *  for a dated list of the many obstacles to a clean interface.
 *
 *  This is not finished!! Do not rely upon it yet.
 * 
 *  TODO - remove requirement that process complete before we 
 *  can get an iterator.
 *
 *  @author   Paul Phillips
 *  @since    2.8
 */
 
@experimental
<span class="keyword">object</span> <a title="object scala.io.Process" id="9665">Process</a>
<a href="../ScalaObject.scala.html#957" title="ScalaObject">{</a>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.util.List[java.lang.String]" id="73365">javaVmArguments</a> = java.lang.management.<a title="object java.lang.management.ManagementFactory" id="73445">ManagementFactory</a>.<a title="()java.lang.management.RuntimeMXBean" id="73474">getRuntimeMXBean</a>().<a title="()java.util.List[java.lang.String]" id="73798">getInputArguments</a>()
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.lang.Runtime" id="73367">runtime</a> = <a title="object java.lang.Runtime" id="1496">Runtime</a>.<a title="()java.lang.Runtime" id="73885">getRuntime</a>()
  
  @experimental
  <span class="keyword">private</span>[Process] <span class="keyword">class</span> <a title="class ProcessBuilder extends java.lang.Object with ScalaObject" id="73368">ProcessBuilder</a><a href="../ScalaObject.scala.html#957" title="ScalaObject">(</a><span class="keyword">val</span> <a title="java.lang.ProcessBuilder" id="73988">pb</a>: <span title="java.lang.ProcessBuilder">JProcessBuilder</span>)
  {
    <span class="keyword">def</span> <a title="(cmd: String*)scala.io.Process.ProcessBuilder" id="73949" class="keyword">this</a>(<a title="String*" id="73993">cmd</a>: <a title="String*" id="4176">String</a>*) = <a href="#73368" title="ProcessBuilder.this.type" class="keyword">this</a>(<a title="(x$1: java.lang.String*)java.lang.ProcessBuilder" id="73963" class="keyword">new</a> <span title="java.lang.ProcessBuilder">JProcessBuilder</span>(<a href="#73993" title="String*">cmd</a>.<a href="../collection/generic/TraversableTemplate.scala.html#17233" title="(implicit evidence$1: scala.reflect.ClassManifest[String])Array[String]">toArray</a>: _*))
    <span class="keyword">def</span> <a title="()scala.io.Process" id="73950">start</a>() = <span title="scala.io.Process" class="keyword">new</span> <a href="#9664" title="scala.io.Process">Process</a>(() =&gt; <a href="#73988" title="=&gt; java.lang.ProcessBuilder">pb</a>.<a title="()java.lang.Process" id="73986">start</a>())

    <span class="keyword">def</span> <a title="(env: Map[String,String])ProcessBuilder.this.type" id="73951">withOnlyEnv</a>(<a title="Map[String,String]" id="74036">env</a>: <a href="../collection/immutable/Map.scala.html#8874" title="Map[String,String]">Map</a>[String, String]): <span class="keyword">this</span>.<span class="keyword">type</span> = {
      <a href="#73988" title="=&gt; java.lang.ProcessBuilder">pb</a>.<span title="()java.util.Map[java.lang.String,java.lang.String]">environment</span>.<a title="()Unit" id="45175">clear</a>()
      <a href="#73952" title="(env: Map[String,String])ProcessBuilder.this.type">withEnv</a>(<a href="#74036" title="Map[String,String]">env</a>)
    }

    <span class="keyword">def</span> <a title="(env: Map[String,String])ProcessBuilder.this.type" id="73952">withEnv</a>(<a title="Map[String,String]" id="74043">env</a>: <a href="../collection/immutable/Map.scala.html#8874" title="Map[String,String]">Map</a>[String,String]): <span class="keyword">this</span>.<span class="keyword">type</span> = {
      <span title="Unit" class="keyword">if</span> (<a href="#74043" title="(x$1: AnyRef)Boolean">env</a> != <span title="Null(null)" class="keyword">null</span>) {
        <span class="keyword">val</span> <a title="java.util.Map[java.lang.String,java.lang.String]" id="74053">jmap</a> = <a href="#73988" title="=&gt; java.lang.ProcessBuilder">pb</a>.<span title="()java.util.Map[java.lang.String,java.lang.String]">environment</span>()
        <span class="keyword">for</span> (<a id="1">(</a><a title="String" id="74086">k</a>, <a title="String" id="74087">v</a>) &lt;- <a href="../collection/generic/IterableTemplate.scala.html#17287" title="(f: ((String, String)) =&gt; java.lang.String)Unit">env</a>) <a href="#74053" title="java.util.Map[java.lang.String,java.lang.String]">jmap</a>.<a title="(x$1: java.lang.String,x$2: java.lang.String)java.lang.String" id="45160">put</a>(<a href="#74086" title="String">k</a>, <a href="#74087" title="String">v</a>)
      }
      <a href="#73368" title="ProcessBuilder.this.type" class="keyword">this</a>
    }

    <span class="keyword">def</span> <a title="(cwd: scala.io.File)ProcessBuilder.this.type" id="73953">withCwd</a>(<a title="scala.io.File" id="74097">cwd</a>: <a href="File.scala.html#9637" title="scala.io.File">File</a>): <span class="keyword">this</span>.<span class="keyword">type</span> = {
      <span title="Any" class="keyword">if</span> (<a href="#74097" title="(x$1: AnyRef)Boolean">cwd</a> != <span title="Null(null)" class="keyword">null</span>)
        <a href="#73988" title="(x$1: java.io.File)java.lang.ProcessBuilder" id="73981">pb</a> directory <a href="#74097" title="scala.io.File">cwd</a>.<a href="Path.scala.html#32597" title="=&gt; java.io.File">jfile</a>

      <a href="#73368" title="ProcessBuilder.this.type" class="keyword">this</a>
    }
    <span class="keyword">def</span> <a title="(merged: Boolean)ProcessBuilder.this.type" id="73954">withRedirectedErrorStream</a>(<a title="Boolean" id="74115">merged</a>: <span title="Boolean">Boolean</span>): <span class="keyword">this</span>.<span class="keyword">type</span> = {
      <a href="#73988" title="(x$1: Boolean)java.lang.ProcessBuilder" id="73984">pb</a> redirectErrorStream <a href="#74115" title="Boolean">merged</a>
      <a href="#73368" title="ProcessBuilder.this.type" class="keyword">this</a>
    }

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="73955">toString</a>() = <a href="../runtime/RichString.scala.html#18060" title="(args: Any*)String" class="string">&quot;ProcessBuilder(%s)&quot;</a> format <a href="#73988" title="=&gt; java.lang.ProcessBuilder">pb</a>.<a title="()java.util.List[java.lang.String]" id="73973">command</a>()
  }
  
  // This can be fleshed out if more variations come up
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="(String) =&gt; Array[String]" id="73369">shell</a>: String =&gt; Array[String] =
    <span title="(String) =&gt; Array[String]" class="keyword">if</span> (<a href="../util/Properties.scala.html#73332" title="=&gt; Boolean">isWin</a>) <a href="../Array.scala.html#29218" title="(xs: String*)(implicit evidence$2: scala.reflect.ClassManifest[String])Array[String]">Array</a><a href="../reflect/ClassManifest.scala.html#26236" title="(clazz: Class[_])scala.reflect.ClassManifest[String]">(</a><span title="java.lang.String(&quot;cmd.exe&quot;)" class="string">&quot;cmd.exe&quot;</span>, <span title="java.lang.String(&quot;/C&quot;)" class="string">&quot;/C&quot;</span>, <a href="#74175" title="String">_</a>)
    <span class="keyword">else</span> <a href="../Array.scala.html#29218" title="(xs: String*)(implicit evidence$2: scala.reflect.ClassManifest[String])Array[String]">Array</a><a href="../reflect/ClassManifest.scala.html#26236" title="(clazz: Class[_])scala.reflect.ClassManifest[String]">(</a><span title="java.lang.String(&quot;sh&quot;)" class="string">&quot;sh&quot;</span>, <span title="java.lang.String(&quot;-c&quot;)" class="string">&quot;-c&quot;</span>, <a href="#74471" title="String">_</a>)
  
  /** Executes the given command line in a shell.
   *
   *  @param    command   the command line
   *  @return             a Process object
   */
  <span class="keyword">def</span> <a title="(command: String,env: Map[String,String],cwd: scala.io.File,redirect: Boolean)scala.io.Process" id="73371">apply</a>(
    <a title="String" id="74536">command</a>: <a title="String" id="1603">String</a>,
    <a title="Map[String,String]" id="74541">env</a>: <a href="../collection/immutable/Map.scala.html#8874" title="Map[String,String]">Map</a>[String, String] = <span title="Null(null)" class="keyword">null</span>,
    <a title="scala.io.File" id="74542">cwd</a>: <a href="File.scala.html#9637" title="scala.io.File">File</a> = <span title="Null(null)" class="keyword">null</span>,
    <a title="Boolean" id="74543">redirect</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>
  ): <a href="#9664" title="scala.io.Process">Process</a> =
      <a href="#73372" title="(command: Seq[String],env: Map[String,String],cwd: scala.io.File,redirect: Boolean)scala.io.Process">exec</a>(<a href="../Function1.scala.html#17119" title="(v1: String)Array[String]">shell</a>(<a href="#74536" title="String">command</a>), <a href="#74541" title="Map[String,String]">env</a>, <a href="#74542" title="scala.io.File">cwd</a>)

  /** Executes the given command line.
   *
   *  @param    command   the command line
   *  @return             a Process object
   */
  <span class="keyword">def</span> <a title="(command: Seq[String],env: Map[String,String],cwd: scala.io.File,redirect: Boolean)scala.io.Process" id="73372">exec</a>(
    <a title="Seq[String]" id="74544">command</a>: <a href="../collection/Sequence.scala.html#4346" title="Seq[String]">Seq</a>[String],
    <a title="Map[String,String]" id="74549">env</a>: <a href="../collection/immutable/Map.scala.html#8874" title="Map[String,String]">Map</a>[String, String] = <span title="Null(null)" class="keyword">null</span>,
    <a title="scala.io.File" id="74550">cwd</a>: <a href="File.scala.html#9637" title="scala.io.File">File</a> = <span title="Null(null)" class="keyword">null</span>,
    <a title="Boolean" id="74551">redirect</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>
  ): <a href="#9664" title="scala.io.Process">Process</a> =
      <a href="#73952" title="(env: scala.collection.immutable.Map[java.lang.String,java.lang.String])scala.io.Process.ProcessBuilder" class="keyword">new</a> <a href="#73368" title="scala.io.Process.ProcessBuilder">ProcessBuilder</a>(<a href="#74544" title="Seq[String]">command</a>: _*) <a href="#73953" title="(cwd: scala.io.File)scala.io.Process.ProcessBuilder">withEnv</a> <a href="#74549" title="Map[String,String]">env</a> withCwd <a href="#74550" title="scala.io.File">cwd</a> <a href="#73950" title="()scala.io.Process">start</a>
}
<span class="keyword">import</span> Process._

@experimental
<span class="keyword">class</span> <a title="class Process extends java.lang.Object with Iterable[String] with ScalaObject" id="9664">Process</a><a href="../ScalaObject.scala.html#957" title="ScalaObject">(</a><a title="() =&gt; java.lang.Process" id="73396">processCreator</a>: () =&gt; JProcess) <span class="keyword">extends</span> <a href="../collection/Iterable.scala.html#4460" title="Iterable[String]">Iterable</a>[String]
{
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.lang.Process" id="73377">process</a> = <a href="../Function0.scala.html#34096" title="()java.lang.Process">processCreator</a>()
  
  <span class="keyword">def</span> <a title="()Option[Int]" id="73378">exitValue</a>(): <a href="../Option.scala.html#777" title="Option[Int]">Option</a>[Int] =
    <a href="../util/control/Exception.scala.html#31240" title="(exceptions: Class[_]*)util.control.Exception.Catch[Nothing]">catching</a><a href="../util/control/Exception.scala.html#47482" title="(body: =&gt; Int)Option[Int]">(</a>classOf<span title="java.lang.Class[java.lang.IllegalThreadStateException]">[</span>IllegalThreadStateException]) opt <a href="#73376" title="=&gt; java.lang.Process">process</a>.<a title="()Int" id="73402">exitValue</a>()
    
  <span class="keyword">def</span> <a title="()Int" id="73379">waitFor</a>() = <a href="#73376" title="=&gt; java.lang.Process">process</a>.<a title="()Int" id="73401">waitFor</a>()
  <span class="keyword">def</span> <a title="()Unit" id="73380">destroy</a>() = <a href="#73376" title="=&gt; java.lang.Process">process</a>.<a title="()Unit" id="73403">destroy</a>()
  <span class="keyword">def</span> <a title="()scala.io.Process" id="73381">rerun</a>() = <span title="scala.io.Process" class="keyword">new</span> <a href="#9664" title="scala.io.Process">Process</a>(<a href="#73396" title="() =&gt; java.lang.Process">processCreator</a>)
    
  <span class="keyword">def</span> <a title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]" id="73382">stdout</a>    = <a href="#73383" title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]">iterator</a>
  <span class="keyword">def</span> <a title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]" id="73383">iterator</a>  = <a href="#73390" title="=&gt; Process.this.StreamedConsumer">_out</a>.<a href="#74649" title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]">iterator</a>
  <span class="keyword">def</span> <a title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]" id="73384">stderr</a>    = <a href="#73388" title="=&gt; Process.this.StreamedConsumer">_err</a>.<a href="#74649" title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]">iterator</a>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.PrintWriter" id="73386">stdin</a> = <a title="(x$1: java.io.OutputStream,x$2: Boolean)java.io.PrintWriter" id="25545" class="keyword">new</a> <a title="java.io.PrintWriter" id="3904">PrintWriter</a>(<a href="#73392" title="=&gt; java.io.OutputStream">_in</a>, <span title="Boolean(true)" class="keyword">true</span>)
  
  <span class="keyword">class</span> <a title="class StreamedConsumer extends java.lang.Thread with Iterable[String] with ScalaObject" id="73387">StreamedConsumer</a><a href="../ScalaObject.scala.html#957" title="ScalaObject">(</a><a title="java.io.InputStream" id="74651">in</a>: <span title="java.io.InputStream">InputStream</span>) <span class="keyword">extends</span> <a title="java.lang.Thread" id="1825">Thread</a> <span class="keyword">with</span> <a href="../collection/Iterable.scala.html#4460" title="Iterable[String]">Iterable</a>[String] {
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.LinkedBlockingQueue[String]" id="74645">queue</a> = <span title="java.util.concurrent.LinkedBlockingQueue[String]" class="keyword">new</span> <a title="java.util.concurrent.LinkedBlockingQueue[String]" id="44466">LinkedBlockingQueue</a>[String]
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.io.BufferedReader" id="74647">reader</a> = <a title="(x$1: java.io.Reader)java.io.BufferedReader" id="75047" class="keyword">new</a> <a title="java.io.BufferedReader" id="3667">BufferedReader</a>(<span title="java.io.InputStreamReader" class="keyword">new</span> <a title="java.io.InputStreamReader" id="3886">InputStreamReader</a>(<a href="#74651" title="java.io.InputStream">in</a>))

    <span class="keyword">def</span> <a title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]" id="74649">iterator</a> = {
      <a href="#73387" title="()Unit" id="37272">join</a>()  // make sure this thread is complete
      <a href="#74734" title="java.lang.Object with Iterator[String]{ ... }" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Iterator[String]" id="74734">Iterator</a>[String] {
        <span class="keyword">val</span> <a title="java.util.Iterator[String]" id="74736">it</a> = <a href="#74645" title="=&gt; java.util.concurrent.LinkedBlockingQueue[String]">queue</a>.<a title="()java.util.Iterator[String]" id="74802">iterator</a>()
        <span class="keyword">def</span> <a title="=&gt; Boolean" id="74738">hasNext</a> = <a href="#74736" title="=&gt; java.util.Iterator[String]">it</a>.<a title="()Boolean" id="75009">hasNext</a>
        <span class="keyword">def</span> <a title="()String" id="74739">next</a> = <a href="#74736" title="=&gt; java.util.Iterator[String]">it</a>.<a title="()String" id="75010">next</a>
      }
    }
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="74650">run</a>() {
      <a href="#74647" title="=&gt; java.io.BufferedReader">reader</a>.<a title="()java.lang.String" id="75056">readLine</a> <span title="Unit" class="keyword">match</span> { 
        <span title="Unit" class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> =&gt;
        <span title="Unit" class="keyword">case</span> <a title="java.lang.String" id="75170">x</a>    =&gt;
          <a href="#74645" title="(x$1: String)Unit" id="74760">queue</a> put <a href="#75170" title="java.lang.String">x</a>
          <a href="#74650" title="()Unit">run</a>()
      }
    }
  }
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Process.this.StreamedConsumer" id="73388">_err</a> = <a href="#73394" title="(in: java.io.InputStream)Process.this.StreamedConsumer">createConsumer</a>(<a href="#73376" title="=&gt; java.lang.Process">process</a>.<a title="()java.io.InputStream" id="73400">getErrorStream</a>)
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Process.this.StreamedConsumer" id="73390">_out</a> = <a href="#73394" title="(in: java.io.InputStream)Process.this.StreamedConsumer">createConsumer</a>(<a href="#73376" title="=&gt; java.lang.Process">process</a>.<a title="()java.io.InputStream" id="73399">getInputStream</a>)
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.io.OutputStream" id="73392">_in</a>  = <a href="#73376" title="=&gt; java.lang.Process">process</a>.<a title="()java.io.OutputStream" id="73398">getOutputStream</a>()
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: java.io.InputStream)Process.this.StreamedConsumer" id="73394">createConsumer</a>(<a title="java.io.InputStream" id="74638">in</a>: <span title="java.io.InputStream">InputStream</span>) = {
    <span class="keyword">val</span> <a title="Process.this.StreamedConsumer" id="74641">t</a> = <span title="Process.this.StreamedConsumer" class="keyword">new</span> <a href="#73387" title="Process.this.StreamedConsumer">StreamedConsumer</a>(<a href="#74638" title="java.io.InputStream">in</a>)
    <a href="#74641" title="Process.this.StreamedConsumer">t</a>.<a title="()Unit" id="37244">start</a>()
    <a href="#74641" title="Process.this.StreamedConsumer">t</a>
  }
  
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="73395">toString</a>() = <a href="../runtime/RichString.scala.html#18060" title="(args: Any*)String" class="string">&quot;Process(%s)&quot;</a> format <a href="#73376" title="=&gt; java.lang.Process">process</a>.<a title="()java.lang.String" id="6517">toString</a>()
}


        </pre>
    </body>
</html>