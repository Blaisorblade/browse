<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/testing/Benchmark.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

// $Id: Benchmark.scala 16893 2009-01-13 13:09:22Z cunei $


<span class="keyword">package</span> scala.testing


<span class="keyword">import</span> compat.Platform

/** &lt;p&gt;
 *    &lt;code&gt;Benchmark&lt;/code&gt; can be used to quickly turn an existing
 *    class into a benchmark. Here is a short example:
 *  &lt;/p&gt;&lt;pre&gt;
 *  &lt;b&gt;object&lt;/b&gt; sort1 &lt;b&gt;extends&lt;/b&gt; Sorter &lt;b&gt;with&lt;/b&gt; Benchmark {
 *    &lt;b&gt;def&lt;/b&gt; run = sort(List.range(1, 1000))
 *  }
 *  &lt;/pre&gt;
 *  &lt;p&gt;
 *    The &lt;code&gt;run&lt;/code&gt; method has to be defined by the user, who
 *    will perform the timed operation there.
 *    Run the benchmark as follows:
 *  &lt;/p&gt;
 *  &lt;pre&gt;
 *  &amp;gt; scala sort1 5 times.log
 *  &lt;/pre&gt;
 *  &lt;p&gt;
 *    This will run the benchmark 5 times and log the execution times in
 *    a file called &lt;code&gt;times.log&lt;/code&gt;
 *  &lt;/p&gt;
 *
 *  @author Iulian Dragos, Burak Emir
 */
<span class="keyword">trait</span> <a title="trait Benchmark extends java.lang.Object with ScalaObject" id="13170">Benchmark</a> <a href="../ScalaObject.scala.html#969" title="ScalaObject">{</a>

  /** this method should be implemented by the concrete benchmark */
  <span class="keyword">def</span> <a title="()Unit" id="167922">run</a>()

  <span class="keyword">var</span> <a title="Int" id="167924">multiplier</a> = <span title="Int(1)" class="int">1</span>

  /** Run the benchmark the specified number of times
   *  and return a list with the execution times in milliseconds
   *  in reverse order of the execution
   *
   *  @param noTimes ...
   *  @return        ...
   */
  <span class="keyword">def</span> <a title="(noTimes: Int)List[Long]" id="167926">runBenchmark</a>(<a title="Int" id="167933">noTimes</a>: <a title="Int" id="2190">Int</a>): <a href="../collection/immutable/List.scala.html#9048" title="List[Long]">List</a>[Long] =
    <span class="keyword">for</span> (<a title="Int" id="167977">i</a> &lt;- <a href="../collection/immutable/List.scala.html#9049" title="object List">List</a>.<a href="../collection/generic/TraversableFactory.scala.html#17618" title="(start: Int,end: Int)List[Int]">range</a><a href="../collection/generic/TraversableTemplate.scala.html#17268" title="(f: (Int) =&gt; Long)(implicit bf: scala.collection.generic.BuilderFactory[Long,List[Long],List[Int]])List[Long]">(</a><span title="Int(1)" class="int">1</span>, <a href="#167933" title="(x$1: Int)Int">noTimes</a> + <span title="Int(1)" class="int">1</span>)) <span class="keyword">yield</span> {
      <span class="keyword">val</span> <a title="Long" id="167978">startTime</a> = <a href="../compat/Platform.scala.html#16745" title="object scala.compat.Platform">Platform</a>.<a href="../compat/Platform.scala.html#17798" title="=&gt; Long">currentTime</a>
      <span class="keyword">var</span> <a title="Int" id="167979">i</a> = <span title="Int(0)" class="int">0</span>; <span title="Unit" class="keyword">while</span> (<a href="#167979" title="(x$1: Int)Boolean" id="2969">i</a> &lt; <a href="#167924" title="=&gt; Int">multiplier</a>) <a href="#167981" title="()Unit">{</a>
        <a href="#167922" title="()Unit">run</a>()
        <a href="#167979" title="Int">i</a> += <span title="Int(1)" class="int">1</span>
      }
      <span class="keyword">val</span> <a title="Long" id="167980">stopTime</a> = <a href="../compat/Platform.scala.html#16745" title="object scala.compat.Platform">Platform</a>.<a href="../compat/Platform.scala.html#17798" title="=&gt; Long">currentTime</a>
      <a href="../compat/Platform.scala.html#16745" title="object scala.compat.Platform">Platform</a>.<a href="../compat/Platform.scala.html#17799" title="=&gt; Unit">collectGarbage</a>

      <a href="#167980" title="(x$1: Long)Long" id="3215">stopTime</a> - <a href="#167978" title="Long">startTime</a>
    }

  /** a string that is written at the beginning of the output line
   *   that contains the timings. By default, this is the class name.
   */
  <span class="keyword">def</span> <a title="=&gt; String" id="167927">prefix</a>: <a title="String" id="1618">String</a> = <a href="#13170" title="()java.lang.Class[_]" id="3641">getClass</a>().<a title="()java.lang.String" id="4122">getName</a>()

  /**
   * The entry point. It takes two arguments (n), (name) 
   *  and an optional argument multiplier (mult).
   *  (n) is the number of consecutive runs, (name) the name 
   *  of a log file where to append the times.
   *  if (mult) is present, the same thing is repeated (mult)
   *  times.
   */
  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="167928">main</a>(<a title="Array[String]" id="168066">args</a>: <a href="../Array.scala.html#897" title="Array[String]">Array</a>[String]) {
    <span title="Unit" class="keyword">if</span> (<a href="#168066" title="Array[String]">args</a>.<a href="../Array.scala.html#17822" title="(x$1: Int)Boolean" id="2973">length</a> &gt; <span title="Int(1)" class="int">1</span>) {
      <span class="keyword">val</span> <a title="java.io.FileWriter" id="168074">logFile</a> = <a title="(x$1: java.lang.String,x$2: Boolean)java.io.FileWriter" id="168077" class="keyword">new</a> java.io.<a title="java.io.FileWriter" id="3766">FileWriter</a>(<a href="../Array.scala.html#17823" title="(i: Int)String">args</a>(<span title="Int(1)" class="int">1</span>), <span title="Boolean(true)" class="keyword">true</span>) // append, not overwrite
      <span title="Unit" class="keyword">if</span> (<a href="#168066" title="Array[String]">args</a>.<a href="../Array.scala.html#17822" title="(x$1: Int)Boolean" id="2975">length</a> &gt;= <span title="Int(3)" class="int">3</span>)
         <a href="#167924" title="(x$1: Int)Unit">multiplier</a> = <a href="../Array.scala.html#17823" title="(i: Int)String">args</a><a href="../Predef.scala.html#16471" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">(</a><span title="Int(2)" class="int">2</span>).<a href="../runtime/RichString.scala.html#18162" title="=&gt; Int">toInt</a>
      <a href="#168074" title="java.io.FileWriter">logFile</a>.<span title="(x$1: java.lang.String)Unit">write</span>(<a href="#167927" title="=&gt; String">prefix</a>)
      <span class="keyword">for</span> (<a title="Long" id="168197">t</a> &lt;- <a href="#167926" title="(noTimes: Int)List[Long]">runBenchmark</a><a href="../collection/generic/LinearSequenceTemplate.scala.html#19509" title="(f: (Long) =&gt; Unit)Unit">(</a><a href="../Array.scala.html#17823" title="(i: Int)String">args</a><a href="../Predef.scala.html#16471" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">(</a><span title="Int(0)" class="int">0</span>).<a href="../runtime/RichString.scala.html#18162" title="=&gt; Int">toInt</a>))
        <a href="#168074" title="java.io.FileWriter">logFile</a>.<span title="(x$1: java.lang.String)Unit">write</span>(<a title="(x$1: Any)java.lang.String" id="6605" class="string">&quot;\t\t&quot;</a> + <a href="#168197" title="Long">t</a>)

      <a href="#168074" title="java.io.FileWriter">logFile</a>.<span title="(x$1: java.lang.String)Unit">write</span>(<a href="../compat/Platform.scala.html#16745" title="object scala.compat.Platform">Platform</a>.<a href="../compat/Platform.scala.html#17796" title="=&gt; java.lang.String">EOL</a>)
      <a href="#168074" title="java.io.FileWriter">logFile</a>.<a title="()Unit" id="153034">flush</a>()
    } <span class="keyword">else</span> {
      <a href="../Console.scala.html#397" title="object Console">Console</a>.<a href="../Console.scala.html#58984" title="(x: Any)Unit">println</a>(<span title="java.lang.String(&quot;Usage: scala benchmarks.program &lt;runs&gt; &lt;logfile&gt;&quot;)" class="string">&quot;Usage: scala benchmarks.program &lt;runs&gt; &lt;logfile&gt;&quot;</span>)
      <a href="../Console.scala.html#397" title="object Console">Console</a>.<a href="../Console.scala.html#58984" title="(x: Any)Unit">println</a>(<span title="java.lang.String(&quot;   or: scala benchmarks.program &lt;runs&gt; &lt;logfile&gt; &lt;multiplier&gt;&quot;)" class="string">&quot;   or: scala benchmarks.program &lt;runs&gt; &lt;logfile&gt; &lt;multiplier&gt;&quot;</span>)
    }
  }
}


        </pre>
    </body>
</html>