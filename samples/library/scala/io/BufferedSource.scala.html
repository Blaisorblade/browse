<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/io/BufferedSource.scala</title>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: BufferedSource.scala 16884 2009-01-09 16:52:09Z cunei $</span>


<span class="keyword">package</span> scala.io

<span class="keyword">import</span> java.io.InputStream
<span class="keyword">import</span> java.nio.{ByteBuffer, CharBuffer}
<span class="keyword">import</span> java.nio.channels.{ByteChannel, Channels, ReadableByteChannel}
<span class="keyword">import</span> java.nio.charset.{Charset, CharsetDecoder}

<span class="keyword">object</span> <span class="typed"><span class="type">object scala.io.BufferedSource</span><a id="8970">BufferedSource</a></span> {

  <span class="comment">/** same as fromInputStream(inpStream, Charset.forName(enc), buffer_size, do_reset) */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.InputStream,String,Int,() =&gt; scala.io.Source)scala.io.BufferedSource</span><a id="22127">fromInputStream</a></span>(<span class="typed"><span class="type">java.io.InputStream</span><a id="22131">inpStream</a></span>: <span class="typed"><span class="type">java.io.InputStream</span><a id="3742">InputStream</a></span>, <span class="typed"><span class="type">String</span><a id="22132">enc</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">Int</span><a id="22133">buffer_size</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">() =&gt; scala.io.Source</span><a id="22134">do_reset</a></span>: () =&gt; Source): <span class="typed"><span class="type">scala.io.BufferedSource</span><a href="#8969">BufferedSource</a></span> =
    <span class="typed"><span class="type">(java.io.InputStream,java.nio.charset.Charset,Int,() =&gt; scala.io.Source)scala.io.BufferedSource</span><a href="#22128">fromInputStream</a></span>(<span class="typed"><span class="type">java.io.InputStream</span><a href="#22131">inpStream</a></span>, <span class="typed"><span class="type">object java.nio.charset.Charset</span><a id="22116">Charset</a></span>.<span class="typed"><span class="type">(java.lang.String)java.nio.charset.Charset</span><a id="22236">forName</a></span>(<span class="typed"><span class="type">String</span><a href="#22132">enc</a></span>), <span class="typed"><span class="type">Int</span><a href="#22133">buffer_size</a></span>, <span class="typed"><span class="type">() =&gt; scala.io.Source</span><a href="#22134">do_reset</a></span>)

  <span class="comment">/** same as fromInputStream(inpStream, charSet.newDecoder(), buffer_size, do_reset) */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.InputStream,java.nio.charset.Charset,Int,() =&gt; scala.io.Source)scala.io.BufferedSource</span><a id="22128">fromInputStream</a></span>(<span class="typed"><span class="type">java.io.InputStream</span><a id="22230">inpStream</a></span>: <span class="typed"><span class="type">java.io.InputStream</span><a id="3742">InputStream</a></span>, <span class="typed"><span class="type">java.nio.charset.Charset</span><a id="22231">charSet</a></span>: <span class="typed"><span class="type">java.nio.charset.Charset</span><a id="22115">Charset</a></span>, <span class="typed"><span class="type">Int</span><a id="22232">buffer_size</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">() =&gt; scala.io.Source</span><a id="22233">do_reset</a></span>: () =&gt; Source): <span class="typed"><span class="type">scala.io.BufferedSource</span><a href="#8969">BufferedSource</a></span> =
    <span class="typed"><span class="type">(java.io.InputStream,java.nio.charset.CharsetDecoder,Int,() =&gt; scala.io.Source)scala.io.BufferedSource</span><a href="#22129">fromInputStream</a></span>(<span class="typed"><span class="type">java.io.InputStream</span><a href="#22230">inpStream</a></span>, <span class="typed"><span class="type">java.nio.charset.Charset</span><a href="#22231">charSet</a></span>.<span class="typed"><span class="type">()java.nio.charset.CharsetDecoder</span><a id="22246">newDecoder</a></span>(), <span class="typed"><span class="type">Int</span><a href="#22232">buffer_size</a></span>, <span class="typed"><span class="type">() =&gt; scala.io.Source</span><a href="#22233">do_reset</a></span>)

  <span class="comment">/** constructs a BufferedSource instance from an input stream, using given decoder */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(java.io.InputStream,java.nio.charset.CharsetDecoder,Int,() =&gt; scala.io.Source)scala.io.BufferedSource</span><a id="22129">fromInputStream</a></span>(<span class="typed"><span class="type">java.io.InputStream</span><a id="22200">inpStream</a></span>: <span class="typed"><span class="type">java.io.InputStream</span><a id="3742">InputStream</a></span>, <span class="typed"><span class="type">java.nio.charset.CharsetDecoder</span><a id="22201">decoder</a></span>: <span class="typed"><span class="type">java.nio.charset.CharsetDecoder</span><a id="22070">CharsetDecoder</a></span>, <span class="typed"><span class="type">Int</span><a id="22202">buffer_size</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">() =&gt; scala.io.Source</span><a id="22203">do_reset</a></span>: () =&gt; Source): <span class="typed"><span class="type">scala.io.BufferedSource</span><a href="#8969">BufferedSource</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">java.nio.channels.ReadableByteChannel</span><a id="22266">byteChannel</a></span> = <span class="typed"><span class="type">object java.nio.channels.Channels</span><a id="21964">Channels</a></span>.<span class="typed"><span class="type">(java.io.InputStream)java.nio.channels.ReadableByteChannel</span><a id="22275">newChannel</a></span>(<span class="typed"><span class="type">java.io.InputStream</span><a href="#22200">inpStream</a></span>)
    <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">template $anon extends scala.io.BufferedSource</span><a id="22292" class="keyword">new</a></span> {
      <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><span id="22295"><span id="22294"><a id="22301">buf_size</a></span></span></span> = <span class="typed"><span class="type">Int</span><a href="#22202">buffer_size</a></span>
     } <span class="keyword">with</span> <span class="typed"><span class="type">scala.io.BufferedSource</span><a href="#8969">BufferedSource</a></span>(<span class="typed"><span class="type">java.nio.channels.ReadableByteChannel</span><a href="#22266">byteChannel</a></span>, <span class="typed"><span class="type">java.nio.charset.CharsetDecoder</span><a href="#22201">decoder</a></span>) {
      <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()scala.io.Source</span><a id="22297">reset</a></span> = <span class="typed"><span class="type">()scala.io.Source</span><a href="../Function0.scala.html#21123">do_reset</a></span>()
      <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Unit</span><a id="22298">close</a></span> { <span class="typed"><span class="type">java.io.InputStream</span><a href="#22200">inpStream</a></span>.<span class="typed"><span class="type">()Unit</span><a id="22141">close</a></span> }
    }
  }
}

<span class="comment">/** This object provides convenience methods to create an iterable
 *  representation of a source file.
 *
 *  @author  Burak Emir
 *  @version 1.0, 19/08/2004
 */</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class BufferedSource extends scala.io.Source with ScalaObject</span><a id="8969">BufferedSource</a></span>(<span class="typed"><span class="type">java.nio.channels.ReadableByteChannel</span><span id="22183"><a id="22302">byteChannel</a></span></span>: <span class="typed"><span class="type">java.nio.channels.ReadableByteChannel</span><a id="22014">ReadableByteChannel</a></span>, <span class="typed"><span class="type">java.nio.charset.CharsetDecoder</span><span id="22184"><a id="22303">decoder</a></span></span>: <span class="typed"><span class="type">java.nio.charset.CharsetDecoder</span><a id="22070">CharsetDecoder</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">scala.io.Source</span><a href="Source.scala.html#9107">Source</a></span> {

  <span class="keyword">val</span> <span class="typed"><span class="type">=&gt; Int</span><a id="22186">buf_size</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>

  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Unit</span><a id="22187">close</a></span>: <span class="typed"><span class="type">Unit</span><a id="2167">Unit</a></span>

  <span class="keyword">val</span> <span class="typed"><span class="type">java.nio.ByteBuffer</span><span id="22189"><a id="22188">byteBuffer</a></span></span> = <span class="typed"><span class="type">object java.nio.ByteBuffer</span><a id="21852">ByteBuffer</a></span>.<span class="typed"><span class="type">(Int)java.nio.ByteBuffer</span><a id="22316">allocate</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="#22186">buf_size</a></span>)
  <span class="keyword">var</span> <span class="typed"><span class="type">java.nio.CharBuffer</span><span id="22192"><span id="22190"><span id="22191"><a id="22421">charBuffer</a></span></span></span></span> = <span class="typed"><span class="type">object java.nio.CharBuffer</span><a id="21933">CharBuffer</a></span>.<span class="typed"><span class="type">(Int)java.nio.CharBuffer</span><a id="22380">allocate</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="#22186">buf_size</a></span>)
  <span class="typed"><span class="type">=&gt; java.nio.ByteBuffer</span><a href="#22188">byteBuffer</a></span>.<span class="typed"><span class="type">(Int)java.nio.Buffer</span><a id="22439">position</a></span>(<span class="typed"><span class="type">=&gt; java.nio.ByteBuffer</span><a href="#22188">byteBuffer</a></span>.<span class="typed"><span class="type">()Int</span><a id="22440">limit</a></span>())
  <span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>.<span class="typed"><span class="type">(Int)java.nio.Buffer</span><a id="22439">position</a></span>(<span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>.<span class="typed"><span class="type">()Int</span><a id="22440">limit</a></span>())
  <span class="typed"><span class="type">java.nio.charset.CharsetDecoder</span><a href="#22184">decoder</a></span>.<span class="typed"><span class="type">()java.nio.charset.CharsetDecoder</span><a id="22221">reset</a></span>()
  <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="22195"><span id="22193"><span id="22194"><a id="22422">endOfInput</a></span></span></span></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>

  <span class="keyword">def</span> <span class="typed"><span class="type">()java.nio.Buffer</span><a id="22196">fillBuffer</a></span>() = {
    <span class="typed"><span class="type">=&gt; java.nio.ByteBuffer</span><a href="#22188">byteBuffer</a></span>.<span class="typed"><span class="type">()java.nio.ByteBuffer</span><a id="22334">compact</a></span>()
    <span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>.<span class="typed"><span class="type">()java.nio.CharBuffer</span><a id="22403">compact</a></span>()
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="22433">num_bytes</a></span> = <span class="typed"><span class="type">java.nio.channels.ReadableByteChannel</span><a href="#22183">byteChannel</a></span>.<span class="typed"><span class="type">(java.nio.ByteBuffer)Int</span><a id="22290">read</a></span>(<span class="typed"><span class="type">=&gt; java.nio.ByteBuffer</span><a href="#22188">byteBuffer</a></span>)
    <span class="typed"><span class="type">Unit</span><a href="#22434" class="keyword">while</a></span> (<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int</span><a href="#22433">num_bytes</a></span>) {
      <span class="typed"><span class="type">object java.lang.Thread</span><a id="2082">Thread</a></span>.<span class="typed"><span class="type">(Long)Unit</span><a id="20749">sleep</a></span>(<span class="typed"><span class="type">Long(1L)</span><span class="int">1</span></span>);  <span class="comment">// wait 1 ms for new data</span>
      <span class="typed"><span class="type">Int</span><a href="#22433">num_bytes</a></span> = <span class="typed"><span class="type">java.nio.channels.ReadableByteChannel</span><a href="#22183">byteChannel</a></span>.<span class="typed"><span class="type">(java.nio.ByteBuffer)Int</span><a id="22290">read</a></span>(<span class="typed"><span class="type">=&gt; java.nio.ByteBuffer</span><a href="#22188">byteBuffer</a></span>) 
    }
    <span class="typed"><span class="type">(Boolean)Unit</span><a href="#22194">endOfInput</a></span> = (<span class="typed"><span class="type">Int</span><a href="#22433">num_bytes</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> -<span class="typed"><span class="type">Int(-1)</span><span class="int">1</span></span>) 
    <span class="typed"><span class="type">=&gt; java.nio.ByteBuffer</span><a href="#22188">byteBuffer</a></span>.<span class="typed"><span class="type">()java.nio.Buffer</span><a id="22445">flip</a></span>() 
    <span class="typed"><span class="type">java.nio.charset.CharsetDecoder</span><a href="#22184">decoder</a></span>.<span class="typed"><span class="type">(java.nio.ByteBuffer,java.nio.CharBuffer,Boolean)java.nio.charset.CoderResult</span><a id="22218">decode</a></span>(<span class="typed"><span class="type">=&gt; java.nio.ByteBuffer</span><a href="#22188">byteBuffer</a></span>, <span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>, <span class="typed"><span class="type">=&gt; Boolean</span><a href="#22193">endOfInput</a></span>) 
    <span class="typed"><span class="type">Any</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a href="#22193">endOfInput</a></span>) <span class="typed"><span class="type">java.nio.charset.CharsetDecoder</span><a href="#22184">decoder</a></span>.<span class="typed"><span class="type">(java.nio.CharBuffer)java.nio.charset.CoderResult</span><a id="22219">flush</a></span>(<span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>) 
    <span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>.<span class="typed"><span class="type">()java.nio.Buffer</span><a id="22445">flip</a></span>() 
  }
  <span class="keyword">override</span> <span class="keyword">val</span> <span class="typed"><span class="type">&lt;refinement&gt; extends java.lang.Object with Iterator[Char]</span><span id="22198"><a id="22197">iter</a></span></span> = <span class="typed"><span class="type">template $anon extends java.lang.Object with Iterator[Char]</span><a id="22423" class="keyword">new</a></span> <span class="typed"><span class="type">Iterator[Char]</span><a href="../Iterator.scala.html#1337">Iterator</a></span>[Char] {
    <span class="keyword">var</span> <span class="typed"><span class="type">Char</span><span id="22427"><span id="22425"><span id="22426"><a id="22522">buf_char</a></span></span></span></span> = { 
      <span class="typed"><span class="type">()java.nio.Buffer</span><a href="#22196">fillBuffer</a></span>() 
      <span class="typed"><span class="type">Char</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a href="#22193">endOfInput</a></span>) <span class="typed"><span class="type">Char(' ')</span><span class="char">' '</span></span> <span class="keyword">else</span> <span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>.<span class="typed"><span class="type">()Char</span><a id="22389">get</a></span>()
    }
    <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="22428">hasNext</a></span> = { <span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>.<span class="typed"><span class="type">()Int</span><a id="22447">remaining</a></span>() <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2748">||</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2745">!</a></span><span class="typed"><span class="type">=&gt; Boolean</span><a href="#22193">endOfInput</a></span>}
    <span class="keyword">def</span> <span class="typed"><span class="type">()Char</span><a id="22429">next</a></span> = { 
      <span class="keyword">val</span> <span class="typed"><span class="type">Char</span><a id="22528">c</a></span> = <span class="typed"><span class="type">=&gt; Char</span><a href="#22425">buf_char</a></span>
      <span class="typed"><span class="type">Any</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>.<span class="typed"><span class="type">()Int</span><a id="22447">remaining</a></span>() <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) {
        <span class="typed"><span class="type">()java.nio.Buffer</span><a href="#22196">fillBuffer</a></span>()
      }
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2745">!</a></span><span class="typed"><span class="type">=&gt; Boolean</span><a href="#22193">endOfInput</a></span>) {
        <span class="typed"><span class="type">(Char)Unit</span><a href="#22426">buf_char</a></span> = <span class="typed"><span class="type">=&gt; java.nio.CharBuffer</span><a href="#22190">charBuffer</a></span>.<span class="typed"><span class="type">()Char</span><a id="22389">get</a></span>()
      }
      <span class="typed"><span class="type">Char</span><a href="#22528">c</a></span>
    }
  }
}


        </pre>
    </body>
</html>