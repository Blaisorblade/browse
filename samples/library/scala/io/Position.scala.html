<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/io/Position.scala</title>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: Position.scala 17274 2009-03-10 11:39:04Z michelou $</span>


<span class="keyword">package</span> scala.io

<span class="comment">/** &lt;p&gt;
 *    The object &lt;code&gt;Position&lt;/code&gt; provides convenience methods to encode
 *    line and column number in one single integer. The encode line (column)
 *    numbers range from 0 to &lt;code&gt;LINE_MASK&lt;/code&gt;
 *    (&lt;code&gt;COLUMN_MASK&lt;/code&gt;), where 0 indicates that the line (column) is
 *    the undefined and 1 represents the first line (column). Line (Column)
 *    numbers greater than &lt;code&gt;LINE_MASK&lt;/code&gt;
 *    (&lt;code&gt;COLUMN_MASK&lt;/code&gt;) are replaced by &lt;code&gt;LINE_MASK&lt;/code&gt;
 *    (&lt;code&gt;COLUMN_MASK&lt;/code&gt;). Furthermore, if the encoded line number is
 *    &lt;code&gt;LINE_MASK&lt;/code&gt;, the column number is always set to 0.
 *  &lt;/p&gt;
 *  &lt;p&gt;
 *    The following properties hold:
 *  &lt;/p&gt;
 *  &lt;ul&gt;
 *    &lt;li&gt;
 *      the undefined position is 0: &lt;code&gt;encode(0,0) == 0&lt;/code&gt;
 *    &lt;/li&gt;
 *    &lt;li&gt;
 *      encodings are non-negative : &lt;code&gt;encode(line,column) &gt;= 0&lt;/code&gt;
 *    &lt;/li&gt;
 *    &lt;li&gt;
 *      position order is preserved:
 *      &lt;code&gt;(line1 &amp;lt; line2) || (line1 == line2 &amp;amp;&amp;amp; column1 &amp;lt; column2)&lt;/code&gt;
 *      &lt;div&gt;implies&lt;/div&gt;
 *      &lt;code&gt;encode(line1,column1) &amp;lt;= encode(line2,column2)&lt;/code&gt;
 *    &lt;/li&gt;
 *  &lt;/ul&gt;
 *
 *  @author Burak Emir (translated from work by Matthias Zenger and others)
 */</span>
<span class="keyword">object</span> <span class="typed"><span class="type">object scala.io.Position</span><a id="9132">Position</a></span> {

  <span class="comment">/** Number of bits used to encode the line number */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <span class="typed"><span class="type">Int(20)</span><span id="31097"><a id="31096">LINE_BITS</a></span></span>   = <span class="typed"><span class="type">Int(20)</span><span class="int">20</span></span>
  <span class="comment">/** Number of bits used to encode the column number */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <span class="typed"><span class="type">Int(11)</span><span id="31099"><a id="31098">COLUMN_BITS</a></span></span> = <span class="int">31</span> <span class="typed"><span class="type">Int(11)</span><span >-</span></span> LINE_BITS <span class="comment">// no negatives =&gt; 31</span>

  <span class="comment">/** Mask to decode the line number */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <span class="typed"><span class="type">Int(1048575)</span><span id="31101"><a id="31100">LINE_MASK</a></span></span>   = (<span class="int">1</span> &lt;&lt; LINE_BITS) <span class="typed"><span class="type">Int(1048575)</span><span >-</span></span> <span class="int">1</span>
  <span class="comment">/** Mask to decode the column number */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <span class="typed"><span class="type">Int(2047)</span><span id="31103"><a id="31102">COLUMN_MASK</a></span></span> = (<span class="int">1</span> &lt;&lt; COLUMN_BITS) <span class="typed"><span class="type">Int(2047)</span><span >-</span></span> <span class="int">1</span>

  <span class="comment">/** The undefined position */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <span class="typed"><span class="type">Int(0)</span><span id="31105"><a id="31104">NOPOS</a></span></span>       = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>

  <span class="comment">/** The first position in a source file */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><span id="31107"><a id="31106">FIRSTPOS</a></span></span>    = <span class="typed"><span class="type">(Int,Int)Int</span><a href="#31108">encode</a></span>(<span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>, <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)

  <span class="comment">/** Encodes a position into a single integer. */</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Int,Int)Int</span><a id="31108">encode</a></span>(<span class="typed"><span class="type">Int</span><a id="31112">line</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">Int</span><a id="31113">column</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>): <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span> = {
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="70247">line1</a></span>, <span class="typed"><span class="type">Int</span><a id="70248">column1</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#31112">line</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
      <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)java.lang.IllegalArgumentException</span><a id="21630" class="keyword">new</a></span> <span class="typed"><span class="type">java.lang.IllegalArgumentException</span><a href="../Predef.scala.html#13341">IllegalArgumentException</a></span>(<span class="typed"><span class="type">Int</span><a href="#31112">line</a></span> <span class="typed"><span class="type">(java.lang.String)java.lang.String</span><a id="3087">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; &lt; 0&quot;)</span><span class="string">&quot; &lt; 0&quot;</span></span>)
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> ((<span class="typed"><span class="type">Int</span><a href="#31112">line</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2749">&amp;&amp;</a></span> (<span class="typed"><span class="type">Int</span><a href="#31113">column</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3140">!=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>))
      <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)java.lang.IllegalArgumentException</span><a id="21630" class="keyword">new</a></span> <span class="typed"><span class="type">java.lang.IllegalArgumentException</span><a href="../Predef.scala.html#13341">IllegalArgumentException</a></span>(<span class="typed"><span class="type">Int</span><a href="#31112">line</a></span> <span class="typed"><span class="type">(java.lang.String)java.lang.String</span><a id="3087">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;,&quot;)</span><span class="string">&quot;,&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">Int</span><a href="#31113">column</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; not allowed&quot;)</span><span class="string">&quot; not allowed&quot;</span></span>)
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#31113">column</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>)
      <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)java.lang.IllegalArgumentException</span><a id="21630" class="keyword">new</a></span> <span class="typed"><span class="type">java.lang.IllegalArgumentException</span><a href="../Predef.scala.html#13341">IllegalArgumentException</a></span>(<span class="typed"><span class="type">Int</span><a href="#31112">line</a></span> <span class="typed"><span class="type">(java.lang.String)java.lang.String</span><a id="3087">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;,&quot;)</span><span class="string">&quot;,&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">Int</span><a href="#31113">column</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; not allowed&quot;)</span><span class="string">&quot; not allowed&quot;</span></span>)

    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#31112">line</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3144">&gt;=</a></span> <span class="typed"><span class="type">Int(1048575)</span><span >LINE_MASK</span></span>) {
      <span class="typed"><span class="type">Int</span><a href="#70247">line1</a></span> = <span class="typed"><span class="type">Int(1048575)</span><span >LINE_MASK</span></span>
      <span class="typed"><span class="type">Int</span><a href="#70248">column1</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
    }
    <span class="keyword">else</span> {
      <span class="typed"><span class="type">Int</span><a href="#70247">line1</a></span> = <span class="typed"><span class="type">Int</span><a href="#31112">line</a></span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#31113">column</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&gt;</a></span> <span class="typed"><span class="type">Int(2047)</span><span >COLUMN_MASK</span></span>)
        <span class="typed"><span class="type">Int</span><a href="#70248">column1</a></span> = <span class="typed"><span class="type">Int(2047)</span><span >COLUMN_MASK</span></span>
      <span class="keyword">else</span> 
        <span class="typed"><span class="type">Int</span><a href="#70248">column1</a></span> = <span class="typed"><span class="type">Int</span><a href="#31113">column</a></span>
    }
    (<span class="typed"><span class="type">Int</span><a href="#70247">line1</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3088">&lt;&lt;</a></span> <span class="typed"><span class="type">Int(11)</span><span >COLUMN_BITS</span></span>) <span class="typed"><span class="type">(Int)Int</span><a id="3150">|</a></span> <span class="typed"><span class="type">Int</span><a href="#70248">column1</a></span>
  }

  <span class="comment">/** Returns the line number of the encoded position. */</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Int</span><a id="31109">line</a></span>(<span class="typed"><span class="type">Int</span><a id="31565">pos</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>): <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span> =
    (<span class="typed"><span class="type">Int</span><a href="#31565">pos</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3092">&gt;&gt;</a></span> <span class="typed"><span class="type">Int(11)</span><span >COLUMN_BITS</span></span>) <span class="typed"><span class="type">(Int)Int</span><a id="3151">&amp;</a></span> <span class="typed"><span class="type">Int(1048575)</span><span >LINE_MASK</span></span>

  <span class="comment">/** Returns the column number of the encoded position. */</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Int</span><a id="31110">column</a></span>(<span class="typed"><span class="type">Int</span><a id="31566">pos</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>): <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span> =
    <span class="typed"><span class="type">Int</span><a href="#31566">pos</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3151">&amp;</a></span> <span class="typed"><span class="type">Int(2047)</span><span >COLUMN_MASK</span></span>

  <span class="comment">/** Returns a string representation of the encoded position. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Int)String</span><a id="31111">toString</a></span>(<span class="typed"><span class="type">Int</span><a id="70285">pos</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>): <span class="typed"><span class="type">String</span><a id="1859">String</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">StringBuilder</span><a id="70286">sb</a></span> = <span class="typed"><span class="type">()StringBuilder</span><a href="../StringBuilder.scala.html#19620" class="keyword">new</a></span> <span class="typed"><span class="type">StringBuilder</span><a href="../StringBuilder.scala.html#1433">StringBuilder</a></span>
    <span class="typed"><span class="type">StringBuilder</span><a href="#70286">sb</a></span> <span class="typed"><span class="type">(Int)StringBuilder</span><a href="../StringBuilder.scala.html#19648">append</a></span> <span class="typed"><span class="type">(Int)Int</span><a href="#31109">line</a></span>(<span class="typed"><span class="type">Int</span><a href="#70285">pos</a></span>)
    <span class="typed"><span class="type">StringBuilder</span><a href="#70286">sb</a></span> <span class="typed"><span class="type">(Char)StringBuilder</span><a href="../StringBuilder.scala.html#19646">append</a></span> <span class="typed"><span class="type">Char(':')</span><span class="char">':'</span></span>
    <span class="typed"><span class="type">StringBuilder</span><a href="#70286">sb</a></span> <span class="typed"><span class="type">(Int)StringBuilder</span><a href="../StringBuilder.scala.html#19648">append</a></span> <span class="typed"><span class="type">(Int)Int</span><a href="#31110">column</a></span>(<span class="typed"><span class="type">Int</span><a href="#70285">pos</a></span>)
    <span class="typed"><span class="type">StringBuilder</span><a href="#70286">sb</a></span>.<span class="typed"><span class="type">()String</span><a href="../StringBuilder.scala.html#19672">toString</a></span>()
  }
}

        </pre>
    </body>
</html>