<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/io/Process.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

<span class="keyword">package</span> scala.io

<span class="keyword">import</span> annotation.experimental
<span class="keyword">import</span> concurrent.ThreadRunner
<span class="keyword">import</span> util.Properties.{ isWin, isMac }
<span class="keyword">import</span> util.control.Exception.catching
<span class="keyword">import</span> java.lang.{ Process =&gt; JProcess, ProcessBuilder =&gt; JProcessBuilder }
<span class="keyword">import</span> java.io.{ IOException, InputStream, OutputStream, BufferedReader, InputStreamReader, PrintWriter, File =&gt; JFile }
<span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue

/** The &lt;code&gt;Process&lt;/code&gt; object contains convenience functions
 *  for running external processes.
 *
 *  An example usage:
 *  &lt;pre&gt;
 *    io.Process(&quot;ls&quot;, cwd = io.File(&quot;/&quot;)) foreach println
 *  &lt;/pre&gt;
 *
 *  See http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4109888
 *  for a dated list of the many obstacles to a clean interface.
 *
 *  This is not finished!! Do not rely upon it yet.
 * 
 *  TODO - remove requirement that process complete before we 
 *  can get an iterator.
 *
 *  @author   Paul Phillips
 *  @since    2.8
 */
 
@experimental
<span class="keyword">object</span> <a title="object scala.io.Process" id="9742">Process</a>
<a href="../ScalaObject.scala.html#969" title="ScalaObject">{</a>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.util.List[java.lang.String]" id="74115">javaVmArguments</a> = java.lang.management.<a title="object java.lang.management.ManagementFactory" id="74195">ManagementFactory</a>.<a title="()java.lang.management.RuntimeMXBean" id="74224">getRuntimeMXBean</a>().<a title="()java.util.List[java.lang.String]" id="74548">getInputArguments</a>()
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.lang.Runtime" id="74117">runtime</a> = <a title="object java.lang.Runtime" id="1511">Runtime</a>.<a title="()java.lang.Runtime" id="74635">getRuntime</a>()
  
  @experimental
  <span class="keyword">private</span>[Process] <span class="keyword">class</span> <a title="class ProcessBuilder extends java.lang.Object with ScalaObject" id="74118">ProcessBuilder</a><a href="../ScalaObject.scala.html#969" title="ScalaObject">(</a><span class="keyword">val</span> <a title="java.lang.ProcessBuilder" id="74738">pb</a>: <span title="java.lang.ProcessBuilder">JProcessBuilder</span>)
  {
    <span class="keyword">def</span> <a title="(cmd: String*)scala.io.Process.ProcessBuilder" id="74699" class="keyword">this</a>(<a title="String*" id="74743">cmd</a>: <a title="String*" id="4191">String</a>*) = <a href="#74118" title="ProcessBuilder.this.type" class="keyword">this</a>(<a title="(x$1: java.lang.String*)java.lang.ProcessBuilder" id="74713" class="keyword">new</a> <span title="java.lang.ProcessBuilder">JProcessBuilder</span>(<a href="#74743" title="String*">cmd</a>.<a href="../collection/generic/TraversableTemplate.scala.html#17340" title="(implicit evidence$1: scala.reflect.ClassManifest[String])Array[String]">toArray</a>: _*))
    <span class="keyword">def</span> <a title="()scala.io.Process" id="74700">start</a>() = <span title="scala.io.Process" class="keyword">new</span> <a href="#9741" title="scala.io.Process">Process</a>(() =&gt; <a href="#74738" title="=&gt; java.lang.ProcessBuilder">pb</a>.<a title="()java.lang.Process" id="74736">start</a>())

    <span class="keyword">def</span> <a title="(env: Map[String,String])ProcessBuilder.this.type" id="74701">withOnlyEnv</a>(<a title="Map[String,String]" id="74786">env</a>: <a href="../collection/immutable/Map.scala.html#8949" title="Map[String,String]">Map</a>[String, String]): <span class="keyword">this</span>.<span class="keyword">type</span> = {
      <a href="#74738" title="=&gt; java.lang.ProcessBuilder">pb</a>.<span title="()java.util.Map[java.lang.String,java.lang.String]">environment</span>.<a title="()Unit" id="45288">clear</a>()
      <a href="#74702" title="(env: Map[String,String])ProcessBuilder.this.type">withEnv</a>(<a href="#74786" title="Map[String,String]">env</a>)
    }

    <span class="keyword">def</span> <a title="(env: Map[String,String])ProcessBuilder.this.type" id="74702">withEnv</a>(<a title="Map[String,String]" id="74793">env</a>: <a href="../collection/immutable/Map.scala.html#8949" title="Map[String,String]">Map</a>[String,String]): <span class="keyword">this</span>.<span class="keyword">type</span> = {
      <span title="Unit" class="keyword">if</span> (<a href="#74793" title="(x$1: AnyRef)Boolean">env</a> != <span title="Null(null)" class="keyword">null</span>) {
        <span class="keyword">val</span> <a title="java.util.Map[java.lang.String,java.lang.String]" id="74803">jmap</a> = <a href="#74738" title="=&gt; java.lang.ProcessBuilder">pb</a>.<span title="()java.util.Map[java.lang.String,java.lang.String]">environment</span>()
        <span class="keyword">for</span> (<a id="1">(</a><a title="String" id="74836">k</a>, <a title="String" id="74837">v</a>) &lt;- <a href="../collection/generic/IterableTemplate.scala.html#17394" title="(f: ((String, String)) =&gt; java.lang.String)Unit">env</a>) <a href="#74803" title="java.util.Map[java.lang.String,java.lang.String]">jmap</a>.<a title="(x$1: java.lang.String,x$2: java.lang.String)java.lang.String" id="45273">put</a>(<a href="#74836" title="String">k</a>, <a href="#74837" title="String">v</a>)
      }
      <a href="#74118" title="ProcessBuilder.this.type" class="keyword">this</a>
    }

    <span class="keyword">def</span> <a title="(cwd: scala.io.File)ProcessBuilder.this.type" id="74703">withCwd</a>(<a title="scala.io.File" id="74847">cwd</a>: <a href="File.scala.html#9714" title="scala.io.File">File</a>): <span class="keyword">this</span>.<span class="keyword">type</span> = {
      <span title="Any" class="keyword">if</span> (<a href="#74847" title="(x$1: AnyRef)Boolean">cwd</a> != <span title="Null(null)" class="keyword">null</span>)
        <a href="#74738" title="(x$1: java.io.File)java.lang.ProcessBuilder" id="74731">pb</a> directory <a href="#74847" title="scala.io.File">cwd</a>.<a href="Path.scala.html#32704" title="=&gt; java.io.File">jfile</a>

      <a href="#74118" title="ProcessBuilder.this.type" class="keyword">this</a>
    }
    <span class="keyword">def</span> <a title="(merged: Boolean)ProcessBuilder.this.type" id="74704">withRedirectedErrorStream</a>(<a title="Boolean" id="74865">merged</a>: <span title="Boolean">Boolean</span>): <span class="keyword">this</span>.<span class="keyword">type</span> = {
      <a href="#74738" title="(x$1: Boolean)java.lang.ProcessBuilder" id="74734">pb</a> redirectErrorStream <a href="#74865" title="Boolean">merged</a>
      <a href="#74118" title="ProcessBuilder.this.type" class="keyword">this</a>
    }

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="74705">toString</a>() = <a href="../runtime/RichString.scala.html#18167" title="(args: Any*)String" class="string">&quot;ProcessBuilder(%s)&quot;</a> format <a href="#74738" title="=&gt; java.lang.ProcessBuilder">pb</a>.<a title="()java.util.List[java.lang.String]" id="74723">command</a>()
  }
  
  // This can be fleshed out if more variations come up
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="(String) =&gt; Array[String]" id="74119">shell</a>: String =&gt; Array[String] =
    <span title="(String) =&gt; Array[String]" class="keyword">if</span> (<a href="../util/Properties.scala.html#74082" title="=&gt; Boolean">isWin</a>) <a href="../Array.scala.html#29325" title="(xs: String*)(implicit evidence$2: scala.reflect.ClassManifest[String])Array[String]">Array</a><a href="../reflect/ClassManifest.scala.html#26343" title="(clazz: Class[_])scala.reflect.ClassManifest[String]">(</a><span title="java.lang.String(&quot;cmd.exe&quot;)" class="string">&quot;cmd.exe&quot;</span>, <span title="java.lang.String(&quot;/C&quot;)" class="string">&quot;/C&quot;</span>, <a href="#74925" title="String">_</a>)
    <span class="keyword">else</span> <a href="../Array.scala.html#29325" title="(xs: String*)(implicit evidence$2: scala.reflect.ClassManifest[String])Array[String]">Array</a><a href="../reflect/ClassManifest.scala.html#26343" title="(clazz: Class[_])scala.reflect.ClassManifest[String]">(</a><span title="java.lang.String(&quot;sh&quot;)" class="string">&quot;sh&quot;</span>, <span title="java.lang.String(&quot;-c&quot;)" class="string">&quot;-c&quot;</span>, <a href="#75221" title="String">_</a>)
  
  /** Executes the given command line in a shell.
   *
   *  @param    command   the command line
   *  @return             a Process object
   */
  <span class="keyword">def</span> <a title="(command: String,env: Map[String,String],cwd: scala.io.File,redirect: Boolean)scala.io.Process" id="74121">apply</a>(
    <a title="String" id="75286">command</a>: <a title="String" id="1618">String</a>,
    <a title="Map[String,String]" id="75291">env</a>: <a href="../collection/immutable/Map.scala.html#8949" title="Map[String,String]">Map</a>[String, String] = <span title="Null(null)" class="keyword">null</span>,
    <a title="scala.io.File" id="75292">cwd</a>: <a href="File.scala.html#9714" title="scala.io.File">File</a> = <span title="Null(null)" class="keyword">null</span>,
    <a title="Boolean" id="75293">redirect</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>
  ): <a href="#9741" title="scala.io.Process">Process</a> =
      <a href="#74122" title="(command: Seq[String],env: Map[String,String],cwd: scala.io.File,redirect: Boolean)scala.io.Process">exec</a>(<a href="../Function1.scala.html#17226" title="(v1: String)Array[String]">shell</a>(<a href="#75286" title="String">command</a>), <a href="#75291" title="Map[String,String]">env</a>, <a href="#75292" title="scala.io.File">cwd</a>)

  /** Executes the given command line.
   *
   *  @param    command   the command line
   *  @return             a Process object
   */
  <span class="keyword">def</span> <a title="(command: Seq[String],env: Map[String,String],cwd: scala.io.File,redirect: Boolean)scala.io.Process" id="74122">exec</a>(
    <a title="Seq[String]" id="75294">command</a>: <a href="../collection/Sequence.scala.html#4376" title="Seq[String]">Seq</a>[String],
    <a title="Map[String,String]" id="75299">env</a>: <a href="../collection/immutable/Map.scala.html#8949" title="Map[String,String]">Map</a>[String, String] = <span title="Null(null)" class="keyword">null</span>,
    <a title="scala.io.File" id="75300">cwd</a>: <a href="File.scala.html#9714" title="scala.io.File">File</a> = <span title="Null(null)" class="keyword">null</span>,
    <a title="Boolean" id="75301">redirect</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>
  ): <a href="#9741" title="scala.io.Process">Process</a> =
      <a href="#74702" title="(env: scala.collection.immutable.Map[java.lang.String,java.lang.String])scala.io.Process.ProcessBuilder" class="keyword">new</a> <a href="#74118" title="scala.io.Process.ProcessBuilder">ProcessBuilder</a>(<a href="#75294" title="Seq[String]">command</a>: _*) <a href="#74703" title="(cwd: scala.io.File)scala.io.Process.ProcessBuilder">withEnv</a> <a href="#75299" title="Map[String,String]">env</a> withCwd <a href="#75300" title="scala.io.File">cwd</a> <a href="#74700" title="()scala.io.Process">start</a>
}
<span class="keyword">import</span> Process._

@experimental
<span class="keyword">class</span> <a title="class Process extends java.lang.Object with Iterable[String] with ScalaObject" id="9741">Process</a><a href="../ScalaObject.scala.html#969" title="ScalaObject">(</a><a title="() =&gt; java.lang.Process" id="74146">processCreator</a>: () =&gt; JProcess) <span class="keyword">extends</span> <a href="../collection/Iterable.scala.html#4520" title="Iterable[String]">Iterable</a>[String]
{
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.lang.Process" id="74127">process</a> = <a href="../Function0.scala.html#34209" title="()java.lang.Process">processCreator</a>()
  
  <span class="keyword">def</span> <a title="()Option[Int]" id="74128">exitValue</a>(): <a href="../Option.scala.html#789" title="Option[Int]">Option</a>[Int] =
    <a href="../util/control/Exception.scala.html#31347" title="(exceptions: Class[_]*)util.control.Exception.Catch[Nothing]">catching</a><a href="../util/control/Exception.scala.html#47595" title="(body: =&gt; Int)Option[Int]">(</a>classOf<span title="java.lang.Class[java.lang.IllegalThreadStateException]">[</span>IllegalThreadStateException]) opt <a href="#74126" title="=&gt; java.lang.Process">process</a>.<a title="()Int" id="74152">exitValue</a>()
    
  <span class="keyword">def</span> <a title="()Int" id="74129">waitFor</a>() = <a href="#74126" title="=&gt; java.lang.Process">process</a>.<a title="()Int" id="74151">waitFor</a>()
  <span class="keyword">def</span> <a title="()Unit" id="74130">destroy</a>() = <a href="#74126" title="=&gt; java.lang.Process">process</a>.<a title="()Unit" id="74153">destroy</a>()
  <span class="keyword">def</span> <a title="()scala.io.Process" id="74131">rerun</a>() = <span title="scala.io.Process" class="keyword">new</span> <a href="#9741" title="scala.io.Process">Process</a>(<a href="#74146" title="() =&gt; java.lang.Process">processCreator</a>)
    
  <span class="keyword">def</span> <a title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]" id="74132">stdout</a>    = <a href="#74133" title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]">iterator</a>
  <span class="keyword">def</span> <a title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]" id="74133">iterator</a>  = <a href="#74140" title="=&gt; Process.this.StreamedConsumer">_out</a>.<a href="#75399" title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]">iterator</a>
  <span class="keyword">def</span> <a title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]" id="74134">stderr</a>    = <a href="#74138" title="=&gt; Process.this.StreamedConsumer">_err</a>.<a href="#75399" title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]">iterator</a>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.PrintWriter" id="74136">stdin</a> = <a title="(x$1: java.io.OutputStream,x$2: Boolean)java.io.PrintWriter" id="25652" class="keyword">new</a> <a title="java.io.PrintWriter" id="3919">PrintWriter</a>(<a href="#74142" title="=&gt; java.io.OutputStream">_in</a>, <span title="Boolean(true)" class="keyword">true</span>)
  
  <span class="keyword">class</span> <a title="class StreamedConsumer extends java.lang.Thread with Iterable[String] with ScalaObject" id="74137">StreamedConsumer</a><a href="../ScalaObject.scala.html#969" title="ScalaObject">(</a><a title="java.io.InputStream" id="75401">in</a>: <span title="java.io.InputStream">InputStream</span>) <span class="keyword">extends</span> <a title="java.lang.Thread" id="1840">Thread</a> <span class="keyword">with</span> <a href="../collection/Iterable.scala.html#4520" title="Iterable[String]">Iterable</a>[String] {
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.LinkedBlockingQueue[String]" id="75395">queue</a> = <span title="java.util.concurrent.LinkedBlockingQueue[String]" class="keyword">new</span> <a title="java.util.concurrent.LinkedBlockingQueue[String]" id="44579">LinkedBlockingQueue</a>[String]
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.io.BufferedReader" id="75397">reader</a> = <a title="(x$1: java.io.Reader)java.io.BufferedReader" id="73317" class="keyword">new</a> <a title="java.io.BufferedReader" id="3682">BufferedReader</a>(<span title="java.io.InputStreamReader" class="keyword">new</span> <a title="java.io.InputStreamReader" id="3901">InputStreamReader</a>(<a href="#75401" title="java.io.InputStream">in</a>))

    <span class="keyword">def</span> <a title="=&gt; &lt;refinement&gt; extends java.lang.Object with Iterator[String]" id="75399">iterator</a> = {
      <a href="#74137" title="()Unit" id="37385">join</a>()  // make sure this thread is complete
      <a href="#75484" title="java.lang.Object with Iterator[String]{ ... }" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Iterator[String]" id="75484">Iterator</a>[String] {
        <span class="keyword">val</span> <a title="java.util.Iterator[String]" id="75486">it</a> = <a href="#75395" title="=&gt; java.util.concurrent.LinkedBlockingQueue[String]">queue</a>.<a title="()java.util.Iterator[String]" id="75552">iterator</a>()
        <span class="keyword">def</span> <a title="=&gt; Boolean" id="75488">hasNext</a> = <a href="#75486" title="=&gt; java.util.Iterator[String]">it</a>.<a title="()Boolean" id="75759">hasNext</a>
        <span class="keyword">def</span> <a title="()String" id="75489">next</a> = <a href="#75486" title="=&gt; java.util.Iterator[String]">it</a>.<a title="()String" id="75760">next</a>
      }
    }
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="75400">run</a>() {
      <a href="#75397" title="=&gt; java.io.BufferedReader">reader</a>.<a title="()java.lang.String" id="73326">readLine</a> <span title="Unit" class="keyword">match</span> { 
        <span title="Unit" class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> =&gt;
        <span title="Unit" class="keyword">case</span> <a title="java.lang.String" id="75879">x</a>    =&gt;
          <a href="#75395" title="(x$1: String)Unit" id="75510">queue</a> put <a href="#75879" title="java.lang.String">x</a>
          <a href="#75400" title="()Unit">run</a>()
      }
    }
  }
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Process.this.StreamedConsumer" id="74138">_err</a> = <a href="#74144" title="(in: java.io.InputStream)Process.this.StreamedConsumer">createConsumer</a>(<a href="#74126" title="=&gt; java.lang.Process">process</a>.<a title="()java.io.InputStream" id="74150">getErrorStream</a>)
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Process.this.StreamedConsumer" id="74140">_out</a> = <a href="#74144" title="(in: java.io.InputStream)Process.this.StreamedConsumer">createConsumer</a>(<a href="#74126" title="=&gt; java.lang.Process">process</a>.<a title="()java.io.InputStream" id="74149">getInputStream</a>)
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.io.OutputStream" id="74142">_in</a>  = <a href="#74126" title="=&gt; java.lang.Process">process</a>.<a title="()java.io.OutputStream" id="74148">getOutputStream</a>()
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: java.io.InputStream)Process.this.StreamedConsumer" id="74144">createConsumer</a>(<a title="java.io.InputStream" id="75388">in</a>: <span title="java.io.InputStream">InputStream</span>) = {
    <span class="keyword">val</span> <a title="Process.this.StreamedConsumer" id="75391">t</a> = <span title="Process.this.StreamedConsumer" class="keyword">new</span> <a href="#74137" title="Process.this.StreamedConsumer">StreamedConsumer</a>(<a href="#75388" title="java.io.InputStream">in</a>)
    <a href="#75391" title="Process.this.StreamedConsumer">t</a>.<a title="()Unit" id="37357">start</a>()
    <a href="#75391" title="Process.this.StreamedConsumer">t</a>
  }
  
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="74145">toString</a>() = <a href="../runtime/RichString.scala.html#18167" title="(args: Any*)String" class="string">&quot;Process(%s)&quot;</a> format <a href="#74126" title="=&gt; java.lang.Process">process</a>.<a title="()java.lang.String" id="6580">toString</a>()
}


        </pre>
    </body>
</html>