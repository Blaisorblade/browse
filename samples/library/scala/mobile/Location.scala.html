<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/mobile/Location.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2002-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |                                         **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

// $Id: Location.scala 16893 2009-01-13 13:09:22Z cunei $


<span class="keyword">package</span> scala.mobile


<span class="keyword">import</span> java.lang.ClassLoader
<span class="keyword">import</span> java.net._

<span class="keyword">import</span> scala.collection.mutable._

/** The class &lt;code&gt;Location&lt;/code&gt; provides a &lt;code&gt;create&lt;/code&gt;
 *  method to instantiate objects from a network location by
 *  specifying the URL address of the jar/class file.&lt;p/&gt;
 *
 *  An update of the jar/class file should not break your code as far
 *  as the used class names and method signatures are the same.&lt;p/&gt;
 *
 *  Example:&lt;pre&gt;
 *    &lt;b&gt;val&lt;/b&gt; url = &lt;b&gt;new&lt;/b&gt; URL(&quot;http://scala-lang.org/classes/examples.jar&quot;);
 *    &lt;b&gt;val&lt;/b&gt; obj = &lt;b&gt;new&lt;/b&gt; Location(url) create &quot;examples.sort&quot;;&lt;/pre&gt;
 *
 *  @see &lt;a href=&quot;Code.html&quot;&gt;Code&lt;/a&gt;
 *
 *  @author  Stephane Micheloud
 *  @version 1.0, 04/05/2004
 */
<span class="keyword">class</span> <a title="class Location extends java.lang.Object with ScalaObject" id="15107">Location</a><a href="../ScalaObject.scala.html#957" title="ScalaObject">(</a><a title="java.net.URL" id="179640">url</a>: <a title="java.net.URL" id="4909">URL</a>) {

  /** A cache containing all class loaders of this location.
   */
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.mutable.Map[java.net.URL,java.lang.ClassLoader]" id="179303">lcache</a>: <a href="../collection/mutable/Map.scala.html#7590" title="scala.collection.mutable.Map[java.net.URL,java.lang.ClassLoader]">Map</a>[URL, ClassLoader] = <span title="scala.collection.mutable.HashMap[java.net.URL,java.lang.ClassLoader]" class="keyword">new</span> <a href="../collection/mutable/HashMap.scala.html#7755" title="scala.collection.mutable.HashMap[java.net.URL,java.lang.ClassLoader]">HashMap</a>

  /** The class loader associated with this location.
   */
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.ClassLoader" id="179305">loader</a> = <span title="java.lang.ClassLoader" class="keyword">if</span> (<a href="#179640" title="(x$1: AnyRef)Boolean" id="6531">url</a> eq <span title="Null(null)" class="keyword">null</span>)
    <a title="object java.lang.ClassLoader" id="1469">ClassLoader</a>.<a title="()java.lang.ClassLoader" id="25092">getSystemClassLoader</a>()
  <span class="keyword">else</span>
    <a href="#179303" title="=&gt; scala.collection.mutable.Map[java.net.URL,java.lang.ClassLoader]">lcache</a>.<a href="../collection/generic/MapTemplate.scala.html#35273" title="(key: java.net.URL)Option[java.lang.ClassLoader]">get</a>(<a href="#179640" title="java.net.URL">url</a>) <span title="java.lang.ClassLoader" class="keyword">match</span> {
    <span title="java.lang.ClassLoader" class="keyword">case</span> Some(<a title="java.lang.ClassLoader" id="179322">cl</a>) =&gt;
      <a href="#179322" title="java.lang.ClassLoader">cl</a>
    <span title="java.net.URLClassLoader" class="keyword">case</span> _ =&gt;
      <span class="keyword">val</span> <a title="java.net.URLClassLoader" id="179325">cl</a> = <a title="(x$1: Array[java.net.URL])java.net.URLClassLoader" id="162770" class="keyword">new</a> <a title="java.net.URLClassLoader" id="4930">URLClassLoader</a>(<a href="../Array.scala.html#29218" title="(xs: java.net.URL*)(implicit evidence$2: scala.reflect.ClassManifest[java.net.URL])Array[java.net.URL]">Array</a><a href="../reflect/ClassManifest.scala.html#26236" title="(clazz: Class[_])scala.reflect.ClassManifest[java.net.URL]">(</a><a href="#179640" title="java.net.URL">url</a>))
      <a href="../collection/generic/MutableMapTemplate.scala.html#57772" title="(key: java.net.URL,value: java.lang.ClassLoader)Unit">lcache</a>(<a href="#179640" title="java.net.URL">url</a>) = <a href="#179325" title="java.net.URLClassLoader">cl</a>
      <a href="#179325" title="java.net.URLClassLoader">cl</a>
  }

  /** A cache containing all classes of this location.
   */
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.mutable.Map[String,java.lang.Class[_]]" id="179308">ccache</a>: <a href="../collection/mutable/Map.scala.html#7590" title="scala.collection.mutable.Map[String,java.lang.Class[_]]">Map</a>[String, java.lang.Class[T] <span class="keyword">forSome</span> { <span class="keyword">type</span> T }] = <span title="scala.collection.mutable.HashMap[String,java.lang.Class[_]]" class="keyword">new</span> <a href="../collection/mutable/HashMap.scala.html#7755" title="scala.collection.mutable.HashMap[String,java.lang.Class[_]]">HashMap</a>

  /** Return the code description for the string &lt;code&gt;className&lt;/code&gt;
   *  at this location.
   *
   * @param classname the name of the class
   * @return          the code description corresponding to
   *                  &lt;code&gt;className&lt;/code&gt;.
   */
  <span class="keyword">def</span> <a title="(className: String)scala.mobile.Code" id="179310">create</a>(<a title="String" id="179653">className</a>: <a title="String" id="1603">String</a>) = <span title="scala.mobile.Code" class="keyword">new</span> <a href="Code.scala.html#15098" title="scala.mobile.Code">Code</a>(
    <a href="#179308" title="=&gt; scala.collection.mutable.Map[String,java.lang.Class[_]]">ccache</a>.<a href="../collection/generic/MapTemplate.scala.html#35273" title="(key: String)Option[java.lang.Class[_]]">get</a>(<a href="#179653" title="String">className</a>) <span title="java.lang.Class[_148]" class="keyword">match</span> {
      <span title="java.lang.Class[_0]" class="keyword">case</span> Some(<a title="java.lang.Class[_]" id="179794">clazz</a>) =&gt;
        <a href="#179794" title="java.lang.Class[_]">clazz</a>
      <span title="java.lang.Class[_147]" class="keyword">case</span> _ =&gt;
        <span class="keyword">val</span> <a title="java.lang.Class[_ &gt;: ?0 with ?0]" id="179804">clazz</a> = <span title="java.lang.Class[_147]" class="keyword">if</span> (<a href="#179305" title="=&gt; java.lang.ClassLoader">loader</a>.<span title="(x$1: java.lang.String)java.lang.Class[_]">loadClass</span>(<a href="#179653" title="String">className</a>).<a title="()Boolean" id="4102">isInterface</a>()) {
          // Scala source: class A { ... };
          // Java bytecode: interface A.class + class A$class.class
          <a href="#179305" title="=&gt; java.lang.ClassLoader">loader</a>.<span title="(x$1: java.lang.String)java.lang.Class[_]">loadClass</span>(<a href="#179653" title="(x$1: Any)java.lang.String">className</a> + <span title="java.lang.String(&quot;$class&quot;)" class="string">&quot;$class&quot;</span>)
        }
        <span class="keyword">else</span> {
          // Scala source: object A { ... };
          // Java bytecode: interface A.class + class A$.class
          <a href="#179305" title="=&gt; java.lang.ClassLoader">loader</a>.<span title="(x$1: java.lang.String)java.lang.Class[_]">loadClass</span>(<a href="#179653" title="(x$1: Any)java.lang.String">className</a> + <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span>)
        }
        <a href="../collection/generic/MutableMapTemplate.scala.html#57772" title="(key: String,value: java.lang.Class[_])Unit">ccache</a>(<a href="#179653" title="String">className</a>) = <a href="#179804" title="java.lang.Class[_ &gt;: ?0 with ?0]">clazz</a>
        <a href="#179804" title="java.lang.Class[_ &gt;: ?0 with ?0]">clazz</a>
    }
  )

}

/** The object &lt;code&gt;Location&lt;/code&gt; can be used to instantiate
 *  objects on the same Java VM. It is just provided to illustrate
 *  the special case where resources are available locally.&lt;p/&gt;
 *
 *  Example:&lt;pre&gt;
 *    &lt;b&gt;val&lt;/b&gt; obj = Location.create(&quot;xcode.Math&quot;);
 *    &lt;b&gt;val&lt;/b&gt; x = obj[Int, Int](&quot;square&quot;)(5);&lt;/pre&gt;
 *
 *  @author  Stephane Micheloud
 *  @version 1.0, 04/05/2004
 */
<span class="keyword">object</span> <a title="object scala.mobile.Location" id="15108">Location</a> <a href="../ScalaObject.scala.html#957" title="ScalaObject" class="keyword">extends</a> <a href="#15107" title="scala.mobile.Location">Location</a>(<span title="Null(null)" class="keyword">null</span>)

        </pre>
    </body>
</html>