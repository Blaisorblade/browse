<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/actors/MessageQueue.scala</title>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2005-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: MessageQueue.scala 16893 2009-01-13 13:09:22Z cunei $</span>

<span class="keyword">package</span> scala.actors

<span class="comment">/**
 * This class is used by our efficient message queue
 * implementation.
 *
 * @version 0.9.9
 * @author Philipp Haller
 */</span>
@<span class="typed"><span class="type">serializable</span><a href="../serializable.scala.html#647">serializable</a></span>
<span class="keyword">class</span> <span class="typed"><span class="type">class MessageQueueElement extends java.lang.Object with ScalaObject</span><a id="8129">MessageQueueElement</a></span> {
  <span class="keyword">var</span> <span class="typed"><span class="type">Any</span><span id="37574"><span id="37572"><span id="37573"><a id="58007">msg</a></span></span></span></span>: <span class="typed"><span class="type">Any</span><a id="49">Any</a></span> = _
  <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.OutputChannel[Any]</span><span id="37577"><span id="37575"><span id="37576"><a id="58008">session</a></span></span></span></span>: <span class="typed"><span class="type">scala.actors.OutputChannel[Any]</span><a href="OutputChannel.scala.html#8150">OutputChannel</a></span>[Any] = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
  <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><span id="37580"><span id="37578"><span id="37579"><a id="58009">next</a></span></span></span></span>: <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#8129">MessageQueueElement</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
}

<span class="comment">/**
 * The class &lt;code&gt;MessageQueue&lt;/code&gt; provides an efficient
 * implementation of a message queue specialized for this actor
 * library. Classes in this package are supposed to be the only
 * clients of this class.
 *
 * @version 0.9.9
 * @author Philipp Haller
 */</span>
@<span class="typed"><span class="type">serializable</span><a href="../serializable.scala.html#647">serializable</a></span>
<span class="keyword">class</span> <span class="typed"><span class="type">class MessageQueue extends java.lang.Object with ScalaObject</span><a id="8138">MessageQueue</a></span> {
  <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><span id="37468"><span id="37466"><span id="37467"><a id="58011">first</a></span></span></span></span>: <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#8129">MessageQueueElement</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
  <span class="comment">// last == null iff list empty</span>
  <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><span id="37471"><span id="37469"><span id="37470"><a id="58012">last</a></span></span></span></span>: <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#8129">MessageQueueElement</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>

  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="37472">isEmpty</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span>

  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><span id="37475"><span id="37473"><span id="37474"><a id="58013">_size</a></span></span></span></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; Int</span><a id="37476">size</a></span> = <span class="typed"><span class="type">=&gt; Int</span><a href="#37473">_size</a></span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Int)Unit</span><a id="37477">changeSize</a></span>(<span class="typed"><span class="type">Int</span><a id="37546">diff</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>) = {
    <span class="typed"><span class="type">(Int)Unit</span><a href="#37474">_size</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int</span><a href="#37546">diff</a></span>
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(Any,scala.actors.OutputChannel[Any])Unit</span><a id="37478">append</a></span>(<span class="typed"><span class="type">Any</span><a id="37543">msg</a></span>: <span class="typed"><span class="type">Any</span><a id="49">Any</a></span>, <span class="typed"><span class="type">scala.actors.OutputChannel[Any]</span><a id="37544">session</a></span>: <span class="typed"><span class="type">scala.actors.OutputChannel[Any]</span><a href="OutputChannel.scala.html#8150">OutputChannel</a></span>[Any]) = {
    <span class="typed"><span class="type">(Int)Unit</span><a href="#37477">changeSize</a></span>(<span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="comment">// size always increases by 1</span>

    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span>) { <span class="comment">// list empty</span>
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="37581">el</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#8129">MessageQueueElement</a></span>
      <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#37581">el</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a href="#37573">msg</a></span> = <span class="typed"><span class="type">Any</span><a href="#37543">msg</a></span>
      <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#37581">el</a></span>.<span class="typed"><span class="type">(scala.actors.OutputChannel[Any])Unit</span><a href="#37576">session</a></span> = <span class="typed"><span class="type">scala.actors.OutputChannel[Any]</span><a href="#37544">session</a></span>
      <span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37467">first</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#37581">el</a></span>
      <span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37470">last</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#37581">el</a></span>
    }
    <span class="keyword">else</span> {
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="37582">el</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#8129">MessageQueueElement</a></span>
      <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#37582">el</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a href="#37573">msg</a></span> = <span class="typed"><span class="type">Any</span><a href="#37543">msg</a></span>
      <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#37582">el</a></span>.<span class="typed"><span class="type">(scala.actors.OutputChannel[Any])Unit</span><a href="#37576">session</a></span> = <span class="typed"><span class="type">scala.actors.OutputChannel[Any]</span><a href="#37544">session</a></span>
      <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span>.<span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37579">next</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#37582">el</a></span>
      <span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37470">last</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#37582">el</a></span>
    }
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">[B](B)((B, Any) =&gt; B)B</span><a id="37479">foldLeft</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="37481">B</a></span>](<span class="typed"><span class="type">B</span><a id="58016">z</a></span>: <span class="typed"><span class="type">B</span><a href="#37481">B</a></span>)(<span class="typed"><span class="type">(B, Any) =&gt; B</span><a id="58017">f</a></span>: (B, Any) =&gt; B): <span class="typed"><span class="type">B</span><a href="#37481">B</a></span> = {
    <span class="keyword">var</span> <span class="typed"><span class="type">B</span><a id="58018">acc</a></span> = <span class="typed"><span class="type">B</span><a href="#58016">z</a></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="58019">curr</a></span> = <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>
    <span class="typed"><span class="type">Unit</span><a href="#58020" class="keyword">while</a></span> (<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58019">curr</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
      <span class="typed"><span class="type">B</span><a href="#58018">acc</a></span> = <span class="typed"><span class="type">(B,Any)B</span><a href="../Function2.scala.html#20399">f</a></span>(<span class="typed"><span class="type">B</span><a href="#58018">acc</a></span>, <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58019">curr</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>)
      <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58019">curr</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58019">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span>
    }
    <span class="typed"><span class="type">B</span><a href="#58018">acc</a></span>
  }

  <span class="comment">/** Returns the n-th msg that satisfies the predicate
   *  without removing it.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Int)((Any) =&gt; Boolean)Option[Any]</span><a id="37482">get</a></span>(<span class="typed"><span class="type">Int</span><a id="58023">n</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>)(<span class="typed"><span class="type">(Any) =&gt; Boolean</span><a id="58024">p</a></span>: Any =&gt; Boolean): <span class="typed"><span class="type">Option[Any]</span><a href="../Option.scala.html#932">Option</a></span>[Any] = {
    <span class="keyword">var</span> <span class="typed"><span class="type">Option[Any]</span><a id="58025">found</a></span>: <span class="typed"><span class="type">Option[Any]</span><a href="../Option.scala.html#932">Option</a></span>[Any] = <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="58026">pos</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>

    <span class="keyword">def</span> <span class="typed"><span class="type">(Any)Boolean</span><a id="58027">test</a></span>(<span class="typed"><span class="type">Any</span><a id="58028">msg</a></span>: <span class="typed"><span class="type">Any</span><a id="49">Any</a></span>): <span class="typed"><span class="type">Boolean</span><a id="2168">Boolean</a></span> =
      <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Any)Boolean</span><a href="../Function1.scala.html#17300">p</a></span>(<span class="typed"><span class="type">Any</span><a href="#58028">msg</a></span>)) {
        <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#58026">pos</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int</span><a href="#58023">n</a></span>)
          <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
        <span class="keyword">else</span> {
          <span class="typed"><span class="type">Int</span><a href="#58026">pos</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
          <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
        }
      } <span class="keyword">else</span>
        <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>

    <span class="typed"><span class="type">Option[Any]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3507">==</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span>
    <span class="keyword">else</span> <span class="typed"><span class="type">Option[Any]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Any)Boolean</span><a href="#58027">test</a></span>(<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>))
      <span class="typed"><span class="type">(Any)Some[Any]</span><a href="../Option.scala.html#19455">Some</a></span>(<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>)
    <span class="keyword">else</span> {
      <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="58057">curr</a></span> = <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>
      <span class="typed"><span class="type">Unit</span><a href="#58058" class="keyword">while</a></span>(<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58057">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2749">&amp;&amp;</a></span> <span class="typed"><span class="type">Option[Any]</span><a href="#58025">found</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../Option.scala.html#18268">isEmpty</a></span>) {
        <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58057">curr</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58057">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Any)Boolean</span><a href="#58027">test</a></span>(<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58057">curr</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>))
          <span class="typed"><span class="type">Option[Any]</span><a href="#58025">found</a></span> = <span class="typed"><span class="type">(Any)Some[Any]</span><a href="../Option.scala.html#19455">Some</a></span>(<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58057">curr</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>)
      }
      <span class="typed"><span class="type">Option[Any]</span><a href="#58025">found</a></span>
    }
  }

  <span class="comment">/** Removes the n-th msg that satisfies the predicate.
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Int)((Any) =&gt; Boolean)Option[(Any, scala.actors.OutputChannel[Any])]</span><a id="37483">remove</a></span>(<span class="typed"><span class="type">Int</span><a id="58062">n</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>)(<span class="typed"><span class="type">(Any) =&gt; Boolean</span><a id="58063">p</a></span>: Any =&gt; Boolean): <span class="typed"><span class="type">Option[(Any, scala.actors.OutputChannel[Any])]</span><a href="../Option.scala.html#932">Option</a></span>[(Any, OutputChannel[Any])] = {
    <span class="keyword">var</span> <span class="typed"><span class="type">Option[(Any, scala.actors.OutputChannel[Any])]</span><a id="58064">found</a></span>: <span class="typed"><span class="type">Option[(Any, scala.actors.OutputChannel[Any])]</span><a href="../Option.scala.html#932">Option</a></span>[(Any, OutputChannel[Any])] = <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="58065">pos</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>

    <span class="keyword">def</span> <span class="typed"><span class="type">(Any)Boolean</span><a id="58066">test</a></span>(<span class="typed"><span class="type">Any</span><a id="58067">msg</a></span>: <span class="typed"><span class="type">Any</span><a id="49">Any</a></span>): <span class="typed"><span class="type">Boolean</span><a id="2168">Boolean</a></span> =
      <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Any)Boolean</span><a href="../Function1.scala.html#17300">p</a></span>(<span class="typed"><span class="type">Any</span><a href="#58067">msg</a></span>)) {
        <span class="typed"><span class="type">Boolean</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#58065">pos</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int</span><a href="#58062">n</a></span>)
          <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
        <span class="keyword">else</span> {
          <span class="typed"><span class="type">Int</span><a href="#58065">pos</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
          <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
        }
      } <span class="keyword">else</span>
        <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>

    <span class="typed"><span class="type">Option[(Any, scala.actors.OutputChannel[Any])]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3507">==</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span>
    <span class="keyword">else</span> <span class="typed"><span class="type">Option[(Any, scala.actors.OutputChannel[Any])]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Any)Boolean</span><a href="#58066">test</a></span>(<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>)) {
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="58094">tmp</a></span> = <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>
      <span class="comment">// remove first element</span>
      <span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37467">first</a></span> = <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span>
      <span class="comment">// might have to update last</span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58094">tmp</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span>) {
        <span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37470">last</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
      }
      <span class="typed"><span class="type">((Any, scala.actors.OutputChannel[Any]))Some[(Any, scala.actors.OutputChannel[Any])]</span><a href="../Option.scala.html#19455">Some</a></span>(<span class="typed"><span class="type">(Any,scala.actors.OutputChannel[Any])(Any, scala.actors.OutputChannel[Any])</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58094">tmp</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>, <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58094">tmp</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.OutputChannel[Any]</span><a href="#37575">session</a></span>))
    } <span class="keyword">else</span> {
      <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="58098">curr</a></span> = <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>
      <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="58099">prev</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span>
      <span class="typed"><span class="type">Unit</span><a href="#58100" class="keyword">while</a></span>(<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2749">&amp;&amp;</a></span> <span class="typed"><span class="type">Option[(Any, scala.actors.OutputChannel[Any])]</span><a href="#58064">found</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../Option.scala.html#18268">isEmpty</a></span>) {
        <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58099">prev</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span>
        <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Any)Boolean</span><a href="#58066">test</a></span>(<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>)) {
          <span class="comment">// remove curr</span>
          <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58099">prev</a></span>.<span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37579">next</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span>
          <span class="comment">// might have to update last</span>
          <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span>) {
            <span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37470">last</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58099">prev</a></span>
          }
          <span class="typed"><span class="type">Option[(Any, scala.actors.OutputChannel[Any])]</span><a href="#58064">found</a></span> = <span class="typed"><span class="type">((Any, scala.actors.OutputChannel[Any]))Some[(Any, scala.actors.OutputChannel[Any])]</span><a href="../Option.scala.html#19455">Some</a></span>(<span class="typed"><span class="type">(Any,scala.actors.OutputChannel[Any])(Any, scala.actors.OutputChannel[Any])</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>, <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58098">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.OutputChannel[Any]</span><a href="#37575">session</a></span>))
        }
      }
      <span class="typed"><span class="type">Option[(Any, scala.actors.OutputChannel[Any])]</span><a href="#58064">found</a></span>
    }
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">((Any) =&gt; Boolean)scala.actors.MessageQueueElement</span><a id="37484">extractFirst</a></span>(<span class="typed"><span class="type">(Any) =&gt; Boolean</span><a id="37607">p</a></span>: Any =&gt; Boolean): <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#8129">MessageQueueElement</a></span> = {
    <span class="typed"><span class="type">(Int)Unit</span><a href="#37477">changeSize</a></span>(-<span class="typed"><span class="type">Int(-1)</span><span class="int">1</span></span>) <span class="comment">// assume size decreases by 1</span>

    <span class="keyword">val</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="58106">msg</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span>) <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
    <span class="keyword">else</span> {
      <span class="comment">// test first element</span>
      <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Any)Boolean</span><a href="../Function1.scala.html#17300">p</a></span>(<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>)) {
        <span class="keyword">val</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="58107">tmp</a></span> = <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>
        <span class="comment">// remove first element</span>
        <span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37467">first</a></span> = <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span>

        <span class="comment">// might have to update last</span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58107">tmp</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span>) {
          <span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37470">last</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
        }

        <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58107">tmp</a></span>
      }
      <span class="keyword">else</span> {
        <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="58108">curr</a></span> = <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37466">first</a></span>
        <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a id="58109">prev</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58108">curr</a></span>
        <span class="typed"><span class="type">Unit</span><a href="#58110" class="keyword">while</a></span>(<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58108">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
          <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58109">prev</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58108">curr</a></span>
          <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58108">curr</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58108">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span>
          <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Any)Boolean</span><a href="../Function1.scala.html#17300">p</a></span>(<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58108">curr</a></span>.<span class="typed"><span class="type">=&gt; Any</span><a href="#37572">msg</a></span>)) {
            <span class="comment">// remove curr</span>
            <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58109">prev</a></span>.<span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37579">next</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58108">curr</a></span>.<span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37578">next</a></span>

            <span class="comment">// might have to update last</span>
            <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58108">curr</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">=&gt; scala.actors.MessageQueueElement</span><a href="#37469">last</a></span>) {
              <span class="typed"><span class="type">(scala.actors.MessageQueueElement)Unit</span><a href="#37470">last</a></span> = <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58109">prev</a></span>
            }

            <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58108">curr</a></span>
          }
        }
        <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
      }
    }

    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58106">msg</a></span>)
      <span class="typed"><span class="type">(Int)Unit</span><a href="#37477">changeSize</a></span>(<span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>) <span class="comment">// correct wrong assumption</span>

    <span class="typed"><span class="type">scala.actors.MessageQueueElement</span><a href="#58106">msg</a></span>
  }
}

        </pre>
    </body>
</html>