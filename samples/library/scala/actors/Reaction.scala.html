<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/actors/Reaction.scala</title>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2005-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |                                         **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: Reaction.scala 17380 2009-03-25 10:25:20Z phaller $</span>


<span class="keyword">package</span> scala.actors

<span class="keyword">import</span> java.lang.{InterruptedException, Runnable}

<span class="comment">/** &lt;p&gt;
 *    This exception is thrown whenever an actor exits.
 *    Its purpose is to let &lt;code&gt;exit&lt;/code&gt; have
 *    return type &lt;code&gt;Nothing&lt;/code&gt;.
 *  &lt;/p&gt;
 *
 *  @version 0.9.10
 *  @author Philipp Haller
 */</span>
<span class="keyword">private</span>[actors] <span class="keyword">class</span> <span class="typed"><span class="type">class ExitActorException extends java.lang.Throwable with ScalaObject</span><a id="8063">ExitActorException</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="../Predef.scala.html#13331">Throwable</a></span> {
  <span class="comment">/*
   * For efficiency reasons we do not fill in
   * the execution stack trace.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Throwable</span><a id="38297">fillInStackTrace</a></span>(): <span class="typed"><span class="type">Throwable</span><a id="2141">Throwable</a></span> = <span class="typed"><span class="type">scala.actors.ExitActorException</span><a href="#8063" class="keyword">this</a></span>
}

<span class="keyword">private</span>[actors] <span class="keyword">class</span> <span class="typed"><span class="type">class KillActorException extends java.lang.Throwable with ScalaObject</span><a id="8240">KillActorException</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">java.lang.Throwable</span><a href="../Predef.scala.html#13331">Throwable</a></span> {
  <span class="comment">/*
   * For efficiency reasons we do not fill in
   * the execution stack trace.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Throwable</span><a id="37458">fillInStackTrace</a></span>(): <span class="typed"><span class="type">Throwable</span><a id="2141">Throwable</a></span> = <span class="typed"><span class="type">scala.actors.KillActorException</span><a href="#8240" class="keyword">this</a></span>
}

<span class="comment">/** &lt;p&gt;
 *    The abstract class &lt;code&gt;Reaction&lt;/code&gt; associates
 *    an instance of an &lt;code&gt;Actor&lt;/code&gt; with a
 *    &lt;a class=&quot;java/lang/Runnable&quot; href=&quot;&quot; target=&quot;contentFrame&quot;&gt;
 *    &lt;code&gt;java.lang.Runnable&lt;/code&gt;&lt;/a&gt;.
 *  &lt;/p&gt;
 *
 *  @version 0.9.10
 *  @author Philipp Haller
 */</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class Reaction extends java.lang.Object with java.lang.Runnable with ScalaObject</span><a id="8234">Reaction</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">java.lang.Runnable</span><a id="2063">Runnable</a></span> {

  <span class="keyword">private</span>[actors] <span class="keyword">var</span> <span class="typed"><span class="type">scala.actors.Actor</span><span id="37518"><span id="37516"><span id="37517"><a id="46558">a</a></span></span></span></span>: <span class="typed"><span class="type">scala.actors.Actor</span><a href="Actor.scala.html#7907">Actor</a></span> = _
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">PartialFunction[Any,Unit]</span><span id="37521"><span id="37519"><span id="37520"><a id="46559">f</a></span></span></span></span>: <span class="typed"><span class="type">PartialFunction[Any,Unit]</span><a href="../PartialFunction.scala.html#1295">PartialFunction</a></span>[Any, Unit] = _
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Any</span><span id="37524"><span id="37522"><span id="37523"><a id="46560">msg</a></span></span></span></span>: <span class="typed"><span class="type">Any</span><a id="49">Any</a></span> = _

  <span class="keyword">def</span> <span class="typed"><span class="type">(scala.actors.Actor,PartialFunction[Any,Unit],Any)scala.actors.Reaction</span><a id="37525" class="keyword">this</a></span>(<span class="typed"><span class="type">scala.actors.Actor</span><a id="37540">a</a></span>: <span class="typed"><span class="type">scala.actors.Actor</span><a href="Actor.scala.html#7907">Actor</a></span>, <span class="typed"><span class="type">PartialFunction[Any,Unit]</span><a id="37541">f</a></span>: <span class="typed"><span class="type">PartialFunction[Any,Unit]</span><a href="../PartialFunction.scala.html#1295">PartialFunction</a></span>[Any, Unit], <span class="typed"><span class="type">Any</span><a id="37542">msg</a></span>: <span class="typed"><span class="type">Any</span><a id="49">Any</a></span>) = <span class="typed"><span class="type">Unit</span><span >{</span></span>
    <span class="typed"><span class="type">Reaction.this.type</span><a href="#8234" class="keyword">this</a></span>()
    <span class="typed"><span class="type">Reaction.this.type</span><a href="#8234" class="keyword">this</a></span>.<span class="typed"><span class="type">(scala.actors.Actor)Unit</span><a href="#37517">a</a></span> = <span class="typed"><span class="type">scala.actors.Actor</span><a href="#37540">a</a></span>
    <span class="typed"><span class="type">Reaction.this.type</span><a href="#8234" class="keyword">this</a></span>.<span class="typed"><span class="type">(PartialFunction[Any,Unit])Unit</span><a href="#37520">f</a></span> = <span class="typed"><span class="type">PartialFunction[Any,Unit]</span><a href="#37541">f</a></span>
    <span class="typed"><span class="type">Reaction.this.type</span><a href="#8234" class="keyword">this</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a href="#37523">msg</a></span> = <span class="typed"><span class="type">Any</span><a href="#37542">msg</a></span>
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(scala.actors.Actor)scala.actors.Reaction</span><a id="37526" class="keyword">this</a></span>(<span class="typed"><span class="type">scala.actors.Actor</span><a id="37529">a</a></span>: <span class="typed"><span class="type">scala.actors.Actor</span><a href="Actor.scala.html#7907">Actor</a></span>) = <span class="typed"><span class="type">(scala.actors.Actor,PartialFunction[Any,Unit],Any)scala.actors.Reaction</span><a href="#37525" class="keyword">this</a></span>(<span class="typed"><span class="type">scala.actors.Actor</span><a href="#37529">a</a></span>, <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>, <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>)

  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="37527">run</a></span>() {
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.actors.Actor</span><a id="46583">saved</a></span> = <span class="typed"><span class="type">object scala.actors.Actor</span><a href="Actor.scala.html#7908">Actor</a></span>.<span class="typed"><span class="type">=&gt; java.lang.ThreadLocal[scala.actors.Actor]</span><a href="Actor.scala.html#27708">tl</a></span>.<span class="typed"><span class="type">()scala.actors.Actor</span><a id="20499">get</a></span>.<span class="typed"><span class="type">scala.actors.Actor</span><a id="3501">asInstanceOf</a></span>[<span class="typed"><span class="type">scala.actors.Actor</span><a href="Actor.scala.html#7907">Actor</a></span>]
    <span class="typed"><span class="type">object scala.actors.Actor</span><a href="Actor.scala.html#7908">Actor</a></span>.<span class="typed"><span class="type">=&gt; java.lang.ThreadLocal[scala.actors.Actor]</span><a href="Actor.scala.html#27708">tl</a></span>.<span class="typed"><span class="type">(scala.actors.Actor)Unit</span><a id="20500">set</a></span>(<span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>)
    <span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">(Boolean)Unit</span><a href="Actor.scala.html#27661">isDetached</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
    <span class="keyword">try</span> {
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="Actor.scala.html#27690">shouldExit</a></span>) <span class="comment">// links</span>
        <span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">()Nothing</span><a href="Actor.scala.html#27694">exit</a></span>()
      <span class="keyword">else</span> {
        <span class="keyword">try</span> {
          <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; PartialFunction[Any,Unit]</span><a href="#37519">f</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3507">==</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>)
            <span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">()Unit</span><a href="Actor.scala.html#27641">act</a></span>()
          <span class="keyword">else</span>
            <span class="typed"><span class="type">(Any)Unit</span><a href="../Function1.scala.html#17300">f</a></span>(<span class="typed"><span class="type">=&gt; Any</span><a href="#37522">msg</a></span>)
        } <span class="keyword">catch</span> {
          <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _: <span class="typed"><span class="type">scala.actors.KillActorException</span><a href="#8240">KillActorException</a></span> =&gt;
        }
        <span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">()Unit</span><a href="../Function0.scala.html#21123">kill</a></span>(); <span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">()Nothing</span><a href="Actor.scala.html#27694">exit</a></span>()
      }
    }
    <span class="keyword">catch</span> {
      <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">scala.actors.ExitActorException</span><a id="46604">eae</a></span>: <span class="typed"><span class="type">scala.actors.ExitActorException</span><a href="#8063">ExitActorException</a></span> =&gt; {
        <span class="comment">//Debug.info(a+&quot;: exiting...&quot;)</span>
        <span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">()Unit</span><a href="Actor.scala.html#27698">terminated</a></span>()
      }
      <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _: <span class="typed"><span class="type">scala.actors.SuspendActorException</span><a href="Actor.scala.html#8171">SuspendActorException</a></span> =&gt; <span class="typed"><span class="type">Unit</span><span >{</span></span>
        <span class="comment">// do nothing (continuation is already saved)</span>
      }
      <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="46605">t</a></span>: <span class="typed"><span class="type">Throwable</span><a id="2141">Throwable</a></span> =&gt; {
        <span class="typed"><span class="type">object scala.actors.Debug</span><a href="Debug.scala.html#8211">Debug</a></span>.<span class="typed"><span class="type">(String)Unit</span><a href="Debug.scala.html#40072">info</a></span>(<span class="typed"><span class="type">implicit scala.Predef.any2stringadd : (Any)scala.runtime.StringAdd</span><a href="../Predef.scala.html#13520">a</a></span><span class="typed"><span class="type">(String)java.lang.String</span><a href="../runtime/StringAdd.scala.html#19198">+</a></span><span class="typed"><span class="type">java.lang.String(&quot;: caught &quot;)</span><span class="string">&quot;: caught &quot;</span></span><span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span><span class="typed"><span class="type">java.lang.Throwable</span><a href="#46605">t</a></span>)
        <span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">()Unit</span><a href="Actor.scala.html#27698">terminated</a></span>()
        <span class="comment">// links</span>
        <span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">(Unit)Unit</span><a id="5794">synchronized</a></span> {
          <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2745">!</a></span><span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">=&gt; List[scala.actors.AbstractActor]</span><a href="Actor.scala.html#27676">links</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../Seq.scala.html#17149">isEmpty</a></span>)
            <span class="typed"><span class="type">=&gt; scala.actors.Actor</span><a href="#37516">a</a></span>.<span class="typed"><span class="type">(AnyRef)Unit</span><a href="Actor.scala.html#27696">exitLinked</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#46605">t</a></span>)
          <span class="keyword">else</span>
            <span class="typed"><span class="type">java.lang.Throwable</span><a href="#46605">t</a></span>.<span class="typed"><span class="type">()Unit</span><a id="19187">printStackTrace</a></span>()
        }
      }
    } <span class="keyword">finally</span> {
      <span class="typed"><span class="type">object scala.actors.Actor</span><a href="Actor.scala.html#7908">Actor</a></span>.<span class="typed"><span class="type">=&gt; java.lang.ThreadLocal[scala.actors.Actor]</span><a href="Actor.scala.html#27708">tl</a></span>.<span class="typed"><span class="type">(scala.actors.Actor)Unit</span><a id="20500">set</a></span>(<span class="typed"><span class="type">scala.actors.Actor</span><a href="#46583">saved</a></span>)
      <span class="typed"><span class="type">Reaction.this.type</span><a href="#8234" class="keyword">this</a></span>.<span class="typed"><span class="type">(scala.actors.Actor)Unit</span><a href="#37517">a</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
      <span class="typed"><span class="type">Reaction.this.type</span><a href="#8234" class="keyword">this</a></span>.<span class="typed"><span class="type">(PartialFunction[Any,Unit])Unit</span><a href="#37520">f</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
      <span class="typed"><span class="type">Reaction.this.type</span><a href="#8234" class="keyword">this</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a href="#37523">msg</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
    }
  }

}

        </pre>
    </body>
</html>