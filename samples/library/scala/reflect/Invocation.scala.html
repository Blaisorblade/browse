<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/reflect/Invocation.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2002-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

// $Id: $


<span class="keyword">package</span> scala.reflect

<span class="keyword">import</span> scala.annotation.experimental
<span class="keyword">import</span> scala.util.control.Exception.catching
<span class="keyword">import</span> java.lang.{ Class =&gt; JClass }
<span class="keyword">import</span> java.lang.reflect.{ Method =&gt; JMethod }
<span class="keyword">import</span> scala.{ Symbol =&gt; ScalaSymbol }

/** &lt;p&gt;
 *    A more convenient syntax for reflective invocation.&lt;br/&gt;
 *    Example usage:
 *  &lt;/p&gt;&lt;pre&gt;
 *    &lt;b&gt;class&lt;/b&gt; Obj { &lt;b&gt;private def&lt;/b&gt; foo(x: Int, y: String): Long = x + y.length }&lt;/pre&gt;
 *  &lt;p&gt;
 *    You can call it reflectively one of two ways:
 *  &lt;/p&gt;&lt;pre&gt;
 *    &lt;b&gt;import&lt;/b&gt; scala.reflect.Invocation._
 *    (&lt;b&gt;new&lt;/b&gt; Obj) o 'foo(5, &quot;abc&quot;)                 // the 'o' method returns Any
 *    &lt;b&gt;val&lt;/b&gt; x: Long = (&lt;b&gt;new&lt;/b&gt; Obj) oo 'foo(5, &quot;abc&quot;)  // the 'oo' method casts to expected type.&lt;/pre&gt;
 *  &lt;p&gt;
 *    If you call the &lt;code&gt;oo&lt;/code&gt; method and do not give the type inferencer
 *    enough help, it will most likely infer &lt;code&gt;Nothing&lt;/code&gt;, which will
 *    result in a &lt;code&gt;ClassCastException&lt;/code&gt;.
 *  &lt;/p&gt;
 *
 *  @author  Paul Phillips
 */
@experimental
<span class="keyword">object</span> <a title="object scala.reflect.Invocation" id="11783">Invocation</a>
<a href="../ScalaObject.scala.html#957" title="ScalaObject">{</a>
  /** &lt;p&gt;
   *    In order to encapsulate anything to do with reflection, we must
   *    overcome an issue with the boxing of primitives.  If we declare a
   *    method which takes arguments of type &lt;code&gt;Any&lt;/code&gt;, by the time the
   *    method parameters can be examined, the primitives have already been boxed.
   *    The reflective call will then fail because &lt;code&gt;classOf[java.lang.Integer]&lt;/code&gt;
   *    is not the same thing as &lt;code&gt;classOf[scala.Int].&lt;/code&gt;
   *  &lt;/p&gt;
   *  &lt;p&gt;
   *    Any useful workaround will require examining the arguments before
   *    the method is called.  The approach here is to define two implicits,
   *    one for &lt;code&gt;AnyRef&lt;/code&gt;'s and one for &lt;code&gt;AnyVal&lt;/code&gt;'s, and
   *    box them in a container which preserves their original class identity.
   *  &lt;/p&gt;
   */
  <span class="keyword">trait</span> <a title="trait PrimitivePreserver[T] extends java.lang.Object" id="225042">PrimitivePreserver</a>[<a title="&gt;: Nothing &lt;: Any" id="225043">T</a>] <a title="java.lang.Object" id="3623">{</a>
    <span class="keyword">val</span> <a title="=&gt; T" id="225070">value</a>: <a href="#225043" title="T">T</a>
    <span class="keyword">val</span> <a title="=&gt; java.lang.Class[_]" id="225071">clazz</a>: <span title="java.lang.Class[_]">JClass</span>[_]
  }
  case <span class="keyword">class</span> <a title="class PreservedAnyVal[T &lt;: AnyVal] extends java.lang.Object with scala.reflect.Invocation.PrimitivePreserver[T] with ScalaObject with Product" id="225122">PreservedAnyVal</a>[<a title="&gt;: Nothing &lt;: AnyVal" id="225124">T</a> &lt;: AnyVal]<a href="../ScalaObject.scala.html#957" title="ScalaObject">(</a><a title="T" id="225261">value</a>: <a href="#225124" title="T">T</a>) <span class="keyword">extends</span> <a href="#225042" title="scala.reflect.Invocation.PrimitivePreserver[T]">PrimitivePreserver</a>[T] {
    <span class="keyword">val</span> <a title="java.lang.Class[_]" id="225079">clazz</a> = <a href="#225066" title="(x: AnyVal)java.lang.Class[_]">getAnyValClass</a>(<a href="#225261" title="=&gt; T">value</a>)
  }
  case <span class="keyword">class</span> <a title="class PreservedAnyRef[T &lt;: AnyRef] extends java.lang.Object with scala.reflect.Invocation.PrimitivePreserver[T] with ScalaObject with Product" id="225203">PreservedAnyRef</a>[<a title="&gt;: Nothing &lt;: AnyRef" id="225205">T</a> &lt;: AnyRef]<a href="../ScalaObject.scala.html#957" title="ScalaObject">(</a><a title="T" id="225249">value</a>: <a href="#225205" title="T">T</a>) <span class="keyword">extends</span> <a href="#225042" title="scala.reflect.Invocation.PrimitivePreserver[T]">PrimitivePreserver</a>[T] {
    <span class="keyword">val</span> <a title="java.lang.Class[_]" id="225165">clazz</a> = <a href="#225249" title="=&gt; T">value</a>.<span title="()java.lang.Class[_]">getClass</span>
  }
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[T &lt;: AnyRef](x: T)scala.reflect.Invocation.PreservedAnyRef[T]" id="225052">makePreservedAnyRef</a>[<a title="&gt;: Nothing &lt;: AnyRef" id="225054">T</a> &lt;: AnyRef](<a title="T" id="225246">x</a>: <a href="#225054" title="T">T</a>) = <a href="#225203" title="(value: T)scala.reflect.Invocation.PreservedAnyRef[T]">PreservedAnyRef</a>(<a href="#225246" title="T">x</a>)
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[T &lt;: AnyVal](x: T)scala.reflect.Invocation.PreservedAnyVal[T]" id="225055">makePreservedAnyVal</a>[<a title="&gt;: Nothing &lt;: AnyVal" id="225057">T</a> &lt;: AnyVal](<a title="T" id="225258">x</a>: <a href="#225057" title="T">T</a>) = <a href="#225122" title="(value: T)scala.reflect.Invocation.PreservedAnyVal[T]">PreservedAnyVal</a>(<a href="#225258" title="T">x</a>)
  
  /** We also require an implicit on scala.Symbol so they appear to contain
   *  an apply method, which packages the method arguments.  The type parameter
   *  is the method's expected result type.
   */
  <span class="keyword">class</span> <a title="class SymbolWithArguments extends java.lang.Object with ScalaObject" id="225058">SymbolWithArguments</a><a href="../ScalaObject.scala.html#957" title="ScalaObject">(</a><span class="keyword">val</span> <a title="Symbol" id="225290">sym</a>: <a href="../Symbol.scala.html#732" title="Symbol">ScalaSymbol</a>, <span class="keyword">val</span> <a title="scala.reflect.Invocation.PrimitivePreserver[_]*" id="225291">args</a>: <span title="scala.reflect.Invocation.PrimitivePreserver[_]*">PrimitivePreserver</span>[_]*) {
    <span class="keyword">def</span> <a title="=&gt; Sequence[AnyRef]" id="225277">getArgs</a> = <a href="../collection/generic/TraversableTemplate.scala.html#17161" title="(f: (scala.reflect.Invocation.PrimitivePreserver[_]) =&gt; AnyRef)(implicit bf: scala.collection.generic.BuilderFactory[AnyRef,Sequence[AnyRef],Sequence[scala.reflect.Invocation.PrimitivePreserver[_]]])Sequence[AnyRef]">args</a> <a href="../collection/Sequence.scala.html#22039" title="scala.collection.generic.BuilderFactory[AnyRef,Sequence[AnyRef],Sequence#Coll]">map</a> (<a href="#225308" title="scala.reflect.Invocation.PrimitivePreserver[_]">_</a>.<a href="#225070" title="=&gt; Any">value</a>.<span title="[T0]T0">asInstanceOf</span><span title="AnyRef">[</span><span title="AnyRef">AnyRef</span>])
    <span class="keyword">def</span> <a title="=&gt; List[java.lang.Class[_]]" id="225278">getArgTypes</a> = <a href="#225291" title="=&gt; scala.reflect.Invocation.PrimitivePreserver[_]*">args</a>.<a href="../collection/generic/TraversableTemplate.scala.html#17161" title="(f: (scala.reflect.Invocation.PrimitivePreserver[_]) =&gt; java.lang.Class[_])(implicit bf: scala.collection.generic.BuilderFactory[java.lang.Class[_],List[java.lang.Class[_]],List[scala.reflect.Invocation.PrimitivePreserver[_]]])List[java.lang.Class[_]]">toList</a> <a href="../collection/immutable/List.scala.html#17526" title="scala.collection.generic.BuilderFactory[java.lang.Class[_],List[java.lang.Class[_]],List#Coll]">map</a> (<a href="#225399" title="scala.reflect.Invocation.PrimitivePreserver[_]">_</a>.<a href="#225071" title="=&gt; java.lang.Class[_]">clazz</a>)
    <span class="keyword">def</span> <a title="(m: java.lang.reflect.Method)Boolean" id="225279">argsMatch</a>(<a title="java.lang.reflect.Method" id="225903">m</a>: <a title="java.lang.reflect.Method" id="4012">JMethod</a>) = 
      <a href="../collection/immutable/List.scala.html#8974" title="object List">List</a>.<a href="../collection/immutable/List.scala.html#17585" title="(xs: List[java.lang.Class[_]],ys: List[java.lang.Class[_]])(f: (java.lang.Class[_], java.lang.Class[_]) =&gt; Boolean)List[Boolean]">map2</a>(<a href="#225903" title="java.lang.reflect.Method">m</a>.<a title="()Array[java.lang.Class[_]]" id="134573">getParameterTypes</a>.<a href="../collection/generic/TraversableTemplate.scala.html#17236" title="=&gt; List[java.lang.Class[_]]">toList</a>, <a href="#225278" title="=&gt; List[java.lang.Class[_]]">getArgTypes</a>)<a href="../collection/generic/LinearSequenceTemplate.scala.html#19405" title="(p: (Boolean) =&gt; Boolean)Boolean">(</a><a href="#225929" title="(x$1: java.lang.Class[_])Boolean" id="4097">_</a> isAssignableFrom <a href="#225930" title="java.lang.Class[_]">_</a>) forall (<a href="#225943" title="(x$1: Boolean)Boolean" id="2204">_</a> == <span title="Boolean(true)" class="keyword">true</span>)
        
    // only called if getMethod() fails - searches private methods too.
    <span class="keyword">def</span> <a title="(x: AnyRef)java.lang.reflect.Method" id="225280">getDeclaredMethodsOn</a>(<a title="AnyRef" id="225952">x</a>: <span title="AnyRef">AnyRef</span>) =
      (<a href="#225952" title="AnyRef">x</a>.<span title="()java.lang.Class[_]">getClass</span>.<a href="../collection/generic/TraversableTemplate.scala.html#17171" title="(p: (java.lang.reflect.Method) =&gt; Boolean)Array[java.lang.reflect.Method]" id="4854">getDeclaredMethods</a> <a href="../collection/generic/VectorTemplate.scala.html#17757" title="(p: (java.lang.reflect.Method) =&gt; Boolean)Option[java.lang.reflect.Method]">filter</a> (<a href="#225962" title="java.lang.reflect.Method">_</a>.<a title="(x$1: AnyRef)Boolean" id="134565">getName</a> == <a href="#225290" title="=&gt; Symbol">sym</a>.<a href="../Symbol.scala.html#44364" title="=&gt; String">name</a>) find <a href="#225279" title="(m: java.lang.reflect.Method)Boolean">argsMatch</a>) <span title="java.lang.reflect.Method" class="keyword">match</span> {
        <span title="java.lang.reflect.Method" class="keyword">case</span> Some(<a title="java.lang.reflect.Method" id="225985">m</a>)  =&gt; <a href="#225985" title="(x$1: Boolean)Unit" id="134631">m</a> setAccessible <span title="Boolean(true)" class="keyword">true</span> ; <a href="#225985" title="java.lang.reflect.Method">m</a>
        <span title="Nothing" class="keyword">case</span> <a href="../Option.scala.html#463" title="object None">None</a>     =&gt; <span title="Nothing" class="keyword">throw</span> <a title="(x$1: java.lang.String)java.lang.NoSuchMethodException" id="137711" class="keyword">new</a> <a title="java.lang.NoSuchMethodException" id="1831">NoSuchMethodException</a>(<a href="#225290" title="=&gt; Symbol">sym</a>.<a href="../Symbol.scala.html#44364" title="=&gt; String">name</a>)
      }
      
    <span class="keyword">def</span> <a title="(x: AnyRef)java.lang.reflect.Method" id="225281">getMethodOn</a>(<a title="AnyRef" id="225994">x</a>: <span title="AnyRef">AnyRef</span>) =
      <a href="../util/control/Exception.scala.html#31240" title="(exceptions: Class[_]*)util.control.Exception.Catch[Nothing]">catching</a>(classOf<span title="java.lang.Class[java.lang.NoSuchMethodException]">[</span>NoSuchMethodException]) .
        <a href="../util/control/Exception.scala.html#47482" title="(body: =&gt; java.lang.reflect.Method)Option[java.lang.reflect.Method]">opt</a> (<a href="#225994" title="AnyRef">x</a>.<span title="()java.lang.Class[_]">getClass</span>.<a title="(x$1: java.lang.String,x$2: java.lang.Class[_]*)java.lang.reflect.Method" id="4834">getMethod</a>(<a href="#225290" title="=&gt; Symbol">sym</a>.<a href="../Symbol.scala.html#44364" title="=&gt; String">name</a>, <a href="#225278" title="=&gt; List[java.lang.Class[_]]">getArgTypes</a>: _*)) .
        <a href="../Option.scala.html#19763" title="(default: =&gt; java.lang.reflect.Method)java.lang.reflect.Method">getOrElse</a> (<a href="#225280" title="(x: AnyRef)java.lang.reflect.Method">getDeclaredMethodsOn</a>(<a href="#225994" title="AnyRef">x</a>))

  }
  <span class="keyword">class</span> <a title="class RichSymbol extends java.lang.Object with ScalaObject" id="225059">RichSymbol</a><a href="../ScalaObject.scala.html#957" title="ScalaObject">(</a><a title="Symbol" id="226042">sym</a>: <a href="../Symbol.scala.html#732" title="Symbol">ScalaSymbol</a>) {
    <span class="keyword">def</span> <a title="(args: scala.reflect.Invocation.PrimitivePreserver[_]*)scala.reflect.Invocation.SymbolWithArguments" id="226039">apply</a>(<a title="scala.reflect.Invocation.PrimitivePreserver[_]*" id="226045">args</a>: <span title="scala.reflect.Invocation.PrimitivePreserver[_]*">PrimitivePreserver</span>[_]*): <a href="#225058" title="scala.reflect.Invocation.SymbolWithArguments">SymbolWithArguments</a> =
      <span title="scala.reflect.Invocation.SymbolWithArguments" class="keyword">new</span> <a href="#225058" title="scala.reflect.Invocation.SymbolWithArguments">SymbolWithArguments</a>(<a href="#226042" title="Symbol">sym</a>, <a href="#226045" title="scala.reflect.Invocation.PrimitivePreserver[_]*">args</a>: _*)
  }
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scala.reflect.Invocation.makeRichSymbol : (sym: Symbol)scala.reflect.Invocation.RichSymbol" id="225060">makeRichSymbol</a>(<a title="Symbol" id="225318">sym</a>: <a href="../Symbol.scala.html#732" title="Symbol">ScalaSymbol</a>): <a href="#225059" title="scala.reflect.Invocation.RichSymbol">RichSymbol</a> = <span title="scala.reflect.Invocation.RichSymbol" class="keyword">new</span> <a href="#225059" title="scala.reflect.Invocation.RichSymbol">RichSymbol</a>(<a href="#225318" title="Symbol">sym</a>)
  
  /** An implicit on AnyRef provides it with the 'o' method, which is supposed
   *  to look like a giant '.' and present the feel of method invocation.
   */
  <span class="keyword">class</span> <a title="class ReflectionOperators[T &lt;: AnyRef] extends java.lang.Object with ScalaObject" id="225061">ReflectionOperators</a>[<a title="&gt;: Nothing &lt;: AnyRef" id="225062">T</a> &lt;: AnyRef]<a href="../ScalaObject.scala.html#957" title="ScalaObject">(</a><a title="T" id="226074">self</a>: <a href="#225062" title="T">T</a>) {
    <span class="keyword">val</span> <a title="java.lang.Class[T]" id="226059">clazz</a> = <a href="#226074" title="T">self</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="[T0]T0">asInstanceOf</span><span title="java.lang.Class[T]">[</span><span title="java.lang.Class[T]">JClass</span>[T]] 
    
    /** Issue call without touching result - returns Any.
     */
    <span class="keyword">def</span> <a title="(sym: Symbol)Any" id="226061">o</a>(<a title="Symbol" id="226077">sym</a>: <a href="../Symbol.scala.html#732" title="Symbol">ScalaSymbol</a>): <span title="Any">Any</span> = <a href="#226066" title="(symApp: scala.reflect.Invocation.SymbolWithArguments)Nothing">oo</a>(<span title="scala.reflect.Invocation.SymbolWithArguments" class="keyword">new</span> <a href="#225058" title="scala.reflect.Invocation.SymbolWithArguments">SymbolWithArguments</a>(<a href="#226077" title="Symbol">sym</a>))
    <span class="keyword">def</span> <a title="(symApp: scala.reflect.Invocation.SymbolWithArguments)Any" id="226062">o</a>(<a title="scala.reflect.Invocation.SymbolWithArguments" id="226097">symApp</a>: <a href="#225058" title="scala.reflect.Invocation.SymbolWithArguments">SymbolWithArguments</a>): <span title="Any">Any</span> = <a href="#226066" title="(symApp: scala.reflect.Invocation.SymbolWithArguments)Nothing">oo</a>(<a href="#226097" title="scala.reflect.Invocation.SymbolWithArguments">symApp</a>)
    
    /** Issue call expecting return type R - casts result to R.
     */
    <span class="keyword">def</span> <a title="[R](sym: Symbol)R" id="226063">oo</a>[<a title="&gt;: Nothing &lt;: Any" id="226065">R</a>](<a title="Symbol" id="226085">sym</a>: <a href="../Symbol.scala.html#732" title="Symbol">ScalaSymbol</a>): <a href="#226065" title="R">R</a> = <a href="#226066" title="[R](symApp: scala.reflect.Invocation.SymbolWithArguments)R">oo</a><span title="(symApp: scala.reflect.Invocation.SymbolWithArguments)R">[</span><a href="#226065" title="R">R</a>](<span title="scala.reflect.Invocation.SymbolWithArguments" class="keyword">new</span> <a href="#225058" title="scala.reflect.Invocation.SymbolWithArguments">SymbolWithArguments</a>(<a href="#226085" title="Symbol">sym</a>))
    <span class="keyword">def</span> <a title="[R](symApp: scala.reflect.Invocation.SymbolWithArguments)R" id="226066">oo</a>[<a title="&gt;: Nothing &lt;: Any" id="226068">R</a>](<a title="scala.reflect.Invocation.SymbolWithArguments" id="226082">symApp</a>: <a href="#225058" title="scala.reflect.Invocation.SymbolWithArguments">SymbolWithArguments</a>): <a href="#226068" title="R">R</a> = {
      <span class="keyword">def</span> <a title="=&gt; java.lang.reflect.Method" id="226120">method</a> = <a href="#225281" title="(x: AnyRef)java.lang.reflect.Method">symApp</a> getMethodOn <a href="#226074" title="T">self</a>
      <a href="#226120" title="=&gt; java.lang.reflect.Method">method</a>.<a title="(x$1: Any,x$2: java.lang.Object*)java.lang.Object" id="134586">invoke</a>(<a href="#226074" title="T">self</a>, <a href="#226082" title="scala.reflect.Invocation.SymbolWithArguments">symApp</a>.<a href="#225277" title="=&gt; Sequence[AnyRef]">getArgs</a>: _*).<span title="[T0]T0">asInstanceOf</span><span title="R">[</span><a href="#226068" title="R">R</a>]
    }
  }
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[T &lt;: AnyRef](x: T)scala.reflect.Invocation.ReflectionOperators[T]" id="225063">makeReflectionOperators</a>[<a title="&gt;: Nothing &lt;: AnyRef" id="225065">T</a> &lt;: AnyRef](<a title="T" id="225320">x</a>: <a href="#225065" title="T">T</a>): <a href="#225061" title="scala.reflect.Invocation.ReflectionOperators[T]">ReflectionOperators</a>[T] =
    <span title="scala.reflect.Invocation.ReflectionOperators[T]" class="keyword">new</span> <a href="#225061" title="scala.reflect.Invocation.ReflectionOperators[T]">ReflectionOperators</a>(<a href="#225320" title="T">x</a>)
  
  /** Obtain the class object for an &lt;code&gt;AnyVal&lt;/code&gt;.
   */
  <span class="keyword">def</span> <a title="(x: AnyVal)java.lang.Class[_]" id="225066">getAnyValClass</a>(<a title="AnyVal" id="225086">x</a>: <a title="AnyVal" id="1947">AnyVal</a>): <span title="java.lang.Class[_]">JClass</span>[_] = <a href="#225086" title="AnyVal">x</a> <span title="java.lang.Class[_215]" class="keyword">match</span> {
    <span title="java.lang.Class[Byte]" class="keyword">case</span> _: <a title="Byte" id="2154">Byte</a>    =&gt; classOf<span title="java.lang.Class[Byte]">[</span>Byte]
    <span title="java.lang.Class[Short]" class="keyword">case</span> _: <a title="Short" id="2168">Short</a>   =&gt; classOf<span title="java.lang.Class[Short]">[</span>Short]
    <span title="java.lang.Class[Int]" class="keyword">case</span> _: <a title="Int" id="2175">Int</a>     =&gt; classOf<span title="java.lang.Class[Int]">[</span>Int]
    <span title="java.lang.Class[Long]" class="keyword">case</span> _: <a title="Long" id="2182">Long</a>    =&gt; classOf<span title="java.lang.Class[Long]">[</span>Long]
    <span title="java.lang.Class[Float]" class="keyword">case</span> _: <a title="Float" id="2189">Float</a>   =&gt; classOf<span title="java.lang.Class[Float]">[</span>Float]
    <span title="java.lang.Class[Double]" class="keyword">case</span> _: <a title="Double" id="2196">Double</a>  =&gt; classOf<span title="java.lang.Class[Double]">[</span>Double]
    <span title="java.lang.Class[Char]" class="keyword">case</span> _: <a title="Char" id="2161">Char</a>    =&gt; classOf<span title="java.lang.Class[Char]">[</span>Char]
    <span title="java.lang.Class[Boolean]" class="keyword">case</span> _: <a title="Boolean" id="1949">Boolean</a> =&gt; classOf<span title="java.lang.Class[Boolean]">[</span>Boolean]
    <span title="java.lang.Class[Unit]" class="keyword">case</span> _: <a title="Unit" id="1948">Unit</a>    =&gt; classOf<span title="java.lang.Class[Unit]">[</span>Unit]
  }  
}

        </pre>
    </body>
</html>