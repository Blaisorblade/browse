<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/concurrent/ops.scala</title>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: ops.scala 16893 2009-01-13 13:09:22Z cunei $</span>


<span class="keyword">package</span> scala.concurrent


<span class="keyword">import</span> java.lang.Thread

<span class="comment">/** The object &lt;code&gt;ops&lt;/code&gt; ...
 *
 *  @author  Martin Odersky, Stepan Koltsov
 *  @version 1.0, 12/03/2003
 */</span>
<span class="keyword">object</span> <span class="typed"><span class="type">object scala.concurrent.ops</span><a id="7728">ops</a></span> {
  <span class="comment">/**
   *  If expression computed successfully return it in &lt;code&gt;Left&lt;/code&gt;,
   *  otherwise return exception in &lt;code&gt;Right&lt;/code&gt;.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">[A](=&gt; A)Either[A,Throwable]</span><a id="20470">tryCatch</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="20472">A</a></span>](<span class="typed"><span class="type">=&gt; A</span><a id="108671">left</a></span>: =&gt; A): <span class="typed"><span class="type">Either[A,Throwable]</span><a href="../Either.scala.html#359">Either</a></span>[A, Throwable] = {
    <span class="keyword">try</span> {
      <span class="typed"><span class="type">(A)Left[A,Nothing]</span><a href="../Either.scala.html#28317">Left</a></span>(<span class="typed"><span class="type">=&gt; A</span><a href="#108671">left</a></span>)
    } <span class="keyword">catch</span> {
      <span class="typed"><span class="type">Right[Nothing,java.lang.Throwable]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.lang.Throwable</span><a id="108674">t</a></span> =&gt; <span class="typed"><span class="type">(java.lang.Throwable)Right[Nothing,java.lang.Throwable]</span><a href="../Either.scala.html#28338">Right</a></span>(<span class="typed"><span class="type">java.lang.Throwable</span><a href="#108674">t</a></span>)
    }
  }

  <span class="comment">/** Evaluates an expression asynchronously.
   *
   *  @param  p the expression to evaluate
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(=&gt; Unit)Unit</span><a id="20473">spawn</a></span>(<span class="typed"><span class="type">=&gt; Unit</span><a id="20483">p</a></span>: =&gt; Unit) = {
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.Thread</span><a id="20485">t</a></span> = <span class="typed"><span class="type">template $anon extends java.lang.Thread</span><a id="20486" class="keyword">new</a></span> <span class="typed"><span class="type">java.lang.Thread</span><a id="2081">Thread</a></span>() { <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="20799">run</a></span>() = <span class="typed"><span class="type">=&gt; Unit</span><a href="#20483">p</a></span> }
    <span class="typed"><span class="type">java.lang.Thread</span><a href="#20485">t</a></span>.<span class="typed"><span class="type">()Unit</span><a id="20759">start</a></span>()
  }

  <span class="comment">/**
   *  @param p ...
   *  @return  ...
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">[A](=&gt; A)() =&gt; A</span><a id="20474">future</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="20476">A</a></span>](<span class="typed"><span class="type">=&gt; A</span><a id="108677">p</a></span>: =&gt; A): () =&gt; A = {
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[A,Throwable]]</span><a id="108678">result</a></span> = <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[A,Throwable]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[A,Throwable]]</span><a href="SyncVar.scala.html#7868">SyncVar</a></span>[Either[A, Throwable]]
    <span class="typed"><span class="type">(=&gt; Unit)Unit</span><a href="#20473">spawn</a></span> { <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[A,Throwable]]</span><a href="#108678">result</a></span> <span class="typed"><span class="type">(Either[A,Throwable])Unit</span><a href="SyncVar.scala.html#54486">set</a></span> <span class="typed"><span class="type">(=&gt; A)Either[A,Throwable]</span><a href="#20470">tryCatch</a></span>(<span class="typed"><span class="type">=&gt; A</span><a href="#108677">p</a></span>) }
    () =&gt; <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[A,Throwable]]</span><a href="#108678">result</a></span>.<span class="typed"><span class="type">=&gt; Either[A,Throwable]</span><a href="SyncVar.scala.html#54484">get</a></span> <span class="typed"><span class="type">A</span><span class="keyword">match</span></span> {
    	<span class="typed"><span class="type">A</span><span class="keyword">case</span></span> <a id="1">Left</a>(<span class="typed"><span class="type">A</span><a id="108681">a</a></span>) =&gt; <span class="typed"><span class="type">A</span><a href="#108681">a</a></span>
    	<span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <a id="1">Right</a>(<span class="typed"><span class="type">Throwable</span><a id="108682">t</a></span>) =&gt; <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">Throwable</span><a href="#108682">t</a></span>
    }
  }

  <span class="comment">/**
   *  @param xp ...
   *  @param yp ...
   *  @return   ...
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">[A, B](=&gt; A,=&gt; B)(A, B)</span><a id="20477">par</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="20480">A</a></span>, <span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="20481">B</a></span>](<span class="typed"><span class="type">=&gt; A</span><a id="108683">xp</a></span>: =&gt; A, <span class="typed"><span class="type">=&gt; B</span><a id="108684">yp</a></span>: =&gt; B): <span class="typed"><span class="type">(A, B)</span><a href="../Tuple2.scala.html#1376">(</a></span>A, B) = {
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[B,Throwable]]</span><a id="108685">y</a></span> = <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[B,Throwable]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[B,Throwable]]</span><a href="SyncVar.scala.html#7868">SyncVar</a></span>[Either[B, Throwable]]
    <span class="typed"><span class="type">(=&gt; Unit)Unit</span><a href="#20473">spawn</a></span> { <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[B,Throwable]]</span><a href="#108685">y</a></span> <span class="typed"><span class="type">(Either[B,Throwable])Unit</span><a href="SyncVar.scala.html#54486">set</a></span> <span class="typed"><span class="type">(=&gt; B)Either[B,Throwable]</span><a href="#20470">tryCatch</a></span>(<span class="typed"><span class="type">=&gt; B</span><a href="#108684">yp</a></span>) }
    <span class="typed"><span class="type">(A,B)(A, B)</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">=&gt; A</span><a href="#108683">xp</a></span>, <span class="typed"><span class="type">scala.concurrent.SyncVar[Either[B,Throwable]]</span><a href="#108685">y</a></span>.<span class="typed"><span class="type">=&gt; Either[B,Throwable]</span><a href="SyncVar.scala.html#54484">get</a></span> <span class="typed"><span class="type">B</span><span class="keyword">match</span></span> {
    	<span class="typed"><span class="type">B</span><span class="keyword">case</span></span> <a id="1">Left</a>(<span class="typed"><span class="type">B</span><a id="108689">b</a></span>) =&gt; <span class="typed"><span class="type">B</span><a href="#108689">b</a></span>
    	<span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <a id="1">Right</a>(<span class="typed"><span class="type">Throwable</span><a id="108690">t</a></span>) =&gt; <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">Throwable</span><a href="#108690">t</a></span>
    })
  }

  <span class="comment">/**
   *  @param start ...
   *  @param end   ...
   *  @param p     ...
   */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Int,Int)((Int) =&gt; Unit)Unit</span><a id="20482">replicate</a></span>(<span class="typed"><span class="type">Int</span><a id="108691">start</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">Int</span><a id="108692">end</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>)(<span class="typed"><span class="type">(Int) =&gt; Unit</span><a id="108693">p</a></span>: Int =&gt; Unit) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#108691">start</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int</span><a href="#108692">end</a></span>) 
      <span class="typed"><span class="type">Unit</span><span >(</span></span>)
    <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#108691">start</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int</span><a href="#108692">end</a></span>)
      <span class="typed"><span class="type">(Int)Unit</span><a href="../Function1.scala.html#17300">p</a></span>(<span class="typed"><span class="type">Int</span><a href="#108691">start</a></span>)
    <span class="keyword">else</span> {
      <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="108698">mid</a></span> = (<span class="typed"><span class="type">Int</span><a href="#108691">start</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+</a></span> <span class="typed"><span class="type">Int</span><a href="#108692">end</a></span>) <span class="typed"><span class="type">(Int)Int</span><a id="3148">/</a></span> <span class="typed"><span class="type">Int(2)</span><span class="int">2</span></span>
      <span class="typed"><span class="type">(=&gt; Unit)Unit</span><a href="#20473">spawn</a></span> { <span class="typed"><span class="type">(Int,Int)((Int) =&gt; Unit)Unit</span><a href="#20482">replicate</a></span>(<span class="typed"><span class="type">Int</span><a href="#108691">start</a></span>, <span class="typed"><span class="type">Int</span><a href="#108698">mid</a></span>)(<span class="typed"><span class="type">(Int) =&gt; Unit</span><a href="#108693">p</a></span>) }
      <span class="typed"><span class="type">(Int,Int)((Int) =&gt; Unit)Unit</span><a href="#20482">replicate</a></span>(<span class="typed"><span class="type">Int</span><a href="#108698">mid</a></span>, <span class="typed"><span class="type">Int</span><a href="#108692">end</a></span>)(<span class="typed"><span class="type">(Int) =&gt; Unit</span><a href="#108693">p</a></span>)
    }
  }

<span class="comment">/*
  def parMap[a,b](f: a =&gt; b, xs: Array[a]): Array[b] = {
    val results = new Array[b](xs.length);
    replicate(0, xs.length) { i =&gt; results(i) = f(xs(i)) }
    results
  }
*/</span>

}

        </pre>
    </body>
</html>