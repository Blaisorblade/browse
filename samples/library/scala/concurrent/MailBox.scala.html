<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/concurrent/MailBox.scala</title>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: MailBox.scala 16893 2009-01-13 13:09:22Z cunei $</span>


<span class="keyword">package</span> scala.concurrent

<span class="comment">/** This class ...
 *
 *  @author  Martin Odersky
 *  @version 1.0, 12/03/2003
 */</span>
<span class="comment">//class MailBox with Monitor with LinkedListQueueCreator {</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class MailBox extends java.lang.Object with scala.concurrent.ListQueueCreator with ScalaObject</span><a id="7796">MailBox</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">java.lang.Object</span><a id="2163">AnyRef</a></span> <span class="keyword">with</span> <span class="typed"><span class="type">scala.concurrent.ListQueueCreator</span><a href="#7826">ListQueueCreator</a></span> {

  <span class="keyword">type</span> <span class="typed"><span class="type">AnyRef</span><a id="115811">Message</a></span> = <span class="typed"><span class="type">AnyRef</span><a id="2015">AnyRef</a></span>

  <span class="keyword">private</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class PreReceiver extends java.lang.Object with ScalaObject</span><a id="115812">PreReceiver</a></span> {
    <span class="keyword">var</span> <span class="typed"><span class="type">MailBox.this.Message</span><span id="115848"><span id="115846"><span id="115847"><a id="115853">msg</a></span></span></span></span>: <span class="typed"><span class="type">MailBox.this.Message</span><a id="2015">Message</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(MailBox.this.Message)Boolean</span><a id="115849">isDefinedAt</a></span>(<span class="typed"><span class="type">MailBox.this.Message</span><a id="115854">msg</a></span>: <span class="typed"><span class="type">MailBox.this.Message</span><a id="2015">Message</a></span>): <span class="typed"><span class="type">Boolean</span><a id="2168">Boolean</a></span>
  }

  <span class="keyword">private</span> <span class="keyword">class</span> <span class="typed"><span class="type">class Receiver[A] extends MailBox.this.PreReceiver with ScalaObject</span><a id="115813">Receiver</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="115814">A</a></span>](<span class="typed"><span class="type">PartialFunction[MailBox.this.Message,A]</span><span id="115856"><a id="115863">receiver</a></span></span>: <span class="typed"><span class="type">PartialFunction[MailBox.this.Message,A]</span><a href="../PartialFunction.scala.html#1295">PartialFunction</a></span>[Message, A]) <span class="keyword">extends</span> <span class="typed"><span class="type">MailBox.this.PreReceiver</span><a href="#115812">PreReceiver</a></span> {

    <span class="keyword">def</span> <span class="typed"><span class="type">(MailBox.this.Message)Boolean</span><a id="115858">isDefinedAt</a></span>(<span class="typed"><span class="type">MailBox.this.Message</span><a id="115864">msg</a></span>: <span class="typed"><span class="type">MailBox.this.Message</span><a id="2015">Message</a></span>) = <span class="typed"><span class="type">PartialFunction[MailBox.this.Message,A]</span><a href="#115856">receiver</a></span>.<span class="typed"><span class="type">(MailBox.this.Message)Boolean</span><a href="../PartialFunction.scala.html#17289">isDefinedAt</a></span>(<span class="typed"><span class="type">MailBox.this.Message</span><a href="#115864">msg</a></span>)

    <span class="keyword">def</span> <span class="typed"><span class="type">()A</span><a id="115859">receive</a></span>(): <span class="typed"><span class="type">A</span><a href="#115814">A</a></span> = <span class="typed"><span class="type">(A)A</span><a href="#115813" id="5794">synchronized</a></span> {
      <span class="typed"><span class="type">Unit</span><a href="#115867" class="keyword">while</a></span> (<span class="typed"><span class="type">=&gt; MailBox.this.Message</span><a href="#115846">msg</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">()Unit</span><a href="#115813" id="5788">wait</a></span>()
      <span class="typed"><span class="type">(MailBox.this.Message)A</span><a href="../Function1.scala.html#17300">receiver</a></span>(<span class="typed"><span class="type">=&gt; MailBox.this.Message</span><a href="#115846">msg</a></span>)
    }

    <span class="keyword">def</span> <span class="typed"><span class="type">(Long)A</span><a id="115860">receiveWithin</a></span>(<span class="typed"><span class="type">Long</span><a id="115872">msec</a></span>: <span class="typed"><span class="type">Long</span><a id="2397">Long</a></span>): <span class="typed"><span class="type">A</span><a href="#115814">A</a></span> = <span class="typed"><span class="type">(A)A</span><a href="#115813" id="5794">synchronized</a></span> {
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; MailBox.this.Message</span><a href="#115846">msg</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">(Long)Unit</span><a href="#115813" id="5786">wait</a></span>(<span class="typed"><span class="type">Long</span><a href="#115872">msec</a></span>)
      <span class="typed"><span class="type">(MailBox.this.Message)A</span><a href="../Function1.scala.html#17300">receiver</a></span>(<span class="typed"><span class="type">MailBox.this.Message</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; MailBox.this.Message</span><a href="#115846">msg</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">ne</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">=&gt; MailBox.this.Message</span><a href="#115846">msg</a></span> <span class="keyword">else</span> <span class="typed"><span class="type">object scala.concurrent.TIMEOUT</span><a href="TIMEOUT.scala.html#7761">TIMEOUT</a></span>)
    }
  }

  <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.concurrent.QueueModule[MailBox.this.Message]</span><span id="115816"><a id="115815">messageQueue</a></span></span> = <span class="typed"><span class="type">scala.concurrent.QueueModule[MailBox.this.Message]</span><a href="#115837">queueCreate</a></span>[<span class="typed"><span class="type">MailBox.this.Message</span><a id="2015">Message</a></span>]
  <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">scala.concurrent.QueueModule[MailBox.this.PreReceiver]</span><span id="115818"><a id="115817">receiverQueue</a></span></span> = <span class="typed"><span class="type">scala.concurrent.QueueModule[MailBox.this.PreReceiver]</span><a href="#115837">queueCreate</a></span>[<span class="typed"><span class="type">MailBox.this.PreReceiver</span><a href="#115812">PreReceiver</a></span>]

  <span class="comment">/** Unconsumed messages. */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">MailBox.this.messageQueue.T</span><span id="115821"><span id="115819"><span id="115820"><a id="115850">sent</a></span></span></span></span> = <span class="typed"><span class="type">=&gt; scala.concurrent.QueueModule[MailBox.this.Message]</span><a href="#115815">messageQueue</a></span>.<span class="typed"><span class="type">=&gt; MailBox.this.messageQueue.T</span><a href="#115842">make</a></span>

  <span class="comment">/** Pending receivers. */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">MailBox.this.receiverQueue.T</span><span id="115824"><span id="115822"><span id="115823"><a id="115851">receivers</a></span></span></span></span> = <span class="typed"><span class="type">=&gt; scala.concurrent.QueueModule[MailBox.this.PreReceiver]</span><a href="#115817">receiverQueue</a></span>.<span class="typed"><span class="type">=&gt; MailBox.this.receiverQueue.T</span><a href="#115842">make</a></span>

  <span class="comment">/**
  * Check whether the receiver can be applied to an unconsumed message.
  * If yes, the message is extracted and associated with the receiver.
  * Otherwise the receiver is appended to the list of pending receivers.
  */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">[A](MailBox.this.Receiver[A])Unit</span><a id="115825">scanSentMsgs</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="115827">A</a></span>](<span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a id="115875">receiver</a></span>: <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115813">Receiver</a></span>[A]): <span class="typed"><span class="type">Unit</span><a id="2167">Unit</a></span> = <span class="typed"><span class="type">(Unit)Unit</span><a href="#7796" id="5794">synchronized</a></span> {
    <span class="typed"><span class="type">=&gt; scala.concurrent.QueueModule[MailBox.this.Message]</span><a href="#115815">messageQueue</a></span>.<span class="typed"><span class="type">(MailBox.this.messageQueue.T,(MailBox.this.Message) =&gt; Boolean)Option[(MailBox.this.Message, MailBox.this.messageQueue.T)]</span><a href="#115844">extractFirst</a></span>(<span class="typed"><span class="type">=&gt; MailBox.this.messageQueue.T</span><a href="#115819">sent</a></span>, <span class="typed"><span class="type">MailBox.this.Message</span><a id="115880">msg</a></span> =&gt; <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115875">receiver</a></span>.<span class="typed"><span class="type">(MailBox.this.Message)Boolean</span><a href="#115858">isDefinedAt</a></span>(<span class="typed"><span class="type">MailBox.this.Message</span><a href="#115880">msg</a></span>)) <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span> =&gt;
        <span class="typed"><span class="type">(MailBox.this.receiverQueue.T)Unit</span><a href="#115823">receivers</a></span> = <span class="typed"><span class="type">=&gt; scala.concurrent.QueueModule[MailBox.this.PreReceiver]</span><a href="#115817">receiverQueue</a></span>.<span class="typed"><span class="type">(MailBox.this.receiverQueue.T,MailBox.this.PreReceiver)MailBox.this.receiverQueue.T</span><a href="#115843">append</a></span>(<span class="typed"><span class="type">=&gt; MailBox.this.receiverQueue.T</span><a href="#115822">receivers</a></span>, <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115875">receiver</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Some</a>(<a id="1">(</a><span class="typed"><span class="type">MailBox.this.Message</span><a id="115883">msg</a></span>, <span class="typed"><span class="type">MailBox.this.messageQueue.T</span><a id="115884">withoutMsg</a></span>)) =&gt;
        <span class="typed"><span class="type">(MailBox.this.messageQueue.T)Unit</span><a href="#115820">sent</a></span> = <span class="typed"><span class="type">MailBox.this.messageQueue.T</span><a href="#115884">withoutMsg</a></span>
        <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115875">receiver</a></span>.<span class="typed"><span class="type">(MailBox.this.Message)Unit</span><a href="#115847">msg</a></span> = <span class="typed"><span class="type">MailBox.this.Message</span><a href="#115883">msg</a></span>
    }
  }

  <span class="comment">/**
  * First check whether a pending receiver is applicable to the sent
  * message. If yes, the receiver is notified. Otherwise the message
  * is appended to the linked list of sent messages.  
  */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(MailBox.this.Message)Unit</span><a id="115828">send</a></span>(<span class="typed"><span class="type">MailBox.this.Message</span><a id="115885">msg</a></span>: <span class="typed"><span class="type">MailBox.this.Message</span><a id="2015">Message</a></span>): <span class="typed"><span class="type">Unit</span><a id="2167">Unit</a></span> = <span class="typed"><span class="type">(Unit)Unit</span><a href="#7796" id="5794">synchronized</a></span> {
    <span class="typed"><span class="type">=&gt; scala.concurrent.QueueModule[MailBox.this.PreReceiver]</span><a href="#115817">receiverQueue</a></span>.<span class="typed"><span class="type">(MailBox.this.receiverQueue.T,(MailBox.this.PreReceiver) =&gt; Boolean)Option[(MailBox.this.PreReceiver, MailBox.this.receiverQueue.T)]</span><a href="#115844">extractFirst</a></span>(<span class="typed"><span class="type">=&gt; MailBox.this.receiverQueue.T</span><a href="#115822">receivers</a></span>, <span class="typed"><span class="type">MailBox.this.PreReceiver</span><a id="115888">r</a></span> =&gt; <span class="typed"><span class="type">MailBox.this.PreReceiver</span><a href="#115888">r</a></span>.<span class="typed"><span class="type">(MailBox.this.Message)Boolean</span><a href="#115849">isDefinedAt</a></span>(<span class="typed"><span class="type">MailBox.this.Message</span><a href="#115885">msg</a></span>)) <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span> =&gt;
        <span class="typed"><span class="type">(MailBox.this.messageQueue.T)Unit</span><a href="#115820">sent</a></span> = <span class="typed"><span class="type">=&gt; scala.concurrent.QueueModule[MailBox.this.Message]</span><a href="#115815">messageQueue</a></span>.<span class="typed"><span class="type">(MailBox.this.messageQueue.T,MailBox.this.Message)MailBox.this.messageQueue.T</span><a href="#115843">append</a></span>(<span class="typed"><span class="type">=&gt; MailBox.this.messageQueue.T</span><a href="#115819">sent</a></span>, <span class="typed"><span class="type">MailBox.this.Message</span><a href="#115885">msg</a></span>)
      <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <a id="1">Some</a>(<a id="1">(</a><span class="typed"><span class="type">MailBox.this.PreReceiver</span><a id="115889">receiver</a></span>, <span class="typed"><span class="type">MailBox.this.receiverQueue.T</span><a id="115890">withoutReceiver</a></span>)) =&gt;
        <span class="typed"><span class="type">(MailBox.this.receiverQueue.T)Unit</span><a href="#115823">receivers</a></span> = <span class="typed"><span class="type">MailBox.this.receiverQueue.T</span><a href="#115890">withoutReceiver</a></span>
        <span class="typed"><span class="type">MailBox.this.PreReceiver</span><a href="#115889">receiver</a></span>.<span class="typed"><span class="type">(MailBox.this.Message)Unit</span><a href="#115847">msg</a></span> = <span class="typed"><span class="type">MailBox.this.Message</span><a href="#115885">msg</a></span>
        <span class="typed"><span class="type">MailBox.this.PreReceiver</span><a href="#115889">receiver</a></span> <span class="typed"><span class="type">(Unit)Unit</span><a id="5794">synchronized</a></span> { <span class="typed"><span class="type">MailBox.this.PreReceiver</span><a href="#115889">receiver</a></span>.<span class="typed"><span class="type">()Unit</span><a id="5784">notify</a></span>() }
    }
  }

  <span class="comment">/**
  * Block until there is a message in the mailbox for which the processor
  * &lt;code&gt;f&lt;/code&gt; is defined.
  */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">[A](PartialFunction[MailBox.this.Message,A])A</span><a id="115829">receive</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="115831">A</a></span>](<span class="typed"><span class="type">PartialFunction[MailBox.this.Message,A]</span><a id="115892">f</a></span>: <span class="typed"><span class="type">PartialFunction[MailBox.this.Message,A]</span><a href="../PartialFunction.scala.html#1295">PartialFunction</a></span>[Message, A]): <span class="typed"><span class="type">A</span><a href="#115831">A</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a id="115893">r</a></span> = <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115813">Receiver</a></span>(<span class="typed"><span class="type">PartialFunction[MailBox.this.Message,A]</span><a href="#115892">f</a></span>)
    <span class="typed"><span class="type">(MailBox.this.Receiver[A])Unit</span><a href="#115825">scanSentMsgs</a></span>(<span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115893">r</a></span>)
    <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115893">r</a></span>.<span class="typed"><span class="type">()A</span><a href="#115859">receive</a></span>()
  }

  <span class="comment">/**
  * Block until there is a message in the mailbox for which the processor
  * &lt;code&gt;f&lt;/code&gt; is defined or the timeout is over.
  */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">[A](Long)(PartialFunction[MailBox.this.Message,A])A</span><a id="115832">receiveWithin</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="115834">A</a></span>](<span class="typed"><span class="type">Long</span><a id="115896">msec</a></span>: <span class="typed"><span class="type">Long</span><a id="2397">Long</a></span>)(<span class="typed"><span class="type">PartialFunction[MailBox.this.Message,A]</span><a id="115897">f</a></span>: <span class="typed"><span class="type">PartialFunction[MailBox.this.Message,A]</span><a href="../PartialFunction.scala.html#1295">PartialFunction</a></span>[Message, A]): <span class="typed"><span class="type">A</span><a href="#115834">A</a></span> = {
    <span class="keyword">val</span> <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a id="115898">r</a></span> = <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115813">Receiver</a></span>(<span class="typed"><span class="type">PartialFunction[MailBox.this.Message,A]</span><a href="#115897">f</a></span>)
    <span class="typed"><span class="type">(MailBox.this.Receiver[A])Unit</span><a href="#115825">scanSentMsgs</a></span>(<span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115898">r</a></span>)
    <span class="typed"><span class="type">MailBox.this.Receiver[A]</span><a href="#115898">r</a></span>.<span class="typed"><span class="type">(Long)A</span><a href="#115860">receiveWithin</a></span>(<span class="typed"><span class="type">Long</span><a href="#115896">msec</a></span>)
  }

}

<span class="comment">/////////////////////////////////////////////////////////////////</span>

<span class="comment">/**
* Module for dealing with queues.
*/</span>
<span class="keyword">trait</span> <span class="typed"><span class="type">trait QueueModule[A] extends java.lang.Object</span><span id="7769"><a id="2163">QueueModule</a></span></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="16462">A</a></span>] {
  <span class="comment">/** Type of queues. */</span>
  <span class="keyword">type</span> <span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="115841">T</a></span>
  <span class="comment">/** Create an empty queue. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; QueueModule.this.T</span><a id="115842">make</a></span>: <span class="typed"><span class="type">QueueModule.this.T</span><a href="#115841">T</a></span>
  <span class="comment">/** Append an element to a queue. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(QueueModule.this.T,A)QueueModule.this.T</span><a id="115843">append</a></span>(<span class="typed"><span class="type">QueueModule.this.T</span><a id="115881">l</a></span>: <span class="typed"><span class="type">QueueModule.this.T</span><a href="#115841">T</a></span>, <span class="typed"><span class="type">A</span><a id="115882">x</a></span>: <span class="typed"><span class="type">A</span><a href="#16462">A</a></span>): <span class="typed"><span class="type">QueueModule.this.T</span><a href="#115841">T</a></span>
  <span class="comment">/** Extract an element satisfying a predicate from a queue. */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(QueueModule.this.T,(A) =&gt; Boolean)Option[(A, QueueModule.this.T)]</span><a id="115844">extractFirst</a></span>(<span class="typed"><span class="type">QueueModule.this.T</span><a id="115877">l</a></span>: <span class="typed"><span class="type">QueueModule.this.T</span><a href="#115841">T</a></span>, <span class="typed"><span class="type">(A) =&gt; Boolean</span><a id="115878">p</a></span>: A =&gt; Boolean): <span class="typed"><span class="type">Option[(A, QueueModule.this.T)]</span><a href="../Option.scala.html#932">Option</a></span>[(A, T)]
}

<span class="comment">/** Inefficient but simple queue module creator. */</span>
<span class="keyword">trait</span> <span class="typed"><span class="type">trait ListQueueCreator extends java.lang.Object with ScalaObject</span><a id="7826">ListQueueCreator</a></span> {
  <span class="keyword">def</span> <span class="typed"><span class="type">[A]scala.concurrent.QueueModule[A]</span><a id="115837">queueCreate</a></span>[<span class="typed"><span class="type">&gt;: Nothing &lt;: Any</span><a id="115839">A</a></span>]: <span class="typed"><span class="type">scala.concurrent.QueueModule[A]</span><a href="#7769">QueueModule</a></span>[A] = <span class="typed"><span class="type">template $anon extends java.lang.Object with scala.concurrent.QueueModule[A]</span><a id="115904" class="keyword">new</a></span> <span class="typed"><span class="type">scala.concurrent.QueueModule[A]</span><a href="#7769">QueueModule</a></span>[A] {
    <span class="keyword">type</span> <span class="typed"><span class="type">List[A]</span><a id="115906">T</a></span> = <span class="typed"><span class="type">List[A]</span><a href="../List.scala.html#524">List</a></span>[A]
    <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; this.T</span><a id="115907">make</a></span>: <span class="typed"><span class="type">this.T</span><a href="../List.scala.html#524">T</a></span> = <span class="typed"><span class="type">object Nil</span><a href="../List.scala.html#333">Nil</a></span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(this.T,A)this.T</span><a id="115908">append</a></span>(<span class="typed"><span class="type">this.T</span><a id="115913">l</a></span>: <span class="typed"><span class="type">this.T</span><a href="../List.scala.html#524">T</a></span>, <span class="typed"><span class="type">A</span><a id="115914">x</a></span>: <span class="typed"><span class="type">A</span><a href="#115839">A</a></span>): <span class="typed"><span class="type">this.T</span><a href="../List.scala.html#524">T</a></span> = <span class="typed"><span class="type">this.T</span><a href="#115913">l</a></span> <span class="typed"><span class="type">(List[A])List[A]</span><a href="../List.scala.html#20878">:::</a></span> <span class="typed"><span class="type">A</span><a href="#115914">x</a></span> <span class="typed"><span class="type">(A)List[A]</span><a href="../List.scala.html#20872">::</a></span> <span class="typed"><span class="type">object Nil</span><a href="../List.scala.html#333">Nil</a></span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(this.T,(A) =&gt; Boolean)Option[(A, this.T)]</span><a id="115909">extractFirst</a></span>(<span class="typed"><span class="type">this.T</span><a id="115921">l</a></span>: <span class="typed"><span class="type">this.T</span><a href="../List.scala.html#524">T</a></span>, <span class="typed"><span class="type">(A) =&gt; Boolean</span><a id="115922">p</a></span>: A =&gt; Boolean): <span class="typed"><span class="type">Option[(A, this.T)]</span><a href="../Option.scala.html#932">Option</a></span>[(A, T)] =
      <span class="typed"><span class="type">this.T</span><a href="#115921">l</a></span> <span class="typed"><span class="type">Option[(A, this.T)]</span><span class="keyword">match</span></span> {
        <span class="typed"><span class="type">None.type</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object Nil</span><a href="../List.scala.html#333">Nil</a></span> =&gt; <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span>
        <span class="typed"><span class="type">Option[(A, this.T)]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">A</span><a id="115923">head</a></span> <a id="1">::</a> <span class="typed"><span class="type">List[A]</span><a id="115924">tail</a></span> =&gt;
          <span class="typed"><span class="type">Option[(A, this.T)]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(A)Boolean</span><a href="../Function1.scala.html#17300">p</a></span>(<span class="typed"><span class="type">A</span><a href="#115923">head</a></span>))
            <span class="typed"><span class="type">((A, List[A]))Some[(A, List[A])]</span><a href="../Option.scala.html#19455">Some</a></span>(<span class="typed"><span class="type">(A,List[A])(A, List[A])</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">A</span><a href="#115923">head</a></span>, <span class="typed"><span class="type">List[A]</span><a href="#115924">tail</a></span>))
          <span class="keyword">else</span>
            <span class="typed"><span class="type">(this.T,(A) =&gt; Boolean)Option[(A, this.T)]</span><a href="#115909">extractFirst</a></span>(<span class="typed"><span class="type">List[A]</span><a href="#115924">tail</a></span>, <span class="typed"><span class="type">(A) =&gt; Boolean</span><a href="#115922">p</a></span>) <span class="typed"><span class="type">Option[(A, this.T)]</span><span class="keyword">match</span></span> {
              <span class="typed"><span class="type">None.type</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span> =&gt; <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span>
              <span class="typed"><span class="type">Some[(A, List[A])]</span><span class="keyword">case</span></span> <a id="1">Some</a>(<a id="1">(</a><span class="typed"><span class="type">A</span><a id="115928">x</a></span>, <span class="typed"><span class="type">this.T</span><a id="115929">without_x</a></span>)) =&gt; <span class="typed"><span class="type">((A, List[A]))Some[(A, List[A])]</span><a href="../Option.scala.html#19455">Some</a></span>(<span class="typed"><span class="type">(A,List[A])(A, List[A])</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">A</span><a href="#115928">x</a></span>, <span class="typed"><span class="type">A</span><a href="#115923">head</a></span> <span class="typed"><span class="type">(A)List[A]</span><a href="../List.scala.html#20872">::</a></span> <span class="typed"><span class="type">this.T</span><a href="#115929">without_x</a></span>))
            }
      }
  }
}

<span class="comment">/** Efficient queue module creator based on linked lists. */</span>
<span class="keyword">trait</span> <span class="typed"><span class="type">trait LinkedListQueueCreator extends java.lang.Object with ScalaObject</span><a id="7724">LinkedListQueueCreator</a></span> {
  <span class="keyword">import</span> scala.collection.mutable.LinkedList
  <span class="keyword">def</span> <span class="typed"><span class="type">[A &gt;: Null &lt;: AnyRef]scala.concurrent.QueueModule[A]</span><a id="115938">queueCreate</a></span>[<span class="typed"><span class="type">&gt;: Null &lt;: AnyRef</span><a id="115940">A</a></span> &gt;: Null &lt;: AnyRef]: <span class="typed"><span class="type">scala.concurrent.QueueModule[A]</span><a href="#7769">QueueModule</a></span>[A] = <span class="typed"><span class="type">template $anon extends java.lang.Object with scala.concurrent.QueueModule[A]</span><a id="115944" class="keyword">new</a></span> <span class="typed"><span class="type">scala.concurrent.QueueModule[A]</span><a href="#7769">QueueModule</a></span>[A] {
    <span class="keyword">type</span> <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a id="115946">T</a></span> = <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="../Tuple2.scala.html#1376">(</a></span>LinkedList[A], LinkedList[A]) <span class="comment">// fst = the list, snd = last elem</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">=&gt; (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a id="115947">make</a></span>: <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="../Tuple2.scala.html#1376">T</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a id="115953">l</a></span> = <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="../collection/mutable/LinkedList.scala.html#11416">LinkedList</a></span>[A](<span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>, <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>)
      <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A],scala.collection.mutable.LinkedList[A])(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115953">l</a></span>, <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115953">l</a></span>)
    }
    <span class="keyword">def</span> <span class="typed"><span class="type">((scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]),A)(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a id="115948">append</a></span>(<span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a id="115956">l</a></span>: <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="../Tuple2.scala.html#1376">T</a></span>, <span class="typed"><span class="type">A</span><a id="115957">x</a></span>: <span class="typed"><span class="type">A</span><a href="#115940">A</a></span>): <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="../Tuple2.scala.html#1376">T</a></span> = {
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a id="115958">atTail</a></span> = <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="../collection/mutable/LinkedList.scala.html#11416">LinkedList</a></span>(<span class="typed"><span class="type">A</span><a href="#115957">x</a></span>, <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>)
      <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="#115956">l</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.LinkedList[A]</span><a href="../Tuple2.scala.html#19163">_2</a></span> <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A])Unit</span><a href="../collection/mutable/SingleLinkedList.scala.html#62299">append</a></span> <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115958">atTail</a></span>;
      <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A],scala.collection.mutable.LinkedList[A])(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="#115956">l</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.LinkedList[A]</span><a href="../Tuple2.scala.html#19161">_1</a></span>, <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115958">atTail</a></span>)
    }
    <span class="keyword">def</span> <span class="typed"><span class="type">((scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]),(A) =&gt; Boolean)Option[(A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))]</span><a id="115949">extractFirst</a></span>(<span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a id="115962">l</a></span>: <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="../Tuple2.scala.html#1376">T</a></span>, <span class="typed"><span class="type">(A) =&gt; Boolean</span><a id="115963">p</a></span>: A =&gt; Boolean): <span class="typed"><span class="type">Option[(A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))]</span><a href="../Option.scala.html#932">Option</a></span>[(A, T)] = {
      <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a id="115964">xs</a></span> = <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="#115962">l</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.LinkedList[A]</span><a href="../Tuple2.scala.html#19161">_1</a></span>
      <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a id="115965">xs1</a></span> = <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115964">xs</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.LinkedList[A]</span><a href="../collection/mutable/LinkedList.scala.html#68485">next</a></span>
      <span class="typed"><span class="type">Unit</span><a href="#115966" class="keyword">while</a></span> ((<span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115965">xs1</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">ne</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2749">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2745">!</a></span><span class="typed"><span class="type">(A)Boolean</span><a href="../Function1.scala.html#17300">p</a></span>(<span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115965">xs1</a></span>.<span class="typed"><span class="type">=&gt; A</span><a href="../collection/mutable/LinkedList.scala.html#68482">elem</a></span>)) {
        <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115964">xs</a></span> = <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115965">xs1</a></span>
        <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115965">xs1</a></span> = <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115965">xs1</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.LinkedList[A]</span><a href="../collection/mutable/LinkedList.scala.html#68485">next</a></span>
      }
      <span class="typed"><span class="type">Option[(A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115965">xs1</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5793">ne</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
        <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115964">xs</a></span>.<span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A])Unit</span><a href="../collection/mutable/LinkedList.scala.html#68486">next</a></span> = <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115965">xs1</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.LinkedList[A]</span><a href="../collection/mutable/LinkedList.scala.html#68485">next</a></span>
        <span class="typed"><span class="type">Option[(A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))]</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115964">xs</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.LinkedList[A]</span><a href="../collection/mutable/LinkedList.scala.html#68485">next</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5792">eq</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>)
          <span class="typed"><span class="type">((A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])))Some[(A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))]</span><a href="../Option.scala.html#19455">Some</a></span>(<span class="typed"><span class="type">(A,(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))(A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115965">xs1</a></span>.<span class="typed"><span class="type">=&gt; A</span><a href="../collection/mutable/LinkedList.scala.html#68482">elem</a></span>, <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A],scala.collection.mutable.LinkedList[A])(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="#115962">l</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.LinkedList[A]</span><a href="../Tuple2.scala.html#19161">_1</a></span>, <span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115964">xs</a></span>)))
        <span class="keyword">else</span>
          <span class="typed"><span class="type">((A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])))Some[(A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))]</span><a href="../Option.scala.html#19455">Some</a></span>(<span class="typed"><span class="type">(A,(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))(A, (scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A]))</span><a href="../Tuple2.scala.html#20366">(</a></span><span class="typed"><span class="type">scala.collection.mutable.LinkedList[A]</span><a href="#115965">xs1</a></span>.<span class="typed"><span class="type">=&gt; A</span><a href="../collection/mutable/LinkedList.scala.html#68482">elem</a></span>, <span class="typed"><span class="type">(scala.collection.mutable.LinkedList[A], scala.collection.mutable.LinkedList[A])</span><a href="#115962">l</a></span>))
      }
      <span class="keyword">else</span>
        <span class="typed"><span class="type">object None</span><a href="../Option.scala.html#534">None</a></span>
    }
  }
}


        </pre>
    </body>
</html>