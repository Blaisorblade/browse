<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/util/automata/WordBerrySethi.scala</title>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: WordBerrySethi.scala 16893 2009-01-13 13:09:22Z cunei $</span>


<span class="keyword">package</span> scala.util.automata

<span class="keyword">import</span> scala.collection.{immutable, mutable, Map}
<span class="keyword">import</span> scala.util.regexp.WordExp


<span class="comment">/** This class turns a regexp into a NondetWordAutom using the
 *  celebrated position automata construction (also called Berry-Sethi or
 *  Glushkov)
 *
 *  @author Burak Emir
 *  @version 1.0
 */</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <span class="typed"><span class="type">class WordBerrySethi extends scala.util.automata.BaseBerrySethi with ScalaObject</span><a id="12971">WordBerrySethi</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">scala.util.automata.BaseBerrySethi</span><a href="BaseBerrySethi.scala.html#12905">BaseBerrySethi</a></span> {

  <span class="keyword">override</span> <span class="keyword">val</span> <span class="typed"><span class="type">=&gt; scala.util.regexp.WordExp</span><a id="59274">lang</a></span>: <span class="typed"><span class="type">scala.util.regexp.WordExp</span><a href="../regexp/WordExp.scala.html#13958">WordExp</a></span>

  <span class="keyword">type</span> <span class="typed"><span class="type">WordBerrySethi.this.lang._labelT</span><a id="59275">_labelT</a></span> = <span class="keyword">this</span>.lang.<span class="typed"><span class="type">WordBerrySethi.this.lang._labelT</span><a href="../regexp/WordExp.scala.html#59172">_labelT</a></span>

  <span class="keyword">import</span> lang.{Alt, Eps, Letter, Meta, RegExp, Sequ, Star}


  <span class="keyword">protected</span> <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.mutable.HashSet[WordBerrySethi.this._labelT]</span><span id="59279"><span id="59277"><span id="59278"><a id="113296">labels</a></span></span></span></span>:mutable.<span class="typed"><span class="type">scala.collection.mutable.HashSet[WordBerrySethi.this._labelT]</span><a href="../../collection/mutable/HashSet.scala.html#11140">HashSet</a></span>[_labelT] = _
  <span class="comment">// don't let this fool you, only labelAt is a real, surjective mapping</span>
  <span class="keyword">protected</span> <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.immutable.TreeMap[Int,WordBerrySethi.this._labelT]</span><span id="59282"><span id="59280"><span id="59281"><a id="113297">labelAt</a></span></span></span></span>: immutable.<span class="typed"><span class="type">scala.collection.immutable.TreeMap[Int,WordBerrySethi.this._labelT]</span><a href="../../collection/immutable/TreeMap.scala.html#9506">TreeMap</a></span>[Int, _labelT] = _ <span class="comment">// new alphabet &quot;gamma&quot;</span>

  <span class="keyword">protected</span> <span class="keyword">var</span> <span class="typed"><span class="type">Array[scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]]</span><span id="59285"><span id="59283"><span id="59284"><a id="113298">deltaq</a></span></span></span></span>: <span class="typed"><span class="type">Array[scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]]</span><a href="../../Array.scala.html#1070">Array</a></span>[mutable.HashMap[_labelT,List[Int]]] = _ <span class="comment">// delta</span>

  <span class="keyword">protected</span> <span class="keyword">var</span> <span class="typed"><span class="type">Array[List[Int]]</span><span id="59288"><span id="59286"><span id="59287"><a id="113299">defaultq</a></span></span></span></span>: <span class="typed"><span class="type">Array[List[Int]]</span><a href="../../Array.scala.html#1070">Array</a></span>[List[Int]] = _ <span class="comment">// default transitions</span>

  <span class="keyword">protected</span> <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span id="59291"><span id="59289"><span id="59290"><a id="113300">initials</a></span></span></span></span>:immutable.<span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a href="../../collection/immutable/Set.scala.html#9491">Set</a></span>[Int] = _
  <span class="comment">//NondetWordAutom revNfa</span>

  <span class="comment">// maps a letter to an Integer ( the position )</span>
  <span class="comment">// is not *really* needed (preorder determines position!)</span>
  <span class="comment">//protected var posMap: mutable.HashMap[RegExp, Int] = _;</span>

  <span class="comment">/** Computes &lt;code&gt;first(r)&lt;/code&gt; where the word regexp &lt;code&gt;r&lt;/code&gt;.
   *
   *  @param r the regular expression
   *  @return  the computed set &lt;code&gt;first(r)&lt;/code&gt;
   */</span>
  <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp)scala.collection.immutable.Set[Int]</span><a id="59292">compFirst</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a id="113301">r</a></span>: <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="../regexp/Base.scala.html#59155">RegExp</a></span>): immutable.<span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a href="../../collection/immutable/Set.scala.html#9491">Set</a></span>[Int] = <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113301">r</a></span> <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">match</span></span> {
    <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a id="113302">x</a></span>:<span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a href="../regexp/WordExp.scala.html#59173">Letter</a></span> =&gt; <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59266">emptySet</a></span> <span class="typed"><span class="type">(Int)scala.collection.immutable.Set[Int]</span><a href="../../collection/immutable/Set.scala.html#50960">+</a></span> <span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a href="#113302">x</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="../regexp/WordExp.scala.html#59556">pos</a></span> <span class="comment">//posMap(x);  // singleton set</span>
    <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object WordBerrySethi.this.lang.Eps</span><a href="../regexp/Base.scala.html#59165">Eps</a></span>      =&gt; <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59266">emptySet</a></span> <span class="comment">/*ignore*/</span>
    <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">case</span></span> _        =&gt; <span class="keyword">super</span>.<span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp)scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59268">compFirst</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113301">r</a></span>)
  }

  <span class="comment">/** Computes &lt;code&gt;last(r)&lt;/code&gt; where the word regexp &lt;code&gt;r&lt;/code&gt;.
   *
   *  @param r the regular expression
   *  @return  the computed set &lt;code&gt;last(r)&lt;/code&gt;
   */</span>
  <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp)scala.collection.immutable.Set[Int]</span><a id="59293">compLast</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a id="113306">r</a></span>: <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="../regexp/Base.scala.html#59155">RegExp</a></span>): immutable.<span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a href="../../collection/immutable/Set.scala.html#9491">Set</a></span>[Int] = <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113306">r</a></span> <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">match</span></span> {
    <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a id="113307">x</a></span>:<span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a href="../regexp/WordExp.scala.html#59173">Letter</a></span> =&gt; <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59266">emptySet</a></span> <span class="typed"><span class="type">(Int)scala.collection.immutable.Set[Int]</span><a href="../../collection/immutable/Set.scala.html#50960">+</a></span> <span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a href="#113307">x</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="../regexp/WordExp.scala.html#59556">pos</a></span> <span class="comment">//posMap(x) // singleton set</span>
    <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object WordBerrySethi.this.lang.Eps</span><a href="../regexp/Base.scala.html#59165">Eps</a></span>      =&gt; <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59266">emptySet</a></span> <span class="comment">/*ignore*/</span>
    <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">case</span></span> _        =&gt; <span class="keyword">super</span>.<span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp)scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59269">compLast</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113306">r</a></span>)
  }

  <span class="comment">/** Returns the first set of an expression, setting the follow set along 
   *  the way.
   *
   *  @param fol1 ...
   *  @param r    the regular expression
   *  @return     the computed set
   */</span>
  <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(scala.collection.immutable.Set[Int],WordBerrySethi.this.lang.RegExp)scala.collection.immutable.Set[Int]</span><a id="59294">compFollow1</a></span>(<span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a id="113311">fol1</a></span>: immutable.<span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a href="../../collection/immutable/Set.scala.html#9491">Set</a></span>[Int], <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a id="113312">r</a></span>: <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="../regexp/Base.scala.html#59155">RegExp</a></span>): immutable.<span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a href="../../collection/immutable/Set.scala.html#9491">Set</a></span>[Int] =
    <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113312">r</a></span> <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a id="113313">x</a></span>:<span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a href="../regexp/WordExp.scala.html#59173">Letter</a></span> =&gt;
        <span class="comment">//val i = posMap(x)</span>
        <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="113314">i</a></span> = <span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a href="#113313">x</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="../regexp/WordExp.scala.html#59556">pos</a></span>
        <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashMap[Int,scala.collection.immutable.Set[Int]]</span><a href="BaseBerrySethi.scala.html#59257">follow</a></span>.<span class="typed"><span class="type">(Int,scala.collection.immutable.Set[Int])Unit</span><a href="../../collection/mutable/DefaultMapModel.scala.html#21441">update</a></span>(<span class="typed"><span class="type">Int</span><a href="#113314">i</a></span>, <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a href="#113311">fol1</a></span>)
        <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59266">emptySet</a></span> <span class="typed"><span class="type">(Int)scala.collection.immutable.Set[Int]</span><a href="../../collection/immutable/Set.scala.html#50960">+</a></span> <span class="typed"><span class="type">Int</span><a href="#113314">i</a></span>
      <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object WordBerrySethi.this.lang.Eps</span><a href="../regexp/Base.scala.html#59165">Eps</a></span> =&gt;
        <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59266">emptySet</a></span> <span class="comment">/*ignore*/</span>
      <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><span class="keyword">case</span></span> _ =&gt;
        <span class="keyword">super</span>.<span class="typed"><span class="type">(scala.collection.immutable.Set[Int],WordBerrySethi.this.lang.RegExp)scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59271">compFollow1</a></span>(<span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a href="#113311">fol1</a></span>, <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113312">r</a></span>)
    }

  <span class="comment">/** returns &quot;Sethi-length&quot; of a pattern, creating the set of position
   *  along the way
   */</span>


  <span class="comment">/** called at the leaves of the regexp */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp,Int,WordBerrySethi.this._labelT)Unit</span><a id="59295">seenLabel</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a id="113320">r</a></span>: <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="../regexp/Base.scala.html#59155">RegExp</a></span>, <span class="typed"><span class="type">Int</span><a id="113321">i</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a id="113322">label</a></span>: <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="../regexp/WordExp.scala.html#59172">_labelT</a></span>) {
    <span class="comment">//Console.println(&quot;seenLabel (1)&quot;);</span>
    <span class="comment">//this.posMap.update(r, i)</span>
    <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">(scala.collection.immutable.TreeMap[Int,WordBerrySethi.this._labelT])Unit</span><a href="#59281">labelAt</a></span> = <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.immutable.TreeMap[Int,WordBerrySethi.this._labelT]</span><a href="#59280">labelAt</a></span>.<span class="typed"><span class="type">(Int,WordBerrySethi.this._labelT)scala.collection.immutable.TreeMap[Int,WordBerrySethi.this._labelT]</span><a href="../../collection/immutable/TreeMap.scala.html#50870">update</a></span>(<span class="typed"><span class="type">Int</span><a href="#113321">i</a></span>, <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="#113322">label</a></span>)
    <span class="comment">//@ifdef if( label != Wildcard ) {</span>
      <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[WordBerrySethi.this._labelT]</span><a href="#59277">labels</a></span> <span class="typed"><span class="type">(WordBerrySethi.this._labelT)Unit</span><a href="../../collection/mutable/HashSet.scala.html#38148">+=</a></span> <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="#113322">label</a></span>
    <span class="comment">//@ifdef }</span>
  }

  <span class="comment">// overriden in BindingBerrySethi</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp,WordBerrySethi.this._labelT)Int</span><a id="59296">seenLabel</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a id="113332">r</a></span>: <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="../regexp/Base.scala.html#59155">RegExp</a></span>, <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a id="113333">label</a></span>: <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="../regexp/WordExp.scala.html#59172">_labelT</a></span>): <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span> = {
    <span class="comment">//Console.println(&quot;seenLabel (2)&quot;);</span>
    <span class="typed"><span class="type">(Int)Unit</span><a href="BaseBerrySethi.scala.html#59252">pos</a></span> = <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
    <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp,Int,WordBerrySethi.this._labelT)Unit</span><a href="#59295">seenLabel</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113332">r</a></span>, <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>, <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="#113333">label</a></span>)
    <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>
  }

  <span class="comment">// todo: replace global variable pos with acc</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp)Unit</span><a id="59297">traverse</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a id="113354">r</a></span>: <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="../regexp/Base.scala.html#59155">RegExp</a></span>): <span class="typed"><span class="type">Unit</span><a id="2167">Unit</a></span> = <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113354">r</a></span> <span class="typed"><span class="type">Unit</span><span class="keyword">match</span></span> {
    <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a id="113355">a</a></span> @ <a id="1">Letter</a>(<span class="typed"><span class="type">WordBerrySethi.this.lang._labelT</span><a id="113356">label</a></span>) =&gt; <span class="typed"><span class="type">WordBerrySethi.this.lang.Letter</span><a href="#113355">a</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a href="../regexp/WordExp.scala.html#59557">pos</a></span> = <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp,WordBerrySethi.this._labelT)Int</span><a href="#59296">seenLabel</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113354">r</a></span>, <span class="typed"><span class="type">WordBerrySethi.this.lang._labelT</span><a href="#113356">label</a></span>)
    <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object WordBerrySethi.this.lang.Eps</span><a href="../regexp/Base.scala.html#59165">Eps</a></span>               =&gt; <span class="comment">/*ignore*/</span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> _                 =&gt; <span class="keyword">super</span>.<span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp)Unit</span><a href="BaseBerrySethi.scala.html#59272">traverse</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113354">r</a></span>)
  }


  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Int,Int,WordBerrySethi.this._labelT)Unit</span><a id="59298">makeTransition</a></span>(<span class="typed"><span class="type">Int</span><a id="113360">src</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">Int</span><a id="113361">dest</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a id="113362">label</a></span>: <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="../regexp/WordExp.scala.html#59172">_labelT</a></span> ) {
    <span class="comment">//@ifdef compiler if( label == Wildcard )</span>
    <span class="comment">//@ifdef compiler   defaultq.update(src, dest::defaultq( src ))</span>
    <span class="comment">//@ifdef compiler else </span>
    <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]</span><a id="113363">q</a></span> = <span class="typed"><span class="type">(Int)scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]</span><a href="../../Array.scala.html#17253">deltaq</a></span>(<span class="typed"><span class="type">Int</span><a href="#113360">src</a></span>)
    <span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]</span><a href="#113363">q</a></span>.<span class="typed"><span class="type">(WordBerrySethi.this._labelT,List[Int])Unit</span><a href="../../collection/mutable/DefaultMapModel.scala.html#21441">update</a></span>(<span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="#113362">label</a></span>, <span class="typed"><span class="type">Int</span><a href="#113361">dest</a></span><span class="typed"><span class="type">(Int)List[Int]</span><a href="../../List.scala.html#20872">::</a></span>(<span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]</span><a href="#113363">q</a></span>.<span class="typed"><span class="type">(WordBerrySethi.this._labelT)Option[List[Int]]</span><a href="../../collection/mutable/DefaultMapModel.scala.html#21440">get</a></span>(<span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="#113362">label</a></span>) <span class="typed"><span class="type">List[Int]</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">List[Int]</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">List[Int]</span><a id="113369">x</a></span>) =&gt; <span class="typed"><span class="type">List[Int]</span><a href="#113369">x</a></span>
      <span class="typed"><span class="type">Nil.type</span><span class="keyword">case</span></span> _       =&gt; <span class="typed"><span class="type">object Nil</span><a href="../../List.scala.html#333">Nil</a></span>
    }))
  }

  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Seq[WordBerrySethi.this.lang.RegExp])Unit</span><a id="59299">initialize</a></span>(<span class="typed"><span class="type">Seq[WordBerrySethi.this.lang.RegExp]</span><a id="113372">subexpr</a></span>: <span class="typed"><span class="type">Seq[WordBerrySethi.this.lang.RegExp]</span><a href="../../Seq.scala.html#761">Seq</a></span>[RegExp]): <span class="typed"><span class="type">Unit</span><a id="2167">Unit</a></span> = {
    <span class="comment">//this.posMap = new mutable.HashMap[RegExp,Int]()</span>
    <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">(scala.collection.immutable.TreeMap[Int,WordBerrySethi.this._labelT])Unit</span><a href="#59281">labelAt</a></span> = <span class="typed"><span class="type">()(implicit (Int) =&gt; Ordered[Int])scala.collection.immutable.TreeMap[Int,WordBerrySethi.this._labelT]</span><a href="../../collection/immutable/TreeMap.scala.html#50857" class="keyword">new</a></span> immutable.<span class="typed"><span class="type">scala.collection.immutable.TreeMap[Int,WordBerrySethi.this._labelT]</span><a href="../../collection/immutable/TreeMap.scala.html#9506">TreeMap</a></span>[Int, _labelT]()
    <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">(scala.collection.mutable.HashMap[Int,scala.collection.immutable.Set[Int]])Unit</span><a href="BaseBerrySethi.scala.html#59258">follow</a></span> = <span class="typed"><span class="type">scala.collection.mutable.HashMap[Int,scala.collection.immutable.Set[Int]]</span><span class="keyword">new</span></span> mutable.<span class="typed"><span class="type">scala.collection.mutable.HashMap[Int,scala.collection.immutable.Set[Int]]</span><a href="../../collection/mutable/HashMap.scala.html#11326">HashMap</a></span>[Int, immutable.Set[Int]]()
    <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">(scala.collection.mutable.HashSet[WordBerrySethi.this._labelT])Unit</span><a href="#59278">labels</a></span> = <span class="typed"><span class="type">scala.collection.mutable.HashSet[WordBerrySethi.this._labelT]</span><span class="keyword">new</span></span> mutable.<span class="typed"><span class="type">scala.collection.mutable.HashSet[WordBerrySethi.this._labelT]</span><a href="../../collection/mutable/HashSet.scala.html#11140">HashSet</a></span>[_labelT]()

    <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a href="BaseBerrySethi.scala.html#59252">pos</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>

    <span class="comment">// determine &quot;Sethi-length&quot; of the regexp</span>
    <span class="comment">//activeBinders = new Vector()</span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Iterator[WordBerrySethi.this.lang.RegExp]</span><a id="113373">it</a></span> = <span class="typed"><span class="type">Seq[WordBerrySethi.this.lang.RegExp]</span><a href="#113372">subexpr</a></span>.<span class="typed"><span class="type">=&gt; Iterator[WordBerrySethi.this.lang.RegExp]</span><a href="../../Iterable.scala.html#17309">elements</a></span>
    <span class="typed"><span class="type">Unit</span><a href="#113374" class="keyword">while</a></span> (<span class="typed"><span class="type">Iterator[WordBerrySethi.this.lang.RegExp]</span><a href="#113373">it</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../../Iterator.scala.html#19975">hasNext</a></span>) 
      <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp)Unit</span><a href="#59297">traverse</a></span>(<span class="typed"><span class="type">Iterator[WordBerrySethi.this.lang.RegExp]</span><a href="#113373">it</a></span>.<span class="typed"><span class="type">()WordBerrySethi.this.lang.RegExp</span><a href="../../Iterator.scala.html#19976">next</a></span>)

    <span class="comment">//assert(activeBinders.isEmpty())</span>
    <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">(scala.collection.immutable.Set[Int])Unit</span><a href="#59290">initials</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59266">emptySet</a></span> <span class="typed"><span class="type">(Int)scala.collection.immutable.Set[Int]</span><a href="../../collection/immutable/Set.scala.html#50960">+</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
  }

  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="59300">initializeAutom</a></span>() {
    <span class="typed"><span class="type">(scala.collection.immutable.TreeMap[Int,Int])Unit</span><a href="BaseBerrySethi.scala.html#59264">finals</a></span>   = immutable.<span class="typed"><span class="type">object scala.collection.immutable.TreeMap</span><a href="../../collection/immutable/TreeMap.scala.html#9507">TreeMap</a></span>.<span class="typed"><span class="type">(implicit (Int) =&gt; Ordered[Int])scala.collection.immutable.TreeMap[Int,Int]</span><a href="../../collection/immutable/TreeMap.scala.html#97101">empty</a></span>[<span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>] <span class="comment">// final states</span>
    <span class="typed"><span class="type">(Array[scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]])Unit</span><a href="#59284">deltaq</a></span>   = <span class="typed"><span class="type">Array[scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]]</span><a href="../../Array.scala.html#1070">Array</a></span>[mutable.HashMap[_labelT, List[Int]]](<span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>) <span class="comment">// delta</span>
    <span class="typed"><span class="type">(Array[List[Int]])Unit</span><a href="#59287">defaultq</a></span> = <span class="typed"><span class="type">Array[List[Int]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[List[Int]]</span><a href="../../Array.scala.html#1070">Array</a></span>[List[Int]](<span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>) <span class="comment">// default transitions</span>

    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="113382">j</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
    <span class="typed"><span class="type">Unit</span><a href="#113390" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#113382">j</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>) {
      <span class="typed"><span class="type">=&gt; Array[scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]]</span><a href="#59283">deltaq</a></span>(<span class="typed"><span class="type">Int</span><a href="#113382">j</a></span>) = <span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]</span><span class="keyword">new</span></span> mutable.<span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]</span><a href="../../collection/mutable/HashMap.scala.html#11326">HashMap</a></span>[_labelT,List[Int]]()
      <span class="typed"><span class="type">=&gt; Array[List[Int]]</span><a href="#59286">defaultq</a></span>(<span class="typed"><span class="type">Int</span><a href="#113382">j</a></span>) = <span class="typed"><span class="type">object Nil</span><a href="../../List.scala.html#333">Nil</a></span>
      <span class="typed"><span class="type">Int</span><a href="#113382">j</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
    }
  }

  <span class="keyword">protected</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="59301">collectTransitions</a></span>(): <span class="typed"><span class="type">Unit</span><a id="2167">Unit</a></span> = {  <span class="comment">// make transitions</span>
    <span class="comment">//Console.println(&quot;WBS.collectTrans, this.follow.keys = &quot;+this.follow.keys)</span>
    <span class="comment">//Console.println(&quot;WBS.collectTrans, pos = &quot;+this.follow.keys)</span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="113416">j</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>; <span class="typed"><span class="type">Unit</span><a href="#113417" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#113416">j</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>) {
      <span class="comment">//Console.println(&quot;WBS.collectTrans, j = &quot;+j)</span>
      <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a id="113419">fol</a></span> = <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">(Int)scala.collection.immutable.Set[Int]</span><a href="../../collection/Map.scala.html#21391">follow</a></span>(<span class="typed"><span class="type">Int</span><a href="#113416">j</a></span>)
      <span class="keyword">val</span> <span class="typed"><span class="type">Iterator[Int]</span><a id="113420">it</a></span> = <span class="typed"><span class="type">scala.collection.immutable.Set[Int]</span><a href="#113419">fol</a></span>.<span class="typed"><span class="type">=&gt; Iterator[Int]</span><a href="../../Iterable.scala.html#17309">elements</a></span>
      <span class="typed"><span class="type">Unit</span><a href="#113421" class="keyword">while</a></span> (<span class="typed"><span class="type">Iterator[Int]</span><a href="#113420">it</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../../Iterator.scala.html#19975">hasNext</a></span>) {
        <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="113426">k</a></span> = <span class="typed"><span class="type">Iterator[Int]</span><a href="#113420">it</a></span>.<span class="typed"><span class="type">()Int</span><a href="../../Iterator.scala.html#19976">next</a></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int</span><a href="#113426">k</a></span>)
          <span class="typed"><span class="type">(scala.collection.immutable.TreeMap[Int,Int])Unit</span><a href="BaseBerrySethi.scala.html#59264">finals</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.immutable.TreeMap[Int,Int]</span><a href="BaseBerrySethi.scala.html#59263">finals</a></span>.<span class="typed"><span class="type">(Int,Int)scala.collection.immutable.TreeMap[Int,Int]</span><a href="../../collection/immutable/TreeMap.scala.html#50870">update</a></span>(<span class="typed"><span class="type">Int</span><a href="#113416">j</a></span>, <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59260">finalTag</a></span>)
        <span class="keyword">else</span>
          <span class="typed"><span class="type">(Int,Int,WordBerrySethi.this._labelT)Unit</span><a href="#59298">makeTransition</a></span>( <span class="typed"><span class="type">Int</span><a href="#113416">j</a></span>, <span class="typed"><span class="type">Int</span><a href="#113426">k</a></span>, <span class="typed"><span class="type">(Int)WordBerrySethi.this._labelT</span><a href="../../collection/immutable/TreeMap.scala.html#50878">labelAt</a></span>(<span class="typed"><span class="type">Int</span><a href="#113426">k</a></span>))
      }
      <span class="typed"><span class="type">Int</span><a href="#113416">j</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
    }
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp,Int)scala.util.automata.NondetWordAutom[WordBerrySethi.this._labelT]</span><a id="59302">automatonFrom</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a id="59306">pat</a></span>: <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="../regexp/Base.scala.html#59155">RegExp</a></span>, <span class="typed"><span class="type">Int</span><a id="59307">finalTag</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>): <span class="typed"><span class="type">scala.util.automata.NondetWordAutom[WordBerrySethi.this._labelT]</span><a href="NondetWordAutom.scala.html#12968">NondetWordAutom</a></span>[_labelT] = {
    <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971" class="keyword">this</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a href="BaseBerrySethi.scala.html#59261">finalTag</a></span> = <span class="typed"><span class="type">Int</span><a href="#59307">finalTag</a></span>

    <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#59306">pat</a></span> <span class="typed"><span class="type">scala.util.automata.NondetWordAutom[WordBerrySethi.this._labelT]</span><span class="keyword">match</span></span> {
      <span class="typed"><span class="type">scala.util.automata.NondetWordAutom[WordBerrySethi.this._labelT]{ ... }</span><span class="keyword">case</span></span> <span class="typed"><span class="type">WordBerrySethi.this.lang.Sequ</span><a id="113462">x</a></span>:<span class="typed"><span class="type">WordBerrySethi.this.lang.Sequ</span><a href="../regexp/Base.scala.html#59159">Sequ</a></span> =&gt;
        <span class="comment">// (1,2) compute follow + first</span>
        <span class="typed"><span class="type">(Seq[WordBerrySethi.this.lang.RegExp])Unit</span><a href="#59299">initialize</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.Sequ</span><a href="#113462">x</a></span>.<span class="typed"><span class="type">=&gt; WordBerrySethi.this.lang._regexpT*</span><a href="../regexp/Base.scala.html#69757">rs</a></span>)
        <span class="typed"><span class="type">(Int)Unit</span><a href="BaseBerrySethi.scala.html#59252">pos</a></span> = <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
        <span class="typed"><span class="type">(scala.collection.immutable.Set[Int])Unit</span><a href="BaseBerrySethi.scala.html#59255">globalFirst</a></span> = <span class="typed"><span class="type">(Seq[WordBerrySethi.this.lang.RegExp])scala.collection.immutable.Set[Int]</span><a href="BaseBerrySethi.scala.html#59270">compFollow</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang.Sequ</span><a href="#113462">x</a></span>.<span class="typed"><span class="type">=&gt; WordBerrySethi.this.lang._regexpT*</span><a href="../regexp/Base.scala.html#69757">rs</a></span>)

        <span class="comment">//System.out.print(&quot;someFirst:&quot;);debugPrint(someFirst);</span>
        <span class="comment">// (3) make automaton from follow sets</span>
        <span class="typed"><span class="type">()Unit</span><a href="#59300">initializeAutom</a></span>()
        <span class="typed"><span class="type">()Unit</span><a href="#59301">collectTransitions</a></span>()

        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">WordBerrySethi.this.lang.Sequ</span><a href="#113462">x</a></span>.<span class="typed"><span class="type">=&gt; Boolean</span><a href="../regexp/Base.scala.html#69760">isNullable</a></span>) <span class="comment">// initial state is final</span>
          <span class="typed"><span class="type">(scala.collection.immutable.TreeMap[Int,Int])Unit</span><a href="BaseBerrySethi.scala.html#59264">finals</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.immutable.TreeMap[Int,Int]</span><a href="BaseBerrySethi.scala.html#59263">finals</a></span>.<span class="typed"><span class="type">(Int,Int)scala.collection.immutable.TreeMap[Int,Int]</span><a href="../../collection/immutable/TreeMap.scala.html#50870">update</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Int</span><a href="#59307">finalTag</a></span>)

        <span class="keyword">var</span> <span class="typed"><span class="type">scala.collection.immutable.TreeMap[Int,scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]]</span><a id="113463">delta1</a></span>: immutable.<span class="typed"><span class="type">scala.collection.immutable.TreeMap[Int,scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]]</span><a href="../../collection/immutable/TreeMap.scala.html#9506">TreeMap</a></span>[Int, Map[_labelT, List[Int]]] =
          <span class="typed"><span class="type">()(implicit (Int) =&gt; Ordered[Int])scala.collection.immutable.TreeMap[Int,scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]]</span><a href="../../collection/immutable/TreeMap.scala.html#50857" class="keyword">new</a></span> immutable.<span class="typed"><span class="type">scala.collection.immutable.TreeMap[Int,scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]]</span><a href="../../collection/immutable/TreeMap.scala.html#9506">TreeMap</a></span>[Int, Map[_labelT, List[Int]]]

        <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="113464">i</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
        <span class="typed"><span class="type">Unit</span><a href="#113470" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#113464">i</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">=&gt; Array[scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]]</span><a href="#59283">deltaq</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="../../Array.scala.html#17252">length</a></span>) {
          <span class="typed"><span class="type">scala.collection.immutable.TreeMap[Int,scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]]</span><a href="#113463">delta1</a></span> = <span class="typed"><span class="type">scala.collection.immutable.TreeMap[Int,scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]]</span><a href="#113463">delta1</a></span>.<span class="typed"><span class="type">(Int,scala.collection.Map[WordBerrySethi.this._labelT,List[Int]])scala.collection.immutable.TreeMap[Int,scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]]</span><a href="../../collection/immutable/TreeMap.scala.html#50870">update</a></span>(<span class="typed"><span class="type">Int</span><a href="#113464">i</a></span>, <span class="typed"><span class="type">(Int)scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,List[Int]]</span><a href="../../Array.scala.html#17253">deltaq</a></span>(<span class="typed"><span class="type">Int</span><a href="#113464">i</a></span>))
          <span class="typed"><span class="type">Int</span><a href="#113464">i</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
        }
        <span class="keyword">val</span> <span class="typed"><span class="type">Array[Int]</span><a id="113465">finalsArr</a></span> = <span class="typed"><span class="type">Array[Int]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Int]</span><a href="../../Array.scala.html#1070">Array</a></span>[Int](<span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>)

        {
          <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="113539">k</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>; <span class="typed"><span class="type">Unit</span><a href="#113540" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#113539">k</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>) {
            <span class="typed"><span class="type">Array[Int]</span><a href="#113465">finalsArr</a></span>(<span class="typed"><span class="type">Int</span><a href="#113539">k</a></span>) = <span class="typed"><span class="type">=&gt; scala.collection.immutable.TreeMap[Int,Int]</span><a href="BaseBerrySethi.scala.html#59263">finals</a></span>.<span class="typed"><span class="type">(Int)Option[Int]</span><a href="../../collection/immutable/TreeMap.scala.html#50877">get</a></span>(<span class="typed"><span class="type">Int</span><a href="#113539">k</a></span>) <span class="typed"><span class="type">Int</span><span class="keyword">match</span></span> {
              <span class="typed"><span class="type">Int</span><span class="keyword">case</span></span> <a id="1">Some</a>(<span class="typed"><span class="type">Int</span><a id="113543">z</a></span>) =&gt; <span class="typed"><span class="type">Int</span><a href="#113543">z</a></span>
              <span class="typed"><span class="type">Int(0)</span><span class="keyword">case</span></span> <span class="typed"><span class="type">object None</span><a href="../../Option.scala.html#534">None</a></span> =&gt; <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span> <span class="comment">// 0 == not final</span>
            };
            <span class="typed"><span class="type">Int</span><a href="#113539">k</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
          }
        }

        <span class="keyword">val</span> <span class="typed"><span class="type">Array[Int]</span><a id="113466">initialsArr</a></span> = <span class="typed"><span class="type">Array[Int]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Int]</span><a href="../../Array.scala.html#1070">Array</a></span>[Int](<span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="#59289">initials</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="../../collection/Set.scala.html#22906">size</a></span>)
        <span class="keyword">val</span> <span class="typed"><span class="type">Iterator[Int]</span><a id="113467">it</a></span> = <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="#59289">initials</a></span>.<span class="typed"><span class="type">=&gt; Iterator[Int]</span><a href="../../Iterable.scala.html#17309">elements</a></span>

        {
          <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="113568">k</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>; <span class="typed"><span class="type">Unit</span><a href="#113569" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#113568">k</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">=&gt; scala.collection.immutable.Set[Int]</span><a href="#59289">initials</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="../../collection/Set.scala.html#22906">size</a></span>) {
            <span class="typed"><span class="type">Array[Int]</span><a href="#113466">initialsArr</a></span>(<span class="typed"><span class="type">Int</span><a href="#113568">k</a></span>) = <span class="typed"><span class="type">Iterator[Int]</span><a href="#113467">it</a></span>.<span class="typed"><span class="type">()Int</span><a href="../../Iterator.scala.html#19976">next</a></span>
            <span class="typed"><span class="type">Int</span><a href="#113568">k</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
          }
        }

        <span class="keyword">val</span> <span class="typed"><span class="type">Array[scala.collection.Map[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]]</span><a id="113468">deltaArr</a></span> = <span class="typed"><span class="type">Array[scala.collection.Map[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[scala.collection.Map[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]]</span><a href="../../Array.scala.html#1070">Array</a></span>[Map[_labelT, immutable.BitSet]](<span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>)

        {
          <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="113595">k</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>; <span class="typed"><span class="type">Unit</span><a href="#113596" class="keyword">while</a></span>(<span class="typed"><span class="type">Int</span><a href="#113595">k</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>) {
            <span class="keyword">val</span> <span class="typed"><span class="type">Iterator[WordBerrySethi.this._labelT]</span><a id="113598">labels</a></span> = <span class="typed"><span class="type">(Int)scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]</span><a href="../../collection/immutable/TreeMap.scala.html#50878">delta1</a></span>(<span class="typed"><span class="type">Int</span><a href="#113595">k</a></span>).<span class="typed"><span class="type">=&gt; Iterator[WordBerrySethi.this._labelT]</span><a href="../../collection/Map.scala.html#21394">keys</a></span>
            <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]</span><a id="113599">hmap</a></span> =
              <span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]</span><span class="keyword">new</span></span> mutable.<span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]</span><a href="../../collection/mutable/HashMap.scala.html#11326">HashMap</a></span>[_labelT, immutable.BitSet]
            <span class="keyword">for</span> (<span class="typed"><span class="type">((WordBerrySethi.this._labelT) =&gt; Unit)Unit</span><a href="../../Iterator.scala.html#20001" id="113605">lab</a></span> &lt;- <span class="typed"><span class="type">Iterator[WordBerrySethi.this._labelT]</span><a href="#113598">labels</a></span>) {
              <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]</span><a id="113606">trans</a></span> = <span class="typed"><span class="type">(Int)scala.collection.Map[WordBerrySethi.this._labelT,List[Int]]</span><a href="../../collection/immutable/TreeMap.scala.html#50878">delta1</a></span>(<span class="typed"><span class="type">Int</span><a href="#113595">k</a></span>)
              <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.BitSet</span><a id="113607">x</a></span> = <span class="typed"><span class="type">scala.collection.mutable.BitSet</span><span class="keyword">new</span></span> mutable.<span class="typed"><span class="type">scala.collection.mutable.BitSet</span><a href="../../collection/mutable/BitSet.scala.html#11191">BitSet</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>)
              <span class="keyword">for</span> (<span class="typed"><span class="type">((Int) =&gt; Unit)Unit</span><a href="../../List.scala.html#20910" id="113618">q</a></span> &lt;- <span class="typed"><span class="type">(WordBerrySethi.this._labelT)List[Int]</span><a href="../../collection/Map.scala.html#21391">trans</a></span>(<span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="#113605">lab</a></span>))
                <span class="typed"><span class="type">scala.collection.mutable.BitSet</span><a href="#113607">x</a></span> <span class="typed"><span class="type">(Int)Unit</span><a href="../../collection/mutable/BitSet.scala.html#50724">+=</a></span> <span class="typed"><span class="type">Int</span><a href="#113618">q</a></span>
              <span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]</span><a href="#113599">hmap</a></span>.<span class="typed"><span class="type">(WordBerrySethi.this._labelT,scala.collection.immutable.BitSet)Unit</span><a href="../../collection/mutable/DefaultMapModel.scala.html#21441">update</a></span>(<span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="#113605">lab</a></span>, <span class="typed"><span class="type">scala.collection.mutable.BitSet</span><a href="#113607">x</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.immutable.BitSet</span><a href="../../collection/mutable/BitSet.scala.html#50727">toImmutable</a></span>)
            }
            <span class="typed"><span class="type">Array[scala.collection.Map[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]]</span><a href="#113468">deltaArr</a></span>(<span class="typed"><span class="type">Int</span><a href="#113595">k</a></span>) = <span class="typed"><span class="type">scala.collection.mutable.HashMap[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]</span><a href="#113599">hmap</a></span>
            <span class="typed"><span class="type">Int</span><a href="#113595">k</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
          }
        }
        <span class="keyword">val</span> <span class="typed"><span class="type">Array[scala.collection.immutable.BitSet]</span><a id="113469">defaultArr</a></span> = <span class="typed"><span class="type">Array[scala.collection.immutable.BitSet]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[scala.collection.immutable.BitSet]</span><a href="../../Array.scala.html#1070">Array</a></span>[immutable.BitSet](<span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>)

        {
          <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="113643">k</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>; <span class="typed"><span class="type">Unit</span><a href="#113644" class="keyword">while</a></span>(<span class="typed"><span class="type">Int</span><a href="#113643">k</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>) {
            <span class="keyword">val</span> <span class="typed"><span class="type">scala.collection.mutable.BitSet</span><a id="113646">x</a></span> = <span class="typed"><span class="type">scala.collection.mutable.BitSet</span><span class="keyword">new</span></span> mutable.<span class="typed"><span class="type">scala.collection.mutable.BitSet</span><a href="../../collection/mutable/BitSet.scala.html#11191">BitSet</a></span>(<span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>)
            <span class="keyword">for</span> (<span class="typed"><span class="type">((Int) =&gt; Unit)Unit</span><a href="../../List.scala.html#20910" id="113654">q</a></span> &lt;- <span class="typed"><span class="type">(Int)List[Int]</span><a href="../../Array.scala.html#17253">defaultq</a></span>(<span class="typed"><span class="type">Int</span><a href="#113643">k</a></span>))
              <span class="typed"><span class="type">scala.collection.mutable.BitSet</span><a href="#113646">x</a></span> <span class="typed"><span class="type">(Int)Unit</span><a href="../../collection/mutable/BitSet.scala.html#50724">+=</a></span> <span class="typed"><span class="type">Int</span><a href="#113654">q</a></span>
            <span class="typed"><span class="type">Array[scala.collection.immutable.BitSet]</span><a href="#113469">defaultArr</a></span>(<span class="typed"><span class="type">Int</span><a href="#113643">k</a></span>) = <span class="typed"><span class="type">scala.collection.mutable.BitSet</span><a href="#113646">x</a></span>.<span class="typed"><span class="type">=&gt; scala.collection.immutable.BitSet</span><a href="../../collection/mutable/BitSet.scala.html#50727">toImmutable</a></span>
            <span class="typed"><span class="type">Int</span><a href="#113643">k</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
          }
        }

        <span class="typed"><span class="type">template $anon extends scala.util.automata.NondetWordAutom[WordBerrySethi.this._labelT]</span><a id="113678" class="keyword">new</a></span> <span class="typed"><span class="type">scala.util.automata.NondetWordAutom[WordBerrySethi.this._labelT]</span><a href="NondetWordAutom.scala.html#12968">NondetWordAutom</a></span>[_labelT] {
          <span class="keyword">type</span> <span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a id="113680">_labelT</a></span> = WordBerrySethi.<span class="keyword">this</span>.<span class="typed"><span class="type">WordBerrySethi.this._labelT</span><a href="../regexp/WordExp.scala.html#59172">_labelT</a></span>
          <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><span id="113682"><a id="113681">nstates</a></span></span>  = <span class="typed"><span class="type">=&gt; Int</span><a href="BaseBerrySethi.scala.html#59251">pos</a></span>
          <span class="keyword">val</span> <span class="typed"><span class="type">List[WordBerrySethi.this._labelT]</span><span id="113684"><a id="113683">labels</a></span></span>   = <span class="typed"><span class="type">WordBerrySethi.this.type</span><a href="#12971">WordBerrySethi</a></span>.<span class="keyword">this</span>.<span class="typed"><span class="type">=&gt; scala.collection.mutable.HashSet[WordBerrySethi.this._labelT]</span><a href="#59277">labels</a></span>.<span class="typed"><span class="type">=&gt; List[WordBerrySethi.this._labelT]</span><a href="../../Iterable.scala.html#17360">toList</a></span>
          <span class="keyword">val</span> <span class="typed"><span class="type">Array[Int]</span><span id="113686"><a id="113685">initials</a></span></span> = <span class="typed"><span class="type">Array[Int]</span><a href="#113466">initialsArr</a></span>
          <span class="keyword">val</span> <span class="typed"><span class="type">Array[Int]</span><span id="113688"><a id="113687">finals</a></span></span>   = <span class="typed"><span class="type">Array[Int]</span><a href="#113465">finalsArr</a></span>
          <span class="keyword">val</span> <span class="typed"><span class="type">Array[scala.collection.Map[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]]</span><span id="113690"><a id="113689">delta</a></span></span>    = <span class="typed"><span class="type">Array[scala.collection.Map[WordBerrySethi.this._labelT,scala.collection.immutable.BitSet]]</span><a href="#113468">deltaArr</a></span>
          <span class="keyword">val</span> <span class="typed"><span class="type">Array[scala.collection.immutable.BitSet]</span><span id="113692"><a id="113691">default</a></span></span>  = <span class="typed"><span class="type">Array[scala.collection.immutable.BitSet]</span><a href="#113469">defaultArr</a></span>
        }
      <span class="typed"><span class="type">scala.util.automata.NondetWordAutom[WordBerrySethi.this._labelT]</span><span class="keyword">case</span></span> <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a id="113694">z</a></span> =&gt;
       <span class="keyword">val</span> <span class="typed"><span class="type">WordBerrySethi.this.lang._regexpT</span><a id="113695">z1</a></span> = <span class="typed"><span class="type">WordBerrySethi.this.lang.RegExp</span><a href="#113694">z</a></span>.<span class="typed"><span class="type">WordBerrySethi.this.lang._regexpT</span><a id="3501">asInstanceOf</a></span>[<span class="keyword">this</span>.lang.<span class="typed"><span class="type">WordBerrySethi.this.lang._regexpT</span><a href="../regexp/WordExp.scala.html#59171">_regexpT</a></span>]
       <span class="typed"><span class="type">(WordBerrySethi.this.lang.RegExp,Int)scala.util.automata.NondetWordAutom[WordBerrySethi.this._labelT]</span><a href="#59302">automatonFrom</a></span>(<span class="typed"><span class="type">(WordBerrySethi.this.lang._regexpT*)WordBerrySethi.this.lang.Sequ</span><a href="../regexp/Base.scala.html#69773">Sequ</a></span>(<span class="typed"><span class="type">WordBerrySethi.this.lang._regexpT</span><a href="#113695">z1</a></span>), <span class="typed"><span class="type">Int</span><a href="#59307">finalTag</a></span>)
    }
  }

  <span class="comment">/*
   void print1() {
   System.out.println(&quot;after sethi-style processing&quot;);
   System.out.println(&quot;#positions:&quot; + pos);
   System.out.println(&quot;posMap:&quot;);

   for (Iterator it = this.posMap.keySet().iterator();
   it.hasNext(); ) {
   Tree t = (Tree) it.next();
                  switch(t) {
                  case Literal( _ ):
                        System.out.print( &quot;(&quot; + t.toString() + &quot; -&gt; &quot;);
                        String s2 = ((Integer) posMap.get(t)).toString();
                        System.out.print( s2 +&quot;) &quot;);
                  }
            }
            System.out.println(&quot;\nfollow: &quot;);
            for (int j = 1; j &lt; pos; j++ ) {
                  TreeSet fol = (TreeSet) this.follow.get(new Integer(j));
                  System.out.print(&quot;(&quot;+j+&quot; -&gt; &quot;+fol.toString()+&quot;) &quot;);
                  //debugPrint( fol );
                  System.out.println();
            }

      }
    */</span>
}

        </pre>
    </body>
</html>