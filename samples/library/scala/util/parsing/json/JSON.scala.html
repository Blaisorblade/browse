<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/util/parsing/json/JSON.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2006-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

// $Id: JSON.scala 18468 2009-08-12 14:25:05Z dchenbecker $


<span class="keyword">package</span> scala.util.parsing.json
<span class="keyword">import</span> scala.util.parsing.combinator._
<span class="keyword">import</span> scala.util.parsing.combinator.syntactical._
<span class="keyword">import</span> scala.util.parsing.combinator.lexical._

/** 
 * This object provides a simple interface to the JSON parser class. The default conversion
 * for numerics is into a double. If you wish to override this behavior at the global level,
 * you can set the globalNumberParser property to your own (String =&gt; Any) function. If you only
 * want to override at the per-thread level then you can set the perThreadNumberParser property to your
 * function. For example:
 * 
 * &lt;pre&gt;
 * val myConversionFunc = {input : String =&gt; BigDecimal(input)}
 * 
 * // Global override
 * JSON.globalNumberParser = myConversionFunc
 * 
 * // Per-thread override
 * JSON.perThreadNumberParser = myConversionFunc
 * &lt;/pre&gt;
 *
 *  @author Derek Chen-Becker &lt;&quot;java&quot;+@+&quot;chen-becker&quot;+&quot;.&quot;+&quot;org&quot;&gt;
 */
<span class="keyword">object</span> <a title="object scala.util.parsing.json.JSON" id="13972">JSON</a> <a href="../../../ScalaObject.scala.html#969" title="ScalaObject" class="keyword">extends</a> <a href="Parser.scala.html#13977" title="scala.util.parsing.json.Parser">Parser</a> {

  /**
   * Parse the given JSON string and return a list of elements. If the
   * string is a JSON object it will be a list of pairs. If it's a JSON 
   * array it will be be a list of individual elements.
   *
   * @param input the given JSON string.
   * @return      an optional list of of elements. 
   */
  <span class="keyword">def</span> <a title="(input: String)Option[List[Any]]" id="125254">parse</a>(<a title="String" id="125311">input</a>: <span title="String">String</span>): <a href="../../../Option.scala.html#789" title="Option[List[Any]]">Option</a>[List[Any]] =
    <a href="../combinator/Parsers.scala.html#57591" title="(p: scala.util.parsing.json.JSON.Parser[List[Any]])scala.util.parsing.json.JSON.Parser[List[Any]]">phrase</a><a href="../combinator/Parsers.scala.html#57681" title="(in: scala.util.parsing.json.JSON.Input)scala.util.parsing.json.JSON.ParseResult[List[Any]]">(</a><a href="Parser.scala.html#125246" title="=&gt; scala.util.parsing.json.JSON.Parser[List[Any]]">root</a>)(<a href="../combinator/lexical/Scanners.scala.html#125917" title="(in: String)scala.util.parsing.json.JSON.lexical.Scanner" class="keyword">new</a> <a href="Parser.scala.html#125238" title="=&gt; scala.util.parsing.json.Lexer">lexical</a>.<a href="../combinator/lexical/Scanners.scala.html#57610" title="scala.util.parsing.json.JSON.lexical.Scanner">Scanner</a>(<a href="#125311" title="String">input</a>)) <span title="Option[List[Any]]" class="keyword">match</span> {
      <span title="Some[List[Any]]" class="keyword">case</span> Success(<a title="List[Any]" id="125946">result</a>, _) =&gt; <a href="../../../Option.scala.html#19907" title="(x: List[Any])Some[List[Any]]">Some</a>(<a href="#125946" title="List[Any]">result</a>)
      <span title="None.type" class="keyword">case</span> _ =&gt; <a href="../../../Option.scala.html#472" title="object None">None</a>
    }
  
  /**
   * Parse the given JSON string and return either a &lt;code&gt;List[Any]&lt;/code&gt;
   * if the JSON string specifies an &lt;code&gt;Array&lt;/code&gt;, or a
   * &lt;code&gt;Map[String,Any]&lt;/code&gt; if the JSON string specifies an object.
   *
   * @param input the given JSON string.
   * @return      an optional list or map.
   */
  <span class="keyword">def</span> <a title="(input: String)Option[Any]" id="125255">parseFull</a>(<a title="String" id="125959">input</a>: <span title="String">String</span>): <a href="../../../Option.scala.html#789" title="Option[Any]">Option</a>[Any] =
    <a href="#125254" title="(input: String)Option[List[Any]]">parse</a>(<a href="#125959" title="String">input</a>) <span title="Option[Any]" class="keyword">match</span> {
      <span title="Some[Any]" class="keyword">case</span> Some(<a title="List[Any]" id="125964">data</a>) =&gt; <a href="../../../Option.scala.html#19907" title="(x: Any)Some[Any]">Some</a>(<a href="#125256" title="(input: List[_])Any">resolveType</a>(<a href="#125964" title="List[Any]">data</a>))
      <span title="None.type" class="keyword">case</span> <a href="../../../Option.scala.html#472" title="object None">None</a> =&gt; <a href="../../../Option.scala.html#472" title="object None">None</a>
    }

  /**
   * A utility method to resolve a parsed JSON list into objects or 
   * arrays. See the parse method for details.
   */
  <span class="keyword">def</span> <a title="(input: List[_])Any" id="125256">resolveType</a>(<a title="List[_]" id="125969">input</a>: <a href="../../../collection/immutable/List.scala.html#9048" title="List[_]">List</a>[_]): <span title="Any">Any</span> = {
    <span class="keyword">var</span> <a title="scala.collection.immutable.Map[String,Any]" id="125979">objMap</a> = <a href="../../../collection/generic/MapFactory.scala.html#35294" title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</a><span title="(elems: (String, Any)*)scala.collection.immutable.Map[String,Any]">[</span><span title="String">String</span>, <span title="Any">Any</span>]()
    
    <span title="Any" class="keyword">if</span> (<a href="#125969" title="List[_]">input</a>.<a href="../../../collection/generic/LinearSequenceTemplate.scala.html#19512" title="(p: (Any) =&gt; Boolean)Boolean">forall</a> <a href="#125990" title="Boolean">{</a> 
      <span title="Boolean" class="keyword">case</span> (<a title="String" id="125993">key</a>: <span title="String">String</span>, <a title="List[_]" id="125994">value</a>: <a href="../../../collection/immutable/List.scala.html#9048" title="List[_]">List</a>[_]) =&gt;
        <a href="#125979" title="scala.collection.immutable.Map[String,Any]">objMap</a> = <a href="#125979" title="scala.collection.immutable.Map[String,Any]">objMap</a>.<a href="../../../collection/immutable/Map.scala.html#35331" title="[B1 &gt;: Any](kv: (String, B1))scala.collection.immutable.Map[String,B1]">+</a><span title="(kv: (String, Any))scala.collection.immutable.Map[String,Any]">[</span><span title="Any">Any</span>](<a href="../../../Predef.scala.html#19210" title="(y: Any)(String, Any)">key</a> -&gt; <a href="#125256" title="(input: List[_])Any">resolveType</a>(<a href="#125994" title="List[_]">value</a>))
        <span title="Boolean(true)" class="keyword">true</span>
      <span title="Boolean" class="keyword">case</span> (<a title="String" id="126143">key</a> : <span title="String">String</span>, <a title="Any" id="126144">value</a>) =&gt;
        <a href="#125979" title="scala.collection.immutable.Map[String,Any]">objMap</a> += <a href="../../../Predef.scala.html#19210" title="(y: Any)(String, Any)">key</a> -&gt; <a href="#126144" title="Any">value</a>
        <span title="Boolean(true)" class="keyword">true</span>
      <span title="Boolean(false)" class="keyword">case</span> _ =&gt; <span title="Boolean(false)" class="keyword">false</span>
    }) <a href="#125979" title="scala.collection.immutable.Map[String,Any]">objMap</a>
    <span class="keyword">else</span>
      <a href="#125969" title="List[_]">input</a>.<a href="../../../collection/generic/TraversableTemplate.scala.html#17268" title="(f: (_$1) =&gt; Any)(implicit bf: scala.collection.generic.BuilderFactory[Any,Any,List[_$1]])Any">map</a> <a href="#126328" title="Any">{</a>
          <span title="Any" class="keyword">case</span> <a title="List[_]" id="126329">l</a> : <a href="../../../collection/immutable/List.scala.html#9048" title="List[_]">List</a>[_] =&gt; <a href="#125256" title="(input: List[_])Any">resolveType</a>(<a href="#126329" title="List[_]">l</a>)
          <span title="_$1" class="keyword">case</span> <a title="_$1" id="126333">x</a> =&gt; <a href="#126333" title="_$1">x</a>
      }
  }
  
  /**
   * The global (VM) default function for converting a string to a numeric value. 
   */
  <span class="keyword">def</span> <a title="(f: (String) =&gt; Any)Unit" id="125257">globalNumberParser_=</a>(<a title="(String) =&gt; Any" id="126414">f</a>: <a href="../../../Function1.scala.html#162" title="(String) =&gt; Any">NumericParser</a>) { <a href="Parser.scala.html#125242" title="(x$1: (String) =&gt; Any)Unit">defaultNumberParser</a> = <a href="#126414" title="(String) =&gt; Any">f</a> }
  <span class="keyword">def</span> <a title="=&gt; (String) =&gt; Any" id="125258">globalNumberParser</a> : <a href="../../../Function1.scala.html#162" title="(String) =&gt; Any">NumericParser</a> = <a href="Parser.scala.html#125241" title="=&gt; (String) =&gt; Any">defaultNumberParser</a>
  
  /**
   * Defines the function used to convert a numeric string literal into a numeric format on a per-thread
   * basis. Use globalNumberParser for a global override
   */
   <span class="keyword">def</span> <a title="(f: (String) =&gt; Any)Unit" id="125259">perThreadNumberParser_=</a>(<a title="(String) =&gt; Any" id="126422">f</a> : <a href="../../../Function1.scala.html#162" title="(String) =&gt; Any">NumericParser</a>) { <a href="Parser.scala.html#125244" title="=&gt; java.lang.ThreadLocal[(String) =&gt; Any]">numberParser</a>.<a title="(x$1: (String) =&gt; Any)Unit" id="37049">set</a>(<a href="#126422" title="(String) =&gt; Any">f</a>) }
   <span class="keyword">def</span> <a title="=&gt; (String) =&gt; Any" id="125260">perThreadNumberParser</a> : <a href="../../../Function1.scala.html#162" title="(String) =&gt; Any">NumericParser</a> = <a href="Parser.scala.html#125244" title="=&gt; java.lang.ThreadLocal[(String) =&gt; Any]">numberParser</a>.<a title="()(String) =&gt; Any" id="37048">get</a>()
}

        </pre>
    </body>
</html>