<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/util/ClassLoader.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2009 LAMP/EPFL
 * @author  Paul Phillips
 */

<span class="keyword">package</span> scala.util

<span class="keyword">import</span> java.lang.{ ClassLoader =&gt; JavaClassLoader }
<span class="keyword">import</span> java.lang.reflect.{ Constructor, Modifier, Method }
<span class="keyword">import</span> java.net.URL
<span class="keyword">import</span> ScalaClassLoader._
<span class="keyword">import</span> scala.util.control.Exception.{ catching }

<span class="keyword">trait</span> <a title="trait ScalaClassLoader extends java.lang.ClassLoader with ScalaObject" id="8131">ScalaClassLoader</a> <a href="../ScalaObject.scala.html#969" title="ScalaObject" class="keyword">extends</a> <span title="java.lang.ClassLoader">JavaClassLoader</span>
{
  /** Executing an action with this classloader as context classloader */
  <span class="keyword">def</span> <a title="[T](action: =&gt; T)T" id="162879">asContext</a>[<a title="&gt;: Nothing &lt;: Any" id="162881">T</a>](<a title="=&gt; T" id="162896">action</a>: =&gt; T): <a href="#162881" title="T">T</a> = {
    <span class="keyword">val</span> <a title="java.lang.ClassLoader" id="162899">oldLoader</a> = <a href="#138313" title="()java.lang.ClassLoader">getContextLoader</a>
    <span class="keyword">try</span> {
      <a href="#138312" title="(cl: java.lang.ClassLoader)Unit">setContextLoader</a>(<a href="#8131" title="scala.util.ScalaClassLoader" class="keyword">this</a>)
      <a href="#162896" title="=&gt; T">action</a>
    }
    <span class="keyword">finally</span> <a href="#138312" title="(cl: java.lang.ClassLoader)Unit">setContextLoader</a>(<a href="#162899" title="java.lang.ClassLoader">oldLoader</a>)
  }
  <span class="keyword">def</span> <a title="()Unit" id="162882">setAsContext</a>() { <a href="#138312" title="(cl: java.lang.ClassLoader)Unit">setContextLoader</a>(<a href="#8131" title="scala.util.ScalaClassLoader" class="keyword">this</a>) }
  
  /** Load and link a class with this classloader */  
  <span class="keyword">def</span> <a title="[T &lt;: AnyRef](path: String)Option[Class[T]]" id="162883">tryToLoadClass</a>[<a title="&gt;: Nothing &lt;: AnyRef" id="162885">T</a> &lt;: AnyRef](<a title="String" id="162922">path</a>: <span title="String">String</span>): <a href="../Option.scala.html#789" title="Option[Class[T]]">Option</a>[Class[T]] = <a href="#162889" title="(path: String,initialize: Boolean)Option[Class[T]]">tryClass</a>(<a href="#162922" title="String">path</a>, <span title="Boolean(false)" class="keyword">false</span>)
  /** Load, link and initialize a class with this classloader */
  <span class="keyword">def</span> <a title="[T &lt;: AnyRef](path: String)Option[Class[T]]" id="162886">tryToInitializeClass</a>[<a title="&gt;: Nothing &lt;: AnyRef" id="162888">T</a> &lt;: AnyRef](<a title="String" id="162930">path</a>: <span title="String">String</span>): <a href="../Option.scala.html#789" title="Option[Class[T]]">Option</a>[Class[T]] = <a href="#162889" title="(path: String,initialize: Boolean)Option[Class[T]]">tryClass</a>(<a href="#162930" title="String">path</a>, <span title="Boolean(true)" class="keyword">true</span>)
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T &lt;: AnyRef](path: String,initialize: Boolean)Option[Class[T]]" id="162889">tryClass</a>[<a title="&gt;: Nothing &lt;: AnyRef" id="162891">T</a> &lt;: AnyRef](<a title="String" id="162924">path</a>: <span title="String">String</span>, <a title="Boolean" id="162925">initialize</a>: <span title="Boolean">Boolean</span>): <a href="../Option.scala.html#789" title="Option[Class[T]]">Option</a>[Class[T]] =
    <a href="control/Exception.scala.html#31347" title="(exceptions: Class[_]*)util.control.Exception.Catch[Nothing]">catching</a><a href="control/Exception.scala.html#47595" title="(body: =&gt; Class[T])Option[Class[T]]">(</a>classOf<span title="java.lang.Class[java.lang.ClassNotFoundException]">[</span>ClassNotFoundException], classOf<span title="java.lang.Class[java.lang.SecurityException]">[</span>SecurityException]) opt 
      <a title="object java.lang.Class" id="1430">Class</a>.<a title="(x$1: java.lang.String,x$2: Boolean,x$3: java.lang.ClassLoader)java.lang.Class[_]" id="4100">forName</a>(<a href="#162924" title="String">path</a>, <a href="#162925" title="Boolean">initialize</a>, <a href="#8131" title="scala.util.ScalaClassLoader" class="keyword">this</a>).<a title="[T0]T0" id="3636">asInstanceOf</a><span title="Class[T]">[</span><a title="Class[T]" id="1429">Class</a>[T]]

  /** Create an instance of a class with this classloader */
  <span class="keyword">def</span> <a title="(path: String)AnyRef" id="162892">create</a>(<a title="String" id="162974">path</a>: <span title="String">String</span>): <a title="AnyRef" id="1771">AnyRef</a> = {
    <a href="#162886" title="(path: String)Option[Class[Nothing]]">tryToInitializeClass</a>(<a href="#162974" title="String">path</a>) <span title="AnyRef" class="keyword">match</span> {
      <span title="Nothing" class="keyword">case</span> Some(<a title="Class[Nothing]" id="162980">clazz</a>)    =&gt; <a href="#162980" title="Class[Nothing]">clazz</a>.<a title="()Nothing" id="4109">newInstance</a>()
      <span title="Null(null)" class="keyword">case</span> <a href="../Option.scala.html#472" title="object None">None</a>           =&gt; <span title="Null(null)" class="keyword">null</span>
    }
  }
  
  /** Run the main method of a class to be loaded by this classloader */
  <span class="keyword">def</span> <a title="(objectName: String,arguments: Seq[String])Unit" id="162893">run</a>(<a title="String" id="162985">objectName</a>: <span title="String">String</span>, <a title="Seq[String]" id="162986">arguments</a>: <a href="../collection/Sequence.scala.html#4376" title="Seq[String]">Seq</a>[String]) {
    <span class="keyword">val</span> <a title="Class[Nothing]" id="162988">clsToRun</a> = <a href="#162886" title="(path: String)Option[Class[Nothing]]">tryToInitializeClass</a><a href="../Option.scala.html#19870" title="(default: =&gt; Class[Nothing])Class[Nothing]">(</a><a href="#162985" title="String">objectName</a>) getOrElse ( 
      <span title="Nothing" class="keyword">throw</span> <a title="(x$1: java.lang.String)java.lang.ClassNotFoundException" id="138372" class="keyword">new</a> <a title="java.lang.ClassNotFoundException" id="1486">ClassNotFoundException</a>(<a href="#162985" title="String">objectName</a>)
    )
      
    <span class="keyword">val</span> <a title="java.lang.reflect.Method" id="162989">method</a> = <a href="#162988" title="Class[Nothing]">clsToRun</a>.<a title="(x$1: java.lang.String,x$2: java.lang.Class[_]*)java.lang.reflect.Method" id="4897">getMethod</a>(<span title="java.lang.String(&quot;main&quot;)" class="string">&quot;main&quot;</span>, classOf<span title="java.lang.Class[Array[String]]">[</span>Array[String]])
    <span title="Unit" class="keyword">if</span> (<a title="=&gt; Boolean" id="2218">!</a><a title="object java.lang.reflect.Modifier" id="4055">Modifier</a>.<a title="(x$1: Int)Boolean" id="163032">isStatic</a>(<a href="#162989" title="java.lang.reflect.Method">method</a>.<a title="()Int" id="135235">getModifiers</a>))
      <span title="Nothing" class="keyword">throw</span> <a title="(x$1: java.lang.String)java.lang.NoSuchMethodException" id="138380" class="keyword">new</a> <a title="java.lang.NoSuchMethodException" id="1846">NoSuchMethodException</a>(<a href="#162985" title="(x$1: Any)java.lang.String" id="6605">objectName</a> + <span title="java.lang.String(&quot;.main is not static&quot;)" class="string">&quot;.main is not static&quot;</span>)

    <a href="#162879" title="(action: =&gt; java.lang.Object)java.lang.Object">asContext</a><span title="Unit">(</span><a href="#162989" title="java.lang.reflect.Method">method</a>.<a title="(x$1: Any,x$2: java.lang.Object*)java.lang.Object" id="135255">invoke</a>(<span title="Null(null)" class="keyword">null</span>, <a href="../Array.scala.html#29325" title="(xs: Array[String]*)(implicit evidence$2: scala.reflect.ClassManifest[Array[String]])Array[Array[String]]">Array</a><a href="../reflect/ClassManifest.scala.html#26346" title="(clazz: Class[_],arg1: scala.reflect.OptManifest[_],args: scala.reflect.OptManifest[_]*)scala.reflect.ClassManifest[Array[String]]">(</a><a href="#162986" title="Seq[String]">arguments</a>.<a href="../collection/generic/TraversableTemplate.scala.html#17340" title="(implicit evidence$1: scala.reflect.ClassManifest[String])Array[String]">toArray</a>): _*))
  }
}

<span class="keyword">class</span> <a title="class URLClassLoader extends java.net.URLClassLoader with scala.util.ScalaClassLoader with ScalaObject" id="8113">URLClassLoader</a><a href="../ScalaObject.scala.html#969" title="ScalaObject">(</a><a title="List[java.net.URL]" id="163565">urls</a>: <a href="../collection/immutable/List.scala.html#9048" title="List[java.net.URL]">List</a>[URL], <a title="java.lang.ClassLoader" id="163566">parent</a>: <span title="java.lang.ClassLoader">JavaClassLoader</span>) 
    <span class="keyword">extends</span> java.net.<a title="java.net.URLClassLoader" id="4993">URLClassLoader</a>(<a href="#163565" title="List[java.net.URL]">urls</a>.<a href="../collection/generic/TraversableTemplate.scala.html#17340" title="(implicit evidence$1: scala.reflect.ClassManifest[java.net.URL])Array[java.net.URL]">toArray</a>, <a href="#163566" title="java.lang.ClassLoader">parent</a>) 
    <span class="keyword">with</span> <a href="#8131" title="scala.util.ScalaClassLoader">ScalaClassLoader</a>
{
  /** Override to widen to public */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(url: java.net.URL)Unit" id="163533">addURL</a>(<a title="java.net.URL" id="163622">url</a>: <a title="java.net.URL" id="4972">URL</a>) = <span class="keyword">super</span>.<a title="(x$1: java.net.URL)Unit" id="163445">addURL</a>(<a href="#163622" title="java.net.URL">url</a>)
}

<span class="keyword">object</span> <a title="object scala.util.ScalaClassLoader" id="8132">ScalaClassLoader</a> <a href="../ScalaObject.scala.html#969" title="ScalaObject">{</a>
  <span class="keyword">def</span> <a title="(cl: java.lang.ClassLoader)Unit" id="138312">setContextLoader</a>(<a title="java.lang.ClassLoader" id="162908">cl</a>: <span title="java.lang.ClassLoader">JavaClassLoader</span>) = <span title="object java.lang.Thread">Thread</span>.<span title="()java.lang.Thread">currentThread</span>.<a title="(x$1: java.lang.ClassLoader)Unit" id="37393">setContextClassLoader</a>(<a href="#162908" title="java.lang.ClassLoader">cl</a>)
  <span class="keyword">def</span> <a title="()java.lang.ClassLoader" id="138313">getContextLoader</a>() = <span title="object java.lang.Thread">Thread</span>.<span title="()java.lang.Thread">currentThread</span>.<a title="()java.lang.ClassLoader" id="37392">getContextClassLoader</a>()
  <span class="keyword">def</span> <a title="()java.lang.ClassLoader" id="138314">getSystemLoader</a>() = <a title="object java.lang.ClassLoader" id="1484">JavaClassLoader</a>.<a title="()java.lang.ClassLoader" id="25199">getSystemClassLoader</a>()
  <span class="keyword">def</span> <a title="()java.lang.ClassLoader" id="138315">defaultParentClassLoader</a>() = <a href="#138318" title="()java.lang.ClassLoader">findExtClassLoader</a>()
  
  <span class="keyword">def</span> <a title="(urls: Seq[java.net.URL])scala.util.URLClassLoader" id="138316">fromURLs</a>(<a title="Seq[java.net.URL]" id="163636">urls</a>: <a href="../collection/Sequence.scala.html#4376" title="Seq[java.net.URL]">Seq</a>[URL]): <a href="#8113" title="scala.util.URLClassLoader">URLClassLoader</a> =
    <span title="scala.util.URLClassLoader" class="keyword">new</span> <a href="#8113" title="scala.util.URLClassLoader">URLClassLoader</a>(<a href="#163636" title="Seq[java.net.URL]">urls</a>.<a href="../collection/generic/TraversableTemplate.scala.html#17343" title="=&gt; List[java.net.URL]">toList</a>, <a href="#138315" title="()java.lang.ClassLoader">defaultParentClassLoader</a>())
  
  /** True if supplied class exists in supplied path */
  <span class="keyword">def</span> <a title="(urls: Seq[java.net.URL],name: String)Boolean" id="138317">classExists</a>(<a title="Seq[java.net.URL]" id="163642">urls</a>: <a href="../collection/Sequence.scala.html#4376" title="Seq[java.net.URL]">Seq</a>[URL], <a title="String" id="163643">name</a>: <span title="String">String</span>): <span title="Boolean">Boolean</span> =
    (<a href="#138316" title="(urls: Seq[java.net.URL])scala.util.URLClassLoader">fromURLs</a><a href="#162883" title="(path: String)Option[Class[Nothing]]">(</a><a href="#163642" title="Seq[java.net.URL]">urls</a>) tryToLoadClass <a href="#163643" title="String">name</a>).<a href="../Option.scala.html#19865" title="=&gt; Boolean">isDefined</a>  
  
  // we cannot use the app classloader here or we get what looks to
  // be classloader deadlock, but if we pass null we bypass the extension
  // classloader and our extensions, so we search the hierarchy to find
  // the classloader whose parent is null.  Resolves bug #857.
  <span class="keyword">def</span> <a title="()java.lang.ClassLoader" id="138318">findExtClassLoader</a>(): <span title="java.lang.ClassLoader">JavaClassLoader</span> = {
    <span class="keyword">def</span> <a title="(cl: java.lang.ClassLoader)java.lang.ClassLoader" id="163650">search</a>(<a title="java.lang.ClassLoader" id="163651">cl</a>: <span title="java.lang.ClassLoader">JavaClassLoader</span>): <span title="java.lang.ClassLoader">JavaClassLoader</span> = {
      <span title="java.lang.ClassLoader" class="keyword">if</span> (<a href="#163651" title="(x$1: AnyRef)Boolean">cl</a> == <span title="Null(null)" class="keyword">null</span>) <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">else</span> <span title="java.lang.ClassLoader" class="keyword">if</span> (<a href="#163651" title="java.lang.ClassLoader">cl</a>.<span title="(x$1: AnyRef)Boolean">getParent</span> == <span title="Null(null)" class="keyword">null</span>) <a href="#163651" title="java.lang.ClassLoader">cl</a>
      <span class="keyword">else</span> <a href="#163650" title="(cl: java.lang.ClassLoader)java.lang.ClassLoader">search</a>(<a href="#163651" title="java.lang.ClassLoader">cl</a>.<span title="()java.lang.ClassLoader">getParent</span>)
    }
    
    <a href="#163650" title="(cl: java.lang.ClassLoader)java.lang.ClassLoader">search</a>(<a href="#138313" title="()java.lang.ClassLoader">getContextLoader</a>())
  }
}
        </pre>
    </body>
</html>