<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/xml/include/sax/Main.scala</title>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2002-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: Main.scala 16893 2009-01-13 13:09:22Z cunei $</span>

<span class="keyword">package</span> scala.xml.include.sax

<span class="keyword">import</span> org.xml.sax.SAXException
<span class="keyword">import</span> org.xml.sax.SAXParseException
<span class="keyword">import</span> org.xml.sax.EntityResolver
<span class="keyword">import</span> org.xml.sax.helpers.XMLReaderFactory
<span class="keyword">import</span> org.xml.sax.XMLReader

<span class="keyword">object</span> <span class="typed"><span class="type">object scala.xml.include.sax.Main</span><a id="12296">Main</a></span> {
  
    <span class="comment">/**
      * The driver method for xinc
      * Output is written to System.out via Conolse
      * &lt;/p&gt;
      *
      * @param args  contains the URLs and/or filenames
      *              of the documents to be procesed.
      */</span>
    <span class="keyword">def</span> <span class="typed"><span class="type">(Array[String])Unit</span><a id="83062">main</a></span>(<span class="typed"><span class="type">Array[String]</span><a id="83064">args</a></span>: <span class="typed"><span class="type">Array[String]</span><a href="../../../Array.scala.html#1070">Array</a></span>[String]) {
      <span class="keyword">var</span> <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a id="83065">parser</a></span>: <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a id="25943">XMLReader</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
      <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><a id="83066">err</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
      <span class="keyword">try</span> {
        <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#83065">parser</a></span> = <span class="typed"><span class="type">object org.xml.sax.helpers.XMLReaderFactory</span><a id="26085">XMLReaderFactory</a></span>.<span class="typed"><span class="type">()org.xml.sax.XMLReader</span><a id="78762">createXMLReader</a></span>()
      } 
      <span class="keyword">catch</span> { 
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="83073">e</a></span>:<span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span> =&gt;
          <span class="keyword">try</span> {
            <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#83065">parser</a></span> = <span class="typed"><span class="type">object org.xml.sax.helpers.XMLReaderFactory</span><a id="26085">XMLReaderFactory</a></span>.<span class="typed"><span class="type">(java.lang.String)org.xml.sax.XMLReader</span><a id="78763">createXMLReader</a></span>(
              <span class="typed"><span class="type">java.lang.String(&quot;org.apache.xerces.parsers.SAXParser&quot;)</span><span class="string">&quot;org.apache.xerces.parsers.SAXParser&quot;</span></span>)
          } <span class="keyword">catch</span> {
            <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="83075">e2</a></span>:<span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span> =&gt;
              <span class="typed"><span class="type">object java.lang.System</span><a id="1884">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="31500">err</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="31216">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Could not find an XML parser&quot;)</span><span class="string">&quot;Could not find an XML parser&quot;</span></span>)
              <span class="typed"><span class="type">Boolean</span><a href="#83066">err</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
          }
      }

      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">Boolean</span><a href="#83066">err</a></span>) <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span>;
      <span class="comment">// Need better namespace handling</span>
      <span class="keyword">try</span> {
        <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#83065">parser</a></span>.<span class="typed"><span class="type">(java.lang.String,Boolean)Unit</span><a id="78206">setFeature</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;http://xml.org/sax/features/namespace-prefixes&quot;)</span><span class="string">&quot;http://xml.org/sax/features/namespace-prefixes&quot;</span></span>, <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>);
      }
      <span class="keyword">catch</span> { 
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="83078">e</a></span>:<span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span> =&gt;
          <span class="typed"><span class="type">object java.lang.System</span><a id="1884">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="31500">err</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a id="31217">println</a></span>(<span class="typed"><span class="type">org.xml.sax.SAXException</span><a href="#83078">e</a></span>)
          <span class="typed"><span class="type">Boolean</span><a href="#83066">err</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
      }   
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Boolean</span><a href="#83066">err</a></span>) <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span>
      
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Array[String]</span><a href="#83064">args</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="../../../Array.scala.html#17252">length</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span>
      <span class="keyword">var</span> <span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a id="83067">resolver</a></span>: <span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a id="25913">EntityResolver</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
      <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="83068">arg</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">(Int)String</span><a href="../../../Array.scala.html#17253">args</a></span>(<span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>).<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;-r&quot;)</span><span class="string">&quot;-r&quot;</span></span>)) {
        <span class="keyword">try</span> {
          <span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a href="#83067">resolver</a></span> = <span class="typed"><span class="type">object java.lang.Class</span><a id="1671">Class</a></span>.<span class="typed"><span class="type">(java.lang.String)java.lang.Class[_]</span><a id="3931">forName</a></span>(<span class="typed"><span class="type">(Int)String</span><a href="../../../Array.scala.html#17253">args</a></span>(<span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>)).<span class="typed"><span class="type">()?0</span><a id="3936">newInstance</a></span>().<span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a id="3501">asInstanceOf</a></span>[<span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a id="25913">EntityResolver</a></span>];
          <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#83065">parser</a></span>.<span class="typed"><span class="type">(org.xml.sax.EntityResolver)Unit</span><a id="78209">setEntityResolver</a></span>(<span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a href="#83067">resolver</a></span>);
        }
        <span class="keyword">catch</span> { 
          <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Exception</span><a id="83092">ex</a></span>:<span class="typed"><span class="type">Exception</span><a id="2129">Exception</a></span> =&gt; 
            <span class="typed"><span class="type">object java.lang.System</span><a id="1884">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="31500">err</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="31216">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Could not load requested EntityResolver&quot;)</span><span class="string">&quot;Could not load requested EntityResolver&quot;</span></span>)
            <span class="typed"><span class="type">Boolean</span><a href="#83066">err</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
        }
        <span class="typed"><span class="type">Int</span><a href="#83068">arg</a></span> = <span class="typed"><span class="type">Int(2)</span><span class="int">2</span></span>
      }
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Boolean</span><a href="#83066">err</a></span>) <span class="typed"><span class="type">Nothing</span><span class="keyword">return</span></span>
      
      <span class="typed"><span class="type">Unit</span><a href="#83095" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#83068">arg</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">Array[String]</span><a href="#83064">args</a></span>.<span class="typed"><span class="type">=&gt; Int</span><a href="../../../Array.scala.html#17252">length</a></span>) {
        <span class="keyword">try</span> {
          <span class="keyword">val</span> <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a id="83097">includer</a></span> = <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="XIncludeFilter.scala.html#12298">XIncludeFilter</a></span>();
          <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="#83097">includer</a></span>.<span class="typed"><span class="type">(org.xml.sax.XMLReader)Unit</span><a id="78138">setParent</a></span>(<span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#83065">parser</a></span>)
          <span class="keyword">val</span> <span class="typed"><span class="type">scala.xml.include.sax.XIncluder</span><a id="83098">s</a></span> = <span class="typed"><span class="type">scala.xml.include.sax.XIncluder</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.xml.include.sax.XIncluder</span><a href="XIncluder.scala.html#12292">XIncluder</a></span>(<span class="typed"><span class="type">object java.lang.System</span><a id="1884">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="31499">out</a></span>, <span class="typed"><span class="type">java.lang.String(&quot;UTF-8&quot;)</span><span class="string">&quot;UTF-8&quot;</span></span>)
          <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="#83097">includer</a></span>.<span class="typed"><span class="type">(org.xml.sax.ContentHandler)Unit</span><a id="78148">setContentHandler</a></span>(<span class="typed"><span class="type">scala.xml.include.sax.XIncluder</span><a href="#83098">s</a></span>)
          <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a href="#83067">resolver</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="#83097">includer</a></span>.<span class="typed"><span class="type">(org.xml.sax.EntityResolver)Unit</span><a id="78144">setEntityResolver</a></span>(<span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a href="#83067">resolver</a></span>)
          <span class="keyword">try</span> {
            <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="#83097">includer</a></span>.<span class="typed"><span class="type">(java.lang.String,Any)Unit</span><a id="78142">setProperty</a></span>(
              <span class="typed"><span class="type">java.lang.String(&quot;http://xml.org/sax/properties/lexical-handler&quot;)</span><span class="string">&quot;http://xml.org/sax/properties/lexical-handler&quot;</span></span>,
              <span class="typed"><span class="type">scala.xml.include.sax.XIncluder</span><a href="#83098">s</a></span>)
            <span class="typed"><span class="type">scala.xml.include.sax.XIncluder</span><a href="#83098">s</a></span>.<span class="typed"><span class="type">(scala.xml.include.sax.XIncludeFilter)Unit</span><a href="XIncluder.scala.html#83163">setFilter</a></span>(<span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="#83097">includer</a></span>)
          }
          <span class="keyword">catch</span> { 
            <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="83170">e</a></span>:<span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span> =&gt; <span class="comment">// Will not support comments</span>
          }
          <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="#83097">includer</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="78153">parse</a></span>(<span class="typed"><span class="type">(Int)String</span><a href="../../../Array.scala.html#17253">args</a></span>(<span class="typed"><span class="type">Int</span><a href="#83068">arg</a></span>))
        }
        <span class="keyword">catch</span> { 
          <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">org.xml.sax.SAXParseException</span><a id="83175">e</a></span>:<span class="typed"><span class="type">org.xml.sax.SAXParseException</span><a id="25910">SAXParseException</a></span> =&gt;
            <span class="typed"><span class="type">object java.lang.System</span><a id="1884">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="31500">err</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a id="31217">println</a></span>(<span class="typed"><span class="type">org.xml.sax.SAXParseException</span><a href="#83175">e</a></span>)
            <span class="typed"><span class="type">object java.lang.System</span><a id="1884">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="31500">err</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="31216">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Problem in &quot;)</span><span class="string">&quot;Problem in &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">org.xml.sax.SAXParseException</span><a href="#83175">e</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="67275">getSystemId</a></span>() 
                               <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; at line &quot;)</span><span class="string">&quot; at line &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">org.xml.sax.SAXParseException</span><a href="#83175">e</a></span>.<span class="typed"><span class="type">()Int</span><a id="67276">getLineNumber</a></span>())
          <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">Exception</span><a id="83180">e</a></span>: <span class="typed"><span class="type">Exception</span><a id="2129">Exception</a></span> =&gt; <span class="comment">// be specific about exceptions????</span>
            <span class="typed"><span class="type">object java.lang.System</span><a id="1884">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="31500">err</a></span>.<span class="typed"><span class="type">(Any)Unit</span><a id="31217">println</a></span>(<span class="typed"><span class="type">Exception</span><a href="#83180">e</a></span>)
            <span class="typed"><span class="type">Exception</span><a href="#83180">e</a></span>.<span class="typed"><span class="type">()Unit</span><a id="19187">printStackTrace</a></span>()
        }
        <span class="typed"><span class="type">Int</span><a href="#83068">arg</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
      }
    }
}

        </pre>
    </body>
</html>