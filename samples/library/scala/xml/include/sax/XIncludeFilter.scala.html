<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/xml/include/sax/XIncludeFilter.scala</title>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2002-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: XIncludeFilter.scala 16893 2009-01-13 13:09:22Z cunei $</span>

<span class="keyword">package</span> scala.xml.include.sax

<span class="keyword">import</span> org.xml.sax.Attributes
<span class="keyword">import</span> org.xml.sax.SAXException
<span class="keyword">import</span> org.xml.sax.XMLReader
<span class="keyword">import</span> org.xml.sax.EntityResolver
<span class="keyword">import</span> org.xml.sax.Locator
<span class="keyword">import</span> org.xml.sax.helpers.XMLReaderFactory
<span class="keyword">import</span> org.xml.sax.helpers.XMLFilterImpl
<span class="keyword">import</span> org.xml.sax.helpers.NamespaceSupport
<span class="keyword">import</span> org.xml.sax.helpers.AttributesImpl

<span class="keyword">import</span> java.net.URL
<span class="keyword">import</span> java.net.URLConnection
<span class="keyword">import</span> java.net.MalformedURLException
<span class="keyword">import</span> java.io.UnsupportedEncodingException
<span class="keyword">import</span> java.io.IOException
<span class="keyword">import</span> java.io.InputStream
<span class="keyword">import</span> java.io.BufferedInputStream
<span class="keyword">import</span> java.io.InputStreamReader
<span class="keyword">import</span> java.util.Stack

<span class="comment">/**
 * &lt;p&gt;
 *  This is a SAX filter which resolves all XInclude include elements
 *  before passing them on to the client application. Currently this
 *  class has the following known deviation from the XInclude specification:
 * &lt;/p&gt;
 *  &lt;ol&gt;
 *   &lt;li&gt;XPointer is not supported.&lt;/li&gt;
 *  &lt;/ol&gt;
 *
 *  &lt;p&gt;
 *    Furthermore, I would definitely use a new instance of this class
 *    for each document you want to process. I doubt it can be used
 *    successfully on multiple documents. Furthermore, I can virtually
 *    guarantee that this class is not thread safe. You have been
 *    warned.
 *  &lt;/p&gt;
 *
 *  &lt;p&gt;
 *    Since this class is not designed to be subclassed, and since
 *    I have not yet considered how that might affect the methods 
 *    herein or what other protected methods might be needed to support 
 *    subclasses, I have declared this class final. I may remove this 
 *    restriction later, though the use-case for subclassing is weak.
 *    This class is designed to have its functionality extended via a
 *    a horizontal chain of filters, not a 
 *    vertical hierarchy of sub and superclasses.
 *  &lt;/p&gt;
 *
 *  &lt;p&gt;
 *    To use this class: 
 *  &lt;/p&gt;
 *  &lt;ol&gt;
 *   &lt;li&gt;Construct an &lt;code&gt;XIncludeFilter&lt;/code&gt; object with a known base URL&lt;/li&gt;
 *   &lt;li&gt;Pass the &lt;code&gt;XMLReader&lt;/code&gt; object from which the raw document will 
 *       be read to the &lt;code&gt;setParent()&lt;/code&gt; method of this object. &lt;/li&gt;
 *   &lt;li&gt;Pass your own &lt;code&gt;ContentHandler&lt;/code&gt; object to the 
 *       &lt;code&gt;setContentHandler()&lt;/code&gt; method of this object. This is the 
 *       object which will receive events from the parsed and included
 *       document.
 *   &lt;/li&gt;
 *   &lt;li&gt;Optional: if you wish to receive comments, set your own 
 *       &lt;code&gt;LexicalHandler&lt;/code&gt; object as the value of this object's
 *       http://xml.org/sax/properties/lexical-handler property.
 *       Also make sure your &lt;code&gt;LexicalHandler&lt;/code&gt; asks this object 
 *       for the status of each comment using &lt;code&gt;insideIncludeElement&lt;/code&gt;
 *       before doing anything with the comment. 
 *   &lt;/li&gt;
 *   &lt;li&gt;Pass the URL of the document to read to this object's 
 *       &lt;code&gt;parse()&lt;/code&gt; method&lt;/li&gt;
 *  &lt;/ol&gt;
 * 
 *  &lt;p&gt; e.g.&lt;/p&gt;
 *  &lt;pre&gt;&lt;code&gt;XIncludeFilter includer = new XIncludeFilter(base); 
 *  includer.setParent(parser);
 *  includer.setContentHandler(new SAXXIncluder(System.out));
 *  includer.parse(args[i]);&lt;/code&gt;
 *  &lt;/pre&gt;
 * &lt;/p&gt;               
 * translated from Elliotte Rusty Harold's Java source
 * @author Burak Emir
 */</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class XIncludeFilter extends org.xml.sax.helpers.XMLFilterImpl with ScalaObject</span><a id="12298">XIncludeFilter</a></span> <span class="keyword">extends</span> <span class="typed"><span class="type">org.xml.sax.helpers.XMLFilterImpl</span><a id="26051">XMLFilterImpl</a></span> {

  <span class="keyword">final</span> <span class="keyword">val</span>  <span class="typed"><span class="type">java.lang.String(&quot;http://www.w3.org/2001/XInclude&quot;)</span><span id="78173"><a id="78172">XINCLUDE_NAMESPACE</a></span></span> = <span class="typed"><span class="type">java.lang.String(&quot;http://www.w3.org/2001/XInclude&quot;)</span><span class="string">&quot;http://www.w3.org/2001/XInclude&quot;</span></span>;
  
  <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">java.util.Stack[java.net.URL]</span><span id="78175"><a id="78174">bases</a></span></span> = <span class="typed"><span class="type">java.util.Stack[java.net.URL]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.Stack[java.net.URL]</span><a id="5141">Stack</a></span>[URL]();
  <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">java.util.Stack[org.xml.sax.Locator]</span><span id="78177"><a id="78176">locators</a></span></span> = <span class="typed"><span class="type">java.util.Stack[org.xml.sax.Locator]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.Stack[org.xml.sax.Locator]</span><a id="5141">Stack</a></span>[Locator]();

<span class="comment">/*    private EntityResolver resolver;
    
    public XIncludeFilter() {
        this(null);   
    }    
    
    public XIncludeFilter(EntityResolver resolver) {
        this.resolver = resolver;   
    }   */</span> 
    
    
    <span class="comment">// what if this isn't called????</span>
    <span class="comment">// do I need to check this in startDocument() and push something</span>
    <span class="comment">// there????</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(org.xml.sax.Locator)Unit</span><a id="78178">setDocumentLocator</a></span>(<span class="typed"><span class="type">org.xml.sax.Locator</span><a id="78300">locator</a></span>: <span class="typed"><span class="type">org.xml.sax.Locator</span><a id="25904">Locator</a></span>) {
    <span class="typed"><span class="type">=&gt; java.util.Stack[org.xml.sax.Locator]</span><a href="#78176">locators</a></span>.<span class="typed"><span class="type">(org.xml.sax.Locator)org.xml.sax.Locator</span><a id="78221">push</a></span>(<span class="typed"><span class="type">org.xml.sax.Locator</span><a href="#78300">locator</a></span>)
    <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="78301">base</a></span> = <span class="typed"><span class="type">org.xml.sax.Locator</span><a href="#78300">locator</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="78291">getSystemId</a></span>()
    <span class="keyword">try</span> {
      <span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">(java.net.URL)java.net.URL</span><a id="78221">push</a></span>(<span class="typed"><span class="type">(java.lang.String)java.net.URL</span><a id="30768" class="keyword">new</a></span> <span class="typed"><span class="type">java.net.URL</span><a id="4389">URL</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#78301">base</a></span>))
    }
    <span class="keyword">catch</span> { 
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.net.MalformedURLException</span><a id="78303">e</a></span>:<span class="typed"><span class="type">java.net.MalformedURLException</span><a id="4428">MalformedURLException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)java.lang.UnsupportedOperationException</span><a id="30111" class="keyword">new</a></span> <span class="typed"><span class="type">java.lang.UnsupportedOperationException</span><a href="../../../Predef.scala.html#13340">UnsupportedOperationException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Unrecognized SYSTEM ID: &quot;)</span><span class="string">&quot;Unrecognized SYSTEM ID: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#78301">base</a></span>)
    }
    <span class="keyword">super</span>.<span class="typed"><span class="type">(org.xml.sax.Locator)Unit</span><a id="78157">setDocumentLocator</a></span>(<span class="typed"><span class="type">org.xml.sax.Locator</span><a href="#78300">locator</a></span>)
  }
  
  
  <span class="comment">// necessary to throw away contents of non-empty XInclude elements</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><span id="78181"><span id="78179"><span id="78180"><a id="78294">level</a></span></span></span></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>

  <span class="comment">/**
    * &lt;p&gt;
    * This utility method returns true if and only if this reader is 
    * currently inside a non-empty include element. (This is &lt;strong&gt;
    * not&lt;/strong&gt; the same as being inside the node set which replaces
    * the include element.) This is primarily needed for comments
    * inside include elements. It must be checked by the actual
    * LexicalHandler to see whether a comment is passed or not.
    * &lt;/p&gt;
    *
    * @return boolean  
    */</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">()Boolean</span><a id="78182">insideIncludeElement</a></span>(): <span class="typed"><span class="type">Boolean</span><a id="2168">Boolean</a></span> = <span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3140">!=</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String,String,String,org.xml.sax.Attributes)Unit</span><a id="78183">startElement</a></span>(<span class="typed"><span class="type">String</span><a id="78311">uri</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="78312">localName</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="78313">qName</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">org.xml.sax.Attributes</span><a id="78314">atts1</a></span>: <span class="typed"><span class="type">org.xml.sax.Attributes</span><a id="25922">Attributes</a></span>) {
    <span class="keyword">var</span> <span class="typed"><span class="type">org.xml.sax.Attributes</span><a id="78315">atts</a></span> = <span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#78314">atts1</a></span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) { <span class="comment">// We're not inside an xi:include element</span>

      <span class="comment">// Adjust bases stack by pushing either the new</span>
      <span class="comment">// value of xml:base or the base of the parent</span>
      <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="78318">base</a></span> = <span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#78315">atts</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)java.lang.String</span><a id="67078">getValue</a></span>(NamespaceSupport.<span class="typed"><span class="type">java.lang.String(&quot;http://www.w3.org/XML/1998/namespace&quot;)</span><span >XMLNS</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;base&quot;)</span><span class="string">&quot;base&quot;</span></span>)
      <span class="keyword">val</span> <span class="typed"><span class="type">java.net.URL</span><a id="78319">parentBase</a></span> = <span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">()java.net.URL</span><a id="78223">peek</a></span>().<span class="typed"><span class="type">java.net.URL</span><a id="3501">asInstanceOf</a></span>[<span class="typed"><span class="type">java.net.URL</span><a id="4389">URL</a></span>]
      <span class="keyword">var</span> <span class="typed"><span class="type">java.net.URL</span><a id="78320">currentBase</a></span> = <span class="typed"><span class="type">java.net.URL</span><a href="#78319">parentBase</a></span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78318">base</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
        <span class="keyword">try</span> {
          <span class="typed"><span class="type">java.net.URL</span><a href="#78320">currentBase</a></span> = <span class="typed"><span class="type">(java.net.URL,java.lang.String)java.net.URL</span><a id="30769" class="keyword">new</a></span> <span class="typed"><span class="type">java.net.URL</span><a id="4389">URL</a></span>(<span class="typed"><span class="type">java.net.URL</span><a href="#78319">parentBase</a></span>, <span class="typed"><span class="type">java.lang.String</span><a href="#78318">base</a></span>)
        }
        <span class="keyword">catch</span> { 
          <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.net.MalformedURLException</span><a id="78363">e</a></span>: <span class="typed"><span class="type">java.net.MalformedURLException</span><a id="4428">MalformedURLException</a></span> =&gt;
            <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Malformed base URL: &quot;)</span><span class="string">&quot;Malformed base URL: &quot;</span></span> 
                                   <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.net.URL</span><a href="#78320">currentBase</a></span>, <span class="typed"><span class="type">java.net.MalformedURLException</span><a href="#78363">e</a></span>)
        }
      }
      <span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">(java.net.URL)java.net.URL</span><a id="78221">push</a></span>(<span class="typed"><span class="type">java.net.URL</span><a href="#78320">currentBase</a></span>);
      
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#78311">uri</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;http://www.w3.org/2001/XInclude&quot;)</span><span >XINCLUDE_NAMESPACE</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2749">&amp;&amp;</a></span> <span class="typed"><span class="type">String</span><a href="#78312">localName</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;include&quot;)</span><span class="string">&quot;include&quot;</span></span>)) {
        <span class="comment">// include external document</span>
        <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="78375">href</a></span> = <span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#78315">atts</a></span>.<span class="typed"><span class="type">(java.lang.String)java.lang.String</span><a id="67079">getValue</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;href&quot;)</span><span class="string">&quot;href&quot;</span></span>)
        <span class="comment">// Verify that there is an href attribute</span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78375">href</a></span><span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3507">==</a></span><span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) { 
          <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)org.xml.sax.SAXException</span><a id="67299" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Missing href attribute&quot;)</span><span class="string">&quot;Missing href attribute&quot;</span></span>)
        }
        
        <span class="keyword">var</span> <span class="typed"><span class="type">java.lang.String</span><a id="78376">parse</a></span> = <span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#78315">atts</a></span>.<span class="typed"><span class="type">(java.lang.String)java.lang.String</span><a id="67079">getValue</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;parse&quot;)</span><span class="string">&quot;parse&quot;</span></span>)
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78376">parse</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3507">==</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">java.lang.String</span><a href="#78376">parse</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;xml&quot;)</span><span class="string">&quot;xml&quot;</span></span>
        
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78376">parse</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;text&quot;)</span><span class="string">&quot;text&quot;</span></span>)) {
          <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="78387">encoding</a></span> = <span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#78315">atts</a></span>.<span class="typed"><span class="type">(java.lang.String)java.lang.String</span><a id="67079">getValue</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;encoding&quot;)</span><span class="string">&quot;encoding&quot;</span></span>);
          <span class="typed"><span class="type">(String,String)Unit</span><a href="#78197">includeTextDocument</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#78375">href</a></span>, <span class="typed"><span class="type">java.lang.String</span><a href="#78387">encoding</a></span>); 
        }
        <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78376">parse</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;xml&quot;)</span><span class="string">&quot;xml&quot;</span></span>)) {
          <span class="typed"><span class="type">(String)Unit</span><a href="#78201">includeXMLDocument</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#78375">href</a></span>); 
        }
        <span class="comment">// Need to check this also in DOM and JDOM????</span>
        <span class="keyword">else</span> {
          <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String)org.xml.sax.SAXException</span><a id="67299" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(
            <span class="typed"><span class="type">java.lang.String(&quot;Illegal value for parse attribute: &quot;)</span><span class="string">&quot;Illegal value for parse attribute: &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#78376">parse</a></span>);
        }
        <span class="typed"><span class="type">(Int)Unit</span><a href="#78180">level</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
      }
      <span class="keyword">else</span> {
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a href="#78198">atRoot</a></span>) {
          <span class="comment">// add xml:base attribute if necessary</span>
          <span class="keyword">val</span> <span class="typed"><span class="type">org.xml.sax.helpers.AttributesImpl</span><a id="78418">attsImpl</a></span> = <span class="typed"><span class="type">(org.xml.sax.Attributes)org.xml.sax.helpers.AttributesImpl</span><a id="78422" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.helpers.AttributesImpl</span><a id="26090">AttributesImpl</a></span>(<span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#78315">atts</a></span>)
          <span class="typed"><span class="type">org.xml.sax.helpers.AttributesImpl</span><a href="#78418">attsImpl</a></span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String)Unit</span><a id="78437">addAttribute</a></span>(NamespaceSupport.<span class="typed"><span class="type">java.lang.String(&quot;http://www.w3.org/XML/1998/namespace&quot;)</span><span >XMLNS</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;base&quot;)</span><span class="string">&quot;base&quot;</span></span>,
                                <span class="typed"><span class="type">java.lang.String(&quot;xml:base&quot;)</span><span class="string">&quot;xml:base&quot;</span></span>, <span class="typed"><span class="type">java.lang.String(&quot;CDATA&quot;)</span><span class="string">&quot;CDATA&quot;</span></span>, <span class="typed"><span class="type">java.net.URL</span><a href="#78320">currentBase</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="30787">toExternalForm</a></span>())
          <span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#78315">atts</a></span> = <span class="typed"><span class="type">org.xml.sax.helpers.AttributesImpl</span><a href="#78418">attsImpl</a></span>
          <span class="typed"><span class="type">(Boolean)Unit</span><a href="#78199">atRoot</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
        }
        <span class="keyword">super</span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String,java.lang.String,org.xml.sax.Attributes)Unit</span><a id="78162">startElement</a></span>(<span class="typed"><span class="type">String</span><a href="#78311">uri</a></span>, <span class="typed"><span class="type">String</span><a href="#78312">localName</a></span>, <span class="typed"><span class="type">String</span><a href="#78313">qName</a></span>, <span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#78315">atts</a></span>)
      }
    }
  }

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String,String,String)Unit</span><a id="78184">endElement</a></span>(<span class="typed"><span class="type">String</span><a id="78447">uri</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="78448">localName</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="78449">qName</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#78447">uri</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;http://www.w3.org/2001/XInclude&quot;)</span><span >XINCLUDE_NAMESPACE</span></span>) 
        <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2749">&amp;&amp;</a></span> <span class="typed"><span class="type">String</span><a href="#78448">localName</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;include&quot;)</span><span class="string">&quot;include&quot;</span></span>)) {
          <span class="typed"><span class="type">(Int)Unit</span><a href="#78180">level</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3146">-=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>;
    }
    <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) {
      <span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">()java.net.URL</span><a id="78222">pop</a></span>()
      <span class="keyword">super</span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String,java.lang.String)Unit</span><a id="78163">endElement</a></span>(<span class="typed"><span class="type">String</span><a href="#78447">uri</a></span>, <span class="typed"><span class="type">String</span><a href="#78448">localName</a></span>, <span class="typed"><span class="type">String</span><a href="#78449">qName</a></span>)
    }
  }

  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><span id="78187"><span id="78185"><span id="78186"><a id="78295">depth</a></span></span></span></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>;
  
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="78188">startDocument</a></span>() {
    <span class="typed"><span class="type">(Int)Unit</span><a href="#78180">level</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78185">depth</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="keyword">super</span>.<span class="typed"><span class="type">()Unit</span><a id="78158">startDocument</a></span>()
    <span class="typed"><span class="type">(Int)Unit</span><a href="#78186">depth</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>        
  }

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="78189">endDocument</a></span>() {
    <span class="typed"><span class="type">=&gt; java.util.Stack[org.xml.sax.Locator]</span><a href="#78176">locators</a></span>.<span class="typed"><span class="type">()org.xml.sax.Locator</span><a id="78222">pop</a></span>()
    <span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">()java.net.URL</span><a id="78222">pop</a></span>(); <span class="comment">// pop the URL for the document itself</span>
    <span class="typed"><span class="type">(Int)Unit</span><a href="#78186">depth</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3146">-=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78185">depth</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="keyword">super</span>.<span class="typed"><span class="type">()Unit</span><a id="78159">endDocument</a></span>()
  }

  <span class="comment">// how do prefix mappings move across documents????</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String,String)Unit</span><a id="78190">startPrefixMapping</a></span>(<span class="typed"><span class="type">String</span><a id="78517">prefix</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span> , <span class="typed"><span class="type">String</span><a id="78518">uri</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="keyword">super</span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)Unit</span><a id="78160">startPrefixMapping</a></span>(<span class="typed"><span class="type">String</span><a href="#78517">prefix</a></span>, <span class="typed"><span class="type">String</span><a href="#78518">uri</a></span>)
  }

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="78191">endPrefixMapping</a></span>(<span class="typed"><span class="type">String</span><a id="78522">prefix</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="keyword">super</span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="78161">endPrefixMapping</a></span>(<span class="typed"><span class="type">String</span><a href="#78522">prefix</a></span>)       
  }

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a id="78192">characters</a></span>(<span class="typed"><span class="type">Array[Char]</span><a id="78526">ch</a></span>: <span class="typed"><span class="type">Array[Char]</span><a href="../../../Array.scala.html#1070">Array</a></span>[Char], <span class="typed"><span class="type">Int</span><a id="78527">start</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">Int</span><a id="78528">length</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="keyword">super</span>.<span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a id="78164">characters</a></span>(<span class="typed"><span class="type">Array[Char]</span><a href="#78526">ch</a></span>, <span class="typed"><span class="type">Int</span><a href="#78527">start</a></span>, <span class="typed"><span class="type">Int</span><a href="#78528">length</a></span>)
  }

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a id="78193">ignorableWhitespace</a></span>(<span class="typed"><span class="type">Array[Char]</span><a id="78532">ch</a></span>: <span class="typed"><span class="type">Array[Char]</span><a href="../../../Array.scala.html#1070">Array</a></span>[Char], <span class="typed"><span class="type">Int</span><a id="78533">start</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">Int</span><a id="78534">length</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="keyword">super</span>.<span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a id="78165">ignorableWhitespace</a></span>(<span class="typed"><span class="type">Array[Char]</span><a href="#78532">ch</a></span>, <span class="typed"><span class="type">Int</span><a href="#78533">start</a></span>, <span class="typed"><span class="type">Int</span><a href="#78534">length</a></span>)
  }

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String,String)Unit</span><a id="78194">processingInstruction</a></span>(<span class="typed"><span class="type">String</span><a id="78538">target</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="78539">data</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="keyword">super</span>.<span class="typed"><span class="type">(java.lang.String,java.lang.String)Unit</span><a id="78166">processingInstruction</a></span>(<span class="typed"><span class="type">String</span><a href="#78538">target</a></span>, <span class="typed"><span class="type">String</span><a href="#78539">data</a></span>)
  }

  <span class="keyword">override</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="78195">skippedEntity</a></span>(<span class="typed"><span class="type">String</span><a id="78543">name</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="keyword">super</span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="78167">skippedEntity</a></span>(<span class="typed"><span class="type">String</span><a href="#78543">name</a></span>)
  }

  <span class="comment">// convenience method for error messages</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">()String</span><a id="78196">getLocation</a></span>(): <span class="typed"><span class="type">String</span><a id="1859">String</a></span> = {
    <span class="keyword">var</span> <span class="typed"><span class="type">java.lang.String</span><a id="78547">locationString</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>
    <span class="keyword">val</span> <span class="typed"><span class="type">org.xml.sax.Locator</span><a id="78548">locator</a></span> = <span class="typed"><span class="type">=&gt; java.util.Stack[org.xml.sax.Locator]</span><a href="#78176">locators</a></span>.<span class="typed"><span class="type">()org.xml.sax.Locator</span><a id="78223">peek</a></span>().<span class="typed"><span class="type">org.xml.sax.Locator</span><a id="3501">asInstanceOf</a></span>[<span class="typed"><span class="type">org.xml.sax.Locator</span><a id="25904">Locator</a></span>]
    <span class="keyword">var</span> <span class="typed"><span class="type">java.lang.String</span><a id="78549">publicID</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">java.lang.String</span><a id="78550">systemID</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="78551">column</a></span> = -<span class="typed"><span class="type">Int(-1)</span><span class="int">1</span></span>
    <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="78552">line</a></span> = -<span class="typed"><span class="type">Int(-1)</span><span class="int">1</span></span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">org.xml.sax.Locator</span><a href="#78548">locator</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
      <span class="typed"><span class="type">java.lang.String</span><a href="#78549">publicID</a></span> = <span class="typed"><span class="type">org.xml.sax.Locator</span><a href="#78548">locator</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="78290">getPublicId</a></span>()
      <span class="typed"><span class="type">java.lang.String</span><a href="#78550">systemID</a></span> = <span class="typed"><span class="type">org.xml.sax.Locator</span><a href="#78548">locator</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="78291">getSystemId</a></span>()
      <span class="typed"><span class="type">Int</span><a href="#78552">line</a></span> = <span class="typed"><span class="type">org.xml.sax.Locator</span><a href="#78548">locator</a></span>.<span class="typed"><span class="type">()Int</span><a id="78292">getLineNumber</a></span>()
      <span class="typed"><span class="type">Int</span><a href="#78551">column</a></span> = <span class="typed"><span class="type">org.xml.sax.Locator</span><a href="#78548">locator</a></span>.<span class="typed"><span class="type">()Int</span><a id="78293">getColumnNumber</a></span>()
    }
    <span class="typed"><span class="type">java.lang.String</span><a href="#78547">locationString</a></span> = (<span class="typed"><span class="type">java.lang.String(&quot; in document included from &quot;)</span><span class="string">&quot; in document included from &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#78549">publicID</a></span>
    <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; at &quot;)</span><span class="string">&quot; at &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#78550">systemID</a></span> 
    <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; at line &quot;)</span><span class="string">&quot; at line &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">Int</span><a href="#78552">line</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;, column &quot;)</span><span class="string">&quot;, column &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">Int</span><a href="#78551">column</a></span>);
    
    <span class="typed"><span class="type">java.lang.String</span><a href="#78547">locationString</a></span>
  }

  <span class="comment">/**
    * &lt;p&gt;
    * This utility method reads a document at a specified URL
    * and fires off calls to &lt;code&gt;characters()&lt;/code&gt;.
    * It's used to include files with &lt;code&gt;parse=&quot;text&quot;&lt;/code&gt;
    * &lt;/p&gt;
    *
    * @param  url          URL of the document that will be read
    * @param  encoding     Encoding of the document; e.g. UTF-8, 
    *                      ISO-8859-1, etc.
    * @return void  
    * @throws SAXException if the requested document cannot
                           be downloaded from the specified URL
                           or if the encoding is not recognized
    */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String,String)Unit</span><a id="78197">includeTextDocument</a></span>(<span class="typed"><span class="type">String</span><a id="78390">url</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="78391">encoding1</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="keyword">var</span> <span class="typed"><span class="type">String</span><a id="78554">encoding</a></span> = <span class="typed"><span class="type">String</span><a href="#78391">encoding1</a></span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#78554">encoding</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="3507">==</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2748">||</a></span> <span class="typed"><span class="type">String</span><a href="#78554">encoding</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="5868">trim</a></span>().<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>)) <span class="typed"><span class="type">String</span><a href="#78554">encoding</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;UTF-8&quot;)</span><span class="string">&quot;UTF-8&quot;</span></span>; 
    <span class="keyword">var</span> <span class="typed"><span class="type">java.net.URL</span><a id="78555">source</a></span>: <span class="typed"><span class="type">java.net.URL</span><a id="4389">URL</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
    <span class="keyword">try</span> {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.net.URL</span><a id="78559">base</a></span> = <span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">()java.net.URL</span><a id="78223">peek</a></span>().<span class="typed"><span class="type">java.net.URL</span><a id="3501">asInstanceOf</a></span>[<span class="typed"><span class="type">java.net.URL</span><a id="4389">URL</a></span>]
      <span class="typed"><span class="type">java.net.URL</span><a href="#78555">source</a></span> = <span class="typed"><span class="type">(java.net.URL,java.lang.String)java.net.URL</span><a id="30769" class="keyword">new</a></span> <span class="typed"><span class="type">java.net.URL</span><a id="4389">URL</a></span>(<span class="typed"><span class="type">java.net.URL</span><a href="#78559">base</a></span>, <span class="typed"><span class="type">String</span><a href="#78390">url</a></span>)
    }
    <span class="keyword">catch</span> { 
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.net.MalformedURLException</span><a id="78567">e</a></span>: <span class="typed"><span class="type">java.net.MalformedURLException</span><a id="4428">MalformedURLException</a></span> =&gt;
        <span class="keyword">val</span> <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><a id="78568">ex</a></span> = <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><a href="../UnavailableResourceException.scala.html#12275">UnavailableResourceException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Unresolvable URL &quot;)</span><span class="string">&quot;Unresolvable URL &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#78390">url</a></span>
                                                  <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">()String</span><a href="#78196">getLocation</a></span>());
      <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><a href="#78568">ex</a></span>.<span class="typed"><span class="type">(Throwable)Unit</span><a href="../XIncludeException.scala.html#67748">setRootCause</a></span>(<span class="typed"><span class="type">java.net.MalformedURLException</span><a href="#78567">e</a></span>);
      <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Unresolvable URL &quot;)</span><span class="string">&quot;Unresolvable URL &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#78390">url</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">()String</span><a href="#78196">getLocation</a></span>(), <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><a href="#78568">ex</a></span>);
    }
    
    <span class="keyword">try</span> {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.net.URLConnection</span><a id="78581">uc</a></span> = <span class="typed"><span class="type">java.net.URL</span><a href="#78555">source</a></span>.<span class="typed"><span class="type">()java.net.URLConnection</span><a id="30789">openConnection</a></span>()
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.BufferedInputStream</span><a id="78582">in</a></span> = <span class="typed"><span class="type">java.io.BufferedInputStream</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.BufferedInputStream</span><a id="3733">BufferedInputStream</a></span>(<span class="typed"><span class="type">java.net.URLConnection</span><a href="#78581">uc</a></span>.<span class="typed"><span class="type">()java.io.InputStream</span><a id="78635">getInputStream</a></span>())
      <span class="keyword">var</span> <span class="typed"><span class="type">java.lang.String</span><a id="78583">encodingFromHeader</a></span> = <span class="typed"><span class="type">java.net.URLConnection</span><a href="#78581">uc</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="78619">getContentEncoding</a></span>()
      <span class="keyword">var</span> <span class="typed"><span class="type">java.lang.String</span><a id="78584">contentType</a></span> = <span class="typed"><span class="type">java.net.URLConnection</span><a href="#78581">uc</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="78618">getContentType</a></span>()
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78583">encodingFromHeader</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>)
        <span class="typed"><span class="type">String</span><a href="#78554">encoding</a></span> = <span class="typed"><span class="type">java.lang.String</span><a href="#78583">encodingFromHeader</a></span>
      <span class="keyword">else</span> {
        <span class="comment">// What if file does not have a MIME type but name ends in .xml????</span>
        <span class="comment">// MIME types are case-insensitive</span>
        <span class="comment">// Java may be picking this up from file URL</span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78584">contentType</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
          <span class="typed"><span class="type">java.lang.String</span><a href="#78584">contentType</a></span> = <span class="typed"><span class="type">java.lang.String</span><a href="#78584">contentType</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="5865">toLowerCase</a></span>();
          <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78584">contentType</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;text/xml&quot;)</span><span class="string">&quot;text/xml&quot;</span></span>) 
              <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2748">||</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#78584">contentType</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="5830">equals</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;application/xml&quot;)</span><span class="string">&quot;application/xml&quot;</span></span>)   
              <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2748">||</a></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78584">contentType</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5839">startsWith</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;text/&quot;)</span><span class="string">&quot;text/&quot;</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2749">&amp;&amp;</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#78584">contentType</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5840">endsWith</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;+xml&quot;)</span><span class="string">&quot;+xml&quot;</span></span>) ) 
              <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2748">||</a></span> (<span class="typed"><span class="type">java.lang.String</span><a href="#78584">contentType</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5839">startsWith</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;application/&quot;)</span><span class="string">&quot;application/&quot;</span></span>) <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2749">&amp;&amp;</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#78584">contentType</a></span>.<span class="typed"><span class="type">(java.lang.String)Boolean</span><a id="5840">endsWith</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;+xml&quot;)</span><span class="string">&quot;+xml&quot;</span></span>))) {
                <span class="typed"><span class="type">String</span><a href="#78554">encoding</a></span> = <span class="typed"><span class="type">object scala.xml.include.sax.EncodingHeuristics</span><a href="EncodingHeuristics.scala.html#12290">EncodingHeuristics</a></span>.<span class="typed"><span class="type">(java.io.InputStream)String</span><a href="EncodingHeuristics.scala.html#35639">readEncodingFromStream</a></span>(<span class="typed"><span class="type">java.io.BufferedInputStream</span><a href="#78582">in</a></span>);
              }
        }
      }
      <span class="keyword">val</span> <span class="typed"><span class="type">java.io.InputStreamReader</span><a id="78585">reader</a></span> = <span class="typed"><span class="type">(java.io.InputStream,java.lang.String)java.io.InputStreamReader</span><a id="47496" class="keyword">new</a></span> <span class="typed"><span class="type">java.io.InputStreamReader</span><a id="3739">InputStreamReader</a></span>(<span class="typed"><span class="type">java.io.BufferedInputStream</span><a href="#78582">in</a></span>, <span class="typed"><span class="type">String</span><a href="#78554">encoding</a></span>)
      <span class="keyword">val</span> <span class="typed"><span class="type">Array[Char]</span><a id="78586">c</a></span> = <span class="typed"><span class="type">Array[Char]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">Array[Char]</span><a href="../../../Array.scala.html#1070">Array</a></span>[Char](<span class="typed"><span class="type">Int(1024)</span><span class="int">1024</span></span>)
      <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="78587">charsRead</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>  <span class="comment">// bogus init value</span>
      <span class="typed"><span class="type">Unit</span><a href="#78687" class="keyword">do</a></span> {
        <span class="typed"><span class="type">Int</span><a href="#78587">charsRead</a></span> = <span class="typed"><span class="type">java.io.InputStreamReader</span><a href="#78585">reader</a></span>.<span class="typed"><span class="type">(Array[Char],Int,Int)Int</span><a id="47501">read</a></span>(<span class="typed"><span class="type">Array[Char]</span><a href="#78586">c</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Int(1024)</span><span class="int">1024</span></span>);
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Int</span><a href="#78587">charsRead</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3143">&gt;</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) <span class="typed"><span class="type">XIncludeFilter.this.type</span><a href="#12298" class="keyword">this</a></span>.<span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a href="#78192">characters</a></span>(<span class="typed"><span class="type">Array[Char]</span><a href="#78586">c</a></span>, <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>, <span class="typed"><span class="type">Int</span><a href="#78587">charsRead</a></span>);
      } <span class="keyword">while</span> (<span class="typed"><span class="type">Int</span><a href="#78587">charsRead</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3140">!=</a></span> -<span class="typed"><span class="type">Int(-1)</span><span class="int">1</span></span>) ;
    }
    <span class="keyword">catch</span> {
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.UnsupportedEncodingException</span><a id="78712">e</a></span>: <span class="typed"><span class="type">java.io.UnsupportedEncodingException</span><a id="3709">UnsupportedEncodingException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Unsupported encoding: &quot;)</span><span class="string">&quot;Unsupported encoding: &quot;</span></span> 
                               <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#78554">encoding</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">()String</span><a href="#78196">getLocation</a></span>(), <span class="typed"><span class="type">java.io.UnsupportedEncodingException</span><a href="#78712">e</a></span>);
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="78726">e</a></span>: <span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Document not found: &quot;)</span><span class="string">&quot;Document not found: &quot;</span></span> 
                               <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.net.URL</span><a href="#78555">source</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="30787">toExternalForm</a></span>() <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">()String</span><a href="#78196">getLocation</a></span>(), <span class="typed"><span class="type">java.io.IOException</span><a href="#78726">e</a></span>);
    }
    
  }
    
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="78200"><span id="78198"><span id="78199"><a id="78296">atRoot</a></span></span></span></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
  
  <span class="comment">/**
    * &lt;p&gt;
    * This utility method reads a document at a specified URL
    * and fires off calls to various &lt;code&gt;ContentHandler&lt;/code&gt; methods.
    * It's used to include files with &lt;code&gt;parse=&quot;xml&quot;&lt;/code&gt;
    * &lt;/p&gt;
    *
    * @param  url          URL of the document that will be read
    * @return void  
    * @throws SAXException if the requested document cannot
                           be downloaded from the specified URL.
    */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="78201">includeXMLDocument</a></span>(<span class="typed"><span class="type">String</span><a id="78393">url</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="keyword">var</span> <span class="typed"><span class="type">java.net.URL</span><a id="78738">source</a></span>: <span class="typed"><span class="type">java.net.URL</span><a id="4389">URL</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
    <span class="keyword">try</span> {
      <span class="keyword">val</span> <span class="typed"><span class="type">java.net.URL</span><a id="78739">base</a></span> = <span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">()java.net.URL</span><a id="78223">peek</a></span>().<span class="typed"><span class="type">java.net.URL</span><a id="3501">asInstanceOf</a></span>[<span class="typed"><span class="type">java.net.URL</span><a id="4389">URL</a></span>]
      <span class="typed"><span class="type">java.net.URL</span><a href="#78738">source</a></span> = <span class="typed"><span class="type">(java.net.URL,java.lang.String)java.net.URL</span><a id="30769" class="keyword">new</a></span> <span class="typed"><span class="type">java.net.URL</span><a id="4389">URL</a></span>(<span class="typed"><span class="type">java.net.URL</span><a href="#78739">base</a></span>, <span class="typed"><span class="type">String</span><a href="#78393">url</a></span>)
    }
    <span class="keyword">catch</span> { 
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.net.MalformedURLException</span><a id="78747">e</a></span>:<span class="typed"><span class="type">java.net.MalformedURLException</span><a id="4428">MalformedURLException</a></span> =&gt; 
        <span class="keyword">val</span> <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><a id="78748">ex</a></span> = <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><a href="../UnavailableResourceException.scala.html#12275">UnavailableResourceException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Unresolvable URL &quot;)</span><span class="string">&quot;Unresolvable URL &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#78393">url</a></span>
                                                  <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">()String</span><a href="#78196">getLocation</a></span>());
        <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><a href="#78748">ex</a></span>.<span class="typed"><span class="type">(Throwable)Unit</span><a href="../XIncludeException.scala.html#67748">setRootCause</a></span>(<span class="typed"><span class="type">java.net.MalformedURLException</span><a href="#78747">e</a></span>)
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Unresolvable URL &quot;)</span><span class="string">&quot;Unresolvable URL &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#78393">url</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">()String</span><a href="#78196">getLocation</a></span>(), <span class="typed"><span class="type">scala.xml.include.UnavailableResourceException</span><a href="#78748">ex</a></span>)
    }

    <span class="keyword">try</span> {
      <span class="comment">// make this more robust</span>
      <span class="keyword">var</span> <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a id="78761">parser</a></span>: <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a id="25943">XMLReader</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
      <span class="keyword">try</span> {
        <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#78761">parser</a></span> = <span class="typed"><span class="type">object org.xml.sax.helpers.XMLReaderFactory</span><a id="26085">XMLReaderFactory</a></span>.<span class="typed"><span class="type">()org.xml.sax.XMLReader</span><a id="78762">createXMLReader</a></span>()       
      } <span class="keyword">catch</span> {
        <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="78767">e</a></span>:<span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span> =&gt;
          <span class="keyword">try</span> {
            <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#78761">parser</a></span> = <span class="typed"><span class="type">object org.xml.sax.helpers.XMLReaderFactory</span><a id="26085">XMLReaderFactory</a></span>.<span class="typed"><span class="type">(java.lang.String)org.xml.sax.XMLReader</span><a id="78763">createXMLReader</a></span>(
              <span class="typed"><span class="type">java.lang.String(&quot;org.apache.xerces.parsers.SAXParser&quot;)</span><span class="string">&quot;org.apache.xerces.parsers.SAXParser&quot;</span></span>
            );
          } <span class="keyword">catch</span> {
            <span class="typed"><span class="type">Unit</span><span class="keyword">case</span></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="78769">e2</a></span>: <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span> =&gt;
              <span class="typed"><span class="type">object java.lang.System</span><a id="1884">System</a></span>.<span class="typed"><span class="type">java.io.PrintStream</span><a id="31500">err</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="31216">println</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Could not find an XML parser&quot;)</span><span class="string">&quot;Could not find an XML parser&quot;</span></span>)
          }
      }
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span>(<span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#78761">parser</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) {
        <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#78761">parser</a></span>.<span class="typed"><span class="type">(org.xml.sax.ContentHandler)Unit</span><a id="78213">setContentHandler</a></span>(<span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="#12298" class="keyword">this</a></span>)
        <span class="keyword">val</span> <span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a id="78774">resolver</a></span> = <span class="typed"><span class="type">XIncludeFilter.this.type</span><a href="#12298" class="keyword">this</a></span>.<span class="typed"><span class="type">()org.xml.sax.EntityResolver</span><a id="78145">getEntityResolver</a></span>()
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a href="#78774">resolver</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#78761">parser</a></span>.<span class="typed"><span class="type">(org.xml.sax.EntityResolver)Unit</span><a id="78209">setEntityResolver</a></span>(<span class="typed"><span class="type">org.xml.sax.EntityResolver</span><a href="#78774">resolver</a></span>);
        <span class="comment">// save old level and base</span>
        <span class="keyword">val</span> <span class="typed"><span class="type">Int</span><a id="78775">previousLevel</a></span> = <span class="typed"><span class="type">=&gt; Int</span><a href="#78179">level</a></span>
        <span class="typed"><span class="type">XIncludeFilter.this.type</span><a href="#12298" class="keyword">this</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a href="#78180">level</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">(Any)Boolean</span><a id="78244">contains</a></span>(<span class="typed"><span class="type">java.net.URL</span><a href="#78738">source</a></span>)) {
          <span class="keyword">val</span> <span class="typed"><span class="type">scala.xml.include.CircularIncludeException</span><a id="78777">e</a></span> = <span class="typed"><span class="type">scala.xml.include.CircularIncludeException</span><span class="keyword">new</span></span> <span class="typed"><span class="type">scala.xml.include.CircularIncludeException</span><a href="../CircularIncludeException.scala.html#12272">CircularIncludeException</a></span>(
            <span class="typed"><span class="type">java.lang.String(&quot;Circular XInclude Reference to &quot;)</span><span class="string">&quot;Circular XInclude Reference to &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.net.URL</span><a href="#78738">source</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">()String</span><a href="#78196">getLocation</a></span>()
          );
          <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Circular XInclude Reference&quot;)</span><span class="string">&quot;Circular XInclude Reference&quot;</span></span>, <span class="typed"><span class="type">scala.xml.include.CircularIncludeException</span><a href="#78777">e</a></span>)
        }
        <span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">(java.net.URL)java.net.URL</span><a id="78221">push</a></span>(<span class="typed"><span class="type">java.net.URL</span><a href="#78738">source</a></span>)
        <span class="typed"><span class="type">(Boolean)Unit</span><a href="#78199">atRoot</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
        <span class="typed"><span class="type">org.xml.sax.XMLReader</span><a href="#78761">parser</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="78218">parse</a></span>(<span class="typed"><span class="type">java.net.URL</span><a href="#78738">source</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="30787">toExternalForm</a></span>())
        <span class="comment">// restore old level and base</span>
        <span class="typed"><span class="type">XIncludeFilter.this.type</span><a href="#12298" class="keyword">this</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a href="#78180">level</a></span> = <span class="typed"><span class="type">Int</span><a href="#78775">previousLevel</a></span>
        <span class="typed"><span class="type">=&gt; java.util.Stack[java.net.URL]</span><a href="#78174">bases</a></span>.<span class="typed"><span class="type">()java.net.URL</span><a id="78222">pop</a></span>()
      }
    }
    <span class="keyword">catch</span> { 
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="78796">e</a></span>:<span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Document not found: &quot;)</span><span class="string">&quot;Document not found: &quot;</span></span> 
                               <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.net.URL</span><a href="#78738">source</a></span>.<span class="typed"><span class="type">()java.lang.String</span><a id="30787">toExternalForm</a></span>() <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">()String</span><a href="#78196">getLocation</a></span>(), <span class="typed"><span class="type">java.io.IOException</span><a href="#78796">e</a></span>)
    }
    
  }
}

        </pre>
    </body>
</html>