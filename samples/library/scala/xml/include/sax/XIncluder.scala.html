<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/xml/include/sax/XIncluder.scala</title>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style">
    </head>
    <body onload="initializeLinked()">
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2002-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="comment">// $Id: XIncluder.scala 16893 2009-01-13 13:09:22Z cunei $</span>

<span class="keyword">package</span> scala.xml.include.sax

<span class="keyword">import</span> org.xml.sax.SAXException
<span class="keyword">import</span> org.xml.sax.SAXParseException
<span class="keyword">import</span> org.xml.sax.ContentHandler
<span class="keyword">import</span> org.xml.sax.EntityResolver
<span class="keyword">import</span> org.xml.sax.helpers.XMLReaderFactory
<span class="keyword">import</span> org.xml.sax.XMLReader
<span class="keyword">import</span> org.xml.sax.Locator
<span class="keyword">import</span> org.xml.sax.Attributes
<span class="keyword">import</span> org.xml.sax.ext.LexicalHandler

<span class="keyword">import</span> java.io.{File, IOException, OutputStream, OutputStreamWriter,
                UnsupportedEncodingException, Writer}
<span class="keyword">import</span> java.net.{MalformedURLException, URL}
<span class="keyword">import</span> java.util.Stack

<span class="comment">/** XIncluder is a SAX &lt;code&gt;ContentHandler&lt;/code&gt; 
 * that writes its XML document onto an output stream after resolving
 * all &lt;code&gt;xinclude:include&lt;/code&gt; elements.
 *
 * &lt;p&gt;
 *   based on Eliotte Rusty Harold's SAXXIncluder
 * &lt;/p&gt;
 */</span>
<span class="keyword">class</span> <span class="typed"><span class="type">class XIncluder extends java.lang.Object with org.xml.sax.ContentHandler with org.xml.sax.ext.LexicalHandler with ScalaObject</span><a id="12292">XIncluder</a></span>(<span class="typed"><span class="type">java.io.OutputStream</span><span id="83132"><a id="83165">outs</a></span></span>:<span class="typed"><span class="type">java.io.OutputStream</span><a id="3799">OutputStream</a></span>, <span class="typed"><span class="type">String</span><span id="83133"><a id="83166">encoding</a></span></span>:<span class="typed"><span class="type">String</span><a id="1859">String</a></span>) <span class="keyword">extends</span> <span class="typed"><span class="type">java.lang.Object</span><a id="2015">Object</a></span> 
<span class="keyword">with</span> <span class="typed"><span class="type">org.xml.sax.ContentHandler</span><a id="25907">ContentHandler</a></span> <span class="keyword">with</span> <span class="typed"><span class="type">org.xml.sax.ext.LexicalHandler</span><a id="83105">LexicalHandler</a></span> {

  <span class="keyword">var</span> <span class="typed"><span class="type">java.io.OutputStreamWriter</span><span id="83137"><span id="83135"><span id="83136"><a id="125084">out</a></span></span></span></span> = <span class="typed"><span class="type">java.io.OutputStreamWriter</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.io.OutputStreamWriter</span><a id="3844">OutputStreamWriter</a></span>(<span class="typed"><span class="type">java.io.OutputStream</span><a href="#83132">outs</a></span>, <span class="typed"><span class="type">String</span><a href="#83133">encoding</a></span>)

  <span class="keyword">def</span> <span class="typed"><span class="type">(org.xml.sax.Locator)Unit</span><a id="83138">setDocumentLocator</a></span>(<span class="typed"><span class="type">org.xml.sax.Locator</span><a id="125087">locator</a></span>: <span class="typed"><span class="type">org.xml.sax.Locator</span><a id="25904">Locator</a></span>) <span class="typed"><span class="type">Unit</span><span >{</span></span>}
    
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="83139">startDocument</a></span>() {
    <span class="keyword">try</span> {
      <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&lt;?xml version='1.0' encoding='&quot;)</span><span class="string">&quot;&lt;?xml version='1.0' encoding='&quot;</span></span> 
                <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#83133">encoding</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;'?&gt;\015\012&quot;)</span><span class="string">&quot;'?&gt;\r\n&quot;</span></span>);
    }
    <span class="keyword">catch</span> {
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="125091">e</a></span>:<span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Write failed&quot;)</span><span class="string">&quot;Write failed&quot;</span></span>, <span class="typed"><span class="type">java.io.IOException</span><a href="#125091">e</a></span>)
    }        
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="83140">endDocument</a></span>() {
    <span class="keyword">try</span> {
      <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">()Unit</span><a id="33596">flush</a></span>()
    }
    <span class="keyword">catch</span> { 
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="125105">e</a></span>:<span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Flush failed&quot;)</span><span class="string">&quot;Flush failed&quot;</span></span>, <span class="typed"><span class="type">java.io.IOException</span><a href="#125105">e</a></span>)
    }
  }
    
  <span class="keyword">def</span> <span class="typed"><span class="type">(String,String)Unit</span><a id="83141">startPrefixMapping</a></span>(<span class="typed"><span class="type">String</span><a id="125117">prefix</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span> , <span class="typed"><span class="type">String</span><a id="125118">uri</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) <span class="typed"><span class="type">Unit</span><span >{</span></span>}
    
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="83142">endPrefixMapping</a></span>(<span class="typed"><span class="type">String</span><a id="125119">prefix</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) <span class="typed"><span class="type">Unit</span><span >{</span></span>}

  <span class="keyword">def</span> <span class="typed"><span class="type">(String,String,String,org.xml.sax.Attributes)Unit</span><a id="83143">startElement</a></span>(<span class="typed"><span class="type">String</span><a id="125120">namespaceURI</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="125121">localName</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="125122">qualifiedName</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">org.xml.sax.Attributes</span><a id="125123">atts</a></span>: <span class="typed"><span class="type">org.xml.sax.Attributes</span><a id="25922">Attributes</a></span>) = {
    <span class="keyword">try</span> {
      <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&lt;&quot;)</span><span class="string">&quot;&lt;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#125122">qualifiedName</a></span>);
      <span class="keyword">var</span> <span class="typed"><span class="type">Int</span><a id="125125">i</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>; <span class="typed"><span class="type">Unit</span><a href="#125126" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#125125">i</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#125123">atts</a></span>.<span class="typed"><span class="type">()Int</span><a id="67068">getLength</a></span>()) {
        <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot; &quot;)</span><span class="string">&quot; &quot;</span></span>);   
        <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#125123">atts</a></span>.<span class="typed"><span class="type">(Int)java.lang.String</span><a id="67071">getQName</a></span>(<span class="typed"><span class="type">Int</span><a href="#125125">i</a></span>));   
        <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;='&quot;)</span><span class="string">&quot;='&quot;</span></span>);
        <span class="keyword">val</span> <span class="typed"><span class="type">java.lang.String</span><a id="125131">value</a></span> = <span class="typed"><span class="type">org.xml.sax.Attributes</span><a href="#125123">atts</a></span>.<span class="typed"><span class="type">(Int)java.lang.String</span><a id="67073">getValue</a></span>(<span class="typed"><span class="type">Int</span><a href="#125125">i</a></span>);
        <span class="comment">// @todo Need to use character references if the encoding</span>
        <span class="comment">// can't support the character</span>
        <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(xml.<span class="typed"><span class="type">object scala.xml.Utility</span><a href="../../Utility.scala.html#7277">Utility</a></span>.<span class="typed"><span class="type">(String)String</span><a href="../../Utility.scala.html#25374">escape</a></span>(<span class="typed"><span class="type">java.lang.String</span><a href="#125131">value</a></span>))
        <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;'&quot;)</span><span class="string">&quot;'&quot;</span></span>);
        <span class="typed"><span class="type">Int</span><a href="#125125">i</a></span> <span class="typed"><span class="type">(Int)Int</span><a id="3145">+=</a></span> <span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>
      }
      <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&gt;&quot;)</span><span class="string">&quot;&gt;&quot;</span></span>)
    }
    <span class="keyword">catch</span> { 
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="125175">e</a></span>:<span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Write failed&quot;)</span><span class="string">&quot;Write failed&quot;</span></span>, <span class="typed"><span class="type">java.io.IOException</span><a href="#125175">e</a></span>)
    }        
  }
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(String,String,String)Unit</span><a id="83144">endElement</a></span>(<span class="typed"><span class="type">String</span><a id="125187">namespaceURI</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="125188">localName</a></span>:<span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="125189">qualifiedName</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="keyword">try</span> {
      <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&lt;/&quot;)</span><span class="string">&quot;&lt;/&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#125189">qualifiedName</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&gt;&quot;)</span><span class="string">&quot;&gt;&quot;</span></span>)
    }
    <span class="keyword">catch</span> {
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="125193">e</a></span>: <span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Write failed&quot;)</span><span class="string">&quot;Write failed&quot;</span></span>, <span class="typed"><span class="type">java.io.IOException</span><a href="#125193">e</a></span>)
    }
  }

  <span class="comment">// need to escape characters that are not in the given </span>
  <span class="comment">// encoding using character references????</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a id="83145">characters</a></span>(<span class="typed"><span class="type">Array[Char]</span><a id="125205">ch</a></span>: <span class="typed"><span class="type">Array[Char]</span><a href="../../../Array.scala.html#1070">Array</a></span>[Char], <span class="typed"><span class="type">Int</span><a id="125206">start</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">Int</span><a id="125207">length</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>) {
    <span class="keyword">try</span> {
      <span class="keyword">var</span>  <span class="typed"><span class="type">Int</span><a id="125208">i</a></span> = <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>; <span class="typed"><span class="type">Unit</span><a href="#125209" class="keyword">while</a></span> (<span class="typed"><span class="type">Int</span><a href="#125208">i</a></span> <span class="typed"><span class="type">(Int)Boolean</span><a id="3141">&lt;</a></span> <span class="typed"><span class="type">Int</span><a href="#125207">length</a></span>) {
        <span class="keyword">val</span> <span class="typed"><span class="type">Char</span><a id="125211">c</a></span> = <span class="typed"><span class="type">(Int)Char</span><a href="../../../Array.scala.html#17253">ch</a></span>(<span class="typed"><span class="type">Int</span><a href="#125206">start</a></span><span class="typed"><span class="type">(Int)Int</span><a id="3145">+</a></span><span class="typed"><span class="type">Int</span><a href="#125208">i</a></span>);
        <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Char</span><a href="#125211">c</a></span> <span class="typed"><span class="type">(Char)Boolean</span><a id="3016">==</a></span> <span class="typed"><span class="type">Char('&amp;')</span><span class="char">'&amp;'</span></span>) <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&amp;amp;&quot;)</span><span class="string">&quot;&amp;amp;&quot;</span></span>);
        <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Char</span><a href="#125211">c</a></span> <span class="typed"><span class="type">(Char)Boolean</span><a id="3016">==</a></span> <span class="typed"><span class="type">Char('&lt;')</span><span class="char">'&lt;'</span></span>) <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&amp;lt;&quot;)</span><span class="string">&quot;&amp;lt;&quot;</span></span>);
        <span class="comment">// This next fix is normally not necessary.</span>
        <span class="comment">// However, it is required if text contains ]]&gt;</span>
        <span class="comment">// (The end CDATA section delimiter)</span>
        <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">Char</span><a href="#125211">c</a></span> <span class="typed"><span class="type">(Char)Boolean</span><a id="3016">==</a></span> <span class="typed"><span class="type">Char('&gt;')</span><span class="char">'&gt;'</span></span>) <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&amp;gt;&quot;)</span><span class="string">&quot;&amp;gt;&quot;</span></span>);
        <span class="keyword">else</span> <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(Int)Unit</span><a id="33593">write</a></span>(<span class="typed"><span class="type">implicit scala.Predef.char2int : (Char)Int</span><a href="../../../Predef.scala.html#13631">c</a></span>);
        <span class="typed"><span class="type">Int</span><a href="#125208">i</a></span> = <span class="typed"><span class="type">Int</span><a href="#125208">i</a></span><span class="typed"><span class="type">(Int)Int</span><a id="3145">+</a></span><span class="typed"><span class="type">Int(1)</span><span class="int">1</span></span>;
      }
    }
    <span class="keyword">catch</span> { 
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="125280">e</a></span>: <span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt; 
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Write failed&quot;)</span><span class="string">&quot;Write failed&quot;</span></span>, <span class="typed"><span class="type">java.io.IOException</span><a href="#125280">e</a></span>);      
    }
  }

  <span class="keyword">def</span>  <span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a id="83146">ignorableWhitespace</a></span>(<span class="typed"><span class="type">Array[Char]</span><a id="125292">ch</a></span>: <span class="typed"><span class="type">Array[Char]</span><a href="../../../Array.scala.html#1070">Array</a></span>[Char], <span class="typed"><span class="type">Int</span><a id="125293">start</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span> , <span class="typed"><span class="type">Int</span><a id="125294">length</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>) {
    <span class="typed"><span class="type">XIncluder.this.type</span><a href="#12292" class="keyword">this</a></span>.<span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a href="#83145">characters</a></span>(<span class="typed"><span class="type">Array[Char]</span><a href="#125292">ch</a></span>, <span class="typed"><span class="type">Int</span><a href="#125293">start</a></span>, <span class="typed"><span class="type">Int</span><a href="#125294">length</a></span>)
  }
  
  <span class="comment">// do I need to escape text in PI????</span>
  <span class="keyword">def</span> <span class="typed"><span class="type">(String,String)Unit</span><a id="83147">processingInstruction</a></span>(<span class="typed"><span class="type">String</span><a id="125295">target</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="125296">data</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="keyword">try</span> {
      <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&lt;?&quot;)</span><span class="string">&quot;&lt;?&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#125295">target</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot; &quot;)</span><span class="string">&quot; &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#125296">data</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;?&gt;&quot;)</span><span class="string">&quot;?&gt;&quot;</span></span>)
    }
    <span class="keyword">catch</span> { 
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="125300">e</a></span>:<span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Write failed&quot;)</span><span class="string">&quot;Write failed&quot;</span></span>, <span class="typed"><span class="type">java.io.IOException</span><a href="#125300">e</a></span>)
    }
  }
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="83148">skippedEntity</a></span>(<span class="typed"><span class="type">String</span><a id="125312">name</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="keyword">try</span> {
      <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&amp;&quot;)</span><span class="string">&quot;&amp;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#125312">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;;&quot;)</span><span class="string">&quot;;&quot;</span></span>)
    }
    <span class="keyword">catch</span> {
      <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="125316">e</a></span>:<span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
        <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Write failed&quot;)</span><span class="string">&quot;Write failed&quot;</span></span>, <span class="typed"><span class="type">java.io.IOException</span><a href="#125316">e</a></span>)
    }
  }

  <span class="comment">// LexicalHandler methods</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">Boolean</span><span id="83151"><span id="83149"><span id="83150"><a id="125085">inDTD</a></span></span></span></span>: <span class="typed"><span class="type">Boolean</span><a id="2168">Boolean</a></span> = <span class="typed"><span class="type">Boolean(false)</span><span class="keyword">false</span></span>
  <span class="keyword">private</span> <span class="keyword">val</span> <span class="typed"><span class="type">java.util.Stack[String]</span><span id="83153"><a id="83152">entities</a></span></span> = <span class="typed"><span class="type">java.util.Stack[String]</span><span class="keyword">new</span></span> <span class="typed"><span class="type">java.util.Stack[String]</span><a id="5141">Stack</a></span>[String]()

  <span class="keyword">def</span> <span class="typed"><span class="type">(String,String,String)Unit</span><a id="83154">startDTD</a></span>(<span class="typed"><span class="type">String</span><a id="125328">name</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="125329">publicID</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>, <span class="typed"><span class="type">String</span><a id="125330">systemID</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="typed"><span class="type">(Boolean)Unit</span><a href="#83150">inDTD</a></span> = <span class="typed"><span class="type">Boolean(true)</span><span class="keyword">true</span></span>
    <span class="comment">// if this is the source document, output a DOCTYPE declaration</span>
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; java.util.Stack[String]</span><a href="#83152">entities</a></span>.<span class="typed"><span class="type">()Int</span><a id="78241">size</a></span>() <span class="typed"><span class="type">(Int)Boolean</span><a id="3139">==</a></span> <span class="typed"><span class="type">Int(0)</span><span class="int">0</span></span>) {
      <span class="keyword">var</span> <span class="typed"><span class="type">java.lang.String</span><a id="125333">id</a></span> = <span class="typed"><span class="type">java.lang.String(&quot;&quot;)</span><span class="string">&quot;&quot;</span></span>
      <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#125329">publicID</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">java.lang.String</span><a href="#125333">id</a></span> = <span class="typed"><span class="type">java.lang.String(&quot; PUBLIC &quot;&quot;)</span><span class="string">&quot; PUBLIC \&quot;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#125329">publicID</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&quot; &quot;&quot;)</span><span class="string">&quot;\&quot; \&quot;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#125330">systemID</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">Char('&quot;')</span><span class="char">'&quot;'</span></span>;
      <span class="keyword">else</span> <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">String</span><a href="#125330">systemID</a></span> <span class="typed"><span class="type">(AnyRef)Boolean</span><a id="5791">!=</a></span> <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>) <span class="typed"><span class="type">java.lang.String</span><a href="#125333">id</a></span> = <span class="typed"><span class="type">java.lang.String(&quot; SYSTEM &quot;&quot;)</span><span class="string">&quot; SYSTEM \&quot;&quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#125330">systemID</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">Char('&quot;')</span><span class="char">'&quot;'</span></span>;
      <span class="keyword">try</span> {
        <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&lt;!DOCTYPE &quot;)</span><span class="string">&quot;&lt;!DOCTYPE &quot;</span></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">String</span><a href="#125328">name</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String</span><a href="#125333">id</a></span> <span class="typed"><span class="type">(Any)java.lang.String</span><a id="5800">+</a></span> <span class="typed"><span class="type">java.lang.String(&quot;&gt;\015\012&quot;)</span><span class="string">&quot;&gt;\r\n&quot;</span></span>)
      }
      <span class="keyword">catch</span> { 
        <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="125339">e</a></span>:<span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
          <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Error while writing DOCTYPE&quot;)</span><span class="string">&quot;Error while writing DOCTYPE&quot;</span></span>, <span class="typed"><span class="type">java.io.IOException</span><a href="#125339">e</a></span>)
      }
    }
  }
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="83155">endDTD</a></span>() <span class="typed"><span class="type">Unit</span><span >{</span></span>}
    
  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="83156">startEntity</a></span>(<span class="typed"><span class="type">String</span><a id="125351">name</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="typed"><span class="type">=&gt; java.util.Stack[String]</span><a href="#83152">entities</a></span>.<span class="typed"><span class="type">(String)String</span><a id="78221">push</a></span>(<span class="typed"><span class="type">String</span><a href="#125351">name</a></span>)
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(String)Unit</span><a id="83157">endEntity</a></span>(<span class="typed"><span class="type">String</span><a id="125352">name</a></span>: <span class="typed"><span class="type">String</span><a id="1859">String</a></span>) {
    <span class="typed"><span class="type">=&gt; java.util.Stack[String]</span><a href="#83152">entities</a></span>.<span class="typed"><span class="type">()String</span><a id="78222">pop</a></span>()
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="83158">startCDATA</a></span>() <span class="typed"><span class="type">Unit</span><span >{</span></span>}
  <span class="keyword">def</span> <span class="typed"><span class="type">()Unit</span><a id="83159">endCDATA</a></span>() <span class="typed"><span class="type">Unit</span><span >{</span></span>}

  <span class="comment">// Just need this reference so we can ask if a comment is </span>
  <span class="comment">// inside an include element or not</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><span id="83162"><span id="83160"><span id="83161"><a id="125086">filter</a></span></span></span></span>: <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="XIncludeFilter.scala.html#12298">XIncludeFilter</a></span> = <span class="typed"><span class="type">Null(null)</span><span class="keyword">null</span></span>
  
  <span class="keyword">def</span> <span class="typed"><span class="type">(scala.xml.include.sax.XIncludeFilter)Unit</span><a id="83163">setFilter</a></span>(<span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a id="83169">filter</a></span>: <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="XIncludeFilter.scala.html#12298">XIncludeFilter</a></span>) {
    <span class="typed"><span class="type">XIncluder.this.type</span><a href="#12292" class="keyword">this</a></span>.<span class="typed"><span class="type">(scala.xml.include.sax.XIncludeFilter)Unit</span><a href="#83161">filter</a></span> = <span class="typed"><span class="type">scala.xml.include.sax.XIncludeFilter</span><a href="#83169">filter</a></span>
  }

  <span class="keyword">def</span> <span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a id="83164">comment</a></span>(<span class="typed"><span class="type">Array[Char]</span><a id="125353">ch</a></span>: <span class="typed"><span class="type">Array[Char]</span><a href="../../../Array.scala.html#1070">Array</a></span>[Char], <span class="typed"><span class="type">Int</span><a id="125354">start</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>, <span class="typed"><span class="type">Int</span><a id="125355">length</a></span>: <span class="typed"><span class="type">Int</span><a id="2392">Int</a></span>) {
    <span class="typed"><span class="type">Unit</span><span class="keyword">if</span></span> (<span class="typed"><span class="type">=&gt; Boolean</span><a id="2745">!</a></span><span class="typed"><span class="type">=&gt; Boolean</span><a href="#83149">inDTD</a></span> <span class="typed"><span class="type">(Boolean)Boolean</span><a id="2749">&amp;&amp;</a></span> <span class="typed"><span class="type">=&gt; Boolean</span><a id="2745">!</a></span><span class="typed"><span class="type">=&gt; scala.xml.include.sax.XIncludeFilter</span><a href="#83160">filter</a></span>.<span class="typed"><span class="type">()Boolean</span><a href="XIncludeFilter.scala.html#78182">insideIncludeElement</a></span>()) {
      <span class="keyword">try</span> {
        <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;&lt;!--&quot;)</span><span class="string">&quot;&lt;!--&quot;</span></span>)
        <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(Array[Char],Int,Int)Unit</span><a id="33594">write</a></span>(<span class="typed"><span class="type">Array[Char]</span><a href="#125353">ch</a></span>, <span class="typed"><span class="type">Int</span><a href="#125354">start</a></span>, <span class="typed"><span class="type">Int</span><a href="#125355">length</a></span>)
        <span class="typed"><span class="type">=&gt; java.io.OutputStreamWriter</span><a href="#83135">out</a></span>.<span class="typed"><span class="type">(java.lang.String)Unit</span><a id="26420">write</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;--&gt;&quot;)</span><span class="string">&quot;--&gt;&quot;</span></span>)
      }
      <span class="keyword">catch</span> { 
        <span class="typed"><span class="type">Nothing</span><span class="keyword">case</span></span> <span class="typed"><span class="type">java.io.IOException</span><a id="125391">e</a></span>: <span class="typed"><span class="type">java.io.IOException</span><a id="3517">IOException</a></span> =&gt;
          <span class="typed"><span class="type">Nothing</span><span class="keyword">throw</span></span> <span class="typed"><span class="type">(java.lang.String,java.lang.Exception)org.xml.sax.SAXException</span><a id="67301" class="keyword">new</a></span> <span class="typed"><span class="type">org.xml.sax.SAXException</span><a id="25940">SAXException</a></span>(<span class="typed"><span class="type">java.lang.String(&quot;Write failed&quot;)</span><span class="string">&quot;Write failed&quot;</span></span>, <span class="typed"><span class="type">java.io.IOException</span><a href="#125391">e</a></span>)
      }
    }
  }
}

        </pre>
    </body>
</html>