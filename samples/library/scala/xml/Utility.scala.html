<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/xml/Utility.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

// $Id: Utility.scala 18210 2009-07-05 14:46:37Z extempore $


<span class="keyword">package</span> scala.xml

<span class="keyword">import</span> collection.mutable.{Set, HashSet}
<span class="keyword">import</span> parsing.XhtmlEntities

/**
 * The &lt;code&gt;Utility&lt;/code&gt; object provides utility functions for processing
 * instances of bound and not bound XML classes, as well as escaping text nodes.
 *
 * @author Burak Emir
 */
<span class="keyword">object</span> <a title="object scala.xml.Utility" id="8793">Utility</a> <a href="../ScalaObject.scala.html#969" title="ScalaObject" class="keyword">extends</a> <a title="java.lang.Object" id="3638">AnyRef</a> <span class="keyword">with</span> parsing.<a href="parsing/TokenTests.scala.html#12247" title="scala.xml.parsing.TokenTests">TokenTests</a> 
{
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scala.xml.Utility.implicitSbToString : (sb: StringBuilder)String" id="26679">implicitSbToString</a>(<a title="StringBuilder" id="28038">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a>) = <a href="#28038" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23516" title="()String">toString</a>()
  
  // helper for the extremely oft-repeated sequence of creating a
  // StringBuilder, passing it around, and then grabbing its String.
  <span class="keyword">private</span> [xml] <span class="keyword">def</span> <a title="(f: (StringBuilder) =&gt; Unit)String" id="26680">sbToString</a>(<a title="(StringBuilder) =&gt; Unit" id="27182">f</a>: (StringBuilder) =&gt; Unit): <span title="String">String</span> = {
    <span class="keyword">val</span> <a title="StringBuilder" id="237248">sb</a> = <a href="../collection/mutable/StringBuilder.scala.html#23455" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14896" title="StringBuilder">StringBuilder</a>
    <a href="../Function1.scala.html#17226" title="(v1: StringBuilder)Unit">f</a>(<a href="#237248" title="StringBuilder">sb</a>)
    <a href="#237248" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23516" title="()String">toString</a>
  }
  <span class="keyword">private</span>[xml] <span class="keyword">def</span> <a title="(x: scala.xml.Node)Boolean" id="26681">isAtomAndNotText</a>(<a title="scala.xml.Node" id="134644">x</a>: <a href="Node.scala.html#8723" title="scala.xml.Node">Node</a>) = <a href="#134644" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21100" title="(x$1: Boolean)Boolean">isAtom</a> &amp;&amp; <span title="=&gt; Boolean">!</span><a href="#134644" title="scala.xml.Node">x</a>.<a title="[T0]Boolean" id="3633">isInstanceOf</a><span title="Boolean">[</span><a href="Text.scala.html#8702" title="scala.xml.Text">Text</a>]

  /** trims an element - call this method, when you know that it is an
   *  element (and not a text node) so you know that it will not be trimmed
   *  away. With this assumption, the function can return a &lt;code&gt;Node&lt;/code&gt;,
   *  rather than a &lt;code&gt;Seq[Node]&lt;/code&gt;. If you don't know, call
   *  &lt;code&gt;trimProper&lt;/code&gt; and account for the fact that you may get back
   *  an empty sequence of nodes.
   *
   *  precondition: node is not a text node (it might be trimmed) 
   */
  <span class="keyword">def</span> <a title="(x: scala.xml.Node)scala.xml.Node" id="26682">trim</a>(<a title="scala.xml.Node" id="237269">x</a>: <a href="Node.scala.html#8723" title="scala.xml.Node">Node</a>): <a href="Node.scala.html#8723" title="scala.xml.Node">Node</a> = <a href="#237269" title="scala.xml.Node">x</a> <span title="scala.xml.Node" class="keyword">match</span> {
    <span title="scala.xml.Elem" class="keyword">case</span> <a href="Elem.scala.html#50348" title="(n: scala.xml.Node)Option[(String, String, scala.xml.MetaData, scala.xml.NamespaceBinding, Seq[scala.xml.Node])]">Elem</a>(<a title="String" id="237274">pre</a>, <a title="String" id="237275">lab</a>, <a title="scala.xml.MetaData" id="237276">md</a>, <a title="scala.xml.NamespaceBinding" id="237277">scp</a>, <a title="Sequence[scala.xml.Node]" id="237278">child</a>@_*) =&gt; 
      <a href="Elem.scala.html#50347" title="(prefix: String,label: String,attributes: scala.xml.MetaData,scope: scala.xml.NamespaceBinding,child: scala.xml.Node*)scala.xml.Elem">Elem</a>(<a href="#237274" title="String">pre</a>, <a href="#237275" title="String">lab</a>, <a href="#237276" title="scala.xml.MetaData">md</a>, <a href="#237277" title="scala.xml.NamespaceBinding">scp</a>, (<a href="../collection/generic/TraversableTemplate.scala.html#17273" title="(f: (scala.xml.Node) =&gt; Traversable[scala.xml.Node])(implicit bf: scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence[scala.xml.Node]])Sequence[scala.xml.Node]">child</a> <a href="../collection/Sequence.scala.html#22146" title="scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence#Coll]">flatMap</a> <a href="#26683" title="(x: scala.xml.Node)Seq[scala.xml.Node]">trimProper</a>):_*)
  }

  /** trim a child of an element. &lt;code&gt;Attribute&lt;/code&gt; values and
   *  &lt;code&gt;Atom&lt;/code&gt; nodes that are not &lt;code&gt;Text&lt;/code&gt; nodes are unaffected.
   */
  <span class="keyword">def</span> <a title="(x: scala.xml.Node)Seq[scala.xml.Node]" id="26683">trimProper</a>(<a title="scala.xml.Node" id="237287">x</a>:<a href="Node.scala.html#8723" title="scala.xml.Node">Node</a>): <a href="../collection/Sequence.scala.html#4376" title="Seq[scala.xml.Node]">Seq</a>[Node] = <a href="#237287" title="scala.xml.Node">x</a> <span title="Seq[scala.xml.Node]" class="keyword">match</span> {
    <span title="scala.xml.Elem" class="keyword">case</span> <a href="Elem.scala.html#50348" title="(n: scala.xml.Node)Option[(String, String, scala.xml.MetaData, scala.xml.NamespaceBinding, Seq[scala.xml.Node])]">Elem</a>(<a title="String" id="237319">pre</a>,<a title="String" id="237320">lab</a>,<a title="scala.xml.MetaData" id="237321">md</a>,<a title="scala.xml.NamespaceBinding" id="237322">scp</a>,<a title="Sequence[scala.xml.Node]" id="237323">child</a>@_*) =&gt; 
      <a href="Elem.scala.html#50347" title="(prefix: String,label: String,attributes: scala.xml.MetaData,scope: scala.xml.NamespaceBinding,child: scala.xml.Node*)scala.xml.Elem">Elem</a>(<a href="#237319" title="String">pre</a>,<a href="#237320" title="String">lab</a>,<a href="#237321" title="scala.xml.MetaData">md</a>,<a href="#237322" title="scala.xml.NamespaceBinding">scp</a>, (<a href="../collection/generic/TraversableTemplate.scala.html#17273" title="(f: (scala.xml.Node) =&gt; Traversable[scala.xml.Node])(implicit bf: scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence[scala.xml.Node]])Sequence[scala.xml.Node]">child</a> <a href="../collection/Sequence.scala.html#22146" title="scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence#Coll]">flatMap</a> <a href="#26683" title="(x: scala.xml.Node)Seq[scala.xml.Node]">trimProper</a>):_*)
    <span title="Seq[scala.xml.Text]" class="keyword">case</span> Text(<a title="String" id="237348">s</a>) =&gt; 
      <span title="scala.xml.TextBuffer" class="keyword">new</span> <a href="TextBuffer.scala.html#8750" title="scala.xml.TextBuffer">TextBuffer</a>().<a href="TextBuffer.scala.html#146558" title="(cs: Seq[Char])scala.xml.TextBuffer">append</a>(<a href="../Predef.scala.html#16471" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">s</a>).<a href="TextBuffer.scala.html#146559" title="=&gt; Seq[scala.xml.Text]">toText</a>
    <span title="scala.xml.Node" class="keyword">case</span> _ =&gt; 
      <a href="#237287" title="scala.xml.Node">x</a>
  }
  /** returns a sorted attribute list */
  <span class="keyword">def</span> <a title="(md: scala.xml.MetaData)scala.xml.MetaData" id="26684">sort</a>(<a title="scala.xml.MetaData" id="237362">md</a>: <a href="MetaData.scala.html#8654" title="scala.xml.MetaData">MetaData</a>): <a href="MetaData.scala.html#8654" title="scala.xml.MetaData">MetaData</a> = <span title="scala.xml.MetaData" class="keyword">if</span>(<span title="(x$1: Boolean)Boolean">(</span><a href="#237362" title="(x$1: AnyRef)Boolean">md</a> eq <a href="Null.scala.html#8595" title="object scala.xml.Null">Null</a>) || (<a href="#237362" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31992" title="(x$1: AnyRef)Boolean">next</a> eq <a href="Null.scala.html#8595" title="object scala.xml.Null">Null</a>)) <a href="#237362" title="scala.xml.MetaData">md</a> <span class="keyword">else</span> {
    <span class="keyword">val</span> <a title="String" id="237370">key</a> = <a href="#237362" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31989" title="=&gt; String">key</a>
    <span class="keyword">val</span> <a title="scala.xml.MetaData" id="237371">smaller</a> = <a href="#26684" title="(md: scala.xml.MetaData)scala.xml.MetaData">sort</a>(<a href="#237362" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31988" title="(f: (scala.xml.MetaData) =&gt; Boolean)scala.xml.MetaData">filter</a> { <a title="scala.xml.MetaData" id="237382">m</a> =&gt; <a href="#237382" title="scala.xml.MetaData">m</a>.<a href="../Ordered.scala.html#18214" title="(that: String)Boolean">key</a> &lt; <a href="#237370" title="String">key</a> })
    <span class="keyword">val</span> <a title="scala.xml.MetaData" id="237372">greater</a> = <a href="#26684" title="(md: scala.xml.MetaData)scala.xml.MetaData">sort</a>(<a href="#237362" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31988" title="(f: (scala.xml.MetaData) =&gt; Boolean)scala.xml.MetaData">filter</a> { <a title="scala.xml.MetaData" id="237439">m</a> =&gt; <a href="#237439" title="scala.xml.MetaData">m</a>.<a href="../Ordered.scala.html#18215" title="(that: String)Boolean">key</a> &gt; <a href="#237370" title="String">key</a> })
    <a href="#237371" title="scala.xml.MetaData">smaller</a>.<a href="MetaData.scala.html#31973" title="(updates: scala.xml.MetaData,scope: scala.xml.NamespaceBinding)scala.xml.MetaData">append</a><a title="scala.xml.MetaData" id="237491">(</a> <a href="Null.scala.html#8595" title="object scala.xml.Null">Null</a> ).<a href="MetaData.scala.html#137898" title="scala.xml.NamespaceBinding" id="237496">append</a>(<a href="#237362" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31978" title="(next: scala.xml.MetaData)scala.xml.MetaData">copy</a> <a title="scala.xml.MetaData" id="237495">(</a> <a href="#237372" title="scala.xml.MetaData">greater</a> ))
  }

  /** returns the node with its attribute list sorted alphabetically (prefixes are ignored) */
  <span class="keyword">def</span> <a title="(n: scala.xml.Node)scala.xml.Node" id="26685">sort</a>(<a title="scala.xml.Node" id="237376">n</a>:<a href="Node.scala.html#8723" title="scala.xml.Node">Node</a>): <a href="Node.scala.html#8723" title="scala.xml.Node">Node</a> = <a href="#237376" title="scala.xml.Node">n</a> <span title="scala.xml.Node" class="keyword">match</span> {
	  <span title="scala.xml.Elem" class="keyword">case</span> <a href="Elem.scala.html#50348" title="(n: scala.xml.Node)Option[(String, String, scala.xml.MetaData, scala.xml.NamespaceBinding, Seq[scala.xml.Node])]">Elem</a>(<a title="String" id="237502">pre</a>,<a title="String" id="237503">lab</a>,<a title="scala.xml.MetaData" id="237504">md</a>,<a title="scala.xml.NamespaceBinding" id="237505">scp</a>,<a title="Sequence[scala.xml.Node]" id="237506">child</a>@_*) =&gt;
		  <a href="Elem.scala.html#50347" title="(prefix: String,label: String,attributes: scala.xml.MetaData,scope: scala.xml.NamespaceBinding,child: scala.xml.Node*)scala.xml.Elem">Elem</a>(<a href="#237502" title="String">pre</a>,<a href="#237503" title="String">lab</a>,<a href="#26684" title="(md: scala.xml.MetaData)scala.xml.MetaData">sort</a>(<a href="#237504" title="scala.xml.MetaData">md</a>),<a href="#237505" title="scala.xml.NamespaceBinding">scp</a>, (<a href="../collection/generic/TraversableTemplate.scala.html#17268" title="(f: (scala.xml.Node) =&gt; scala.xml.Node)(implicit bf: scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence[scala.xml.Node]])Sequence[scala.xml.Node]">child</a> <a href="../collection/Sequence.scala.html#22146" title="scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence#Coll]">map</a> <a href="#26685" title="(n: scala.xml.Node)scala.xml.Node">sort</a>):_*)
	  <span title="scala.xml.Node" class="keyword">case</span> _ =&gt; <a href="#237376" title="scala.xml.Node">n</a>
  }

  @deprecated(<span class="string">&quot;a string might also be Atom(s) - define your own conversion&quot;</span>)
  <span class="keyword">def</span> <a title="(s: String)scala.xml.Text" id="26686">view</a>(<a title="String" id="237569">s</a>: <span title="String">String</span>): <a href="Text.scala.html#8702" title="scala.xml.Text">Text</a> = <a href="Text.scala.html#26791" title="(_data: String)scala.xml.Text">Text</a>(<a href="#237569" title="String">s</a>)

  /**
   * Escapes the characters &amp;lt; &amp;gt; &amp;amp; and &amp;quot; from string.
   *
   * @param text ...
   * @return     ...
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(text: String)String" id="26687">escape</a>(<a title="String" id="26728">text</a>: <span title="String">String</span>): <span title="String">String</span> = <a href="#26680" title="(f: (StringBuilder) =&gt; Unit)String">sbToString</a>(<a href="#26691" title="(text: String,s: StringBuilder)StringBuilder">escape</a><span title="Unit">(</span><a href="#26728" title="String">text</a>, <a href="#237578" title="StringBuilder">_</a>))
  
  <span class="keyword">object</span> <a title="object scala.xml.Utility.Escapes" id="26688">Escapes</a> <a href="../ScalaObject.scala.html#969" title="ScalaObject">{</a>
    /** For reasons unclear escape and unescape are a long ways from
        being logical inverses. */
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="List[(java.lang.String, Char)]" id="26721">pairs</a> = <a href="../collection/immutable/List.scala.html#17642" title="(xs: (java.lang.String, Char)*)List[(java.lang.String, Char)]">List</a>(
      <a href="../Predef.scala.html#19210" title="(y: Char)(java.lang.String, Char)" class="string">&quot;lt&quot;</a>    -&gt; <span title="Char('&lt;')" class="char">'&lt;'</span>,
      <a href="../Predef.scala.html#19210" title="(y: Char)(java.lang.String, Char)" class="string">&quot;gt&quot;</a>    -&gt; <span title="Char('&gt;')" class="char">'&gt;'</span>,
      <a href="../Predef.scala.html#19210" title="(y: Char)(java.lang.String, Char)" class="string">&quot;amp&quot;</a>   -&gt; <span title="Char('&amp;')" class="char">'&amp;'</span>,
      <a href="../Predef.scala.html#19210" title="(y: Char)(java.lang.String, Char)" class="string">&quot;quot&quot;</a>  -&gt; <span title="Char('&quot;')" class="char">'&quot;'</span>
      // enigmatic comment explaining why this isn't escaped --
      // is valid xhtml but not html, and IE doesn't know it, says jweb
      // &quot;apos&quot;  -&gt; '\''
    )
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[Char,String]" id="26723">escMap</a>    = <a href="../collection/generic/MapFactory.scala.html#35294" title="(elems: (Char, String)*)scala.collection.immutable.Map[Char,String]">Map</a>((<span class="keyword">for</span> ((<a title="java.lang.String" id="237717">s</a>, <a title="Char" id="237718">c</a>) &lt;- <a href="../collection/generic/TraversableTemplate.scala.html#17268" title="(f: ((java.lang.String, Char)) =&gt; (Char, String))(implicit bf: scala.collection.generic.BuilderFactory[(Char, String),List[(Char, String)],List[(java.lang.String, Char)]])List[(Char, String)]">pairs</a>) <span class="keyword">yield</span> <a href="../Tuple2.scala.html#20777" title="(_1: Char,_2: String)(Char, String)">(</a><a href="#237718" title="Char">c</a>, <a href="../runtime/RichString.scala.html#18167" title="(args: Any*)String" class="string">&quot;&amp;%s;&quot;</a> format <a href="#237717" title="java.lang.String">s</a>)) : _*)
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[java.lang.String,Char]" id="26725">unescMap</a>  = <a href="../collection/generic/MapFactory.scala.html#35294" title="(elems: (java.lang.String, Char)*)scala.collection.immutable.Map[java.lang.String,Char]">Map</a>((<a href="../Predef.scala.html#19210" title="(y: Char)(java.lang.String, Char)" class="string">&quot;apos&quot;</a>  -&gt; <span title="Char(''')" class="char">'\''</span>) <a href="#237840" title="(java.lang.String, Char)">::</a> <a href="../collection/immutable/List.scala.html#17737" title="(x: (java.lang.String, Char))List[(java.lang.String, Char)]">pairs</a> : _*)
  }
  <span class="keyword">import</span> Escapes._
  
  /**
   * Appends escaped string to &lt;code&gt;s&lt;/code&gt;.
   *
   * @param text ...
   * @param s    ...
   * @return     ...
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(text: String,s: StringBuilder)StringBuilder" id="26691">escape</a>(<a title="String" id="26718">text</a>: <span title="String">String</span>, <a title="StringBuilder" id="26719">s</a>: <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a>): <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a> =
    <a href="../Predef.scala.html#16471" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">text</a>.<a href="../collection/generic/VectorTemplate.scala.html#17871" title="(z: StringBuilder)(op: (StringBuilder, Char) =&gt; StringBuilder)StringBuilder">foldLeft</a>(<a href="#26719" title="StringBuilder">s</a>)((<a title="StringBuilder" id="237916">s</a>, <a title="Char" id="237917">c</a>) =&gt; <a href="#26723" title="=&gt; scala.collection.immutable.Map[Char,String]">escMap</a>.<a href="../collection/generic/MapTemplate.scala.html#35386" title="(key: Char)Option[String]">get</a>(<a href="#237917" title="Char">c</a>) <span title="StringBuilder" class="keyword">match</span> {
      <span title="StringBuilder" class="keyword">case</span> Some(<a title="String" id="237922">str</a>)  =&gt; <a href="../collection/mutable/StringBuilder.scala.html#23477" title="(s: String)StringBuilder">s</a> append <a href="#237922" title="String">str</a>
      <span title="StringBuilder" class="keyword">case</span> <a href="../Option.scala.html#472" title="object None">None</a>       =&gt; <a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">s</a> append <a href="#237917" title="Char">c</a>
    })

  /**
   * Appends unescaped string to &lt;code&gt;s&lt;/code&gt;, amp becomes &amp;amp;
   * lt becomes &amp;lt; etc..
   *
   * @param ref ...
   * @param s   ...
   * @return    &lt;code&gt;null&lt;/code&gt; if &lt;code&gt;ref&lt;/code&gt; was not a predefined
   *            entity.
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ref: String,s: StringBuilder)StringBuilder" id="26692">unescape</a>(<a title="String" id="237939">ref</a>: <span title="String">String</span>, <a title="StringBuilder" id="237940">s</a>: <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a>): <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a> =
    <a href="../Option.scala.html#19873" title="(f: (Char) =&gt; StringBuilder)Option[StringBuilder]">(</a><a href="../collection/generic/MapTemplate.scala.html#35386" title="(key: java.lang.String)Option[Char]">unescMap</a> get <a href="#237939" title="String">ref</a>) <a href="../Option.scala.html#19870" title="(default: =&gt; StringBuilder)StringBuilder">map</a> (<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">s</a> append <a href="#237949" title="Char">_</a>) getOrElse <span title="Null(null)" class="keyword">null</span>

  /**
   * Returns a set of all namespaces used in a sequence of nodes 
   * and all their descendants, including the empty namespaces.
   *
   * @param nodes ...
   * @return      ...
   */
  <span class="keyword">def</span> <a title="(nodes: Seq[scala.xml.Node])scala.collection.mutable.Set[String]" id="26693">collectNamespaces</a>(<a title="Seq[scala.xml.Node]" id="237966">nodes</a>: <a href="../collection/Sequence.scala.html#4376" title="Seq[scala.xml.Node]">Seq</a>[Node]): <a href="../collection/mutable/Set.scala.html#7875" title="scala.collection.mutable.Set[String]">Set</a>[String] = 
    <a href="#237966" title="Seq[scala.xml.Node]">nodes</a>.<a href="../collection/generic/TraversableTemplate.scala.html#17294" title="(z: scala.collection.mutable.HashSet[String])(op: (scala.collection.mutable.HashSet[String], scala.xml.Node) =&gt; scala.collection.mutable.HashSet[String])scala.collection.mutable.HashSet[String]">foldLeft</a>(<span title="scala.collection.mutable.HashSet[String]" class="keyword">new</span> <a href="../collection/mutable/HashSet.scala.html#7665" title="scala.collection.mutable.HashSet[String]">HashSet</a>[String]) { (<a title="scala.collection.mutable.HashSet[String]" id="237984">set</a>, <a title="scala.xml.Node" id="237985">x</a>) =&gt; <a href="#26694" title="(n: scala.xml.Node,set: scala.collection.mutable.Set[String])Unit">collectNamespaces</a>(<a href="#237985" title="scala.xml.Node">x</a>, <a href="#237984" title="scala.collection.mutable.HashSet[String]">set</a>) ; <a href="#237984" title="scala.collection.mutable.HashSet[String]">set</a> }

  /**
   * Adds all namespaces in node to set.
   *
   * @param n   ...
   * @param set ...
   */
  <span class="keyword">def</span> <a title="(n: scala.xml.Node,set: scala.collection.mutable.Set[String])Unit" id="26694">collectNamespaces</a>(<a title="scala.xml.Node" id="237989">n</a>: <a href="Node.scala.html#8723" title="scala.xml.Node">Node</a>, <a title="scala.collection.mutable.Set[String]" id="237990">set</a>: <a href="../collection/mutable/Set.scala.html#7875" title="scala.collection.mutable.Set[String]">Set</a>[String]) {
    <span title="Unit" class="keyword">if</span> (<a href="#237989" title="scala.xml.Node">n</a>.<a href="Node.scala.html#21101" title="=&gt; Boolean">doCollectNamespaces</a>) {
      <a href="../collection/generic/MutableSetTemplate.scala.html#37483" title="(elem: String)set.type">set</a> += <a href="#237989" title="scala.xml.Node">n</a>.<a href="Node.scala.html#21104" title="=&gt; String">namespace</a>
      <span class="keyword">for</span> (<a title="scala.xml.MetaData" id="238056">a</a> &lt;- <a href="#237989" title="scala.xml.Node">n</a>.<a href="../collection/generic/IterableTemplate.scala.html#17394" title="(f: (scala.xml.MetaData) =&gt; Any)Unit">attributes</a>) <a href="#238056" title="scala.xml.MetaData">a</a> <span title="Any" class="keyword">match</span> {
        <span title="set.type" class="keyword">case</span> _:<a href="PrefixedAttribute.scala.html#8774" title="scala.xml.PrefixedAttribute">PrefixedAttribute</a> =&gt;
          <a href="../collection/generic/MutableSetTemplate.scala.html#37483" title="(elem: String)set.type">set</a> += <a href="#238056" title="scala.xml.MetaData">a</a>.<a href="MetaData.scala.html#31979" title="(owner: scala.xml.Node)String">getNamespace</a>(<a href="#237989" title="scala.xml.Node">n</a>)
        <span title="Unit" class="keyword">case</span> _ =&gt;
      }
      <span class="keyword">for</span> (<a title="scala.xml.Node" id="238100">i</a> &lt;- <a href="#237989" title="scala.xml.Node">n</a>.<a href="../collection/generic/IterableTemplate.scala.html#17394" title="(f: (scala.xml.Node) =&gt; Unit)Unit">child</a>) 
        <a href="#26694" title="(n: scala.xml.Node,set: scala.collection.mutable.Set[String])Unit">collectNamespaces</a>(<a href="#238100" title="scala.xml.Node">i</a>, <a href="#237990" title="scala.collection.mutable.Set[String]">set</a>)
    }
  }
  
  // def toXML(
  //   x: Node,
  //   pscope: NamespaceBinding = TopScope,
  //   sb: StringBuilder = new StringBuilder,
  //   stripComments: Boolean = false,
  //   decodeEntities: Boolean = true,
  //   preserveWhitespace: Boolean = false,
  //   minimizeTags: Boolean = false): String =
  // {
  //   toXMLsb(x, pscope, sb, stripComments, decodeEntities, preserveWhitespace, minimizeTags)
  //   sb.toString()
  // }

  <span class="keyword">def</span> <a title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder" id="26695">toXML</a>(
    <a title="scala.xml.Node" id="47690">x</a>: <a href="Node.scala.html#8723" title="scala.xml.Node">Node</a>,
    <a title="scala.xml.NamespaceBinding" id="47698">pscope</a>: <a href="NamespaceBinding.scala.html#8828" title="scala.xml.NamespaceBinding">NamespaceBinding</a> = <a href="TopScope.scala.html#8631" title="object scala.xml.TopScope">TopScope</a>,
    <a title="StringBuilder" id="47699">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a> = <a href="../collection/mutable/StringBuilder.scala.html#23455" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14896" title="StringBuilder">StringBuilder</a>,
    <a title="Boolean" id="47700">stripComments</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>,
    <a title="Boolean" id="47701">decodeEntities</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span>,
    <a title="Boolean" id="47702">preserveWhitespace</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>,
    <a title="Boolean" id="47703">minimizeTags</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>): <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a> =
  {
    <a href="#47690" title="scala.xml.Node">x</a> <span title="StringBuilder" class="keyword">match</span> {
      <span title="StringBuilder" class="keyword">case</span> <a title="scala.xml.Comment" id="238125">c</a>: <a href="Comment.scala.html#8477" title="scala.xml.Comment">Comment</a> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#47700" title="Boolean">stripComments</a> =&gt; <a href="Comment.scala.html#50453" title="(sb: StringBuilder)StringBuilder">c</a> buildString <a href="#47699" title="StringBuilder">sb</a>
      <span title="StringBuilder" class="keyword">case</span> <a title="scala.xml.SpecialNode" id="238160">x</a>: <a href="SpecialNode.scala.html#8780" title="scala.xml.SpecialNode">SpecialNode</a>               =&gt; <a href="SpecialNode.scala.html#26564" title="(sb: StringBuilder)StringBuilder">x</a> buildString <a href="#47699" title="StringBuilder">sb</a>
      <span title="StringBuilder" class="keyword">case</span> <a title="scala.xml.Group" id="238169">g</a>: <a href="Group.scala.html#8504" title="scala.xml.Group">Group</a>                     =&gt; <span class="keyword">for</span> (<a title="scala.xml.Node" id="238180">c</a> &lt;- <a href="#238169" title="scala.xml.Group">g</a>.<a href="../collection/generic/IterableTemplate.scala.html#17394" title="(f: (scala.xml.Node) =&gt; StringBuilder)Unit">nodes</a>) <a href="#26695" title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder">toXML</a>(<a href="#238180" title="scala.xml.Node">c</a>, <a href="#47690" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21103" title="=&gt; scala.xml.NamespaceBinding">scope</a>, <a href="#47699" title="StringBuilder">sb</a>) ; <a href="#47699" title="StringBuilder">sb</a> 
      <span title="StringBuilder" class="keyword">case</span> _  =&gt;
        // print tag with namespace declarations
        <a href="#47699" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<span title="Char('&lt;')" class="char">'&lt;'</span>)
        <a href="#47690" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21118" title="(sb: StringBuilder)StringBuilder">nameToString</a>(<a href="#47699" title="StringBuilder">sb</a>)
        <span title="Any" class="keyword">if</span> (<a href="#47690" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21108" title="(x$1: AnyRef)Boolean">attributes</a> ne <span title="Null(null)" class="keyword">null</span>) <a href="#47690" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21108" title="=&gt; scala.xml.MetaData">attributes</a>.<a href="MetaData.scala.html#32000" title="(sb: StringBuilder)StringBuilder">buildString</a>(<a href="#47699" title="StringBuilder">sb</a>)
        <a href="#47690" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21103" title="=&gt; scala.xml.NamespaceBinding">scope</a>.<a href="NamespaceBinding.scala.html#32474" title="(sb: StringBuilder,stop: scala.xml.NamespaceBinding)Unit">buildString</a>(<a href="#47699" title="StringBuilder">sb</a>, <a href="#47698" title="scala.xml.NamespaceBinding">pscope</a>)
        <span title="StringBuilder" class="keyword">if</span> (<a href="#47690" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21109" title="=&gt; Seq[scala.xml.Node]">child</a>.<a href="../collection/generic/IterableTemplate.scala.html#17397" title="(x$1: Boolean)Boolean">isEmpty</a> &amp;&amp; <a href="#47703" title="Boolean">minimizeTags</a>)
          // no children, so use short form: &lt;xyz .../&gt;
          <a href="#47699" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23477" title="(s: String)StringBuilder">append</a>(<span title="java.lang.String(&quot; /&gt;&quot;)" class="string">&quot; /&gt;&quot;</span>)
        <span class="keyword">else</span> {
          // children, so use long form: &lt;xyz ...&gt;...&lt;/xyz&gt;
          <a href="#47699" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
          <a href="#26696" title="(children: Seq[scala.xml.Node],pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean)Unit">sequenceToXML</a>(<a href="#47690" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21109" title="=&gt; Seq[scala.xml.Node]">child</a>, <a href="#47690" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21103" title="=&gt; scala.xml.NamespaceBinding">scope</a>, <a href="#47699" title="StringBuilder">sb</a>, <a href="#47700" title="Boolean">stripComments</a>)
          <a href="#47699" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23477" title="(s: String)StringBuilder">append</a>(<span title="java.lang.String(&quot;&lt;/&quot;)" class="string">&quot;&lt;/&quot;</span>)
          <a href="#47690" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21118" title="(sb: StringBuilder)StringBuilder">nameToString</a>(<a href="#47699" title="StringBuilder">sb</a>)
          <a href="#47699" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
        }
    }
  }

  <span class="keyword">def</span> <a title="(children: Seq[scala.xml.Node],pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean)Unit" id="26696">sequenceToXML</a>(
    <a title="Seq[scala.xml.Node]" id="116368">children</a>: <a href="../collection/Sequence.scala.html#4376" title="Seq[scala.xml.Node]">Seq</a>[Node],
    <a title="scala.xml.NamespaceBinding" id="116373">pscope</a>: <a href="NamespaceBinding.scala.html#8828" title="scala.xml.NamespaceBinding">NamespaceBinding</a> = <a href="TopScope.scala.html#8631" title="object scala.xml.TopScope">TopScope</a>,
    <a title="StringBuilder" id="116374">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a> = <a href="../collection/mutable/StringBuilder.scala.html#23455" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14896" title="StringBuilder">StringBuilder</a>,
    <a title="Boolean" id="116375">stripComments</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>): <a title="Unit" id="1963">Unit</a> =
  {
    <span title="Unit" class="keyword">if</span> (<a href="#116368" title="Seq[scala.xml.Node]">children</a>.<a href="../collection/generic/IterableTemplate.scala.html#17397" title="=&gt; Boolean">isEmpty</a>) <span title="Nothing" class="keyword">return</span>
    <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> (<a href="../collection/generic/TraversableTemplate.scala.html#17290" title="(p: (scala.xml.Node) =&gt; Boolean)Boolean">children</a> forall <a href="#26681" title="(x: scala.xml.Node)Boolean">isAtomAndNotText</a>) { // add space
      <span class="keyword">val</span> <a title="Iterator[scala.xml.Node]" id="238262">it</a> = <a href="#116368" title="Seq[scala.xml.Node]">children</a>.<a href="../collection/generic/IterableTemplate.scala.html#17392" title="=&gt; Iterator[scala.xml.Node]">iterator</a>
      <span class="keyword">val</span> <a title="scala.xml.Node" id="238263">f</a> = <a href="#238262" title="Iterator[scala.xml.Node]">it</a>.<a href="../collection/Iterator.scala.html#19292" title="()scala.xml.Node">next</a>
      <a href="#26695" title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder">toXML</a>(<a href="#238263" title="scala.xml.Node">f</a>, <a href="#116373" title="scala.xml.NamespaceBinding">pscope</a>, <a href="#116374" title="StringBuilder">sb</a>)
      <span title="Unit" class="keyword">while</span> (<a href="#238262" title="Iterator[scala.xml.Node]">it</a>.<a href="../collection/Iterator.scala.html#19291" title="=&gt; Boolean">hasNext</a>) <a href="#238268" title="()Unit">{</a>
        <span class="keyword">val</span> <a title="scala.xml.Node" id="238269">x</a> = <a href="#238262" title="Iterator[scala.xml.Node]">it</a>.<a href="../collection/Iterator.scala.html#19292" title="()scala.xml.Node">next</a>
        <a href="#116374" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<span title="Char(' ')" class="char">' '</span>)
        <a href="#26695" title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder">toXML</a>(<a href="#238269" title="scala.xml.Node">x</a>, <a href="#116373" title="scala.xml.NamespaceBinding">pscope</a>, <a href="#116374" title="StringBuilder">sb</a>)
      }
    }
    <span class="keyword">else</span> <a href="../collection/generic/IterableTemplate.scala.html#17394" title="(f: (scala.xml.Node) =&gt; StringBuilder)Unit">children</a> foreach { <a href="#26695" title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder">toXML</a>(<a href="#238292" title="scala.xml.Node">_</a>, <a href="#116373" title="scala.xml.NamespaceBinding">pscope</a>, <a href="#116374" title="StringBuilder">sb</a>) }
  }

  /**
   * Returns prefix of qualified name if any.
   *
   * @param name ...
   * @return     ... 
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(name: String)Option[String]" id="26697">prefix</a>(<a title="String" id="146040">name</a>: <span title="String">String</span>): <a href="../Option.scala.html#789" title="Option[String]">Option</a>[String] = (<a href="#146040" title="(x$1: Int)Int" id="7030">name</a> indexOf <span title="Int(58)" class="char">':'</span>) <span title="Option[String]" class="keyword">match</span> {
    <span title="None.type" class="keyword">case</span> <span title="Int(-1)">-</span><span class="int">1</span>   =&gt; <a href="../Option.scala.html#472" title="object None">None</a>
    <span title="Some[java.lang.String]" class="keyword">case</span> <a title="Int" id="238314">i</a>    =&gt; <a href="../Option.scala.html#19907" title="(x: java.lang.String)Some[java.lang.String]">Some</a>(<a href="#146040" title="String">name</a>.<a title="(x$1: Int,x$2: Int)java.lang.String" id="7068">substring</a>(<span title="Int(0)" class="int">0</span>, <a href="#238314" title="Int">i</a>))
  }

  /**
   * Returns a hashcode for the given constituents of a node
   *
   * @param uri
   * @param label
   * @param attribHashCode
   * @param children
   */
  <span class="keyword">def</span> <a title="(pre: String,label: String,attribHashCode: Int,scpeHash: Int,children: Seq[scala.xml.Node])Int" id="26698">hashCode</a>(<a title="String" id="175514">pre</a>: <span title="String">String</span>, <a title="String" id="175515">label</a>: <span title="String">String</span>, <a title="Int" id="175516">attribHashCode</a>: <span title="Int">Int</span>, <a title="Int" id="175517">scpeHash</a>: <span title="Int">Int</span>, <a title="Seq[scala.xml.Node]" id="175518">children</a>: <a href="../collection/Sequence.scala.html#4376" title="Seq[scala.xml.Node]">Seq</a>[Node]) = (
    <span title="(x$1: Int)Int">(</span> <span title="Int" class="keyword">if</span>(<a href="#175514" title="(x$1: AnyRef)Boolean">pre</a> ne <span title="Null(null)" class="keyword">null</span>) {<span title="(x$1: Int)Int" class="int">41</span> <a title="(x$1: Int)Int" id="2985">*</a> <a href="#175514" title="String">pre</a>.<span title="()Int">hashCode</span>() % <span title="Int(7)" class="int">7</span>} <span class="keyword">else</span> {<span title="Int(0)" class="int">0</span>})
    <span title="(x$1: Int)Int">+</span> <a href="#175515" title="String">label</a>.<span title="()Int">hashCode</span><span title="(x$1: Int)Int">(</span>) * <span title="Int(53)" class="int">53</span>
    <span title="(x$1: Int)Int">+</span> <a href="#175516" title="(x$1: Int)Int">attribHashCode</a> * <span title="Int(7)" class="int">7</span>
    <span title="(x$1: Int)Int">+</span> <a href="#175517" title="(x$1: Int)Int">scpeHash</a> * <span title="Int(31)" class="int">31</span>
    + {
      <span class="keyword">var</span> <a title="Int" id="175579">c</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">val</span> <a title="Iterator[scala.xml.Node]" id="175580">i</a> = <a href="#175518" title="Seq[scala.xml.Node]">children</a>.<a href="../collection/generic/IterableTemplate.scala.html#17392" title="=&gt; Iterator[scala.xml.Node]">iterator</a>
      <span title="Unit" class="keyword">while</span>(<a href="#175580" title="Iterator[scala.xml.Node]">i</a>.<a href="../collection/Iterator.scala.html#19291" title="=&gt; Boolean">hasNext</a>) <a href="#175579" title="Int">c</a> = <a href="#175579" title="(x$1: Int)Int">c</a> <span title="(x$1: Int)Int">*</span> <span title="Int(41)" class="int">41</span> + <a href="#175580" title="Iterator[scala.xml.Node]">i</a>.<a href="../collection/Iterator.scala.html#19292" title="()scala.xml.Node">next</a>.<a href="Node.scala.html#21114" title="()Int">hashCode</a>
      <a href="#175579" title="Int">c</a>
    }
  )

  <span class="keyword">def</span> <a title="(s: String)String" id="26699">appendQuoted</a>(<a title="String" id="28089">s</a>: <span title="String">String</span>): <span title="String">String</span> = <a href="#26680" title="(f: (StringBuilder) =&gt; Unit)String">sbToString</a>(<a href="#26700" title="(s: String,sb: StringBuilder)StringBuilder">appendQuoted</a><span title="Unit">(</span><a href="#28089" title="String">s</a>, <a href="#238329" title="StringBuilder">_</a>))

  /**
   * Appends &amp;quot;s&amp;quot; if string &lt;code&gt;s&lt;/code&gt; does not contain &amp;quot;,
   * &amp;apos;s&amp;apos; otherwise.
   *
   * @param s  ...
   * @param sb ...
   * @return   ...
   */
  <span class="keyword">def</span> <a title="(s: String,sb: StringBuilder)StringBuilder" id="26700">appendQuoted</a>(<a title="String" id="28032">s</a>: <span title="String">String</span>, <a title="StringBuilder" id="28033">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a>) = {
    <span class="keyword">val</span> <a title="Char" id="28036">ch</a> = <span title="Char" class="keyword">if</span> (<a href="../collection/generic/SequenceTemplate.scala.html#17493" title="(elem: Any)Boolean">s</a> contains <span title="Char('&quot;')" class="char">'&quot;'</span>) <span title="Char(''')" class="char">'\''</span> <span class="keyword">else</span> <span title="Char('&quot;')" class="char">'&quot;'</span>
    <a href="#28033" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<a href="#28036" title="Char">ch</a>).<a href="../collection/mutable/StringBuilder.scala.html#23477" title="(s: String)StringBuilder">append</a>(<a href="#28032" title="String">s</a>).<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<a href="#28036" title="Char">ch</a>)
  }

  /**
   * Appends &amp;quot;s&amp;quot; and escapes and &amp;quot; i s with \&amp;quot;
   *
   * @param s  ...
   * @param sb ...
   * @return   ...
   */
  <span class="keyword">def</span> <a title="(s: String,sb: StringBuilder)StringBuilder" id="26701">appendEscapedQuoted</a>(<a title="String" id="28438">s</a>: <span title="String">String</span>, <a title="StringBuilder" id="28439">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a>): <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a> = {
    <a href="#28439" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<span title="Char('&quot;')" class="char">'&quot;'</span>)
    <span class="keyword">for</span> (<a title="Char" id="238405">c</a> &lt;- <a href="../collection/generic/VectorTemplate.scala.html#17859" title="(f: (Char) =&gt; StringBuilder)Unit">s</a>) <a href="#238405" title="Char">c</a> <span title="StringBuilder" class="keyword">match</span> {
      <span title="StringBuilder" class="keyword">case</span> <span title="Char('&quot;')" class="char">'&quot;'</span> =&gt; <a href="#28439" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<span title="Char('\')" class="char">'\\'</span>); <a href="#28439" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<span title="Char('&quot;')" class="char">'&quot;'</span>)
      <span title="StringBuilder" class="keyword">case</span> _   =&gt; <a href="#28439" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<a href="#238405" title="Char">c</a>)
    }
    <a href="#28439" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<span title="Char('&quot;')" class="char">'&quot;'</span>)
  }

  /**
   * @param s     ...
   * @param index ...
   * @return      ...
   */
  <span class="keyword">def</span> <a title="(s: String,index: Int)String" id="26702">getName</a>(<a title="String" id="238433">s</a>: <span title="String">String</span>, <a title="Int" id="238434">index</a>: <span title="Int">Int</span>): <span title="String">String</span> = {
    <span title="String" class="keyword">if</span> (<a href="#238434" title="(x$1: Int)Boolean">index</a> &gt;= <a href="#238433" title="String">s</a>.<span title="()Int">length</span>) <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span> (<a href="../collection/generic/VectorTemplate.scala.html#17901" title="(n: Int)scala.runtime.RichString">s</a> drop <a href="#238434" title="Int">index</a>) <span title="String" class="keyword">match</span> {
      <span title="String" class="keyword">case</span> <a href="../collection/generic/SequenceFactory.scala.html#17626" title="(x: Sequence[Char])Some[Sequence[Char]]">Seq</a>(<a title="Char" id="238472">x</a>, <a title="Sequence[Char]" id="238473">xs</a> @ _*) <span class="keyword">if</span> <a href="parsing/TokenTests.scala.html#26710" title="(ch: Char)Boolean">isNameStart</a>(<a href="#238472" title="Char">x</a>)  =&gt; (<a href="../Array.scala.html#29331" title="(xs: Char*)Array[Char]">Array</a><a href="../collection/generic/TraversableTemplate.scala.html#17258" title="(that: Traversable[Char])(implicit bf: scala.collection.generic.BuilderFactory[Char,Array[Char],Array[Char]])Array[Char]">(</a><a href="#238472" title="Char">x</a>) <a href="../Array.scala.html#29314" title="scala.collection.generic.BuilderFactory[Char,Array[Char],Array[_]]">++</a> (<a href="../collection/generic/TraversableTemplate.scala.html#17327" title="(p: (Char) =&gt; Boolean)Sequence[Char]">xs</a> takeWhile <a href="parsing/TokenTests.scala.html#26709" title="(ch: Char)Boolean">isNameChar</a>)).<a href="../collection/generic/TraversableTemplate.scala.html#17355" title="=&gt; String">mkString</a>
      <span title="java.lang.String(&quot;&quot;)" class="keyword">case</span> _                                  =&gt; <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
    }
  }

  /**
   * Returns &lt;code&gt;null&lt;/code&gt; if the value is a correct attribute value,
   * error message if it isn't.
   *
   * @param value ...
   * @return      ... 
   */
  <span class="keyword">def</span> <a title="(value: String)String" id="26703">checkAttributeValue</a>(<a title="String" id="238655">value</a>: <span title="String">String</span>): <span title="String">String</span> = {
    <span class="keyword">var</span> <a title="Int" id="238657">i</a> = <span title="Int(0)" class="int">0</span>
    <span title="Unit" class="keyword">while</span> (<a href="#238657" title="(x$1: Int)Boolean" id="2969">i</a> &lt; <a href="#238655" title="String">value</a>.<span title="()Int">length</span>) <a href="#238658" title="()Unit">{</a>
      <a href="#238655" title="String">value</a>.<span title="(x$1: Int)Char">charAt</span>(<a href="#238657" title="Int">i</a>) <span title="Unit" class="keyword">match</span> {
        <span title="Nothing" class="keyword">case</span> <span title="Char('&lt;')" class="char">'&lt;'</span> =&gt; 
          <span title="Nothing" class="keyword">return</span> <span title="java.lang.String(&quot;&lt; not allowed in attribute value&quot;)" class="string">&quot;&lt; not allowed in attribute value&quot;</span>;
        <span title="Unit" class="keyword">case</span> <span title="Char('&amp;')" class="char">'&amp;'</span> =&gt; 
          <span class="keyword">val</span> <a title="String" id="238669">n</a> = <a href="#26702" title="(s: String,index: Int)String">getName</a>(<a href="#238655" title="String">value</a>, <a href="#238657" title="(x$1: Int)Int">i</a>+<span title="Int(1)" class="int">1</span>)
          <span title="Unit" class="keyword">if</span> (<a href="#238669" title="(x$1: AnyRef)Boolean">n</a> eq <span title="Null(null)" class="keyword">null</span>)
            <span title="Nothing" class="keyword">return</span> <span title="(x$1: Any)java.lang.String" class="string">&quot;malformed entity reference in attribute value [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#238655" title="String">value</a>+<span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>;
          <a href="#238657" title="Int">i</a> = <a href="#238657" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">+</span> <a href="#238669" title="String">n</a>.<span title="()Int">length</span> + <span title="Int(1)" class="int">1</span>
          <span title="Unit" class="keyword">if</span> (<a href="#238657" title="(x$1: Int)Boolean">i</a> <span title="(x$1: Boolean)Boolean">&gt;=</span> <a href="#238655" title="String">value</a>.<span title="()Int">length</span> || <a href="#238655" title="String">value</a>.<span title="(x$1: Int)Char">charAt</span><span title="(x$1: Char)Boolean">(</span><a href="#238657" title="Int">i</a>) != <span title="Char(';')" class="char">';'</span>)
            <span title="Nothing" class="keyword">return</span> <span title="(x$1: Any)java.lang.String" class="string">&quot;malformed entity reference in attribute value [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#238655" title="String">value</a>+<span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>;
        <span title="Unit" class="keyword">case</span> _   =&gt;
      }
      <a href="#238657" title="Int">i</a> = <a href="#238657" title="(x$1: Int)Int">i</a> + <span title="Int(1)" class="int">1</span>
    }
    <span title="Null(null)" class="keyword">null</span>
  }

  /**
   * new
   *
   * @param value ...
   * @return      ...
   */
  <span class="keyword">def</span> <a title="(value: String)Seq[scala.xml.Node]" id="26704">parseAttributeValue</a>(<a title="String" id="238777">value</a>: <span title="String">String</span>): <a href="../collection/Sequence.scala.html#4376" title="Seq[scala.xml.Node]">Seq</a>[Node] = {
    <span class="keyword">val</span> <a title="Seq[Char]" id="238779">zs</a>: <a href="../collection/Sequence.scala.html#4376" title="Seq[Char]">Seq</a>[Char] = <a href="../Predef.scala.html#16471" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">value</a>
    <span class="keyword">val</span> <a title="StringBuilder" id="238780">sb</a>  = <a href="../collection/mutable/StringBuilder.scala.html#23455" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14896" title="StringBuilder">StringBuilder</a>
    <span class="keyword">var</span> <a title="StringBuilder" id="238781">rfb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7884" title="StringBuilder">StringBuilder</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">val</span> <a title="scala.xml.NodeBuffer" id="238782">nb</a> = <span title="scala.xml.NodeBuffer" class="keyword">new</span> <a href="NodeBuffer.scala.html#8765" title="scala.xml.NodeBuffer">NodeBuffer</a>()
    <span class="keyword">val</span> <a title="Iterator[Char]" id="238783">it</a> = <a href="#238779" title="Seq[Char]">zs</a>.<a href="../collection/generic/IterableTemplate.scala.html#17392" title="=&gt; Iterator[Char]">iterator</a>
    <span title="Unit" class="keyword">while</span> (<a href="#238783" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19291" title="=&gt; Boolean">hasNext</a>) <a href="#238784" title="()Unit">{</a>
      <span class="keyword">var</span> <a title="Char" id="238806">c</a> = <a href="#238783" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19292" title="()Char">next</a>
      <a href="#238806" title="Char">c</a> <span title="Any" class="keyword">match</span> {
        <span title="Any" class="keyword">case</span> <span title="Char('&amp;')" class="char">'&amp;'</span> =&gt; // entity! flush buffer into text node
          <a href="#238783" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19292" title="()Char">next</a> <span title="Any" class="keyword">match</span> {
            <span title="StringBuilder" class="keyword">case</span> <span title="Char('#')" class="char">'#'</span> =&gt;
              <a href="#238806" title="Char">c</a> = <a href="#238783" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19292" title="()Char">next</a>
              <span class="keyword">val</span> <a title="String" id="238811">theChar</a> = <a href="#26705" title="(ch: () =&gt; Char,nextch: () =&gt; Unit,reportSyntaxError: (String) =&gt; Unit)String">parseCharRef</a> ({ ()=&gt; <a href="#238806" title="Char">c</a> },{ () =&gt; <a href="#238806" title="Char">c</a> = <a href="#238783" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19292" title="()Char">next</a> },{<a title="String" id="238819">s</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a title="(x$1: java.lang.String)java.lang.RuntimeException" id="19777" class="keyword">new</a> <a href="../Predef.scala.html#16268" title="java.lang.RuntimeException">RuntimeException</a>(<a href="#238819" title="String">s</a>)})
              <a href="#238780" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23477" title="(s: String)StringBuilder">append</a>(<a href="#238811" title="String">theChar</a>)

            <span title="Any" class="keyword">case</span> <a title="Char" id="238834">x</a> =&gt;
              <span title="Unit" class="keyword">if</span> (<a href="#238781" title="(x$1: AnyRef)Boolean">rfb</a> eq <span title="Null(null)" class="keyword">null</span>) <a href="#238781" title="StringBuilder">rfb</a> = <a href="../collection/mutable/StringBuilder.scala.html#23455" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14896" title="StringBuilder">StringBuilder</a>()
              <a href="#238781" title="StringBuilder">rfb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<a href="#238834" title="Char">x</a>)
              <a href="#238806" title="Char">c</a> = <a href="#238783" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19292" title="()Char">next</a>
              <span title="Unit" class="keyword">while</span> (<a href="#238806" title="(x$1: Char)Boolean">c</a> != <span title="Char(';')" class="char">';'</span>) <a href="#238836" title="()Unit">{</a>
                <a href="#238781" title="StringBuilder">rfb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<a href="#238806" title="Char">c</a>)
                <a href="#238806" title="Char">c</a> = <a href="#238783" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19292" title="()Char">next</a>
              }
              <span class="keyword">val</span> <a title="String" id="238835">ref</a> = <a href="#238781" title="StringBuilder">rfb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23516" title="()String">toString</a>() 
              <a href="#238781" title="StringBuilder">rfb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23462" title="(n: Int)Unit">setLength</a>(<span title="Int(0)" class="int">0</span>)
              <a href="#26692" title="(ref: String,s: StringBuilder)StringBuilder">unescape</a>(<a href="#238835" title="String">ref</a>,<a href="#238780" title="StringBuilder">sb</a>) <span title="Any" class="keyword">match</span> {
                <span title="nb.type" class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> =&gt; 
                  <span title="Unit" class="keyword">if</span> (<a href="#238780" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23459" title="(x$1: Int)Boolean">length</a> &gt; <span title="Int(0)" class="int">0</span>) {          // flush buffer
                    <a href="../collection/mutable/ArrayBuffer.scala.html#20024" title="(elem: scala.xml.Node)nb.type">nb</a> += <a href="Text.scala.html#26791" title="(_data: String)scala.xml.Text">Text</a>(<a href="#238780" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23516" title="()String">toString</a>())
                    <a href="#238780" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23462" title="(n: Int)Unit">setLength</a>(<span title="Int(0)" class="int">0</span>)
                  }
                  <a href="../collection/mutable/ArrayBuffer.scala.html#20024" title="(elem: scala.xml.Node)nb.type">nb</a> += <a href="EntityRef.scala.html#50473" title="(entityName: String)scala.xml.EntityRef">EntityRef</a>(<a href="#238780" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23516" title="()String">toString</a>()) // add entityref
                <span title="Unit" class="keyword">case</span> _ =&gt;
              }
          }
        <span title="StringBuilder" class="keyword">case</span> <a title="Char" id="238975">x</a>   =&gt; 
          <a href="#238780" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23487" title="(x: Char)StringBuilder">append</a>(<a href="#238975" title="Char">x</a>)
      }
    } 
    <span title="Any" class="keyword">if</span> (<a href="#238780" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23459" title="(x$1: Int)Boolean">length</a> &gt; <span title="Int(0)" class="int">0</span>) { // flush buffer
      <span class="keyword">val</span> <a title="scala.xml.Text" id="238990">x</a> = <a href="Text.scala.html#26791" title="(_data: String)scala.xml.Text">Text</a>(<a href="#238780" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23516" title="()String">toString</a>())
      <span title="nb.type" class="keyword">if</span> (<a href="#238782" title="scala.xml.NodeBuffer">nb</a>.<a href="../collection/mutable/ResizableArray.scala.html#20105" title="(x$1: Int)Boolean" id="2965">length</a> == <span title="Int(0)" class="int">0</span>)
        <span title="Nothing" class="keyword">return</span> <a href="#238990" title="scala.xml.Text">x</a>
      <span class="keyword">else</span>
        <a href="../collection/mutable/ArrayBuffer.scala.html#20024" title="(elem: scala.xml.Node)nb.type">nb</a> += <a href="#238990" title="scala.xml.Text">x</a>
    }
    <a href="#238782" title="scala.xml.NodeBuffer">nb</a> 
  }

  /**
   * &lt;pre&gt;
   *   CharRef ::= &quot;&amp;amp;#&quot; '0'..'9' {'0'..'9'} &quot;;&quot;
   *             | &quot;&amp;amp;#x&quot; '0'..'9'|'A'..'F'|'a'..'f' { hexdigit } &quot;;&quot;
   * &lt;/pre&gt;
   * &lt;p&gt;
   *   see [66]
   * &lt;p&gt;
   *
   * @param ch                ...
   * @param nextch            ...
   * @param reportSyntaxError ...
   * @return                  ...
   */
  <span class="keyword">def</span> <a title="(ch: () =&gt; Char,nextch: () =&gt; Unit,reportSyntaxError: (String) =&gt; Unit)String" id="26705">parseCharRef</a>(<a title="() =&gt; Char" id="146424">ch</a>: () =&gt; Char, <a title="() =&gt; Unit" id="146425">nextch</a>: () =&gt; Unit, <a title="(String) =&gt; Unit" id="146426">reportSyntaxError</a>: String =&gt; Unit): <span title="String">String</span> = {
    <span class="keyword">val</span> <a title="Boolean" id="239043">hex</a>  = <span title="(x$1: Boolean)Boolean">(</span><a href="../Function0.scala.html#34209" title="()Char">ch</a><a title="(x$1: Char)Boolean" id="2729">(</a>) == <span title="Char('x')" class="char">'x'</span>) &amp;&amp; { <a href="../Function0.scala.html#34209" title="()Unit">nextch</a>(); <span title="Boolean(true)" class="keyword">true</span> }
    <span class="keyword">val</span> <a title="Int" id="239044">base</a> = <span title="Int" class="keyword">if</span> (<a href="#239043" title="Boolean">hex</a>) <span title="Int(16)" class="int">16</span> <span class="keyword">else</span> <span title="Int(10)" class="int">10</span>
    <span class="keyword">var</span> <a title="Int" id="239045">i</a> = <span title="Int(0)" class="int">0</span>
    <span title="Unit" class="keyword">while</span> (<a href="../Function0.scala.html#34209" title="()Char">ch</a><span title="(x$1: Char)Boolean">(</span>) != <span title="Char(';')" class="char">';'</span>) <a href="#239046" title="()Unit">{</a>
      <a href="../Function0.scala.html#34209" title="()Char">ch</a>() <span title="Unit" class="keyword">match</span> {
        <span title="Unit" class="keyword">case</span> <span title="Char('0')" class="char">'0'</span> | <span title="Char('1')" class="char">'1'</span> | <span title="Char('2')" class="char">'2'</span> | <span title="Char('3')" class="char">'3'</span> | <span title="Char('4')" class="char">'4'</span> | <span title="Char('5')" class="char">'5'</span> | <span title="Char('6')" class="char">'6'</span> | <span title="Char('7')" class="char">'7'</span> | <span title="Char('8')" class="char">'8'</span> | <span title="Char('9')" class="char">'9'</span> =&gt;
          <a href="#239045" title="Int">i</a> = <a href="#239045" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">*</span> <a href="#239044" title="Int">base</a> + <a href="../Function0.scala.html#34209" title="()Char">ch</a><a href="../Predef.scala.html#16466" title="implicit scala.Predef.charWrapper : (c: Char)scala.runtime.RichChar">(</a>).<a href="../runtime/RichChar.scala.html#19143" title="=&gt; Int">asDigit</a>
        <span title="Unit" class="keyword">case</span> <span title="Char('a')" class="char">'a'</span> | <span title="Char('b')" class="char">'b'</span> | <span title="Char('c')" class="char">'c'</span> | <span title="Char('d')" class="char">'d'</span> | <span title="Char('e')" class="char">'e'</span> | <span title="Char('f')" class="char">'f'</span>
           | <span title="Char('A')" class="char">'A'</span> | <span title="Char('B')" class="char">'B'</span> | <span title="Char('C')" class="char">'C'</span> | <span title="Char('D')" class="char">'D'</span> | <span title="Char('E')" class="char">'E'</span> | <span title="Char('F')" class="char">'F'</span> =&gt;
          <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span> <a href="#239043" title="Boolean">hex</a>) 
            <a href="../Function1.scala.html#17226" title="(v1: String)Unit">reportSyntaxError</a>(<span class="string">&quot;hex char not allowed in decimal char ref\n&quot;</span> <span title="java.lang.String(&quot;hex char not allowed in decimal char ref\012Did you mean to write &amp;#x ?&quot;)">+</span>
                              <span class="string">&quot;Did you mean to write &amp;#x ?&quot;</span>)
          <span class="keyword">else</span>
            <a href="#239045" title="Int">i</a> = <a href="#239045" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">*</span> <a href="#239044" title="Int">base</a> + <a href="../Function0.scala.html#34209" title="()Char">ch</a><a href="../Predef.scala.html#16466" title="implicit scala.Predef.charWrapper : (c: Char)scala.runtime.RichChar">(</a>).<a href="../runtime/RichChar.scala.html#19143" title="=&gt; Int">asDigit</a>
        <span title="Unit" class="keyword">case</span> _ =&gt;
          <a href="../Function1.scala.html#17226" title="(v1: String)Unit">reportSyntaxError</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;character '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../Function0.scala.html#34209" title="()Char">ch</a>() + <span title="java.lang.String(&quot;' not allowed in char ref\012&quot;)" class="string">&quot;' not allowed in char ref\n&quot;</span>)
      }
      <a href="../Function0.scala.html#34209" title="()Unit">nextch</a>()
    }
    <a title="(x$1: Array[Byte],x$2: java.lang.String)java.lang.String" id="6947" class="keyword">new</a> <a href="../Predef.scala.html#16261" title="java.lang.String">String</a>(io.<a href="../io/UTF8Codec.scala.html#9748" title="object scala.io.UTF8Codec">UTF8Codec</a>.<a href="../io/UTF8Codec.scala.html#142290" title="(ch1: Int)Array[Byte]">encode</a>(<a href="#239045" title="Int">i</a>), <span title="java.lang.String(&quot;utf8&quot;)" class="string">&quot;utf8&quot;</span>)
  }

}

        </pre>
    </body>
</html>