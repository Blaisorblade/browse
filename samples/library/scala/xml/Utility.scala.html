<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/xml/Utility.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

// $Id: Utility.scala 18210 2009-07-05 14:46:37Z extempore $


<span class="keyword">package</span> scala.xml

<span class="keyword">import</span> collection.mutable.{Set, HashSet}
<span class="keyword">import</span> parsing.XhtmlEntities

/**
 * The &lt;code&gt;Utility&lt;/code&gt; object provides utility functions for processing
 * instances of bound and not bound XML classes, as well as escaping text nodes.
 *
 * @author Burak Emir
 */
<span class="keyword">object</span> <a title="object scala.xml.Utility" id="8724">Utility</a> <a href="../ScalaObject.scala.html#957" title="ScalaObject" class="keyword">extends</a> <a title="java.lang.Object" id="3623">AnyRef</a> <span class="keyword">with</span> parsing.<a href="parsing/TokenTests.scala.html#12152" title="scala.xml.parsing.TokenTests">TokenTests</a> 
{
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scala.xml.Utility.implicitSbToString : (sb: StringBuilder)String" id="26572">implicitSbToString</a>(<a title="StringBuilder" id="27931">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a>) = <a href="#27931" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23409" title="()String">toString</a>()
  
  // helper for the extremely oft-repeated sequence of creating a
  // StringBuilder, passing it around, and then grabbing its String.
  <span class="keyword">private</span> [xml] <span class="keyword">def</span> <a title="(f: (StringBuilder) =&gt; Unit)String" id="26573">sbToString</a>(<a title="(StringBuilder) =&gt; Unit" id="27075">f</a>: (StringBuilder) =&gt; Unit): <span title="String">String</span> = {
    <span class="keyword">val</span> <a title="StringBuilder" id="236340">sb</a> = <a href="../collection/mutable/StringBuilder.scala.html#23348" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14791" title="StringBuilder">StringBuilder</a>
    <a href="../Function1.scala.html#17119" title="(v1: StringBuilder)Unit">f</a>(<a href="#236340" title="StringBuilder">sb</a>)
    <a href="#236340" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23409" title="()String">toString</a>
  }
  <span class="keyword">private</span>[xml] <span class="keyword">def</span> <a title="(x: scala.xml.Node)Boolean" id="26574">isAtomAndNotText</a>(<a title="scala.xml.Node" id="133975">x</a>: <a href="Node.scala.html#8654" title="scala.xml.Node">Node</a>) = <a href="#133975" title="scala.xml.Node">x</a>.<a href="Node.scala.html#20993" title="(x$1: Boolean)Boolean">isAtom</a> &amp;&amp; <span title="=&gt; Boolean">!</span><a href="#133975" title="scala.xml.Node">x</a>.<a title="[T0]Boolean" id="3618">isInstanceOf</a><span title="Boolean">[</span><a href="Text.scala.html#8633" title="scala.xml.Text">Text</a>]

  /** trims an element - call this method, when you know that it is an
   *  element (and not a text node) so you know that it will not be trimmed
   *  away. With this assumption, the function can return a &lt;code&gt;Node&lt;/code&gt;,
   *  rather than a &lt;code&gt;Seq[Node]&lt;/code&gt;. If you don't know, call
   *  &lt;code&gt;trimProper&lt;/code&gt; and account for the fact that you may get back
   *  an empty sequence of nodes.
   *
   *  precondition: node is not a text node (it might be trimmed) 
   */
  <span class="keyword">def</span> <a title="(x: scala.xml.Node)scala.xml.Node" id="26575">trim</a>(<a title="scala.xml.Node" id="236361">x</a>: <a href="Node.scala.html#8654" title="scala.xml.Node">Node</a>): <a href="Node.scala.html#8654" title="scala.xml.Node">Node</a> = <a href="#236361" title="scala.xml.Node">x</a> <span title="scala.xml.Node" class="keyword">match</span> {
    <span title="scala.xml.Elem" class="keyword">case</span> <a href="Elem.scala.html#50235" title="(n: scala.xml.Node)Option[(String, String, scala.xml.MetaData, scala.xml.NamespaceBinding, Seq[scala.xml.Node])]">Elem</a>(<a title="String" id="236366">pre</a>, <a title="String" id="236367">lab</a>, <a title="scala.xml.MetaData" id="236368">md</a>, <a title="scala.xml.NamespaceBinding" id="236369">scp</a>, <a title="Sequence[scala.xml.Node]" id="236370">child</a>@_*) =&gt; 
      <a href="Elem.scala.html#50234" title="(prefix: String,label: String,attributes: scala.xml.MetaData,scope: scala.xml.NamespaceBinding,child: scala.xml.Node*)scala.xml.Elem">Elem</a>(<a href="#236366" title="String">pre</a>, <a href="#236367" title="String">lab</a>, <a href="#236368" title="scala.xml.MetaData">md</a>, <a href="#236369" title="scala.xml.NamespaceBinding">scp</a>, (<a href="../collection/generic/TraversableTemplate.scala.html#17166" title="(f: (scala.xml.Node) =&gt; Traversable[scala.xml.Node])(implicit bf: scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence[scala.xml.Node]])Sequence[scala.xml.Node]">child</a> <a href="../collection/Sequence.scala.html#22039" title="scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence#Coll]">flatMap</a> <a href="#26576" title="(x: scala.xml.Node)Seq[scala.xml.Node]">trimProper</a>):_*)
  }

  /** trim a child of an element. &lt;code&gt;Attribute&lt;/code&gt; values and
   *  &lt;code&gt;Atom&lt;/code&gt; nodes that are not &lt;code&gt;Text&lt;/code&gt; nodes are unaffected.
   */
  <span class="keyword">def</span> <a title="(x: scala.xml.Node)Seq[scala.xml.Node]" id="26576">trimProper</a>(<a title="scala.xml.Node" id="236379">x</a>:<a href="Node.scala.html#8654" title="scala.xml.Node">Node</a>): <a href="../collection/Sequence.scala.html#4346" title="Seq[scala.xml.Node]">Seq</a>[Node] = <a href="#236379" title="scala.xml.Node">x</a> <span title="Seq[scala.xml.Node]" class="keyword">match</span> {
    <span title="scala.xml.Elem" class="keyword">case</span> <a href="Elem.scala.html#50235" title="(n: scala.xml.Node)Option[(String, String, scala.xml.MetaData, scala.xml.NamespaceBinding, Seq[scala.xml.Node])]">Elem</a>(<a title="String" id="236411">pre</a>,<a title="String" id="236412">lab</a>,<a title="scala.xml.MetaData" id="236413">md</a>,<a title="scala.xml.NamespaceBinding" id="236414">scp</a>,<a title="Sequence[scala.xml.Node]" id="236415">child</a>@_*) =&gt; 
      <a href="Elem.scala.html#50234" title="(prefix: String,label: String,attributes: scala.xml.MetaData,scope: scala.xml.NamespaceBinding,child: scala.xml.Node*)scala.xml.Elem">Elem</a>(<a href="#236411" title="String">pre</a>,<a href="#236412" title="String">lab</a>,<a href="#236413" title="scala.xml.MetaData">md</a>,<a href="#236414" title="scala.xml.NamespaceBinding">scp</a>, (<a href="../collection/generic/TraversableTemplate.scala.html#17166" title="(f: (scala.xml.Node) =&gt; Traversable[scala.xml.Node])(implicit bf: scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence[scala.xml.Node]])Sequence[scala.xml.Node]">child</a> <a href="../collection/Sequence.scala.html#22039" title="scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence#Coll]">flatMap</a> <a href="#26576" title="(x: scala.xml.Node)Seq[scala.xml.Node]">trimProper</a>):_*)
    <span title="Seq[scala.xml.Text]" class="keyword">case</span> Text(<a title="String" id="236440">s</a>) =&gt; 
      <span title="scala.xml.TextBuffer" class="keyword">new</span> <a href="TextBuffer.scala.html#8681" title="scala.xml.TextBuffer">TextBuffer</a>().<a href="TextBuffer.scala.html#145889" title="(cs: Seq[Char])scala.xml.TextBuffer">append</a>(<a href="../Predef.scala.html#16366" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">s</a>).<a href="TextBuffer.scala.html#145890" title="=&gt; Seq[scala.xml.Text]">toText</a>
    <span title="scala.xml.Node" class="keyword">case</span> _ =&gt; 
      <a href="#236379" title="scala.xml.Node">x</a>
  }
  /** returns a sorted attribute list */
  <span class="keyword">def</span> <a title="(md: scala.xml.MetaData)scala.xml.MetaData" id="26577">sort</a>(<a title="scala.xml.MetaData" id="236454">md</a>: <a href="MetaData.scala.html#8585" title="scala.xml.MetaData">MetaData</a>): <a href="MetaData.scala.html#8585" title="scala.xml.MetaData">MetaData</a> = <span title="scala.xml.MetaData" class="keyword">if</span>(<span title="(x$1: Boolean)Boolean">(</span><a href="#236454" title="(x$1: AnyRef)Boolean">md</a> eq <a href="Null.scala.html#8526" title="object scala.xml.Null">Null</a>) || (<a href="#236454" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31885" title="(x$1: AnyRef)Boolean">next</a> eq <a href="Null.scala.html#8526" title="object scala.xml.Null">Null</a>)) <a href="#236454" title="scala.xml.MetaData">md</a> <span class="keyword">else</span> {
    <span class="keyword">val</span> <a title="String" id="236462">key</a> = <a href="#236454" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31882" title="=&gt; String">key</a>
    <span class="keyword">val</span> <a title="scala.xml.MetaData" id="236463">smaller</a> = <a href="#26577" title="(md: scala.xml.MetaData)scala.xml.MetaData">sort</a>(<a href="#236454" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31881" title="(f: (scala.xml.MetaData) =&gt; Boolean)scala.xml.MetaData">filter</a> { <a title="scala.xml.MetaData" id="236474">m</a> =&gt; <a href="#236474" title="scala.xml.MetaData">m</a>.<a href="../Ordered.scala.html#18107" title="(that: String)Boolean">key</a> &lt; <a href="#236462" title="String">key</a> })
    <span class="keyword">val</span> <a title="scala.xml.MetaData" id="236464">greater</a> = <a href="#26577" title="(md: scala.xml.MetaData)scala.xml.MetaData">sort</a>(<a href="#236454" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31881" title="(f: (scala.xml.MetaData) =&gt; Boolean)scala.xml.MetaData">filter</a> { <a title="scala.xml.MetaData" id="236531">m</a> =&gt; <a href="#236531" title="scala.xml.MetaData">m</a>.<a href="../Ordered.scala.html#18108" title="(that: String)Boolean">key</a> &gt; <a href="#236462" title="String">key</a> })
    <a href="#236463" title="scala.xml.MetaData">smaller</a>.<a href="MetaData.scala.html#31866" title="(updates: scala.xml.MetaData,scope: scala.xml.NamespaceBinding)scala.xml.MetaData">append</a><a title="scala.xml.MetaData" id="236583">(</a> <a href="Null.scala.html#8526" title="object scala.xml.Null">Null</a> ).<a href="MetaData.scala.html#137229" title="scala.xml.NamespaceBinding" id="236588">append</a>(<a href="#236454" title="scala.xml.MetaData">md</a>.<a href="MetaData.scala.html#31871" title="(next: scala.xml.MetaData)scala.xml.MetaData">copy</a> <a title="scala.xml.MetaData" id="236587">(</a> <a href="#236464" title="scala.xml.MetaData">greater</a> ))
  }

  /** returns the node with its attribute list sorted alphabetically (prefixes are ignored) */
  <span class="keyword">def</span> <a title="(n: scala.xml.Node)scala.xml.Node" id="26578">sort</a>(<a title="scala.xml.Node" id="236468">n</a>:<a href="Node.scala.html#8654" title="scala.xml.Node">Node</a>): <a href="Node.scala.html#8654" title="scala.xml.Node">Node</a> = <a href="#236468" title="scala.xml.Node">n</a> <span title="scala.xml.Node" class="keyword">match</span> {
	  <span title="scala.xml.Elem" class="keyword">case</span> <a href="Elem.scala.html#50235" title="(n: scala.xml.Node)Option[(String, String, scala.xml.MetaData, scala.xml.NamespaceBinding, Seq[scala.xml.Node])]">Elem</a>(<a title="String" id="236594">pre</a>,<a title="String" id="236595">lab</a>,<a title="scala.xml.MetaData" id="236596">md</a>,<a title="scala.xml.NamespaceBinding" id="236597">scp</a>,<a title="Sequence[scala.xml.Node]" id="236598">child</a>@_*) =&gt;
		  <a href="Elem.scala.html#50234" title="(prefix: String,label: String,attributes: scala.xml.MetaData,scope: scala.xml.NamespaceBinding,child: scala.xml.Node*)scala.xml.Elem">Elem</a>(<a href="#236594" title="String">pre</a>,<a href="#236595" title="String">lab</a>,<a href="#26577" title="(md: scala.xml.MetaData)scala.xml.MetaData">sort</a>(<a href="#236596" title="scala.xml.MetaData">md</a>),<a href="#236597" title="scala.xml.NamespaceBinding">scp</a>, (<a href="../collection/generic/TraversableTemplate.scala.html#17161" title="(f: (scala.xml.Node) =&gt; scala.xml.Node)(implicit bf: scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence[scala.xml.Node]])Sequence[scala.xml.Node]">child</a> <a href="../collection/Sequence.scala.html#22039" title="scala.collection.generic.BuilderFactory[scala.xml.Node,Sequence[scala.xml.Node],Sequence#Coll]">map</a> <a href="#26578" title="(n: scala.xml.Node)scala.xml.Node">sort</a>):_*)
	  <span title="scala.xml.Node" class="keyword">case</span> _ =&gt; <a href="#236468" title="scala.xml.Node">n</a>
  }

  @deprecated(<span class="string">&quot;a string might also be Atom(s) - define your own conversion&quot;</span>)
  <span class="keyword">def</span> <a title="(s: String)scala.xml.Text" id="26579">view</a>(<a title="String" id="236661">s</a>: <span title="String">String</span>): <a href="Text.scala.html#8633" title="scala.xml.Text">Text</a> = <a href="Text.scala.html#26684" title="(_data: String)scala.xml.Text">Text</a>(<a href="#236661" title="String">s</a>)

  /**
   * Escapes the characters &amp;lt; &amp;gt; &amp;amp; and &amp;quot; from string.
   *
   * @param text ...
   * @return     ...
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(text: String)String" id="26580">escape</a>(<a title="String" id="26621">text</a>: <span title="String">String</span>): <span title="String">String</span> = <a href="#26573" title="(f: (StringBuilder) =&gt; Unit)String">sbToString</a>(<a href="#26584" title="(text: String,s: StringBuilder)StringBuilder">escape</a><span title="Unit">(</span><a href="#26621" title="String">text</a>, <a href="#236670" title="StringBuilder">_</a>))
  
  <span class="keyword">object</span> <a title="object scala.xml.Utility.Escapes" id="26581">Escapes</a> <a href="../ScalaObject.scala.html#957" title="ScalaObject">{</a>
    /** For reasons unclear escape and unescape are a long ways from
        being logical inverses. */
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="List[(java.lang.String, Char)]" id="26614">pairs</a> = <a href="../collection/immutable/List.scala.html#17535" title="(xs: (java.lang.String, Char)*)List[(java.lang.String, Char)]">List</a>(
      <a href="../Predef.scala.html#19103" title="(y: Char)(java.lang.String, Char)" class="string">&quot;lt&quot;</a>    -&gt; <span title="Char('&lt;')" class="char">'&lt;'</span>,
      <a href="../Predef.scala.html#19103" title="(y: Char)(java.lang.String, Char)" class="string">&quot;gt&quot;</a>    -&gt; <span title="Char('&gt;')" class="char">'&gt;'</span>,
      <a href="../Predef.scala.html#19103" title="(y: Char)(java.lang.String, Char)" class="string">&quot;amp&quot;</a>   -&gt; <span title="Char('&amp;')" class="char">'&amp;'</span>,
      <a href="../Predef.scala.html#19103" title="(y: Char)(java.lang.String, Char)" class="string">&quot;quot&quot;</a>  -&gt; <span title="Char('&quot;')" class="char">'&quot;'</span>
      // enigmatic comment explaining why this isn't escaped --
      // is valid xhtml but not html, and IE doesn't know it, says jweb
      // &quot;apos&quot;  -&gt; '\''
    )
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[Char,String]" id="26616">escMap</a>    = <a href="../collection/generic/MapFactory.scala.html#35181" title="(elems: (Char, String)*)scala.collection.immutable.Map[Char,String]">Map</a>((<span class="keyword">for</span> ((<a title="java.lang.String" id="236809">s</a>, <a title="Char" id="236810">c</a>) &lt;- <a href="../collection/generic/TraversableTemplate.scala.html#17161" title="(f: ((java.lang.String, Char)) =&gt; (Char, String))(implicit bf: scala.collection.generic.BuilderFactory[(Char, String),List[(Char, String)],List[(java.lang.String, Char)]])List[(Char, String)]">pairs</a>) <span class="keyword">yield</span> <a href="../Tuple2.scala.html#20670" title="(_1: Char,_2: String)(Char, String)">(</a><a href="#236810" title="Char">c</a>, <a href="../runtime/RichString.scala.html#18060" title="(args: Any*)String" class="string">&quot;&amp;%s;&quot;</a> format <a href="#236809" title="java.lang.String">s</a>)) : _*)
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[java.lang.String,Char]" id="26618">unescMap</a>  = <a href="../collection/generic/MapFactory.scala.html#35181" title="(elems: (java.lang.String, Char)*)scala.collection.immutable.Map[java.lang.String,Char]">Map</a>((<a href="../Predef.scala.html#19103" title="(y: Char)(java.lang.String, Char)" class="string">&quot;apos&quot;</a>  -&gt; <span title="Char(''')" class="char">'\''</span>) <a href="#236930" title="(java.lang.String, Char)">::</a> <a href="../collection/immutable/List.scala.html#17630" title="(x: (java.lang.String, Char))List[(java.lang.String, Char)]">pairs</a> : _*)
  }
  <span class="keyword">import</span> Escapes._
  
  /**
   * Appends escaped string to &lt;code&gt;s&lt;/code&gt;.
   *
   * @param text ...
   * @param s    ...
   * @return     ...
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(text: String,s: StringBuilder)StringBuilder" id="26584">escape</a>(<a title="String" id="26611">text</a>: <span title="String">String</span>, <a title="StringBuilder" id="26612">s</a>: <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a>): <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a> =
    <a href="../Predef.scala.html#16366" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">text</a>.<a href="../collection/generic/VectorTemplate.scala.html#17764" title="(z: StringBuilder)(op: (StringBuilder, Char) =&gt; StringBuilder)StringBuilder">foldLeft</a>(<a href="#26612" title="StringBuilder">s</a>)((<a title="StringBuilder" id="237006">s</a>, <a title="Char" id="237007">c</a>) =&gt; <a href="#26616" title="=&gt; scala.collection.immutable.Map[Char,String]">escMap</a>.<a href="../collection/generic/MapTemplate.scala.html#35273" title="(key: Char)Option[String]">get</a>(<a href="#237007" title="Char">c</a>) <span title="StringBuilder" class="keyword">match</span> {
      <span title="StringBuilder" class="keyword">case</span> Some(<a title="String" id="237012">str</a>)  =&gt; <a href="../collection/mutable/StringBuilder.scala.html#23370" title="(s: String)StringBuilder">s</a> append <a href="#237012" title="String">str</a>
      <span title="StringBuilder" class="keyword">case</span> <a href="../Option.scala.html#463" title="object None">None</a>       =&gt; <a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">s</a> append <a href="#237007" title="Char">c</a>
    })

  /**
   * Appends unescaped string to &lt;code&gt;s&lt;/code&gt;, amp becomes &amp;amp;
   * lt becomes &amp;lt; etc..
   *
   * @param ref ...
   * @param s   ...
   * @return    &lt;code&gt;null&lt;/code&gt; if &lt;code&gt;ref&lt;/code&gt; was not a predefined
   *            entity.
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ref: String,s: StringBuilder)StringBuilder" id="26585">unescape</a>(<a title="String" id="237029">ref</a>: <span title="String">String</span>, <a title="StringBuilder" id="237030">s</a>: <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a>): <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a> =
    <a href="../Option.scala.html#19766" title="(f: (Char) =&gt; StringBuilder)Option[StringBuilder]">(</a><a href="../collection/generic/MapTemplate.scala.html#35273" title="(key: java.lang.String)Option[Char]">unescMap</a> get <a href="#237029" title="String">ref</a>) <a href="../Option.scala.html#19763" title="(default: =&gt; StringBuilder)StringBuilder">map</a> (<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">s</a> append <a href="#237039" title="Char">_</a>) getOrElse <span title="Null(null)" class="keyword">null</span>

  /**
   * Returns a set of all namespaces used in a sequence of nodes 
   * and all their descendants, including the empty namespaces.
   *
   * @param nodes ...
   * @return      ...
   */
  <span class="keyword">def</span> <a title="(nodes: Seq[scala.xml.Node])scala.collection.mutable.Set[String]" id="26586">collectNamespaces</a>(<a title="Seq[scala.xml.Node]" id="237056">nodes</a>: <a href="../collection/Sequence.scala.html#4346" title="Seq[scala.xml.Node]">Seq</a>[Node]): <a href="../collection/mutable/Set.scala.html#7812" title="scala.collection.mutable.Set[String]">Set</a>[String] = 
    <a href="#237056" title="Seq[scala.xml.Node]">nodes</a>.<a href="../collection/generic/TraversableTemplate.scala.html#17187" title="(z: scala.collection.mutable.HashSet[String])(op: (scala.collection.mutable.HashSet[String], scala.xml.Node) =&gt; scala.collection.mutable.HashSet[String])scala.collection.mutable.HashSet[String]">foldLeft</a>(<span title="scala.collection.mutable.HashSet[String]" class="keyword">new</span> <a href="../collection/mutable/HashSet.scala.html#7602" title="scala.collection.mutable.HashSet[String]">HashSet</a>[String]) { (<a title="scala.collection.mutable.HashSet[String]" id="237074">set</a>, <a title="scala.xml.Node" id="237075">x</a>) =&gt; <a href="#26587" title="(n: scala.xml.Node,set: scala.collection.mutable.Set[String])Unit">collectNamespaces</a>(<a href="#237075" title="scala.xml.Node">x</a>, <a href="#237074" title="scala.collection.mutable.HashSet[String]">set</a>) ; <a href="#237074" title="scala.collection.mutable.HashSet[String]">set</a> }

  /**
   * Adds all namespaces in node to set.
   *
   * @param n   ...
   * @param set ...
   */
  <span class="keyword">def</span> <a title="(n: scala.xml.Node,set: scala.collection.mutable.Set[String])Unit" id="26587">collectNamespaces</a>(<a title="scala.xml.Node" id="237079">n</a>: <a href="Node.scala.html#8654" title="scala.xml.Node">Node</a>, <a title="scala.collection.mutable.Set[String]" id="237080">set</a>: <a href="../collection/mutable/Set.scala.html#7812" title="scala.collection.mutable.Set[String]">Set</a>[String]) {
    <span title="Unit" class="keyword">if</span> (<a href="#237079" title="scala.xml.Node">n</a>.<a href="Node.scala.html#20994" title="=&gt; Boolean">doCollectNamespaces</a>) {
      <a href="../collection/generic/MutableSetTemplate.scala.html#37370" title="(elem: String)set.type">set</a> += <a href="#237079" title="scala.xml.Node">n</a>.<a href="Node.scala.html#20997" title="=&gt; String">namespace</a>
      <span class="keyword">for</span> (<a title="scala.xml.MetaData" id="237146">a</a> &lt;- <a href="#237079" title="scala.xml.Node">n</a>.<a href="../collection/generic/IterableTemplate.scala.html#17287" title="(f: (scala.xml.MetaData) =&gt; Any)Unit">attributes</a>) <a href="#237146" title="scala.xml.MetaData">a</a> <span title="Any" class="keyword">match</span> {
        <span title="set.type" class="keyword">case</span> _:<a href="PrefixedAttribute.scala.html#8705" title="scala.xml.PrefixedAttribute">PrefixedAttribute</a> =&gt;
          <a href="../collection/generic/MutableSetTemplate.scala.html#37370" title="(elem: String)set.type">set</a> += <a href="#237146" title="scala.xml.MetaData">a</a>.<a href="MetaData.scala.html#31872" title="(owner: scala.xml.Node)String">getNamespace</a>(<a href="#237079" title="scala.xml.Node">n</a>)
        <span title="Unit" class="keyword">case</span> _ =&gt;
      }
      <span class="keyword">for</span> (<a title="scala.xml.Node" id="237190">i</a> &lt;- <a href="#237079" title="scala.xml.Node">n</a>.<a href="../collection/generic/IterableTemplate.scala.html#17287" title="(f: (scala.xml.Node) =&gt; Unit)Unit">child</a>) 
        <a href="#26587" title="(n: scala.xml.Node,set: scala.collection.mutable.Set[String])Unit">collectNamespaces</a>(<a href="#237190" title="scala.xml.Node">i</a>, <a href="#237080" title="scala.collection.mutable.Set[String]">set</a>)
    }
  }
  
  // def toXML(
  //   x: Node,
  //   pscope: NamespaceBinding = TopScope,
  //   sb: StringBuilder = new StringBuilder,
  //   stripComments: Boolean = false,
  //   decodeEntities: Boolean = true,
  //   preserveWhitespace: Boolean = false,
  //   minimizeTags: Boolean = false): String =
  // {
  //   toXMLsb(x, pscope, sb, stripComments, decodeEntities, preserveWhitespace, minimizeTags)
  //   sb.toString()
  // }

  <span class="keyword">def</span> <a title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder" id="26588">toXML</a>(
    <a title="scala.xml.Node" id="47577">x</a>: <a href="Node.scala.html#8654" title="scala.xml.Node">Node</a>,
    <a title="scala.xml.NamespaceBinding" id="47585">pscope</a>: <a href="NamespaceBinding.scala.html#8759" title="scala.xml.NamespaceBinding">NamespaceBinding</a> = <a href="TopScope.scala.html#8562" title="object scala.xml.TopScope">TopScope</a>,
    <a title="StringBuilder" id="47586">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a> = <a href="../collection/mutable/StringBuilder.scala.html#23348" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14791" title="StringBuilder">StringBuilder</a>,
    <a title="Boolean" id="47587">stripComments</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>,
    <a title="Boolean" id="47588">decodeEntities</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span>,
    <a title="Boolean" id="47589">preserveWhitespace</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>,
    <a title="Boolean" id="47590">minimizeTags</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>): <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a> =
  {
    <a href="#47577" title="scala.xml.Node">x</a> <span title="StringBuilder" class="keyword">match</span> {
      <span title="StringBuilder" class="keyword">case</span> <a title="scala.xml.Comment" id="237215">c</a>: <a href="Comment.scala.html#8408" title="scala.xml.Comment">Comment</a> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#47587" title="Boolean">stripComments</a> =&gt; <a href="Comment.scala.html#50340" title="(sb: StringBuilder)StringBuilder">c</a> buildString <a href="#47586" title="StringBuilder">sb</a>
      <span title="StringBuilder" class="keyword">case</span> <a title="scala.xml.SpecialNode" id="237250">x</a>: <a href="SpecialNode.scala.html#8711" title="scala.xml.SpecialNode">SpecialNode</a>               =&gt; <a href="SpecialNode.scala.html#26457" title="(sb: StringBuilder)StringBuilder">x</a> buildString <a href="#47586" title="StringBuilder">sb</a>
      <span title="StringBuilder" class="keyword">case</span> <a title="scala.xml.Group" id="237259">g</a>: <a href="Group.scala.html#8435" title="scala.xml.Group">Group</a>                     =&gt; <span class="keyword">for</span> (<a title="scala.xml.Node" id="237270">c</a> &lt;- <a href="#237259" title="scala.xml.Group">g</a>.<a href="../collection/generic/IterableTemplate.scala.html#17287" title="(f: (scala.xml.Node) =&gt; StringBuilder)Unit">nodes</a>) <a href="#26588" title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder">toXML</a>(<a href="#237270" title="scala.xml.Node">c</a>, <a href="#47577" title="scala.xml.Node">x</a>.<a href="Node.scala.html#20996" title="=&gt; scala.xml.NamespaceBinding">scope</a>, <a href="#47586" title="StringBuilder">sb</a>) ; <a href="#47586" title="StringBuilder">sb</a> 
      <span title="StringBuilder" class="keyword">case</span> _  =&gt;
        // print tag with namespace declarations
        <a href="#47586" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<span title="Char('&lt;')" class="char">'&lt;'</span>)
        <a href="#47577" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21011" title="(sb: StringBuilder)StringBuilder">nameToString</a>(<a href="#47586" title="StringBuilder">sb</a>)
        <span title="Any" class="keyword">if</span> (<a href="#47577" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21001" title="(x$1: AnyRef)Boolean">attributes</a> ne <span title="Null(null)" class="keyword">null</span>) <a href="#47577" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21001" title="=&gt; scala.xml.MetaData">attributes</a>.<a href="MetaData.scala.html#31893" title="(sb: StringBuilder)StringBuilder">buildString</a>(<a href="#47586" title="StringBuilder">sb</a>)
        <a href="#47577" title="scala.xml.Node">x</a>.<a href="Node.scala.html#20996" title="=&gt; scala.xml.NamespaceBinding">scope</a>.<a href="NamespaceBinding.scala.html#32367" title="(sb: StringBuilder,stop: scala.xml.NamespaceBinding)Unit">buildString</a>(<a href="#47586" title="StringBuilder">sb</a>, <a href="#47585" title="scala.xml.NamespaceBinding">pscope</a>)
        <span title="StringBuilder" class="keyword">if</span> (<a href="#47577" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21002" title="=&gt; Seq[scala.xml.Node]">child</a>.<a href="../collection/generic/IterableTemplate.scala.html#17290" title="(x$1: Boolean)Boolean">isEmpty</a> &amp;&amp; <a href="#47590" title="Boolean">minimizeTags</a>)
          // no children, so use short form: &lt;xyz .../&gt;
          <a href="#47586" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23370" title="(s: String)StringBuilder">append</a>(<span title="java.lang.String(&quot; /&gt;&quot;)" class="string">&quot; /&gt;&quot;</span>)
        <span class="keyword">else</span> {
          // children, so use long form: &lt;xyz ...&gt;...&lt;/xyz&gt;
          <a href="#47586" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
          <a href="#26589" title="(children: Seq[scala.xml.Node],pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean)Unit">sequenceToXML</a>(<a href="#47577" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21002" title="=&gt; Seq[scala.xml.Node]">child</a>, <a href="#47577" title="scala.xml.Node">x</a>.<a href="Node.scala.html#20996" title="=&gt; scala.xml.NamespaceBinding">scope</a>, <a href="#47586" title="StringBuilder">sb</a>, <a href="#47587" title="Boolean">stripComments</a>)
          <a href="#47586" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23370" title="(s: String)StringBuilder">append</a>(<span title="java.lang.String(&quot;&lt;/&quot;)" class="string">&quot;&lt;/&quot;</span>)
          <a href="#47577" title="scala.xml.Node">x</a>.<a href="Node.scala.html#21011" title="(sb: StringBuilder)StringBuilder">nameToString</a>(<a href="#47586" title="StringBuilder">sb</a>)
          <a href="#47586" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<span title="Char('&gt;')" class="char">'&gt;'</span>)
        }
    }
  }

  <span class="keyword">def</span> <a title="(children: Seq[scala.xml.Node],pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean)Unit" id="26589">sequenceToXML</a>(
    <a title="Seq[scala.xml.Node]" id="115700">children</a>: <a href="../collection/Sequence.scala.html#4346" title="Seq[scala.xml.Node]">Seq</a>[Node],
    <a title="scala.xml.NamespaceBinding" id="115705">pscope</a>: <a href="NamespaceBinding.scala.html#8759" title="scala.xml.NamespaceBinding">NamespaceBinding</a> = <a href="TopScope.scala.html#8562" title="object scala.xml.TopScope">TopScope</a>,
    <a title="StringBuilder" id="115706">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a> = <a href="../collection/mutable/StringBuilder.scala.html#23348" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14791" title="StringBuilder">StringBuilder</a>,
    <a title="Boolean" id="115707">stripComments</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>): <a title="Unit" id="1948">Unit</a> =
  {
    <span title="Unit" class="keyword">if</span> (<a href="#115700" title="Seq[scala.xml.Node]">children</a>.<a href="../collection/generic/IterableTemplate.scala.html#17290" title="=&gt; Boolean">isEmpty</a>) <span title="Nothing" class="keyword">return</span>
    <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> (<a href="../collection/generic/TraversableTemplate.scala.html#17183" title="(p: (scala.xml.Node) =&gt; Boolean)Boolean">children</a> forall <a href="#26574" title="(x: scala.xml.Node)Boolean">isAtomAndNotText</a>) { // add space
      <span class="keyword">val</span> <a title="Iterator[scala.xml.Node]" id="237352">it</a> = <a href="#115700" title="Seq[scala.xml.Node]">children</a>.<a href="../collection/generic/IterableTemplate.scala.html#17285" title="=&gt; Iterator[scala.xml.Node]">iterator</a>
      <span class="keyword">val</span> <a title="scala.xml.Node" id="237353">f</a> = <a href="#237352" title="Iterator[scala.xml.Node]">it</a>.<a href="../collection/Iterator.scala.html#19185" title="()scala.xml.Node">next</a>
      <a href="#26588" title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder">toXML</a>(<a href="#237353" title="scala.xml.Node">f</a>, <a href="#115705" title="scala.xml.NamespaceBinding">pscope</a>, <a href="#115706" title="StringBuilder">sb</a>)
      <span title="Unit" class="keyword">while</span> (<a href="#237352" title="Iterator[scala.xml.Node]">it</a>.<a href="../collection/Iterator.scala.html#19184" title="=&gt; Boolean">hasNext</a>) <a href="#237358" title="()Unit">{</a>
        <span class="keyword">val</span> <a title="scala.xml.Node" id="237359">x</a> = <a href="#237352" title="Iterator[scala.xml.Node]">it</a>.<a href="../collection/Iterator.scala.html#19185" title="()scala.xml.Node">next</a>
        <a href="#115706" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<span title="Char(' ')" class="char">' '</span>)
        <a href="#26588" title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder">toXML</a>(<a href="#237359" title="scala.xml.Node">x</a>, <a href="#115705" title="scala.xml.NamespaceBinding">pscope</a>, <a href="#115706" title="StringBuilder">sb</a>)
      }
    }
    <span class="keyword">else</span> <a href="../collection/generic/IterableTemplate.scala.html#17287" title="(f: (scala.xml.Node) =&gt; StringBuilder)Unit">children</a> foreach { <a href="#26588" title="(x: scala.xml.Node,pscope: scala.xml.NamespaceBinding,sb: StringBuilder,stripComments: Boolean,decodeEntities: Boolean,preserveWhitespace: Boolean,minimizeTags: Boolean)StringBuilder">toXML</a>(<a href="#237382" title="scala.xml.Node">_</a>, <a href="#115705" title="scala.xml.NamespaceBinding">pscope</a>, <a href="#115706" title="StringBuilder">sb</a>) }
  }

  /**
   * Returns prefix of qualified name if any.
   *
   * @param name ...
   * @return     ... 
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(name: String)Option[String]" id="26590">prefix</a>(<a title="String" id="145371">name</a>: <span title="String">String</span>): <a href="../Option.scala.html#777" title="Option[String]">Option</a>[String] = (<a href="#145371" title="(x$1: Int)Int" id="6967">name</a> indexOf <span title="Int(58)" class="char">':'</span>) <span title="Option[String]" class="keyword">match</span> {
    <span title="None.type" class="keyword">case</span> <span title="Int(-1)">-</span><span class="int">1</span>   =&gt; <a href="../Option.scala.html#463" title="object None">None</a>
    <span title="Some[java.lang.String]" class="keyword">case</span> <a title="Int" id="237404">i</a>    =&gt; <a href="../Option.scala.html#19800" title="(x: java.lang.String)Some[java.lang.String]">Some</a>(<a href="#145371" title="String">name</a>.<a title="(x$1: Int,x$2: Int)java.lang.String" id="7005">substring</a>(<span title="Int(0)" class="int">0</span>, <a href="#237404" title="Int">i</a>))
  }

  /**
   * Returns a hashcode for the given constituents of a node
   *
   * @param uri
   * @param label
   * @param attribHashCode
   * @param children
   */
  <span class="keyword">def</span> <a title="(pre: String,label: String,attribHashCode: Int,scpeHash: Int,children: Seq[scala.xml.Node])Int" id="26591">hashCode</a>(<a title="String" id="174845">pre</a>: <span title="String">String</span>, <a title="String" id="174846">label</a>: <span title="String">String</span>, <a title="Int" id="174847">attribHashCode</a>: <span title="Int">Int</span>, <a title="Int" id="174848">scpeHash</a>: <span title="Int">Int</span>, <a title="Seq[scala.xml.Node]" id="174849">children</a>: <a href="../collection/Sequence.scala.html#4346" title="Seq[scala.xml.Node]">Seq</a>[Node]) = (
    <span title="(x$1: Int)Int">(</span> <span title="Int" class="keyword">if</span>(<a href="#174845" title="(x$1: AnyRef)Boolean">pre</a> ne <span title="Null(null)" class="keyword">null</span>) {<span title="(x$1: Int)Int" class="int">41</span> <a title="(x$1: Int)Int" id="2970">*</a> <a href="#174845" title="String">pre</a>.<span title="()Int">hashCode</span>() % <span title="Int(7)" class="int">7</span>} <span class="keyword">else</span> {<span title="Int(0)" class="int">0</span>})
    <span title="(x$1: Int)Int">+</span> <a href="#174846" title="String">label</a>.<span title="()Int">hashCode</span><span title="(x$1: Int)Int">(</span>) * <span title="Int(53)" class="int">53</span>
    <span title="(x$1: Int)Int">+</span> <a href="#174847" title="(x$1: Int)Int">attribHashCode</a> * <span title="Int(7)" class="int">7</span>
    <span title="(x$1: Int)Int">+</span> <a href="#174848" title="(x$1: Int)Int">scpeHash</a> * <span title="Int(31)" class="int">31</span>
    + {
      <span class="keyword">var</span> <a title="Int" id="174910">c</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">val</span> <a title="Iterator[scala.xml.Node]" id="174911">i</a> = <a href="#174849" title="Seq[scala.xml.Node]">children</a>.<a href="../collection/generic/IterableTemplate.scala.html#17285" title="=&gt; Iterator[scala.xml.Node]">iterator</a>
      <span title="Unit" class="keyword">while</span>(<a href="#174911" title="Iterator[scala.xml.Node]">i</a>.<a href="../collection/Iterator.scala.html#19184" title="=&gt; Boolean">hasNext</a>) <a href="#174910" title="Int">c</a> = <a href="#174910" title="(x$1: Int)Int">c</a> <span title="(x$1: Int)Int">*</span> <span title="Int(41)" class="int">41</span> + <a href="#174911" title="Iterator[scala.xml.Node]">i</a>.<a href="../collection/Iterator.scala.html#19185" title="()scala.xml.Node">next</a>.<a href="Node.scala.html#21007" title="()Int">hashCode</a>
      <a href="#174910" title="Int">c</a>
    }
  )

  <span class="keyword">def</span> <a title="(s: String)String" id="26592">appendQuoted</a>(<a title="String" id="27982">s</a>: <span title="String">String</span>): <span title="String">String</span> = <a href="#26573" title="(f: (StringBuilder) =&gt; Unit)String">sbToString</a>(<a href="#26593" title="(s: String,sb: StringBuilder)StringBuilder">appendQuoted</a><span title="Unit">(</span><a href="#27982" title="String">s</a>, <a href="#237419" title="StringBuilder">_</a>))

  /**
   * Appends &amp;quot;s&amp;quot; if string &lt;code&gt;s&lt;/code&gt; does not contain &amp;quot;,
   * &amp;apos;s&amp;apos; otherwise.
   *
   * @param s  ...
   * @param sb ...
   * @return   ...
   */
  <span class="keyword">def</span> <a title="(s: String,sb: StringBuilder)StringBuilder" id="26593">appendQuoted</a>(<a title="String" id="27925">s</a>: <span title="String">String</span>, <a title="StringBuilder" id="27926">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a>) = {
    <span class="keyword">val</span> <a title="Char" id="27929">ch</a> = <span title="Char" class="keyword">if</span> (<a href="../collection/generic/SequenceTemplate.scala.html#17386" title="(elem: Any)Boolean">s</a> contains <span title="Char('&quot;')" class="char">'&quot;'</span>) <span title="Char(''')" class="char">'\''</span> <span class="keyword">else</span> <span title="Char('&quot;')" class="char">'&quot;'</span>
    <a href="#27926" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<a href="#27929" title="Char">ch</a>).<a href="../collection/mutable/StringBuilder.scala.html#23370" title="(s: String)StringBuilder">append</a>(<a href="#27925" title="String">s</a>).<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<a href="#27929" title="Char">ch</a>)
  }

  /**
   * Appends &amp;quot;s&amp;quot; and escapes and &amp;quot; i s with \&amp;quot;
   *
   * @param s  ...
   * @param sb ...
   * @return   ...
   */
  <span class="keyword">def</span> <a title="(s: String,sb: StringBuilder)StringBuilder" id="26594">appendEscapedQuoted</a>(<a title="String" id="28331">s</a>: <span title="String">String</span>, <a title="StringBuilder" id="28332">sb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a>): <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a> = {
    <a href="#28332" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<span title="Char('&quot;')" class="char">'&quot;'</span>)
    <span class="keyword">for</span> (<a title="Char" id="237495">c</a> &lt;- <a href="../collection/generic/VectorTemplate.scala.html#17752" title="(f: (Char) =&gt; StringBuilder)Unit">s</a>) <a href="#237495" title="Char">c</a> <span title="StringBuilder" class="keyword">match</span> {
      <span title="StringBuilder" class="keyword">case</span> <span title="Char('&quot;')" class="char">'&quot;'</span> =&gt; <a href="#28332" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<span title="Char('\')" class="char">'\\'</span>); <a href="#28332" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<span title="Char('&quot;')" class="char">'&quot;'</span>)
      <span title="StringBuilder" class="keyword">case</span> _   =&gt; <a href="#28332" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<a href="#237495" title="Char">c</a>)
    }
    <a href="#28332" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<span title="Char('&quot;')" class="char">'&quot;'</span>)
  }

  /**
   * @param s     ...
   * @param index ...
   * @return      ...
   */
  <span class="keyword">def</span> <a title="(s: String,index: Int)String" id="26595">getName</a>(<a title="String" id="237523">s</a>: <span title="String">String</span>, <a title="Int" id="237524">index</a>: <span title="Int">Int</span>): <span title="String">String</span> = {
    <span title="String" class="keyword">if</span> (<a href="#237524" title="(x$1: Int)Boolean">index</a> &gt;= <a href="#237523" title="String">s</a>.<span title="()Int">length</span>) <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span> (<a href="../collection/generic/VectorTemplate.scala.html#17794" title="(n: Int)scala.runtime.RichString">s</a> drop <a href="#237524" title="Int">index</a>) <span title="String" class="keyword">match</span> {
      <span title="String" class="keyword">case</span> <a href="../collection/generic/SequenceFactory.scala.html#17519" title="(x: Sequence[Char])Some[Sequence[Char]]">Seq</a>(<a title="Char" id="237562">x</a>, <a title="Sequence[Char]" id="237563">xs</a> @ _*) <span class="keyword">if</span> <a href="parsing/TokenTests.scala.html#26603" title="(ch: Char)Boolean">isNameStart</a>(<a href="#237562" title="Char">x</a>)  =&gt; (<a href="../Array.scala.html#29224" title="(xs: Char*)Array[Char]">Array</a><a href="../collection/generic/TraversableTemplate.scala.html#17151" title="(that: Traversable[Char])(implicit bf: scala.collection.generic.BuilderFactory[Char,Array[Char],Array[Char]])Array[Char]">(</a><a href="#237562" title="Char">x</a>) <a href="../Array.scala.html#29207" title="scala.collection.generic.BuilderFactory[Char,Array[Char],Array[_]]">++</a> (<a href="../collection/generic/TraversableTemplate.scala.html#17220" title="(p: (Char) =&gt; Boolean)Sequence[Char]">xs</a> takeWhile <a href="parsing/TokenTests.scala.html#26602" title="(ch: Char)Boolean">isNameChar</a>)).<a href="../collection/generic/TraversableTemplate.scala.html#17248" title="=&gt; String">mkString</a>
      <span title="java.lang.String(&quot;&quot;)" class="keyword">case</span> _                                  =&gt; <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
    }
  }

  /**
   * Returns &lt;code&gt;null&lt;/code&gt; if the value is a correct attribute value,
   * error message if it isn't.
   *
   * @param value ...
   * @return      ... 
   */
  <span class="keyword">def</span> <a title="(value: String)String" id="26596">checkAttributeValue</a>(<a title="String" id="237745">value</a>: <span title="String">String</span>): <span title="String">String</span> = {
    <span class="keyword">var</span> <a title="Int" id="237747">i</a> = <span title="Int(0)" class="int">0</span>
    <span title="Unit" class="keyword">while</span> (<a href="#237747" title="(x$1: Int)Boolean" id="2954">i</a> &lt; <a href="#237745" title="String">value</a>.<span title="()Int">length</span>) <a href="#237748" title="()Unit">{</a>
      <a href="#237745" title="String">value</a>.<span title="(x$1: Int)Char">charAt</span>(<a href="#237747" title="Int">i</a>) <span title="Unit" class="keyword">match</span> {
        <span title="Nothing" class="keyword">case</span> <span title="Char('&lt;')" class="char">'&lt;'</span> =&gt; 
          <span title="Nothing" class="keyword">return</span> <span title="java.lang.String(&quot;&lt; not allowed in attribute value&quot;)" class="string">&quot;&lt; not allowed in attribute value&quot;</span>;
        <span title="Unit" class="keyword">case</span> <span title="Char('&amp;')" class="char">'&amp;'</span> =&gt; 
          <span class="keyword">val</span> <a title="String" id="237759">n</a> = <a href="#26595" title="(s: String,index: Int)String">getName</a>(<a href="#237745" title="String">value</a>, <a href="#237747" title="(x$1: Int)Int">i</a>+<span title="Int(1)" class="int">1</span>)
          <span title="Unit" class="keyword">if</span> (<a href="#237759" title="(x$1: AnyRef)Boolean">n</a> eq <span title="Null(null)" class="keyword">null</span>)
            <span title="Nothing" class="keyword">return</span> <span title="(x$1: Any)java.lang.String" class="string">&quot;malformed entity reference in attribute value [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#237745" title="String">value</a>+<span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>;
          <a href="#237747" title="Int">i</a> = <a href="#237747" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">+</span> <a href="#237759" title="String">n</a>.<span title="()Int">length</span> + <span title="Int(1)" class="int">1</span>
          <span title="Unit" class="keyword">if</span> (<a href="#237747" title="(x$1: Int)Boolean">i</a> <span title="(x$1: Boolean)Boolean">&gt;=</span> <a href="#237745" title="String">value</a>.<span title="()Int">length</span> || <a href="#237745" title="String">value</a>.<span title="(x$1: Int)Char">charAt</span><span title="(x$1: Char)Boolean">(</span><a href="#237747" title="Int">i</a>) != <span title="Char(';')" class="char">';'</span>)
            <span title="Nothing" class="keyword">return</span> <span title="(x$1: Any)java.lang.String" class="string">&quot;malformed entity reference in attribute value [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#237745" title="String">value</a>+<span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>;
        <span title="Unit" class="keyword">case</span> _   =&gt;
      }
      <a href="#237747" title="Int">i</a> = <a href="#237747" title="(x$1: Int)Int">i</a> + <span title="Int(1)" class="int">1</span>
    }
    <span title="Null(null)" class="keyword">null</span>
  }

  /**
   * new
   *
   * @param value ...
   * @return      ...
   */
  <span class="keyword">def</span> <a title="(value: String)Seq[scala.xml.Node]" id="26597">parseAttributeValue</a>(<a title="String" id="237867">value</a>: <span title="String">String</span>): <a href="../collection/Sequence.scala.html#4346" title="Seq[scala.xml.Node]">Seq</a>[Node] = {
    <span class="keyword">val</span> <a title="Seq[Char]" id="237869">zs</a>: <a href="../collection/Sequence.scala.html#4346" title="Seq[Char]">Seq</a>[Char] = <a href="../Predef.scala.html#16366" title="implicit scala.Predef.stringWrapper : (x: String)scala.runtime.RichString">value</a>
    <span class="keyword">val</span> <a title="StringBuilder" id="237870">sb</a>  = <a href="../collection/mutable/StringBuilder.scala.html#23348" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14791" title="StringBuilder">StringBuilder</a>
    <span class="keyword">var</span> <a title="StringBuilder" id="237871">rfb</a>: <a href="../collection/mutable/StringBuilder.scala.html#7821" title="StringBuilder">StringBuilder</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">val</span> <a title="scala.xml.NodeBuffer" id="237872">nb</a> = <span title="scala.xml.NodeBuffer" class="keyword">new</span> <a href="NodeBuffer.scala.html#8696" title="scala.xml.NodeBuffer">NodeBuffer</a>()
    <span class="keyword">val</span> <a title="Iterator[Char]" id="237873">it</a> = <a href="#237869" title="Seq[Char]">zs</a>.<a href="../collection/generic/IterableTemplate.scala.html#17285" title="=&gt; Iterator[Char]">iterator</a>
    <span title="Unit" class="keyword">while</span> (<a href="#237873" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19184" title="=&gt; Boolean">hasNext</a>) <a href="#237874" title="()Unit">{</a>
      <span class="keyword">var</span> <a title="Char" id="237896">c</a> = <a href="#237873" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19185" title="()Char">next</a>
      <a href="#237896" title="Char">c</a> <span title="Any" class="keyword">match</span> {
        <span title="Any" class="keyword">case</span> <span title="Char('&amp;')" class="char">'&amp;'</span> =&gt; // entity! flush buffer into text node
          <a href="#237873" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19185" title="()Char">next</a> <span title="Any" class="keyword">match</span> {
            <span title="StringBuilder" class="keyword">case</span> <span title="Char('#')" class="char">'#'</span> =&gt;
              <a href="#237896" title="Char">c</a> = <a href="#237873" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19185" title="()Char">next</a>
              <span class="keyword">val</span> <a title="String" id="237901">theChar</a> = <a href="#26598" title="(ch: () =&gt; Char,nextch: () =&gt; Unit,reportSyntaxError: (String) =&gt; Unit)String">parseCharRef</a> ({ ()=&gt; <a href="#237896" title="Char">c</a> },{ () =&gt; <a href="#237896" title="Char">c</a> = <a href="#237873" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19185" title="()Char">next</a> },{<a title="String" id="237909">s</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a title="(x$1: java.lang.String)java.lang.RuntimeException" id="19670" class="keyword">new</a> <a href="../Predef.scala.html#16163" title="java.lang.RuntimeException">RuntimeException</a>(<a href="#237909" title="String">s</a>)})
              <a href="#237870" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23370" title="(s: String)StringBuilder">append</a>(<a href="#237901" title="String">theChar</a>)

            <span title="Any" class="keyword">case</span> <a title="Char" id="237924">x</a> =&gt;
              <span title="Unit" class="keyword">if</span> (<a href="#237871" title="(x$1: AnyRef)Boolean">rfb</a> eq <span title="Null(null)" class="keyword">null</span>) <a href="#237871" title="StringBuilder">rfb</a> = <a href="../collection/mutable/StringBuilder.scala.html#23348" title="()StringBuilder" class="keyword">new</a> <a href="../package.scala.html#14791" title="StringBuilder">StringBuilder</a>()
              <a href="#237871" title="StringBuilder">rfb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<a href="#237924" title="Char">x</a>)
              <a href="#237896" title="Char">c</a> = <a href="#237873" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19185" title="()Char">next</a>
              <span title="Unit" class="keyword">while</span> (<a href="#237896" title="(x$1: Char)Boolean">c</a> != <span title="Char(';')" class="char">';'</span>) <a href="#237926" title="()Unit">{</a>
                <a href="#237871" title="StringBuilder">rfb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<a href="#237896" title="Char">c</a>)
                <a href="#237896" title="Char">c</a> = <a href="#237873" title="Iterator[Char]">it</a>.<a href="../collection/Iterator.scala.html#19185" title="()Char">next</a>
              }
              <span class="keyword">val</span> <a title="String" id="237925">ref</a> = <a href="#237871" title="StringBuilder">rfb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23409" title="()String">toString</a>() 
              <a href="#237871" title="StringBuilder">rfb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23355" title="(n: Int)Unit">setLength</a>(<span title="Int(0)" class="int">0</span>)
              <a href="#26585" title="(ref: String,s: StringBuilder)StringBuilder">unescape</a>(<a href="#237925" title="String">ref</a>,<a href="#237870" title="StringBuilder">sb</a>) <span title="Any" class="keyword">match</span> {
                <span title="nb.type" class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> =&gt; 
                  <span title="Unit" class="keyword">if</span> (<a href="#237870" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23352" title="(x$1: Int)Boolean">length</a> &gt; <span title="Int(0)" class="int">0</span>) {          // flush buffer
                    <a href="../collection/mutable/ArrayBuffer.scala.html#19917" title="(elem: scala.xml.Node)nb.type">nb</a> += <a href="Text.scala.html#26684" title="(_data: String)scala.xml.Text">Text</a>(<a href="#237870" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23409" title="()String">toString</a>())
                    <a href="#237870" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23355" title="(n: Int)Unit">setLength</a>(<span title="Int(0)" class="int">0</span>)
                  }
                  <a href="../collection/mutable/ArrayBuffer.scala.html#19917" title="(elem: scala.xml.Node)nb.type">nb</a> += <a href="EntityRef.scala.html#50360" title="(entityName: String)scala.xml.EntityRef">EntityRef</a>(<a href="#237870" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23409" title="()String">toString</a>()) // add entityref
                <span title="Unit" class="keyword">case</span> _ =&gt;
              }
          }
        <span title="StringBuilder" class="keyword">case</span> <a title="Char" id="238065">x</a>   =&gt; 
          <a href="#237870" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23380" title="(x: Char)StringBuilder">append</a>(<a href="#238065" title="Char">x</a>)
      }
    } 
    <span title="Any" class="keyword">if</span> (<a href="#237870" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23352" title="(x$1: Int)Boolean">length</a> &gt; <span title="Int(0)" class="int">0</span>) { // flush buffer
      <span class="keyword">val</span> <a title="scala.xml.Text" id="238080">x</a> = <a href="Text.scala.html#26684" title="(_data: String)scala.xml.Text">Text</a>(<a href="#237870" title="StringBuilder">sb</a>.<a href="../collection/mutable/StringBuilder.scala.html#23409" title="()String">toString</a>())
      <span title="nb.type" class="keyword">if</span> (<a href="#237872" title="scala.xml.NodeBuffer">nb</a>.<a href="../collection/mutable/ResizableArray.scala.html#19998" title="(x$1: Int)Boolean" id="2950">length</a> == <span title="Int(0)" class="int">0</span>)
        <span title="Nothing" class="keyword">return</span> <a href="#238080" title="scala.xml.Text">x</a>
      <span class="keyword">else</span>
        <a href="../collection/mutable/ArrayBuffer.scala.html#19917" title="(elem: scala.xml.Node)nb.type">nb</a> += <a href="#238080" title="scala.xml.Text">x</a>
    }
    <a href="#237872" title="scala.xml.NodeBuffer">nb</a> 
  }

  /**
   * &lt;pre&gt;
   *   CharRef ::= &quot;&amp;amp;#&quot; '0'..'9' {'0'..'9'} &quot;;&quot;
   *             | &quot;&amp;amp;#x&quot; '0'..'9'|'A'..'F'|'a'..'f' { hexdigit } &quot;;&quot;
   * &lt;/pre&gt;
   * &lt;p&gt;
   *   see [66]
   * &lt;p&gt;
   *
   * @param ch                ...
   * @param nextch            ...
   * @param reportSyntaxError ...
   * @return                  ...
   */
  <span class="keyword">def</span> <a title="(ch: () =&gt; Char,nextch: () =&gt; Unit,reportSyntaxError: (String) =&gt; Unit)String" id="26598">parseCharRef</a>(<a title="() =&gt; Char" id="145755">ch</a>: () =&gt; Char, <a title="() =&gt; Unit" id="145756">nextch</a>: () =&gt; Unit, <a title="(String) =&gt; Unit" id="145757">reportSyntaxError</a>: String =&gt; Unit): <span title="String">String</span> = {
    <span class="keyword">val</span> <a title="Boolean" id="238133">hex</a>  = <span title="(x$1: Boolean)Boolean">(</span><a href="../Function0.scala.html#34096" title="()Char">ch</a><a title="(x$1: Char)Boolean" id="2714">(</a>) == <span title="Char('x')" class="char">'x'</span>) &amp;&amp; { <a href="../Function0.scala.html#34096" title="()Unit">nextch</a>(); <span title="Boolean(true)" class="keyword">true</span> }
    <span class="keyword">val</span> <a title="Int" id="238134">base</a> = <span title="Int" class="keyword">if</span> (<a href="#238133" title="Boolean">hex</a>) <span title="Int(16)" class="int">16</span> <span class="keyword">else</span> <span title="Int(10)" class="int">10</span>
    <span class="keyword">var</span> <a title="Int" id="238135">i</a> = <span title="Int(0)" class="int">0</span>
    <span title="Unit" class="keyword">while</span> (<a href="../Function0.scala.html#34096" title="()Char">ch</a><span title="(x$1: Char)Boolean">(</span>) != <span title="Char(';')" class="char">';'</span>) <a href="#238136" title="()Unit">{</a>
      <a href="../Function0.scala.html#34096" title="()Char">ch</a>() <span title="Unit" class="keyword">match</span> {
        <span title="Unit" class="keyword">case</span> <span title="Char('0')" class="char">'0'</span> | <span title="Char('1')" class="char">'1'</span> | <span title="Char('2')" class="char">'2'</span> | <span title="Char('3')" class="char">'3'</span> | <span title="Char('4')" class="char">'4'</span> | <span title="Char('5')" class="char">'5'</span> | <span title="Char('6')" class="char">'6'</span> | <span title="Char('7')" class="char">'7'</span> | <span title="Char('8')" class="char">'8'</span> | <span title="Char('9')" class="char">'9'</span> =&gt;
          <a href="#238135" title="Int">i</a> = <a href="#238135" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">*</span> <a href="#238134" title="Int">base</a> + <a href="../Function0.scala.html#34096" title="()Char">ch</a><a href="../Predef.scala.html#16361" title="implicit scala.Predef.charWrapper : (c: Char)scala.runtime.RichChar">(</a>).<a href="../runtime/RichChar.scala.html#19036" title="=&gt; Int">asDigit</a>
        <span title="Unit" class="keyword">case</span> <span title="Char('a')" class="char">'a'</span> | <span title="Char('b')" class="char">'b'</span> | <span title="Char('c')" class="char">'c'</span> | <span title="Char('d')" class="char">'d'</span> | <span title="Char('e')" class="char">'e'</span> | <span title="Char('f')" class="char">'f'</span>
           | <span title="Char('A')" class="char">'A'</span> | <span title="Char('B')" class="char">'B'</span> | <span title="Char('C')" class="char">'C'</span> | <span title="Char('D')" class="char">'D'</span> | <span title="Char('E')" class="char">'E'</span> | <span title="Char('F')" class="char">'F'</span> =&gt;
          <span title="Unit" class="keyword">if</span> (<span title="=&gt; Boolean">!</span> <a href="#238133" title="Boolean">hex</a>) 
            <a href="../Function1.scala.html#17119" title="(v1: String)Unit">reportSyntaxError</a>(<span class="string">&quot;hex char not allowed in decimal char ref\n&quot;</span> <span title="java.lang.String(&quot;hex char not allowed in decimal char ref\012Did you mean to write &amp;#x ?&quot;)">+</span>
                              <span class="string">&quot;Did you mean to write &amp;#x ?&quot;</span>)
          <span class="keyword">else</span>
            <a href="#238135" title="Int">i</a> = <a href="#238135" title="(x$1: Int)Int">i</a> <span title="(x$1: Int)Int">*</span> <a href="#238134" title="Int">base</a> + <a href="../Function0.scala.html#34096" title="()Char">ch</a><a href="../Predef.scala.html#16361" title="implicit scala.Predef.charWrapper : (c: Char)scala.runtime.RichChar">(</a>).<a href="../runtime/RichChar.scala.html#19036" title="=&gt; Int">asDigit</a>
        <span title="Unit" class="keyword">case</span> _ =&gt;
          <a href="../Function1.scala.html#17119" title="(v1: String)Unit">reportSyntaxError</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;character '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../Function0.scala.html#34096" title="()Char">ch</a>() + <span title="java.lang.String(&quot;' not allowed in char ref\012&quot;)" class="string">&quot;' not allowed in char ref\n&quot;</span>)
      }
      <a href="../Function0.scala.html#34096" title="()Unit">nextch</a>()
    }
    <a title="(x$1: Array[Byte],x$2: java.lang.String)java.lang.String" id="6884" class="keyword">new</a> <a href="../Predef.scala.html#16156" title="java.lang.String">String</a>(io.<a href="../io/UTF8Codec.scala.html#9671" title="object scala.io.UTF8Codec">UTF8Codec</a>.<a href="../io/UTF8Codec.scala.html#141621" title="(ch1: Int)Array[Byte]">encode</a>(<a href="#238135" title="Int">i</a>), <span title="java.lang.String(&quot;utf8&quot;)" class="string">&quot;utf8&quot;</span>)
  }

}

        </pre>
    </body>
</html>