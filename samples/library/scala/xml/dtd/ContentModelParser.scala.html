<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>scala/xml/dtd/ContentModelParser.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style">
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2002-2009, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://www.scala-lang.org/           **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

// $Id: ContentModelParser.scala 18614 2009-08-31 10:27:23Z extempore $


<span class="keyword">package</span> scala.xml
<span class="keyword">package</span> dtd


/** Parser for regexps (content models in DTD element declarations) */

<span class="keyword">object</span> <a title="object scala.xml.dtd.ContentModelParser" id="11194">ContentModelParser</a> <a href="../../ScalaObject.scala.html#969" title="ScalaObject" class="keyword">extends</a> <a href="Scanner.scala.html#11118" title="scala.xml.dtd.Scanner">Scanner</a> { // a bit too permissive concerning #PCDATA
  <span class="keyword">import</span> ContentModel._

  /** parses the argument to a regexp */
  <span class="keyword">def</span> <a title="(s: String)scala.xml.dtd.ContentModel" id="239613">parse</a>(<a title="String" id="239623">s</a>: <a title="String" id="1618">String</a>): <a href="ContentModel.scala.html#11184" title="scala.xml.dtd.ContentModel">ContentModel</a> = { <a href="Scanner.scala.html#231952" title="(s: String)Unit">initScanner</a>(<a href="#239623" title="String">s</a>); <a href="#239616" title="=&gt; scala.xml.dtd.ContentModel">contentspec</a> }

  <span class="keyword">def</span> <a title="(tok: Int)Unit" id="239614">accept</a>(<a title="Int" id="267318">tok</a>: <a title="Int" id="2190">Int</a>) = {
    <span title="Unit" class="keyword">if</span> (<a href="Scanner.scala.html#231940" title="(x$1: Int)Boolean">token</a> != <a href="#267318" title="Int">tok</a>) {
      <span title="Nothing" class="keyword">if</span> (<a title="(x$1: Boolean)Boolean" id="2225">(</a><a href="#267318" title="(x$1: Int)Boolean">tok</a> == <span title="Int(6)">STAR</span>) &amp;&amp; (<a href="Scanner.scala.html#231940" title="(x$1: Int)Boolean">token</a> == <span title="Int(10)">END</span>))                  // common mistake
        <a href="../../Predef.scala.html#16315" title="(message: String)Nothing">error</a>(<span class="string">&quot;in DTDs, \n&quot;</span><span title="java.lang.String(&quot;in DTDs, \012mixed content models must be like (#PCDATA|Name|Name|...)*&quot;)">+</span>
              <span class="string">&quot;mixed content models must be like (#PCDATA|Name|Name|...)*&quot;</span>);
      <span class="keyword">else</span>
        <a href="../../Predef.scala.html#16315" title="(message: String)Nothing">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;expected &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="Tokens.scala.html#122280" title="(i: Int)String">token2string</a>(<a href="#267318" title="Int">tok</a>)<span title="(x$1: Any)java.lang.String">+</span>
              <span title="java.lang.String(&quot;, got unexpected token:&quot;)" class="string">&quot;, got unexpected token:&quot;</span>+<a href="Tokens.scala.html#122280" title="(i: Int)String">token2string</a>(<a href="Scanner.scala.html#231940" title="=&gt; Int">token</a>));
    }
    <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>
  }

  // s [ '+' | '*' | '?' ]
  <span class="keyword">def</span> <a title="(s: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.ContentModel.RegExp" id="239615">maybeSuffix</a>(<a title="scala.xml.dtd.ContentModel.RegExp" id="267361">s</a>: <a href="../../util/regexp/Base.scala.html#26864" title="scala.xml.dtd.ContentModel.RegExp">RegExp</a>) = <a href="Scanner.scala.html#231940" title="=&gt; Int">token</a> <span title="scala.xml.dtd.ContentModel.RegExp" class="keyword">match</span> {	
    <span title="scala.xml.dtd.ContentModel.Star" class="keyword">case</span> <span title="Int(6)">STAR</span> =&gt; <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>; <a href="../../util/regexp/Base.scala.html#239643" title="(r: scala.xml.dtd.ContentModel._regexpT)scala.xml.dtd.ContentModel.Star">Star</a>(<a href="#267361" title="scala.xml.dtd.ContentModel.RegExp">s</a>) 
    <span title="scala.xml.dtd.ContentModel.Sequ" class="keyword">case</span> <span title="Int(7)">PLUS</span> =&gt; <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>; <a href="../../util/regexp/Base.scala.html#132844" title="(rs: scala.xml.dtd.ContentModel._regexpT*)scala.xml.dtd.ContentModel.Sequ">Sequ</a>(<a href="#267361" title="scala.xml.dtd.ContentModel.RegExp">s</a>, <a href="../../util/regexp/Base.scala.html#239643" title="(r: scala.xml.dtd.ContentModel._regexpT)scala.xml.dtd.ContentModel.Star">Star</a>(<a href="#267361" title="scala.xml.dtd.ContentModel.RegExp">s</a>)) 
    <span title="scala.xml.dtd.ContentModel.Alt" class="keyword">case</span> <span title="Int(8)">OPT</span>  =&gt; <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>; <a href="../../util/regexp/Base.scala.html#57235" title="(rs: scala.xml.dtd.ContentModel._regexpT*)scala.xml.dtd.ContentModel.Alt">Alt</a>(<a href="../../util/regexp/Base.scala.html#26874" title="object scala.xml.dtd.ContentModel.Eps">Eps</a>, <a href="#267361" title="scala.xml.dtd.ContentModel.RegExp">s</a>)
    <span title="scala.xml.dtd.ContentModel.RegExp" class="keyword">case</span> _    =&gt; <a href="#267361" title="scala.xml.dtd.ContentModel.RegExp">s</a>
  }

  // contentspec ::= EMPTY | ANY | (#PCDATA) | &quot;(#PCDATA|&quot;regexp)

  <span class="keyword">def</span> <a title="=&gt; scala.xml.dtd.ContentModel" id="239616">contentspec</a>: <a href="ContentModel.scala.html#11184" title="scala.xml.dtd.ContentModel">ContentModel</a> = <a href="Scanner.scala.html#231940" title="=&gt; Int">token</a> <span title="scala.xml.dtd.ContentModel" class="keyword">match</span> {

    <span title="scala.xml.dtd.ContentModel" class="keyword">case</span> <span title="Int(1)">NAME</span> =&gt; <a href="Scanner.scala.html#231943" title="=&gt; String">value</a> <span title="scala.xml.dtd.ContentModel" class="keyword">match</span> {
      <span title="scala.xml.dtd.ANY.type" class="keyword">case</span> <span title="java.lang.String(&quot;ANY&quot;)" class="string">&quot;ANY&quot;</span>   =&gt; <a href="ContentModel.scala.html#11281" title="object scala.xml.dtd.ANY">ANY</a> 
      <span title="scala.xml.dtd.EMPTY.type" class="keyword">case</span> <span title="java.lang.String(&quot;EMPTY&quot;)" class="string">&quot;EMPTY&quot;</span> =&gt; <a href="ContentModel.scala.html#11233" title="object scala.xml.dtd.EMPTY">EMPTY</a>
      <span title="Nothing" class="keyword">case</span> _       =&gt; <a href="../../Predef.scala.html#16315" title="(message: String)Nothing">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;expected ANY, EMPTY or '(' instead of &quot;</span> + <a href="Scanner.scala.html#231943" title="=&gt; String">value</a> );
    }
    <span title="scala.xml.dtd.ContentModel" class="keyword">case</span> <span title="Int(3)">LPAREN</span> =&gt; 

      <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>; 
      <a href="#239617" title="=&gt; Unit">sOpt</a>;
      <span title="scala.xml.dtd.ContentModel" class="keyword">if</span> (<a href="Scanner.scala.html#231940" title="(x$1: Int)Boolean">token</a> != <span title="Int(0)">TOKEN_PCDATA</span>)
        <a href="ContentModel.scala.html#56382" title="(r: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.ELEMENTS">ELEMENTS</a>(<a href="#239618" title="=&gt; scala.xml.dtd.ContentModel.RegExp">regexp</a>);
      <span class="keyword">else</span> {
        <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>;
        <a href="Scanner.scala.html#231940" title="=&gt; Int">token</a> <span title="scala.xml.dtd.ContentModel" class="keyword">match</span> {
        <span title="scala.xml.dtd.PCDATA.type" class="keyword">case</span> <span title="Int(4)">RPAREN</span> =&gt;
          <a href="ContentModel.scala.html#11263" title="object scala.xml.dtd.PCDATA">PCDATA</a>
        <span title="scala.xml.dtd.MIXED" class="keyword">case</span> <span title="Int(9)">CHOICE</span> =&gt;
          <span class="keyword">val</span> <a title="scala.xml.dtd.MIXED" id="267438">res</a> = <a href="ContentModel.scala.html#57216" title="(r: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.MIXED">MIXED</a>(<a href="#239620" title="(p: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.ContentModel.Alt">choiceRest</a>(<a href="../../util/regexp/Base.scala.html#26874" title="object scala.xml.dtd.ContentModel.Eps">Eps</a>));
          <a href="#239617" title="=&gt; Unit">sOpt</a>;
          <a href="#239614" title="(tok: Int)Unit">accept</a>( <span title="Int(4)">RPAREN</span> );
          <a href="#239614" title="(tok: Int)Unit">accept</a>( <span title="Int(6)">STAR</span> );
          <a href="#267438" title="scala.xml.dtd.MIXED">res</a>
        <span title="Nothing" class="keyword">case</span> _ =&gt;
          <a href="../../Predef.scala.html#16315" title="(message: String)Nothing">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;unexpected token:&quot;</span> + <a href="Tokens.scala.html#122280" title="(i: Int)String">token2string</a>(<a href="Scanner.scala.html#231940" title="=&gt; Int">token</a>) );
        }
      }

    <span title="Nothing" class="keyword">case</span> _ =&gt;
      <a href="../../Predef.scala.html#16315" title="(message: String)Nothing">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;unexpected token:&quot;</span> + <a href="Tokens.scala.html#122280" title="(i: Int)String">token2string</a>(<a href="Scanner.scala.html#231940" title="=&gt; Int">token</a>) );
    }
  //                                  sopt ::= S?
  <span class="keyword">def</span> <a title="=&gt; Unit" id="239617">sOpt</a> = <span title="Unit" class="keyword">if</span>( <a href="Scanner.scala.html#231940" title="(x$1: Int)Boolean">token</a> == <span title="Int(13)">S</span> ) <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>;

  //                      (' S? mixed ::= '#PCDATA' S? ')'
  //                                    | '#PCDATA' (S? '|' S? atom)* S? ')*'

  //       '(' S? regexp ::= cp S? [seqRest|choiceRest] ')' [ '+' | '*' | '?' ]
  <span class="keyword">def</span> <a title="=&gt; scala.xml.dtd.ContentModel.RegExp" id="239618">regexp</a>: <a href="../../util/regexp/Base.scala.html#26864" title="scala.xml.dtd.ContentModel.RegExp">RegExp</a> = {
    <span class="keyword">val</span> <a title="scala.xml.dtd.ContentModel.RegExp" id="267538">p</a> = <a href="#239621" title="=&gt; scala.xml.dtd.ContentModel.RegExp">particle</a>;
    <a href="#239617" title="=&gt; Unit">sOpt</a>;
    <a href="#239615" title="(s: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.ContentModel.RegExp">maybeSuffix</a>(<a href="Scanner.scala.html#231940" title="=&gt; Int">token</a> <span title="scala.xml.dtd.ContentModel.RegExp" class="keyword">match</span> {
      <span title="scala.xml.dtd.ContentModel.RegExp" class="keyword">case</span> <span title="Int(4)">RPAREN</span>  =&gt; <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>; <a href="#267538" title="scala.xml.dtd.ContentModel.RegExp">p</a>
      <span title="scala.xml.dtd.ContentModel.Alt" class="keyword">case</span> <span title="Int(9)">CHOICE</span>  =&gt; <span class="keyword">val</span> <a title="scala.xml.dtd.ContentModel.Alt" id="267539">q</a> = <a href="#239620" title="(p: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.ContentModel.Alt">choiceRest</a>( <a href="#267538" title="scala.xml.dtd.ContentModel.RegExp">p</a> );<a href="#239614" title="(tok: Int)Unit">accept</a>( <span title="Int(4)">RPAREN</span> ); <a href="#267539" title="scala.xml.dtd.ContentModel.Alt">q</a>
      <span title="scala.xml.dtd.ContentModel.Sequ" class="keyword">case</span> <span title="Int(5)">COMMA</span>   =&gt; <span class="keyword">val</span> <a title="scala.xml.dtd.ContentModel.Sequ" id="267544">q</a> = <a href="#239619" title="(p: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.ContentModel.Sequ">seqRest</a>( <a href="#267538" title="scala.xml.dtd.ContentModel.RegExp">p</a> );   <a href="#239614" title="(tok: Int)Unit">accept</a>( <span title="Int(4)">RPAREN</span> ); <a href="#267544" title="scala.xml.dtd.ContentModel.Sequ">q</a>
    })
  }

  //                                             seqRest ::= (',' S? cp S?)+
  <span class="keyword">def</span> <a title="(p: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.ContentModel.Sequ" id="239619">seqRest</a>(<a title="scala.xml.dtd.ContentModel.RegExp" id="267545">p</a>: <a href="../../util/regexp/Base.scala.html#26864" title="scala.xml.dtd.ContentModel.RegExp">RegExp</a>) = { 
    <span class="keyword">var</span> <a title="List[scala.xml.dtd.ContentModel.RegExp]" id="267548">k</a> = <a href="../../collection/immutable/List.scala.html#17642" title="(xs: scala.xml.dtd.ContentModel.RegExp*)List[scala.xml.dtd.ContentModel.RegExp]">List</a>(<a href="#267545" title="scala.xml.dtd.ContentModel.RegExp">p</a>);
    <span title="Unit" class="keyword">while</span>( <a href="Scanner.scala.html#231940" title="(x$1: Int)Boolean">token</a> == <span title="Int(5)">COMMA</span> ) <a href="#267549" title="()Unit">{</a>
      <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>;
      <a href="#239617" title="=&gt; Unit">sOpt</a>;
      <a href="#267548" title="List[scala.xml.dtd.ContentModel.RegExp]">k</a> = <a href="#239621" title="=&gt; scala.xml.dtd.ContentModel.RegExp">particle</a><a href="#267566" title="scala.xml.dtd.ContentModel.RegExp">::</a><a href="../../collection/immutable/List.scala.html#17737" title="(x: scala.xml.dtd.ContentModel.RegExp)List[scala.xml.dtd.ContentModel.RegExp]">k</a>;
      <a href="#239617" title="=&gt; Unit">sOpt</a>;
    }
    <a href="../../util/regexp/Base.scala.html#132844" title="(rs: scala.xml.dtd.ContentModel._regexpT*)scala.xml.dtd.ContentModel.Sequ">Sequ</a>( <a href="#267548" title="List[scala.xml.dtd.ContentModel.RegExp]">k</a>.<a href="../../collection/immutable/List.scala.html#17771" title="=&gt; List[scala.xml.dtd.ContentModel.RegExp]">reverse</a>:_* )
  }

  //                                          choiceRest ::= ('|' S? cp S?)+
  <span class="keyword">def</span> <a title="(p: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.ContentModel.Alt" id="239620">choiceRest</a>( <a title="scala.xml.dtd.ContentModel.RegExp" id="267443">p</a>:<a href="../../util/regexp/Base.scala.html#26864" title="scala.xml.dtd.ContentModel.RegExp">RegExp</a> ) = { 
    <span class="keyword">var</span> <a title="List[scala.xml.dtd.ContentModel.RegExp]" id="267446">k</a> = <a href="../../collection/immutable/List.scala.html#17642" title="(xs: scala.xml.dtd.ContentModel.RegExp*)List[scala.xml.dtd.ContentModel.RegExp]">List</a>( <a href="#267443" title="scala.xml.dtd.ContentModel.RegExp">p</a> );
    <span title="Unit" class="keyword">while</span>( <a href="Scanner.scala.html#231940" title="(x$1: Int)Boolean">token</a> == <span title="Int(9)">CHOICE</span> ) <a href="#267447" title="()Unit">{</a>
      <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>;
      <a href="#239617" title="=&gt; Unit">sOpt</a>;
      <a href="#267446" title="List[scala.xml.dtd.ContentModel.RegExp]">k</a> = <a href="#239621" title="=&gt; scala.xml.dtd.ContentModel.RegExp">particle</a><a href="#267464" title="scala.xml.dtd.ContentModel.RegExp">::</a><a href="../../collection/immutable/List.scala.html#17737" title="(x: scala.xml.dtd.ContentModel.RegExp)List[scala.xml.dtd.ContentModel.RegExp]">k</a>;
      <a href="#239617" title="=&gt; Unit">sOpt</a>;
    }
    <a href="../../util/regexp/Base.scala.html#57235" title="(rs: scala.xml.dtd.ContentModel._regexpT*)scala.xml.dtd.ContentModel.Alt">Alt</a>( <a href="#267446" title="List[scala.xml.dtd.ContentModel.RegExp]">k</a>.<a href="../../collection/immutable/List.scala.html#17771" title="=&gt; List[scala.xml.dtd.ContentModel.RegExp]">reverse</a>:_* )
  }

  //                                  particle ::=  '(' S? regexp
  //                                             |  name [ '+' | '*' | '?' ]
  <span class="keyword">def</span> <a title="=&gt; scala.xml.dtd.ContentModel.RegExp" id="239621">particle</a> = <a href="Scanner.scala.html#231940" title="=&gt; Int">token</a> <span title="scala.xml.dtd.ContentModel.RegExp" class="keyword">match</span> {
    <span title="scala.xml.dtd.ContentModel.RegExp" class="keyword">case</span> <span title="Int(3)">LPAREN</span> =&gt; <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>; <a href="#239617" title="=&gt; Unit">sOpt</a>; <a href="#239618" title="=&gt; scala.xml.dtd.ContentModel.RegExp">regexp</a>; 
    <span title="scala.xml.dtd.ContentModel.RegExp" class="keyword">case</span> <span title="Int(1)">NAME</span>   =&gt; <span class="keyword">val</span> <a title="scala.xml.dtd.ContentModel.Letter" id="267468">a</a> = <a href="../../util/regexp/WordExp.scala.html#57273" title="(a: scala.xml.dtd.ContentModel._labelT)scala.xml.dtd.ContentModel.Letter">Letter</a>(<a href="ContentModel.scala.html#56569" title="(name: String)scala.xml.dtd.ContentModel.ElemName">ElemName</a>(<a href="Scanner.scala.html#231943" title="=&gt; String">value</a>)); <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>; <a href="#239615" title="(s: scala.xml.dtd.ContentModel.RegExp)scala.xml.dtd.ContentModel.RegExp">maybeSuffix</a>(<a href="#267468" title="scala.xml.dtd.ContentModel.Letter">a</a>)
    <span title="Nothing" class="keyword">case</span> _      =&gt; <a href="../../Predef.scala.html#16315" title="(message: String)Nothing">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;expected '(' or Name, got:&quot;</span>+<a href="Tokens.scala.html#122280" title="(i: Int)String">token2string</a>(<a href="Scanner.scala.html#231940" title="=&gt; Int">token</a>));
  }

  //                                     atom ::= name
  <span class="keyword">def</span> <a title="=&gt; scala.xml.dtd.ContentModel.Letter" id="239622">atom</a> = <a href="Scanner.scala.html#231940" title="=&gt; Int">token</a> <span title="scala.xml.dtd.ContentModel.Letter" class="keyword">match</span> {
    <span title="scala.xml.dtd.ContentModel.Letter" class="keyword">case</span> <span title="Int(1)">NAME</span>   =&gt; <span class="keyword">val</span> <a title="scala.xml.dtd.ContentModel.Letter" id="267597">a</a> = <a href="../../util/regexp/WordExp.scala.html#57273" title="(a: scala.xml.dtd.ContentModel._labelT)scala.xml.dtd.ContentModel.Letter">Letter</a>(<a href="ContentModel.scala.html#56569" title="(name: String)scala.xml.dtd.ContentModel.ElemName">ElemName</a>(<a href="Scanner.scala.html#231943" title="=&gt; String">value</a>)); <a href="Scanner.scala.html#231953" title="=&gt; Unit">nextToken</a>; <a href="#267597" title="scala.xml.dtd.ContentModel.Letter">a</a>
    <span title="Nothing" class="keyword">case</span> _      =&gt; <a href="../../Predef.scala.html#16315" title="(message: String)Nothing">error</a>(<span title="(x$1: Any)java.lang.String" class="string">&quot;expected Name, got:&quot;</span>+<a href="Tokens.scala.html#122280" title="(i: Int)String">token2string</a>(<a href="Scanner.scala.html#231940" title="=&gt; Int">token</a>));
  }
}

        </pre>
    </body>
</html>